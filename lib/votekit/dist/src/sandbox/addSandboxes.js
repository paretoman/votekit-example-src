(()=>{class t{constructor(){this.linked=!0,this.commanders=[],this.protect=!1}setLinked(t){this.linked=t}addCommander(t){this.commanders.push(t)}broadcastDo(t,e){this.linked&&!1===this.protect?(this.protect=!0,this.commanders.forEach((e=>e.passDo(t))),this.protect=!1):e.passDo(t)}broadcastDoCommands(t,e){this.linked&&!1===this.protect?(this.protect=!0,this.commanders.forEach((e=>e.passDoCommands(t))),this.protect=!1):e.passDoCommands(t)}broadcastLoadConfig(t,e){this.linked&&!1===this.protect?(this.protect=!0,this.commanders.forEach((e=>e.passLoadConfig(t))),this.protect=!1):e.passLoadConfig(t)}broadCastLoadCommands(t,e){this.linked&&!1===this.protect?(this.protect=!0,this.commanders.forEach((e=>e.passLoadCommands(t))),this.protect=!1):e.passLoadCommands(t)}}function e(t){return[...Array(t).keys()]}function n(t){return JSON.parse(JSON.stringify(t))}function o(t){return"object"==typeof t?Array.isArray(t)?t.map(o):Object.keys(t).sort().reduce(((e,n)=>{const i=t[n];return e[n]=o(i),e}),{}):t}function i(t){return JSON.stringify(o(t),null,"\t")}function r(t,e,n){return 1/(n*Math.sqrt(2*Math.PI))*Math.exp(-.5*((t-e)/n)**2)}function s(t,e,n){return t===1/0?1:t===-1/0?0:.5*function(t){const e=.147,n=t**2,o=1+e*n,i=-(4/Math.PI+e*n)/o*n,r=Math.exp(i),s=Math.sqrt(1-r)*Math.sign(t);return s}((t-e)/(n*Math.sqrt(2)))+.5}function a(t){const e=document.createElement("canvas"),n=e.getContext("2d");n.fillStyle=t;const o=n.fillStyle;return e.remove(),o}function c(t){let e=1/0,n=null;for(let o=0;o<t.length;o++){const i=t[o];i<e&&(e=i,n=o)}return n}function l(t){let e=-1/0,n=null;for(let o=0;o<t.length;o++){const i=t[o];i>e&&(e=i,n=o)}return n}function u(t){let e=t[0],n=t[0];for(let o=0;o<t.length;o++){const i=t[o];i<e&&(e=i),i>n&&(n=i)}return[e,n]}function h(t,e,n){return t<e?e:t>n?n:t}function d(t){const e=t.length,n=Array(e);for(let o=0;o<e;o++)n[o]=t[o];return n}function f(t){return{...t}}function p(t){let e,n,o=0;for(e=0;e<t.length;e++)n=t.charCodeAt(e),o=(o<<5)-o+n,o|=0;const i=2147483648;return(o+i)%i}function m(){const t=this,e=["init"];t.add=t=>{t.forEach((t=>e.push(t)))},t.check=t=>{let n=0;return t.forEach((t=>{n+=e.includes(t)?1:0})),n>0},t.checkNone=()=>0===e.length,t.checkAny=()=>0!==e.length,t.clear=()=>{e.splice(0,e.length)},t.numChanges=()=>e.length,t.getChanges=()=>n(e)}function g(t){const e=this,n=[];e.addSender=e=>{const{name:o,action:i,props:r}=e;n[o]=i;const s=t=>({name:o,value:t,props:r});return{command:s,go:e=>t.do(s(e))}},e.addSenderForList=e=>{const{name:o,action:i,props:r}=e;n[o]=i;const s=(t,e,n)=>({name:o,id:t,value:e,props:r,currentValue:n});return{command:s,go:(e,n,o)=>t.do(s(e,n,o))}},e.execute=t=>{const{name:e,id:o,value:i}=t,r=n[e];void 0!==o?r(o,i):r(i)}}function y(t){const e=this,n={},o=[];e.addSender=t=>{const{name:e,currentValue:i,props:r}=t;void 0!==r&&r.isFirstAction&&(o[e]=!0),n[e]=i},e.addSenderForList=t=>{const{name:e,props:i}=t;void 0!==i&&i.isFirstAction&&(o[e]=!0),n[e]=[];return t=>n[e][t]},e.execute=t=>{const{name:e,id:o,value:i}=t;void 0!==o?n[e][o]=i:n[e]=i},e.makeUndo=t=>{const{name:e,id:o,props:i}=t;let r;void 0===o?r=n[e]:(r=n[e][o],void 0===r&&(r=t.currentValue));return{name:e,id:o,value:r,props:i}},e.passLoadConfig=t=>{e.loadConfigPriority(t,"high"),e.loadConfigPriority(t,"low")},e.loadConfigPriority=(e,n)=>{Object.keys(e).forEach((i=>{const r=void 0!==o[i];if("low"===n&&r)return;if("high"===n&&!r)return;const s=e[i];if(s instanceof Array)s.forEach(((e,n)=>{const o={name:i,id:n,value:e};t.execute(o)}));else{const e={name:i,value:s};t.execute(e)}}))},e.passLoadCommands=e=>{e.forEach((e=>{t.execute(e)}))},e.getConfig=()=>structuredClone(n)}function w(t){const e=this,n=[];let o=-1;e.clearHistory=()=>{n.splice(0,n.length),o=-1},e.passDo=e=>{const i=t.makeUndo(e);n.splice(o+1,n.length-(o+1)),t.execute(e),n.push([{command:e,undoCommand:i}]),o+=1},e.passDoCommands=e=>{n.splice(o+1,n.length-(o+1));const i=[];e.forEach((e=>{const n=t.makeUndo(e);i.push({command:e,undoCommand:n}),t.execute(e)})),n.push(i),o+=1};let i=setTimeout((()=>null),30);e.undo=()=>{if(-1===o)return;const r=n[o];r.forEach((e=>{t.execute(e.undoCommand)})),o-=1;const{undoCommand:s}=r[0];if(void 0===s.props)return;if(!0!==s.props.isChain)return;if(-1===o)return;n[o][0].undoCommand.name===s.name&&(clearTimeout(i),i=setTimeout(e.undo,30))},e.redo=()=>{if(o===n.length-1)return;const r=n[o+1];r.forEach((e=>t.execute(e.command))),o+=1;const{command:s}=r[0];if(void 0===s.props)return;if(!0!==s.props.isChain)return;if(o===n.length-1)return;n[o+1][0].command.name===s.name&&(clearTimeout(i),i=setTimeout(e.redo,30))}}function v(e){const n=this,o=new g(n),i=new y(n),r=new w(n),s=e||new t;s.addCommander(n),n.addSender=t=>{i.addSender(t);return o.addSender(t)},n.addSenderForList=t=>{const e=o.addSenderForList(t);return e.getCurrentValue=i.addSenderForList(t),e},n.execute=t=>{i.execute(t),o.execute(t)},n.makeUndo=i.makeUndo,n.passLoadConfig=i.passLoadConfig,n.passLoadCommands=i.passLoadCommands,n.getConfig=i.getConfig,n.loadConfig=t=>{s.broadcastLoadConfig(t,n)},n.loadCommands=t=>{s.broadCastLoadCommands(t,n)},n.do=t=>{s.broadcastDo(t,n)},n.doCommands=t=>{s.broadcastDoCommands(t,n)},n.passDo=r.passDo,n.passDoCommands=r.passDoCommands,n.undo=r.undo,n.redo=r.redo,n.clearHistory=r.clearHistory}function _(t){const e=this;e.setMode=t=>{e.mode=t},e.setNumDistricts=t=>{e.numDistricts=t,e.useDistricts=t>1},e.setDimensions=t=>{e.dimensions=t},e.setMode("one"),e.setNumDistricts(1),e.setDimensions(2),t.add(["numDistricts","dimensions","mode"])}function x({votes:t,socialChoiceOptions:n,typeOfDivisor:o,seatLimits:i}){const{seats:r,threshold:s}=n;let a,c=t.tallyFractions.map((t=>t<s?0:t)),l=c.map((t=>0===t?0:1)),u=l.reduce(((t,e)=>t+e)),h=0===u;if(void 0!==i){l.map(((t,e)=>t*i[e])).reduce(((t,e)=>t+e))<r&&(h=!0)}if(h&&(c=d(t.tallyFractions),l=c.map((t=>0===t?0:1)),u=l.reduce(((t,e)=>t+e))),"Huntington-Hill"===o&&(u>r||0===u)){const e=[...c].sort(((t,e)=>e-t))[r-1];return{allocation:t.tallyFractions.map((t=>t>=e?1:0))}}"huntingtonHill"===o?a=(t,e)=>Math.sqrt(e*(e+1)):"sainteLague"===o?a=(t,e)=>e+.5:"dHondt"===o&&(a=(t,e)=>e+1);const f=Array(r).fill().map(a),p=[],m=[];let g=0;for(let t=0;t<c.length;t++){const e=c[t];if(0===e)continue;const n=void 0===i?r:Math.min(i[t],r);for(let o=0;o<n;o++)p[g]=f[o]/e,m[g]=t,g+=1}const y=e(m.length).sort(((t,e)=>p[t]-p[e])),w=Array(c.length).fill(0);for(let t=0;t<r;t++){w[m[y[t]]]+=1}return{allocation:w}}const b={name:"Minimax",shortName:"Minimax",functionName:"minimax",voteCasterName:"pairwise",socialChoiceType:"singleWinner",elect:function({votes:t}){const{pairwiseTallyFractions:n}=t,o=n.length,i=Array(o).fill(0),r=.5*o*(o-1),s=Array(o),a=Array(r);let c=0;for(let t=0;t<o-1;t++)for(let e=t+1;e<o;e++){const o=n[t][e]-n[e][t];s[c]=Math.abs(o);const r=o<0;i[t]+=r?1:0,i[e]+=r?0:1,a[c]=r?t:e,c+=1}const l=e(r).sort(((t,e)=>s[t]-s[e]));let u=i.findIndex((t=>0===t)),h=0;for(;-1===u;){i[a[l[h]]]-=1,u=i.findIndex((t=>0===t)),h+=1}return{iWinner:u}}};function C({votes:t,socialChoiceOptions:e,seatLimits:n}){return x({votes:t,socialChoiceOptions:e,seatLimits:n,typeOfDivisor:"sainteLague"})}function S({votes:t,socialChoiceOptions:n}){const{tallyFractions:o}=t,{seats:i}=n,r=o.length;if(i>=r){return{allocation:Array(r).fill(1)}}const s=e(r).sort(((t,e)=>o[e]-o[t])),a=Array(r).fill(0);for(let t=0;t<i;t++){a[s[t]]=1}return{allocation:a}}const k={name:"Allocated Score",shortName:"AllocScore",functionName:"allocatedScore",voteCasterName:"scoreLong",socialChoiceType:"multiWinner",elect:function({votes:t,socialChoiceOptions:n}){const{scoreVotes:o,votePop:i}=t,{seats:r}=n,s=o[0].length,a=o.length,c=1/r,l=Array(a).fill(1),u=Array(s).fill(0);let h=0;for(let t=0;t<s&&!(h>=r);t++){const t=Array(s).fill(0);for(let e=0;e<s;e++)if(1!==u[e])for(let n=0;n<a;n++)t[e]+=l[n]*i[n]*o[n][e];const n=Math.max(...t),r=t.indexOf(n);u[r]=1,h+=1;const d=e(a).sort(((t,e)=>o[e][r]-o[t][r]));let f=0;for(let t=0;t<a;t++){const e=d[t];if(f+=o[e][r]*l[e]*i[t],l[e]=0,f>=c)break}}return{allocation:u}}};const A={name:"Method of Equal Shares",shortName:"MES",functionName:"methodOfEqualShares",voteCasterName:"scoreLong",socialChoiceType:"multiWinner",elect:function({votes:t,socialChoiceOptions:n}){const{scoreVotes:o,votePop:i}=t,{seats:r}=n,s=o[0].length,a=o.length,c=1/r,l=Array(a).fill(1),u=Array(s).fill(0),h=[],d=[],f=10**-4;let p=0;for(let t=0;t<s&&!(p>=r);t++){const n=Array(s).fill(0);for(let t=0;t<s;t++)if(1!==u[t])for(let e=0;e<a;e++)n[t]+=i[e]*o[e][t];const m=e(s).sort(((t,e)=>n[e]-n[t]));let g=null,y=1/0;for(let t=0;t<s;t++){const e=m[t];if(1===u[e])continue;const r=c/n[e];let s=!0;for(let t=0;t<a;t++){const n=o[t][e];if(l[t]<r*n){s=!1;break}}if(s&&r<y){y=r,g=e;break}const h=[];let d=0;const p=[];for(let t=0,n=0;t<a;t++){const r=l[t],s=o[t][e];h[t]=r/s,s>0&&(d+=r*i[t],p[n]=t,n+=1)}if(d+f-c<0)continue;const w=p.sort(((t,e)=>h[t]-h[e])),v=w.length;let _=c,x=n[e],b=null;for(let t=0;t<v;t++){const n=w[t];if(b=h[n],_<x*b)break;_-=i[n]*l[n],x-=i[n]*o[n][e]}_>f&&x>f&&(b=_/x),b<y&&(g=e,y=b)}if(null===g){for(let t=0;t<s;t++){const e=m[t];if(1!==u[e]&&(u[e]=1,p+=1,p>=r))break}break}u[g]=1,p+=1,h[t]=g,d[t]=y;for(let t=0;t<a;t++){const e=y*o[t][g];l[t]=Math.max(0,l[t]-e)}}return{allocation:u,explanation:{winnersByRound:h,winnerMaxCostPerScoreByRound:d,socialChoiceOptions:n}}}},M=[{name:"Plurality",shortName:"Plurality",functionName:"plurality",voteCasterName:"plurality",socialChoiceType:"singleWinner",elect:function({votes:t}){return{iWinner:l(t.tallyFractions)}}},{name:"Random Candidate",shortName:"Rand Cand",functionName:"randomCandidate",voteCasterName:"plurality",socialChoiceType:"singleWinner",elect:function({votes:t}){const e=t.tallyFractions.length;return{iWinner:Math.floor(Math.random()*e)}}},{name:"Huntington Hill",shortName:"Huntington",functionName:"huntingtonHill",voteCasterName:"plurality",socialChoiceType:"allocation",elect:function({votes:t,socialChoiceOptions:e,seatLimits:n}){return x({votes:t,socialChoiceOptions:e,seatLimits:n,typeOfDivisor:"huntingtonHill"})}},{name:"Score",shortName:"Score",functionName:"score",voteCasterName:"score",socialChoiceType:"singleWinner",elect:function({votes:t}){const e=Math.max(...t.tallyFractions);return{iWinner:t.tallyFractions.indexOf(e)}}},{name:"Single Transferable Vote",shortName:"STV",functionName:"stv",voteCasterName:"ranking",socialChoiceType:"multiWinner",elect:function({votes:t,socialChoiceOptions:n}){const{tallyFractions:o,votePop:i,cansByRank:r}=t,{seats:s}=n,a=o.length,u=i.length;if(s>=a){return{allocation:Array(a).fill(1)}}const h=1/(s+1);let f=!1,p=0;const m=[];let g=d(o);const y=Array(a).fill(!0);let w=e(a);const v=Array(u).fill(0),_=Array(u).fill(1),x=Array(u).fill(!1);for(;!f&&p<a;){if(0!==p){g=Array(a).fill(0);for(let t=0;t<r.length;t++){if(x[t])continue;const e=v[t],n=r[t][e];for(let e=0;e<n.length;e++){g[n[e]]+=i[t]*_[t]}}g=g.filter(((t,e)=>y[e])),w=e(a).filter((t=>y[t]))}const t=l(g),n=w[t],o=g[t];let u,d=1;if(o>=h)u=n,d=1-h/o,m.push(n),f=m.length===s;else{u=w[c(g)]}y[u]=!1;for(let t=0;t<r.length;t++){if(x[t])continue;const e=v[t];if(r[t][e].includes(u)){1!==d&&(_[t]*=d);let e=!x[t];for(;e;){v[t]+=1;const n=v[t];if(n===a){x[t]=!0;break}const o=r[t][n];for(let t=0;t<o.length;t++){const n=o[t];e=e&&!y[n]}}}}p+=1}f||console.warn("warning: STV ran over - eliminated all candidates.");const b=Array(a).fill(0);for(let t=0;t<m.length;t++){b[m[t]]+=1}return{allocation:b}}},b,{name:"Open List Proportional Representation",shortName:"OLPR A",functionName:"olprA",voteCasterName:"olprA",socialChoiceType:"multiWinner",elect:function({votes:t,socialChoiceOptions:n}){const{tallyFractions:o,parties:i}=t,{partiesByCan:r,numParties:s}=i,a=o.length,c=Array(s).fill(0),l=Array(s).fill(0);for(let t=0;t<a;t++){const e=r[t];c[e]+=o[t],l[e]+=1}const u=C({votes:{tallyFractions:c},socialChoiceOptions:n,seatLimits:l}).allocation,h=Array(a).fill(0);for(let t=0;t<s;t++){const n={seats:u[t]},i=e(a).filter((e=>r[e]===t)),s=S({votes:{tallyFractions:i.map((t=>o[t]))},socialChoiceOptions:n}).allocation;for(let t=0;t<i.length;t++){h[i[t]]=s[t]}}return{allocation:h}}},{name:"d'Hondt",shortName:"d'Hondt",functionName:"dHondt",voteCasterName:"plurality",socialChoiceType:"allocation",elect:function({votes:t,socialChoiceOptions:e,seatLimits:n}){return x({votes:t,socialChoiceOptions:e,seatLimits:n,typeOfDivisor:"dHondt"})}},{name:"Sainte-Lague",shortName:"Sainte-Lague",functionName:"sainteLague",voteCasterName:"plurality",socialChoiceType:"allocation",elect:C},k,A],E={},T={};M.forEach((t=>{E[t.functionName]=t.elect,T[t.functionName]=t}));function P(t,e){const n=this;n.usr=4,n.update=()=>{(t.check(["mode"])||t.check(["numDistricts"]))&&("one"===e.mode?1===e.numDistricts?n.usr=4:n.usr=32:(e.numDistricts,n.usr=16))}}function D(t,e){const n=this;n.seats=1,n.threshold=.1,n.numSampleCandidates=5,n.update=()=>{if(t.check(["socialChoiceMethod"])){const{socialChoiceType:t}=e;"allocation"===t?(n.seats=5,n.numSampleCandidates=10):"multiWinner"===t?(n.seats=3,n.numSampleCandidates=10):(n.seats=1,n.numSampleCandidates=5)}}}function N(t,e){const n=this;n.castOptions=new P(t,e),n.socialChoiceOptions=new D(t,n),n.setSocialChoiceMethod=t=>{n.socialChoiceMethod=t;const e=T[t];n.voteCasterName=e.voteCasterName,n.socialChoiceType=e.socialChoiceType},n.setSocialChoiceMethod("plurality"),t.add(["socialChoiceMethod"]),n.update=()=>{n.castOptions.update(),n.socialChoiceOptions.update()}}function F(){const t=this,e=[];let n=0;t.new=function(t){e.push(t);const o=n;return n+=1,o},t.num=()=>n,t.get=t=>e[t],t.getList=()=>e}function L(t,e,n,o,i,r,s){const a=this;a.shape1={},a.shape2={};const c=n.new(a);a.instantiate=()=>{const n={x:t.x,y:t.y},i=[s.setForListSenders.exists.command(c,1,0),s.setForListSenders.shape2p.command(c,n,n),s.setForListSenders.shape1x.command(c,e.x,e.x),s.setForListSenders.shape2w.command(c,t.w,t.w),s.setForListSenders.shape1w.command(c,e.w,e.w),s.setForListSenders.shape1densityProfile.command(c,e.densityProfile,e.densityProfile)];r?o.loadCommands(i):o.doCommands(i)},a.setAction={},a.setAction.exists=t=>{a.exists=t,i.add(["draggables"])},a.setE=t=>{const e=s.setForListSenders.exists.getCurrentValue(c);s.setForListSenders.exists.go(c,t,e)},a.setAction.shape2p=t=>{a.shape2.x=t.x,a.shape2.y=t.y,i.add(["draggables"])},a.setAction.shape1x=t=>{a.shape1.x=t,i.add(["draggables"])},a.setXY1=t=>{const e=s.setForListSenders.shape1x.getCurrentValue(c);s.setForListSenders.shape1x.go(c,t.x,e)},a.setXY2=t=>{const e=s.setForListSenders.shape2p.getCurrentValue(c);s.setForListSenders.shape2p.go(c,t,e)},a.setAction.shape2w=t=>{a.shape2.w=t,i.add(["width"])},a.setW2=t=>{const e=s.setForListSenders.shape2w.getCurrentValue(c);s.setForListSenders.shape2w.go(c,t,e)},a.setAction.shape1w=t=>{a.shape1.w=t,i.add(["width"])},a.setW1=t=>{const e=s.setForListSenders.shape1w.getCurrentValue(c);s.setForListSenders.shape1w.go(c,t,e)},a.setAction.shape1densityProfile=t=>{a.shape1.densityProfile=t,i.add(["densityProfile"])},a.setDensityProfile1=t=>{const e=s.setForListSenders.shape1densityProfile.getCurrentValue(c);s.setForListSenders.shape1densityProfile.go(c,t,e)},a.instantiate(),a.color="#88888888"}function V(t,e,n){const o=this,i="voters";function r(n,r,s){o.setForListSenders[n]=e.addSenderForList({action:(e,i)=>{o.setNumberVoters(e+1);t.get(e).setAction[n](i)},name:`${i}-${r}`,props:{isChain:s}})}o.setForListSenders={},r("exists","exists",!1),r("shape2p","shape2D-point",!0),r("shape1x","shape1D-x",!0),r("shape2w","shape2D-width",!0),r("shape1w","shape1D-width",!0),r("shape1densityProfile","shape1D-densityProfile",!1),o.setNumberVotersSender=e.addSender({action:t=>n.setNumberVotersAction(t),currentValue:0,name:`${i}-setNumberAtLeast`,props:{isFirstAction:!0}}),o.setNumberVoters=t=>{e.loadCommands([o.setNumberVotersSender.command(t)])}}function R(t,e){return 1===e?t.map((t=>t.shape1)):t.map((t=>t.shape2))}function O(t,e){const n=this,o=new F,i=new V(o,e,n);n.addVoterPressed=()=>{const t=o.num()+1;i.setNumberVoters(t)},n.setNumberVotersAction=t=>{for(;o.num()<t;)n.addVoterCircle({x:50,y:50,w:200},{x:50,w:200,densityProfile:"gaussian"},!1)};const r=[];n.attachNewE=t=>{r.push(t)};n.addVoterCircle=(n,s,a)=>{const c=new L(n,s,o,e,t,a,i);var l;l=c,r.forEach((t=>t.updateNewE(l)));const u=o.num();i.setNumberVoters(u)},n.getVoterShapes=()=>o.getList().filter((t=>t.exists)),n.getGeoms=t=>R(n.getVoterShapes(),t)}const I=Math.round;function G(t){const e=t.length,n=Array(4).fill();if("rgb"===t.slice(0,3).toLowerCase()){const e=t.replace(" ","").split(",");n[0]=parseInt(e[0].slice("a"===e[3].toLowerCase()?5:4),10),n[1]=parseInt(e[1],10),n[2]=parseInt(e[2],10),n[3]=e[3]?parseFloat(e[3]):-1}else{let o;o=e<6?parseInt(String(t[1])+t[1]+t[2]+t[2]+t[3]+t[3]+(e>4?String(t[4])+t[4]:""),16):parseInt(t.slice(1),16),n[0]=o>>16&255,n[1]=o>>8&255,n[2]=255&o,n[3]=9===e||5===e?I((o>>24&255)/255*1e4)/1e4:-1}return n}function B(t,e,n,o,i,r,s,a){const c=this;c.shape1={},c.shape2={};const l=o.new(c);c.instantiate=()=>{const o={x:t.x,y:t.y},r=[a.setForListSenders.exists.command(l,1,0),a.setForListSenders.shape2p.command(l,o,o),a.setForListSenders.shape1x.command(l,e.x,e.x),a.setForListSenders.color.command(l,n,n),a.setForListSenders.party.command(l,[l],[l])];s?i.loadCommands(r):i.doCommands(r)},c.setAction={},c.setAction.exists=t=>{c.exists=t,r.add(["draggables"])},c.setE=t=>{const e=a.setForListSenders.exists.getCurrentValue(l);a.setForListSenders.exists.go(l,t,e)},c.setAction.shape2p=t=>{c.shape2.x=t.x,c.shape2.y=t.y,r.add(["draggables"])},c.setAction.shape1x=t=>{c.shape1.x=t,r.add(["draggables"])},c.setXY1=t=>{const e=a.setForListSenders.shape1x.getCurrentValue(l);a.setForListSenders.shape1x.go(l,t.x,e)},c.setXY2=t=>{const e=a.setForListSenders.shape2p.getCurrentValue(l);a.setForListSenders.shape2p.go(l,t,e)},c.setAction.color=t=>{c.color=t,c.colorRGBA=G(t),r.add(["color"])},c.setColor=t=>{const e=a.setForListSenders.color.getCurrentValue(l);a.setForListSenders.color.go(l,t,e)},c.setAction.party=t=>{c.party=t,r.add(["party"])},c.setParty=t=>{const e=a.setForListSenders.party.getCurrentValue(l);a.setForListSenders.party.go(l,t,e)},c.instantiate()}function q(t,e,n){const o=this,i="candidates";function r(n,r,s){o.setForListSenders[n]=e.addSenderForList({action:(e,i)=>{o.setNumberCandidates(e+1);t.get(e).setAction[n](i)},name:`${i}-${r}`,props:{isChain:s}})}o.setForListSenders={},r("exists","exists",!1),r("shape2p","shape2D-point",!0),r("shape1x","shape1D-x",!0),r("color","color",!1),r("party","party",!1),o.setNumberCandidatesSender=e.addSender({action:t=>{n.setNumberCandidatesAction(t)},currentValue:0,name:`${i}-setNumberAtLeast`,props:{isFirstAction:!0}}),o.setNumberCandidates=t=>{e.loadCommands([o.setNumberCandidatesSender.command(t)])}}function j(t,e){const n=this,o=new F,i=new q(o,e,n);n.addCandidatePressed=()=>{const t=o.num()+1;i.setNumberCandidates(t)},n.setNumberCandidatesAction=t=>{for(;o.num()<t;){const t=a("yellow");n.addCandidate({x:50,y:50},{x:50},t,!1)}};const r=[];n.attachNewE=t=>{r.push(t)};n.addCandidate=(n,s,a,c)=>{const l=new B(n,s,a,o,e,t,c,i);var u;u=l,r.forEach((t=>t.updateNewE(u)));const h=o.num();i.setNumberCandidates(h)},n.getCandidates=()=>o.getList().filter((t=>t.exists)),n.getGeoms=t=>R(n.getCandidates(),t),n.getParties=()=>{const t=function(t){return t.map((t=>t.party[0]))}(n.getCandidates());return{partiesByCan:t,numParties:10}},n.getRGBAList=()=>n.getCandidates().map((t=>t.colorRGBA))}function H(t,e,n,o,i,r,s){const a=this;a.shape2={},a.shape1={};const c=n.new(a);a.instantiate=()=>{const n={x:t.x,y:t.y},i=[s.setForListSenders.exists.command(c,1,0),s.setForListSenders.shape2p.command(c,n,n),s.setForListSenders.shape1x.command(c,e.x,e.x),s.setForListSenders.shape2w.command(c,t.w,t.w),s.setForListSenders.shape1w.command(c,e.w,e.w),s.setForListSenders.shape1densityProfile.command(c,e.densityProfile,e.densityProfile),s.setForListSenders.party.command(c,[c],[c])];r?o.loadCommands(i):o.doCommands(i)},a.setAction={},a.setAction.exists=t=>{a.exists=t,i.add(["draggables"])},a.setE=t=>{const e=s.setForListSenders.exists.getCurrentValue(c);s.setForListSenders.exists.go(c,t,e)},a.setAction.shape2p=t=>{a.shape2.x=t.x,a.shape2.y=t.y,i.add(["draggables"])},a.setAction.shape1x=t=>{a.shape1.x=t,i.add(["draggables"])},a.setXY1=t=>{const e=s.setForListSenders.shape1x.getCurrentValue(c);s.setForListSenders.shape1x.go(c,t.x,e)},a.setXY2=t=>{const e=s.setForListSenders.shape2p.getCurrentValue(c);s.setForListSenders.shape2p.go(c,t,e)},a.setAction.shape2w=t=>{a.shape2.w=t,i.add(["width"])},a.setW2=t=>{const e=s.setForListSenders.shape2w.getCurrentValue(c);s.setForListSenders.shape2w.go(c,t,e)},a.setAction.shape1w=t=>{a.shape1.w=t,i.add(["width"])},a.setW1=t=>{const e=s.setForListSenders.shape1w.getCurrentValue(c);s.setForListSenders.shape1w.go(c,t,e)},a.setAction.shape1densityProfile=t=>{a.shape1.densityProfile=t,i.add(["densityProfile"])},a.setDensityProfile1=t=>{const e=s.setForListSenders.shape1densityProfile.getCurrentValue(c);s.setForListSenders.shape1densityProfile.go(c,t,e)},a.setAction.party=t=>{a.party=t,i.add(["party"])},a.setParty=t=>{const e=s.setForListSenders.party.getCurrentValue(c);s.setForListSenders.party.go(c,t,e)},a.instantiate(),a.color="#ccc",a.darkModeColor="#333"}function U(t,e,n){const o=this,i="candidateDns";function r(n,r,s){o.setForListSenders[n]=e.addSenderForList({action:(e,i)=>{o.setNumberCandidateDns(e+1);t.get(e).setAction[n](i)},name:`${i}-${r}`,props:{isChain:s}})}o.setForListSenders={},r("exists","exists",!1),r("shape2p","shape2D-point",!0),r("shape1x","shape1D-x",!0),r("shape2w","shape2D-width",!0),r("shape1w","shape1D-width",!0),r("shape1densityProfile","shape1D-densityProfile",!1),r("party","party",!1),o.setNumberCandidateDnsSender=e.addSender({action:t=>{n.setNumberCandidateDnsAction(t)},currentValue:0,name:`${i}-setNumberAtLeast`,props:{isFirstAction:!0}}),o.setNumberCandidateDns=t=>{e.loadCommands([o.setNumberCandidateDnsSender.command(t)])}}function $(t,e){const n=this,o=new F,i=new U(o,e,n);n.addCandidateDistributionPressed=()=>{const t=o.num()+1;i.setNumberCandidateDns(t)},n.setNumberCandidateDnsAction=t=>{for(;o.num()<t;)n.addCandidateDistribution({x:50,y:50,w:200},{x:50,w:200,densityProfile:"gaussian"},!1)};const r=[];n.attachNewE=t=>{r.push(t)};n.addCandidateDistribution=(n,s,a)=>{const c=new H(n,s,o,e,t,a,i);var l;l=c,r.forEach((t=>t.updateNewE(l)));const u=o.num();i.setNumberCandidateDns(u)},n.getCandidateDistributions=()=>o.getList().filter((t=>t.exists)),n.getGeoms=t=>R(n.getCandidateDistributions(),t),n.getParties=()=>{const t=function(t){return t.map((t=>t.party[0]))}(n.getCandidateDistributions());return{partiesByCan:t,numParties:10}}}function W(t,e){const n=this;n.candidateList=new j(t,e,n),n.voterShapeList=new O(t,e,n),n.candidateDnList=new $(t,e,n)}const z=.5*(Math.sqrt(3)-1),X=(3-Math.sqrt(3))/6,Y=1/6,J=(Math.sqrt(5)-1)/4,K=(5-Math.sqrt(5))/20,Q=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),Z=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);class tt{constructor(t=Math.random){const e="function"==typeof t?t:function(t){let e=0,n=0,o=0,i=1;const r=function(){let t=4022871197;return function(e){e=e.toString();for(let n=0;n<e.length;n++){t+=e.charCodeAt(n);let o=.02519603282416938*t;t=o>>>0,o-=t,o*=t,t=o>>>0,o-=t,t+=4294967296*o}return 2.3283064365386963e-10*(t>>>0)}}();e=r(" "),n=r(" "),o=r(" "),e-=r(t),e<0&&(e+=1);n-=r(t),n<0&&(n+=1);o-=r(t),o<0&&(o+=1);return function(){const t=2091639*e+2.3283064365386963e-10*i;return e=n,n=o,o=t-(i=0|t)}}(t);this.p=function(t){const e=new Uint8Array(256);for(let t=0;t<256;t++)e[t]=t;for(let n=0;n<255;n++){const o=n+~~(t()*(256-n)),i=e[n];e[n]=e[o],e[o]=i}return e}(e),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let t=0;t<512;t++)this.perm[t]=this.p[255&t],this.permMod12[t]=this.perm[t]%12}noise2D(t,e){const n=this.permMod12,o=this.perm;let i=0,r=0,s=0;const a=(t+e)*z,c=Math.floor(t+a),l=Math.floor(e+a),u=(c+l)*X,h=t-(c-u),d=e-(l-u);let f,p;h>d?(f=1,p=0):(f=0,p=1);const m=h-f+X,g=d-p+X,y=h-1+2*X,w=d-1+2*X,v=255&c,_=255&l;let x=.5-h*h-d*d;if(x>=0){const t=3*n[v+o[_]];x*=x,i=x*x*(Q[t]*h+Q[t+1]*d)}let b=.5-m*m-g*g;if(b>=0){const t=3*n[v+f+o[_+p]];b*=b,r=b*b*(Q[t]*m+Q[t+1]*g)}let C=.5-y*y-w*w;if(C>=0){const t=3*n[v+1+o[_+1]];C*=C,s=C*C*(Q[t]*y+Q[t+1]*w)}return 70*(i+r+s)}noise3D(t,e,n){const o=this.permMod12,i=this.perm;let r,s,a,c;const l=.3333333333333333*(t+e+n),u=Math.floor(t+l),h=Math.floor(e+l),d=Math.floor(n+l),f=(u+h+d)*Y,p=t-(u-f),m=e-(h-f),g=n-(d-f);let y,w,v,_,x,b;p>=m?m>=g?(y=1,w=0,v=0,_=1,x=1,b=0):p>=g?(y=1,w=0,v=0,_=1,x=0,b=1):(y=0,w=0,v=1,_=1,x=0,b=1):m<g?(y=0,w=0,v=1,_=0,x=1,b=1):p<g?(y=0,w=1,v=0,_=0,x=1,b=1):(y=0,w=1,v=0,_=1,x=1,b=0);const C=p-y+Y,S=m-w+Y,k=g-v+Y,A=p-_+.3333333333333333,M=m-x+.3333333333333333,E=g-b+.3333333333333333,T=p-1+.5,P=m-1+.5,D=g-1+.5,N=255&u,F=255&h,L=255&d;let V=.6-p*p-m*m-g*g;if(V<0)r=0;else{const t=3*o[N+i[F+i[L]]];V*=V,r=V*V*(Q[t]*p+Q[t+1]*m+Q[t+2]*g)}let R=.6-C*C-S*S-k*k;if(R<0)s=0;else{const t=3*o[N+y+i[F+w+i[L+v]]];R*=R,s=R*R*(Q[t]*C+Q[t+1]*S+Q[t+2]*k)}let O=.6-A*A-M*M-E*E;if(O<0)a=0;else{const t=3*o[N+_+i[F+x+i[L+b]]];O*=O,a=O*O*(Q[t]*A+Q[t+1]*M+Q[t+2]*E)}let I=.6-T*T-P*P-D*D;if(I<0)c=0;else{const t=3*o[N+1+i[F+1+i[L+1]]];I*=I,c=I*I*(Q[t]*T+Q[t+1]*P+Q[t+2]*D)}return 32*(r+s+a+c)}noise4D(t,e,n,o){const i=this.perm;let r,s,a,c,l;const u=(t+e+n+o)*J,h=Math.floor(t+u),d=Math.floor(e+u),f=Math.floor(n+u),p=Math.floor(o+u),m=(h+d+f+p)*K,g=t-(h-m),y=e-(d-m),w=n-(f-m),v=o-(p-m);let _=0,x=0,b=0,C=0;g>y?_++:x++,g>w?_++:b++,g>v?_++:C++,y>w?x++:b++,y>v?x++:C++,w>v?b++:C++;const S=_>=3?1:0,k=x>=3?1:0,A=b>=3?1:0,M=C>=3?1:0,E=_>=2?1:0,T=x>=2?1:0,P=b>=2?1:0,D=C>=2?1:0,N=_>=1?1:0,F=x>=1?1:0,L=b>=1?1:0,V=C>=1?1:0,R=g-S+K,O=y-k+K,I=w-A+K,G=v-M+K,B=g-E+2*K,q=y-T+2*K,j=w-P+2*K,H=v-D+2*K,U=g-N+3*K,$=y-F+3*K,W=w-L+3*K,z=v-V+3*K,X=g-1+4*K,Y=y-1+4*K,Q=w-1+4*K,tt=v-1+4*K,et=255&h,nt=255&d,ot=255&f,it=255&p;let rt=.6-g*g-y*y-w*w-v*v;if(rt<0)r=0;else{const t=i[et+i[nt+i[ot+i[it]]]]%32*4;rt*=rt,r=rt*rt*(Z[t]*g+Z[t+1]*y+Z[t+2]*w+Z[t+3]*v)}let st=.6-R*R-O*O-I*I-G*G;if(st<0)s=0;else{const t=i[et+S+i[nt+k+i[ot+A+i[it+M]]]]%32*4;st*=st,s=st*st*(Z[t]*R+Z[t+1]*O+Z[t+2]*I+Z[t+3]*G)}let at=.6-B*B-q*q-j*j-H*H;if(at<0)a=0;else{const t=i[et+E+i[nt+T+i[ot+P+i[it+D]]]]%32*4;at*=at,a=at*at*(Z[t]*B+Z[t+1]*q+Z[t+2]*j+Z[t+3]*H)}let ct=.6-U*U-$*$-W*W-z*z;if(ct<0)c=0;else{const t=i[et+N+i[nt+F+i[ot+L+i[it+V]]]]%32*4;ct*=ct,c=ct*ct*(Z[t]*U+Z[t+1]*$+Z[t+2]*W+Z[t+3]*z)}let lt=.6-X*X-Y*Y-Q*Q-tt*tt;if(lt<0)l=0;else{const t=i[et+1+i[nt+1+i[ot+1+i[it+1]]]]%32*4;lt*=lt,l=lt*lt*(Z[t]*X+Z[t+1]*Y+Z[t+2]*Q+Z[t+3]*tt)}return 27*(r+s+a+c+l)}}function et(t,e){const n=this;n.sn=[];n.genNoise=()=>{n.sn=function(t,e,n,o,i,r){const s=new tt("s"),a=new tt("seed"),c=function(t,e){const n=Array(t).fill().map((()=>Array(e).fill().map((()=>Array(2).fill(0)))));return n}(t,e);let l=0,u=0;nt(t).forEach((i=>{nt(e).forEach((r=>{const h=i/t*(1/n),d=r/e*(1/o),f=s.noise2D(h,d),p=a.noise2D(h,d);c[i][r][0]=f-.5,c[i][r][1]=p-.5,l+=f,u+=p}))}));const h=l/(t*e)-.5,d=u/(t*e)-.5;return c.forEach((t=>{t.forEach((t=>{t[0]=(t[0]-h)*i,t[1]=(t[1]-d)*r}))})),c}(t,e,.5,.5,100,100)}}function nt(t){return[...Array(t).keys()]}function ot(t){for(var e,n=-1,o=t.length,i=t[o-1],r=0;++n<o;)e=i,i=t[n],r+=e[1]*i[0]-e[0]*i[1];return r/2}function it(t){for(var e,n,o=-1,i=t.length,r=0,s=0,a=t[i-1],c=0;++o<i;)e=a,a=t[o],c+=n=e[0]*a[1]-a[0]*e[1],r+=(e[0]+a[0])*n,s+=(e[1]+a[1])*n;return[r/(c*=3),s/c]}const rt=134217729;function st(t,e,n,o,i){let r,s,a,c,l=e[0],u=o[0],h=0,d=0;u>l==u>-l?(r=l,l=e[++h]):(r=u,u=o[++d]);let f=0;if(h<t&&d<n)for(u>l==u>-l?(s=l+r,a=r-(s-l),l=e[++h]):(s=u+r,a=r-(s-u),u=o[++d]),r=s,0!==a&&(i[f++]=a);h<t&&d<n;)u>l==u>-l?(s=r+l,c=s-r,a=r-(s-c)+(l-c),l=e[++h]):(s=r+u,c=s-r,a=r-(s-c)+(u-c),u=o[++d]),r=s,0!==a&&(i[f++]=a);for(;h<t;)s=r+l,c=s-r,a=r-(s-c)+(l-c),l=e[++h],r=s,0!==a&&(i[f++]=a);for(;d<n;)s=r+u,c=s-r,a=r-(s-c)+(u-c),u=o[++d],r=s,0!==a&&(i[f++]=a);return 0===r&&0!==f||(i[f++]=r),f}function at(t){return new Float64Array(t)}const ct=at(4),lt=at(8),ut=at(12),ht=at(16),dt=at(4);function ft(t,e,n,o,i,r){const s=(e-r)*(n-i),a=(t-i)*(o-r),c=s-a;if(0===s||0===a||s>0!=a>0)return c;const l=Math.abs(s+a);return Math.abs(c)>=33306690738754716e-32*l?c:-function(t,e,n,o,i,r,s){let a,c,l,u,h,d,f,p,m,g,y,w,v,_,x,b,C,S;const k=t-i,A=n-i,M=e-r,E=o-r;_=k*E,d=rt*k,f=d-(d-k),p=k-f,d=rt*E,m=d-(d-E),g=E-m,x=p*g-(_-f*m-p*m-f*g),b=M*A,d=rt*M,f=d-(d-M),p=M-f,d=rt*A,m=d-(d-A),g=A-m,C=p*g-(b-f*m-p*m-f*g),y=x-C,h=x-y,ct[0]=x-(y+h)+(h-C),w=_+y,h=w-_,v=_-(w-h)+(y-h),y=v-b,h=v-y,ct[1]=v-(y+h)+(h-b),S=w+y,h=S-w,ct[2]=w-(S-h)+(y-h),ct[3]=S;let T=function(t,e){let n=e[0];for(let o=1;o<t;o++)n+=e[o];return n}(4,ct),P=22204460492503146e-32*s;if(T>=P||-T>=P)return T;if(h=t-k,a=t-(k+h)+(h-i),h=n-A,l=n-(A+h)+(h-i),h=e-M,c=e-(M+h)+(h-r),h=o-E,u=o-(E+h)+(h-r),0===a&&0===c&&0===l&&0===u)return T;if(P=11093356479670487e-47*s+33306690738754706e-32*Math.abs(T),T+=k*u+E*a-(M*l+A*c),T>=P||-T>=P)return T;_=a*E,d=rt*a,f=d-(d-a),p=a-f,d=rt*E,m=d-(d-E),g=E-m,x=p*g-(_-f*m-p*m-f*g),b=c*A,d=rt*c,f=d-(d-c),p=c-f,d=rt*A,m=d-(d-A),g=A-m,C=p*g-(b-f*m-p*m-f*g),y=x-C,h=x-y,dt[0]=x-(y+h)+(h-C),w=_+y,h=w-_,v=_-(w-h)+(y-h),y=v-b,h=v-y,dt[1]=v-(y+h)+(h-b),S=w+y,h=S-w,dt[2]=w-(S-h)+(y-h),dt[3]=S;const D=st(4,ct,4,dt,lt);_=k*u,d=rt*k,f=d-(d-k),p=k-f,d=rt*u,m=d-(d-u),g=u-m,x=p*g-(_-f*m-p*m-f*g),b=M*l,d=rt*M,f=d-(d-M),p=M-f,d=rt*l,m=d-(d-l),g=l-m,C=p*g-(b-f*m-p*m-f*g),y=x-C,h=x-y,dt[0]=x-(y+h)+(h-C),w=_+y,h=w-_,v=_-(w-h)+(y-h),y=v-b,h=v-y,dt[1]=v-(y+h)+(h-b),S=w+y,h=S-w,dt[2]=w-(S-h)+(y-h),dt[3]=S;const N=st(D,lt,4,dt,ut);_=a*u,d=rt*a,f=d-(d-a),p=a-f,d=rt*u,m=d-(d-u),g=u-m,x=p*g-(_-f*m-p*m-f*g),b=c*l,d=rt*c,f=d-(d-c),p=c-f,d=rt*l,m=d-(d-l),g=l-m,C=p*g-(b-f*m-p*m-f*g),y=x-C,h=x-y,dt[0]=x-(y+h)+(h-C),w=_+y,h=w-_,v=_-(w-h)+(y-h),y=v-b,h=v-y,dt[1]=v-(y+h)+(h-b),S=w+y,h=S-w,dt[2]=w-(S-h)+(y-h),dt[3]=S;const F=st(N,ut,4,dt,ht);return ht[F-1]}(t,e,n,o,i,r,l)}const pt=Math.pow(2,-52),mt=new Uint32Array(512);class gt{static from(t,e=bt,n=Ct){const o=t.length,i=new Float64Array(2*o);for(let r=0;r<o;r++){const o=t[r];i[2*r]=e(o),i[2*r+1]=n(o)}return new gt(i)}constructor(t){const e=t.length>>1;if(e>0&&"number"!=typeof t[0])throw new Error("Expected coords to contain numbers.");this.coords=t;const n=Math.max(2*e-5,0);this._triangles=new Uint32Array(3*n),this._halfedges=new Int32Array(3*n),this._hashSize=Math.ceil(Math.sqrt(e)),this._hullPrev=new Uint32Array(e),this._hullNext=new Uint32Array(e),this._hullTri=new Uint32Array(e),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(e),this._dists=new Float64Array(e),this.update()}update(){const{coords:t,_hullPrev:e,_hullNext:n,_hullTri:o,_hullHash:i}=this,r=t.length>>1;let s=1/0,a=1/0,c=-1/0,l=-1/0;for(let e=0;e<r;e++){const n=t[2*e],o=t[2*e+1];n<s&&(s=n),o<a&&(a=o),n>c&&(c=n),o>l&&(l=o),this._ids[e]=e}const u=(s+c)/2,h=(a+l)/2;let d,f,p,m=1/0;for(let e=0;e<r;e++){const n=yt(u,h,t[2*e],t[2*e+1]);n<m&&(d=e,m=n)}const g=t[2*d],y=t[2*d+1];m=1/0;for(let e=0;e<r;e++){if(e===d)continue;const n=yt(g,y,t[2*e],t[2*e+1]);n<m&&n>0&&(f=e,m=n)}let w=t[2*f],v=t[2*f+1],_=1/0;for(let e=0;e<r;e++){if(e===d||e===f)continue;const n=vt(g,y,w,v,t[2*e],t[2*e+1]);n<_&&(p=e,_=n)}let x=t[2*p],b=t[2*p+1];if(_===1/0){for(let e=0;e<r;e++)this._dists[e]=t[2*e]-t[0]||t[2*e+1]-t[1];_t(this._ids,this._dists,0,r-1);const e=new Uint32Array(r);let n=0;for(let t=0,o=-1/0;t<r;t++){const i=this._ids[t];this._dists[i]>o&&(e[n++]=i,o=this._dists[i])}return this.hull=e.subarray(0,n),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(ft(g,y,w,v,x,b)<0){const t=f,e=w,n=v;f=p,w=x,v=b,p=t,x=e,b=n}const C=function(t,e,n,o,i,r){const s=n-t,a=o-e,c=i-t,l=r-e,u=s*s+a*a,h=c*c+l*l,d=.5/(s*l-a*c);return{x:t+(l*u-a*h)*d,y:e+(s*h-c*u)*d}}(g,y,w,v,x,b);this._cx=C.x,this._cy=C.y;for(let e=0;e<r;e++)this._dists[e]=yt(t[2*e],t[2*e+1],C.x,C.y);_t(this._ids,this._dists,0,r-1),this._hullStart=d;let S=3;n[d]=e[p]=f,n[f]=e[d]=p,n[p]=e[f]=d,o[d]=0,o[f]=1,o[p]=2,i.fill(-1),i[this._hashKey(g,y)]=d,i[this._hashKey(w,v)]=f,i[this._hashKey(x,b)]=p,this.trianglesLen=0,this._addTriangle(d,f,p,-1,-1,-1);for(let r,s,a=0;a<this._ids.length;a++){const c=this._ids[a],l=t[2*c],u=t[2*c+1];if(a>0&&Math.abs(l-r)<=pt&&Math.abs(u-s)<=pt)continue;if(r=l,s=u,c===d||c===f||c===p)continue;let h=0;for(let t=0,e=this._hashKey(l,u);t<this._hashSize&&(h=i[(e+t)%this._hashSize],-1===h||h===n[h]);t++);h=e[h];let m,g=h;for(;m=n[g],ft(l,u,t[2*g],t[2*g+1],t[2*m],t[2*m+1])>=0;)if(g=m,g===h){g=-1;break}if(-1===g)continue;let y=this._addTriangle(g,c,n[g],-1,-1,o[g]);o[c]=this._legalize(y+2),o[g]=y,S++;let w=n[g];for(;m=n[w],ft(l,u,t[2*w],t[2*w+1],t[2*m],t[2*m+1])<0;)y=this._addTriangle(w,c,m,o[c],-1,o[w]),o[c]=this._legalize(y+2),n[w]=w,S--,w=m;if(g===h)for(;m=e[g],ft(l,u,t[2*m],t[2*m+1],t[2*g],t[2*g+1])<0;)y=this._addTriangle(m,c,g,-1,o[g],o[m]),this._legalize(y+2),o[m]=y,n[g]=g,S--,g=m;this._hullStart=e[c]=g,n[g]=e[w]=c,n[c]=w,i[this._hashKey(l,u)]=c,i[this._hashKey(t[2*g],t[2*g+1])]=g}this.hull=new Uint32Array(S);for(let t=0,e=this._hullStart;t<S;t++)this.hull[t]=e,e=n[e];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,e){return Math.floor(function(t,e){const n=t/(Math.abs(t)+Math.abs(e));return(e>0?3-n:1+n)/4}(t-this._cx,e-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:e,_halfedges:n,coords:o}=this;let i=0,r=0;for(;;){const s=n[t],a=t-t%3;if(r=a+(t+2)%3,-1===s){if(0===i)break;t=mt[--i];continue}const c=s-s%3,l=a+(t+1)%3,u=c+(s+2)%3,h=e[r],d=e[t],f=e[l],p=e[u];if(wt(o[2*h],o[2*h+1],o[2*d],o[2*d+1],o[2*f],o[2*f+1],o[2*p],o[2*p+1])){e[t]=p,e[s]=h;const o=n[u];if(-1===o){let e=this._hullStart;do{if(this._hullTri[e]===u){this._hullTri[e]=t;break}e=this._hullPrev[e]}while(e!==this._hullStart)}this._link(t,o),this._link(s,n[r]),this._link(r,u);const a=c+(s+1)%3;i<mt.length&&(mt[i++]=a)}else{if(0===i)break;t=mt[--i]}}return r}_link(t,e){this._halfedges[t]=e,-1!==e&&(this._halfedges[e]=t)}_addTriangle(t,e,n,o,i,r){const s=this.trianglesLen;return this._triangles[s]=t,this._triangles[s+1]=e,this._triangles[s+2]=n,this._link(s,o),this._link(s+1,i),this._link(s+2,r),this.trianglesLen+=3,s}}function yt(t,e,n,o){const i=t-n,r=e-o;return i*i+r*r}function wt(t,e,n,o,i,r,s,a){const c=t-s,l=e-a,u=n-s,h=o-a,d=i-s,f=r-a,p=u*u+h*h,m=d*d+f*f;return c*(h*m-p*f)-l*(u*m-p*d)+(c*c+l*l)*(u*f-h*d)<0}function vt(t,e,n,o,i,r){const s=n-t,a=o-e,c=i-t,l=r-e,u=s*s+a*a,h=c*c+l*l,d=.5/(s*l-a*c),f=(l*u-a*h)*d,p=(s*h-c*u)*d;return f*f+p*p}function _t(t,e,n,o){if(o-n<=20)for(let i=n+1;i<=o;i++){const o=t[i],r=e[o];let s=i-1;for(;s>=n&&e[t[s]]>r;)t[s+1]=t[s--];t[s+1]=o}else{let i=n+1,r=o;xt(t,n+o>>1,i),e[t[n]]>e[t[o]]&&xt(t,n,o),e[t[i]]>e[t[o]]&&xt(t,i,o),e[t[n]]>e[t[i]]&&xt(t,n,i);const s=t[i],a=e[s];for(;;){do{i++}while(e[t[i]]<a);do{r--}while(e[t[r]]>a);if(r<i)break;xt(t,i,r)}t[n+1]=t[r],t[r]=s,o-i+1>=r-n?(_t(t,e,i,o),_t(t,e,n,r-1)):(_t(t,e,n,r-1),_t(t,e,i,o))}}function xt(t,e,n){const o=t[e];t[e]=t[n],t[n]=o}function bt(t){return t[0]}function Ct(t){return t[1]}const St=1e-6;class kt{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,e){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,e){this._+=`L${this._x1=+t},${this._y1=+e}`}arc(t,e,n){const o=(t=+t)+(n=+n),i=e=+e;if(n<0)throw new Error("negative radius");null===this._x1?this._+=`M${o},${i}`:(Math.abs(this._x1-o)>St||Math.abs(this._y1-i)>St)&&(this._+="L"+o+","+i),n&&(this._+=`A${n},${n},0,1,1,${t-n},${e}A${n},${n},0,1,1,${this._x1=o},${this._y1=i}`)}rect(t,e,n,o){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}h${+n}v${+o}h${-n}Z`}value(){return this._||null}}class At{constructor(){this._=[]}moveTo(t,e){this._.push([t,e])}closePath(){this._.push(this._[0].slice())}lineTo(t,e){this._.push([t,e])}value(){return this._.length?this._:null}}class Mt{constructor(t,[e,n,o,i]=[0,0,960,500]){if(!((o=+o)>=(e=+e)&&(i=+i)>=(n=+n)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(2*t.points.length),this.vectors=new Float64Array(2*t.points.length),this.xmax=o,this.xmin=e,this.ymax=i,this.ymin=n,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:e,triangles:n},vectors:o}=this,i=this.circumcenters=this._circumcenters.subarray(0,n.length/3*2);for(let e,o,r=0,s=0,a=n.length;r<a;r+=3,s+=2){const a=2*n[r],c=2*n[r+1],l=2*n[r+2],u=t[a],h=t[a+1],d=t[c],f=t[c+1],p=t[l],m=t[l+1],g=d-u,y=f-h,w=p-u,v=m-h,_=2*(g*v-y*w);if(Math.abs(_)<1e-9){let i=1e9;const r=2*n[0];i*=Math.sign((t[r]-u)*v-(t[r+1]-h)*w),e=(u+p)/2-i*v,o=(h+m)/2+i*w}else{const t=1/_,n=g*g+y*y,i=w*w+v*v;e=u+(v*n-y*i)*t,o=h+(g*i-w*n)*t}i[s]=e,i[s+1]=o}let r,s,a,c=e[e.length-1],l=4*c,u=t[2*c],h=t[2*c+1];o.fill(0);for(let n=0;n<e.length;++n)c=e[n],r=l,s=u,a=h,l=4*c,u=t[2*c],h=t[2*c+1],o[r+2]=o[l]=a-h,o[r+3]=o[l+1]=u-s}render(t){const e=null==t?t=new kt:void 0,{delaunay:{halfedges:n,inedges:o,hull:i},circumcenters:r,vectors:s}=this;if(i.length<=1)return null;for(let e=0,o=n.length;e<o;++e){const o=n[e];if(o<e)continue;const i=2*Math.floor(e/3),s=2*Math.floor(o/3),a=r[i],c=r[i+1],l=r[s],u=r[s+1];this._renderSegment(a,c,l,u,t)}let a,c=i[i.length-1];for(let e=0;e<i.length;++e){a=c,c=i[e];const n=2*Math.floor(o[c]/3),l=r[n],u=r[n+1],h=4*a,d=this._project(l,u,s[h+2],s[h+3]);d&&this._renderSegment(l,u,d[0],d[1],t)}return e&&e.value()}renderBounds(t){const e=null==t?t=new kt:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),e&&e.value()}renderCell(t,e){const n=null==e?e=new kt:void 0,o=this._clip(t);if(null===o||!o.length)return;e.moveTo(o[0],o[1]);let i=o.length;for(;o[0]===o[i-2]&&o[1]===o[i-1]&&i>1;)i-=2;for(let t=2;t<i;t+=2)o[t]===o[t-2]&&o[t+1]===o[t-1]||e.lineTo(o[t],o[t+1]);return e.closePath(),n&&n.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let e=0,n=t.length/2;e<n;++e){const t=this.cellPolygon(e);t&&(t.index=e,yield t)}}cellPolygon(t){const e=new At;return this.renderCell(t,e),e.value()}_renderSegment(t,e,n,o,i){let r;const s=this._regioncode(t,e),a=this._regioncode(n,o);0===s&&0===a?(i.moveTo(t,e),i.lineTo(n,o)):(r=this._clipSegment(t,e,n,o,s,a))&&(i.moveTo(r[0],r[1]),i.lineTo(r[2],r[3]))}contains(t,e,n){return(e=+e)==e&&(n=+n)==n&&this.delaunay._step(t,e,n)===t}*neighbors(t){const e=this._clip(t);if(e)for(const n of this.delaunay.neighbors(t)){const t=this._clip(n);if(t)t:for(let o=0,i=e.length;o<i;o+=2)for(let r=0,s=t.length;r<s;r+=2)if(e[o]==t[r]&&e[o+1]==t[r+1]&&e[(o+2)%i]==t[(r+s-2)%s]&&e[(o+3)%i]==t[(r+s-1)%s]){yield n;break t}}}_cell(t){const{circumcenters:e,delaunay:{inedges:n,halfedges:o,triangles:i}}=this,r=n[t];if(-1===r)return null;const s=[];let a=r;do{const n=Math.floor(a/3);if(s.push(e[2*n],e[2*n+1]),a=a%3==2?a-2:a+1,i[a]!==t)break;a=o[a]}while(a!==r&&-1!==a);return s}_clip(t){if(0===t&&1===this.delaunay.hull.length)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const e=this._cell(t);if(null===e)return null;const{vectors:n}=this,o=4*t;return n[o]||n[o+1]?this._clipInfinite(t,e,n[o],n[o+1],n[o+2],n[o+3]):this._clipFinite(t,e)}_clipFinite(t,e){const n=e.length;let o,i,r,s,a=null,c=e[n-2],l=e[n-1],u=this._regioncode(c,l),h=0;for(let d=0;d<n;d+=2)if(o=c,i=l,c=e[d],l=e[d+1],r=u,u=this._regioncode(c,l),0===r&&0===u)s=h,h=0,a?a.push(c,l):a=[c,l];else{let e,n,d,f,p;if(0===r){if(null===(e=this._clipSegment(o,i,c,l,r,u)))continue;[n,d,f,p]=e}else{if(null===(e=this._clipSegment(c,l,o,i,u,r)))continue;[f,p,n,d]=e,s=h,h=this._edgecode(n,d),s&&h&&this._edge(t,s,h,a,a.length),a?a.push(n,d):a=[n,d]}s=h,h=this._edgecode(f,p),s&&h&&this._edge(t,s,h,a,a.length),a?a.push(f,p):a=[f,p]}if(a)s=h,h=this._edgecode(a[0],a[1]),s&&h&&this._edge(t,s,h,a,a.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return a}_clipSegment(t,e,n,o,i,r){for(;;){if(0===i&&0===r)return[t,e,n,o];if(i&r)return null;let s,a,c=i||r;8&c?(s=t+(n-t)*(this.ymax-e)/(o-e),a=this.ymax):4&c?(s=t+(n-t)*(this.ymin-e)/(o-e),a=this.ymin):2&c?(a=e+(o-e)*(this.xmax-t)/(n-t),s=this.xmax):(a=e+(o-e)*(this.xmin-t)/(n-t),s=this.xmin),i?(t=s,e=a,i=this._regioncode(t,e)):(n=s,o=a,r=this._regioncode(n,o))}}_clipInfinite(t,e,n,o,i,r){let s,a=Array.from(e);if((s=this._project(a[0],a[1],n,o))&&a.unshift(s[0],s[1]),(s=this._project(a[a.length-2],a[a.length-1],i,r))&&a.push(s[0],s[1]),a=this._clipFinite(t,a))for(let e,n=0,o=a.length,i=this._edgecode(a[o-2],a[o-1]);n<o;n+=2)e=i,i=this._edgecode(a[n],a[n+1]),e&&i&&(n=this._edge(t,e,i,a,n),o=a.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(a=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return a}_edge(t,e,n,o,i){for(;e!==n;){let n,r;switch(e){case 5:e=4;continue;case 4:e=6,n=this.xmax,r=this.ymin;break;case 6:e=2;continue;case 2:e=10,n=this.xmax,r=this.ymax;break;case 10:e=8;continue;case 8:e=9,n=this.xmin,r=this.ymax;break;case 9:e=1;continue;case 1:e=5,n=this.xmin,r=this.ymin}o[i]===n&&o[i+1]===r||!this.contains(t,n,r)||(o.splice(i,0,n,r),i+=2)}if(o.length>4)for(let t=0;t<o.length;t+=2){const e=(t+2)%o.length,n=(t+4)%o.length;(o[t]===o[e]&&o[e]===o[n]||o[t+1]===o[e+1]&&o[e+1]===o[n+1])&&(o.splice(e,2),t-=2)}return i}_project(t,e,n,o){let i,r,s,a=1/0;if(o<0){if(e<=this.ymin)return null;(i=(this.ymin-e)/o)<a&&(s=this.ymin,r=t+(a=i)*n)}else if(o>0){if(e>=this.ymax)return null;(i=(this.ymax-e)/o)<a&&(s=this.ymax,r=t+(a=i)*n)}if(n>0){if(t>=this.xmax)return null;(i=(this.xmax-t)/n)<a&&(r=this.xmax,s=e+(a=i)*o)}else if(n<0){if(t<=this.xmin)return null;(i=(this.xmin-t)/n)<a&&(r=this.xmin,s=e+(a=i)*o)}return[r,s]}_edgecode(t,e){return(t===this.xmin?1:t===this.xmax?2:0)|(e===this.ymin?4:e===this.ymax?8:0)}_regioncode(t,e){return(t<this.xmin?1:t>this.xmax?2:0)|(e<this.ymin?4:e>this.ymax?8:0)}}const Et=2*Math.PI,Tt=Math.pow;function Pt(t){return t[0]}function Dt(t){return t[1]}function Nt(t,e,n){return[t+Math.sin(t+e)*n,e+Math.cos(t-e)*n]}class Ft{static from(t,e=Pt,n=Dt,o){return new Ft("length"in t?function(t,e,n,o){const i=t.length,r=new Float64Array(2*i);for(let s=0;s<i;++s){const i=t[s];r[2*s]=e.call(o,i,s,t),r[2*s+1]=n.call(o,i,s,t)}return r}(t,e,n,o):Float64Array.from(function*(t,e,n,o){let i=0;for(const r of t)yield e.call(o,r,i,t),yield n.call(o,r,i,t),++i}(t,e,n,o)))}constructor(t){this._delaunator=new gt(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,e=this.points;if(t.hull&&t.hull.length>2&&function(t){const{triangles:e,coords:n}=t;for(let t=0;t<e.length;t+=3){const o=2*e[t],i=2*e[t+1],r=2*e[t+2];if((n[r]-n[o])*(n[i+1]-n[o+1])-(n[i]-n[o])*(n[r+1]-n[o+1])>1e-10)return!1}return!0}(t)){this.collinear=Int32Array.from({length:e.length/2},((t,e)=>e)).sort(((t,n)=>e[2*t]-e[2*n]||e[2*t+1]-e[2*n+1]));const t=this.collinear[0],n=this.collinear[this.collinear.length-1],o=[e[2*t],e[2*t+1],e[2*n],e[2*n+1]],i=1e-8*Math.hypot(o[3]-o[1],o[2]-o[0]);for(let t=0,n=e.length/2;t<n;++t){const n=Nt(e[2*t],e[2*t+1],i);e[2*t]=n[0],e[2*t+1]=n[1]}this._delaunator=new gt(e)}else delete this.collinear;const n=this.halfedges=this._delaunator.halfedges,o=this.hull=this._delaunator.hull,i=this.triangles=this._delaunator.triangles,r=this.inedges.fill(-1),s=this._hullIndex.fill(-1);for(let t=0,e=n.length;t<e;++t){const e=i[t%3==2?t-2:t+1];-1!==n[t]&&-1!==r[e]||(r[e]=t)}for(let t=0,e=o.length;t<e;++t)s[o[t]]=t;o.length<=2&&o.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=o[0],r[o[0]]=1,2===o.length&&(r[o[1]]=0,this.triangles[1]=o[1],this.triangles[2]=o[1]))}voronoi(t){return new Mt(this,t)}*neighbors(t){const{inedges:e,hull:n,_hullIndex:o,halfedges:i,triangles:r,collinear:s}=this;if(s){const e=s.indexOf(t);return e>0&&(yield s[e-1]),void(e<s.length-1&&(yield s[e+1]))}const a=e[t];if(-1===a)return;let c=a,l=-1;do{if(yield l=r[c],c=c%3==2?c-2:c+1,r[c]!==t)return;if(c=i[c],-1===c){const e=n[(o[t]+1)%n.length];return void(e!==l&&(yield e))}}while(c!==a)}find(t,e,n=0){if((t=+t)!=t||(e=+e)!=e)return-1;const o=n;let i;for(;(i=this._step(n,t,e))>=0&&i!==n&&i!==o;)n=i;return i}_step(t,e,n){const{inedges:o,hull:i,_hullIndex:r,halfedges:s,triangles:a,points:c}=this;if(-1===o[t]||!c.length)return(t+1)%(c.length>>1);let l=t,u=Tt(e-c[2*t],2)+Tt(n-c[2*t+1],2);const h=o[t];let d=h;do{let o=a[d];const h=Tt(e-c[2*o],2)+Tt(n-c[2*o+1],2);if(h<u&&(u=h,l=o),d=d%3==2?d-2:d+1,a[d]!==t)break;if(d=s[d],-1===d){if(d=i[(r[t]+1)%i.length],d!==o&&Tt(e-c[2*d],2)+Tt(n-c[2*d+1],2)<u)return d;break}}while(d!==h);return l}render(t){const e=null==t?t=new kt:void 0,{points:n,halfedges:o,triangles:i}=this;for(let e=0,r=o.length;e<r;++e){const r=o[e];if(r<e)continue;const s=2*i[e],a=2*i[r];t.moveTo(n[s],n[s+1]),t.lineTo(n[a],n[a+1])}return this.renderHull(t),e&&e.value()}renderPoints(t,e){void 0!==e||t&&"function"==typeof t.moveTo||(e=t,t=null),e=null==e?2:+e;const n=null==t?t=new kt:void 0,{points:o}=this;for(let n=0,i=o.length;n<i;n+=2){const i=o[n],r=o[n+1];t.moveTo(i+e,r),t.arc(i,r,e,0,Et)}return n&&n.value()}renderHull(t){const e=null==t?t=new kt:void 0,{hull:n,points:o}=this,i=2*n[0],r=n.length;t.moveTo(o[i],o[i+1]);for(let e=1;e<r;++e){const i=2*n[e];t.lineTo(o[i],o[i+1])}return t.closePath(),e&&e.value()}hullPolygon(){const t=new At;return this.renderHull(t),t.value()}renderTriangle(t,e){const n=null==e?e=new kt:void 0,{points:o,triangles:i}=this,r=2*i[t*=3],s=2*i[t+1],a=2*i[t+2];return e.moveTo(o[r],o[r+1]),e.lineTo(o[s],o[s+1]),e.lineTo(o[a],o[a+1]),e.closePath(),n&&n.value()}*trianglePolygons(){const{triangles:t}=this;for(let e=0,n=t.length/3;e<n;++e)yield this.trianglePolygon(e)}trianglePolygon(t){const e=new At;return this.renderTriangle(t,e),e.value()}}function Lt(t,e,n,o){let i,r,s=function(t,e,n){return Array(n).fill().map((()=>[Math.random()*t,Math.random()*e]))}(t,e,n),a=!1;const c=o*Math.min(t,e);for(let n=0;n<1e3;n++)if([s,a,i,r]=Vt(s,t,e,c),a)return s;return[s,i,r]}function Vt(t,e,n,o){const i=Ft.from(t).voronoi([0,0,e,n]),r=(s=t.length,[...Array(s).keys()]).map((t=>i.cellPolygon(t)));var s;const a=r.map(it),c=t.every(((t,e)=>{return n=t,i=a[e],n**2+i**2<o;var n,i}));return[a,c,i,r]}function Rt(t,e){const n=Gt(e),o=t.length-Gt(t),i=e.slice();for(let e,r,s,a=0,c=t[o-1];a<o;++a){const o=i.slice(),l=o.length-n;i.length=0,e=t[a],r=o[l-1];for(let t=0;t<l;++t)s=o[t],Ot(s,c,e)?(Ot(r,c,e)||i.push(It(r,s,c,e)),i.push(s)):Ot(r,c,e)&&i.push(It(r,s,c,e)),r=s;n&&i.push(i[0]),c=e}return i.length?i:null}function Ot([t,e],[n,o],[i,r]){return(i-n)*(e-o)<(r-o)*(t-n)}function It([t,e],[n,o],[i,r],[s,a]){const c=n-t,l=o-e,u=s-i,h=a-r,d=(c*(r-e)-l*(i-t))/(l*u-c*h);return[i+d*u,r+d*h]}function Gt(t){const[e,n]=t[0],[o,i]=t[t.length-1];return e===o&&n===i}function Bt(t){const{nd:o,nx:i,ny:r,polygons:s}=t,a=Array(o).fill().map((()=>[]));for(let t=0;t<i;t++)for(let i=0;i<r;i++){const r=qt(t,i);e(o).forEach((e=>{const o=Rt(n(s[e]).reverse(),r);null!==o&&a[e].push([t,i,ot(o)])}))}return a}function qt(t,e){return[[t,e],[t,e+1],[t+1,e+1],[t+1,e]]}function jt(){const t=this;t.make=(e,n,o)=>{[t.centroids,t.voronoi,t.polygons]=Lt(e,n,o,.01),t.nx=e,t.ny=n,t.nd=o,t.polygonAreas=t.polygons.map(ot).map((t=>-t)),t.totalArea=e*n,t.census=Bt(t)}}function Ht(t,n,o){const i=this;i.nd=20,i.nx=20,i.ny=20,i.districtMaker=new jt,i.districtNoise=new et(i.nx,i.ny),i.districtNoise.genNoise();let r=[];i.update=()=>{n.checkNone()||(r=t.getVoterShapes(),n.check(["numDistricts","mode","dimensions"])&&i.updateDistricts(),i.updateVoters())},i.updateDistricts=()=>{i.nd=o.numDistricts,i.districtMaker.make(i.nx,i.ny,i.nd)},i.updateVoters=()=>{i.updateFullSet(),i.updateVotersByDistrict(),i.updateVotersByTract()},i.updateFullSet=()=>{const{sn:t}=i.districtNoise;i.allVoterGroups=r.map((e=>t.map((t=>t.map((t=>{const[n,o]=t,i=f(e.shape1),r=f(e.shape2);return i.x+=n,r.x+=n,r.y+=o,{shape2:r,shape1:i}})).flat())).flat())).flat()},i.updateVotersByDistrict=()=>{const{census:t}=i.districtMaker,{sn:n}=i.districtNoise;i.voterGroupsByDistrict=e(i.nd).map((e=>r.map((o=>t[e].map((t=>{const[e,i,r]=t,[s,a]=n[e][i],c=f(o.shape1),l=f(o.shape2);return c.x+=s,l.x+=s,l.y+=a,{shape2:l,shape1:c,weight:r}})).flat())).flat()))},i.updateVotersByTract=()=>{const{sn:t}=i.districtNoise;i.voterGroupsByTract=t.map((t=>t.map((t=>r.map((e=>{const[n,o]=t,i=f(e.shape1),r=f(e.shape2);return i.x+=n,r.x+=n,r.y+=o,{shape2:r,shape1:i}})).flat()))))}}function Ut(t){const e=function(t){const e=t.map((t=>t.shape1.w)),n=e.reduce(((t,e)=>t+e)),o=e.map((t=>t/n)),i=[];return o.reduce(((t,e,n)=>{const o=t+e;return i[n]=o,o}),0),i}(t);this.samplePoint=function(){return function(t,e){const n=function(t){const e=Math.random(),n=t.findIndex((t=>t>=e));return n}(e),o=t[n],i="gaussian"===o.shape1.densityProfile,r=(i?Wt:$t)(o.shape1.x,.5*o.shape1.w),{party:s}=o;return{canGeom:r,party:s}}(t,e)}}function $t(t,e){return{x:(2*Math.random()-1)*e+t}}function Wt(t,e){const n=Math.random(),o=Math.random();return{x:2*e/Math.sqrt(2*Math.PI)*Math.sqrt(-2*Math.log(n))*Math.cos(2*Math.PI*o)+t}}function zt(t){const e=function(t){const e=t.map((t=>t.shape2.w**2)),n=e.reduce(((t,e)=>t+e)),o=e.map((t=>t/n)),i=[];return o.reduce(((t,e,n)=>{const o=t+e;return i[n]=o,o}),0),i}(t);this.samplePoint=function(){return function(t,e){const n=function(t){const e=Math.random(),n=t.findIndex((t=>t>=e));return n}(e),o=t[n],i=function(t,e,n){const o=n*Math.sqrt(Math.random()),i=2*Math.random()*Math.PI,r=t+o*Math.cos(i),s=e+o*Math.sin(i);return{x:r,y:s}}(o.shape2.x,o.shape2.y,.5*o.shape2.w),{party:r}=o;return{canGeom:i,party:r}}(t,e)}}function Xt(t,e,n){const o=this;o.update=()=>{e.checkNone()||o.startSampler()},o.startSampler=()=>{const{dimensions:e}=n,i=t.getCandidateDistributions();if(0===i.length)return;const r=1===e?Ut:zt;o.sampler=new r(i)}}function Yt(t){const e=function(t){const e=t.length,n=new Array(e);for(let o=0;o<e;o++){n[o]=[];for(let i=0;i<e;i++){if(o===i)continue;const e=t[o],r=t[i];n[o].push(Jt(e,r))}}return n}(t);this.sumArea=function(t){const n=e.length,o=Array(n);for(let i=0;i<n;i++){const n=e[i];o[i]=Kt(t,n)}return o}}function Jt(t,e){const n=e.x-t.x,o=e.y-t.y;return{A:{x:n,y:o},b:.5*(t.x+e.x)*n+.5*(t.y+e.y)*o}}function Kt(t,e){let n=0;const o=t.x,i=t.y,{w:r}=t,s=.5*r;for(let t=o-s;t<o+s;t+=2){const r=s**2-(t-o)**2;let a;a=r>0?Math.sqrt(r):0;let c=i+a,l=i-a;for(let n=0;n<e.length;n++){const o=e[n],i=o.A.y,r=o.A.x,{b:s}=o;if(0===i)r*t<s||(l=1/0);else{const e=(s-r*t)/i;i<0?l=Math.max(l,e):c=Math.min(c,e)}}const u=c-l;if(u>0){n+=2*u}}return n}function Qt(t){const n=function(t){const n=t.length,o=e(n).sort(((e,n)=>t[e].x-t[n].x)),i=new Array(n-1);for(let e=0;e<n-1;e++)i[e]=.5*(t[o[e]].x+t[o[e+1]].x);const r=new Array(n);for(let t=0;t<n;t++){const e=0===t?-1/0:i[t-1],s=t===n-1?1/0:i[t];r[o[t]]={lower:e,upper:s}}return r}(t);this.sumArea=function(e){const o=t.length,i=Array(o);if("gaussian"===e.densityProfile)for(let t=0;t<o;t++)i[t]=te(e,n[t]);else for(let t=0;t<o;t++)i[t]=Zt(e,n[t]);return i}}function Zt(t,e){const{lower:n,upper:o}=e,{x:i,w:r}=t,s=.5*r,a=i-s,c=i+s,l=Math.max(n,a),u=Math.min(o,c);return Math.max(0,u-l)}function te(t,e){const{lower:n,upper:o}=e,{x:i,w:r}=t,a=i,c=r/Math.sqrt(2*Math.PI);return r*s(o,a,c)-r*s(n,a,c)}function ee({canGeoms:t,voterGeoms:e,dimensions:n,parties:o}){const i=1===n?new Qt(t):new Yt(t),r=t.length;let s=new Array(r).fill(0);e.forEach((t=>{const e=i.sumArea(t),n=void 0===t.weight?1:t.weight;s=s.map(((t,o)=>t+e[o]*n))}));const a=s.reduce(((t,e)=>t+e));return{tallyFractions:s.map((t=>t/a)),parties:o}}function ne({canGeoms:t,voterGeom:e,dimensions:n}){const o=t.length,i=new Array(o).fill(0),r=1===n?oe:ie,s=t.map((t=>r(t,e))),[a,c]=u(s);for(let t=0;t<o;t++){const e=s[t];if(e<=a)i[t]=1;else if(e>=c)i[t]=0;else{const n=(e-a)/(c-a);i[t]=0+1*(1-n)}}return{tallyFractions:i}}function oe(t,e){return Math.abs(t.x-e.x)}function ie(t,e){return Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2)}function re(t,n){this.sumArea=function(o){const i=function(t,n){const o="gaussian"===t.densityProfile,i=o?3:1,{x:r,y:s,w:a}=t,c=a*i,{usr:l}=n,u=Math.round(c/l),h=e(u),d=e(u),f=h.map((t=>(t+.5)*l-.5*c+r)),p=d.map((t=>(t+.5)*l-.5*c+s)),m=h.length,g=d.length,y=m*g,w=Array(y),v=Array(y),_=Array(y);let x=0;for(let e=0;e<d.length;e++)for(let n=0;n<h.length;n++){const o=f[n],i=p[e];w[x]=o,v[x]=i,_[x]=se(t,o,i),x+=1}const b={x:w,y:v,weight:_,nx:m,ny:g};return b}(o,n),r=t.length,s=Array(r).fill(0);let a=0;const c=i.x.length,l=Array(c),u=i.weight;for(let e=0;e<c;e++){const n=i.weight[e],o=i.x[e],c=i.y[e],u=ne({canGeoms:t,voterGeom:{x:o,y:c},dimensions:2});l[e]=u;const{tallyFractions:h}=u;a+=n;for(let t=0;t<r;t++)s[t]+=h[t]*n}return{grid:i,voteSet:l,area:s,totalArea:a,weightSet:u}}}function se(t,e,n){const o="gaussian"===t.densityProfile,{x:i,y:s,w:a}=t;if(!o){return(e-i)**2+(n-s)**2<(.5*a)**2?1:0}const c=a/Math.sqrt(2*Math.PI);return a*r(e,i,c)*r(n,s,c)}function ae(t){this.sumArea=function(n){const o=function(t){const n="gaussian"===t.densityProfile,o=n?3:1,{x:i,w:r}=t,s=Math.round(r*o),a=e(s),c={x:a.map((t=>t+.5-.5*s+i))};return c}(n),i=t.length,r=Array(i).fill(0);let s=0;const a=o.x.length,c=Array(a),l=Array(a);for(let e=0;e<a;e++){const a=o.x[e],u=ne({canGeoms:t,voterGeom:{x:a},dimensions:1});c[e]=u;const{tallyFractions:h}=u,d=ce(n,a);l[e]=d,s+=d;for(let t=0;t<i;t++)r[t]+=h[t]*d}return{grid:o,voteSet:c,weightSet:l,area:r,totalArea:s}}}function ce(t,e){if(!("gaussian"===t.densityProfile))return 1;const{x:n,w:o}=t;return o*r(e,n,o/Math.sqrt(2*Math.PI))}function le(t,e){const n=t.length,o=[],i=[];let r=0,s=0,a=t[n-1],c=he(e,a);for(let l=0;l<n;l++){const n=t[l],u=he(e,n);if(c&&!u||!c&&u){const t=de(a,n,ue(e,a),ue(e,n));o[r]=t,i[s]=t,r+=1,s+=1}u?(i[s]=n,s+=1):(o[r]=n,r+=1),a=n,c=u}return{positive:o,negative:i}}function ue(t,e){return(t[0]*e[0]+t[1]*e[1]+t[2])/Math.sqrt(t[0]**2+t[1]**2)}function he(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]<0}function de(t,e,n,o){let i=-o/(n-o);i<0&&(i=0),i>1&&(i=1);return[i*t[0]+(1-i)*e[0],i*t[1]+(1-i)*e[1]]}function fe(t,e){const n=function(t){const{x:e,y:n,w:o}=t,i=o/2,r=100,s=Array(r);for(let t=0;t<r;t++){const o=t/(r-1),a=2*Math.PI*o,c=e+i*Math.cos(a),l=n+i*Math.sin(a);s[t]=[c,l]}return s}(t);let o=[n];const i=e.length;let r=[Array(i).fill(0)];for(let t=0;t<i-1;t++)for(let n=t+1;n<i;n++){const i=o.length,s=Array(2*i),a=Array(2*i);let c=0;for(let l=0;l<i;l++){const i=le(o[l],pe(e[t],e[n])),u=i.positive;void 0!==u&&u.length>2&&(s[c]=u,a[c]=d(r[l]),a[c][n]+=1,c+=1);const h=i.negative;void 0!==h&&h.length>2&&(s[c]=h,a[c]=d(r[l]),a[c][t]+=1,c+=1)}s.splice(c),a.splice(c),o=s,r=a}const s=o.length,a=Array(s),c=Array(s);for(let t=0;t<s;t++){a[t]=Array(i),c[t]=Array(i);for(let e=0;e<i;e++)c[t][e]=[];for(let e=0;e<i;e++){const n=i-r[t][e];a[t][e]=n,c[t][n-1].push(e)}}return{cells:o,ranking:a,cansRanked:c}}function pe(t,e){const{A:n,b:o}=Jt(t,e);return[n.x,n.y,-o]}function me(t){this.sumArea=function(e,n){let{cells:o,ranking:i,cansRanked:r}=fe(e,t);const s=o.length;let a=Array(s),c=0;for(let t=0;t<s;t++){const e=-ot(o[t])*n;a[t]=e,c+=e}const l=1e-6;return i=i.filter(((t,e)=>Math.abs(a[e])>l)),r=r.filter(((t,e)=>Math.abs(a[e])>l)),o=o.filter(((t,e)=>Math.abs(a[e])>l)),a=a.filter((t=>Math.abs(t)>l)),{ranking:i,cansRanked:r,area:a,totalArea:c,cellDatum:{cells:o,ranking:i}}}}function ge(t){const n=t.length,o=e(n).sort(((e,n)=>t[e].x-t[n].x)),i=.5*n*(n-1),r=Array(i),s=Array(i);let a=0;for(let e=0;e<n-1;e++)for(let i=e+1;i<n;i++){const n=o[e],u=o[i],h=(c=t[n],l=t[u],.5*(c.x+l.x));r[a]=h,s[a]=[n,u],a+=1}var c,l;const u=e(i).sort(((t,e)=>r[t]-r[e])),h=u.map((t=>r[t])),f=u.map((t=>s[t])),p=Array(n);for(let t=0;t<n;t++)p[o[t]]=t+1;const m=Array(i+1);m[0]=d(p);for(let t=0;t<i;t++){const[e,n]=f[t];p[e]+=1,p[n]-=1,m[t+1]=d(p)}const g=Array(i+1);for(let t=0;t<i+1;t++){g[t]=Array(n);for(let e=0;e<n;e++)g[t][e]=[];const e=m[t];for(let o=0;o<n;o++){const n=e[o];g[t][n-1].push(o)}}const y=d(h);return y.unshift(-1/0),y.push(1/0),{intervalBorders:y,ranking:m,cansRanked:g}}function ye(t){const{intervalBorders:e,ranking:n,cansRanked:o}=ge(t);this.sumArea=function(t,i){const r=e.length-1,s=Array(r);let a=0;for(let n=0;n<r;n++){const o=we(e[n],e[n+1],t)*i;s[n]=o,a+=o}return{ranking:n,cansRanked:o,area:s,totalArea:a,cellDatum:{ranking:n,intervalBorders:e}}}}function we(t,e,n){return"gaussian"===n.densityProfile?te(n,{lower:t,upper:e}):Zt(n,{lower:t,upper:e})}function ve({canGeoms:t,voterGeom:e,dimensions:n}){const o=1===n?_e:xe,i=c(t.map((t=>o(t,e)))),r=t.length,s=new Array(r).fill(0);s[i]=1;return{tallyFractions:s}}function _e(t,e){return(t.x-e.x)**2}function xe(t,e){return(t.x-e.x)**2+(t.y-e.y)**2}function be({canGeoms:t,voterGeom:n,dimensions:o}){const i=1===o?Ce:Se,r=t.map((t=>i(t,n))),s=t.length,a=e(s).sort(((t,e)=>r[t]-r[e])),c=new Array(s).fill(0),l=new Array(s).fill(0);for(let t=0;t<s;t++)c[a[t]]=t+1,l[a[t]]=s-t-1;const u=new Array(s);for(let t=0;t<s;t++){u[t]=new Array(s).fill(0);for(let e=0;e<s;e++)c[t]!==c[e]&&(u[t][e]=c[t]<c[e]?1:-1)}return{indexInOrder:a,ranking:c,bordaScores:l,pairwise:u,tallyFractions:l}}function Ce(t,e){return(t.x-e.x)**2}function Se(t,e){return(t.x-e.x)**2+(t.y-e.y)**2}function ke(t){const e=t.length,n=Array(e-1),o=Array(e-1);for(let i=0;i<e-1;i++){n[i]=Array(e-i-1),o[i]=Array(e-i-1);for(let r=i+1;r<e;r++){const e=t[i].x,s=t[r].x,a=.5*(e+s);n[i][r]=a,o[i][r]=e<s}}this.sumArea=function(t,i){const r=function(t,e){const n=-1/0,o=1/0;return Ae(n,o,t)*e}(t,i),s=Array(e).fill(0);for(let t=0;t<e;t++)s[t]=Array(e).fill(0);for(let a=0;a<e-1;a++)for(let c=a+1;c<e;c++){const e=Ae(-1/0,n[a][c],t)*i,l=o[a][c]?e:r-e,u=r-l;s[a][c]=l,s[c][a]=u}return{area:s,totalArea:r}}}function Ae(t,e,n){return"gaussian"===n.densityProfile?te(n,{lower:t,upper:e}):Zt(n,{lower:t,upper:e})}function Me(t){this.sumArea=function(e,n){const o=function(t,e){return e*Math.PI*(t.w/2)**2}(e,n),i=t.length,r=Array(i).fill(0);for(let t=0;t<i;t++)r[t]=Array(i).fill(0);for(let s=0;s<i-1;s++)for(let a=s+1;a<i;a++){const i=Pe(Te(Ee(t[s],t[a]),e),e,n,o),c=o-i;r[s][a]=i,r[a][s]=c}return{area:r,totalArea:o}}}function Ee(t,e){const{A:n,b:o}=Jt(t,e);return[n.x,n.y,-o]}function Te(t,e){return(t[0]*e.x+t[1]*e.y+t[2])/Math.sqrt(t[0]**2+t[1]**2)}function Pe(t,e,n,o){const i=e.w/2;if(t>i)return 0;if(t<-i)return o;const r=t/i;return i**2*(Math.acos(r)-r*Math.sqrt(1-r**2))*n}const De={plurality:{cast:ee,castTestVote:ve},score:{cast:function({canGeoms:t,voterGeoms:e,dimensions:n,parties:o},i){const r=1===n?new ae(t):new re(t,i),s=t.length;let a=new Array(s).fill(0),c=0;const l=[];for(let t=0;t<e.length;t++){const n=e[t],{grid:o,voteSet:i,area:s,totalArea:u}=r.sumArea(n),h={grid:o,voteSet:i,voterGeom:n};l.push(h);const d=void 0===n.weight?1:n.weight;a=a.map(((t,e)=>t+s[e]*d)),c+=u}return{tallyFractions:a.map((t=>t/c)),gridData:l,parties:o}},castTestVote:ne},scoreLong:{cast:function({canGeoms:t,voterGeoms:e,dimensions:n,parties:o},i){const r=1===n?new ae(t):new re(t,i),s=t.length;let a=0;const c=[];for(let t=0;t<e.length;t++){const n=e[t];c[t]=r.sumArea(n);const{totalArea:o}=c[t];a+=o*(void 0===n.weight?1:n.weight)}const l=1/a;let u=new Array(s).fill(0);const h=[],d=[],f=[];let p=0;for(let t=0;t<e.length;t++){const n=e[t],{grid:o,voteSet:i,weightSet:r,area:s}=c[t],a=[];for(let t=0;t<i.length;t++)d[p]=i[t].tallyFractions,a[t]=p,f[p]=r[t]*l,p+=1;const m={grid:o,voteSet:i,voterGeom:n,voteIndex:a};h[t]=m;const g=void 0===n.weight?1:n.weight;u=u.map(((t,e)=>t+s[e]*g*l))}return{tallyFractions:u,gridData:h,scoreVotes:d,votePop:f,parties:o}},castTestVote:ne},ranking:{cast:function({canGeoms:t,voterGeoms:e,dimensions:n,parties:o}){const i=1===n?new ye(t):new me(t),r=t.length;let s=[],a=[],c=[];const l=Array(r).fill(0);let u=0;const h=[];e.forEach((t=>{const e=void 0===t.weight?1:t.weight,{rankings:n,cansRanked:o,area:r,totalArea:d,cellDatum:f}=i.sumArea(t,e);s=s.concat(r),a=a.concat(n),c=c.concat(o),u+=d,h.push(f);for(let t=0;t<o.length;t++){const e=o[t][0];for(let n=0;n<e.length;n++){const o=e[n];l[o]+=r[t]}}}));const d=s.map((t=>t/u)),f=l.map((t=>t/u));return{rankingVotes:a,cansByRank:c,votePop:d,tallyFractions:f,cellData:h,parties:o}},castTestVote:be},pairwise:{cast:function({canGeoms:t,voterGeoms:e,dimensions:n,parties:o}){const i=1===n?new ke(t):new Me(t);let r=0;const s=t.length,a=Array(s).fill(0);for(let t=0;t<s;t++)a[t]=Array(s).fill(0);e.forEach((t=>{const e=void 0===t.weight?1:t.weight,{area:n,totalArea:o}=i.sumArea(t,e);for(let t=0;t<s;t++)for(let e=0;e<s;e++)a[t][e]+=n[t][e];r+=o}));const c=a.map((t=>t.map((t=>t/r)))),l=Array(s).fill(0);for(let t=0;t<s-1;t++)for(let e=t+1;e<s;e++){const n=c[t][e],o=c[e][t];n>o?l[t]+=1:n<o&&(l[e]+=1)}return{pairwiseTallyFractions:c,tallyFractions:l.map((t=>t/(s-1))),parties:o}},castTestVote:be},olprA:{cast:function(t){return ee(t)},castTestVote:function({canGeoms:t,voterGeom:e,dimensions:n}){return ve({canGeoms:t,voterGeom:e,dimensions:n})}}};var Ne=De;function Fe(t,e){const{socialChoiceOptions:n}=e;return(0,E[e.socialChoiceMethod])({votes:t,socialChoiceOptions:n})}function Le(t,e){const{canGeoms:n,voterGeoms:o}=t;if(0===o.length)return{error:"No Voters"};if(0===n.length)return{error:"No Candidates"};const{castOptions:i}=e,r=Ne[e.voteCasterName].cast(t,i);return{electionOptions:e,geometry:t,votes:r,socialChoiceResults:Fe(r,e)}}function Ve(t,e){const n=e.length,o={};if(void 0!==t[0][0].tallyFractions){const e=function(t,e){const n=Array(e).fill(0);t.forEach((t=>t.forEach((t=>{const{tallyFractions:o}=t;for(let t=0;t<e;t++)n[t]+=o[t]}))));const o=1/n.reduce(((t,e)=>t+e));return n.map((t=>t*o))}(t,n);o.tallyFractions=e}if(void 0!==t[0][0].pairwiseTallyFractions){const e=function(t,e){const n=Array(e);for(let t=0;t<e;t++)n[t]=Array(e).fill(0);t.forEach((t=>t.forEach((t=>{const{pairwiseTallyFractions:o}=t;for(let t=0;t<e;t++)for(let i=0;i<e;i++)n[t][i]+=o[t][i]}))));const o=1/(n[0][1]+n[1][0]);return n.map((t=>t.map((t=>t*o))))}(t,n);o.pairwiseTallyFractions=e}if(void 0!==t[0][0].cansByRank){const e=function(t){let e=[],n=[];t.forEach((t=>t.forEach((t=>{const{votePop:o,cansByRank:i}=t;e=e.concat(o),n=n.concat(i)}))));const o=t.length,i=t[0].length,r=1/(o*i);return e=e.map((t=>t*r)),{votePop:e,cansByRank:n}}(t);o.votePop=e.votePop,o.cansByRank=e.cansByRank}if(void 0!==t[0][0].scoreVotes){const e=function(t){let e=[],n=[];t.forEach((t=>t.forEach((t=>{const{votePop:o,scoreVotes:i}=t;e=e.concat(o),n=n.concat(i)}))));const o=t.length,i=t[0].length,r=1/(o*i);return e=e.map((t=>t*r)),{votePop:e,scoreVotes:n}}(t);o.votePop=e.votePop,o.scoreVotes=e.scoreVotes}return o.parties=t[0][0].parties,o}function Re(t,n,o){const{census:i}=o.districtMaker,{nd:r}=o,s=n.length,a=e(r).map((e=>{const n=i[e],o={};if(void 0!==t[0][0].tallyFractions){const e=function(t,e,n){const o=Array(n).fill(0);for(let i=0;i<e.length;i++){const[r,s,a]=e[i],{tallyFractions:c}=t[r][s];for(let t=0;t<n;t++)o[t]+=c[t]*a}const i=1/o.reduce(((t,e)=>t+e));return o.map((t=>t*i))}(t,n,s);o.tallyFractions=e}if(void 0!==t[0][0].pairwiseTallyFractions){const e=function(t,e,n){const o=Array(n);for(let t=0;t<n;t++)o[t]=Array(n).fill(0);for(let i=0;i<e.length;i++){const[r,s,a]=e[i],{pairwiseTallyFractions:c}=t[r][s];for(let t=0;t<n;t++)for(let e=0;e<n;e++)o[t][e]+=c[t][e]*a}const i=1/(o[0][1]+o[1][0]);return o.map((t=>t.map((t=>t*i))))}(t,n,s);o.pairwiseTallyFractions=e}if(void 0!==t[0][0].cansByRank){const e=function(t,e){let n=[],o=[],i=0;for(let t=0;t<e.length;t++){const[,,n]=e[t];i+=n}const r=1/i;for(let s=0;s<e.length;s++){const[a,c,l]=e[s];i+=l;const{votePop:u,cansByRank:h}=t[a][c],d=u.map((t=>t*l*r));n=n.concat(d),o=o.concat(h)}return{votePop:n,cansByRank:o}}(t,n);o.votePop=e.votePop,o.cansByRank=e.cansByRank}if(void 0!==t[0][0].scoreVotes){const e=function(t,e){let n=[],o=[],i=0;for(let t=0;t<e.length;t++){const[,,n]=e[t];i+=n}const r=1/i;for(let s=0;s<e.length;s++){const[a,c,l]=e[s];i+=l;const{votePop:u,scoreVotes:h}=t[a][c],d=u.map((t=>t*l*r));n=n.concat(d),o=o.concat(h)}return{votePop:n,scoreVotes:o}}(t,n);o.votePop=e.votePop,o.scoreVotes=e.scoreVotes}return o.parties=t[0][0].parties,o}));return a}function Oe(t,e){const{castOptions:n}=e,{canGeoms:o,parties:i,dimensions:r,voterDistricts:s}=t,{voterGroupsByTract:a}=s;return a.map((t=>t.map((t=>{const a={voterGeoms:R(t,r),canGeoms:o,parties:i,dimensions:r,voterDistricts:s};return Ne[e.voteCasterName].cast(a,n)}))))}function Ie(t,e,n){const o=e.length,i=Array(o).fill(0);if("singleWinner"===n.socialChoiceType){t.map((t=>t.iWinner)).forEach((t=>{i[t]+=1}))}else t.forEach((t=>{const{allocation:e}=t;for(let t=0;t<o;t++)i[t]+=e[t]}));return i}function Ge(t,e){const{voterGeoms:n,canGeoms:o,voterDistricts:i}=t;if(0===n.length)return{error:"no voters"};if(0===o.length)return{error:"no candidates"};const r=Oe(t,e),s=Ve(r,o),a=Re(r,o,i),c=function(t,e){const n=t.map((t=>Fe(t,e)));return n}(a,e);return{electionOptions:e,geometry:t,votes:s,votesByTract:r,votesByDistrict:a,scResultsByDistrict:c,socialChoiceResults:{allocation:Ie(c,o,e)}}}function Be(){const t=this;let e,n=[];t.update=function(e,n,o,i,r){o.checkAny()&&t.startSim();return t.addSim(e,n,i,r)},t.startSim=function(){n=[],e=Array(10).fill(0)},t.addSim=function(t,o,i,r){const{voterGeoms:s,canGeoms:a,dimensions:c,voterDistricts:l}=t;if(0===s.length)return{pointsChanged:!1};if(0===a.length)return{pointsChanged:!1};if(n.length>5e3)return{pointsChanged:!1};const{socialChoiceOptions:u}=r,{seats:h}=u,d=i.numDistricts,f=Array(1*h*d);let p=0;for(let t=0;t<1;t++){const t=u.numSampleCandidates,a=[],h=[];for(let e=0;e<t;e++){const t=o.samplePoint(),{canGeom:e,party:n}=t;a.push(e),h.push(n[0])}const d={voterGeoms:s,canGeoms:a,parties:{partiesByCan:h,numParties:10},dimensions:c,voterDistricts:l},m=(i.useDistricts?Ge:Le)(d,r),g=i.useDistricts?m.scResultsByDistrict:[m.socialChoiceResults],y=g.length,w=10;if("singleWinner"===r.socialChoiceType){let t=0;for(let o=0;o<y;o++){const{iWinner:i}=g[o],{x:r,y:s}=a[i];let l;l=0===t?[r,s]:1===c?[r+(Math.random()-.5)*w]:[r+(Math.random()-.5)*w,s+(Math.random()-.5)*w],n.push(l),f[p]=l,p+=1,t+=1;const u=h[i];e[u]+=1}}else{let t=0;for(let o=0;o<y;o++){const{allocation:i}=g[o];for(let o=0;o<a.length;o++){const{x:r,y:s}=a[o],l=h[o],u=i[o];for(let o=0;o<u;o++){let o;o=0===t?[r,s]:1===c?[r+(Math.random()-.5)*w]:[r+(Math.random()-.5)*w,s+(Math.random()-.5)*w],n.push(o),f[p]=o,p+=1,t+=1,e[l]+=1}}}}}const m=e.map((t=>t/n.length));return{pointsChanged:!0,newPoints:f,points:n,partyWinFraction:m}}}function qe(t,e,n,o){const{dimensions:i,useDistricts:r}=n,s={voterGeoms:t.getGeoms(i),canGeoms:e.getGeoms(i),parties:e.getParties(),dimensions:i};return r&&(s.voterDistricts=o),s}function je(t,e,n,o,i,r){const{candidateDnList:s,voterShapeList:a}=e,c=new Xt(s,n,i),l=new Be;this.update=()=>{r.update(),i.useDistricts&&o.update(),c.update();const e=qe(a,s,i,o),u={samplingResult:l.update(e,c.sampler,n,i,r)};t.update(u),n.clear()}}function He(t,e,n,o,i,r){const{voterShapeList:s,candidateList:a}=e;this.update=()=>{if(n.checkNone())return;r.update(),i.useDistricts&&o.update();const e=qe(s,a,i,o),c=(i.useDistricts?Ge:Le)(e,r);c.colorRGBAOfCandidates=a.getRGBAList();const l={electionResults:c};t.update(l),n.clear()}}function Ue(t,e,n,o,i,r){const s=this;s.modes={one:new He(t,e,o,n,i,r),sample:new je(t,e,o,n,i,r)},s.update=()=>{s.modes[i.mode].update()}}function $e(t){t.candidateList.addCandidate({x:50,y:100},{x:50},"#e05020",!0),t.candidateList.addCandidate({x:100,y:50},{x:100},"#50e020",!0),t.candidateList.addCandidate({x:200,y:250},{x:200},"#2050e0",!0),t.candidateDnList.addCandidateDistribution({x:150,y:150,w:200},{x:150,w:200,densityProfile:"gaussian"},!0),t.voterShapeList.addVoterCircle({x:50,y:150,w:200},{x:50,w:200,densityProfile:"gaussian"},!0),t.voterShapeList.addVoterCircle({x:250,y:150,w:200},{x:250,w:200,densityProfile:"gaussian"},!0)}function We(){const t=[];this.attach=e=>{t.push(e)},this.update=e=>{t.forEach((t=>t.update(e)))}}function ze(t){const e=new m,n=new v(t),o=new _(e),i=new N(e,o),r=new W(e,n),s=new Ht(r.voterShapeList,e,o),a=new We,c=new Ue(a,r,s,e,o,i);return{changes:e,commander:n,simOptions:o,electionOptions:i,entities:r,voterDistricts:s,simMode:c,pub:a,init:function(t){$e(r),n.loadConfig(t),n.clearHistory()},update:function(){c.update()}}}var Xe=["menu","darkModeSwitch","simControlsLabel","undo","redo","addVoter","addCandidate","addCandidateDistribution","viz","vizMini","maps","budget","name","saveConfigToLink","saveConfigToShortLink","saveConfigToText","loadConfigText","saveData","svgSwitch","showDownloadScreenLink"];function Ye(t){const e={},n=[];this.newElement=(o,i)=>{t.includes(o)?e[o]=i:n.push(i)},this.makeComponent=()=>{const o=document.createElement("div");return o.className="sandbox",t.forEach((t=>{const n=e[t];void 0!==n&&o.appendChild(n)})),n.forEach((t=>{o.appendChild(t)})),o}}function Je(){const t=this,e=[];t.attach=t=>{e.push(t)},t.enter=()=>{e.forEach((t=>t.enter()))},t.exit=()=>{e.forEach((t=>t.exit()))},t.update=t=>{e.forEach((e=>e.update(t)))},t.render=()=>{e.forEach((t=>{t.render&&t.render()}))},t.renderForeground=()=>{e.forEach((t=>{t.renderForeground&&t.renderForeground()}))},t.clear=()=>{e.forEach((t=>{t.clear&&t.clear()}))},t.clearForeground=()=>{e.forEach((t=>{t.clearForeground&&t.clearForeground()}))}}function Ke(t,e,n){const o=this;t.attach(o),o.viewModes={one:new Je,sample:new Je};let i=o.viewModes[e.mode];o.update=t=>{n.check(["mode"])&&(i.exit(),i=o.viewModes[e.mode],i.enter()),i.update(t)},o.render=()=>{i.render()},o.renderForeground=()=>{i.renderForeground()},o.clear=()=>{i.clear()},o.clearForeground=()=>{i.clearForeground()},o.rerender=()=>{o.clear(),o.clearForeground(),o.render(),o.renderForeground()}}function Qe(){throw new Error("setTimeout has not been defined")}function Ze(){throw new Error("clearTimeout has not been defined")}var tn,en=Qe,nn=Ze;function on(t){if(en===setTimeout)return setTimeout(t,0);if((en===Qe||!en)&&setTimeout)return en=setTimeout,setTimeout(t,0);try{return en(t,0)}catch(e){try{return en.call(null,t,0)}catch(e){return en.call(this,t,0)}}}"function"==typeof(tn="undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).setTimeout&&(en=setTimeout),"function"==typeof tn.clearTimeout&&(nn=clearTimeout);var rn,sn=[],an=!1,cn=-1;function ln(){an&&rn&&(an=!1,rn.length?sn=rn.concat(sn):cn=-1,sn.length&&un())}function un(){if(!an){var t=on(ln);an=!0;for(var e=sn.length;e;){for(rn=sn,sn=[];++cn<e;)rn&&rn[cn].run();cn=-1,e=sn.length}rn=null,an=!1,function(t){if(nn===clearTimeout)return clearTimeout(t);if((nn===Ze||!nn)&&clearTimeout)return nn=clearTimeout,clearTimeout(t);try{nn(t)}catch(e){try{return nn.call(null,t)}catch(e){return nn.call(this,t)}}}(t)}}function hn(t,e){this.fun=t,this.array=e}hn.prototype.run=function(){this.fun.apply(null,this.array)};function dn(){}var fn=dn,pn=dn,mn=dn,gn=dn,yn=dn,wn=dn,vn=dn;var _n=tn.performance||{},xn=_n.now||_n.mozNow||_n.msNow||_n.oNow||_n.webkitNow||function(){return(new Date).getTime()};var bn=new Date;var Cn,Sn,kn,An,Mn,En,Tn={nextTick:function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];sn.push(new hn(t,e)),1!==sn.length||an||on(un)},title:"browser",browser:!0,env:{NODE_ENV:"production"},argv:[],version:"",versions:{},on:fn,addListener:pn,once:mn,off:gn,removeListener:yn,removeAllListeners:wn,emit:vn,binding:function(t){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(t){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(t){var e=.001*xn.call(_n),n=Math.floor(e),o=Math.floor(e%1*1e9);return t&&(n-=t[0],(o-=t[1])<0&&(n--,o+=1e9)),[n,o]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-bn)/1e3}},Pn={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-Pn.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*Pn.Bounce.In(2*t):.5*Pn.Bounce.Out(2*t-1)+.5}}},Dn="undefined"==typeof self&&void 0!==Tn&&Tn.hrtime?function(){var t=Tn.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?self.performance.now.bind(self.performance):void 0!==Date.now?Date.now:function(){return(new Date).getTime()},Nn=function(){function t(){this._tweens={},this._tweensAddedDuringUpdate={}}return t.prototype.getAll=function(){var t=this;return Object.keys(this._tweens).map((function(e){return t._tweens[e]}))},t.prototype.removeAll=function(){this._tweens={}},t.prototype.add=function(t){this._tweens[t.getId()]=t,this._tweensAddedDuringUpdate[t.getId()]=t},t.prototype.remove=function(t){delete this._tweens[t.getId()],delete this._tweensAddedDuringUpdate[t.getId()]},t.prototype.update=function(t,e){void 0===t&&(t=Dn()),void 0===e&&(e=!1);var n=Object.keys(this._tweens);if(0===n.length)return!1;for(;n.length>0;){this._tweensAddedDuringUpdate={};for(var o=0;o<n.length;o++){var i=this._tweens[n[o]],r=!e;i&&!1===i.update(t,r)&&!e&&delete this._tweens[n[o]]}n=Object.keys(this._tweensAddedDuringUpdate)}return!0},t}(),Fn={Linear:function(t,e){var n=t.length-1,o=n*e,i=Math.floor(o),r=Fn.Utils.Linear;return e<0?r(t[0],t[1],o):e>1?r(t[n],t[n-1],n-o):r(t[i],t[i+1>n?n:i+1],o-i)},Bezier:function(t,e){for(var n=0,o=t.length-1,i=Math.pow,r=Fn.Utils.Bernstein,s=0;s<=o;s++)n+=i(1-e,o-s)*i(e,s)*t[s]*r(o,s);return n},CatmullRom:function(t,e){var n=t.length-1,o=n*e,i=Math.floor(o),r=Fn.Utils.CatmullRom;return t[0]===t[n]?(e<0&&(i=Math.floor(o=n*(1+e))),r(t[(i-1+n)%n],t[i],t[(i+1)%n],t[(i+2)%n],o-i)):e<0?t[0]-(r(t[0],t[0],t[1],t[1],-o)-t[0]):e>1?t[n]-(r(t[n],t[n],t[n-1],t[n-1],o-n)-t[n]):r(t[i?i-1:0],t[i],t[n<i+1?n:i+1],t[n<i+2?n:i+2],o-i)},Utils:{Linear:function(t,e,n){return(e-t)*n+t},Bernstein:function(t,e){var n=Fn.Utils.Factorial;return n(t)/n(e)/n(t-e)},Factorial:(Cn=[1],function(t){var e=1;if(Cn[t])return Cn[t];for(var n=t;n>1;n--)e*=n;return Cn[t]=e,e}),CatmullRom:function(t,e,n,o,i){var r=.5*(n-t),s=.5*(o-e),a=i*i;return(2*e-2*n+r+s)*(i*a)+(-3*e+3*n-2*r-s)*a+r*i+e}}},Ln=function(){function t(){}return t.nextId=function(){return t._nextId++},t._nextId=0,t}(),Vn=new Nn,Rn=function(){function t(t,e){void 0===e&&(e=Vn),this._object=t,this._group=e,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=Pn.Linear.None,this._interpolationFunction=Fn.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._id=Ln.nextId(),this._isChainStopped=!1,this._goToEnd=!1}return t.prototype.getId=function(){return this._id},t.prototype.isPlaying=function(){return this._isPlaying},t.prototype.isPaused=function(){return this._isPaused},t.prototype.to=function(t,e){return this._valuesEnd=Object.create(t),void 0!==e&&(this._duration=e),this},t.prototype.duration=function(t){return this._duration=t,this},t.prototype.start=function(t){if(this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed)for(var e in this._reversed=!1,this._valuesStartRepeat)this._swapEndStartRepeatValues(e),this._valuesStart[e]=this._valuesStartRepeat[e];return this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=void 0!==t?"string"==typeof t?Dn()+parseFloat(t):t:Dn(),this._startTime+=this._delayTime,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat),this},t.prototype._setupProperties=function(t,e,n,o){for(var i in n){var r=t[i],s=Array.isArray(r),a=s?"array":typeof r,c=!s&&Array.isArray(n[i]);if("undefined"!==a&&"function"!==a){if(c){var l=n[i];if(0===l.length)continue;l=l.map(this._handleRelativeValue.bind(this,r)),n[i]=[r].concat(l)}if("object"!==a&&!s||!r||c)void 0===e[i]&&(e[i]=r),s||(e[i]*=1),o[i]=c?n[i].slice().reverse():e[i]||0;else{for(var u in e[i]=s?[]:{},r)e[i][u]=r[u];o[i]=s?[]:{},this._setupProperties(r,e[i],n[i],o[i])}}}},t.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},t.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},t.prototype.pause=function(t){return void 0===t&&(t=Dn()),this._isPaused||!this._isPlaying||(this._isPaused=!0,this._pauseStart=t,this._group&&this._group.remove(this)),this},t.prototype.resume=function(t){return void 0===t&&(t=Dn()),this._isPaused&&this._isPlaying?(this._isPaused=!1,this._startTime+=t-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this):this},t.prototype.stopChainedTweens=function(){for(var t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].stop();return this},t.prototype.group=function(t){return this._group=t,this},t.prototype.delay=function(t){return this._delayTime=t,this},t.prototype.repeat=function(t){return this._initialRepeat=t,this._repeat=t,this},t.prototype.repeatDelay=function(t){return this._repeatDelayTime=t,this},t.prototype.yoyo=function(t){return this._yoyo=t,this},t.prototype.easing=function(t){return this._easingFunction=t,this},t.prototype.interpolation=function(t){return this._interpolationFunction=t,this},t.prototype.chain=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._chainedTweens=t,this},t.prototype.onStart=function(t){return this._onStartCallback=t,this},t.prototype.onUpdate=function(t){return this._onUpdateCallback=t,this},t.prototype.onRepeat=function(t){return this._onRepeatCallback=t,this},t.prototype.onComplete=function(t){return this._onCompleteCallback=t,this},t.prototype.onStop=function(t){return this._onStopCallback=t,this},t.prototype.update=function(t,e){if(void 0===t&&(t=Dn()),void 0===e&&(e=!0),this._isPaused)return!0;var n,o,i=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(t>i)return!1;e&&this.start(t)}if(this._goToEnd=!1,t<this._startTime)return!0;!1===this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),o=(t-this._startTime)/this._duration,o=0===this._duration||o>1?1:o;var r=this._easingFunction(o);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,r),this._onUpdateCallback&&this._onUpdateCallback(this._object,o),1===o){if(this._repeat>0){for(n in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat)this._yoyo||"string"!=typeof this._valuesEnd[n]||(this._valuesStartRepeat[n]=this._valuesStartRepeat[n]+parseFloat(this._valuesEnd[n])),this._yoyo&&this._swapEndStartRepeatValues(n),this._valuesStart[n]=this._valuesStartRepeat[n];return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=t+this._repeatDelayTime:this._startTime=t+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var s=0,a=this._chainedTweens.length;s<a;s++)this._chainedTweens[s].start(this._startTime+this._duration);return this._isPlaying=!1,!1}return!0},t.prototype._updateProperties=function(t,e,n,o){for(var i in n)if(void 0!==e[i]){var r=e[i]||0,s=n[i],a=Array.isArray(t[i]),c=Array.isArray(s);!a&&c?t[i]=this._interpolationFunction(s,o):"object"==typeof s&&s?this._updateProperties(t[i],r,s,o):"number"==typeof(s=this._handleRelativeValue(r,s))&&(t[i]=r+(s-r)*o)}},t.prototype._handleRelativeValue=function(t,e){return"string"!=typeof e?e:"+"===e.charAt(0)||"-"===e.charAt(0)?t+parseFloat(e):parseFloat(e)},t.prototype._swapEndStartRepeatValues=function(t){var e=this._valuesStartRepeat[t],n=this._valuesEnd[t];this._valuesStartRepeat[t]="string"==typeof n?this._valuesStartRepeat[t]+parseFloat(n):this._valuesEnd[t],this._valuesEnd[t]=e},t}(),On=(Ln.nextId,Vn);On.getAll.bind(On),On.removeAll.bind(On),On.add.bind(On),On.remove.bind(On),On.update.bind(On);function In(){const t=this;t.handlers={start:()=>{},move:()=>{},end:()=>{},touchmove:()=>{},touchstart:()=>{},touchend:()=>{}},t.set=e=>{Object.assign(t.handlers,e)}}function Gn(t){const e=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/e}function Bn(){const t=this;t.background=document.createElement("canvas"),t.background.setAttribute("class","background"),t.ctx=t.background.getContext("2d"),t.foreground=document.createElement("canvas"),t.foreground.setAttribute("class","foreground"),t.fctx=t.foreground.getContext("2d"),t.setSize=(e,n)=>{const o=`${e}px`,i=`${n}px`,r=t.pixelRatio,s=e*r,a=n*r;t.background.width=s,t.background.height=a,t.background.style.width=o,t.background.style.height=i,t.foreground.width=s,t.foreground.height=a,t.foreground.style.width=o,t.foreground.style.height=i,t.ctx.scale(r,r),t.fctx.scale(r,r)},t.setDisplayStyle=e=>{t.background.style.display=e,t.foreground.style.display=e},t.setStrokeStyle=e=>{t.ctx.strokeStyle=e,t.fctx.strokeStyle=e},t.pixelRatio=Gn(t.ctx)}function qn(t,e){const n=this;n.div=document.createElement("div");const o=document.createElement("button");o.className="button2",o.innerText="Make SVG",o.onclick=function(){t.setFCtx(t.svg.ctx),e.clear(),e.render(),e.renderForeground();const n=t.svg.ctx.getSerializedSvg(!0),o=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(n)}`;i.href=o,t.setFCtx(t.svg.fctx),e.rerender()};const i=document.createElement("a");i.innerText="vote.svg",i.download="vote.svg",i.style.margin="4px",n.div.append(o),n.div.appendChild(i),n.setShowDownloadScreenLink=t=>{t?(o.hidden=!1,i.hidden=!1):(o.hidden=!0,i.hidden=!0)},n.setShowDownloadScreenLink(t.common.showDownloadScreenLink)}
/*!!
 *  Canvas 2 Svg v1.0.21
 *  A low level canvas to SVG converter. Uses a mock canvas context to build an SVG document.
 *
 *  Licensed under the MIT license:
 *  http://www.opensource.org/licenses/mit-license.php
 *
 *  Author:
 *  Kerry Liu
 *
 *  Copyright (c) 2014 Gliffy Inc.
 */function jn(t,e){var n,o=Object.keys(e);for(n=0;n<o.length;n++)t=t.replace(new RegExp("\\{"+o[n]+"\\}","gi"),e[o[n]]);return t}function Hn(t){var e,n,o;if(!t)throw new Error("cannot create a random attribute name for an undefined object");e="ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",n="";do{for(n="",o=0;o<12;o++)n+=e[Math.floor(Math.random()*e.length)]}while(t[n]);return n}function Un(t){var e={alphabetic:"alphabetic",hanging:"hanging",top:"text-before-edge",bottom:"text-after-edge",middle:"central"};return e[t]||e.alphabetic}En=function(t,e){var n,o,i,r={};for(t=t.split(","),e=e||10,n=0;n<t.length;n+=2)o="&"+t[n+1]+";",i=parseInt(t[n],e),r[o]="&#"+i+";";return r["\\xa0"]="&#160;",r}("50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro",32),Sn={strokeStyle:{svgAttr:"stroke",canvas:"#000000",svg:"none",apply:"stroke"},fillStyle:{svgAttr:"fill",canvas:"#000000",svg:null,apply:"fill"},lineCap:{svgAttr:"stroke-linecap",canvas:"butt",svg:"butt",apply:"stroke"},lineJoin:{svgAttr:"stroke-linejoin",canvas:"miter",svg:"miter",apply:"stroke"},miterLimit:{svgAttr:"stroke-miterlimit",canvas:10,svg:4,apply:"stroke"},lineWidth:{svgAttr:"stroke-width",canvas:1,svg:1,apply:"stroke"},globalAlpha:{svgAttr:"opacity",canvas:1,svg:1,apply:"fill stroke"},font:{canvas:"10px sans-serif"},shadowColor:{canvas:"#000000"},shadowOffsetX:{canvas:0},shadowOffsetY:{canvas:0},shadowBlur:{canvas:0},textAlign:{canvas:"start"},textBaseline:{canvas:"alphabetic"},lineDash:{svgAttr:"stroke-dasharray",canvas:[],svg:null,apply:"stroke"}},(An=function(t,e){this.__root=t,this.__ctx=e}).prototype.addColorStop=function(t,e){var n,o=this.__ctx.__createElement("stop");o.setAttribute("offset",t),-1!==e.indexOf("rgba")?(n=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi.exec(e),o.setAttribute("stop-color",jn("rgb({r},{g},{b})",{r:n[1],g:n[2],b:n[3]})),o.setAttribute("stop-opacity",n[4])):o.setAttribute("stop-color",e),this.__root.appendChild(o)},Mn=function(t,e){this.__root=t,this.__ctx=e},(kn=function(t){var e,n={width:500,height:500,enableMirroring:!1};if(arguments.length>1?((e=n).width=arguments[0],e.height=arguments[1]):e=t||n,!(this instanceof kn))return new kn(e);this.width=e.width||n.width,this.height=e.height||n.height,this.enableMirroring=void 0!==e.enableMirroring?e.enableMirroring:n.enableMirroring,this.canvas=this,this.__document=e.document||document,e.ctx?this.__ctx=e.ctx:(this.__canvas=this.__document.createElement("canvas"),this.__ctx=this.__canvas.getContext("2d")),this.__setDefaultStyles(),this.__stack=[this.__getStyleState()],this.__groupStack=[],this.__root=this.__document.createElementNS("http://www.w3.org/2000/svg","svg"),this.__root.setAttribute("version",1.1),this.__root.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.__root.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),this.__root.setAttribute("width",this.width),this.__root.setAttribute("height",this.height),this.__ids={},this.__defs=this.__document.createElementNS("http://www.w3.org/2000/svg","defs"),this.__root.appendChild(this.__defs),this.__currentElement=this.__document.createElementNS("http://www.w3.org/2000/svg","g"),this.__root.appendChild(this.__currentElement)}).prototype.__createElement=function(t,e,n){void 0===e&&(e={});var o,i,r=this.__document.createElementNS("http://www.w3.org/2000/svg",t),s=Object.keys(e);for(n&&(r.setAttribute("fill","none"),r.setAttribute("stroke","none")),o=0;o<s.length;o++)i=s[o],r.setAttribute(i,e[i]);return r},kn.prototype.__setDefaultStyles=function(){var t,e,n=Object.keys(Sn);for(t=0;t<n.length;t++)this[e=n[t]]=Sn[e].canvas},kn.prototype.__applyStyleState=function(t){var e,n,o=Object.keys(t);for(e=0;e<o.length;e++)this[n=o[e]]=t[n]},kn.prototype.__getStyleState=function(){var t,e,n={},o=Object.keys(Sn);for(t=0;t<o.length;t++)n[e=o[t]]=this[e];return n},kn.prototype.__applyStyleToCurrentElement=function(t){var e=this.__currentElement,n=this.__currentElementsToStyle;n&&(e.setAttribute(t,""),e=n.element,n.children.forEach((function(e){e.setAttribute(t,"")})));var o,i,r,s,a,c=Object.keys(Sn);for(o=0;o<c.length;o++)if(i=Sn[c[o]],r=this[c[o]],i.apply)if(r instanceof Mn){if(r.__ctx)for(;r.__ctx.__defs.childNodes.length;)s=r.__ctx.__defs.childNodes[0].getAttribute("id"),this.__ids[s]=s,this.__defs.appendChild(r.__ctx.__defs.childNodes[0]);e.setAttribute(i.apply,jn("url(#{id})",{id:r.__root.getAttribute("id")}))}else if(r instanceof An)e.setAttribute(i.apply,jn("url(#{id})",{id:r.__root.getAttribute("id")}));else if(-1!==i.apply.indexOf(t)&&i.svg!==r)if("stroke"!==i.svgAttr&&"fill"!==i.svgAttr||-1===r.indexOf("rgba")){var l=i.svgAttr;if("globalAlpha"===c[o]&&(l=t+"-"+i.svgAttr,e.getAttribute(l)))continue;e.setAttribute(l,r)}else{a=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi.exec(r),e.setAttribute(i.svgAttr,jn("rgb({r},{g},{b})",{r:a[1],g:a[2],b:a[3]}));var u=a[4],h=this.globalAlpha;null!=h&&(u*=h),e.setAttribute(i.svgAttr+"-opacity",u)}},kn.prototype.__closestGroupOrSvg=function(t){return"g"===(t=t||this.__currentElement).nodeName||"svg"===t.nodeName?t:this.__closestGroupOrSvg(t.parentNode)},kn.prototype.getSerializedSvg=function(t){var e,n,o,i,r,s=(new XMLSerializer).serializeToString(this.__root);if(/xmlns="http:\/\/www\.w3\.org\/2000\/svg".+xmlns="http:\/\/www\.w3\.org\/2000\/svg/gi.test(s)&&(s=s.replace('xmlns="http://www.w3.org/2000/svg','xmlns:xlink="http://www.w3.org/1999/xlink')),t)for(e=Object.keys(En),n=0;n<e.length;n++)o=e[n],i=En[o],(r=new RegExp(o,"gi")).test(s)&&(s=s.replace(r,i));return s},kn.prototype.getSvg=function(){return this.__root},kn.prototype.save=function(){var t=this.__createElement("g"),e=this.__closestGroupOrSvg();this.__groupStack.push(e),e.appendChild(t),this.__currentElement=t,this.__stack.push(this.__getStyleState())},kn.prototype.restore=function(){this.__currentElement=this.__groupStack.pop(),this.__currentElementsToStyle=null,this.__currentElement||(this.__currentElement=this.__root.childNodes[1]);var t=this.__stack.pop();this.__applyStyleState(t)},kn.prototype.__addTransform=function(t){var e=this.__closestGroupOrSvg();if(e.childNodes.length>0){"path"===this.__currentElement.nodeName&&(this.__currentElementsToStyle||(this.__currentElementsToStyle={element:e,children:[]}),this.__currentElementsToStyle.children.push(this.__currentElement),this.__applyCurrentDefaultPath());var n=this.__createElement("g");e.appendChild(n),this.__currentElement=n}var o=this.__currentElement.getAttribute("transform");o?o+=" ":o="",o+=t,this.__currentElement.setAttribute("transform",o)},kn.prototype.scale=function(t,e){void 0===e&&(e=t),this.__addTransform(jn("scale({x},{y})",{x:t,y:e}))},kn.prototype.rotate=function(t){var e=180*t/Math.PI;this.__addTransform(jn("rotate({angle},{cx},{cy})",{angle:e,cx:0,cy:0}))},kn.prototype.translate=function(t,e){this.__addTransform(jn("translate({x},{y})",{x:t,y:e}))},kn.prototype.transform=function(t,e,n,o,i,r){this.__addTransform(jn("matrix({a},{b},{c},{d},{e},{f})",{a:t,b:e,c:n,d:o,e:i,f:r}))},kn.prototype.beginPath=function(){var t;this.__currentDefaultPath="",this.__currentPosition={},t=this.__createElement("path",{},!0),this.__closestGroupOrSvg().appendChild(t),this.__currentElement=t},kn.prototype.__applyCurrentDefaultPath=function(){var t=this.__currentElement;"path"===t.nodeName?t.setAttribute("d",this.__currentDefaultPath):console.error("Attempted to apply path command to node",t.nodeName)},kn.prototype.__addPathCommand=function(t){this.__currentDefaultPath+=" ",this.__currentDefaultPath+=t},kn.prototype.moveTo=function(t,e){"path"!==this.__currentElement.nodeName&&this.beginPath(),this.__currentPosition={x:t,y:e},this.__addPathCommand(jn("M {x} {y}",{x:t,y:e}))},kn.prototype.closePath=function(){this.__currentDefaultPath&&this.__addPathCommand("Z")},kn.prototype.lineTo=function(t,e){this.__currentPosition={x:t,y:e},this.__currentDefaultPath.indexOf("M")>-1?this.__addPathCommand(jn("L {x} {y}",{x:t,y:e})):this.__addPathCommand(jn("M {x} {y}",{x:t,y:e}))},kn.prototype.bezierCurveTo=function(t,e,n,o,i,r){this.__currentPosition={x:i,y:r},this.__addPathCommand(jn("C {cp1x} {cp1y} {cp2x} {cp2y} {x} {y}",{cp1x:t,cp1y:e,cp2x:n,cp2y:o,x:i,y:r}))},kn.prototype.quadraticCurveTo=function(t,e,n,o){this.__currentPosition={x:n,y:o},this.__addPathCommand(jn("Q {cpx} {cpy} {x} {y}",{cpx:t,cpy:e,x:n,y:o}))};var $n=function(t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]);return[t[0]/e,t[1]/e]};kn.prototype.arcTo=function(t,e,n,o,i){var r=this.__currentPosition&&this.__currentPosition.x,s=this.__currentPosition&&this.__currentPosition.y;if(void 0!==r&&void 0!==s){if(i<0)throw new Error("IndexSizeError: The radius provided ("+i+") is negative.");if(r===t&&s===e||t===n&&e===o||0===i)this.lineTo(t,e);else{var a=$n([r-t,s-e]),c=$n([n-t,o-e]);if(a[0]*c[1]!=a[1]*c[0]){var l=a[0]*c[0]+a[1]*c[1],u=Math.acos(Math.abs(l)),h=$n([a[0]+c[0],a[1]+c[1]]),d=i/Math.sin(u/2),f=t+d*h[0],p=e+d*h[1],m=[-a[1],a[0]],g=[c[1],-c[0]],y=function(t){var e=t[0];return t[1]>=0?Math.acos(e):-Math.acos(e)},w=y(m),v=y(g);this.lineTo(f+m[0]*i,p+m[1]*i),this.arc(f,p,i,w,v)}else this.lineTo(t,e)}}},kn.prototype.stroke=function(){"path"===this.__currentElement.nodeName&&this.__currentElement.setAttribute("paint-order","fill stroke markers"),this.__applyCurrentDefaultPath(),this.__applyStyleToCurrentElement("stroke")},kn.prototype.fill=function(){"path"===this.__currentElement.nodeName&&this.__currentElement.setAttribute("paint-order","stroke fill markers"),this.__applyCurrentDefaultPath(),this.__applyStyleToCurrentElement("fill")},kn.prototype.rect=function(t,e,n,o){"path"!==this.__currentElement.nodeName&&this.beginPath(),this.moveTo(t,e),this.lineTo(t+n,e),this.lineTo(t+n,e+o),this.lineTo(t,e+o),this.lineTo(t,e),this.closePath()},kn.prototype.fillRect=function(t,e,n,o){var i;i=this.__createElement("rect",{x:t,y:e,width:n,height:o},!0),this.__closestGroupOrSvg().appendChild(i),this.__currentElement=i,this.__applyStyleToCurrentElement("fill")},kn.prototype.strokeRect=function(t,e,n,o){var i;i=this.__createElement("rect",{x:t,y:e,width:n,height:o},!0),this.__closestGroupOrSvg().appendChild(i),this.__currentElement=i,this.__applyStyleToCurrentElement("stroke")},kn.prototype.__clearCanvas=function(){for(var t=this.__closestGroupOrSvg().getAttribute("transform"),e=this.__root.childNodes[1],n=e.childNodes,o=n.length-1;o>=0;o--)n[o]&&e.removeChild(n[o]);this.__currentElement=e,this.__groupStack=[],t&&this.__addTransform(t)},kn.prototype.clearRect=function(t,e,n,o){if(0!==t||0!==e||n!==this.width||o!==this.height){var i,r=this.__closestGroupOrSvg();i=this.__createElement("rect",{x:t,y:e,width:n,height:o,fill:"#FFFFFF"},!0),r.appendChild(i)}else this.__clearCanvas()},kn.prototype.createLinearGradient=function(t,e,n,o){var i=this.__createElement("linearGradient",{id:Hn(this.__ids),x1:t+"px",x2:n+"px",y1:e+"px",y2:o+"px",gradientUnits:"userSpaceOnUse"},!1);return this.__defs.appendChild(i),new An(i,this)},kn.prototype.createRadialGradient=function(t,e,n,o,i,r){var s=this.__createElement("radialGradient",{id:Hn(this.__ids),cx:o+"px",cy:i+"px",r:r+"px",fx:t+"px",fy:e+"px",gradientUnits:"userSpaceOnUse"},!1);return this.__defs.appendChild(s),new An(s,this)},kn.prototype.__parseFont=function(){var t=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-,\'\"\sa-z0-9]+?)\s*$/i.exec(this.font),e={style:t[1]||"normal",size:t[4]||"10px",family:t[6]||"sans-serif",weight:t[3]||"normal",decoration:t[2]||"normal",href:null};return"underline"===this.__fontUnderline&&(e.decoration="underline"),this.__fontHref&&(e.href=this.__fontHref),e},kn.prototype.__wrapTextLink=function(t,e){if(t.href){var n=this.__createElement("a");return n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t.href),n.appendChild(e),n}return e},kn.prototype.__applyText=function(t,e,n,o){var i,r,s=this.__parseFont(),a=this.__closestGroupOrSvg(),c=this.__createElement("text",{"font-family":s.family,"font-size":s.size,"font-style":s.style,"font-weight":s.weight,"text-decoration":s.decoration,x:e,y:n,"text-anchor":(i=this.textAlign,r={left:"start",right:"end",center:"middle",start:"start",end:"end"},r[i]||r.start),"dominant-baseline":Un(this.textBaseline)},!0);c.appendChild(this.__document.createTextNode(t)),this.__currentElement=c,this.__applyStyleToCurrentElement(o),a.appendChild(this.__wrapTextLink(s,c))},kn.prototype.fillText=function(t,e,n){this.__applyText(t,e,n,"fill")},kn.prototype.strokeText=function(t,e,n){this.__applyText(t,e,n,"stroke")},kn.prototype.measureText=function(t){return this.__ctx.font=this.font,this.__ctx.measureText(t)},kn.prototype.arc=function(t,e,n,o,i,r){if(o!==i){(o%=2*Math.PI)===(i%=2*Math.PI)&&(i=(i+2*Math.PI-.001*(r?-1:1))%(2*Math.PI));var s=t+n*Math.cos(i),a=e+n*Math.sin(i),c=t+n*Math.cos(o),l=e+n*Math.sin(o),u=r?0:1,h=0,d=i-o;d<0&&(d+=2*Math.PI),h=r?d>Math.PI?0:1:d>Math.PI?1:0,this.lineTo(c,l),this.__addPathCommand(jn("A {rx} {ry} {xAxisRotation} {largeArcFlag} {sweepFlag} {endX} {endY}",{rx:n,ry:n,xAxisRotation:0,largeArcFlag:h,sweepFlag:u,endX:s,endY:a})),this.__currentPosition={x:s,y:a}}},kn.prototype.clip=function(){var t=this.__closestGroupOrSvg(),e=this.__createElement("clipPath"),n=Hn(this.__ids),o=this.__createElement("g");this.__applyCurrentDefaultPath(),t.removeChild(this.__currentElement),e.setAttribute("id",n),e.appendChild(this.__currentElement),this.__defs.appendChild(e),t.setAttribute("clip-path",jn("url(#{id})",{id:n})),t.appendChild(o),this.__currentElement=o},kn.prototype.drawImage=function(){var t,e,n,o,i,r,s,a,c,l,u,h,d,f,p=Array.prototype.slice.call(arguments),m=p[0],g=0,y=0;if(3===p.length)t=p[1],e=p[2],n=i=m.width,o=r=m.height;else if(5===p.length)t=p[1],e=p[2],n=p[3],o=p[4],i=m.width,r=m.height;else{if(9!==p.length)throw new Error("Inavlid number of arguments passed to drawImage: "+arguments.length);g=p[1],y=p[2],i=p[3],r=p[4],t=p[5],e=p[6],n=p[7],o=p[8]}s=this.__closestGroupOrSvg(),this.__currentElement;var w="translate("+t+", "+e+")";if(m instanceof kn){if((a=m.getSvg().cloneNode(!0)).childNodes&&a.childNodes.length>1){for(c=a.childNodes[0];c.childNodes.length;)f=c.childNodes[0].getAttribute("id"),this.__ids[f]=f,this.__defs.appendChild(c.childNodes[0]);if(l=a.childNodes[1]){var v,_=l.getAttribute("transform");v=_?_+" "+w:w,l.setAttribute("transform",v),s.appendChild(l)}}}else"IMG"===m.nodeName?((u=this.__createElement("image")).setAttribute("width",n),u.setAttribute("height",o),u.setAttribute("preserveAspectRatio","none"),(g||y||i!==m.width||r!==m.height)&&((h=this.__document.createElement("canvas")).width=n,h.height=o,(d=h.getContext("2d")).drawImage(m,g,y,i,r,0,0,n,o),m=h),u.setAttribute("transform",w),u.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","CANVAS"===m.nodeName?m.toDataURL():m.getAttribute("src")),s.appendChild(u)):"CANVAS"===m.nodeName&&((u=this.__createElement("image")).setAttribute("width",n),u.setAttribute("height",o),u.setAttribute("preserveAspectRatio","none"),(h=this.__document.createElement("canvas")).width=n,h.height=o,(d=h.getContext("2d")).imageSmoothingEnabled=!1,d.mozImageSmoothingEnabled=!1,d.oImageSmoothingEnabled=!1,d.webkitImageSmoothingEnabled=!1,d.drawImage(m,g,y,i,r,0,0,n,o),m=h,u.setAttribute("transform",w),u.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",m.toDataURL()),s.appendChild(u))},kn.prototype.drawImageSvg=function(){var t,e,n,o,i,r,s,a,c=Array.prototype.slice.call(arguments),l=c[0];if(3===c.length)t=c[1],e=c[2],n=l.width,o=l.height;else if(5===c.length)t=c[1],e=c[2],n=c[3],o=c[4],l.width,l.height;else{if(9!==c.length)throw new Error("Inavlid number of arguments passed to drawImage: "+arguments.length);c[1],c[2],c[3],c[4],t=c[5],e=c[6],n=c[7],o=c[8]}i=this.__closestGroupOrSvg(),this.__currentElement;var u="translate("+t+", "+e+")";if(l instanceof SVGSVGElement&&l.childNodes&&l.childNodes.length>1){var h=parseFloat(l.getAttribute("width")),d=parseFloat(l.getAttribute("height"));l.setAttribute("width",n),l.setAttribute("height",o);var f=n/h,p=o/d;for(r=l.childNodes[0];r.childNodes.length;)a=r.childNodes[0].getAttribute("id"),this.__ids[a]=a,this.__defs.appendChild(r.childNodes[0]);if(s=l.childNodes[1]){var m,g=s.getAttribute("transform");m=g?g+" "+u:u,s.setAttribute("transform",m+" scale("+f+", "+p+")"),i.appendChild(s)}}},kn.prototype.createPattern=function(t,e){var n,o=this.__document.createElementNS("http://www.w3.org/2000/svg","pattern"),i=Hn(this.__ids);return o.setAttribute("id",i),o.setAttribute("width",t.width),o.setAttribute("height",t.height),"CANVAS"===t.nodeName||"IMG"===t.nodeName?((n=this.__document.createElementNS("http://www.w3.org/2000/svg","image")).setAttribute("width",t.width),n.setAttribute("height",t.height),n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","CANVAS"===t.nodeName?t.toDataURL():t.getAttribute("src")),o.appendChild(n),this.__defs.appendChild(o)):t instanceof kn&&(o.appendChild(t.__root.childNodes[1]),this.__defs.appendChild(o)),new Mn(o,this)},kn.prototype.setLineDash=function(t){t&&t.length>0?this.lineDash=t.join(","):this.lineDash=null},kn.prototype.drawFocusRing=function(){},kn.prototype.createImageData=function(){},kn.prototype.getImageData=function(){},kn.prototype.putImageData=function(){},kn.prototype.globalCompositeOperation=function(){},kn.prototype.setTransform=function(){};var Wn=kn;function zn(){const t=this;t.ctx=new Wn,t.background=t.ctx.getSvg(),t.background.setAttribute("class","background"),t.fctx=new Wn,t.foreground=t.fctx.getSvg(),t.foreground.setAttribute("class","foreground"),t.setSize=(e,n)=>{const o=`${e}px`,i=`${n}px`;t.ctx.width=e,t.ctx.height=n,t.background.style.width=o,t.background.style.height=i,t.fctx.width=e,t.fctx.height=n,t.foreground.style.width=o,t.foreground.style.height=i},t.setDisplayStyle=e=>{t.background.style.display=e,t.foreground.style.display=e},t.setStrokeStyle=e=>{t.ctx.strokeStyle=e,t.fctx.strokeStyle=e}}function Xn(t,e,n,o){const i=this;i.common=t,i.common.attach(i),i.canvas=new Bn,i.svg=new zn,i.download=new qn(i,e),i.setShowDownloadScreenLink=i.download.setShowDownloadScreenLink,i.tweenGroup=new Nn,i.tooltips=document.createElement("div"),i.tooltips.setAttribute("class","tooltips");const r=document.createElement("div");i.wrap=document.createElement("div"),i.wrap.setAttribute("class","screenWrap"),i.wrap.appendChild(r),i.wrap.appendChild(i.canvas.background),i.wrap.appendChild(i.canvas.foreground),i.wrap.appendChild(i.svg.background),i.wrap.appendChild(i.svg.foreground),i.wrap.appendChild(i.tooltips),i.outer=document.createElement("div"),i.outer.appendChild(i.wrap),i.outer.appendChild(i.download.div),n.newElement(o,i.outer),i.setSize=(t,e)=>{const n=`${t}px`,o=`${e}px`;i.width=t,i.height=e,i.tooltips.style.width=n,i.tooltips.style.height=o,i.wrap.style.width=n,i.wrap.style.height=o,i.svg.setSize(t,e),i.canvas.setSize(t,e)},i.setWidth=t=>{i.setSize(t,i.height)},i.setHeight=t=>{i.setSize(i.width,t)};const{width:s,height:a}=t;i.setSize(s,a),i.setFCtx=t=>{i.fctx=t},i.clear=function(){i.ctx.clearRect(0,0,i.width,i.height),i.common.darkMode&&i.noBuffers&&(i.ctx.fillStyle="#222",i.ctx.fillRect(0,0,i.width,i.height),i.ctx.fillStyle="white")},i.clearForeground=function(){i.fctx.clearRect(0,0,i.width,i.height)},i.switchToSVG=()=>{i.ctx=i.svg.ctx,i.fctx=i.svg.fctx,i.canvas.setDisplayStyle("none"),i.svg.setDisplayStyle("block"),i.noBuffers=!0},i.switchToCanvas=()=>{i.ctx=i.canvas.ctx,i.fctx=i.canvas.fctx,i.canvas.setDisplayStyle("block"),i.svg.setDisplayStyle("none"),i.noBuffers=!1},i.setSvgMode=t=>{t?i.switchToSVG():i.switchToCanvas()},i.setSvgMode(!1),i.show=()=>{i.outer.style.display="block"},i.hide=()=>{i.outer.style.display="none"},i.setDarkMode=t=>{const e=t?"#ddd":"#222";i.canvas.setStrokeStyle(e),i.svg.setStrokeStyle(e)},i.setDarkMode(t.darkMode),i.eventHandlers=new In;const{handlers:c}=i.eventHandlers;i.wrap.onmousedown=t=>c.start(t),i.wrap.onmousemove=t=>c.move(t),i.wrap.onmouseup=t=>c.end(t),i.wrap.addEventListener("touchmove",(t=>c.touchmove(t))),i.wrap.addEventListener("touchstart",(t=>c.touchstart(t))),i.wrap.addEventListener("touchend",(t=>c.touchend(t)));const l=document.onmouseup;document.onmouseup=t=>{l&&l(t),i.wrap.onmouseup(t)}}function Yn(t,e){const n=this;n.config=t,n.name=t.name,n.nameIsHTML=t.nameIsHTML||!1,n.dom=document.createElement("div"),n.dom.setAttribute("class","button button2");let o=t.margin;o=o||0,o=Math.max(o,4),n.dom.style.marginRight=`${o}px`,n.draw=function(){n.nameIsHTML?n.dom.innerHTML=n.name:n.dom.innerText=n.name},n.draw(),n.dom.setAttribute("title",t.realname||""),n.onClick=function(){e(n,t)},n.dom.onclick=n.onClick,n.turnOff=function(){n.isOn=!1,n.config.isOn=!1,n.dom.setAttribute("on","no")},n.turnOn=function(){n.isOn=!0,n.config.isOn=!0,n.dom.setAttribute("on","yes")},n.turnOff()}function Jn(t){const e=this;e.config=t,void 0===t.data&&(t.data=[],void 0===t.makeData&&(t.makeData=()=>[]),e.makeData=t.makeData,e.buttonConfigs=e.makeData(),e.doMakeData=!0),e.buttonConfigs=t.data,e.labelName=t.label,e.labelIsHTML=t.labelIsHTML||!1,e.onChoose=t.onChoose,e.isCheckbox=t.isCheckbox||!1,e.isCheckboxBool=t.isCheckboxBool||!1,e.justButton=t.justButton||!1,e.buttonHidden=t.buttonHidden||{},e.dom=document.createElement("div"),e.dom.setAttribute("class","button-group"),e.buttonDOMByValue=[],e.init=function(){e.doMakeData&&(e.buttonConfigs=e.makeData()),e.dom.innerHTML="",e.buttons=[],e.buttonsByName={},e.labelDOM=document.createElement("div"),e.labelDOM.setAttribute("class","button-group-label"),e.draw(),e.dom.appendChild(e.labelDOM);for(let n=0;n<e.buttonConfigs.length;n++){const o=e.buttonConfigs[n],i=new Yn(o,e.onToggle);e.buttonsByName[o.name]=i,i.dom.style.width=`${t.width}px`,o.width&&(i.dom.style.width=`${o.width}px`),e.buttons.push(i),e.dom.appendChild(i.dom),e.buttonDOMByValue[o.value]=i.dom}for(let t=0;t<e.buttons.length;t++){const n=e.buttons[t];if(n.config.selected){n.turnOn();break}}e.draw()},e.updateNames=function(){const t=e.makeData();for(let n=0;n<e.buttonConfigs.length;n++)e.buttonConfigs[n].name=t[n].name,e.buttons[n].name=e.buttonConfigs[n].name},e.redraw=function(){e.updateNames(),e.draw()},e.draw=function(){e.labelIsHTML?e.labelDOM.innerHTML=e.labelName:e.labelDOM.innerText=e.labelName;for(const t of e.buttons)t.draw()},e.configureHidden=function(){for(const[t,n]of Object.entries(e.buttonHidden))e.buttonsByName[t].dom.hidden=n},e.onToggle=function(t,n){if(e.isCheckbox||e.isCheckboxBool)t.isOn?t.turnOff():t.turnOn();else{for(let t=0;t<e.buttons.length;t++)e.buttons[t].turnOff();t.turnOn(),e.justButton&&setTimeout((()=>t.turnOff()),800)}e.onChoose(n)},e.highlight=function(t,n){if(0!==e.buttons.length){for(let t=0;t<e.buttons.length;t++)e.buttons[t].turnOff();if(e.isCheckbox)for(const o in e.buttons){const i=e.buttons[o];n.includes(i.config[t])&&i.turnOn()}else if(e.isCheckboxBool)for(const o in e.buttons){const i=e.buttons[o],r=i.config[t];r in n&&n[r]&&i.turnOn()}else{const o=e.buttons.filter((e=>{const{config:o}=e;return o[t]===n}))[0];void 0!==o&&o.turnOn()}}},e.init()}function Kn(t,e,n,o,i,r,s,a){const c=this;c.list=i,c.onChoose=function(t){c.sender.go(t.value)},c.action=t=>{c.set(t),c.select()},c.sender=a.addSender({name:e,action:c.action,currentValue:t[e]}),c.set=function(t){n(t),c.configure(),s.add(r)},c.choose=new Jn({label:o,width:Qn(3),data:c.list,onChoose:c.onChoose}),c.configure=function(){},c.select=function(){c.choose.highlight("value",t[e])}}function Qn(t){return(302-18*(t-1)-10)/t}function Zn(t,e,n){const o=new Jn({label:"Theme",width:Qn(3),data:[{name:"Light",value:!1},{name:"Dark",value:!0}],onChoose:e=>{t.setDarkMode(e.value),n.rerender()}});o.highlight("value",t.darkMode),e.newElement("darkModeSwitch",o.dom)}function to(t){const e=this;e.setShowNonExistingEntities=n=>{e.showGhosts=n,t.add(["showGhosts"])}}function eo(){const t=this;t.enter=()=>{},t.exit=()=>{},t.update=function(){},t.render=function(){}}function no(t){const{socialChoiceResults:e,votes:n,colorRGBAOfCandidates:o}=t,{winnersByRound:i,winnerMaxCostPerScoreByRound:r}=e.explanation,{scoreVotes:s,gridData:a}=n,c=i.length,l=a.length,u=[],h=[],d=[];for(let t=0;t<l;t++){const{voteIndex:e}=a[t],n=e.length,l=[];l[0]=Array(n).fill(1);const f=[],p=[];for(let t=0;t<c;t++){const a=l[t],u=Array(n),h=Array(n),d=i[t],m=r[t];for(let t=0;t<n;t++){const n=m*s[e[t]][d];h[t]=Math.min(a[t],n),u[t]=Math.max(0,a[t]-n)}f[t]=h,p[t]=o[d],t<c-1&&(l[t+1]=u)}d[t]=p,u[t]=f,h[t]=l}return{costsByGeom:u,budgetsByGeom:h,colorRGBAByGeom:d}}function oo(t,e,n){const{socialChoiceResults:o,votes:i}=t,{winnersByRound:r}=o.explanation,{costsByGeom:s,budgetsByGeom:a,colorRGBAByGeom:c}=n,{gridData:l}=i,u=r.length,h=l.length,d=1/3,f=-e.width/3,p=e.width/3,m=[],g=[];for(let t=0;t<h;t++){const{grid:n,voteIndex:o,voterGeom:i}=l[t],{w:r,densityProfile:c}=i,h=i.x,y=n.x,w="gaussian"===c,v=r/Math.sqrt(2*Math.PI),_=o.length,x=a[t],b=s[t],C=[],S=[];for(let t=0;t<u;t++){const n=x[t],o=b[t],i=[],r=[],s=t%3*p,a=(Math.floor(t/3)+1)*p;let c=0;const l=0*f+a,u=Math.max(-1,y[0])*d+s;i[c]=[u,l],r[c]=[u,l],c+=1;for(let t=0;t<_;t++){const l=y[t];if(l<-1)continue;if(l>e.width+1)continue;const u=w?Math.exp(-.5*((l-h)/v)**2):1,p=o[t]*u,m=l*d+s,g=n[t]*u*f+a;i[c]=[m,g];const _=l*d+s,x=p*f+a;r[c]=[_,x],c+=1}const m=Math.min(e.width+1,y[_-1])*d+s;i[c]=[m,l],r[c]=[m,l],c+=1,i[c]=[u,l],r[c]=[u,l],c+=1,S[t]=r,C[t]=i}m[t]=S,g[t]=C}return{costShapesbyGeom:m,budgetShapesbyGeom:g,colorRGBAByGeom:c}}function io(t,e){const n=t.length,o=[0,0,0];let i=0;for(let r=0;r<n;r++){for(let n=0;n<3;n++)o[n]+=t[r]*e[r][n]**2;i+=t[r]}return o.map((t=>Math.round(Math.sqrt(t/i))))}function ro(t){return`rgb(${t[0]},${t[1]},${t[2]})`}function so(t,e){const{costShapesbyGeom:n,budgetShapesbyGeom:o,colorRGBAByGeom:i}=e,r=n.length,{ctx:s}=t;s.save(),s.globalAlpha=.7;for(let t=0;t<r;t++){const e=n[t],r=o[t],a=i[t],c=e.length;for(let t=0;t<c;t++){const n=e[t],o=r[t],i=a[t];s.fillStyle="#cccccc",s.strokeStyle="#555555",s.beginPath(),s.moveTo(o[0][0],o[0][1]);for(let t=1;t<o.length;t++)s.lineTo(o[t][0],o[t][1]);s.fill(),s.stroke(),s.fillStyle=ro(i),s.strokeStyle=ro(io([.5,.5],[i,[0,0,0]])),s.beginPath(),s.moveTo(n[0][0],n[0][1]);for(let t=1;t<n.length;t++)s.lineTo(n[t][0],n[t][1]);s.fill(),s.stroke()}}s.restore()}function ao(t){const e=this;let n,o=!1;e.enter=()=>{t.show()},e.exit=()=>{t.hide()},e.update=function(e){const{error:i}=e;if(void 0!==i)return void(o=!0);o=!1;const r=no(e);n=oo(e,t,r)},e.render=function(){o||so(t,n)}}function co(t,e,n,o,i,r,s){const a=this;s.viewModes.one.attach(a);const c=new Xn(t,s,e,"budget"),{height:l}=t;let u;function h(){const{socialChoiceMethod:t}=r,{dimensions:e,numDistricts:n}=i;u=new("methodOfEqualShares"===t&&1===n&&1===e?ao:eo)(c)}c.setHeight(l/3),c.hide(),h(),a.enter=()=>{h(),u.enter()},a.exit=()=>{u.exit()},a.update=t=>{if(o.checkNone())return;o.check(["numDistricts","dimensions","socialChoiceMethod"])&&(a.exit(),a.enter());const{electionResults:e}=t;u.update(e),a.clear(),a.render()},a.render=()=>{u.render()},a.clear=()=>{c.clear()},a.draw=()=>{a.clear(),a.render()}}function lo(t){let e,n;this.update=t=>{e=t.geometry.voterDistricts,n=t.geometry.dimensions},this.render=()=>{e.voterGroupsByTract.forEach((t=>{t.forEach((t=>{t.forEach((t=>{if(1===n){const{x:e}=t.shape1,{y:n}=t.shape2;r(e,n%100+0)}else{const{x:e,y:n}=t.shape2;r(e,n)}}))}))}))};const o=document.createElement("canvas"),i=o.getContext("2d");function r(e,n){const{ctx:i}=t;i.drawImage(o,e-5,n-5,10,10)}o.width=10,o.height=10,i.beginPath(),i.fillStyle="#555",i.arc(5,5,1,0,2*Math.PI),i.fill()}function uo(t,e){const n=this;n.render=function(){const{ctx:n}=e,{darkMode:o}=e.common,{x:i,w:r,densityProfile:s}=t.shape1,a=100;n.save(),n.strokeStyle="#555",o&&(n.strokeStyle="#ddd"),n.beginPath(),"gaussian"===s?function(){const t=r/Math.sqrt(2*Math.PI),o=a,s=200;n.moveTo(0,s);const c=[];for(let r=0;r<=e.width;r+=1){const e=.5*((r-i)/t)**2,a=s-o*Math.exp(-e);c.push(a),n.lineTo(r,a)}n.lineTo(e.width,s),n.lineTo(0,s)}():n.rect(i-.5*r,100,r,a),n.stroke(),n.restore()},n.renderAt=()=>{n.render()}}function ho(t,e){const n=this;n.render=function(){const{ctx:n}=e,{darkMode:o}=e.common,{x:i,y:r,w:s}=t.shape2;n.beginPath(),n.strokeStyle="#555",o&&(n.strokeStyle="#ddd"),n.arc(i,r,.5*s,0,2*Math.PI),n.stroke()},n.renderAt=function(n,o){const{ctx:i}=e,{darkMode:r}=e.common,{w:s}=t.shape2;i.beginPath(),i.strokeStyle="#555",r&&(i.strokeStyle="#ddd"),i.arc(n,o,.5*s,0,2*Math.PI),i.stroke()},n.renderCenterAt2=function(t,n){const{ctx:o}=e,{darkMode:i}=e.common;o.beginPath(),o.fillStyle="#555",i&&(o.fillStyle="#bbb"),o.arc(t,n,1,0,2*Math.PI),o.fill()}}function fo(t,e,n,o,i){const r=this,{dimensions:s}=i,a=1===s?uo:ho;t.setRenderer((t=>new a(t,n)));const c=new lo(n);r.enter=()=>{},r.exit=()=>{},r.update=t=>{c.update(t)},r.render=()=>{t.render(),c.render()}}function po(t,e,n){let o,i;this.update=function(){i=e.getCandidates();const t=i.map((t=>[t.shape1.x,0])),r=Ft.from(t);o=r.voronoi([0,0,n.width,n.height])},this.render=function(){const{ctx:e}=n,{x:r,w:s,densityProfile:a}=t.shape1,c=100;e.save(),e.beginPath(),u(),e.clip();const l=i.length;for(let t=0;t<l;t++)e.beginPath(),o.renderCell(t,e),e.fillStyle=i[t].color,e.fill(),e.stroke();function u(){"gaussian"===a?function(){const t=s/Math.sqrt(2*Math.PI),o=c,i=200;e.moveTo(0,i);const a=[];for(let s=0;s<=n.width;s+=1){const n=.5*((s-r)/t)**2,c=i-o*Math.exp(-n);a.push(c),e.lineTo(s,c)}e.lineTo(n.width,i),e.lineTo(0,i)}():e.rect(r-.5*s,100,s,c)}e.beginPath(),u(),e.stroke(),e.restore()}}function mo(t,e,n){let o,i;this.update=function(){i=e.getCandidates();const t=i.map((t=>[t.shape2.x,t.shape2.y])),r=Ft.from(t);o=r.voronoi([0,0,n.width,n.height])},this.render=function(){const{ctx:e}=n,{x:r,y:s,w:a}=t.shape2;e.save(),e.beginPath(),e.arc(r,s,.5*a,0,2*Math.PI),e.clip();const c=i.length;for(let t=0;t<c;t++)e.beginPath(),o.renderCell(t,e),e.fillStyle=i[t].color,e.fill(),e.stroke();e.beginPath(),e.arc(r,s,.5*a,0,2*Math.PI),e.stroke(),e.restore()}}function go(t,e,n,o,i){const r=this,{dimensions:s}=i,a=1===s?po:mo;t.setRenderer((t=>new a(t,e,n))),r.enter=()=>{},r.exit=()=>{},r.update=function(e){const{error:n}=e;void 0===n&&t.updateGraphic()},r.render=function(){t.render()}}function yo(t,e,n){let o,i,r;this.update=function(t){let n,s;if(void 0===t){o=e.getCandidates();const t=ge(o.map((t=>t.shape1)));n=t.ranking,s=t.intervalBorders}else n=t.ranking,s=t.intervalBorders;o=e.getCandidates();const a=o.length,c=o.map((t=>t.colorRGBA)),l=s.length-1;r=Array(l),i=Array(l);for(let t=0;t<l;t++){r[t]=[s[t],s[t+1]];const e=n[t].map((t=>a-t));i[t]=ro(io(e,c))}},this.render=function(){const{ctx:e}=n,{x:o,w:s,densityProfile:a}=t.shape1,c=100;e.save(),e.beginPath(),u(),e.clip();const l=r.length;for(let t=0;t<l;t++)wo(r[t],i[t],e,n);function u(){"gaussian"===a?function(){const t=s/Math.sqrt(2*Math.PI),i=c,r=200;e.moveTo(0,r);const a=[];for(let s=0;s<=n.width;s+=1){const n=.5*((s-o)/t)**2,c=r-i*Math.exp(-n);a.push(c),e.lineTo(s,c)}e.lineTo(n.width,r),e.lineTo(0,r)}():e.rect(o-.5*s,100,s,c)}e.beginPath(),u(),e.stroke(),e.restore()}}function wo(t,e,n,o){const i=Math.max(0,t[0]),r=Math.min(o.width,t[1])-i,s=o.height;n.beginPath(),n.rect(i,0,r,s),n.fillStyle=e,n.fill(),n.stroke()}function vo(t,e,n){let o,i,r;this.update=function(n){let s;if(void 0===n){o=e.getCandidates();const n=o.map((t=>t.shape2)),i=fe(t.shape2,n);s=i.ranking,r=i.cells}else s=n.ranking,r=n.cells;o=e.getCandidates();const a=o.length,c=r.length;i=Array(c);const l=o.map((t=>t.colorRGBA));for(let t=0;t<c;t++){const e=s[t].map((t=>a-t));i[t]=ro(io(e,l))}},this.render=function(){const{ctx:e}=n,{x:o,y:s,w:a}=t.shape2;e.save();const c=r.length;for(let t=0;t<c;t++)e.beginPath(),_o(e,r[t]),e.fillStyle=i[t],e.strokeStyle=i[t],e.fill(),e.stroke();e.strokeStyle="#222",e.beginPath(),e.arc(o,s,.5*a,0,2*Math.PI),e.stroke(),e.restore()}}function _o(t,e){const n=e.length,o=e[n-1];t.moveTo(o[0],o[1]);for(let o=0;o<n;o++){const n=e[o];t.lineTo(n[0],n[1])}}function xo(t,e,n,o,i){const r=this,{dimensions:s}=i,a=1===s?yo:vo;t.setRenderer((t=>new a(t,e,n))),r.enter=()=>{},r.exit=()=>{},r.update=function(e){const{error:n}=e;if(void 0!==n)return;const{cellData:o}=e.votes;t.updateGraphic(o)},r.render=function(){t.render()}}function bo(t,e){const n=this;let o,i;function r(t,n,r){const{grid:s,voteSet:a,voterGeom:c}=o,{x:l,w:u,densityProfile:h}=c,d=i.length,f="gaussian"===h,p=s.x,m=u/Math.sqrt(2*Math.PI),g=200/d,y=200-n*g,w=Math.max(-1,p[0]);t.moveTo(w,y);const v=p.length;for(let o=0;o<v;o+=1){const i=p[o];if(i<-1)continue;if(i>e.width)continue;const s=r?1:a[o].tallyFractions[n],c=y-g*(f?Math.exp(-.5*((i-l)/m)**2):1)*s;t.lineTo(i,c)}const _=Math.min(e.width,p[v-1]);t.lineTo(_,y),t.lineTo(w,y)}n.update=e=>{o=e,i=t.getCandidates()},n.renderBackground=function(){const{ctx:t}=e;t.save(),t.globalAlpha=.7;const n=i.length;for(let e=0;e<n;e++)t.strokeStyle="#dddddd",t.beginPath(),r(t,e,!0),t.stroke();t.restore()},n.render=function(){const{ctx:t}=e;t.save(),t.globalAlpha=.7;const n=i.length;for(let e=0;e<n;e++){t.fillStyle=i[e].color;const{colorRGBA:n}=i[e];t.strokeStyle=ro(io([.5,.5],[n,[0,0,0]])),t.beginPath(),r(t,e,!1),t.fill(),t.stroke()}t.restore()}}function Co(t,e,n){let o,i,r;const s=[];this.update=e=>{o=e,i=t.getCandidates();const{grid:a,voteSet:c,voterGeom:l}=o,u=i.length,h=Math.floor((u-1)/3)+1;n.setHeight(h*(1/3)*n.common.height);const d="gaussian"===l.densityProfile;!function(){const{nx:t,ny:e,weight:n}=a;s.splice(0);for(let o=0;o<i.length;o++){const r=document.createElement("canvas");r.width=t,r.height=e;const a=r.getContext("2d"),l=a.createImageData(t,e),{data:u}=l,{colorRGBA:h}=i[o],[f,p,m]=h;let g=0;for(let i=0;i<e;i++)for(let e=0;e<t;e++){const r=c[g].tallyFractions[o]*(d?n[g]:1)*255;u[4*(e+i*t)+0]=f,u[4*(e+i*t)+1]=p,u[4*(e+i*t)+2]=m,u[4*(e+i*t)+3]=r,g+=1}s.push(r),a.putImageData(l,0,0)}}(),function(){const{nx:t,ny:e,weight:n}=a,o=i.map((t=>t.colorRGBA)),s=document.createElement("canvas");s.width=t,s.height=e;const l=s.getContext("2d"),u=l.createImageData(t,e),{data:h}=u;let f=0;for(let i=0;i<e;i++)for(let e=0;e<t;e++){const{tallyFractions:r}=c[f],[s,a,l]=io(r,o),u=255*(d?n[f]:1);h[4*(e+i*t)+0]=s,h[4*(e+i*t)+1]=a,h[4*(e+i*t)+2]=l,h[4*(e+i*t)+3]=u,f+=1}r=s,l.putImageData(u,0,0)}()},this.render=function(){const{x:t,y:a,w:c}=o.voterGeom;!function(){const{ctx:n}=e;n.save(),n.beginPath(),n.arc(t,a,.5*c,0,2*Math.PI),n.clip();const o={w:1,h:1,x:0,y:0},i=r;n.imageSmoothingEnabled=!1;const s={x:t-.5*c+o.x,y:a-.5*c+o.y,w:c*o.w,h:c*o.h};n.drawImage(i,s.x,s.y,s.w,s.h),n.beginPath(),n.arc(t,a,.5*c,0,2*Math.PI),n.stroke(),n.restore()}(),function(){const{ctx:e}=n,o=i.length;for(let n=0;n<o;n++){e.save();const o={w:1/3,h:1/3,x:n%3*100,y:100*Math.floor(n/3)},i={x:t*o.w+o.x,y:a*o.h+o.y,r:c*o.w*.5};e.beginPath(),e.arc(i.x,i.y,i.r,0,2*Math.PI),e.clip(),e.beginPath(),e.rect(o.x,o.y,100,100),e.clip();const r=s[n],l={x:t*o.w-c*o.w*.5+o.x,y:a*o.w-c*o.w*.5+o.y,w:c*o.w,h:c*o.h};e.drawImage(r,l.x,l.y,l.w,l.h),e.beginPath(),e.arc(i.x,i.y,i.r,0,2*Math.PI),e.stroke(),e.restore()}}()}}function So(t,e,n,o,i){const r=this,{dimensions:s}=i,a=1===s?bo:Co;t.setRenderer((()=>new a(e,n,o))),r.enter=function(){2===s&&o.show()},r.exit=function(){o.hide()},r.update=function(e){const{error:n}=e;if(void 0!==n)return;const{gridData:o}=e.votes;t.updateGraphic(o)},r.render=function(){1===s&&t.renderBackground(),t.render()}}function ko(t,e,n,o,i,r,s,a,c){a.save(),a.globalAlpha=s,a.textAlign=c||"center",a.font=`${o}px Sans-serif`,a.lineWidth=i,a.fillStyle=r,a.fillText(t,e,n),a.restore()}function Ao(t){return(100*t).toFixed(0)}function Mo(){const t=this;t.list=[],t.updateNewG=e=>{t.add(e)},t.add=e=>{const n={};e.voterShape?(n.g=e.graphic.circle,n.r=e.graphic,n.o=e.voterShape,n.p={isCircle:!0}):e.candidate?(n.g=e.graphic.square,n.r=e.graphic,n.o=e.candidate,n.p={isSquare:!0}):e.canDn?(n.g=e.graphic.square,n.r=e.graphic,n.o=e.canDn,n.p={isSquare:!0}):(n.g=e.graphic.circle,n.r=e.graphic,n.o=e.testVoter,n.p={isCircle:!0}),t.list.push(n)}}function Eo(t,e,n,o,i){let r={};const s=t.list,a=n.tooltips,l=function(t){if(null!==t.target.closest(".tooltipBox"))return;const e=m(t),n=t.isTouch?10:0,o=s.length,l=[];for(let t=0;t<o;t++){const o=s[t];(o.o.exists||i.showGhosts)&&g(o,e,n)&&l.push(t)}if(l.length>0){const t=l.map((t=>{const n=s[t];return(n.r.x-e.x)**2+(n.r.y-e.y)**2})),n=l[c(t)],o=s[n];r.iDragging=n,r.isDragging=!0,r.offX=o.r.x-e.x,r.offY=o.r.y-e.y,o.g.pickUp(),a.dataset.cursor="grabbing"}!function(t){y=!0,w=f(t)}(e)},u=function(t){const e=m(t);if(r.isDragging){t.isTouch&&(t.preventDefault(),t.stopPropagation());const i=s[r.iDragging],a=n.width,c=n.height;i.r.setXYView({x:h(e.x+r.offX,0,a),y:h(e.y+r.offY,0,c)}),o.add(["draggables"])}else{const t=s.length;for(let n=0;n<t;n++){const t=s[n];if((i.showGhosts||t.o.exists)&&g(t,e,0))return void(a.dataset.cursor="grab")}a.dataset.cursor=""}!function(t){if(y){const e=Math.abs(w.x-t.x),n=Math.abs(w.y-t.y);e>5&&(y=!1),n>5&&(y=!1)}}(e)},d=function(){if(function(){if(y)if(y=!1,r.isDragging){s[r.iDragging].r.click()}else e.clickEmpty(w)}(),void 0!==r.iDragging){s[r.iDragging].g.drop()}r={}};function p(t){return t.isTouch=!0,t}function m(t){const e=n.wrap.getBoundingClientRect(),o=t.isTouch?t.changedTouches[0]:t;return{x:o.clientX-e.left,y:o.clientY-e.top}}function g(t,e,n){const o=t.r.x-e.x,i=t.r.y-e.y;if(t.p.isCircle){const{r:e}=t.g;return o*o+i*i<(e+n)*(e+n)}if(t.p.isSquare){const{w:e,h:r}=t.g;return Math.abs(o)<.5*e+n&&Math.abs(i)<.5*r+n}return!1}let y,w;this.eventHandlers={start:l,move:u,end:d,touchmove:t=>{const e=p(t);u(e)},touchstart:t=>{const e=p(t);l(e)},touchend:t=>{const e=p(t);u(e),d(),null===t.target.closest(".tooltipBox")&&t.preventDefault()}}}function To(t,e,n){const o=this;o.dragm=new Mo,o.clickDrag=new Eo(o.dragm,o,t,e,n),o.enter=()=>{t.eventHandlers.set(o.clickDrag.eventHandlers)},o.exit=()=>{},o.update=()=>{if(e.checkNone())return;t.clear();const[n,o]=[150,150];ko("Not Yet Implemented",n,o,20,2,"#222",1,t.ctx)},o.render=()=>{},o.renderForeground=()=>{},o.testVoteView=()=>null}function Po(t){const e=this;e.voterShape=t,e.setRenderer=n=>{e.renderer=n(t)}}function Do(t){const e=this,n=[];e.list=n,e.rendererMaker=()=>({render:()=>{}}),t.attachNewE(e),e.updateNewE=t=>{e.newVoterShape(t)},e.newVoterShape=function(t){const o=new Po(t);n.push(o),o.setRenderer(e.rendererMaker)},e.getVoterShapes=()=>n.filter((t=>t.voterShape.exists)).map((t=>t.voterShape)),e.getVoterRenderers=()=>n.filter((t=>t.voterShape.exists)),e.setRenderer=t=>{e.rendererMaker=t,n.forEach((e=>e.setRenderer(t)))},e.updateGraphic=t=>{const n=e.getVoterRenderers();void 0===t?n.forEach((t=>t.renderer.update())):n.forEach(((e,n)=>e.renderer.update(t[n])))},e.render=()=>{n.forEach((t=>{t.voterShape.exists&&t.renderer.render()}))},e.renderBackground=()=>{n.forEach((t=>{t.voterShape.exists&&t.renderer.renderBackground()}))}}function No(t,e,n,o,i,r,s,a,c){const l=this;a.viewModes.one.attach(l),To.call(l,e,i,c);const{candidateList:u,voterShapeList:h}=t,d=new Do(h);let f;function p(){const{voteCasterName:t}=s,o="score"===t||"scoreLong"===t?So:"ranking"===t||"pairwise"===t?xo:go,i=!0===r.useDistricts?fo:o;f=new i(d,u,e,n,r)}p(),l.enter=()=>{p(),f.enter()},l.exit=()=>{f.exit()},l.update=t=>{if(i.checkNone())return;i.check(["numDistricts","dimensions","socialChoiceMethod"])&&(l.exit(),l.enter());const{electionResults:e}=t;f.update(e),l.clear(),l.render()},l.render=()=>{f.render()},l.clear=()=>{e.clear(),n.clear()}}function Fo(t,e,n,o,i){const{width:r}=n,s=Array(r).fill(0);let a=0;const{dimensions:c}=i,l=1===c?uo:ho;t.setRenderer((t=>new l(t,n))),e.setRenderer((t=>new l(t,n))),this.update=function(t){o.checkAny()&&(s.fill(0),a=0);const{pointsChanged:e,newPoints:n}=t;e&&function(t){const e=t.length;for(let n=0;n<e;n++){const e=t[n][0];for(let t=0;t<r;t++)s[t]+=h(t-e);a+=u}}(n)};const u=4/3;function h(t){return t>20||t<-20?0:.05*(1-(.05*t)**2)}this.render=()=>{!function(){const{ctx:t}=n;t.save(),t.beginPath(),function(t){const e=1/a,o=1e4,i=200;t.moveTo(0,i);const c=[];for(let n=0;n<=r;n+=1){const r=i-o*s[n]*e;c.push(r),t.lineTo(n,r)}t.lineTo(n.width,i),t.lineTo(0,i)}(t),t.strokeStyle="#ccc",t.stroke(),t.fillStyle="#ccc",t.fill(),t.restore()}(),t.render(),e.render()}}function Lo(t,e,n){t=+t,e=+e,n=(i=arguments.length)<2?(e=t,t=0,1):i<3?1:+n;for(var o=-1,i=0|Math.max(0,Math.ceil((e-t)/n)),r=new Array(i);++o<i;)r[o]=t+o*n;return r}var Vo=Math.sqrt(50),Ro=Math.sqrt(10),Oo=Math.sqrt(2);function Io(t,e,n){var o,i,r,s,a=-1;if(n=+n,(t=+t)===(e=+e)&&n>0)return[t];if((o=e<t)&&(i=t,t=e,e=i),0===(s=function(t,e,n){var o=(e-t)/Math.max(0,n),i=Math.floor(Math.log(o)/Math.LN10),r=o/Math.pow(10,i);return i>=0?(r>=Vo?10:r>=Ro?5:r>=Oo?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(r>=Vo?10:r>=Ro?5:r>=Oo?2:1)}(t,e,n))||!isFinite(s))return[];if(s>0){let n=Math.round(t/s),o=Math.round(e/s);for(n*s<t&&++n,o*s>e&&--o,r=new Array(i=o-n+1);++a<i;)r[a]=(n+a)*s}else{s=-s;let n=Math.round(t*s),o=Math.round(e*s);for(n/s<t&&++n,o/s>e&&--o,r=new Array(i=o-n+1);++a<i;)r[a]=(n+a)/s}return o&&r.reverse(),r}function Go(t,e,n){var o=Math.abs(e-t)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(o)/Math.LN10)),r=o/i;return r>=Vo?i*=10:r>=Ro?i*=5:r>=Oo&&(i*=2),e<t?-i:i}function Bo(t){return Math.ceil(Math.log(function(t,e){let n=0;if(void 0===e)for(let e of t)null!=e&&(e=+e)>=e&&++n;else{let o=-1;for(let i of t)null!=(i=e(i,++o,t))&&(i=+i)>=i&&++n}return n}(t))/Math.LN2)+1}var qo=Array.prototype.slice;function jo(t,e){return t-e}var Ho=t=>()=>t;function Uo(t,e){for(var n,o=-1,i=e.length;++o<i;)if(n=$o(t,e[o]))return n;return 0}function $o(t,e){for(var n=e[0],o=e[1],i=-1,r=0,s=t.length,a=s-1;r<s;a=r++){var c=t[r],l=c[0],u=c[1],h=t[a],d=h[0],f=h[1];if(Wo(c,h,e))return 0;u>o!=f>o&&n<(d-l)*(o-u)/(f-u)+l&&(i=-i)}return i}function Wo(t,e,n){var o,i,r,s;return function(t,e,n){return(e[0]-t[0])*(n[1]-t[1])==(n[0]-t[0])*(e[1]-t[1])}(t,e,n)&&(i=t[o=+(t[0]===e[0])],r=n[o],s=e[o],i<=r&&r<=s||s<=r&&r<=i)}function zo(){}var Xo=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function Yo(){var t=1,e=1,n=Bo,o=a;function i(t){var e=n(t);if(Array.isArray(e))e=e.slice().sort(jo);else{const n=function(t,e){let n,o;if(void 0===e)for(const e of t)null!=e&&(void 0===n?e>=e&&(n=o=e):(n>e&&(n=e),o<e&&(o=e)));else{let i=-1;for(let r of t)null!=(r=e(r,++i,t))&&(void 0===n?r>=r&&(n=o=r):(n>r&&(n=r),o<r&&(o=r)))}return[n,o]}(t),o=Go(n[0],n[1],e);e=Io(Math.floor(n[0]/o)*o,Math.floor(n[1]/o-1)*o,e)}return e.map((e=>r(t,e)))}function r(n,i){var r=[],a=[];return function(n,o,i){var r,a,c,l,u,h,d=new Array,f=new Array;r=a=-1,l=n[0]>=o,Xo[l<<1].forEach(p);for(;++r<t-1;)c=l,l=n[r+1]>=o,Xo[c|l<<1].forEach(p);Xo[l<<0].forEach(p);for(;++a<e-1;){for(r=-1,l=n[a*t+t]>=o,u=n[a*t]>=o,Xo[l<<1|u<<2].forEach(p);++r<t-1;)c=l,l=n[a*t+t+r+1]>=o,h=u,u=n[a*t+r+1]>=o,Xo[c|l<<1|u<<2|h<<3].forEach(p);Xo[l|u<<3].forEach(p)}r=-1,u=n[a*t]>=o,Xo[u<<2].forEach(p);for(;++r<t-1;)h=u,u=n[a*t+r+1]>=o,Xo[u<<2|h<<3].forEach(p);function p(t){var e,n,o=[t[0][0]+r,t[0][1]+a],c=[t[1][0]+r,t[1][1]+a],l=s(o),u=s(c);(e=f[l])?(n=d[u])?(delete f[e.end],delete d[n.start],e===n?(e.ring.push(c),i(e.ring)):d[e.start]=f[n.end]={start:e.start,end:n.end,ring:e.ring.concat(n.ring)}):(delete f[e.end],e.ring.push(c),f[e.end=u]=e):(e=d[u])?(n=f[l])?(delete d[e.start],delete f[n.end],e===n?(e.ring.push(c),i(e.ring)):d[n.start]=f[e.end]={start:n.start,end:e.end,ring:n.ring.concat(e.ring)}):(delete d[e.start],e.ring.unshift(o),d[e.start=l]=e):d[l]=f[u]={start:l,end:u,ring:[o,c]}}Xo[u<<3].forEach(p)}(n,i,(function(t){o(t,n,i),function(t){for(var e=0,n=t.length,o=t[n-1][1]*t[0][0]-t[n-1][0]*t[0][1];++e<n;)o+=t[e-1][1]*t[e][0]-t[e-1][0]*t[e][1];return o}(t)>0?r.push([t]):a.push(t)})),a.forEach((function(t){for(var e,n=0,o=r.length;n<o;++n)if(-1!==Uo((e=r[n])[0],t))return void e.push(t)})),{type:"MultiPolygon",value:i,coordinates:r}}function s(e){return 2*e[0]+e[1]*(t+1)*4}function a(n,o,i){n.forEach((function(n){var r,s=n[0],a=n[1],c=0|s,l=0|a,u=o[l*t+c];s>0&&s<t&&c===s&&(r=o[l*t+c-1],n[0]=s+(i-r)/(u-r)-.5),a>0&&a<e&&l===a&&(r=o[(l-1)*t+c],n[1]=a+(i-r)/(u-r)-.5)}))}return i.contour=r,i.size=function(n){if(!arguments.length)return[t,e];var o=Math.floor(n[0]),r=Math.floor(n[1]);if(!(o>=0&&r>=0))throw new Error("invalid size");return t=o,e=r,i},i.thresholds=function(t){return arguments.length?(n="function"==typeof t?t:Array.isArray(t)?Ho(qo.call(t)):Ho(t),i):n},i.smooth=function(t){return arguments.length?(o=t?a:zo,i):o===a},i}function Jo(t,e,n){for(var o=t.width,i=t.height,r=1+(n<<1),s=0;s<i;++s)for(var a=0,c=0;a<o+n;++a)a<o&&(c+=t.data[a+s*o]),a>=n&&(a>=r&&(c-=t.data[a-r+s*o]),e.data[a-n+s*o]=c/Math.min(a+1,o-1+r-a,r))}function Ko(t,e,n){for(var o=t.width,i=t.height,r=1+(n<<1),s=0;s<o;++s)for(var a=0,c=0;a<i+n;++a)a<i&&(c+=t.data[s+a*o]),a>=n&&(a>=r&&(c-=t.data[s+(a-r)*o]),e.data[s+(a-n)*o]=c/Math.min(a+1,i-1+r-a,r))}function Qo(t){return t[0]}function Zo(t){return t[1]}function ti(){return 1}function ei(){var t=Qo,e=Zo,n=ti,o=960,i=500,r=20,s=2,a=3*r,c=o+2*a>>s,l=i+2*a>>s,u=Ho(20);function h(o){var i=new Float32Array(c*l),h=new Float32Array(c*l),f=Math.pow(2,-s);o.forEach((function(o,r,s){var u=(t(o,r,s)+a)*f,h=(e(o,r,s)+a)*f,d=+n(o,r,s);if(u>=0&&u<c&&h>=0&&h<l){var p=Math.floor(u),m=Math.floor(h),g=u-p-.5,y=h-m-.5;i[p+m*c]+=(1-g)*(1-y)*d,i[p+1+m*c]+=g*(1-y)*d,i[p+1+(m+1)*c]+=g*y*d,i[p+(m+1)*c]+=(1-g)*y*d}})),Jo({width:c,height:l,data:i},{width:c,height:l,data:h},r>>s),Ko({width:c,height:l,data:h},{width:c,height:l,data:i},r>>s),Jo({width:c,height:l,data:i},{width:c,height:l,data:h},r>>s),Ko({width:c,height:l,data:h},{width:c,height:l,data:i},r>>s),Jo({width:c,height:l,data:i},{width:c,height:l,data:h},r>>s),Ko({width:c,height:l,data:h},{width:c,height:l,data:i},r>>s);var p=u(i);if(!Array.isArray(p)){var m=function(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n<e||void 0===n&&e>=e)&&(n=e);else{let o=-1;for(let i of t)null!=(i=e(i,++o,t))&&(n<i||void 0===n&&i>=i)&&(n=i)}return n}(i);p=Go(0,m,p),(p=Lo(0,Math.floor(m/p)*p,p)).shift()}return Yo().thresholds(p).size([c,l])(i).map(d)}function d(t){return t.value*=Math.pow(2,-2*s),t.coordinates.forEach(f),t}function f(t){t.forEach(p)}function p(t){t.forEach(m)}function m(t){t[0]=t[0]*Math.pow(2,s)-a,t[1]=t[1]*Math.pow(2,s)-a}function g(){return c=o+2*(a=3*r)>>s,l=i+2*a>>s,h}return h.x=function(e){return arguments.length?(t="function"==typeof e?e:Ho(+e),h):t},h.y=function(t){return arguments.length?(e="function"==typeof t?t:Ho(+t),h):e},h.weight=function(t){return arguments.length?(n="function"==typeof t?t:Ho(+t),h):n},h.size=function(t){if(!arguments.length)return[o,i];var e=+t[0],n=+t[1];if(!(e>=0&&n>=0))throw new Error("invalid size");return o=e,i=n,g()},h.cellSize=function(t){if(!arguments.length)return 1<<s;if(!((t=+t)>=1))throw new Error("invalid cell size");return s=Math.floor(Math.log(t)/Math.LN2),g()},h.thresholds=function(t){return arguments.length?(u="function"==typeof t?t:Array.isArray(t)?Ho(qo.call(t)):Ho(t),h):u},h.bandwidth=function(t){if(!arguments.length)return Math.sqrt(r*(r+1));if(!((t=+t)>=0))throw new Error("invalid bandwidth");return r=Math.round((Math.sqrt(4*t*t+1)-1)/2),g()},h}class ni{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const e=this._partials;let n=0;for(let o=0;o<this._n&&o<32;o++){const i=e[o],r=t+i,s=Math.abs(t)<Math.abs(i)?t-(r-i):i-(r-t);s&&(e[n++]=s),t=r}return e[n]=t,this._n=n+1,this}valueOf(){const t=this._partials;let e,n,o,i=this._n,r=0;if(i>0){for(r=t[--i];i>0&&(e=r,n=t[--i],r=e+n,o=n-(r-e),!o););i>0&&(o<0&&t[i-1]<0||o>0&&t[i-1]>0)&&(n=2*o,e=r+n,n==e-r&&(r=e))}return r}}function oi(t){return Array.from(function*(t){for(const e of t)yield*e}(t))}var ii=1e-6,ri=1e-12,si=Math.PI,ai=si/2,ci=si/4,li=2*si,ui=si/180,hi=Math.abs,di=Math.atan,fi=Math.atan2,pi=Math.cos,mi=(Math.ceil,Math.exp),gi=(Math.hypot,Math.log),yi=(Math.pow,Math.sin),wi=Math.sign||function(t){return t>0?1:t<0?-1:0},vi=Math.sqrt,_i=Math.tan;function xi(t){return t>1?0:t<-1?si:Math.acos(t)}function bi(t){return t>1?ai:t<-1?-ai:Math.asin(t)}function Ci(){}function Si(t,e){t&&Ai.hasOwnProperty(t.type)&&Ai[t.type](t,e)}var ki={Feature:function(t,e){Si(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,o=-1,i=n.length;++o<i;)Si(n[o].geometry,e)}},Ai={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,o=-1,i=n.length;++o<i;)t=n[o],e.point(t[0],t[1],t[2])},LineString:function(t,e){Mi(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,o=-1,i=n.length;++o<i;)Mi(n[o],e,0)},Polygon:function(t,e){Ei(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,o=-1,i=n.length;++o<i;)Ei(n[o],e)},GeometryCollection:function(t,e){for(var n=t.geometries,o=-1,i=n.length;++o<i;)Si(n[o],e)}};function Mi(t,e,n){var o,i=-1,r=t.length-n;for(e.lineStart();++i<r;)o=t[i],e.point(o[0],o[1],o[2]);e.lineEnd()}function Ei(t,e){var n=-1,o=t.length;for(e.polygonStart();++n<o;)Mi(t[n],e,1);e.polygonEnd()}function Ti(t,e){t&&ki.hasOwnProperty(t.type)?ki[t.type](t,e):Si(t,e)}new ni,new ni;function Pi(t){var e=t[0],n=t[1],o=pi(n);return[o*pi(e),o*yi(e),yi(n)]}function Di(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function Ni(t){var e=vi(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}function Fi(t,e){return[hi(t)>si?t+Math.round(-t/li)*li:t,e]}function Li(){var t,e=[];return{point:function(e,n,o){t.push([e,n,o])},lineStart:function(){e.push(t=[])},lineEnd:Ci,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function Vi(t,e){return hi(t[0]-e[0])<ii&&hi(t[1]-e[1])<ii}function Ri(t,e,n,o){this.x=t,this.z=e,this.o=n,this.e=o,this.v=!1,this.n=this.p=null}function Oi(t,e,n,o,i){var r,s,a=[],c=[];if(t.forEach((function(t){if(!((e=t.length-1)<=0)){var e,n,o=t[0],s=t[e];if(Vi(o,s)){if(!o[2]&&!s[2]){for(i.lineStart(),r=0;r<e;++r)i.point((o=t[r])[0],o[1]);return void i.lineEnd()}s[0]+=2e-6}a.push(n=new Ri(o,t,null,!0)),c.push(n.o=new Ri(o,null,n,!1)),a.push(n=new Ri(s,t,null,!1)),c.push(n.o=new Ri(s,null,n,!0))}})),a.length){for(c.sort(e),Ii(a),Ii(c),r=0,s=c.length;r<s;++r)c[r].e=n=!n;for(var l,u,h=a[0];;){for(var d=h,f=!0;d.v;)if((d=d.n)===h)return;l=d.z,i.lineStart();do{if(d.v=d.o.v=!0,d.e){if(f)for(r=0,s=l.length;r<s;++r)i.point((u=l[r])[0],u[1]);else o(d.x,d.n.x,1,i);d=d.n}else{if(f)for(l=d.p.z,r=l.length-1;r>=0;--r)i.point((u=l[r])[0],u[1]);else o(d.x,d.p.x,-1,i);d=d.p}l=(d=d.o).z,f=!f}while(!d.v);i.lineEnd()}}}function Ii(t){if(e=t.length){for(var e,n,o=0,i=t[0];++o<e;)i.n=n=t[o],n.p=i,i=n;i.n=n=t[0],n.p=i}}function Gi(t){return hi(t[0])<=si?t[0]:wi(t[0])*((hi(t[0])+si)%li-si)}function Bi(t,e){var n=Gi(e),o=e[1],i=yi(o),r=[yi(n),-pi(n),0],s=0,a=0,c=new ni;1===i?o=ai+ii:-1===i&&(o=-ai-ii);for(var l=0,u=t.length;l<u;++l)if(d=(h=t[l]).length)for(var h,d,f=h[d-1],p=Gi(f),m=f[1]/2+ci,g=yi(m),y=pi(m),w=0;w<d;++w,p=_,g=b,y=C,f=v){var v=h[w],_=Gi(v),x=v[1]/2+ci,b=yi(x),C=pi(x),S=_-p,k=S>=0?1:-1,A=k*S,M=A>si,E=g*b;if(c.add(fi(E*k*yi(A),y*C+E*pi(A))),s+=M?S+k*li:S,M^p>=n^_>=n){var T=Di(Pi(f),Pi(v));Ni(T);var P=Di(r,T);Ni(P);var D=(M^S>=0?-1:1)*bi(P[2]);(o>D||o===D&&(T[0]||T[1]))&&(a+=M^S>=0?1:-1)}}return(s<-1e-6||s<ii&&c<-1e-12)^1&a}function qi(t,e,n,o){return function(i){var r,s,a,c=e(i),l=Li(),u=e(l),h=!1,d={point:f,lineStart:m,lineEnd:g,polygonStart:function(){d.point=y,d.lineStart=w,d.lineEnd=v,s=[],r=[]},polygonEnd:function(){d.point=f,d.lineStart=m,d.lineEnd=g,s=oi(s);var t=Bi(r,o);s.length?(h||(i.polygonStart(),h=!0),Oi(s,Hi,t,n,i)):t&&(h||(i.polygonStart(),h=!0),i.lineStart(),n(null,null,1,i),i.lineEnd()),h&&(i.polygonEnd(),h=!1),s=r=null},sphere:function(){i.polygonStart(),i.lineStart(),n(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function f(e,n){t(e,n)&&i.point(e,n)}function p(t,e){c.point(t,e)}function m(){d.point=p,c.lineStart()}function g(){d.point=f,c.lineEnd()}function y(t,e){a.push([t,e]),u.point(t,e)}function w(){u.lineStart(),a=[]}function v(){y(a[0][0],a[0][1]),u.lineEnd();var t,e,n,o,c=u.clean(),d=l.result(),f=d.length;if(a.pop(),r.push(a),a=null,f)if(1&c){if((e=(n=d[0]).length-1)>0){for(h||(i.polygonStart(),h=!0),i.lineStart(),t=0;t<e;++t)i.point((o=n[t])[0],o[1]);i.lineEnd()}}else f>1&&2&c&&d.push(d.pop().concat(d.shift())),s.push(d.filter(ji))}return d}}function ji(t){return t.length>1}function Hi(t,e){return((t=t.x)[0]<0?t[1]-ai-ii:ai-t[1])-((e=e.x)[0]<0?e[1]-ai-ii:ai-e[1])}Fi.invert=Fi;qi((function(){return!0}),(function(t){var e,n=NaN,o=NaN,i=NaN;return{lineStart:function(){t.lineStart(),e=1},point:function(r,s){var a=r>0?si:-si,c=hi(r-n);hi(c-si)<ii?(t.point(n,o=(o+s)/2>0?ai:-ai),t.point(i,o),t.lineEnd(),t.lineStart(),t.point(a,o),t.point(r,o),e=0):i!==a&&c>=si&&(hi(n-i)<ii&&(n-=i*ii),hi(r-a)<ii&&(r-=a*ii),o=function(t,e,n,o){var i,r,s=yi(t-n);return hi(s)>ii?di((yi(e)*(r=pi(o))*yi(n)-yi(o)*(i=pi(e))*yi(t))/(i*r*s)):(e+o)/2}(n,o,r,s),t.point(i,o),t.lineEnd(),t.lineStart(),t.point(a,o),e=0),t.point(n=r,o=s),i=a},lineEnd:function(){t.lineEnd(),n=o=NaN},clean:function(){return 2-e}}}),(function(t,e,n,o){var i;if(null==t)i=n*ai,o.point(-si,i),o.point(0,i),o.point(si,i),o.point(si,0),o.point(si,-i),o.point(0,-i),o.point(-si,-i),o.point(-si,0),o.point(-si,i);else if(hi(t[0]-e[0])>ii){var r=t[0]<e[0]?si:-si;i=n*r/2,o.point(-r,i),o.point(0,i),o.point(r,i)}else o.point(e[0],e[1])}),[-si,-ai]);var Ui,$i,Wi,zi,Xi=t=>t,Yi=new ni,Ji=new ni,Ki={point:Ci,lineStart:Ci,lineEnd:Ci,polygonStart:function(){Ki.lineStart=Qi,Ki.lineEnd=er},polygonEnd:function(){Ki.lineStart=Ki.lineEnd=Ki.point=Ci,Yi.add(hi(Ji)),Ji=new ni},result:function(){var t=Yi/2;return Yi=new ni,t}};function Qi(){Ki.point=Zi}function Zi(t,e){Ki.point=tr,Ui=Wi=t,$i=zi=e}function tr(t,e){Ji.add(zi*t-Wi*e),Wi=t,zi=e}function er(){tr(Ui,$i)}var nr=1/0,or=nr,ir=-nr,rr=ir,sr={point:function(t,e){t<nr&&(nr=t);t>ir&&(ir=t);e<or&&(or=e);e>rr&&(rr=e)},lineStart:Ci,lineEnd:Ci,polygonStart:Ci,polygonEnd:Ci,result:function(){var t=[[nr,or],[ir,rr]];return ir=rr=-(or=nr=1/0),t}};var ar,cr,lr,ur,hr=0,dr=0,fr=0,pr=0,mr=0,gr=0,yr=0,wr=0,vr=0,_r={point:xr,lineStart:br,lineEnd:kr,polygonStart:function(){_r.lineStart=Ar,_r.lineEnd=Mr},polygonEnd:function(){_r.point=xr,_r.lineStart=br,_r.lineEnd=kr},result:function(){var t=vr?[yr/vr,wr/vr]:gr?[pr/gr,mr/gr]:fr?[hr/fr,dr/fr]:[NaN,NaN];return hr=dr=fr=pr=mr=gr=yr=wr=vr=0,t}};function xr(t,e){hr+=t,dr+=e,++fr}function br(){_r.point=Cr}function Cr(t,e){_r.point=Sr,xr(lr=t,ur=e)}function Sr(t,e){var n=t-lr,o=e-ur,i=vi(n*n+o*o);pr+=i*(lr+t)/2,mr+=i*(ur+e)/2,gr+=i,xr(lr=t,ur=e)}function kr(){_r.point=xr}function Ar(){_r.point=Er}function Mr(){Tr(ar,cr)}function Er(t,e){_r.point=Tr,xr(ar=lr=t,cr=ur=e)}function Tr(t,e){var n=t-lr,o=e-ur,i=vi(n*n+o*o);pr+=i*(lr+t)/2,mr+=i*(ur+e)/2,gr+=i,yr+=(i=ur*t-lr*e)*(lr+t),wr+=i*(ur+e),vr+=3*i,xr(lr=t,ur=e)}function Pr(t){this._context=t}Pr.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(t,e){switch(this._point){case 0:this._context.moveTo(t,e),this._point=1;break;case 1:this._context.lineTo(t,e);break;default:this._context.moveTo(t+this._radius,e),this._context.arc(t,e,this._radius,0,li)}},result:Ci};var Dr,Nr,Fr,Lr,Vr,Rr=new ni,Or={point:Ci,lineStart:function(){Or.point=Ir},lineEnd:function(){Dr&&Gr(Nr,Fr),Or.point=Ci},polygonStart:function(){Dr=!0},polygonEnd:function(){Dr=null},result:function(){var t=+Rr;return Rr=new ni,t}};function Ir(t,e){Or.point=Gr,Nr=Lr=t,Fr=Vr=e}function Gr(t,e){Lr-=t,Vr-=e,Rr.add(vi(Lr*Lr+Vr*Vr)),Lr=t,Vr=e}function Br(){this._string=[]}function qr(t){return"m0,"+t+"a"+t+","+t+" 0 1,1 0,"+-2*t+"a"+t+","+t+" 0 1,1 0,"+2*t+"z"}function jr(t,e){var n,o,i=4.5;function r(t){return t&&("function"==typeof i&&o.pointRadius(+i.apply(this,arguments)),Ti(t,n(o))),o.result()}return r.area=function(t){return Ti(t,n(Ki)),Ki.result()},r.measure=function(t){return Ti(t,n(Or)),Or.result()},r.bounds=function(t){return Ti(t,n(sr)),sr.result()},r.centroid=function(t){return Ti(t,n(_r)),_r.result()},r.projection=function(e){return arguments.length?(n=null==e?(t=null,Xi):(t=e).stream,r):t},r.context=function(t){return arguments.length?(o=null==t?(e=null,new Br):new Pr(e=t),"function"!=typeof i&&o.pointRadius(i),r):e},r.pointRadius=function(t){return arguments.length?(i="function"==typeof t?t:(o.pointRadius(+t),+t),r):i},r.projection(t).context(e)}function Hr(t){return function(e){var n=new Ur;for(var o in t)n[o]=t[o];return n.stream=e,n}}function Ur(){}Br.prototype={_radius:4.5,_circle:qr(4.5),pointRadius:function(t){return(t=+t)!==this._radius&&(this._radius=t,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(t,e){switch(this._point){case 0:this._string.push("M",t,",",e),this._point=1;break;case 1:this._string.push("L",t,",",e);break;default:null==this._circle&&(this._circle=qr(this._radius)),this._string.push("M",t,",",e,this._circle)}},result:function(){if(this._string.length){var t=this._string.join("");return this._string=[],t}return null}},Ur.prototype={constructor:Ur,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};pi(30*ui);Hr({point:function(t,e){this.stream.point(t*ui,e*ui)}});function $r(t){return function(e,n){var o=pi(e),i=pi(n),r=t(o*i);return r===1/0?[2,0]:[r*i*yi(e),r*yi(n)]}}function Wr(t){return function(e,n){var o=vi(e*e+n*n),i=t(o),r=yi(i),s=pi(i);return[fi(e*r,o*s),bi(o&&n*r/o)]}}var zr=$r((function(t){return vi(2/(1+t))}));zr.invert=Wr((function(t){return 2*bi(t/2)}));var Xr=$r((function(t){return(t=xi(t))&&t/yi(t)}));function Yr(t,e){return[t,gi(_i((ai+e)/2))]}function Jr(t,e){return[t,e]}Xr.invert=Wr((function(t){return t})),Yr.invert=function(t,e){return[t,2*di(mi(e))-ai]},Jr.invert=Jr;var Kr=1.340264,Qr=-.081106,Zr=893e-6,ts=.003796,es=vi(3)/2;function ns(t,e){var n=bi(es*yi(e)),o=n*n,i=o*o*o;return[t*pi(n)/(es*(Kr+-.24331799999999998*o+i*(.0062510000000000005+.034164*o))),n*(Kr+Qr*o+i*(Zr+ts*o))]}function os(t,e){var n=pi(e),o=pi(t)*n;return[n*yi(t)/o,yi(e)/o]}function is(t,e){var n=e*e,o=n*n;return[t*(.8707-.131979*n+o*(o*(.003971*n-.001529*o)-.013791)),e*(1.007226+n*(.015085+o*(.028874*n-.044475-.005916*o)))]}function rs(t,e){return[pi(e)*yi(t),yi(e)]}function ss(t,e){var n=pi(e),o=1+pi(t)*n;return[n*yi(t)/o,yi(e)/o]}function as(t,e){return[gi(_i((ai+e)/2)),-t]}function cs(t,n,o,i,r){const s=this,{dimensions:a}=r,c=1===a?uo:ho;t.setRenderer((t=>new c(t,o))),n.setRenderer((t=>new c(t,o))),s.update=function(t){const{pointsChanged:e,points:n}=t;e&&s.updatePoints(n)},s.render=()=>{s.renderCans(),t.render(),n.render()};let l;s.updatePoints=function(t){const n=t.length/1e4,o=e(20).map((t=>t*n)),i=ei().x((t=>t[0])).y((t=>t[1])).bandwidth(10).thresholds(o);l=i(t)},s.renderCans=()=>{const{ctx:t}=o,{darkMode:e}=o.common,n=jr().context(t);t.save(),t.lineWidth=.5,t.strokeStyle="#aaa";const i=l.length;for(let o=0;o<i;o++){const i=255-10*o,r=e?255-i+33:i;t.fillStyle=`rgba(${r},${r},${r}, 1)`,t.beginPath(),n(l[o]),t.fill()}t.restore()}}function ls(t){const e=this;e.canDn=t,e.setRenderer=n=>{e.renderer=n(t)}}function us(t){const e=this,n=[];e.rendererMaker=()=>({render:()=>{}}),t.attachNewE(e),e.updateNewE=t=>{e.newCandidateDn(t)},e.newCandidateDn=function(t){const o=new ls(t);n.push(o),o.setRenderer(e.rendererMaker)},e.getCanDnRenderers=()=>n.filter((t=>t.canDn.exists)),e.getCandidateDistributions=()=>e.getCanDnRenderers().map((t=>t.canDn)),e.getCandidateDistributionsAll=()=>n.map((t=>t.canDn)),e.setRenderer=t=>{e.rendererMaker=t,n.forEach((e=>e.setRenderer(t)))},e.render=()=>{n.forEach((t=>{t.canDn.exists&&t.renderer.render()}))}}function hs(t,e,n,o,i,r,s){const a=this;r.viewModes.sample.attach(a),To.call(a,e,o,s);const{candidateDnList:c,voterShapeList:l}=t,u=new Do(l),h=new us(c);let d;function f(){const{dimensions:t}=i;d=new(1===t?Fo:cs)(u,h,e,o,i)}f(),a.enter=()=>{f()},a.exit=()=>{},a.update=t=>{o.check(["dimensions"])&&(a.exit(),a.enter());const{samplingResult:e}=t;d.update(e);const{pointsChanged:n}=e;n&&(a.clear(),a.render())},a.render=()=>{d.render()},a.clear=()=>{e.clear()}}function ds(t,e){const n=this;function o(n){const{ctx:o}=t,{centroids:i,polygonAreas:r}=e,s=i[n];ko(r[n].toFixed(0),s[0],s[1]+.5-.2,1,.2,"#222",1,o)}n.renderVoronoi=(t,e)=>{n.renderVoronoiGeneral(0,0,t,e,null,o)},n.renderVoronoiColors=(t,e,o,i,r)=>{n.renderVoronoiGeneral(t,e,o,i,r,void 0)},n.renderVoronoiGeneral=(n,o,i,r,s,a)=>{const{ctx:c}=t,{voronoi:l,nx:u,ny:h,nd:d}=e;c.save();const f=i/u,p=r/h;c.translate(n,o),c.scale(f,p);for(let t=0;t<d;t++)c.beginPath(),c.strokeStyle="#333",c.lineWidth=1/f,l.renderCell(t,c),null!==s&&(c.fillStyle=s[t],c.fill()),c.stroke(),void 0!==a&&a(t);c.restore()}}function fs(t,e,n){const{votesByTract:o,votesByDistrict:i,scResultsByDistrict:r}=t,s=e.getCandidates(),a=function(t,e){const n=e.map((t=>t.colorRGBA)),o=t.map((t=>t.map((t=>{const{tallyFractions:e}=t;return io(e,n)}))));return o}(o,s),c=function(t,e,n){let o;if("singleWinner"===n.socialChoiceType)o=t.map((t=>e[t.iWinner].color));else{const n=e.map((t=>t.colorRGBA));o=t.map((t=>{const{allocation:e}=t,o=e.reduce(((t,e)=>t+e));return ro(io(e.map((t=>t/o)),n))}))}return o}(r,s,n),l=function(t,e){const n=t.map((t=>{const{tallyFractions:n}=t;return ro(io(n,e.map((t=>t.colorRGBA))))}));return n}(i,s);return{colorByTract:a,colorOfVoteByDistrict:l,colorOfWinsByDistrict:c}}function ps(t,e,n){const o=this,i=document.createElement("canvas");i.width=t,i.height=e;const r=i.getContext("2d"),s=r.createImageData(t,e);o.load=n=>{const{data:o}=s;for(let i=0;i<t;i++)for(let r=0;r<e;r++){const e=n[i][r][0]+.5,s=n[i][r][1]+.5;o[4*(i+r*t)+0]=255*e,o[4*(i+r*t)+1]=200*(e+s),o[4*(i+r*t)+2]=200*s,o[4*(i+r*t)+3]=255}r.putImageData(s,0,0)},o.loadColors=n=>{const{data:o}=s;for(let i=0;i<e;i++)for(let e=0;e<t;e++){const r=n[e][i],[s,a,c]=r;o[4*(e+i*t)+0]=s,o[4*(e+i*t)+1]=a,o[4*(e+i*t)+2]=c,o[4*(e+i*t)+3]=255}r.putImageData(s,0,0)},o.render=(t,e)=>{const{ctx:o}=n;o.save(),o.imageSmoothingEnabled=!1,o.drawImage(i,0,0,t,e),o.restore()}}function ms(t,e,n,o){const i=this;i.update=r=>{const{voterDistricts:s}=r.geometry;if(o.check(["numDistricts"])&&void 0===i.districtDraw){const{districtMaker:t}=s;i.districtDraw=new ds(e,t),i.noiseImage=new ps(s.nx,s.ny,e)}const a=fs(r,t,n),{colorByTract:c,colorOfVoteByDistrict:l,colorOfWinsByDistrict:u}=a;i.colorOfVoteByDistrict=l,i.winnerColors=u,i.noiseImage.loadColors(c)};const r=100,s=100;i.render=()=>{i.renderTractVotes(),i.renderDistrictWins(),i.renderDistrictVotes()},i.renderTractVotes=()=>{i.noiseImage.render(r,s),i.districtDraw.renderVoronoi(r,s)},i.renderDistrictWins=()=>{const{renderVoronoiColors:t}=i.districtDraw;t(200,0,r,s,i.winnerColors)},i.renderDistrictVotes=()=>{const{renderVoronoiColors:t}=i.districtDraw;t(100,0,r,s,i.colorOfVoteByDistrict)}}function gs(t,e,n,o,i,r,s){const a=this;s.viewModes.one.attach(a);const c=new Xn(e,s,n,"maps"),{height:l}=e;c.setHeight(l/3),c.hide();const u=new ms(t.candidateList,c,r,o);let h=!1;a.enter=()=>{i.useDistricts&&c.show()},a.exit=()=>{c.hide()},a.update=function(t){o.check(["numDistricts"])&&(i.useDistricts?c.show():c.hide());const{electionResults:e}=t,{error:n}=e;void 0===n?(h=!1,i.useDistricts&&(u.update(e),a.clear(),a.render())):h=!0},a.render=function(){h||i.useDistricts&&u.render()},a.clear=()=>{c.clear()},a.draw=()=>{a.clear(),a.render()}}function ys(t,e){const n=n=>{if(!t.contains(n.target)&&((i=t)&&(i.offsetWidth||i.offsetHeight||i.getClientRects().length))){e()&&o()}var i},o=()=>{document.removeEventListener("mousedown",n),document.removeEventListener("touchstart",n)};document.addEventListener("mousedown",n),document.addEventListener("touchstart",n)}function ws(t,e){const n=document.createElement("div");function o(){const{x:o,y:i}=t;o>.5*e.width?(n.style.right=e.width-o+"px",n.style.left="unset"):(n.style.left=`${o}px`,n.style.right="unset"),n.style.top=`${i}px`}n.className="tooltipBox",n.style.position="absolute",o(),n.style.border=e.common.darkMode?"1px solid white":"1px solid black",n.style.padding="8px",n.style.background=e.common.darkMode?"#222":"white";let i=!1;return ys(n,(()=>!i&&(n.remove(),!0))),{box:n,update:o,setPin:t=>{i=t}}}function vs(t,e,n,o,i){const r=ws(t,n),{box:s}=r;s.innerText="- Properties -";const a={};a.exists=new _s("checkbox","Exists","Exists: ",(t=>e.setE(t?1:0)),1===e.exists),s.appendChild(a.exists.div);const{dimensions:c}=i;1===c?(e.shape1.w&&(a.w1=new _s("range","Width","Width: ",(t=>e.setW1(t)),e.shape1.w),s.appendChild(a.w1.div)),e.shape1.densityProfile&&(a.densityProfile1=new _s("select","Density Profile","Density Profile: ",(t=>e.setDensityProfile1(t)),e.shape1.densityProfile,["step","gaussian"]),s.appendChild(a.densityProfile1.div))):e.shape2.w&&(a.w2=new _s("range","Width","Width: ",(t=>e.setW2(t)),e.shape2.w),s.appendChild(a.w2.div)),void 0!==e.setColor&&(a.color=new _s("color","Color","Color: ",(t=>e.setColor(t)),e.color),s.appendChild(a.color.div)),void 0!==e.setParty&&(a.party=new _s("select","Party","Party: ",(t=>e.setParty([Number(t)])),e.party,[0,1,2,3,4,5,6,7,8,9]),s.appendChild(a.party.div)),a.showGhosts=new _s("checkbox","Show Ghosts","Show Ghosts: ",(t=>o.setShowNonExistingEntities(t)),o.showGhosts),s.appendChild(a.showGhosts.div),n.tooltips.appendChild(s)}function _s(t,e,n,o,i,r){const s=this;if(s.div=document.createElement("div"),"select"===t){s.input=document.createElement("select");for(let t=0;t<r.length;t++){const e=document.createElement("option");e.value=r[t],e.innerText=r[t],s.input.appendChild(e)}s.input.value=i,s.input.addEventListener("input",(()=>o(s.input.value)))}else s.input=document.createElement("input"),s.input.type=t,s.input.id=e,s.input.name=e,"checkbox"===t?(i&&(s.input.checked=!0),s.input.addEventListener("change",(()=>o(s.input.checked)))):"range"===t?(s.input.min=1,s.input.max=300,s.input.value=i,s.input.step=1,s.input.addEventListener("input",(()=>o(s.input.value)))):"color"===t&&(s.input.value=i,s.input.addEventListener("input",(()=>o(s.input.value))));s.label=document.createElement("label"),s.label.for=e,s.label.innerText=n,s.label.style["margin-right"]="4px",s.div.appendChild(s.label),s.div.appendChild(s.input)}function xs(t,e){const n=this;n.setXYView=o=>{const{dimensions:i}=e;1===i?t.setXY1(o):t.setXY2(o),n.updateViewXY()},n.updateViewXY=()=>{const{dimensions:o}=e;1===o?(n.x=t.shape1.x,n.y=250):(n.x=t.shape2.x,n.y=t.shape2.y)}}function bs(t,e,n,o,i){const r=this;r.w=n,r.h=o,r.trueW=n,r.trueH=o,r.angleFraction=0,r.pickUp=function(){r.tweenSq=new Rn(r,i.tweenGroup),r.tweenSq.to({w:r.trueW+10,h:r.trueH+10},100),r.tweenSq.start()},r.drop=function(){r.tweenSq=new Rn(r,i.tweenGroup),r.tweenSq.to({w:r.trueW,h:r.trueH},100),r.tweenSq.start()},r.win=function(){r.tweenSq=new Rn(r,i.tweenGroup),r.tweenSq.to({angleFraction:.25},300),r.tweenSq.start()},r.lose=function(){r.tweenSq=new Rn(r,i.tweenGroup),r.tweenSq.to({angleFraction:-.25},300),r.tweenSq.start()},r.render=function(){const{fctx:n}=i,{darkMode:o}=i.common;n.save(),r.tweenSq&&r.tweenSq.update(),0===e.exists&&(n.globalAlpha=.2),0!==r.angleFraction&&(n.translate(t.x,t.y),n.rotate(r.angleFraction*Math.PI*2),n.translate(-t.x,-t.y)),n.beginPath(),n.fillStyle=e.color,o&&e.darkModeColor&&(n.fillStyle=e.darkModeColor),o&&(n.strokeStyle="white"),n.rect(t.x-.5*r.w-.5,t.y-.5*r.h-.5,r.w+1,r.h+1),n.fill(),n.stroke(),n.restore()}}function Cs(t,e,n,o,i,r,s){const a=this,c=new bs(a,t,n,o,e);a.square=c,xs.call(a,t,r),a.fraction=0,a.setFraction=function(t){a.fraction=t},a.wins=0,a.setWins=t=>{a.wins!==t&&(t>a.wins?c.win():a.wins>t&&c.lose()),a.wins=t},a.renderForeground=function(){c.render();const{exists:n,party:o}=t,{x:i,y:r}=a,{fctx:l}=e,{darkMode:u}=e.common,h=u?"#fff":"#222";if(0===n)return;const d=r-.5*c.h-2;if(ko(Ao(a.fraction),i,d,20,2,h,1,l),void 0!==a.wins){const t=r+.5*c.h+20+2;ko(a.wins,i,t,20,2,h,1,l)}if("olprA"===s.socialChoiceMethod){ko(`p${o}`,i+.1*c.w,r+8,13,2,h,1,l)}},a.click=()=>{vs(a,t,e,i,r)}}function Ss(t,e,n,o,i,r,s){this.candidate=t,this.graphic=new Cs(t,e,n,o,i,r,s)}function ks(t,e,n,o,i){const r=this,s=[],a=[];r.attachNewG=t=>{a.push(t)};e.attachNewE(r),r.updateNewE=t=>{r.newCandidate(t)},r.newCandidate=function(e){const r=new Ss(e,n,21,21,t,o,i);var c;s.push(r),c=r,a.forEach((t=>t.updateNewG(c)))},r.getCanViews=()=>s.filter((t=>t.candidate.exists)),r.getCandidates=()=>r.getCanViews().map((t=>t.candidate)),r.getCandidatesAll=()=>s.map((t=>t.candidate)),r.setCandidateFractions=t=>{r.getCanViews().forEach(((e,n)=>{const o=t[n];e.graphic.setFraction(o)}))},r.setCandidateWins=t=>{r.getCanViews().forEach(((e,n)=>{const o=t[n];e.graphic.setWins(o)}))},r.unsetCandidateWins=()=>{const t=s.length,e=Array(t).fill(void 0);r.setCandidateWins(e)},r.updateViewXY=()=>{s.forEach((t=>t.graphic.updateViewXY()))},r.renderForeground=()=>{t.showGhosts?r.renderForegroundAll():r.renderForegroundExisting()},r.renderForegroundExisting=()=>{r.getCanViews().forEach((t=>t.graphic.renderForeground()))},r.renderForegroundAll=()=>{s.forEach((t=>t.graphic.renderForeground()))}}function As(t,e,n,o){const i=this;i.r=n,i.trueR=n,i.pickUp=function(){i.tween=new Rn(i,o.tweenGroup),i.tween.to({r:2*i.trueR},100),i.tween.start()},i.drop=function(){i.tween=new Rn(i,o.tweenGroup),i.tween.to({r:i.trueR},100),i.tween.start()},i.render=function(){const{fctx:n}=o,{darkMode:r}=o.common,{color:s}=e;n.save(),i.tween&&i.tween.update(),0===e.exists&&(n.globalAlpha=.2),n.beginPath(),n.fillStyle=s,r&&(n.strokeStyle="white"),n.arc(t.x,t.y,i.r,0,2*Math.PI),n.fill(),n.stroke(),n.restore()}}function Ms(t,e,n,o){const i=this,r=new As(i,t,13,e);i.circle=r,xs.call(i,t,o),i.renderForeground=()=>{r.render()},i.setRenderer=e=>{i.renderer=e(t)},i.click=()=>{vs(i,t,e,n,o)}}function Es(t,e,n,o){this.voterShape=t,this.graphic=new Ms(t,e,n,o)}function Ts(t,e,n,o){const i=this,r=[];i.list=r;const s=[];i.attachNewG=t=>{s.push(t)};e.attachNewE(i),i.updateNewE=t=>{i.newVoterShape(t)},i.newVoterShape=function(e){const i=new Es(e,n,t,o);var a;r.push(i),a=i,s.forEach((t=>t.updateNewG(a)))},i.getVoterShapes=()=>r.filter((t=>t.voterShape.exists)).map((t=>t.voterShape)),i.getVoterViews=()=>r.filter((t=>t.voterShape.exists)),i.updateViewXY=()=>{r.forEach((t=>t.graphic.updateViewXY()))},i.renderForeground=()=>{t.showGhosts?i.renderForegroundAll():i.renderForegroundExisting()},i.renderForegroundExisting=()=>{r.forEach((t=>{t.voterShape.exists&&t.graphic.renderForeground()}))},i.renderForegroundAll=()=>{r.forEach((t=>{t.graphic.renderForeground()}))}}function Ps(t){const{socialChoiceResults:e,votes:n}=t,{allocation:o}=e;if(void 0===o){const{tallyFractions:t}=n,{iWinner:o}=e,i=t.length,r=Array(i).fill(0);r[o]=1,e.allocation=r}}function Ds(t){const e=document.createElement("div");t.append(e),this.update=(t,n)=>{const o=t=>`<span style="color:${t};">&#9632;</span>`;t.ranking?e.innerHTML=t.ranking.map(((t,e)=>o(n[e])+t)).join("<br />"):t.tallyFractions&&(e.innerHTML=t.tallyFractions.map(Ao).map(((t,e)=>o(n[e])+t)).join("<br />"))}}function Ns(t,e,n){const o=ws(t,n),{box:i,setPin:r}=o;i.innerText="Vote",i.style["min-width"]="100px";const s=document.createElement("button");s.style["min-width"]="35px",s.style.float="right",s.style.clear="right",s.onclick=()=>{c()};let a=!0;function c(){a=!a,r(a),s.innerHTML=a?"&#x1F6AB;":"&#x1F4CC;"}c();const l=document.createElement("button");l.style.float="right",l.style["min-width"]="35px",l.style["font-size"]="10px",l.innerHTML="&#x2573;",l.onclick=()=>{i.remove(),e.setE(0)},i.appendChild(l),i.appendChild(s);const u=new Ds(i);return n.tooltips.appendChild(i),{box:i,update:function(t,e,n){o.update(),u.update(t,e,n)}}}function Fs(t,e,n,o,i){const r=this;function s(){t.setE(0)}r.start=n=>{t.setE(1),r.setXYView(n),ys(e.wrap,s)};const a=new As(r,t,9,e);r.circle=a,xs.call(r,t,n);let c={};r.update=(e,n)=>{if(void 0===e)return null;const o=n.getCandidates(),i=o.map((t=>t.color)),s=o.map((t=>t.colorRGBA));r.colorSet=i;const{tallyFractions:a}=e,l=ro(io(a,s));return t.setColor(l),c.box&&c.update(e,r.colorSet),e},r.click=()=>{const n=o.testVoteView();null!==n&&(c.box&&c.box.remove(),c=Ns(r,t,e),c.update(n,r.colorSet))},r.renderForeground=()=>{(t.exists||i.showGhosts)&&a.render()}}function Ls(t){const e=this;e.shape1={},e.shape2={},e.setAction={},e.setAction.exists=t=>{e.exists=t},e.setE=t=>{e.setAction.exists(t)},e.setAction.shape2p=t=>{e.shape2.x=t.x,e.shape2.y=t.y},e.setAction.shape1x=t=>{e.shape1.x=t},e.setXY1=n=>{e.setAction.shape1x(n.x),t.testVoteView()},e.setXY2=n=>{e.setAction.shape2p(n),t.testVoteView()},e.setAction.shape1x(0),e.setAction.shape2p({x:0,y:0}),e.color="#999",e.setAction.color=t=>{e.color=t},e.setColor=t=>{e.setAction.color(t)}}function Vs(t,e,n,o){const i=this;i.testVoter=new Ls(n),i.graphic=new Fs(i.testVoter,t,e,n,o),n.dragm.add(i)}function Rs(t,e,n){const{dimensions:o}=n;return{voterGeom:R([t],o)[0],canGeoms:e.getGeoms(o),parties:e.getParties(),dimensions:o}}function Os(t,e,n,o,i,r,s,a,c){const l=this;s.viewModes.one.attach(l),To.call(l,e,o,a);const{candidateList:u,voterShapeList:h}=t,d=new ks(a,u,e,i,r),f=new Ts(a,h,e,i);d.attachNewG(l.dragm),f.attachNewG(l.dragm),l.testVoterView=new Vs(e,i,l,a);const p=l.enter;l.enter=()=>{p(),f.updateViewXY(),d.updateViewXY(),l.testVoterView.graphic.updateViewXY()},l.exit=()=>{d.unsetCandidateWins(),l.testVoterView.testVoter.setE(0)},l.update=t=>{if(o.checkNone())return;o.check(["dimensions"])&&(l.exit(),l.enter()),o.check(["draggables"])&&(f.updateViewXY(),d.updateViewXY());const{electionResults:e}=t,{error:n}=e;if(void 0===n){Ps(e);const{votes:t,socialChoiceResults:n}=e;d.setCandidateWins(n.allocation),d.setCandidateFractions(t.tallyFractions)}l.testVoteView(),l.clearForeground(),l.renderForeground()},l.clickEmpty=t=>{l.testVoterView.graphic.start(t)},l.testVoteView=()=>{const t=Rs(l.testVoterView.testVoter,u,i),e=Ne[r.voteCasterName].castTestVote(t);return l.testVoterView.graphic.update(e,u),c.add(["testVote"]),e},l.renderForeground=()=>{f.renderForeground(),d.renderForeground(),l.testVoterView.graphic.renderForeground()},l.clearForeground=()=>{e.clearForeground()}}function Is(t,e,n,o,i,r,s){const a=this,c=new bs(a,t,n,o,e);a.square=c,xs.call(a,t,r),a.setWinFraction=t=>{a.winFraction!==t&&(t>a.winFraction?c.win():a.winFraction>t&&c.lose()),a.winFraction=t},a.renderForeground=()=>{c.render();const{party:n}=t,{x:o,y:i}=a,{fctx:r}=e,{darkMode:l}=e.common,u=l?"#fff":"#222";if("olprA"===s.socialChoiceMethod){ko(`p${n}`,o+.1*c.w,i+8,13,2,u,1,r)}if(void 0!==a.winFraction){const t=i+.5*c.h+20+2;ko(Ao(a.winFraction),o,t,20,2,u,1,r)}},a.setRenderer=e=>{a.renderer=e(t)},a.click=()=>{vs(a,t,e,i,r)}}function Gs(t,e,n,o,i,r,s){this.canDn=t,this.graphic=new Is(t,e,n,o,i,r,s)}function Bs(t,e,n,o,i){const r=this,s=[];r.rendererMaker=()=>({render:()=>{}});const a=[];r.attachNewG=t=>{a.push(t)};e.attachNewE(r),r.updateNewE=t=>{r.newCandidateDn(t)},r.newCandidateDn=function(e){const c=new Gs(e,n,21,21,t,o,i);var l;s.push(c),c.graphic.setRenderer(r.rendererMaker),l=c,a.forEach((t=>t.updateNewG(l)))},r.getCanDnViews=()=>s.filter((t=>t.canDn.exists)),r.getCandidateDistributions=()=>r.getCanDnViews().map((t=>t.canDn)),r.getCandidateDistributionsAll=()=>s.map((t=>t.canDn)),r.setCandidateDnWins=t=>{const e=r.getCanDnViews();e.length>1&&e.forEach((e=>{const n=e.canDn.party[0],o=t[n];e.graphic.setWinFraction(o)}))},r.updateViewXY=()=>{s.forEach((t=>t.graphic.updateViewXY()))},r.render=()=>{s.forEach((t=>{t.canDn.exists&&t.graphic.renderer.render()}))},r.setRenderer=t=>{r.rendererMaker=t,s.forEach((e=>e.graphic.setRenderer(t)))},r.renderForeground=()=>{t.showGhosts?r.renderForegroundAll():r.renderForegroundExisting()},r.renderForegroundExisting=()=>{s.forEach((t=>{t.canDn.exists&&t.graphic.renderForeground()}))},r.renderForegroundAll=()=>{s.forEach((t=>t.graphic.renderForeground()))}}function qs(t,e,n,o,i,r,s,a){const c=this;s.viewModes.sample.attach(c),To.call(c,e,o,a);const{candidateDnList:l,voterShapeList:u}=t,h=new Bs(a,l,e,i,r),d=new Ts(a,u,e,i);h.attachNewG(c.dragm),d.attachNewG(c.dragm);const f=c.enter;c.enter=()=>{f(),d.updateViewXY(),h.updateViewXY()},c.exit=()=>{},c.update=t=>{const{samplingResult:e}=t;o.check(["draggables"])&&(d.updateViewXY(),h.updateViewXY());const{pointsChanged:n,partyWinFraction:i}=e;n&&h.setCandidateDnWins(i),c.clearForeground(),c.renderForeground()},c.clickEmpty=()=>{},c.testVoteView=()=>null,c.renderForeground=()=>{d.renderForeground(),h.renderForeground()},c.clearForeground=()=>{e.clearForeground()}}function js(t,e){const n=this,o=[];n.attach=t=>{o.push(t)},n.width=t,n.height=e,n.darkMode=!1,n.setDarkMode=t=>{n.darkMode=t;const[e,i]=t?["darkMode","lightMode"]:["lightMode","darkMode"],r=document.getElementsByTagName("html")[0];r.classList.remove(i),r.classList.add(e),o.forEach((e=>{e.setDarkMode(t)}))},n.setDarkMode(window.matchMedia("(prefers-color-scheme: dark)").matches),n.showDownloadScreenLink=!1,n.setShowDownloadScreenLink=t=>{n.showDownloadScreenLink=t,o.forEach((e=>{e.setShowDownloadScreenLink(t)}))},n.svgMode=!1,n.setSvgMode=t=>{n.svgMode=t,o.forEach((e=>{e.setSvgMode(t)}))}}function Hs(t,e,n){const o=new Jn({label:"Drawing Mode:",width:Qn(3),data:[{name:"Canvas",value:!1},{name:"SVG",value:!0}],onChoose:e=>{t.setSvgMode(e.value),n.rerender()}});o.highlight("value",t.svgMode),e.newElement("svgSwitch",o.dom)}function Us(t,e){const n=new Jn({label:"Show Link to Download Screen Image/SVG:",width:Qn(3),data:[{name:"Yes",value:!0},{name:"No",value:!1}],onChoose:e=>{t.setShowDownloadScreenLink(e.value)}});n.highlight("value",t.svgMode),e.newElement("showDownloadScreenLink",n.dom)}function $s(t,e,n,o,i){const{entities:r,simOptions:s,electionOptions:a,changes:c}=t,l=new js(300,300),u=new Xn(l,e,n,"viz"),h=new Xn(l,e,n,"vizMini");h.setHeight(l.height/3),h.hide(),Hs(l,n,e),Us(l,n),Zn(l,n,e);const d=new to(c);return new Os(r,u,i,c,s,a,e,d,o),new qs(r,u,i,c,s,a,e,d),new No(r,u,h,i,c,s,a,e,d),new hs(r,u,i,c,s,e,d),new co(l,n,i,c,s,a,e),new gs(r,l,n,c,s,a,e),{screenMain:u}}function Ws(t,e){e.addMenuItem(t,{label:"Mode:",prop:"mode",setProp:e=>{t.setMode(e)},options:[{name:"One Election",value:"one"},{name:"Sample Elections",value:"sample"}],change:["mode"]});e.addMenuItem(t,{label:"Number of Districts:",prop:"numDistricts",setProp:e=>{t.setNumDistricts(e)},options:[{name:"20",value:20},{name:"5",value:5},{name:"1",value:1}],change:["numDistricts"]});e.addMenuItem(t,{label:"Dimensions:",prop:"dimensions",setProp:e=>{t.setDimensions(e)},options:[{name:"1D",value:1},{name:"2D",value:2}],change:["dimensions"]})}function zs(t,e){const n=M.map((({shortName:t,functionName:e})=>({name:t,value:e})));e.addMenuItem(t,{label:"Election Method:",prop:"socialChoiceMethod",setProp:t.setSocialChoiceMethod,options:n,change:["socialChoiceMethod"]})}function Xs(t,e){const n=document.createElement("button"),o=document.createElement("button");n.className="button2",o.className="button2",n.innerText="Undo",o.innerText="Redo",n.onclick=e.undo,o.onclick=e.redo,t.newElement("undo",n),t.newElement("redo",o)}function Ys(){const t=this;t.div=document.createElement("div");const e=document.createElement("a");e.style.margin="4px",t.div.append(e);const n=document.createElement("button");n.className="button2",n.innerText="X",n.onclick=()=>{t.hide()},t.div.append(n),t.show=()=>{e.hidden=!1,n.hidden=!1},t.hide=()=>{e.hidden=!0,n.hidden=!0},t.setUrl=t=>{e.href=t},t.setFileName=t=>{e.innerText=t,e.download=t},t.setFileName("download")}function Js(){const t=this;t.value="",t.div=document.createElement("div");const e=document.createElement("textarea");e.style.margin="4px",t.div.append(e);const n=document.createElement("button");n.className="button2",n.innerText="X",n.onclick=()=>{t.hide()},t.div.append(n),t.show=()=>{e.hidden=!1,n.hidden=!1},t.hide=()=>{e.hidden=!0,n.hidden=!0},t.setText=n=>{e.value=n,t.value=n}}function Ks(t,e,n){const o=document.createElement("button");o.className="button2",o.innerText="Save Config To Text";const r=document.createElement("button");r.className="button2",r.innerText="Download Config Json";const s=new Ys;s.setFileName("config.json"),s.hide();const a=new Js;a.hide(),o.onclick=()=>{a.show();const t=i(e.getConfig());a.setText(t)},r.onclick=()=>{o.onclick();const t=`data:text/json;charset=utf-8,${encodeURIComponent(a.value)}`;s.setUrl(t);const e=n.value;""!==e&&s.setFileName(`${e}.json`),s.show()};const c=document.createElement("div"),l=document.createElement("div");l.appendChild(o),l.appendChild(r),l.appendChild(s.div),l.appendChild(c),l.appendChild(a.div),t.newElement("saveConfigToText",l)}function Qs(t,e){const n=document.createElement("input");n.type="file",n.accept=".json",n.onchange=()=>{const o=n.files[0],i=new FileReader;i.addEventListener("load",t),i.readAsText(o);const{name:r}=o,s=r.split(".").slice(0,-1).join(".");e.set(s)};const o=document.createElement("button");return o.className="button2",o.innerText="Upload Json",o.onclick=()=>{n.click()},o}function Zs(t,e,n){const o=document.createElement("button");o.className="button2",o.innerText="Load Config Text";const i=document.createElement("textarea");o.onclick=()=>{if(""===i.value)return;const t=JSON.parse(i.value);e.loadConfig(t)};const r=Qs((function(t){const{result:n}=t.target,o=JSON.parse(n);e.loadConfig(o)}),n);const s=document.createElement("div"),a=document.createElement("div");a.appendChild(o),a.appendChild(r),a.appendChild(s),a.appendChild(i),t.newElement("loadConfigText",a)}function ta(t,e){const n=function(t){const e=new URLSearchParams(t),n=e.toString();return n}(t);return`${function(){const t=document.location.href.split("/"),e=t.slice(0,t.length-1);return e.join("/")}()}/${e}?${n}`}function ea(t,e,n){const o=JSON.stringify(t),i=encodeURIComponent(o),r=n.value;return ta(""===r?{a:i}:{a:i,name:r},e)}function na(t,e,n,o){const i=document.createElement("button");i.className="button2",i.innerText="Save Link";const r=document.createElement("button");r.className="button2",r.innerText="Copy Link to Clipboard";const s=new Js;s.hide(),i.onclick=()=>{s.show();const t=ea(e.getConfig(),n,o);s.setText(t)},r.onclick=()=>{i.onclick(),navigator.clipboard.writeText(s.value)};const a=document.createElement("div"),c=document.createElement("div");c.appendChild(i),c.appendChild(r),c.appendChild(a),c.appendChild(s.div),t.newElement("saveConfigToLink",c)}function oa(t){const e=document.createElement("div");e.setAttribute("class","button-group-label2"),e.innerText="Sim Controls:",t.newElement("simControlsLabel",e)}function ia(t,e,n){const o=document.createElement("button");function i(){o.hidden=!0}o.className="button2",o.innerText="Add Candidate",o.onclick=()=>{n.addCandidatePressed()},e.newElement("addCandidate",o),i(),t.viewModes.one.attach({enter:function(){o.hidden=!1},exit:i,update:()=>{}})}function ra(t,e,n){const o=document.createElement("button");function i(){o.hidden=!0}o.className="button2",o.innerText="Add Candidate Distribution",o.onclick=()=>{n.addCandidateDistributionPressed()},e.newElement("addCandidateDistribution",o),i(),t.viewModes.sample.attach({enter:function(){o.hidden=!1},exit:i,update:()=>{}})}function sa(t,e){const n=document.createElement("button");n.innerText="Add Voter",n.className="button2",n.onclick=()=>{e.addVoterPressed()},t.newElement("addVoter",n)}function aa(t,e,n){ia(t,n,e.candidateList),ra(t,n,e.candidateDnList),sa(n,e.voterShapeList)}ns.invert=function(t,e){for(var n,o=e,i=o*o,r=i*i*i,s=0;s<12&&(r=(i=(o-=n=(o*(Kr+Qr*i+r*(Zr+ts*i))-e)/(Kr+-.24331799999999998*i+r*(.0062510000000000005+.034164*i)))*o)*i*i,!(hi(n)<ri));++s);return[es*t*(Kr+-.24331799999999998*i+r*(.0062510000000000005+.034164*i))/pi(o),bi(yi(o)/es)]},os.invert=Wr(di),is.invert=function(t,e){var n,o=e,i=25;do{var r=o*o,s=r*r;o-=n=(o*(1.007226+r*(.015085+s*(.028874*r-.044475-.005916*s)))-e)/(1.007226+r*(.045255+s*(.259866*r-.311325-.005916*11*s)))}while(hi(n)>ii&&--i>0);return[t/(.8707+(r=o*o)*(r*(r*r*r*(.003971-.001529*r)-.013791)-.131979)),o]},rs.invert=Wr(bi),ss.invert=Wr((function(t){return 2*di(t)})),as.invert=function(t,e){return[-e,2*di(mi(t))-ai]};const ca={x:function(){if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;const t=["MSXML2.XmlHttp.6.0","MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"];let e;for(let n=0;n<t.length;n++)try{e=new ActiveXObject(t[n]);break}catch(t){}return e},send:function(t,e,n,o,i){let r=i;void 0===r&&(r=!0);const s=ca.x();s.open(n,t,r),s.onreadystatechange=function(){4===s.readyState&&e(s.responseText)},"POST"===n&&s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.send(o)},get:function(t,e,n,o){const i=[],r=Object.keys(e);for(let t=0;t<r.length;t++){const n=r[t];i.push(`${encodeURIComponent(n)}=${encodeURIComponent(e[n])}`)}ca.send(t+(i.length?`?${i.join("&")}`:""),n,"GET",null,o)}};var la=ca;var ua="https://script.google.com/macros/s/AKfycbw_t8aLSdKGRFVhAenhPu56Gl-N9fEucx6Ic-H9jtfb55g_1flmiFK7WsHfsx1Dg2LSuQ/exec";function ha(t,e,n,o){const r=ea(t,e,n),s=p(i(t));la.get(ua,{shortcode:s,link:r},(t=>{if(""!==t){if("success"===JSON.parse(t).result){const t=n.value,i=ta(""===t?{b:s}:{b:s,name:t},e);return void o(i)}}o("Bad. The link didn't publish. The short link won't work.")}))}function da(t,e,n,o){const i=document.createElement("button");i.className="button2",i.innerText="Publish Short Link";const r=document.createElement("button");r.className="button2",r.innerText="And Copy to Clipboard";const s=new Js;s.hide();const a="requesting short link...";i.onclick=()=>{s.show();const t=e.getConfig();s.setText(a),ha(t,n,o,(t=>{s.setText(t)}))},r.onclick=()=>{s.show();const t=e.getConfig();s.setText(a),ha(t,n,o,(t=>{navigator.clipboard.writeText(t)}))};const c=document.createElement("div"),l=document.createElement("div");l.appendChild(i),l.appendChild(r),l.appendChild(c),l.appendChild(s.div),t.newElement("saveConfigToShortLink",l)}function fa(t){const e=document.createElement("label");e.className="button-group-label2",e.innerText="Name: ";const n=document.createElement("input");n.type="text",n.placeholder="",n.set=t=>{n.value=t};const o=document.createElement("div");return o.appendChild(e),o.appendChild(n),t.newElement("name",o),n}function pa(t,e,n){const o=this;o.divMenu=document.createElement("div"),e.newElement("menu",o.divMenu),o.addMenuItem=function(e,i){const{prop:r,setProp:s,label:a,options:c,change:l}=i,u=new Kn(e,r,s,a,c,l,t,n);u.select(),o.divMenu.appendChild(u.choose.dom)}}function ma(t,e,n){const o=document.createElement("button");o.className="button2",o.innerText="Save Data To Text";const r=document.createElement("button");r.className="button2",r.innerText="Download Data Json";const s=new Ys;s.setFileName("data.json"),s.hide();const a=new Js;a.hide(),o.onclick=()=>{a.show();const{dataStore:t}=n,e=i(t);a.setText(e)},r.onclick=()=>{o.onclick();const t=`data:text/json;charset=utf-8,${encodeURIComponent(a.value)}`;s.setUrl(t);const n=e.value;""!==n&&s.setFileName(`${n}_data.json`),s.show()};const c=document.createElement("div"),l=document.createElement("div");l.appendChild(o),l.appendChild(r),l.appendChild(s.div),l.appendChild(c),l.appendChild(a.div),t.newElement("saveData",l)}function ga(t,e){const n=this;t.attach(n),n.dataStore={},n.update=t=>{e.checkNone()||(n.dataStore=t)}}function ya(t,e,n,o){const{commander:i,simOptions:r,electionOptions:s,entities:a,changes:c,pub:l}=t,u=new pa(c,n,i);Ws(r,u),zs(s,u),Xs(n,i);const h=fa(n);na(n,i,o,h),da(n,i,o,h),Ks(n,i,h),Zs(n,i,h),oa(n);return ma(n,h,new ga(l,c)),aa(e,a,n),{nameInput:h,menu:u}}function wa(t){const e=t.get("a"),n=decodeURIComponent(e);return JSON.parse(n)}function va(t,e){la.get(ua,{shortcode:t,link:"getTable"},(t=>{const n=JSON.parse(t),{link:o}=n,i=new URL(o),{search:r}=i,s=wa(new URLSearchParams(r));e({yes:!0,config:s})}))}function _a(t,e,n){const{search:o}=t,i=new URLSearchParams(o),r=i.get("name");null!==r&&e.set(r);const s=i.has("a"),a=i.has("b"),c=s||a;if(s){return void n({yes:c,config:wa(i)})}if(a){return void va(i.get("b"),n)}n({yes:c,config:{}})}function xa(t,e,n,o){_a(t,o,(function(t){const o=t.yes?t.config:e;n(o)}))}const ba=void 0!==window.IPython;function Ca(t){ba&&(Object.assign(window.votekitStore,t),void 0!==window.votekitUpdate&&window.votekitUpdate(window.votekitStore,t))}function Sa(t,e){t.attach({update:t=>{e.checkNone()||(window.votekitStore={},Ca(t))}})}function ka(t,e){const{changes:n,simOptions:o,pub:i,update:r,init:s}=t,a=new Ke(i,o,n),c=new m,l=new Ye(Xe),{nameInput:u,menu:h}=ya(t,a,l,e),{screenMain:d}=$s(t,a,l,c,h);Sa(i,n),window.requestAnimationFrame((function t(){r(),function(){if(c.checkNone()&&0===d.tweenGroup.getAll().length)return;d.tweenGroup.update(),a.clearForeground(),a.renderForeground()}(),window.requestAnimationFrame(t)}));return{div:l.makeComponent(),load:function(t,e){xa(t,e,s,u)}}}function Aa(t,e,n,o){const i=ka(ze(o),n),{div:r,load:s}=i;return s(t,e),r}ba&&(window.votekitStore={},window.getVotekitStore=()=>{if(ba){(t=>window.IPython.notebook.kernel.execute(t))(`votekitData = '${JSON.stringify(window.votekitStore)}'`)}}),Array.from(document.getElementsByClassName("sandbox")).forEach((t=>{const e=void 0!==t.dataset.config?JSON.parse(t.dataset.config):{},n=void 0!==t.dataset.sandboxurl?t.dataset.sandboxurl:"",o=Aa(window.location,e,n);t.parentNode.appendChild(o)})),Array.from(document.getElementsByClassName("double_sandbox")).forEach((e=>{const n=function(e,n){const o=new t,i=document.createElement("button");i.className="button2",i.innerText="linked",i.style["vertical-align"]="middle",i.style["min-width"]="70px",i.style.margin="5px",i.onclick=()=>{"linked"===i.innerText?(i.innerText="unlinked",o.setLinked(!1)):(i.innerText="linked",o.setLinked(!0))};const r=window.location,s=Aa(r,e,n,o),a=Aa(r,e,n,o);s.style.display="inline-block",a.style.display="inline-block",s.style["vertical-align"]="top",a.style["vertical-align"]="top";const c=document.createElement("div");return c.appendChild(s),c.appendChild(i),c.appendChild(a),c}(void 0!==e.dataset.config?JSON.parse(e.dataset.config):{},void 0!==e.dataset.sandboxurl?e.dataset.sandboxurl:"");e.parentNode.appendChild(n)}))})();
//# sourceMappingURL=addSandboxes.js.map
