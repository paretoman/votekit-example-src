(()=>{class t{constructor(){this.linked=!0,this.commanders=[],this.protect=!1}setLinked(t){this.linked=t}addCommander(t){this.commanders.push(t)}broadcastDo(t,e){this.linked&&!1===this.protect?(this.protect=!0,this.commanders.forEach((e=>e.passDo(t))),this.protect=!1):e.passDo(t)}broadcastDoCommands(t,e){this.linked&&!1===this.protect?(this.protect=!0,this.commanders.forEach((e=>e.passDoCommands(t))),this.protect=!1):e.passDoCommands(t)}broadcastLoadConfig(t,e){this.linked&&!1===this.protect?(this.protect=!0,this.commanders.forEach((e=>e.passLoadConfig(t))),this.protect=!1):e.passLoadConfig(t)}broadCastLoadCommands(t,e){this.linked&&!1===this.protect?(this.protect=!0,this.commanders.forEach((e=>e.passLoadCommands(t))),this.protect=!1):e.passLoadCommands(t)}}function e(){const t=this,e=["init"];t.add=t=>{t.forEach((t=>e.push(t)))},t.check=t=>{let n=0;return t.forEach((t=>{n+=e.includes(t)?1:0})),n>0},t.checkNone=()=>0===e.length,t.checkAny=()=>0!==e.length,t.clear=()=>{e.splice(0,e.length)}}function n(){const t=this;t.handlers={start:()=>{},move:()=>{},end:()=>{},touchmove:()=>{},touchstart:()=>{},touchend:()=>{}},t.set=e=>{Object.assign(t.handlers,e)}}function o(t,e,o){const r=this;r.width=t,r.height=e,r.darkMode=!1,r.setDarkMode=t=>{r.darkMode=t;const[e,n]=t?["darkMode","lightMode"]:["lightMode","darkMode"],o=document.getElementsByTagName("html")[0];o.classList.remove(n),o.classList.add(e),r.ctx.strokeStyle="#555",r.darkMode&&(r.ctx.strokeStyle="#ddd")},r.canvas=document.createElement("canvas"),r.canvas.setAttribute("class","background"),r.ctx=r.canvas.getContext("2d"),r.tooltips=document.createElement("div"),r.tooltips.setAttribute("class","tooltips"),r.foreground=document.createElement("canvas"),r.foreground.setAttribute("class","foreground"),r.fctx=r.foreground.getContext("2d"),r.maps=document.createElement("canvas"),r.maps.setAttribute("class","maps"),r.mctx=r.maps.getContext("2d");const i=document.createElement("div");r.wrap=document.createElement("div"),r.wrap.setAttribute("class","screenWrap"),r.wrap.appendChild(i),r.wrap.appendChild(r.canvas),r.wrap.appendChild(r.tooltips),r.wrap.appendChild(r.foreground),o.newElement("screenWrap",r.wrap),o.newElement("maps",r.maps),r.noBuffers=!1,r.setDarkMode(window.matchMedia("(prefers-color-scheme: dark)").matches),r.pixelRatio=function(t){const e=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/e}
/*!!
 *  Canvas 2 Svg v1.0.21
 *  A low level canvas to SVG converter. Uses a mock canvas context to build an SVG document.
 *
 *  Licensed under the MIT license:
 *  http://www.opensource.org/licenses/mit-license.php
 *
 *  Author:
 *  Kerry Liu
 *
 *  Copyright (c) 2014 Gliffy Inc.
 */(r.ctx),r.canvas.width=t*r.pixelRatio,r.canvas.height=e*r.pixelRatio,r.canvas.style.width=`${t}px`,r.canvas.style.height=`${e}px`,r.wrap.style.width=`${t}px`,r.wrap.style.height=`${e}px`,r.tooltips.style.width=`${t}px`,r.tooltips.style.height=`${e}px`,r.foreground.width=t*r.pixelRatio,r.foreground.height=e*r.pixelRatio,r.foreground.style.width=`${t}px`,r.foreground.style.height=`${e}px`,r.maps.width=t*r.pixelRatio,r.maps.style.width=`${t}px`,r.setMapsHeight=t=>{const e=Math.round(t);r.maps.heightBrowser=e,r.maps.height=e*r.pixelRatio,r.maps.style.height=`${e}px`,r.mctx.scale(r.pixelRatio,r.pixelRatio)},r.setMapsHeight(1/3*e),r.ctx.scale(r.pixelRatio,r.pixelRatio),r.fctx.scale(r.pixelRatio,r.pixelRatio),r.clear=function(){r.ctx.clearRect(0,0,r.canvas.width,r.canvas.height),r.darkMode&&r.noBuffers&&(r.ctx.fillStyle="#222",r.ctx.fillRect(0,0,r.canvas.width,r.canvas.height),r.ctx.fillStyle="white")},r.clearForeground=function(){r.fctx.clearRect(0,0,r.foreground.width,r.foreground.height),r.darkMode&&r.noBuffers&&(r.fctx.fillStyle="#222",r.fctx.fillRect(0,0,r.foreground.width,r.foreground.height),r.fctx.fillStyle="white")},r.clearMaps=function(){r.mctx.clearRect(0,0,r.maps.width,r.maps.height)},r.setCtx=function(t){r.ctx=t},r.setFCtx=function(t){r.fctx=t},r.setMCtx=function(t){r.mctx=t},r.setNoBuffers=function(t){r.noBuffers=t},r.showMaps=()=>{r.maps.style.display="block"},r.hideMaps=()=>{r.maps.style.display="none"},r.hideMaps(),r.eventHandlers=new n;const{handlers:s}=r.eventHandlers;r.wrap.onmousedown=t=>s.start(t),r.wrap.onmousemove=t=>s.move(t),r.wrap.onmouseup=t=>s.end(t),r.wrap.addEventListener("touchmove",(t=>s.touchmove(t))),r.wrap.addEventListener("touchstart",(t=>s.touchstart(t))),r.wrap.addEventListener("touchend",(t=>s.touchend(t)));const a=document.onmouseup;document.onmouseup=t=>{a&&a(t),r.wrap.onmouseup(t)}}var r,i,s,a,c;function l(t,e){var n,o=Object.keys(e);for(n=0;n<o.length;n++)t=t.replace(new RegExp("\\{"+o[n]+"\\}","gi"),e[o[n]]);return t}function h(t){var e,n,o;if(!t)throw new Error("cannot create a random attribute name for an undefined object");e="ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",n="";do{for(n="",o=0;o<12;o++)n+=e[Math.floor(Math.random()*e.length)]}while(t[n]);return n}function u(t){var e={alphabetic:"alphabetic",hanging:"hanging",top:"text-before-edge",bottom:"text-after-edge",middle:"central"};return e[t]||e.alphabetic}c=function(t,e){var n,o,r,i={};for(t=t.split(","),e=e||10,n=0;n<t.length;n+=2)o="&"+t[n+1]+";",r=parseInt(t[n],e),i[o]="&#"+r+";";return i["\\xa0"]="&#160;",i}("50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro",32),r={strokeStyle:{svgAttr:"stroke",canvas:"#000000",svg:"none",apply:"stroke"},fillStyle:{svgAttr:"fill",canvas:"#000000",svg:null,apply:"fill"},lineCap:{svgAttr:"stroke-linecap",canvas:"butt",svg:"butt",apply:"stroke"},lineJoin:{svgAttr:"stroke-linejoin",canvas:"miter",svg:"miter",apply:"stroke"},miterLimit:{svgAttr:"stroke-miterlimit",canvas:10,svg:4,apply:"stroke"},lineWidth:{svgAttr:"stroke-width",canvas:1,svg:1,apply:"stroke"},globalAlpha:{svgAttr:"opacity",canvas:1,svg:1,apply:"fill stroke"},font:{canvas:"10px sans-serif"},shadowColor:{canvas:"#000000"},shadowOffsetX:{canvas:0},shadowOffsetY:{canvas:0},shadowBlur:{canvas:0},textAlign:{canvas:"start"},textBaseline:{canvas:"alphabetic"},lineDash:{svgAttr:"stroke-dasharray",canvas:[],svg:null,apply:"stroke"}},(s=function(t,e){this.__root=t,this.__ctx=e}).prototype.addColorStop=function(t,e){var n,o=this.__ctx.__createElement("stop");o.setAttribute("offset",t),-1!==e.indexOf("rgba")?(n=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi.exec(e),o.setAttribute("stop-color",l("rgb({r},{g},{b})",{r:n[1],g:n[2],b:n[3]})),o.setAttribute("stop-opacity",n[4])):o.setAttribute("stop-color",e),this.__root.appendChild(o)},a=function(t,e){this.__root=t,this.__ctx=e},(i=function(t){var e,n={width:500,height:500,enableMirroring:!1};if(arguments.length>1?((e=n).width=arguments[0],e.height=arguments[1]):e=t||n,!(this instanceof i))return new i(e);this.width=e.width||n.width,this.height=e.height||n.height,this.enableMirroring=void 0!==e.enableMirroring?e.enableMirroring:n.enableMirroring,this.canvas=this,this.__document=e.document||document,e.ctx?this.__ctx=e.ctx:(this.__canvas=this.__document.createElement("canvas"),this.__ctx=this.__canvas.getContext("2d")),this.__setDefaultStyles(),this.__stack=[this.__getStyleState()],this.__groupStack=[],this.__root=this.__document.createElementNS("http://www.w3.org/2000/svg","svg"),this.__root.setAttribute("version",1.1),this.__root.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.__root.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),this.__root.setAttribute("width",this.width),this.__root.setAttribute("height",this.height),this.__ids={},this.__defs=this.__document.createElementNS("http://www.w3.org/2000/svg","defs"),this.__root.appendChild(this.__defs),this.__currentElement=this.__document.createElementNS("http://www.w3.org/2000/svg","g"),this.__root.appendChild(this.__currentElement)}).prototype.__createElement=function(t,e,n){void 0===e&&(e={});var o,r,i=this.__document.createElementNS("http://www.w3.org/2000/svg",t),s=Object.keys(e);for(n&&(i.setAttribute("fill","none"),i.setAttribute("stroke","none")),o=0;o<s.length;o++)r=s[o],i.setAttribute(r,e[r]);return i},i.prototype.__setDefaultStyles=function(){var t,e,n=Object.keys(r);for(t=0;t<n.length;t++)this[e=n[t]]=r[e].canvas},i.prototype.__applyStyleState=function(t){var e,n,o=Object.keys(t);for(e=0;e<o.length;e++)this[n=o[e]]=t[n]},i.prototype.__getStyleState=function(){var t,e,n={},o=Object.keys(r);for(t=0;t<o.length;t++)n[e=o[t]]=this[e];return n},i.prototype.__applyStyleToCurrentElement=function(t){var e=this.__currentElement,n=this.__currentElementsToStyle;n&&(e.setAttribute(t,""),e=n.element,n.children.forEach((function(e){e.setAttribute(t,"")})));var o,i,c,h,u,d=Object.keys(r);for(o=0;o<d.length;o++)if(i=r[d[o]],c=this[d[o]],i.apply)if(c instanceof a){if(c.__ctx)for(;c.__ctx.__defs.childNodes.length;)h=c.__ctx.__defs.childNodes[0].getAttribute("id"),this.__ids[h]=h,this.__defs.appendChild(c.__ctx.__defs.childNodes[0]);e.setAttribute(i.apply,l("url(#{id})",{id:c.__root.getAttribute("id")}))}else if(c instanceof s)e.setAttribute(i.apply,l("url(#{id})",{id:c.__root.getAttribute("id")}));else if(-1!==i.apply.indexOf(t)&&i.svg!==c)if("stroke"!==i.svgAttr&&"fill"!==i.svgAttr||-1===c.indexOf("rgba")){var f=i.svgAttr;if("globalAlpha"===d[o]&&(f=t+"-"+i.svgAttr,e.getAttribute(f)))continue;e.setAttribute(f,c)}else{u=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi.exec(c),e.setAttribute(i.svgAttr,l("rgb({r},{g},{b})",{r:u[1],g:u[2],b:u[3]}));var p=u[4],g=this.globalAlpha;null!=g&&(p*=g),e.setAttribute(i.svgAttr+"-opacity",p)}},i.prototype.__closestGroupOrSvg=function(t){return"g"===(t=t||this.__currentElement).nodeName||"svg"===t.nodeName?t:this.__closestGroupOrSvg(t.parentNode)},i.prototype.getSerializedSvg=function(t){var e,n,o,r,i,s=(new XMLSerializer).serializeToString(this.__root);if(/xmlns="http:\/\/www\.w3\.org\/2000\/svg".+xmlns="http:\/\/www\.w3\.org\/2000\/svg/gi.test(s)&&(s=s.replace('xmlns="http://www.w3.org/2000/svg','xmlns:xlink="http://www.w3.org/1999/xlink')),t)for(e=Object.keys(c),n=0;n<e.length;n++)o=e[n],r=c[o],(i=new RegExp(o,"gi")).test(s)&&(s=s.replace(i,r));return s},i.prototype.getSvg=function(){return this.__root},i.prototype.save=function(){var t=this.__createElement("g"),e=this.__closestGroupOrSvg();this.__groupStack.push(e),e.appendChild(t),this.__currentElement=t,this.__stack.push(this.__getStyleState())},i.prototype.restore=function(){this.__currentElement=this.__groupStack.pop(),this.__currentElementsToStyle=null,this.__currentElement||(this.__currentElement=this.__root.childNodes[1]);var t=this.__stack.pop();this.__applyStyleState(t)},i.prototype.__addTransform=function(t){var e=this.__closestGroupOrSvg();if(e.childNodes.length>0){"path"===this.__currentElement.nodeName&&(this.__currentElementsToStyle||(this.__currentElementsToStyle={element:e,children:[]}),this.__currentElementsToStyle.children.push(this.__currentElement),this.__applyCurrentDefaultPath());var n=this.__createElement("g");e.appendChild(n),this.__currentElement=n}var o=this.__currentElement.getAttribute("transform");o?o+=" ":o="",o+=t,this.__currentElement.setAttribute("transform",o)},i.prototype.scale=function(t,e){void 0===e&&(e=t),this.__addTransform(l("scale({x},{y})",{x:t,y:e}))},i.prototype.rotate=function(t){var e=180*t/Math.PI;this.__addTransform(l("rotate({angle},{cx},{cy})",{angle:e,cx:0,cy:0}))},i.prototype.translate=function(t,e){this.__addTransform(l("translate({x},{y})",{x:t,y:e}))},i.prototype.transform=function(t,e,n,o,r,i){this.__addTransform(l("matrix({a},{b},{c},{d},{e},{f})",{a:t,b:e,c:n,d:o,e:r,f:i}))},i.prototype.beginPath=function(){var t;this.__currentDefaultPath="",this.__currentPosition={},t=this.__createElement("path",{},!0),this.__closestGroupOrSvg().appendChild(t),this.__currentElement=t},i.prototype.__applyCurrentDefaultPath=function(){var t=this.__currentElement;"path"===t.nodeName?t.setAttribute("d",this.__currentDefaultPath):console.error("Attempted to apply path command to node",t.nodeName)},i.prototype.__addPathCommand=function(t){this.__currentDefaultPath+=" ",this.__currentDefaultPath+=t},i.prototype.moveTo=function(t,e){"path"!==this.__currentElement.nodeName&&this.beginPath(),this.__currentPosition={x:t,y:e},this.__addPathCommand(l("M {x} {y}",{x:t,y:e}))},i.prototype.closePath=function(){this.__currentDefaultPath&&this.__addPathCommand("Z")},i.prototype.lineTo=function(t,e){this.__currentPosition={x:t,y:e},this.__currentDefaultPath.indexOf("M")>-1?this.__addPathCommand(l("L {x} {y}",{x:t,y:e})):this.__addPathCommand(l("M {x} {y}",{x:t,y:e}))},i.prototype.bezierCurveTo=function(t,e,n,o,r,i){this.__currentPosition={x:r,y:i},this.__addPathCommand(l("C {cp1x} {cp1y} {cp2x} {cp2y} {x} {y}",{cp1x:t,cp1y:e,cp2x:n,cp2y:o,x:r,y:i}))},i.prototype.quadraticCurveTo=function(t,e,n,o){this.__currentPosition={x:n,y:o},this.__addPathCommand(l("Q {cpx} {cpy} {x} {y}",{cpx:t,cpy:e,x:n,y:o}))};var d=function(t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]);return[t[0]/e,t[1]/e]};i.prototype.arcTo=function(t,e,n,o,r){var i=this.__currentPosition&&this.__currentPosition.x,s=this.__currentPosition&&this.__currentPosition.y;if(void 0!==i&&void 0!==s){if(r<0)throw new Error("IndexSizeError: The radius provided ("+r+") is negative.");if(i===t&&s===e||t===n&&e===o||0===r)this.lineTo(t,e);else{var a=d([i-t,s-e]),c=d([n-t,o-e]);if(a[0]*c[1]!=a[1]*c[0]){var l=a[0]*c[0]+a[1]*c[1],h=Math.acos(Math.abs(l)),u=d([a[0]+c[0],a[1]+c[1]]),f=r/Math.sin(h/2),p=t+f*u[0],g=e+f*u[1],m=[-a[1],a[0]],y=[c[1],-c[0]],w=function(t){var e=t[0];return t[1]>=0?Math.acos(e):-Math.acos(e)},v=w(m),_=w(y);this.lineTo(p+m[0]*r,g+m[1]*r),this.arc(p,g,r,v,_)}else this.lineTo(t,e)}}},i.prototype.stroke=function(){"path"===this.__currentElement.nodeName&&this.__currentElement.setAttribute("paint-order","fill stroke markers"),this.__applyCurrentDefaultPath(),this.__applyStyleToCurrentElement("stroke")},i.prototype.fill=function(){"path"===this.__currentElement.nodeName&&this.__currentElement.setAttribute("paint-order","stroke fill markers"),this.__applyCurrentDefaultPath(),this.__applyStyleToCurrentElement("fill")},i.prototype.rect=function(t,e,n,o){"path"!==this.__currentElement.nodeName&&this.beginPath(),this.moveTo(t,e),this.lineTo(t+n,e),this.lineTo(t+n,e+o),this.lineTo(t,e+o),this.lineTo(t,e),this.closePath()},i.prototype.fillRect=function(t,e,n,o){var r;r=this.__createElement("rect",{x:t,y:e,width:n,height:o},!0),this.__closestGroupOrSvg().appendChild(r),this.__currentElement=r,this.__applyStyleToCurrentElement("fill")},i.prototype.strokeRect=function(t,e,n,o){var r;r=this.__createElement("rect",{x:t,y:e,width:n,height:o},!0),this.__closestGroupOrSvg().appendChild(r),this.__currentElement=r,this.__applyStyleToCurrentElement("stroke")},i.prototype.__clearCanvas=function(){for(var t=this.__closestGroupOrSvg().getAttribute("transform"),e=this.__root.childNodes[1],n=e.childNodes,o=n.length-1;o>=0;o--)n[o]&&e.removeChild(n[o]);this.__currentElement=e,this.__groupStack=[],t&&this.__addTransform(t)},i.prototype.clearRect=function(t,e,n,o){if(0!==t||0!==e||n!==this.width||o!==this.height){var r,i=this.__closestGroupOrSvg();r=this.__createElement("rect",{x:t,y:e,width:n,height:o,fill:"#FFFFFF"},!0),i.appendChild(r)}else this.__clearCanvas()},i.prototype.createLinearGradient=function(t,e,n,o){var r=this.__createElement("linearGradient",{id:h(this.__ids),x1:t+"px",x2:n+"px",y1:e+"px",y2:o+"px",gradientUnits:"userSpaceOnUse"},!1);return this.__defs.appendChild(r),new s(r,this)},i.prototype.createRadialGradient=function(t,e,n,o,r,i){var a=this.__createElement("radialGradient",{id:h(this.__ids),cx:o+"px",cy:r+"px",r:i+"px",fx:t+"px",fy:e+"px",gradientUnits:"userSpaceOnUse"},!1);return this.__defs.appendChild(a),new s(a,this)},i.prototype.__parseFont=function(){var t=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-,\'\"\sa-z0-9]+?)\s*$/i.exec(this.font),e={style:t[1]||"normal",size:t[4]||"10px",family:t[6]||"sans-serif",weight:t[3]||"normal",decoration:t[2]||"normal",href:null};return"underline"===this.__fontUnderline&&(e.decoration="underline"),this.__fontHref&&(e.href=this.__fontHref),e},i.prototype.__wrapTextLink=function(t,e){if(t.href){var n=this.__createElement("a");return n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t.href),n.appendChild(e),n}return e},i.prototype.__applyText=function(t,e,n,o){var r,i,s=this.__parseFont(),a=this.__closestGroupOrSvg(),c=this.__createElement("text",{"font-family":s.family,"font-size":s.size,"font-style":s.style,"font-weight":s.weight,"text-decoration":s.decoration,x:e,y:n,"text-anchor":(r=this.textAlign,i={left:"start",right:"end",center:"middle",start:"start",end:"end"},i[r]||i.start),"dominant-baseline":u(this.textBaseline)},!0);c.appendChild(this.__document.createTextNode(t)),this.__currentElement=c,this.__applyStyleToCurrentElement(o),a.appendChild(this.__wrapTextLink(s,c))},i.prototype.fillText=function(t,e,n){this.__applyText(t,e,n,"fill")},i.prototype.strokeText=function(t,e,n){this.__applyText(t,e,n,"stroke")},i.prototype.measureText=function(t){return this.__ctx.font=this.font,this.__ctx.measureText(t)},i.prototype.arc=function(t,e,n,o,r,i){if(o!==r){(o%=2*Math.PI)===(r%=2*Math.PI)&&(r=(r+2*Math.PI-.001*(i?-1:1))%(2*Math.PI));var s=t+n*Math.cos(r),a=e+n*Math.sin(r),c=t+n*Math.cos(o),h=e+n*Math.sin(o),u=i?0:1,d=0,f=r-o;f<0&&(f+=2*Math.PI),d=i?f>Math.PI?0:1:f>Math.PI?1:0,this.lineTo(c,h),this.__addPathCommand(l("A {rx} {ry} {xAxisRotation} {largeArcFlag} {sweepFlag} {endX} {endY}",{rx:n,ry:n,xAxisRotation:0,largeArcFlag:d,sweepFlag:u,endX:s,endY:a})),this.__currentPosition={x:s,y:a}}},i.prototype.clip=function(){var t=this.__closestGroupOrSvg(),e=this.__createElement("clipPath"),n=h(this.__ids),o=this.__createElement("g");this.__applyCurrentDefaultPath(),t.removeChild(this.__currentElement),e.setAttribute("id",n),e.appendChild(this.__currentElement),this.__defs.appendChild(e),t.setAttribute("clip-path",l("url(#{id})",{id:n})),t.appendChild(o),this.__currentElement=o},i.prototype.drawImage=function(){var t,e,n,o,r,s,a,c,l,h,u,d,f,p,g=Array.prototype.slice.call(arguments),m=g[0],y=0,w=0;if(3===g.length)t=g[1],e=g[2],n=r=m.width,o=s=m.height;else if(5===g.length)t=g[1],e=g[2],n=g[3],o=g[4],r=m.width,s=m.height;else{if(9!==g.length)throw new Error("Inavlid number of arguments passed to drawImage: "+arguments.length);y=g[1],w=g[2],r=g[3],s=g[4],t=g[5],e=g[6],n=g[7],o=g[8]}a=this.__closestGroupOrSvg(),this.__currentElement;var v="translate("+t+", "+e+")";if(m instanceof i){if((c=m.getSvg().cloneNode(!0)).childNodes&&c.childNodes.length>1){for(l=c.childNodes[0];l.childNodes.length;)p=l.childNodes[0].getAttribute("id"),this.__ids[p]=p,this.__defs.appendChild(l.childNodes[0]);if(h=c.childNodes[1]){var _,x=h.getAttribute("transform");_=x?x+" "+v:v,h.setAttribute("transform",_),a.appendChild(h)}}}else"IMG"===m.nodeName?((u=this.__createElement("image")).setAttribute("width",n),u.setAttribute("height",o),u.setAttribute("preserveAspectRatio","none"),(y||w||r!==m.width||s!==m.height)&&((d=this.__document.createElement("canvas")).width=n,d.height=o,(f=d.getContext("2d")).drawImage(m,y,w,r,s,0,0,n,o),m=d),u.setAttribute("transform",v),u.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","CANVAS"===m.nodeName?m.toDataURL():m.getAttribute("src")),a.appendChild(u)):"CANVAS"===m.nodeName&&((u=this.__createElement("image")).setAttribute("width",n),u.setAttribute("height",o),u.setAttribute("preserveAspectRatio","none"),(d=this.__document.createElement("canvas")).width=n,d.height=o,(f=d.getContext("2d")).imageSmoothingEnabled=!1,f.mozImageSmoothingEnabled=!1,f.oImageSmoothingEnabled=!1,f.webkitImageSmoothingEnabled=!1,f.drawImage(m,y,w,r,s,0,0,n,o),m=d,u.setAttribute("transform",v),u.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",m.toDataURL()),a.appendChild(u))},i.prototype.drawImageSvg=function(){var t,e,n,o,r,i,s,a,c=Array.prototype.slice.call(arguments),l=c[0];if(3===c.length)t=c[1],e=c[2],n=l.width,o=l.height;else if(5===c.length)t=c[1],e=c[2],n=c[3],o=c[4],l.width,l.height;else{if(9!==c.length)throw new Error("Inavlid number of arguments passed to drawImage: "+arguments.length);c[1],c[2],c[3],c[4],t=c[5],e=c[6],n=c[7],o=c[8]}r=this.__closestGroupOrSvg(),this.__currentElement;var h="translate("+t+", "+e+")";if(l instanceof SVGSVGElement&&l.childNodes&&l.childNodes.length>1){var u=parseFloat(l.getAttribute("width")),d=parseFloat(l.getAttribute("height"));l.setAttribute("width",n),l.setAttribute("height",o);var f=n/u,p=o/d;for(i=l.childNodes[0];i.childNodes.length;)a=i.childNodes[0].getAttribute("id"),this.__ids[a]=a,this.__defs.appendChild(i.childNodes[0]);if(s=l.childNodes[1]){var g,m=s.getAttribute("transform");g=m?m+" "+h:h,s.setAttribute("transform",g+" scale("+f+", "+p+")"),r.appendChild(s)}}},i.prototype.createPattern=function(t,e){var n,o=this.__document.createElementNS("http://www.w3.org/2000/svg","pattern"),r=h(this.__ids);return o.setAttribute("id",r),o.setAttribute("width",t.width),o.setAttribute("height",t.height),"CANVAS"===t.nodeName||"IMG"===t.nodeName?((n=this.__document.createElementNS("http://www.w3.org/2000/svg","image")).setAttribute("width",t.width),n.setAttribute("height",t.height),n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","CANVAS"===t.nodeName?t.toDataURL():t.getAttribute("src")),o.appendChild(n),this.__defs.appendChild(o)):t instanceof i&&(o.appendChild(t.__root.childNodes[1]),this.__defs.appendChild(o)),new a(o,this)},i.prototype.setLineDash=function(t){t&&t.length>0?this.lineDash=t.join(","):this.lineDash=null},i.prototype.drawFocusRing=function(){},i.prototype.createImageData=function(){},i.prototype.getImageData=function(){},i.prototype.putImageData=function(){},i.prototype.globalCompositeOperation=function(){},i.prototype.setTransform=function(){};var f=i;function p(t,e,n){const o=t.width,r=t.height,i=document.createElement("div");n.newElement("svgUIDiv",i);const s=document.createElement("button");s.className="button2",s.innerText="Make SVG",s.onclick=function(){const n=t.ctx,o=t.fctx;t.setCtx(d),t.setFCtx(d),t.setNoBuffers(!0);const r=t.mctx;t.setMCtx(p);const{heightBrowser:i}=t.maps;s=i,u.style.height=`${Math.round(s)}px`,u.height=s,p.__root.setAttribute("height",s),e(),function(){l.hidden=!1;const t=d.getSerializedSvg(!0);h.innerHTML=t,h.hidden=!1,a.hidden=!1;const e=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(t)}`;a.href=e}(),function(){const t=p.getSerializedSvg(!0);u.innerHTML=t,u.hidden=!1,c.hidden=!1;const e=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(t)}`;c.href=e}(),t.setCtx(n),t.setFCtx(o),t.setNoBuffers(!1),t.setMCtx(r);var s},i.appendChild(s);const a=document.createElement("a");a.innerText="Download SVG",a.download="vote.svg",a.hidden=!0,a.style.margin="4px",i.appendChild(a);const c=document.createElement("a");c.innerText="Download Map SVG",c.download="vote_map.svg",c.hidden=!0,c.style.margin="4px",i.appendChild(c);const l=document.createElement("button");l.className="button2",l.innerText="Hide SVG",l.hidden=!0,l.onclick=function(){l.hidden=!0,h.hidden=!0,a.hidden=!0,u.hidden=!0,c.hidden=!0},i.appendChild(l);const h=document.createElement("div");h.setAttribute("class","svgDiv"),h.style.width=`${o}px`,h.style.height=`${r}px`,h.hidden=!0,i.appendChild(h);const u=document.createElement("div");u.setAttribute("class","mSvgDiv"),u.style.width=`${o}px`,u.style.height=`${Math.round(r/3)}px`,u.hidden=!0,i.appendChild(u);const d=new f(o,r),p=new f(o,Math.round(r/3))}function g(t,e){const n=this;n.config=t,n.name=t.name,n.nameIsHTML=t.nameIsHTML||!1,n.dom=document.createElement("div"),n.dom.setAttribute("class","button button2");let o=t.margin;o=o||0,o=Math.max(o,4),n.dom.style.marginRight=`${o}px`,n.draw=function(){n.nameIsHTML?n.dom.innerHTML=n.name:n.dom.innerText=n.name},n.draw(),n.dom.setAttribute("title",t.realname||""),n.onClick=function(){e(n,t)},n.dom.onclick=n.onClick,n.turnOff=function(){n.isOn=!1,n.config.isOn=!1,n.dom.setAttribute("on","no")},n.turnOn=function(){n.isOn=!0,n.config.isOn=!0,n.dom.setAttribute("on","yes")},n.turnOff()}function m(t){const e=this;e.config=t,void 0===t.data&&(t.data=[],void 0===t.makeData&&(t.makeData=()=>[]),e.makeData=t.makeData,e.buttonConfigs=e.makeData(),e.doMakeData=!0),e.buttonConfigs=t.data,e.labelName=t.label,e.labelIsHTML=t.labelIsHTML||!1,e.onChoose=t.onChoose,e.isCheckbox=t.isCheckbox||!1,e.isCheckboxBool=t.isCheckboxBool||!1,e.justButton=t.justButton||!1,e.buttonHidden=t.buttonHidden||{},e.dom=document.createElement("div"),e.dom.setAttribute("class","button-group"),e.buttonDOMByValue=[],e.init=function(){e.doMakeData&&(e.buttonConfigs=e.makeData()),e.dom.innerHTML="",e.buttons=[],e.buttonsByName={},e.labelDOM=document.createElement("div"),e.labelDOM.setAttribute("class","button-group-label"),e.draw(),e.dom.appendChild(e.labelDOM);for(let n=0;n<e.buttonConfigs.length;n++){const o=e.buttonConfigs[n],r=new g(o,e.onToggle);e.buttonsByName[o.name]=r,r.dom.style.width=`${t.width}px`,o.width&&(r.dom.style.width=`${o.width}px`),e.buttons.push(r),e.dom.appendChild(r.dom),e.buttonDOMByValue[o.value]=r.dom}for(let t=0;t<e.buttons.length;t++){const n=e.buttons[t];if(n.config.selected){n.turnOn();break}}e.draw()},e.updateNames=function(){const t=e.makeData();for(let n=0;n<e.buttonConfigs.length;n++)e.buttonConfigs[n].name=t[n].name,e.buttons[n].name=e.buttonConfigs[n].name},e.redraw=function(){e.updateNames(),e.draw()},e.draw=function(){e.labelIsHTML?e.labelDOM.innerHTML=e.labelName:e.labelDOM.innerText=e.labelName;for(const t of e.buttons)t.draw()},e.configureHidden=function(){for(const[t,n]of Object.entries(e.buttonHidden))e.buttonsByName[t].dom.hidden=n},e.onToggle=function(t,n){if(e.isCheckbox||e.isCheckboxBool)t.isOn?t.turnOff():t.turnOn();else{for(let t=0;t<e.buttons.length;t++)e.buttons[t].turnOff();t.turnOn(),e.justButton&&setTimeout((()=>t.turnOff()),800)}e.onChoose(n)},e.highlight=function(t,n){if(0!==e.buttons.length){for(let t=0;t<e.buttons.length;t++)e.buttons[t].turnOff();if(e.isCheckbox)for(const o in e.buttons){const r=e.buttons[o];n.includes(r.config[t])&&r.turnOn()}else if(e.isCheckboxBool)for(const o in e.buttons){const r=e.buttons[o],i=r.config[t];i in n&&n[i]&&r.turnOn()}else{const o=e.buttons.filter((e=>{const{config:o}=e;return o[t]===n}))[0];void 0!==o&&o.turnOn()}}},e.init()}function y(t,e,n,o,r,i,s,a){const c=this;c.list=r,c.onChoose=function(t){c.sender.go(t.value)},c.action=t=>{c.set(t),c.select()},c.sender=a.addSender({name:e,action:c.action,currentValue:t[e]}),c.set=function(t){n(t),c.configure(),s.add(i)},c.choose=new m({label:o,width:w(3),data:c.list,onChoose:c.onChoose}),c.configure=function(){},c.select=function(){c.choose.highlight("value",t[e])}}function w(t){return(302-18*(t-1)-10)/t}function v(t,e,n){const o=this;o.divMenu=document.createElement("div"),e.newElement("menu",o.divMenu),o.addMenuItem=function(e,r){const{prop:i,setProp:s,label:a,options:c,change:l}=r,h=new y(e,i,s,a,c,l,t,n);h.select(),o.divMenu.appendChild(h.choose.dom)}}function _(t){const e=function(t){const e=t.map((t=>t.shape1.w)),n=e.reduce(((t,e)=>t+e)),o=e.map((t=>t/n)),r=[];return o.reduce(((t,e,n)=>{const o=t+e;return r[n]=o,o}),0),r}(t);this.samplePoint=function(){return function(t,e){const n=function(t){const e=Math.random(),n=t.findIndex((t=>t>=e));return n}(e),o=t[n],r="gaussian"===o.shape1.densityProfile,i=(r?b:x)(o.shape1.x,.5*o.shape1.w);return{shape1:i,party:[n]}}(t,e)}}function x(t,e){return{x:(2*Math.random()-1)*e+t}}function b(t,e){const n=Math.random(),o=Math.random();return{x:2*e/Math.sqrt(2*Math.PI)*Math.sqrt(-2*Math.log(n))*Math.cos(2*Math.PI*o)+t}}function S(t){const e=function(t){const e=t.map((t=>t.shape2.w**2)),n=e.reduce(((t,e)=>t+e)),o=e.map((t=>t/n)),r=[];return o.reduce(((t,e,n)=>{const o=t+e;return r[n]=o,o}),0),r}(t);this.samplePoint=function(){return function(t,e){const n=function(t){const e=Math.random(),n=t.findIndex((t=>t>=e));return n}(e),o=t[n],r=function(t,e,n){const o=n*Math.sqrt(Math.random()),r=2*Math.random()*Math.PI,i=t+o*Math.cos(r),s=e+o*Math.sin(r);return{x:i,y:s}}(o.shape2.x,o.shape2.y,.5*o.shape2.w);return{shape2:r,party:[n]}}(t,e)}}function C(t,e,n){const o=this;o.update=()=>{e.checkNone()||o.startSampler()},o.startSampler=()=>{const{dimensions:e}=n,r=t.getCandidateDistributions();if(0===r.length)return;const i=1===e?_:S;o.sampler=new i(r)}}function M(){const t=this,e=[];t.attach=t=>{e.push(t)},t.enter=()=>{e.forEach((t=>t.enter()))},t.exit=()=>{e.forEach((t=>t.exit()))},t.update=t=>{e.forEach((e=>e.update(t)))},t.render=t=>{e.forEach((e=>{e.render&&e.render(t)}))},t.renderForeground=t=>{e.forEach((e=>{e.renderForeground&&e.renderForeground(t)}))}}function A(t,e,n,o,r,i,s,a){const c=this;c.pub=new M;const{candidateDnList:l,voterShapeList:h}=t,u=new C(l,n,o);let d;c.enter=()=>{d=a.geo?i:r,c.pub.enter()},c.exit=()=>{c.pub.exit()},c.update=()=>{a.geo&&s.update(),u.update();const{dimensions:t}=a.election,e=d.update(h,l,u.sampler,n,t);return c.pub.update(e),e},c.render=()=>{c.pub.render()},c.renderForeground=()=>{c.pub.renderForeground()}}function E(t){const e={usr:4};this.runElectionSim=function(n,o,r){if(r.checkNone())return{error:"No Changes"};const i=o.getCandidates(),s=n.getVoterShapes();if(0===s.length)return{error:"No Voters"};if(0===i.length)return{error:"No Candidates"};return t.runElection(s,i,e)}}function k(t){const e=this,n={usr:16};let o,r=[];e.update=function(t,n,o,r,i){r.checkAny()&&e.startSim();return e.addSim(t,n,o,i)},e.startSim=function(){r=[],o=Array(10).fill(0)},e.addSim=function(e,i,s,a){if(0===e.getVoterShapes().length)return{pointsChanged:!1};if(0===i.getCandidateDistributions().length)return{pointsChanged:!1};if(r.length>5e3)return{pointsChanged:!1};const{seats:c}=t.socialChoice,l=Array(20*c);let h=0;const u=e.getVoterShapes();for(let e=0;e<20;e++){const i=t.socialChoice.numSampleCandidates,c=[];for(let t=0;t<i;t++){const t=s.samplePoint();c.push(t)}const d=t.runElection(u,c,n);if("singleWinner"===t.socialChoice.checkElectionType()){const{winner:t}=d,n=1===a?t.shape1:t.shape2;o[t.party]+=1,r.push(n),l[e]=n}else{const{allocation:t}=d,e=10;for(let n=0;n<c.length;n++){const i=c[n],s=t[n];for(let t=0;t<s;t++){let n;n=0===t?1===a?i.shape1:i.shape2:1===a?{x:i.shape1.x+(Math.random()-.5)*e}:{x:i.shape2.x+(Math.random()-.5)*e,y:i.shape2.y+(Math.random()-.5)*e},o[i.party]+=1,r.push(n),l[h]=n,h+=1}}}}const d=o.map((t=>t/r.length));return{pointsChanged:!0,newPoints:l,points:r,partyWinFraction:d}}}const P=void 0!==window.IPython;function T(t){P&&(Object.assign(window.votekitStore,t),void 0!==window.votekitUpdate&&window.votekitUpdate(window.votekitStore,t))}function F(t){return[...Array(t).keys()]}function N(t){return"object"==typeof t?Array.isArray(t)?t.map(N):Object.keys(t).sort().reduce(((e,n)=>{const o=t[n];return e[n]=N(o),e}),{}):t}function D(t,e,n){return 1/(n*Math.sqrt(2*Math.PI))*Math.exp(-.5*((t-e)/n)**2)}function L(t,e,n){return t===1/0?1:t===-1/0?0:.5*function(t){const e=.147,n=t**2,o=1+e*n,r=-(4/Math.PI+e*n)/o*n,i=Math.exp(r),s=Math.sqrt(1-i)*Math.sign(t);return s}((t-e)/(n*Math.sqrt(2)))+.5}function V(t){const e=document.createElement("canvas"),n=e.getContext("2d");n.fillStyle=t;const o=n.fillStyle;return e.remove(),o}function I(t){let e=1/0,n=null;for(let o=0;o<t.length;o++){const r=t[o];r<e&&(e=r,n=o)}return n}function R(t){let e=-1/0,n=null;for(let o=0;o<t.length;o++){const r=t[o];r>e&&(e=r,n=o)}return n}function O(t){let e=t[0],n=t[0];for(let o=0;o<t.length;o++){const r=t[o];r<e&&(e=r),r>n&&(n=r)}return[e,n]}function G(t,e,n){return t<e?e:t>n?n:t}function B(t){const e=t.length,n=Array(e);for(let o=0;o<e;o++)n[o]=t[o];return n}function q(t){return{...t}}function j(t,e){const n=this,o={usr:32};n.runElectionSim=(t,e,o)=>{if(o.checkNone())return{error:"No Changes"};const r=e.getCandidates();return n.runElectionGeo(t,r)},n.runElectionGeo=(n,r)=>{if(0===n.getVoterShapes().length)return{error:"no voters"};if(0===r.length)return{error:"no candidates"};const i=t.getParties(r),s=function(n,r){const{voterGroupsByTract:i}=e,s=i.map((e=>e.map((e=>t.castVotes(e,n,r,o)))));return s}(r,i),a=function(e,n,o){const r=n.length,i=function(t,e){const n={};if(void 0!==t[0][0].tallyFractions){const o=function(t,e){const n=Array(e).fill(0);t.forEach((t=>t.forEach((t=>{const{tallyFractions:o}=t;for(let t=0;t<e;t++)n[t]+=o[t]}))));const o=1/n.reduce(((t,e)=>t+e));return n.map((t=>t*o))}(t,e);n.tallyFractions=o}if(void 0!==t[0][0].pairwiseTallyFractions){const o=function(t,e){const n=Array(e);for(let t=0;t<e;t++)n[t]=Array(e).fill(0);t.forEach((t=>t.forEach((t=>{const{pairwiseTallyFractions:o}=t;for(let t=0;t<e;t++)for(let r=0;r<e;r++)n[t][r]+=o[t][r]}))));const o=1/(n[0][1]+n[1][0]);return n.map((t=>t.map((t=>t*o))))}(t,e);n.pairwiseTallyFractions=o}if(void 0!==t[0][0].cansByRank){const e=function(t){let e=[],n=[];t.forEach((t=>t.forEach((t=>{const{votePop:o,cansByRank:r}=t;e=e.concat(o),n=n.concat(r)}))));const o=t.length,r=t[0].length,i=1/(o*r);return e=e.map((t=>t*i)),{votePop:e,cansByRank:n}}(t);n.votePop=e.votePop,n.cansByRank=e.cansByRank}if(void 0!==t[0][0].scoreVotes){const e=function(t){let e=[],n=[];t.forEach((t=>t.forEach((t=>{const{votePop:o,scoreVotes:r}=t;e=e.concat(o),n=n.concat(r)}))));const o=t.length,r=t[0].length,i=1/(o*r);return e=e.map((t=>t*i)),{votePop:e,scoreVotes:n}}(t);n.votePop=e.votePop,n.scoreVotes=e.scoreVotes}return n}(e,r);T({allVotes:i});const s=t.socialChoice.run(n,i,o);return s}(s,r,i),c=function(e,n,o){const r=e.map((e=>e.map((e=>t.socialChoice.run(n,e,o)))));return r}(s,r,i),l=function(n,o,r){const i=function(t,n){const{census:o}=e.districtMaker,{nd:r}=e,i=n.length,s=F(r).map((e=>{const n=o[e],r={};if(void 0!==t[0][0].tallyFractions){const e=function(t,e,n){const o=Array(n).fill(0);for(let r=0;r<e.length;r++){const[i,s,a]=e[r],{tallyFractions:c}=t[i][s];for(let t=0;t<n;t++)o[t]+=c[t]*a}const r=1/o.reduce(((t,e)=>t+e));return o.map((t=>t*r))}(t,n,i);r.tallyFractions=e}if(void 0!==t[0][0].pairwiseTallyFractions){const e=function(t,e,n){const o=Array(n);for(let t=0;t<n;t++)o[t]=Array(n).fill(0);for(let r=0;r<e.length;r++){const[i,s,a]=e[r],{pairwiseTallyFractions:c}=t[i][s];for(let t=0;t<n;t++)for(let e=0;e<n;e++)o[t][e]+=c[t][e]*a}const r=1/(o[0][1]+o[1][0]);return o.map((t=>t.map((t=>t*r))))}(t,n,i);r.pairwiseTallyFractions=e}if(void 0!==t[0][0].cansByRank){const e=function(t,e){let n=[],o=[],r=0;for(let t=0;t<e.length;t++){const[,,n]=e[t];r+=n}const i=1/r;for(let s=0;s<e.length;s++){const[a,c,l]=e[s];r+=l;const{votePop:h,cansByRank:u}=t[a][c],d=h.map((t=>t*l*i));n=n.concat(d),o=o.concat(u)}return{votePop:n,cansByRank:o}}(t,n);r.votePop=e.votePop,r.cansByRank=e.cansByRank}if(void 0!==t[0][0].scoreVotes){const e=function(t,e){let n=[],o=[],r=0;for(let t=0;t<e.length;t++){const[,,n]=e[t];r+=n}const i=1/r;for(let s=0;s<e.length;s++){const[a,c,l]=e[s];r+=l;const{votePop:h,scoreVotes:u}=t[a][c],d=h.map((t=>t*l*i));n=n.concat(d),o=o.concat(u)}return{votePop:n,scoreVotes:o}}(t,n);r.votePop=e.votePop,r.scoreVotes=e.scoreVotes}return r}));return s}(n,o);T({votesByDistrict:i});const s=i.map((e=>t.socialChoice.run(o,e,r)));return s}(s,r,i),h=function(e,n){const o=n.length,r=Array(o).fill(0);if("singleWinner"===t.socialChoice.checkElectionType()){e.map((t=>t.iWinner)).forEach((t=>{r[t]+=1}))}else e.forEach((t=>{for(let e=0;e<o;e++)r[e]+=t.allocation[e]}));return r}(l,r);T({votesByTract:s});return{resultsStatewide:a,resultsByTract:c,resultsByDistrict:l,allocation:h}}}function W(t){const e=function(t){const e=t.length,n=new Array(e);for(let o=0;o<e;o++){n[o]=[];for(let r=0;r<e;r++){if(o===r)continue;const e=t[o],i=t[r];n[o].push($(e,i))}}return n}(t);this.sumArea=function(t){const n=e.length,o=Array(n);for(let r=0;r<n;r++){const n=e[r];o[r]=U(t,n)}return o}}function $(t,e){const n=e.x-t.x,o=e.y-t.y;return{A:{x:n,y:o},b:.5*(t.x+e.x)*n+.5*(t.y+e.y)*o}}function U(t,e){let n=0;const o=t.x,r=t.y,{w:i}=t,s=.5*i;for(let t=o-s;t<o+s;t+=2){const i=s**2-(t-o)**2;let a;a=i>0?Math.sqrt(i):0;let c=r+a,l=r-a;for(let n=0;n<e.length;n++){const o=e[n],r=o.A.y,i=o.A.x,{b:s}=o;if(0===r)i*t<s||(l=1/0);else{const e=(s-i*t)/r;r<0?l=Math.max(l,e):c=Math.min(c,e)}}const h=c-l;if(h>0){n+=2*h}}return n}function H(t){const e=function(t){const e=t.length,n=F(e).sort(((e,n)=>t[e].x-t[n].x)),o=new Array(e-1);for(let r=0;r<e-1;r++)o[r]=.5*(t[n[r]].x+t[n[r+1]].x);const r=new Array(e);for(let t=0;t<e;t++){const i=0===t?-1/0:o[t-1],s=t===e-1?1/0:o[t];r[n[t]]={lower:i,upper:s}}return r}(t);this.sumArea=function(n){const o=t.length,r=Array(o);if("gaussian"===n.densityProfile)for(let t=0;t<o;t++)r[t]=X(n,e[t]);else for(let t=0;t<o;t++)r[t]=z(n,e[t]);return r}}function z(t,e){const{lower:n,upper:o}=e,{x:r,w:i}=t,s=.5*i,a=r-s,c=r+s,l=Math.max(n,a),h=Math.min(o,c);return Math.max(0,h-l)}function X(t,e){const{lower:n,upper:o}=e,{x:r,w:i}=t,s=r,a=i/Math.sqrt(2*Math.PI);return i*L(o,s,a)-i*L(n,s,a)}function Y({canGeoms:t,voterGeoms:e,dimensions:n}){const o=1===n?new H(t):new W(t),r=t.length;let i=new Array(r).fill(0);e.forEach((t=>{const e=o.sumArea(t),n=void 0===t.weight?1:t.weight;i=i.map(((t,o)=>t+e[o]*n))}));const s=i.reduce(((t,e)=>t+e));return{tallyFractions:i.map((t=>t/s))}}function J({canGeoms:t,voterGeom:e,dimensions:n}){const o=t.length,r=new Array(o).fill(0),i=1===n?K:Z,s=t.map((t=>i(t,e))),[a,c]=O(s);for(let t=0;t<o;t++){const e=s[t];if(e<=a)r[t]=1;else if(e>=c)r[t]=0;else{const n=(e-a)/(c-a);r[t]=0+1*(1-n)}}return{tallyFractions:r}}function K(t,e){return Math.abs(t.x-e.x)}function Z(t,e){return Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2)}function Q(t,e){this.sumArea=function(n){const o=function(t,e){const n="gaussian"===t.densityProfile,o=n?3:1,{x:r,y:i,w:s}=t,a=s*o,{usr:c}=e,l=Math.round(a/c),h=F(l),u=F(l),d=h.map((t=>(t+.5)*c-.5*a+r)),f=u.map((t=>(t+.5)*c-.5*a+i)),p=h.length,g=u.length,m=p*g,y=Array(m),w=Array(m),v=Array(m);let _=0;for(let e=0;e<u.length;e++)for(let n=0;n<h.length;n++){const o=d[n],r=f[e];y[_]=o,w[_]=r,v[_]=tt(t,o,r),_+=1}const x={x:y,y:w,weight:v,nx:p,ny:g};return x}(n,e),r=t.length,i=Array(r).fill(0);let s=0;const a=o.x.length,c=Array(a),l=o.weight;for(let e=0;e<a;e++){const n=o.weight[e],a=o.x[e],l=o.y[e],h=J({canGeoms:t,voterGeom:{x:a,y:l},dimensions:2});c[e]=h;const{tallyFractions:u}=h;s+=n;for(let t=0;t<r;t++)i[t]+=u[t]*n}return{grid:o,voteSet:c,area:i,totalArea:s,weightSet:l}}}function tt(t,e,n){const o="gaussian"===t.densityProfile,{x:r,y:i,w:s}=t;if(!o){return(e-r)**2+(n-i)**2<(.5*s)**2?1:0}const a=s/Math.sqrt(2*Math.PI);return s*D(e,r,a)*D(n,i,a)}function et(t){this.sumArea=function(e){const n=function(t){const e="gaussian"===t.densityProfile,n=e?3:1,{x:o,w:r}=t,i=Math.round(r*n),s=F(i),a={x:s.map((t=>t+.5-.5*i+o))};return a}(e),o=t.length,r=Array(o).fill(0);let i=0;const s=n.x.length,a=Array(s),c=Array(s);for(let l=0;l<s;l++){const s=n.x[l],h=J({canGeoms:t,voterGeom:{x:s},dimensions:1});a[l]=h;const{tallyFractions:u}=h,d=nt(e,s);c[l]=d,i+=d;for(let t=0;t<o;t++)r[t]+=u[t]*d}return{grid:n,voteSet:a,weightSet:c,area:r,totalArea:i}}}function nt(t,e){if(!("gaussian"===t.densityProfile))return 1;const{x:n,w:o}=t;return o*D(e,n,o/Math.sqrt(2*Math.PI))}function ot(t){for(var e,n=-1,o=t.length,r=t[o-1],i=0;++n<o;)e=r,r=t[n],i+=e[1]*r[0]-e[0]*r[1];return i/2}function rt(t){for(var e,n,o=-1,r=t.length,i=0,s=0,a=t[r-1],c=0;++o<r;)e=a,a=t[o],c+=n=e[0]*a[1]-a[0]*e[1],i+=(e[0]+a[0])*n,s+=(e[1]+a[1])*n;return[i/(c*=3),s/c]}function it(t,e){const n=t.length,o=[],r=[];let i=0,s=0,a=t[n-1],c=at(e,a);for(let l=0;l<n;l++){const n=t[l],h=at(e,n);if(c&&!h||!c&&h){const t=ct(a,n,st(e,a),st(e,n));o[i]=t,r[s]=t,i+=1,s+=1}h?(r[s]=n,s+=1):(o[i]=n,i+=1),a=n,c=h}return{positive:o,negative:r}}function st(t,e){return(t[0]*e[0]+t[1]*e[1]+t[2])/Math.sqrt(t[0]**2+t[1]**2)}function at(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]<0}function ct(t,e,n,o){let r=-o/(n-o);r<0&&(r=0),r>1&&(r=1);return[r*t[0]+(1-r)*e[0],r*t[1]+(1-r)*e[1]]}function lt(t,e){const n=function(t){const{x:e,y:n,w:o}=t,r=o/2,i=100,s=Array(i);for(let t=0;t<i;t++){const o=t/(i-1),a=2*Math.PI*o,c=e+r*Math.cos(a),l=n+r*Math.sin(a);s[t]=[c,l]}return s}(t);let o=[n];const r=e.length;let i=[Array(r).fill(0)];for(let t=0;t<r-1;t++)for(let n=t+1;n<r;n++){const r=o.length,s=Array(2*r),a=Array(2*r);let c=0;for(let l=0;l<r;l++){const r=it(o[l],ht(e[t],e[n])),h=r.positive;void 0!==h&&h.length>2&&(s[c]=h,a[c]=B(i[l]),a[c][n]+=1,c+=1);const u=r.negative;void 0!==u&&u.length>2&&(s[c]=u,a[c]=B(i[l]),a[c][t]+=1,c+=1)}s.splice(c),a.splice(c),o=s,i=a}const s=o.length,a=Array(s),c=Array(s);for(let t=0;t<s;t++){a[t]=Array(r),c[t]=Array(r);for(let e=0;e<r;e++)c[t][e]=[];for(let e=0;e<r;e++){const n=r-i[t][e];a[t][e]=n,c[t][n-1].push(e)}}return{cells:o,ranking:a,cansRanked:c}}function ht(t,e){const{A:n,b:o}=$(t,e);return[n.x,n.y,-o]}function ut(t){this.sumArea=function(e,n){let{cells:o,ranking:r,cansRanked:i}=lt(e,t);const s=o.length;let a=Array(s),c=0;for(let t=0;t<s;t++){const e=-ot(o[t])*n;a[t]=e,c+=e}const l=1e-6;return r=r.filter(((t,e)=>Math.abs(a[e])>l)),i=i.filter(((t,e)=>Math.abs(a[e])>l)),o=o.filter(((t,e)=>Math.abs(a[e])>l)),a=a.filter((t=>Math.abs(t)>l)),{ranking:r,cansRanked:i,area:a,totalArea:c,cellDatum:{cells:o,ranking:r}}}}function dt(t){const e=t.length,n=F(e).sort(((e,n)=>t[e].x-t[n].x)),o=.5*e*(e-1),r=Array(o),i=Array(o);let s=0;for(let o=0;o<e-1;o++)for(let l=o+1;l<e;l++){const e=n[o],h=n[l],u=(a=t[e],c=t[h],.5*(a.x+c.x));r[s]=u,i[s]=[e,h],s+=1}var a,c;const l=F(o).sort(((t,e)=>r[t]-r[e])),h=l.map((t=>r[t])),u=l.map((t=>i[t])),d=Array(e);for(let t=0;t<e;t++)d[n[t]]=t+1;const f=Array(o+1);f[0]=B(d);for(let t=0;t<o;t++){const[e,n]=u[t];d[e]+=1,d[n]-=1,f[t+1]=B(d)}const p=Array(o+1);for(let t=0;t<o+1;t++){p[t]=Array(e);for(let n=0;n<e;n++)p[t][n]=[];const n=f[t];for(let o=0;o<e;o++){const e=n[o];p[t][e-1].push(o)}}const g=B(h);return g.unshift(-1/0),g.push(1/0),{intervalBorders:g,ranking:f,cansRanked:p}}function ft(t){const{intervalBorders:e,ranking:n,cansRanked:o}=dt(t);this.sumArea=function(t,r){const i=e.length-1,s=Array(i);let a=0;for(let n=0;n<i;n++){const o=pt(e[n],e[n+1],t)*r;s[n]=o,a+=o}return{ranking:n,cansRanked:o,area:s,totalArea:a,cellDatum:{ranking:n,intervalBorders:e}}}}function pt(t,e,n){return"gaussian"===n.densityProfile?X(n,{lower:t,upper:e}):z(n,{lower:t,upper:e})}function gt({canGeoms:t,voterGeom:e,dimensions:n}){const o=1===n?mt:yt,r=I(t.map((t=>o(t,e)))),i=t.length,s=new Array(i).fill(0);s[r]=1;return{tallyFractions:s}}function mt(t,e){return(t.x-e.x)**2}function yt(t,e){return(t.x-e.x)**2+(t.y-e.y)**2}function wt({canGeoms:t,voterGeom:e,dimensions:n}){const o=1===n?vt:_t,r=t.map((t=>o(t,e))),i=t.length,s=F(i).sort(((t,e)=>r[t]-r[e])),a=new Array(i).fill(0),c=new Array(i).fill(0);for(let t=0;t<i;t++)a[s[t]]=t+1,c[s[t]]=i-t-1;const l=new Array(i);for(let t=0;t<i;t++){l[t]=new Array(i).fill(0);for(let e=0;e<i;e++)a[t]!==a[e]&&(l[t][e]=a[t]<a[e]?1:-1)}return{indexInOrder:s,ranking:a,bordaScores:c,pairwise:l,tallyFractions:c}}function vt(t,e){return(t.x-e.x)**2}function _t(t,e){return(t.x-e.x)**2+(t.y-e.y)**2}function xt(t){const e=t.length,n=Array(e-1),o=Array(e-1);for(let r=0;r<e-1;r++){n[r]=Array(e-r-1),o[r]=Array(e-r-1);for(let i=r+1;i<e;i++){const e=t[r].x,s=t[i].x,a=.5*(e+s);n[r][i]=a,o[r][i]=e<s}}this.sumArea=function(t,r){const i=function(t,e){const n=-1/0,o=1/0;return bt(n,o,t)*e}(t,r),s=Array(e).fill(0);for(let t=0;t<e;t++)s[t]=Array(e).fill(0);for(let a=0;a<e-1;a++)for(let c=a+1;c<e;c++){const e=bt(-1/0,n[a][c],t)*r,l=o[a][c]?e:i-e,h=i-l;s[a][c]=l,s[c][a]=h}return{area:s,totalArea:i}}}function bt(t,e,n){return"gaussian"===n.densityProfile?X(n,{lower:t,upper:e}):z(n,{lower:t,upper:e})}function St(t){this.sumArea=function(e,n){const o=function(t,e){return e*Math.PI*(t.w/2)**2}(e,n),r=t.length,i=Array(r).fill(0);for(let t=0;t<r;t++)i[t]=Array(r).fill(0);for(let s=0;s<r-1;s++)for(let a=s+1;a<r;a++){const r=At(Mt(Ct(t[s],t[a]),e),e,n,o),c=o-r;i[s][a]=r,i[a][s]=c}return{area:i,totalArea:o}}}function Ct(t,e){const{A:n,b:o}=$(t,e);return[n.x,n.y,-o]}function Mt(t,e){return(t[0]*e.x+t[1]*e.y+t[2])/Math.sqrt(t[0]**2+t[1]**2)}function At(t,e,n,o){const r=e.w/2;if(t>r)return 0;if(t<-r)return o;const i=t/r;return r**2*(Math.acos(i)-i*Math.sqrt(1-i**2))*n}P&&(window.votekitStore={},window.getVotekitStore=()=>{if(P){(t=>window.IPython.notebook.kernel.execute(t))(`votekitData = '${JSON.stringify(window.votekitStore)}'`)}});const Et={plurality:{cast:Y,castTestVote:gt},score:{cast:function({canGeoms:t,voterGeoms:e,dimensions:n,optionCast:o}){const r=1===n?new et(t):new Q(t,o),i=t.length;let s=new Array(i).fill(0),a=0;const c=[];for(let t=0;t<e.length;t++){const n=e[t],{grid:o,voteSet:i,area:l,totalArea:h}=r.sumArea(n),u={grid:o,voteSet:i,voterGeom:n};c.push(u);const d=void 0===n.weight?1:n.weight;s=s.map(((t,e)=>t+l[e]*d)),a+=h}return{tallyFractions:s.map((t=>t/a)),gridData:c}},castTestVote:J},scoreLong:{cast:function({canGeoms:t,voterGeoms:e,dimensions:n,optionCast:o}){const r=1===n?new et(t):new Q(t,o),i=t.length;let s=0;const a=[];for(let t=0;t<e.length;t++){const n=e[t];a[t]=r.sumArea(n);const{totalArea:o}=a[t];s+=o*(void 0===n.weight?1:n.weight)}const c=1/s;let l=new Array(i).fill(0);const h=[],u=[],d=[];let f=0;for(let t=0;t<e.length;t++){const n=e[t],{grid:o,voteSet:r,weightSet:i,area:s}=a[t],p=[];for(let t=0;t<r.length;t++)u[f]=r[t].tallyFractions,p[t]=f,d[f]=i[t]*c,f+=1;const g={grid:o,voteSet:r,voterGeom:n,voteIndex:p};h[t]=g;const m=void 0===n.weight?1:n.weight;l=l.map(((t,e)=>t+s[e]*m*c))}return{tallyFractions:l,gridData:h,scoreVotes:u,votePop:d}},castTestVote:J},ranking:{cast:function({canGeoms:t,voterGeoms:e,dimensions:n}){const o=1===n?new ft(t):new ut(t),r=t.length;let i=[],s=[],a=[];const c=Array(r).fill(0);let l=0;const h=[];e.forEach((t=>{const e=void 0===t.weight?1:t.weight,{rankings:n,cansRanked:r,area:u,totalArea:d,cellDatum:f}=o.sumArea(t,e);i=i.concat(u),s=s.concat(n),a=a.concat(r),l+=d,h.push(f);for(let t=0;t<r.length;t++){const e=r[t][0];for(let n=0;n<e.length;n++){const o=e[n];c[o]+=u[t]}}}));const u=i.map((t=>t/l)),d=c.map((t=>t/l));return{rankingVotes:s,cansByRank:a,votePop:u,tallyFractions:d,cellData:h}},castTestVote:wt},pairwise:{cast:function({canGeoms:t,voterGeoms:e,dimensions:n}){const o=1===n?new xt(t):new St(t);let r=0;const i=t.length,s=Array(i).fill(0);for(let t=0;t<i;t++)s[t]=Array(i).fill(0);e.forEach((t=>{const e=void 0===t.weight?1:t.weight,{area:n,totalArea:a}=o.sumArea(t,e);for(let t=0;t<i;t++)for(let e=0;e<i;e++)s[t][e]+=n[t][e];r+=a}));const a=s.map((t=>t.map((t=>t/r)))),c=Array(i).fill(0);for(let t=0;t<i-1;t++)for(let e=t+1;e<i;e++){const n=a[t][e],o=a[e][t];n>o?c[t]+=1:n<o&&(c[e]+=1)}return{pairwiseTallyFractions:a,tallyFractions:c.map((t=>t/(i-1)))}},castTestVote:wt},olprA:{cast:function({canGeoms:t,voterGeoms:e,dimensions:n}){return Y({canGeoms:t,voterGeoms:e,dimensions:n})},castTestVote:function({canGeoms:t,voterGeom:e,dimensions:n}){return gt({canGeoms:t,voterGeom:e,dimensions:n})}}};var kt=Et;function Pt({votes:t,electionMethodOptions:e,typeOfDivisor:n,seatLimits:o}){const{seats:r,threshold:i}=e;let s,a=t.tallyFractions.map((t=>t<i?0:t)),c=a.map((t=>0===t?0:1)),l=c.reduce(((t,e)=>t+e)),h=0===l;if(void 0!==o){c.map(((t,e)=>t*o[e])).reduce(((t,e)=>t+e))<r&&(h=!0)}if(h&&(a=B(t.tallyFractions),c=a.map((t=>0===t?0:1)),l=c.reduce(((t,e)=>t+e))),"Huntington-Hill"===n&&(l>r||0===l)){const e=[...a].sort(((t,e)=>e-t))[r-1];return{allocation:t.tallyFractions.map((t=>t>=e?1:0))}}"huntingtonHill"===n?s=(t,e)=>Math.sqrt(e*(e+1)):"sainteLague"===n?s=(t,e)=>e+.5:"dHondt"===n&&(s=(t,e)=>e+1);const u=Array(r).fill().map(s),d=[],f=[];let p=0;for(let t=0;t<a.length;t++){const e=a[t];if(0===e)continue;const n=void 0===o?r:Math.min(o[t],r);for(let o=0;o<n;o++)d[p]=u[o]/e,f[p]=t,p+=1}const g=F(f.length).sort(((t,e)=>d[t]-d[e])),m=Array(a.length).fill(0);for(let t=0;t<r;t++){m[f[g[t]]]+=1}return{allocation:m}}function Tt({votes:t,electionMethodOptions:e,seatLimits:n}){return Pt({votes:t,electionMethodOptions:e,seatLimits:n,typeOfDivisor:"sainteLague"})}function Ft({votes:t,electionMethodOptions:e}){const{tallyFractions:n}=t,{seats:o}=e,r=n.length;if(o>=r){return{allocation:Array(r).fill(1)}}const i=F(r).sort(((t,e)=>n[e]-n[t])),s=Array(r).fill(0);for(let t=0;t<o;t++){s[i[t]]=1}return{allocation:s}}const Nt={plurality:function({votes:t}){return{iWinner:R(t.tallyFractions)}},randomWinner:function({votes:t}){const e=t.tallyFractions.length;return{iWinner:Math.floor(Math.random()*e)}},huntingtonHill:function({votes:t,electionMethodOptions:e,seatLimits:n}){return Pt({votes:t,electionMethodOptions:e,seatLimits:n,typeOfDivisor:"huntingtonHill"})},score:function({votes:t}){const e=Math.max(...t.tallyFractions);return{iWinner:t.tallyFractions.indexOf(e)}},stv:function({votes:t,electionMethodOptions:e}){const{tallyFractions:n,votePop:o,cansByRank:r}=t,{seats:i}=e,s=n.length,a=o.length;if(i>=s){return{allocation:Array(s).fill(1)}}const c=1/(i+1);let l=!1,h=0;const u=[];let d=B(n);const f=Array(s).fill(!0);let p=F(s);const g=Array(a).fill(0),m=Array(a).fill(1),y=Array(a).fill(!1);for(;!l&&h<s;){if(0!==h){d=Array(s).fill(0);for(let t=0;t<r.length;t++){if(y[t])continue;const e=g[t],n=r[t][e];for(let e=0;e<n.length;e++){d[n[e]]+=o[t]*m[t]}}d=d.filter(((t,e)=>f[e])),p=F(s).filter((t=>f[t]))}const t=R(d),e=p[t],n=d[t];let a,w=1;if(n>=c)a=e,w=1-c/n,u.push(e),l=u.length===i;else{a=p[I(d)]}f[a]=!1;for(let t=0;t<r.length;t++){if(y[t])continue;const e=g[t];if(r[t][e].includes(a)){1!==w&&(m[t]*=w);let e=!y[t];for(;e;){g[t]+=1;const n=g[t];if(n===s){y[t]=!0;break}const o=r[t][n];for(let t=0;t<o.length;t++){const n=o[t];e=e&&!f[n]}}}}h+=1}l||console.warn("warning: STV ran over - eliminated all candidates.");const w=Array(s).fill(0);for(let t=0;t<u.length;t++){w[u[t]]+=1}return{allocation:w}},minimax:function({votes:t}){const{pairwiseTallyFractions:e}=t,n=e.length,o=Array(n).fill(0),r=.5*n*(n-1),i=Array(n),s=Array(r);let a=0;for(let t=0;t<n-1;t++)for(let r=t+1;r<n;r++){const n=e[t][r]-e[r][t];i[a]=Math.abs(n);const c=n<0;o[t]+=c?1:0,o[r]+=c?0:1,s[a]=c?t:r,a+=1}const c=F(r).sort(((t,e)=>i[t]-i[e]));let l=o.findIndex((t=>0===t)),h=0;for(;-1===l;){o[s[c[h]]]-=1,l=o.findIndex((t=>0===t)),h+=1}return{iWinner:l}},olprA:function({votes:t,electionMethodOptions:e,parties:n}){const{tallyFractions:o}=t,{partiesByCan:r,numParties:i}=n,s=o.length,a=Array(i).fill(0),c=Array(i).fill(0);for(let t=0;t<s;t++){const e=r[t];a[e]+=o[t],c[e]+=1}const l=Tt({votes:{tallyFractions:a},electionMethodOptions:e,seatLimits:c}).allocation,h=Array(s).fill(0);for(let t=0;t<i;t++){const e={seats:l[t]},n=F(s).filter((e=>r[e]===t)),i=Ft({votes:{tallyFractions:n.map((t=>o[t]))},electionMethodOptions:e}).allocation;for(let t=0;t<n.length;t++){h[n[t]]=i[t]}}return{allocation:h}},dHondt:function({votes:t,electionMethodOptions:e,seatLimits:n}){return Pt({votes:t,electionMethodOptions:e,seatLimits:n,typeOfDivisor:"dHondt"})},sainteLague:Tt,allocatedScore:function({votes:t,electionMethodOptions:e}){const{scoreVotes:n,votePop:o}=t,{seats:r}=e,i=n[0].length,s=n.length,a=1/r,c=Array(s).fill(1),l=Array(i).fill(0);let h=0;for(let t=0;t<i&&!(h>=r);t++){const t=Array(i).fill(0);for(let e=0;e<i;e++)if(1!==l[e])for(let r=0;r<s;r++)t[e]+=c[r]*o[r]*n[r][e];const e=Math.max(...t),r=t.indexOf(e);l[r]=1,h+=1;const u=F(s).sort(((t,e)=>n[e][r]-n[t][r]));let d=0;for(let t=0;t<s;t++){const e=u[t];if(d+=n[e][r]*c[e]*o[t],c[e]=0,d>=a)break}}return{allocation:l}},methodOfEqualShares:function({votes:t,electionMethodOptions:e}){const{scoreVotes:n,votePop:o}=t,{seats:r}=e,i=n[0].length,s=n.length,a=1/r,c=Array(s).fill(1),l=Array(i).fill(0),h=[],u=[],d=10**-4;let f=0;for(let t=0;t<i&&!(f>=r);t++){const e=Array(i).fill(0);for(let t=0;t<i;t++)if(1!==l[t])for(let r=0;r<s;r++)e[t]+=o[r]*n[r][t];const p=F(i).sort(((t,n)=>e[n]-e[t]));let g=null,m=1/0;for(let t=0;t<i;t++){const r=p[t];if(1===l[r])continue;const i=a/e[r];let h=!0;for(let t=0;t<s;t++){const e=n[t][r];if(c[t]<i*e){h=!1;break}}if(h&&i<m){m=i,g=r;break}const u=[];let f=0;const y=[];for(let t=0,e=0;t<s;t++){const i=c[t],s=n[t][r];u[t]=i/s,s>0&&(f+=i*o[t],y[e]=t,e+=1)}if(f+d-a<0)continue;const w=y.sort(((t,e)=>u[t]-u[e])),v=w.length;let _=a,x=e[r],b=null;for(let t=0;t<v;t++){const e=w[t];if(b=u[e],_<x*b)break;_-=o[e]*c[e],x-=o[e]*n[e][r]}_>d&&x>d&&(b=_/x),b<m&&(g=r,m=b)}if(null===g){for(let t=0;t<i;t++){const e=p[t];if(1!==l[e]&&(l[e]=1,f+=1,f>=r))break}break}l[g]=1,f+=1,h[t]=g,u[t]=m;for(let t=0;t<s;t++){const e=m*n[t][g];c[t]=Math.max(0,c[t]-e)}}return{allocation:l,explanation:{winnersByRound:h,winnerMaxCostPerScoreByRound:u,electionMethodOptions:e}}}};var Dt=Nt;function Lt(t){const e=this;e.seats=1,e.run=(t,n,o)=>{const r=t.map((t=>t.colorRGBA));if("allocation"===e.checkElectionType()||"multiWinner"===e.checkElectionType()){const i={seats:e.seats,threshold:.1},s=(0,Dt[e.electionMethod])({votes:n,parties:o,electionMethodOptions:i}),{allocation:a,explanation:c}=s;return{allocation:a,explanation:c,canList:t,votes:n,colorRGBAOfCandidates:r}}const i=(0,Dt[e.electionMethod])({votes:n,parties:o}),{iWinner:s}=i;return{iWinner:s,winner:t[s],votes:n,colorRGBAOfCandidates:r}},e.electionMethodList=[{name:"Huntington Hill",value:"huntingtonHill",type:"allocation",casterName:"plurality"},{name:"Plurality",value:"plurality",type:"singleWinner",casterName:"plurality"},{name:"Random Winner",value:"randomWinner",type:"singleWinner",casterName:"plurality"},{name:"Score",value:"score",type:"singleWinner",casterName:"score"},{name:"STV",value:"stv",type:"multiWinner",casterName:"ranking"},{name:"Minimax",value:"minimax",type:"singleWinner",casterName:"pairwise"},{name:"OLPR A",value:"olprA",type:"multiWinner",casterName:"olprA"},{name:"Sainte-Lague",value:"sainteLague",type:"allocation",casterName:"plurality"},{name:"d'Hondt",value:"dHondt",type:"allocation",casterName:"plurality"},{name:"AllocScore",value:"allocatedScore",type:"multiWinner",casterName:"scoreLong"},{name:"MES",value:"methodOfEqualShares",type:"multiWinner",casterName:"scoreLong"}],e.checkElectionType=()=>e.electionMethodListByFunctionName[e.electionMethod].type,e.electionMethodListByFunctionName=[],e.electionMethodList.forEach((t=>{e.electionMethodListByFunctionName[t.value]=t})),e.setElectionMethod=t=>{e.electionMethod=t,e.casterName=e.electionMethodListByFunctionName[t].casterName;const n=e.checkElectionType();"allocation"===n?(e.seats=5,e.numSampleCandidates=10):"multiWinner"===n?(e.seats=3,e.numSampleCandidates=10):(e.seats=1,e.numSampleCandidates=5)},e.setElectionMethod("plurality"),t.addMenuItem(e,{label:"Election Method:",prop:"electionMethod",setProp:e.setElectionMethod,options:e.electionMethodList,change:["electionMethod"]})}function Vt(t){const e=this;e.socialChoice=new Lt(t),e.dimensions=1,e.setDimensions=t=>{e.dimensions=t};const n=t=>1===e.dimensions?t.map((t=>t.shape1)):t.map((t=>t.shape2)),o=t=>1===e.dimensions?t.map((t=>t.shape1)):t.map((t=>t.shape2)),r=t=>t.map((t=>t.party[0]));e.getParties=t=>({partiesByCan:r(t),numParties:10}),e.runElection=function(t,n,o){const r=e.getParties(n),i=e.castVotes(t,n,r,o),s=e.socialChoice.run(n,i,r);return T({votes:i}),s},e.castVotes=(t,r,i,s)=>{const a=n(t),c=o(r),{cast:l}=kt[e.socialChoice.casterName];return l({canGeoms:c,voterGeoms:a,dimensions:e.dimensions,optionCast:s,parties:i})},e.testVoteE=(t,i,s)=>{const a=[t],c=i.getCandidates(),l=n(a)[0],h=o(c),u=r(c),{castTestVote:d}=kt[e.socialChoice.casterName];return d({canGeoms:h,voterGeom:l,dimensions:e.dimensions,optionCast:s,partiesByCan:u})}}function It(t,e,n,o,r,i,s,a){const c=this;let l;c.pub=new M,c.enter=()=>{l=a.geo?i:r,c.pub.enter()},c.exit=()=>{c.pub.exit()},c.update=()=>{if(n.checkNone())return{};a.geo&&s.update();const e=l.runElectionSim(t.voterShapeList,t.candidateList,n);return c.pub.update(e),e},c.render=()=>{c.pub.render()},c.renderForeground=()=>{c.pub.renderForeground()}}function Rt(t,e,n){const o=this;let r=[];o.update=function(t,e,n,r,i){r.checkAny()&&o.startSim();return o.addSim(t,e,n,i)},o.startSim=function(){r=[]},o.addSim=function(o,i,s,a){if(0===o.getVoterShapes().length)return{pointsChanged:!1};if(0===i.getCandidateDistributions().length)return{pointsChanged:!1};if(r.length>5e3)return{pointsChanged:!1};const{seats:c}=t.socialChoice,{nd:l}=n,h=Array(1*c*l);let u=0;for(let n=0;n<1;n++){const n=t.socialChoice.numSampleCandidates,i=[];for(let t=0;t<n;t++){const t=s.samplePoint();i.push(t)}const c=e.runElectionGeo(o,i),{resultsByDistrict:l}=c,d=l.length,f=10;if("singleWinner"===t.socialChoice.checkElectionType()){let t=0;for(let e=0;e<d;e++){const{winner:n}=l[e];let o;o=0===t?1===a?n.shape1:n.shape2:1===a?{x:n.shape1.x+(Math.random()-.5)*f}:{x:n.shape2.x+(Math.random()-.5)*f,y:n.shape2.y+(Math.random()-.5)*f},r.push(o),h[u]=o,u+=1,t+=1}}else{let t=0;for(let e=0;e<d;e++){const{allocation:n}=l[e];for(let e=0;e<i.length;e++){const o=i[e],s=n[e];for(let e=0;e<s;e++){let e;e=0===t?1===a?o.shape1:o.shape2:1===a?{x:o.shape1.x+(Math.random()-.5)*f}:{x:o.shape2.x+(Math.random()-.5)*f,y:o.shape2.y+(Math.random()-.5)*f},r.push(e),h[u]=e,u+=1,t+=1}}}}}return{pointsChanged:!0,newPoints:h,points:r}}}const Ot=.5*(Math.sqrt(3)-1),Gt=(3-Math.sqrt(3))/6,Bt=1/6,qt=(Math.sqrt(5)-1)/4,jt=(5-Math.sqrt(5))/20,Wt=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),$t=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);class Ut{constructor(t=Math.random){const e="function"==typeof t?t:function(t){let e=0,n=0,o=0,r=1;const i=function(){let t=4022871197;return function(e){e=e.toString();for(let n=0;n<e.length;n++){t+=e.charCodeAt(n);let o=.02519603282416938*t;t=o>>>0,o-=t,o*=t,t=o>>>0,o-=t,t+=4294967296*o}return 2.3283064365386963e-10*(t>>>0)}}();e=i(" "),n=i(" "),o=i(" "),e-=i(t),e<0&&(e+=1);n-=i(t),n<0&&(n+=1);o-=i(t),o<0&&(o+=1);return function(){const t=2091639*e+2.3283064365386963e-10*r;return e=n,n=o,o=t-(r=0|t)}}(t);this.p=function(t){const e=new Uint8Array(256);for(let t=0;t<256;t++)e[t]=t;for(let n=0;n<255;n++){const o=n+~~(t()*(256-n)),r=e[n];e[n]=e[o],e[o]=r}return e}(e),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let t=0;t<512;t++)this.perm[t]=this.p[255&t],this.permMod12[t]=this.perm[t]%12}noise2D(t,e){const n=this.permMod12,o=this.perm;let r=0,i=0,s=0;const a=(t+e)*Ot,c=Math.floor(t+a),l=Math.floor(e+a),h=(c+l)*Gt,u=t-(c-h),d=e-(l-h);let f,p;u>d?(f=1,p=0):(f=0,p=1);const g=u-f+Gt,m=d-p+Gt,y=u-1+2*Gt,w=d-1+2*Gt,v=255&c,_=255&l;let x=.5-u*u-d*d;if(x>=0){const t=3*n[v+o[_]];x*=x,r=x*x*(Wt[t]*u+Wt[t+1]*d)}let b=.5-g*g-m*m;if(b>=0){const t=3*n[v+f+o[_+p]];b*=b,i=b*b*(Wt[t]*g+Wt[t+1]*m)}let S=.5-y*y-w*w;if(S>=0){const t=3*n[v+1+o[_+1]];S*=S,s=S*S*(Wt[t]*y+Wt[t+1]*w)}return 70*(r+i+s)}noise3D(t,e,n){const o=this.permMod12,r=this.perm;let i,s,a,c;const l=.3333333333333333*(t+e+n),h=Math.floor(t+l),u=Math.floor(e+l),d=Math.floor(n+l),f=(h+u+d)*Bt,p=t-(h-f),g=e-(u-f),m=n-(d-f);let y,w,v,_,x,b;p>=g?g>=m?(y=1,w=0,v=0,_=1,x=1,b=0):p>=m?(y=1,w=0,v=0,_=1,x=0,b=1):(y=0,w=0,v=1,_=1,x=0,b=1):g<m?(y=0,w=0,v=1,_=0,x=1,b=1):p<m?(y=0,w=1,v=0,_=0,x=1,b=1):(y=0,w=1,v=0,_=1,x=1,b=0);const S=p-y+Bt,C=g-w+Bt,M=m-v+Bt,A=p-_+.3333333333333333,E=g-x+.3333333333333333,k=m-b+.3333333333333333,P=p-1+.5,T=g-1+.5,F=m-1+.5,N=255&h,D=255&u,L=255&d;let V=.6-p*p-g*g-m*m;if(V<0)i=0;else{const t=3*o[N+r[D+r[L]]];V*=V,i=V*V*(Wt[t]*p+Wt[t+1]*g+Wt[t+2]*m)}let I=.6-S*S-C*C-M*M;if(I<0)s=0;else{const t=3*o[N+y+r[D+w+r[L+v]]];I*=I,s=I*I*(Wt[t]*S+Wt[t+1]*C+Wt[t+2]*M)}let R=.6-A*A-E*E-k*k;if(R<0)a=0;else{const t=3*o[N+_+r[D+x+r[L+b]]];R*=R,a=R*R*(Wt[t]*A+Wt[t+1]*E+Wt[t+2]*k)}let O=.6-P*P-T*T-F*F;if(O<0)c=0;else{const t=3*o[N+1+r[D+1+r[L+1]]];O*=O,c=O*O*(Wt[t]*P+Wt[t+1]*T+Wt[t+2]*F)}return 32*(i+s+a+c)}noise4D(t,e,n,o){const r=this.perm;let i,s,a,c,l;const h=(t+e+n+o)*qt,u=Math.floor(t+h),d=Math.floor(e+h),f=Math.floor(n+h),p=Math.floor(o+h),g=(u+d+f+p)*jt,m=t-(u-g),y=e-(d-g),w=n-(f-g),v=o-(p-g);let _=0,x=0,b=0,S=0;m>y?_++:x++,m>w?_++:b++,m>v?_++:S++,y>w?x++:b++,y>v?x++:S++,w>v?b++:S++;const C=_>=3?1:0,M=x>=3?1:0,A=b>=3?1:0,E=S>=3?1:0,k=_>=2?1:0,P=x>=2?1:0,T=b>=2?1:0,F=S>=2?1:0,N=_>=1?1:0,D=x>=1?1:0,L=b>=1?1:0,V=S>=1?1:0,I=m-C+jt,R=y-M+jt,O=w-A+jt,G=v-E+jt,B=m-k+2*jt,q=y-P+2*jt,j=w-T+2*jt,W=v-F+2*jt,$=m-N+3*jt,U=y-D+3*jt,H=w-L+3*jt,z=v-V+3*jt,X=m-1+4*jt,Y=y-1+4*jt,J=w-1+4*jt,K=v-1+4*jt,Z=255&u,Q=255&d,tt=255&f,et=255&p;let nt=.6-m*m-y*y-w*w-v*v;if(nt<0)i=0;else{const t=r[Z+r[Q+r[tt+r[et]]]]%32*4;nt*=nt,i=nt*nt*($t[t]*m+$t[t+1]*y+$t[t+2]*w+$t[t+3]*v)}let ot=.6-I*I-R*R-O*O-G*G;if(ot<0)s=0;else{const t=r[Z+C+r[Q+M+r[tt+A+r[et+E]]]]%32*4;ot*=ot,s=ot*ot*($t[t]*I+$t[t+1]*R+$t[t+2]*O+$t[t+3]*G)}let rt=.6-B*B-q*q-j*j-W*W;if(rt<0)a=0;else{const t=r[Z+k+r[Q+P+r[tt+T+r[et+F]]]]%32*4;rt*=rt,a=rt*rt*($t[t]*B+$t[t+1]*q+$t[t+2]*j+$t[t+3]*W)}let it=.6-$*$-U*U-H*H-z*z;if(it<0)c=0;else{const t=r[Z+N+r[Q+D+r[tt+L+r[et+V]]]]%32*4;it*=it,c=it*it*($t[t]*$+$t[t+1]*U+$t[t+2]*H+$t[t+3]*z)}let st=.6-X*X-Y*Y-J*J-K*K;if(st<0)l=0;else{const t=r[Z+1+r[Q+1+r[tt+1+r[et+1]]]]%32*4;st*=st,l=st*st*($t[t]*X+$t[t+1]*Y+$t[t+2]*J+$t[t+3]*K)}return 27*(i+s+a+c+l)}}function Ht(t,e){const n=this;n.sn=[];n.genNoise=()=>{n.sn=function(t,e,n,o,r,i){const s=new Ut("s"),a=new Ut("seed"),c=function(t,e){const n=Array(t).fill().map((()=>Array(e).fill().map((()=>Array(2).fill(0)))));return n}(t,e);let l=0,h=0;zt(t).forEach((r=>{zt(e).forEach((i=>{const u=r/t*(1/n),d=i/e*(1/o),f=s.noise2D(u,d),p=a.noise2D(u,d);c[r][i][0]=f-.5,c[r][i][1]=p-.5,l+=f,h+=p}))}));const u=l/(t*e)-.5,d=h/(t*e)-.5;return c.forEach((t=>{t.forEach((t=>{t[0]=(t[0]-u)*r,t[1]=(t[1]-d)*i}))})),c}(t,e,.5,.5,100,100)}}function zt(t){return[...Array(t).keys()]}const Xt=134217729;function Yt(t,e,n,o,r){let i,s,a,c,l=e[0],h=o[0],u=0,d=0;h>l==h>-l?(i=l,l=e[++u]):(i=h,h=o[++d]);let f=0;if(u<t&&d<n)for(h>l==h>-l?(s=l+i,a=i-(s-l),l=e[++u]):(s=h+i,a=i-(s-h),h=o[++d]),i=s,0!==a&&(r[f++]=a);u<t&&d<n;)h>l==h>-l?(s=i+l,c=s-i,a=i-(s-c)+(l-c),l=e[++u]):(s=i+h,c=s-i,a=i-(s-c)+(h-c),h=o[++d]),i=s,0!==a&&(r[f++]=a);for(;u<t;)s=i+l,c=s-i,a=i-(s-c)+(l-c),l=e[++u],i=s,0!==a&&(r[f++]=a);for(;d<n;)s=i+h,c=s-i,a=i-(s-c)+(h-c),h=o[++d],i=s,0!==a&&(r[f++]=a);return 0===i&&0!==f||(r[f++]=i),f}function Jt(t){return new Float64Array(t)}const Kt=Jt(4),Zt=Jt(8),Qt=Jt(12),te=Jt(16),ee=Jt(4);function ne(t,e,n,o,r,i){const s=(e-i)*(n-r),a=(t-r)*(o-i),c=s-a;if(0===s||0===a||s>0!=a>0)return c;const l=Math.abs(s+a);return Math.abs(c)>=33306690738754716e-32*l?c:-function(t,e,n,o,r,i,s){let a,c,l,h,u,d,f,p,g,m,y,w,v,_,x,b,S,C;const M=t-r,A=n-r,E=e-i,k=o-i;_=M*k,d=Xt*M,f=d-(d-M),p=M-f,d=Xt*k,g=d-(d-k),m=k-g,x=p*m-(_-f*g-p*g-f*m),b=E*A,d=Xt*E,f=d-(d-E),p=E-f,d=Xt*A,g=d-(d-A),m=A-g,S=p*m-(b-f*g-p*g-f*m),y=x-S,u=x-y,Kt[0]=x-(y+u)+(u-S),w=_+y,u=w-_,v=_-(w-u)+(y-u),y=v-b,u=v-y,Kt[1]=v-(y+u)+(u-b),C=w+y,u=C-w,Kt[2]=w-(C-u)+(y-u),Kt[3]=C;let P=function(t,e){let n=e[0];for(let o=1;o<t;o++)n+=e[o];return n}(4,Kt),T=22204460492503146e-32*s;if(P>=T||-P>=T)return P;if(u=t-M,a=t-(M+u)+(u-r),u=n-A,l=n-(A+u)+(u-r),u=e-E,c=e-(E+u)+(u-i),u=o-k,h=o-(k+u)+(u-i),0===a&&0===c&&0===l&&0===h)return P;if(T=11093356479670487e-47*s+33306690738754706e-32*Math.abs(P),P+=M*h+k*a-(E*l+A*c),P>=T||-P>=T)return P;_=a*k,d=Xt*a,f=d-(d-a),p=a-f,d=Xt*k,g=d-(d-k),m=k-g,x=p*m-(_-f*g-p*g-f*m),b=c*A,d=Xt*c,f=d-(d-c),p=c-f,d=Xt*A,g=d-(d-A),m=A-g,S=p*m-(b-f*g-p*g-f*m),y=x-S,u=x-y,ee[0]=x-(y+u)+(u-S),w=_+y,u=w-_,v=_-(w-u)+(y-u),y=v-b,u=v-y,ee[1]=v-(y+u)+(u-b),C=w+y,u=C-w,ee[2]=w-(C-u)+(y-u),ee[3]=C;const F=Yt(4,Kt,4,ee,Zt);_=M*h,d=Xt*M,f=d-(d-M),p=M-f,d=Xt*h,g=d-(d-h),m=h-g,x=p*m-(_-f*g-p*g-f*m),b=E*l,d=Xt*E,f=d-(d-E),p=E-f,d=Xt*l,g=d-(d-l),m=l-g,S=p*m-(b-f*g-p*g-f*m),y=x-S,u=x-y,ee[0]=x-(y+u)+(u-S),w=_+y,u=w-_,v=_-(w-u)+(y-u),y=v-b,u=v-y,ee[1]=v-(y+u)+(u-b),C=w+y,u=C-w,ee[2]=w-(C-u)+(y-u),ee[3]=C;const N=Yt(F,Zt,4,ee,Qt);_=a*h,d=Xt*a,f=d-(d-a),p=a-f,d=Xt*h,g=d-(d-h),m=h-g,x=p*m-(_-f*g-p*g-f*m),b=c*l,d=Xt*c,f=d-(d-c),p=c-f,d=Xt*l,g=d-(d-l),m=l-g,S=p*m-(b-f*g-p*g-f*m),y=x-S,u=x-y,ee[0]=x-(y+u)+(u-S),w=_+y,u=w-_,v=_-(w-u)+(y-u),y=v-b,u=v-y,ee[1]=v-(y+u)+(u-b),C=w+y,u=C-w,ee[2]=w-(C-u)+(y-u),ee[3]=C;const D=Yt(N,Qt,4,ee,te);return te[D-1]}(t,e,n,o,r,i,l)}const oe=Math.pow(2,-52),re=new Uint32Array(512);class ie{static from(t,e=ue,n=de){const o=t.length,r=new Float64Array(2*o);for(let i=0;i<o;i++){const o=t[i];r[2*i]=e(o),r[2*i+1]=n(o)}return new ie(r)}constructor(t){const e=t.length>>1;if(e>0&&"number"!=typeof t[0])throw new Error("Expected coords to contain numbers.");this.coords=t;const n=Math.max(2*e-5,0);this._triangles=new Uint32Array(3*n),this._halfedges=new Int32Array(3*n),this._hashSize=Math.ceil(Math.sqrt(e)),this._hullPrev=new Uint32Array(e),this._hullNext=new Uint32Array(e),this._hullTri=new Uint32Array(e),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(e),this._dists=new Float64Array(e),this.update()}update(){const{coords:t,_hullPrev:e,_hullNext:n,_hullTri:o,_hullHash:r}=this,i=t.length>>1;let s=1/0,a=1/0,c=-1/0,l=-1/0;for(let e=0;e<i;e++){const n=t[2*e],o=t[2*e+1];n<s&&(s=n),o<a&&(a=o),n>c&&(c=n),o>l&&(l=o),this._ids[e]=e}const h=(s+c)/2,u=(a+l)/2;let d,f,p,g=1/0;for(let e=0;e<i;e++){const n=se(h,u,t[2*e],t[2*e+1]);n<g&&(d=e,g=n)}const m=t[2*d],y=t[2*d+1];g=1/0;for(let e=0;e<i;e++){if(e===d)continue;const n=se(m,y,t[2*e],t[2*e+1]);n<g&&n>0&&(f=e,g=n)}let w=t[2*f],v=t[2*f+1],_=1/0;for(let e=0;e<i;e++){if(e===d||e===f)continue;const n=ce(m,y,w,v,t[2*e],t[2*e+1]);n<_&&(p=e,_=n)}let x=t[2*p],b=t[2*p+1];if(_===1/0){for(let e=0;e<i;e++)this._dists[e]=t[2*e]-t[0]||t[2*e+1]-t[1];le(this._ids,this._dists,0,i-1);const e=new Uint32Array(i);let n=0;for(let t=0,o=-1/0;t<i;t++){const r=this._ids[t];this._dists[r]>o&&(e[n++]=r,o=this._dists[r])}return this.hull=e.subarray(0,n),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(ne(m,y,w,v,x,b)<0){const t=f,e=w,n=v;f=p,w=x,v=b,p=t,x=e,b=n}const S=function(t,e,n,o,r,i){const s=n-t,a=o-e,c=r-t,l=i-e,h=s*s+a*a,u=c*c+l*l,d=.5/(s*l-a*c);return{x:t+(l*h-a*u)*d,y:e+(s*u-c*h)*d}}(m,y,w,v,x,b);this._cx=S.x,this._cy=S.y;for(let e=0;e<i;e++)this._dists[e]=se(t[2*e],t[2*e+1],S.x,S.y);le(this._ids,this._dists,0,i-1),this._hullStart=d;let C=3;n[d]=e[p]=f,n[f]=e[d]=p,n[p]=e[f]=d,o[d]=0,o[f]=1,o[p]=2,r.fill(-1),r[this._hashKey(m,y)]=d,r[this._hashKey(w,v)]=f,r[this._hashKey(x,b)]=p,this.trianglesLen=0,this._addTriangle(d,f,p,-1,-1,-1);for(let i,s,a=0;a<this._ids.length;a++){const c=this._ids[a],l=t[2*c],h=t[2*c+1];if(a>0&&Math.abs(l-i)<=oe&&Math.abs(h-s)<=oe)continue;if(i=l,s=h,c===d||c===f||c===p)continue;let u=0;for(let t=0,e=this._hashKey(l,h);t<this._hashSize&&(u=r[(e+t)%this._hashSize],-1===u||u===n[u]);t++);u=e[u];let g,m=u;for(;g=n[m],ne(l,h,t[2*m],t[2*m+1],t[2*g],t[2*g+1])>=0;)if(m=g,m===u){m=-1;break}if(-1===m)continue;let y=this._addTriangle(m,c,n[m],-1,-1,o[m]);o[c]=this._legalize(y+2),o[m]=y,C++;let w=n[m];for(;g=n[w],ne(l,h,t[2*w],t[2*w+1],t[2*g],t[2*g+1])<0;)y=this._addTriangle(w,c,g,o[c],-1,o[w]),o[c]=this._legalize(y+2),n[w]=w,C--,w=g;if(m===u)for(;g=e[m],ne(l,h,t[2*g],t[2*g+1],t[2*m],t[2*m+1])<0;)y=this._addTriangle(g,c,m,-1,o[m],o[g]),this._legalize(y+2),o[g]=y,n[m]=m,C--,m=g;this._hullStart=e[c]=m,n[m]=e[w]=c,n[c]=w,r[this._hashKey(l,h)]=c,r[this._hashKey(t[2*m],t[2*m+1])]=m}this.hull=new Uint32Array(C);for(let t=0,e=this._hullStart;t<C;t++)this.hull[t]=e,e=n[e];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,e){return Math.floor(function(t,e){const n=t/(Math.abs(t)+Math.abs(e));return(e>0?3-n:1+n)/4}(t-this._cx,e-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:e,_halfedges:n,coords:o}=this;let r=0,i=0;for(;;){const s=n[t],a=t-t%3;if(i=a+(t+2)%3,-1===s){if(0===r)break;t=re[--r];continue}const c=s-s%3,l=a+(t+1)%3,h=c+(s+2)%3,u=e[i],d=e[t],f=e[l],p=e[h];if(ae(o[2*u],o[2*u+1],o[2*d],o[2*d+1],o[2*f],o[2*f+1],o[2*p],o[2*p+1])){e[t]=p,e[s]=u;const o=n[h];if(-1===o){let e=this._hullStart;do{if(this._hullTri[e]===h){this._hullTri[e]=t;break}e=this._hullPrev[e]}while(e!==this._hullStart)}this._link(t,o),this._link(s,n[i]),this._link(i,h);const a=c+(s+1)%3;r<re.length&&(re[r++]=a)}else{if(0===r)break;t=re[--r]}}return i}_link(t,e){this._halfedges[t]=e,-1!==e&&(this._halfedges[e]=t)}_addTriangle(t,e,n,o,r,i){const s=this.trianglesLen;return this._triangles[s]=t,this._triangles[s+1]=e,this._triangles[s+2]=n,this._link(s,o),this._link(s+1,r),this._link(s+2,i),this.trianglesLen+=3,s}}function se(t,e,n,o){const r=t-n,i=e-o;return r*r+i*i}function ae(t,e,n,o,r,i,s,a){const c=t-s,l=e-a,h=n-s,u=o-a,d=r-s,f=i-a,p=h*h+u*u,g=d*d+f*f;return c*(u*g-p*f)-l*(h*g-p*d)+(c*c+l*l)*(h*f-u*d)<0}function ce(t,e,n,o,r,i){const s=n-t,a=o-e,c=r-t,l=i-e,h=s*s+a*a,u=c*c+l*l,d=.5/(s*l-a*c),f=(l*h-a*u)*d,p=(s*u-c*h)*d;return f*f+p*p}function le(t,e,n,o){if(o-n<=20)for(let r=n+1;r<=o;r++){const o=t[r],i=e[o];let s=r-1;for(;s>=n&&e[t[s]]>i;)t[s+1]=t[s--];t[s+1]=o}else{let r=n+1,i=o;he(t,n+o>>1,r),e[t[n]]>e[t[o]]&&he(t,n,o),e[t[r]]>e[t[o]]&&he(t,r,o),e[t[n]]>e[t[r]]&&he(t,n,r);const s=t[r],a=e[s];for(;;){do{r++}while(e[t[r]]<a);do{i--}while(e[t[i]]>a);if(i<r)break;he(t,r,i)}t[n+1]=t[i],t[i]=s,o-r+1>=i-n?(le(t,e,r,o),le(t,e,n,i-1)):(le(t,e,n,i-1),le(t,e,r,o))}}function he(t,e,n){const o=t[e];t[e]=t[n],t[n]=o}function ue(t){return t[0]}function de(t){return t[1]}const fe=1e-6;class pe{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,e){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,e){this._+=`L${this._x1=+t},${this._y1=+e}`}arc(t,e,n){const o=(t=+t)+(n=+n),r=e=+e;if(n<0)throw new Error("negative radius");null===this._x1?this._+=`M${o},${r}`:(Math.abs(this._x1-o)>fe||Math.abs(this._y1-r)>fe)&&(this._+="L"+o+","+r),n&&(this._+=`A${n},${n},0,1,1,${t-n},${e}A${n},${n},0,1,1,${this._x1=o},${this._y1=r}`)}rect(t,e,n,o){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}h${+n}v${+o}h${-n}Z`}value(){return this._||null}}class ge{constructor(){this._=[]}moveTo(t,e){this._.push([t,e])}closePath(){this._.push(this._[0].slice())}lineTo(t,e){this._.push([t,e])}value(){return this._.length?this._:null}}class me{constructor(t,[e,n,o,r]=[0,0,960,500]){if(!((o=+o)>=(e=+e)&&(r=+r)>=(n=+n)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(2*t.points.length),this.vectors=new Float64Array(2*t.points.length),this.xmax=o,this.xmin=e,this.ymax=r,this.ymin=n,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:e,triangles:n},vectors:o}=this,r=this.circumcenters=this._circumcenters.subarray(0,n.length/3*2);for(let e,o,i=0,s=0,a=n.length;i<a;i+=3,s+=2){const a=2*n[i],c=2*n[i+1],l=2*n[i+2],h=t[a],u=t[a+1],d=t[c],f=t[c+1],p=t[l],g=t[l+1],m=d-h,y=f-u,w=p-h,v=g-u,_=2*(m*v-y*w);if(Math.abs(_)<1e-9){let r=1e9;const i=2*n[0];r*=Math.sign((t[i]-h)*v-(t[i+1]-u)*w),e=(h+p)/2-r*v,o=(u+g)/2+r*w}else{const t=1/_,n=m*m+y*y,r=w*w+v*v;e=h+(v*n-y*r)*t,o=u+(m*r-w*n)*t}r[s]=e,r[s+1]=o}let i,s,a,c=e[e.length-1],l=4*c,h=t[2*c],u=t[2*c+1];o.fill(0);for(let n=0;n<e.length;++n)c=e[n],i=l,s=h,a=u,l=4*c,h=t[2*c],u=t[2*c+1],o[i+2]=o[l]=a-u,o[i+3]=o[l+1]=h-s}render(t){const e=null==t?t=new pe:void 0,{delaunay:{halfedges:n,inedges:o,hull:r},circumcenters:i,vectors:s}=this;if(r.length<=1)return null;for(let e=0,o=n.length;e<o;++e){const o=n[e];if(o<e)continue;const r=2*Math.floor(e/3),s=2*Math.floor(o/3),a=i[r],c=i[r+1],l=i[s],h=i[s+1];this._renderSegment(a,c,l,h,t)}let a,c=r[r.length-1];for(let e=0;e<r.length;++e){a=c,c=r[e];const n=2*Math.floor(o[c]/3),l=i[n],h=i[n+1],u=4*a,d=this._project(l,h,s[u+2],s[u+3]);d&&this._renderSegment(l,h,d[0],d[1],t)}return e&&e.value()}renderBounds(t){const e=null==t?t=new pe:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),e&&e.value()}renderCell(t,e){const n=null==e?e=new pe:void 0,o=this._clip(t);if(null===o||!o.length)return;e.moveTo(o[0],o[1]);let r=o.length;for(;o[0]===o[r-2]&&o[1]===o[r-1]&&r>1;)r-=2;for(let t=2;t<r;t+=2)o[t]===o[t-2]&&o[t+1]===o[t-1]||e.lineTo(o[t],o[t+1]);return e.closePath(),n&&n.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let e=0,n=t.length/2;e<n;++e){const t=this.cellPolygon(e);t&&(t.index=e,yield t)}}cellPolygon(t){const e=new ge;return this.renderCell(t,e),e.value()}_renderSegment(t,e,n,o,r){let i;const s=this._regioncode(t,e),a=this._regioncode(n,o);0===s&&0===a?(r.moveTo(t,e),r.lineTo(n,o)):(i=this._clipSegment(t,e,n,o,s,a))&&(r.moveTo(i[0],i[1]),r.lineTo(i[2],i[3]))}contains(t,e,n){return(e=+e)==e&&(n=+n)==n&&this.delaunay._step(t,e,n)===t}*neighbors(t){const e=this._clip(t);if(e)for(const n of this.delaunay.neighbors(t)){const t=this._clip(n);if(t)t:for(let o=0,r=e.length;o<r;o+=2)for(let i=0,s=t.length;i<s;i+=2)if(e[o]==t[i]&&e[o+1]==t[i+1]&&e[(o+2)%r]==t[(i+s-2)%s]&&e[(o+3)%r]==t[(i+s-1)%s]){yield n;break t}}}_cell(t){const{circumcenters:e,delaunay:{inedges:n,halfedges:o,triangles:r}}=this,i=n[t];if(-1===i)return null;const s=[];let a=i;do{const n=Math.floor(a/3);if(s.push(e[2*n],e[2*n+1]),a=a%3==2?a-2:a+1,r[a]!==t)break;a=o[a]}while(a!==i&&-1!==a);return s}_clip(t){if(0===t&&1===this.delaunay.hull.length)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const e=this._cell(t);if(null===e)return null;const{vectors:n}=this,o=4*t;return n[o]||n[o+1]?this._clipInfinite(t,e,n[o],n[o+1],n[o+2],n[o+3]):this._clipFinite(t,e)}_clipFinite(t,e){const n=e.length;let o,r,i,s,a=null,c=e[n-2],l=e[n-1],h=this._regioncode(c,l),u=0;for(let d=0;d<n;d+=2)if(o=c,r=l,c=e[d],l=e[d+1],i=h,h=this._regioncode(c,l),0===i&&0===h)s=u,u=0,a?a.push(c,l):a=[c,l];else{let e,n,d,f,p;if(0===i){if(null===(e=this._clipSegment(o,r,c,l,i,h)))continue;[n,d,f,p]=e}else{if(null===(e=this._clipSegment(c,l,o,r,h,i)))continue;[f,p,n,d]=e,s=u,u=this._edgecode(n,d),s&&u&&this._edge(t,s,u,a,a.length),a?a.push(n,d):a=[n,d]}s=u,u=this._edgecode(f,p),s&&u&&this._edge(t,s,u,a,a.length),a?a.push(f,p):a=[f,p]}if(a)s=u,u=this._edgecode(a[0],a[1]),s&&u&&this._edge(t,s,u,a,a.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return a}_clipSegment(t,e,n,o,r,i){for(;;){if(0===r&&0===i)return[t,e,n,o];if(r&i)return null;let s,a,c=r||i;8&c?(s=t+(n-t)*(this.ymax-e)/(o-e),a=this.ymax):4&c?(s=t+(n-t)*(this.ymin-e)/(o-e),a=this.ymin):2&c?(a=e+(o-e)*(this.xmax-t)/(n-t),s=this.xmax):(a=e+(o-e)*(this.xmin-t)/(n-t),s=this.xmin),r?(t=s,e=a,r=this._regioncode(t,e)):(n=s,o=a,i=this._regioncode(n,o))}}_clipInfinite(t,e,n,o,r,i){let s,a=Array.from(e);if((s=this._project(a[0],a[1],n,o))&&a.unshift(s[0],s[1]),(s=this._project(a[a.length-2],a[a.length-1],r,i))&&a.push(s[0],s[1]),a=this._clipFinite(t,a))for(let e,n=0,o=a.length,r=this._edgecode(a[o-2],a[o-1]);n<o;n+=2)e=r,r=this._edgecode(a[n],a[n+1]),e&&r&&(n=this._edge(t,e,r,a,n),o=a.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(a=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return a}_edge(t,e,n,o,r){for(;e!==n;){let n,i;switch(e){case 5:e=4;continue;case 4:e=6,n=this.xmax,i=this.ymin;break;case 6:e=2;continue;case 2:e=10,n=this.xmax,i=this.ymax;break;case 10:e=8;continue;case 8:e=9,n=this.xmin,i=this.ymax;break;case 9:e=1;continue;case 1:e=5,n=this.xmin,i=this.ymin}o[r]===n&&o[r+1]===i||!this.contains(t,n,i)||(o.splice(r,0,n,i),r+=2)}if(o.length>4)for(let t=0;t<o.length;t+=2){const e=(t+2)%o.length,n=(t+4)%o.length;(o[t]===o[e]&&o[e]===o[n]||o[t+1]===o[e+1]&&o[e+1]===o[n+1])&&(o.splice(e,2),t-=2)}return r}_project(t,e,n,o){let r,i,s,a=1/0;if(o<0){if(e<=this.ymin)return null;(r=(this.ymin-e)/o)<a&&(s=this.ymin,i=t+(a=r)*n)}else if(o>0){if(e>=this.ymax)return null;(r=(this.ymax-e)/o)<a&&(s=this.ymax,i=t+(a=r)*n)}if(n>0){if(t>=this.xmax)return null;(r=(this.xmax-t)/n)<a&&(i=this.xmax,s=e+(a=r)*o)}else if(n<0){if(t<=this.xmin)return null;(r=(this.xmin-t)/n)<a&&(i=this.xmin,s=e+(a=r)*o)}return[i,s]}_edgecode(t,e){return(t===this.xmin?1:t===this.xmax?2:0)|(e===this.ymin?4:e===this.ymax?8:0)}_regioncode(t,e){return(t<this.xmin?1:t>this.xmax?2:0)|(e<this.ymin?4:e>this.ymax?8:0)}}const ye=2*Math.PI,we=Math.pow;function ve(t){return t[0]}function _e(t){return t[1]}function xe(t,e,n){return[t+Math.sin(t+e)*n,e+Math.cos(t-e)*n]}class be{static from(t,e=ve,n=_e,o){return new be("length"in t?function(t,e,n,o){const r=t.length,i=new Float64Array(2*r);for(let s=0;s<r;++s){const r=t[s];i[2*s]=e.call(o,r,s,t),i[2*s+1]=n.call(o,r,s,t)}return i}(t,e,n,o):Float64Array.from(function*(t,e,n,o){let r=0;for(const i of t)yield e.call(o,i,r,t),yield n.call(o,i,r,t),++r}(t,e,n,o)))}constructor(t){this._delaunator=new ie(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,e=this.points;if(t.hull&&t.hull.length>2&&function(t){const{triangles:e,coords:n}=t;for(let t=0;t<e.length;t+=3){const o=2*e[t],r=2*e[t+1],i=2*e[t+2];if((n[i]-n[o])*(n[r+1]-n[o+1])-(n[r]-n[o])*(n[i+1]-n[o+1])>1e-10)return!1}return!0}(t)){this.collinear=Int32Array.from({length:e.length/2},((t,e)=>e)).sort(((t,n)=>e[2*t]-e[2*n]||e[2*t+1]-e[2*n+1]));const t=this.collinear[0],n=this.collinear[this.collinear.length-1],o=[e[2*t],e[2*t+1],e[2*n],e[2*n+1]],r=1e-8*Math.hypot(o[3]-o[1],o[2]-o[0]);for(let t=0,n=e.length/2;t<n;++t){const n=xe(e[2*t],e[2*t+1],r);e[2*t]=n[0],e[2*t+1]=n[1]}this._delaunator=new ie(e)}else delete this.collinear;const n=this.halfedges=this._delaunator.halfedges,o=this.hull=this._delaunator.hull,r=this.triangles=this._delaunator.triangles,i=this.inedges.fill(-1),s=this._hullIndex.fill(-1);for(let t=0,e=n.length;t<e;++t){const e=r[t%3==2?t-2:t+1];-1!==n[t]&&-1!==i[e]||(i[e]=t)}for(let t=0,e=o.length;t<e;++t)s[o[t]]=t;o.length<=2&&o.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=o[0],i[o[0]]=1,2===o.length&&(i[o[1]]=0,this.triangles[1]=o[1],this.triangles[2]=o[1]))}voronoi(t){return new me(this,t)}*neighbors(t){const{inedges:e,hull:n,_hullIndex:o,halfedges:r,triangles:i,collinear:s}=this;if(s){const e=s.indexOf(t);return e>0&&(yield s[e-1]),void(e<s.length-1&&(yield s[e+1]))}const a=e[t];if(-1===a)return;let c=a,l=-1;do{if(yield l=i[c],c=c%3==2?c-2:c+1,i[c]!==t)return;if(c=r[c],-1===c){const e=n[(o[t]+1)%n.length];return void(e!==l&&(yield e))}}while(c!==a)}find(t,e,n=0){if((t=+t)!=t||(e=+e)!=e)return-1;const o=n;let r;for(;(r=this._step(n,t,e))>=0&&r!==n&&r!==o;)n=r;return r}_step(t,e,n){const{inedges:o,hull:r,_hullIndex:i,halfedges:s,triangles:a,points:c}=this;if(-1===o[t]||!c.length)return(t+1)%(c.length>>1);let l=t,h=we(e-c[2*t],2)+we(n-c[2*t+1],2);const u=o[t];let d=u;do{let o=a[d];const u=we(e-c[2*o],2)+we(n-c[2*o+1],2);if(u<h&&(h=u,l=o),d=d%3==2?d-2:d+1,a[d]!==t)break;if(d=s[d],-1===d){if(d=r[(i[t]+1)%r.length],d!==o&&we(e-c[2*d],2)+we(n-c[2*d+1],2)<h)return d;break}}while(d!==u);return l}render(t){const e=null==t?t=new pe:void 0,{points:n,halfedges:o,triangles:r}=this;for(let e=0,i=o.length;e<i;++e){const i=o[e];if(i<e)continue;const s=2*r[e],a=2*r[i];t.moveTo(n[s],n[s+1]),t.lineTo(n[a],n[a+1])}return this.renderHull(t),e&&e.value()}renderPoints(t,e){void 0!==e||t&&"function"==typeof t.moveTo||(e=t,t=null),e=null==e?2:+e;const n=null==t?t=new pe:void 0,{points:o}=this;for(let n=0,r=o.length;n<r;n+=2){const r=o[n],i=o[n+1];t.moveTo(r+e,i),t.arc(r,i,e,0,ye)}return n&&n.value()}renderHull(t){const e=null==t?t=new pe:void 0,{hull:n,points:o}=this,r=2*n[0],i=n.length;t.moveTo(o[r],o[r+1]);for(let e=1;e<i;++e){const r=2*n[e];t.lineTo(o[r],o[r+1])}return t.closePath(),e&&e.value()}hullPolygon(){const t=new ge;return this.renderHull(t),t.value()}renderTriangle(t,e){const n=null==e?e=new pe:void 0,{points:o,triangles:r}=this,i=2*r[t*=3],s=2*r[t+1],a=2*r[t+2];return e.moveTo(o[i],o[i+1]),e.lineTo(o[s],o[s+1]),e.lineTo(o[a],o[a+1]),e.closePath(),n&&n.value()}*trianglePolygons(){const{triangles:t}=this;for(let e=0,n=t.length/3;e<n;++e)yield this.trianglePolygon(e)}trianglePolygon(t){const e=new ge;return this.renderTriangle(t,e),e.value()}}function Se(t,e,n,o){let r,i,s=function(t,e,n){return Array(n).fill().map((()=>[Math.random()*t,Math.random()*e]))}(t,e,n),a=!1;const c=o*Math.min(t,e);for(let n=0;n<1e3;n++)if([s,a,r,i]=Ce(s,t,e,c),a)return s;return[s,r,i]}function Ce(t,e,n,o){const r=be.from(t).voronoi([0,0,e,n]),i=(s=t.length,[...Array(s).keys()]).map((t=>r.cellPolygon(t)));var s;const a=i.map(rt),c=t.every(((t,e)=>{return n=t,r=a[e],n**2+r**2<o;var n,r}));return[a,c,r,i]}function Me(t,e){const n=ke(e),o=t.length-ke(t),r=e.slice();for(let e,i,s,a=0,c=t[o-1];a<o;++a){const o=r.slice(),l=o.length-n;r.length=0,e=t[a],i=o[l-1];for(let t=0;t<l;++t)s=o[t],Ae(s,c,e)?(Ae(i,c,e)||r.push(Ee(i,s,c,e)),r.push(s)):Ae(i,c,e)&&r.push(Ee(i,s,c,e)),i=s;n&&r.push(r[0]),c=e}return r.length?r:null}function Ae([t,e],[n,o],[r,i]){return(r-n)*(e-o)<(i-o)*(t-n)}function Ee([t,e],[n,o],[r,i],[s,a]){const c=n-t,l=o-e,h=s-r,u=a-i,d=(c*(i-e)-l*(r-t))/(l*h-c*u);return[r+d*h,i+d*u]}function ke(t){const[e,n]=t[0],[o,r]=t[t.length-1];return e===o&&n===r}function Pe(t){const{nd:e,nx:n,ny:o,polygons:r}=t,i=Array(e).fill().map((()=>[]));for(let t=0;t<n;t++)for(let n=0;n<o;n++){const o=Te(t,n);F(e).forEach((e=>{const s=r[e];var a;const c=Me((a=s,JSON.parse(JSON.stringify(a))).reverse(),o);null!==c&&i[e].push([t,n,ot(c)])}))}return i}function Te(t,e){return[[t,e],[t,e+1],[t+1,e+1],[t+1,e]]}function Fe(){const t=this;t.make=(e,n,o)=>{[t.centroids,t.voronoi,t.polygons]=Se(e,n,o,.01),t.nx=e,t.ny=n,t.nd=o,t.polygonAreas=t.polygons.map(ot).map((t=>-t)),t.totalArea=e*n,t.census=Pe(t)}}function Ne(t,e){const n=this;n.nd=20,n.nx=20,n.ny=20,n.districtMaker=new Fe,n.geoNoise=new Ht(n.nx,n.ny),n.geoNoise.genNoise();let o=[];n.update=()=>{e.checkNone()||(o=t.getVoterShapes(),e.check(["districts","geo","viz","dimensions"])&&n.updateDistricts(),n.updateVoters())},n.updateDistricts=()=>{n.districtMaker.make(n.nx,n.ny,n.nd)},n.updateVoters=()=>{n.updateFullSet(),n.updateVotersByDistrict(),n.updateVotersByTract()},n.updateFullSet=()=>{const{sn:t}=n.geoNoise;n.allVoterGroups=o.map((e=>t.map((t=>t.map((t=>{const[n,o]=t,r=q(e.shape1),i=q(e.shape2);return r.x+=n,i.x+=n,i.y+=o,{shape2:i,shape1:r}})).flat())).flat())).flat()},n.updateVotersByDistrict=()=>{const{census:t}=n.districtMaker,{sn:e}=n.geoNoise;n.voterGroupsByDistrict=F(n.nd).map((n=>o.map((o=>t[n].map((t=>{const[n,r,i]=t,[s,a]=e[n][r],c=q(o.shape1),l=q(o.shape2);return c.x+=s,l.x+=s,l.y+=a,{shape2:l,shape1:c,weight:i}})).flat())).flat()))},n.updateVotersByTract=()=>{const{sn:t}=n.geoNoise;n.voterGroupsByTract=t.map((t=>t.map((t=>o.map((e=>{const[n,o]=t,r=q(e.shape1),i=q(e.shape2);return r.x+=n,i.x+=n,i.y+=o,{shape2:i,shape1:r}})).flat()))))}}function De(t,e,n){const o=this,{voterShapeList:r}=t,i=new Ne(r,n);o.voterGeo=i;const s=new Vt(e),a=new E(s),c=new k(s),l=new j(s,i),h=new Rt(s,l,i);o.election=s;const u={one:new It(t,e,n,s,a,l,i,o),sample:new A(t,e,n,s,c,h,i,o)};o.sims=u;const d=[];o.attach=t=>{d.push(t)};o.state="one",o.viz="one",o.geo=!1,o.election.setDimensions(2),n.add(["geo","dimensions","viz","districts"]),o.update=()=>{n.check(["geo","dimensions","viz","electionMethod"])&&(Object.keys(u).forEach((t=>u[t].exit())),o.state=o.viz,u[o.state].enter());const t=u[o.state].update();var e;e=t,d.forEach((t=>t.update(e))),n.clear()},o.render=()=>{u[o.state].render()},o.renderForeground=()=>{u[o.state].renderForeground()}}function Le(t){const e={},n=[];this.newElement=(o,r)=>{t.includes(o)?e[o]=r:n.push(r)},this.makeComponent=()=>{const o=document.createElement("div");return t.forEach((t=>{const n=e[t];void 0!==n&&o.appendChild(n)})),n.forEach((t=>{o.appendChild(t)})),o}}function Ve(t){const e=this,n=[];e.addSender=e=>{const{name:o,action:r,props:i}=e;n[o]=r;const s=t=>({name:o,value:t,props:i});return{command:s,go:e=>t.do(s(e))}},e.addSenderForList=e=>{const{name:o,action:r,props:i}=e;n[o]=r;const s=(t,e,n)=>({name:o,id:t,value:e,props:i,currentValue:n});return{command:s,go:(e,n,o)=>t.do(s(e,n,o))}},e.execute=t=>{const{name:e,id:o,value:r}=t,i=n[e];void 0!==o?i(o,r):i(r)}}function Ie(t){const e=this,n={},o=[];e.addSender=t=>{const{name:e,currentValue:r,props:i}=t;void 0!==i&&i.isFirstAction&&(o[e]=!0),n[e]=r},e.addSenderForList=t=>{const{name:e,props:r}=t;void 0!==r&&r.isFirstAction&&(o[e]=!0),n[e]=[];return t=>n[e][t]},e.execute=t=>{const{name:e,id:o,value:r}=t;void 0!==o?n[e][o]=r:n[e]=r},e.makeUndo=t=>{const{name:e,id:o,props:r}=t;let i;void 0===o?i=n[e]:(i=n[e][o],void 0===i&&(i=t.currentValue));return{name:e,id:o,value:i,props:r}},e.passLoadConfig=t=>{e.loadConfigPriority(t,"high"),e.loadConfigPriority(t,"low")},e.loadConfigPriority=(e,n)=>{Object.keys(e).forEach((r=>{const i=void 0!==o[r];if("low"===n&&i)return;if("high"===n&&!i)return;const s=e[r];if(s instanceof Array)s.forEach(((e,n)=>{const o={name:r,id:n,value:e};t.execute(o)}));else{const e={name:r,value:s};t.execute(e)}}))},e.passLoadCommands=e=>{e.forEach((e=>{t.execute(e)}))},e.getConfig=()=>structuredClone(n)}function Re(t){const e=this,n=[];let o=-1;e.clearHistory=()=>{n.splice(0,n.length),o=-1},e.passDo=e=>{const r=t.makeUndo(e);n.splice(o+1,n.length-(o+1)),t.execute(e),n.push([{command:e,undoCommand:r}]),o+=1},e.passDoCommands=e=>{n.splice(o+1,n.length-(o+1));const r=[];e.forEach((e=>{const n=t.makeUndo(e);r.push({command:e,undoCommand:n}),t.execute(e)})),n.push(r),o+=1};let r=setTimeout((()=>null),30);e.undo=()=>{if(-1===o)return;const i=n[o];i.forEach((e=>{t.execute(e.undoCommand)})),o-=1;const{undoCommand:s}=i[0];if(void 0===s.props)return;if(!0!==s.props.isChain)return;if(-1===o)return;n[o][0].undoCommand.name===s.name&&(clearTimeout(r),r=setTimeout(e.undo,30))},e.redo=()=>{if(o===n.length-1)return;const i=n[o+1];i.forEach((e=>t.execute(e.command))),o+=1;const{command:s}=i[0];if(void 0===s.props)return;if(!0!==s.props.isChain)return;if(o===n.length-1)return;n[o+1][0].command.name===s.name&&(clearTimeout(r),r=setTimeout(e.redo,30))}}function Oe(t){const e=this,n=new Ve(e),o=new Ie(e),r=new Re(e);t.addCommander(e),e.addSender=t=>{o.addSender(t);return n.addSender(t)},e.addSenderForList=t=>{const e=n.addSenderForList(t);return e.getCurrentValue=o.addSenderForList(t),e},e.execute=t=>{o.execute(t),n.execute(t)},e.makeUndo=o.makeUndo,e.passLoadConfig=o.passLoadConfig,e.passLoadCommands=o.passLoadCommands,e.getConfig=o.getConfig,e.loadConfig=n=>{t.broadcastLoadConfig(n,e)},e.loadCommands=n=>{t.broadCastLoadCommands(n,e)},e.do=n=>{t.broadcastDo(n,e)},e.doCommands=n=>{t.broadcastDoCommands(n,e)},e.passDo=r.passDo,e.passDoCommands=r.passDoCommands,e.undo=r.undo,e.redo=r.redo,e.clearHistory=r.clearHistory}function Ge(t,e){const n=document.createElement("button"),o=document.createElement("button");n.className="button2",o.className="button2",n.innerText="Undo",o.innerText="Redo",n.onclick=e.undo,o.onclick=e.redo,t.newElement("undo",n),t.newElement("redo",o)}function Be(t,e){const n=document.createElement("button");n.className="button2",n.innerText="Save Config To Text";const o=document.createElement("textarea");n.onclick=()=>{const t=e.getConfig();var n;o.value=(n=t,JSON.stringify(N(n),null,"\t"))};const r=document.createElement("div"),i=document.createElement("div");i.appendChild(n),i.appendChild(r),i.appendChild(o),t.newElement("saveConfigToText",i)}function qe(t,e){const n=document.createElement("button");n.className="button2",n.innerText="Load Config Text";const o=document.createElement("textarea");n.onclick=()=>{if(""===o.value)return;const t=JSON.parse(o.value);e.loadConfig(t)};const r=document.createElement("div"),i=document.createElement("div");i.appendChild(n),i.appendChild(r),i.appendChild(o),t.newElement("loadConfigText",i)}function je(t,e,n){const o=document.createElement("button");o.className="button2",o.innerText="Save Link";const r=document.createElement("button");r.className="button2",r.innerText="Copy Link to Clipboard";const i=document.createElement("textarea");function s(){const t=e.getConfig(),o=JSON.stringify(t),r=encodeURIComponent(o),i=new URLSearchParams({a:r}).toString();return`${function(){const t=document.location.href.split("/"),e=t.slice(0,t.length-1);return e.join("/")}()}/${n}?${i}`}o.onclick=()=>{const t=s();i.value=t},r.onclick=()=>{const t=s();navigator.clipboard.writeText(t)};const a=document.createElement("div"),c=document.createElement("div");c.appendChild(o),c.appendChild(r),c.appendChild(a),c.appendChild(i),t.newElement("saveConfigToLink",c)}function We(){throw new Error("setTimeout has not been defined")}function $e(){throw new Error("clearTimeout has not been defined")}var Ue,He=We,ze=$e;function Xe(t){if(He===setTimeout)return setTimeout(t,0);if((He===We||!He)&&setTimeout)return He=setTimeout,setTimeout(t,0);try{return He(t,0)}catch(e){try{return He.call(null,t,0)}catch(e){return He.call(this,t,0)}}}"function"==typeof(Ue="undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).setTimeout&&(He=setTimeout),"function"==typeof Ue.clearTimeout&&(ze=clearTimeout);var Ye,Je=[],Ke=!1,Ze=-1;function Qe(){Ke&&Ye&&(Ke=!1,Ye.length?Je=Ye.concat(Je):Ze=-1,Je.length&&tn())}function tn(){if(!Ke){var t=Xe(Qe);Ke=!0;for(var e=Je.length;e;){for(Ye=Je,Je=[];++Ze<e;)Ye&&Ye[Ze].run();Ze=-1,e=Je.length}Ye=null,Ke=!1,function(t){if(ze===clearTimeout)return clearTimeout(t);if((ze===$e||!ze)&&clearTimeout)return ze=clearTimeout,clearTimeout(t);try{ze(t)}catch(e){try{return ze.call(null,t)}catch(e){return ze.call(this,t)}}}(t)}}function en(t,e){this.fun=t,this.array=e}en.prototype.run=function(){this.fun.apply(null,this.array)};function nn(){}var on=nn,rn=nn,sn=nn,an=nn,cn=nn,ln=nn,hn=nn;var un=Ue.performance||{},dn=un.now||un.mozNow||un.msNow||un.oNow||un.webkitNow||function(){return(new Date).getTime()};var fn=new Date;var pn,gn={nextTick:function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];Je.push(new en(t,e)),1!==Je.length||Ke||Xe(tn)},title:"browser",browser:!0,env:{NODE_ENV:"production"},argv:[],version:"",versions:{},on:on,addListener:rn,once:sn,off:an,removeListener:cn,removeAllListeners:ln,emit:hn,binding:function(t){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(t){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(t){var e=.001*dn.call(un),n=Math.floor(e),o=Math.floor(e%1*1e9);return t&&(n-=t[0],(o-=t[1])<0&&(n--,o+=1e9)),[n,o]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-fn)/1e3}},mn={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-mn.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*mn.Bounce.In(2*t):.5*mn.Bounce.Out(2*t-1)+.5}}},yn="undefined"==typeof self&&void 0!==gn&&gn.hrtime?function(){var t=gn.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?self.performance.now.bind(self.performance):void 0!==Date.now?Date.now:function(){return(new Date).getTime()},wn=function(){function t(){this._tweens={},this._tweensAddedDuringUpdate={}}return t.prototype.getAll=function(){var t=this;return Object.keys(this._tweens).map((function(e){return t._tweens[e]}))},t.prototype.removeAll=function(){this._tweens={}},t.prototype.add=function(t){this._tweens[t.getId()]=t,this._tweensAddedDuringUpdate[t.getId()]=t},t.prototype.remove=function(t){delete this._tweens[t.getId()],delete this._tweensAddedDuringUpdate[t.getId()]},t.prototype.update=function(t,e){void 0===t&&(t=yn()),void 0===e&&(e=!1);var n=Object.keys(this._tweens);if(0===n.length)return!1;for(;n.length>0;){this._tweensAddedDuringUpdate={};for(var o=0;o<n.length;o++){var r=this._tweens[n[o]],i=!e;r&&!1===r.update(t,i)&&!e&&delete this._tweens[n[o]]}n=Object.keys(this._tweensAddedDuringUpdate)}return!0},t}(),vn={Linear:function(t,e){var n=t.length-1,o=n*e,r=Math.floor(o),i=vn.Utils.Linear;return e<0?i(t[0],t[1],o):e>1?i(t[n],t[n-1],n-o):i(t[r],t[r+1>n?n:r+1],o-r)},Bezier:function(t,e){for(var n=0,o=t.length-1,r=Math.pow,i=vn.Utils.Bernstein,s=0;s<=o;s++)n+=r(1-e,o-s)*r(e,s)*t[s]*i(o,s);return n},CatmullRom:function(t,e){var n=t.length-1,o=n*e,r=Math.floor(o),i=vn.Utils.CatmullRom;return t[0]===t[n]?(e<0&&(r=Math.floor(o=n*(1+e))),i(t[(r-1+n)%n],t[r],t[(r+1)%n],t[(r+2)%n],o-r)):e<0?t[0]-(i(t[0],t[0],t[1],t[1],-o)-t[0]):e>1?t[n]-(i(t[n],t[n],t[n-1],t[n-1],o-n)-t[n]):i(t[r?r-1:0],t[r],t[n<r+1?n:r+1],t[n<r+2?n:r+2],o-r)},Utils:{Linear:function(t,e,n){return(e-t)*n+t},Bernstein:function(t,e){var n=vn.Utils.Factorial;return n(t)/n(e)/n(t-e)},Factorial:(pn=[1],function(t){var e=1;if(pn[t])return pn[t];for(var n=t;n>1;n--)e*=n;return pn[t]=e,e}),CatmullRom:function(t,e,n,o,r){var i=.5*(n-t),s=.5*(o-e),a=r*r;return(2*e-2*n+i+s)*(r*a)+(-3*e+3*n-2*i-s)*a+i*r+e}}},_n=function(){function t(){}return t.nextId=function(){return t._nextId++},t._nextId=0,t}(),xn=new wn,bn=function(){function t(t,e){void 0===e&&(e=xn),this._object=t,this._group=e,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=mn.Linear.None,this._interpolationFunction=vn.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._id=_n.nextId(),this._isChainStopped=!1,this._goToEnd=!1}return t.prototype.getId=function(){return this._id},t.prototype.isPlaying=function(){return this._isPlaying},t.prototype.isPaused=function(){return this._isPaused},t.prototype.to=function(t,e){return this._valuesEnd=Object.create(t),void 0!==e&&(this._duration=e),this},t.prototype.duration=function(t){return this._duration=t,this},t.prototype.start=function(t){if(this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed)for(var e in this._reversed=!1,this._valuesStartRepeat)this._swapEndStartRepeatValues(e),this._valuesStart[e]=this._valuesStartRepeat[e];return this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=void 0!==t?"string"==typeof t?yn()+parseFloat(t):t:yn(),this._startTime+=this._delayTime,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat),this},t.prototype._setupProperties=function(t,e,n,o){for(var r in n){var i=t[r],s=Array.isArray(i),a=s?"array":typeof i,c=!s&&Array.isArray(n[r]);if("undefined"!==a&&"function"!==a){if(c){var l=n[r];if(0===l.length)continue;l=l.map(this._handleRelativeValue.bind(this,i)),n[r]=[i].concat(l)}if("object"!==a&&!s||!i||c)void 0===e[r]&&(e[r]=i),s||(e[r]*=1),o[r]=c?n[r].slice().reverse():e[r]||0;else{for(var h in e[r]=s?[]:{},i)e[r][h]=i[h];o[r]=s?[]:{},this._setupProperties(i,e[r],n[r],o[r])}}}},t.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},t.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},t.prototype.pause=function(t){return void 0===t&&(t=yn()),this._isPaused||!this._isPlaying||(this._isPaused=!0,this._pauseStart=t,this._group&&this._group.remove(this)),this},t.prototype.resume=function(t){return void 0===t&&(t=yn()),this._isPaused&&this._isPlaying?(this._isPaused=!1,this._startTime+=t-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this):this},t.prototype.stopChainedTweens=function(){for(var t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].stop();return this},t.prototype.group=function(t){return this._group=t,this},t.prototype.delay=function(t){return this._delayTime=t,this},t.prototype.repeat=function(t){return this._initialRepeat=t,this._repeat=t,this},t.prototype.repeatDelay=function(t){return this._repeatDelayTime=t,this},t.prototype.yoyo=function(t){return this._yoyo=t,this},t.prototype.easing=function(t){return this._easingFunction=t,this},t.prototype.interpolation=function(t){return this._interpolationFunction=t,this},t.prototype.chain=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._chainedTweens=t,this},t.prototype.onStart=function(t){return this._onStartCallback=t,this},t.prototype.onUpdate=function(t){return this._onUpdateCallback=t,this},t.prototype.onRepeat=function(t){return this._onRepeatCallback=t,this},t.prototype.onComplete=function(t){return this._onCompleteCallback=t,this},t.prototype.onStop=function(t){return this._onStopCallback=t,this},t.prototype.update=function(t,e){if(void 0===t&&(t=yn()),void 0===e&&(e=!0),this._isPaused)return!0;var n,o,r=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(t>r)return!1;e&&this.start(t)}if(this._goToEnd=!1,t<this._startTime)return!0;!1===this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),o=(t-this._startTime)/this._duration,o=0===this._duration||o>1?1:o;var i=this._easingFunction(o);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,i),this._onUpdateCallback&&this._onUpdateCallback(this._object,o),1===o){if(this._repeat>0){for(n in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat)this._yoyo||"string"!=typeof this._valuesEnd[n]||(this._valuesStartRepeat[n]=this._valuesStartRepeat[n]+parseFloat(this._valuesEnd[n])),this._yoyo&&this._swapEndStartRepeatValues(n),this._valuesStart[n]=this._valuesStartRepeat[n];return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=t+this._repeatDelayTime:this._startTime=t+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var s=0,a=this._chainedTweens.length;s<a;s++)this._chainedTweens[s].start(this._startTime+this._duration);return this._isPlaying=!1,!1}return!0},t.prototype._updateProperties=function(t,e,n,o){for(var r in n)if(void 0!==e[r]){var i=e[r]||0,s=n[r],a=Array.isArray(t[r]),c=Array.isArray(s);!a&&c?t[r]=this._interpolationFunction(s,o):"object"==typeof s&&s?this._updateProperties(t[r],i,s,o):"number"==typeof(s=this._handleRelativeValue(i,s))&&(t[r]=i+(s-i)*o)}},t.prototype._handleRelativeValue=function(t,e){return"string"!=typeof e?e:"+"===e.charAt(0)||"-"===e.charAt(0)?t+parseFloat(e):parseFloat(e)},t.prototype._swapEndStartRepeatValues=function(t){var e=this._valuesStartRepeat[t],n=this._valuesEnd[t];this._valuesStartRepeat[t]="string"==typeof n?this._valuesStartRepeat[t]+parseFloat(n):this._valuesEnd[t],this._valuesEnd[t]=e},t}(),Sn=(_n.nextId,xn),Cn=(Sn.getAll.bind(Sn),Sn.removeAll.bind(Sn),Sn.add.bind(Sn),Sn.remove.bind(Sn),Sn.update.bind(Sn));function Mn(t,e,n){const o=new m({label:"Theme",width:w(3),data:[{name:"Light",value:!1},{name:"Dark",value:!0}],onChoose:n=>{t.setDarkMode(n.value),e()}});o.highlight("value",t.darkMode),n.newElement("darkModeSwitch",o.dom)}function An(t){const e=this;e.setShowNonExistingEntities=n=>{e.showGhosts=n,t.add(["showGhosts"])}}function En(t){const e=document.createElement("div");e.setAttribute("class","button-group-label2"),e.innerText="Sim Controls:",t.newElement("simControlsLabel",e)}function kn(t,e,n){En(n);e.addMenuItem(t,{label:"Viz:",prop:"viz",setProp:e=>{t.viz=e},options:[{name:"One Election",value:"one"},{name:"Sample Elections",value:"sample"}],change:["viz"]});e.addMenuItem(t,{label:"Geo:",prop:"geo",setProp:e=>{t.geo=e},options:[{name:"On",value:!0},{name:"Off",value:!1}],change:["geo"]});e.addMenuItem(t.election,{label:"Dimensions:",prop:"dimensions",setProp:e=>{t.election.setDimensions(e)},options:[{name:"1D",value:1},{name:"2D",value:2}],change:["dimensions"]})}function Pn(t,e){const n=document.createElement("button");n.innerText="Add Voter",n.className="button2",n.onclick=()=>{e.addVoterPressed()},t.newElement("addVoter",n)}function Tn(){const t=this,e=[];let n=0;t.new=function(t){e.push(t);const o=n;return n+=1,o},t.num=()=>n,t.get=t=>e[t],t.getList=()=>e}function Fn(t,e,n,o,r,i,s){const a=this;a.shape1={},a.shape2={};const c=n.new(a);a.instantiate=()=>{const n={x:t.x,y:t.y},r=[s.setForListSenders.exists.command(c,1,0),s.setForListSenders.shape2p.command(c,n,n),s.setForListSenders.shape1x.command(c,e.x,e.x),s.setForListSenders.shape2w.command(c,t.w,t.w),s.setForListSenders.shape1w.command(c,e.w,e.w),s.setForListSenders.shape1densityProfile.command(c,e.densityProfile,e.densityProfile)];i?o.loadCommands(r):o.doCommands(r)},a.setAction={},a.setAction.exists=t=>{a.exists=t,r.add(["draggables"])},a.setE=t=>{const e=s.setForListSenders.exists.getCurrentValue(c);s.setForListSenders.exists.go(c,t,e)},a.setAction.shape2p=t=>{a.shape2.x=t.x,a.shape2.y=t.y,r.add(["draggables"])},a.setAction.shape1x=t=>{a.shape1.x=t,r.add(["draggables"])},a.setXY1=t=>{const e=s.setForListSenders.shape1x.getCurrentValue(c);s.setForListSenders.shape1x.go(c,t.x,e)},a.setXY2=t=>{const e=s.setForListSenders.shape2p.getCurrentValue(c);s.setForListSenders.shape2p.go(c,t,e)},a.setAction.shape2w=t=>{a.shape2.w=t,r.add(["width"])},a.setW2=t=>{const e=s.setForListSenders.shape2w.getCurrentValue(c);s.setForListSenders.shape2w.go(c,t,e)},a.setAction.shape1w=t=>{a.shape1.w=t,r.add(["width"])},a.setW1=t=>{const e=s.setForListSenders.shape1w.getCurrentValue(c);s.setForListSenders.shape1w.go(c,t,e)},a.setAction.shape1densityProfile=t=>{a.shape1.densityProfile=t,r.add(["densityProfile"])},a.setDensityProfile1=t=>{const e=s.setForListSenders.shape1densityProfile.getCurrentValue(c);s.setForListSenders.shape1densityProfile.go(c,t,e)},a.instantiate(),a.color="#88888888"}function Nn(t,e,n){const o=this,r="voters";function i(n,i,s){o.setForListSenders[n]=e.addSenderForList({action:(e,r)=>{o.setNumberVoters(e+1);t.get(e).setAction[n](r)},name:`${r}-${i}`,props:{isChain:s}})}o.setForListSenders={},i("exists","exists",!1),i("shape2p","shape2D-point",!0),i("shape1x","shape1D-x",!0),i("shape2w","shape2D-width",!0),i("shape1w","shape1D-width",!0),i("shape1densityProfile","shape1D-densityProfile",!1),o.setNumberVotersSender=e.addSender({action:t=>n.setNumberVotersAction(t),currentValue:0,name:`${r}-setNumberAtLeast`,props:{isFirstAction:!0}}),o.setNumberVoters=t=>{e.loadCommands([o.setNumberVotersSender.command(t)])}}function Dn(t,e,n){const o=this;Pn(t,o);const r=new Tn,i=new Nn(r,n,o);o.addVoterPressed=()=>{const t=r.num()+1;i.setNumberVoters(t)},o.setNumberVotersAction=t=>{for(;r.num()<t;)o.addVoterCircle({x:50,y:50,w:200},{x:50,w:200,densityProfile:"gaussian"},!1)};const s=[];o.attachNewE=t=>{s.push(t)};o.addVoterCircle=(t,o,a)=>{const c=new Fn(t,o,r,n,e,a,i);var l;l=c,s.forEach((t=>t.updateNewE(l)));const h=r.num();i.setNumberVoters(h)},o.getVoterShapes=()=>r.getList().filter((t=>t.exists))}const Ln=Math.round;function Vn(t){const e=t.length,n=Array(4).fill();if("rgb"===t.slice(0,3).toLowerCase()){const e=t.replace(" ","").split(",");n[0]=parseInt(e[0].slice("a"===e[3].toLowerCase()?5:4),10),n[1]=parseInt(e[1],10),n[2]=parseInt(e[2],10),n[3]=e[3]?parseFloat(e[3]):-1}else{let o;o=e<6?parseInt(String(t[1])+t[1]+t[2]+t[2]+t[3]+t[3]+(e>4?String(t[4])+t[4]:""),16):parseInt(t.slice(1),16),n[0]=o>>16&255,n[1]=o>>8&255,n[2]=255&o,n[3]=9===e||5===e?Ln((o>>24&255)/255*1e4)/1e4:-1}return n}function In(t,e,n,o,r,i,s,a){const c=this;c.shape1={},c.shape2={};const l=o.new(c);c.instantiate=()=>{const o={x:t.x,y:t.y},i=[a.setForListSenders.exists.command(l,1,0),a.setForListSenders.shape2p.command(l,o,o),a.setForListSenders.shape1x.command(l,e.x,e.x),a.setForListSenders.color.command(l,n,n),a.setForListSenders.party.command(l,[l],[l])];s?r.loadCommands(i):r.doCommands(i)},c.setAction={},c.setAction.exists=t=>{c.exists=t,i.add(["draggables"])},c.setE=t=>{const e=a.setForListSenders.exists.getCurrentValue(l);a.setForListSenders.exists.go(l,t,e)},c.setAction.shape2p=t=>{c.shape2.x=t.x,c.shape2.y=t.y,i.add(["draggables"])},c.setAction.shape1x=t=>{c.shape1.x=t,i.add(["draggables"])},c.setXY1=t=>{const e=a.setForListSenders.shape1x.getCurrentValue(l);a.setForListSenders.shape1x.go(l,t.x,e)},c.setXY2=t=>{const e=a.setForListSenders.shape2p.getCurrentValue(l);a.setForListSenders.shape2p.go(l,t,e)},c.setAction.color=t=>{c.color=t,c.colorRGBA=Vn(t),i.add(["color"])},c.setColor=t=>{const e=a.setForListSenders.color.getCurrentValue(l);a.setForListSenders.color.go(l,t,e)},c.setAction.party=t=>{c.party=t,i.add(["party"])},c.setParty=t=>{const e=a.setForListSenders.party.getCurrentValue(l);a.setForListSenders.party.go(l,t,e)},c.instantiate()}function Rn(t,e,n){const o=this,r="candidates";function i(n,i,s){o.setForListSenders[n]=e.addSenderForList({action:(e,r)=>{o.setNumberCandidates(e+1);t.get(e).setAction[n](r)},name:`${r}-${i}`,props:{isChain:s}})}o.setForListSenders={},i("exists","exists",!1),i("shape2p","shape2D-point",!0),i("shape1x","shape1D-x",!0),i("color","color",!1),i("party","party",!1),o.setNumberCandidatesSender=e.addSender({action:t=>{n.setNumberCandidatesAction(t)},currentValue:0,name:`${r}-setNumberAtLeast`,props:{isFirstAction:!0}}),o.setNumberCandidates=t=>{e.loadCommands([o.setNumberCandidatesSender.command(t)])}}function On(t,e){const n=document.createElement("button");n.className="button2",n.innerText="Add Candidate",n.onclick=()=>{e.addCandidatePressed()},t.newElement("addCandidate",n),this.show=()=>{n.hidden=!1},this.hide=()=>{n.hidden=!0}}function Gn(t,e,n){const o=this;o.canButton=new On(t,o);const r=new Tn,i=new Rn(r,n,o);o.addCandidatePressed=()=>{const t=r.num()+1;i.setNumberCandidates(t)},o.setNumberCandidatesAction=t=>{for(;r.num()<t;){const t=V("yellow");o.addCandidate({x:50,y:50},{x:50},t,!1)}};const s=[];o.attachNewE=t=>{s.push(t)};o.addCandidate=(t,o,a,c)=>{const l=new In(t,o,a,r,n,e,c,i);var h;h=l,s.forEach((t=>t.updateNewE(h)));const u=r.num();i.setNumberCandidates(u)},o.getCandidates=()=>r.getList().filter((t=>t.exists))}function Bn(t,e,n,o,r,i,s){const a=this;a.shape2={},a.shape1={};const c=n.new(a);a.instantiate=()=>{const n={x:t.x,y:t.y},r=[s.setForListSenders.exists.command(c,1,0),s.setForListSenders.shape2p.command(c,n,n),s.setForListSenders.shape1x.command(c,e.x,e.x),s.setForListSenders.shape2w.command(c,t.w,t.w),s.setForListSenders.shape1w.command(c,e.w,e.w),s.setForListSenders.shape1densityProfile.command(c,e.densityProfile,e.densityProfile),s.setForListSenders.party.command(c,[c],[c])];i?o.loadCommands(r):o.doCommands(r)},a.setAction={},a.setAction.exists=t=>{a.exists=t,r.add(["draggables"])},a.setE=t=>{const e=s.setForListSenders.exists.getCurrentValue(c);s.setForListSenders.exists.go(c,t,e)},a.setAction.shape2p=t=>{a.shape2.x=t.x,a.shape2.y=t.y,r.add(["draggables"])},a.setAction.shape1x=t=>{a.shape1.x=t,r.add(["draggables"])},a.setXY1=t=>{const e=s.setForListSenders.shape1x.getCurrentValue(c);s.setForListSenders.shape1x.go(c,t.x,e)},a.setXY2=t=>{const e=s.setForListSenders.shape2p.getCurrentValue(c);s.setForListSenders.shape2p.go(c,t,e)},a.setAction.shape2w=t=>{a.shape2.w=t,r.add(["width"])},a.setW2=t=>{const e=s.setForListSenders.shape2w.getCurrentValue(c);s.setForListSenders.shape2w.go(c,t,e)},a.setAction.shape1w=t=>{a.shape1.w=t,r.add(["width"])},a.setW1=t=>{const e=s.setForListSenders.shape1w.getCurrentValue(c);s.setForListSenders.shape1w.go(c,t,e)},a.setAction.shape1densityProfile=t=>{a.shape1.densityProfile=t,r.add(["densityProfile"])},a.setDensityProfile1=t=>{const e=s.setForListSenders.shape1densityProfile.getCurrentValue(c);s.setForListSenders.shape1densityProfile.go(c,t,e)},a.setAction.party=t=>{a.party=t,r.add(["party"])},a.setParty=t=>{const e=s.setForListSenders.party.getCurrentValue(c);s.setForListSenders.party.go(c,t,e)},a.instantiate(),a.color="#ccc",a.darkModeColor="#333"}function qn(t,e,n){const o=this,r="candidateDns";function i(n,i,s){o.setForListSenders[n]=e.addSenderForList({action:(e,r)=>{o.setNumberCandidateDns(e+1);t.get(e).setAction[n](r)},name:`${r}-${i}`,props:{isChain:s}})}o.setForListSenders={},i("exists","exists",!1),i("shape2p","shape2D-point",!0),i("shape1x","shape1D-x",!0),i("shape2w","shape2D-width",!0),i("shape1w","shape1D-width",!0),i("shape1densityProfile","shape1D-densityProfile",!1),i("party","party",!1),o.setNumberCandidateDnsSender=e.addSender({action:t=>{n.setNumberCandidateDnsAction(t)},currentValue:0,name:`${r}-setNumberAtLeast`,props:{isFirstAction:!0}}),o.setNumberCandidateDns=t=>{e.loadCommands([o.setNumberCandidateDnsSender.command(t)])}}function jn(t,e){const n=document.createElement("button");n.className="button2",n.innerText="Add Candidate Distribution",n.onclick=()=>{e.addCandidateDistributionPressed()},t.newElement("addCandidateDistribution",n),this.show=()=>{n.hidden=!1},this.hide=()=>{n.hidden=!0}}function Wn(t,e,n){const o=this;o.canDnButton=new jn(t,o);const r=new Tn,i=new qn(r,n,o);o.addCandidateDistributionPressed=()=>{const t=r.num()+1;i.setNumberCandidateDns(t)},o.setNumberCandidateDnsAction=t=>{for(;r.num()<t;)o.addCandidateDistribution({x:50,y:50,w:200},{x:50,w:200,densityProfile:"gaussian"},!1)};const s=[];o.attachNewE=t=>{s.push(t)};o.addCandidateDistribution=(t,o,a)=>{const c=new Bn(t,o,r,n,e,a,i);var l;l=c,s.forEach((t=>t.updateNewE(l)));const h=r.num();i.setNumberCandidateDns(h)},o.getCandidateDistributions=()=>r.getList().filter((t=>t.exists))}function $n(t,e,n,o){const r=this;r.candidateList=new Gn(o,e,n,r),r.voterShapeList=new Dn(o,e,n,r),r.candidateDnList=new Wn(o,e,n,r)}function Un(t,e){t.attach(this),this.update=t=>{e.checkNone()||(window.votekitStore={},T({electionResults:t}))}}function Hn(){const t=this;t.enter=()=>{},t.exit=()=>{},t.update=function(){},t.render=function(){}}function zn(t){const{explanation:e,votes:n,colorRGBAOfCandidates:o}=t,{winnersByRound:r,winnerMaxCostPerScoreByRound:i}=e,{scoreVotes:s,gridData:a}=n,c=r.length,l=a.length,h=[],u=[],d=[];for(let t=0;t<l;t++){const{voteIndex:e}=a[t],n=e.length,l=[];l[0]=Array(n).fill(1);const f=[],p=[];for(let t=0;t<c;t++){const a=l[t],h=Array(n),u=Array(n),d=r[t],g=i[t];for(let t=0;t<n;t++){const n=g*s[e[t]][d];u[t]=Math.min(a[t],n),h[t]=Math.max(0,a[t]-n)}f[t]=u,p[t]=o[d],t<c-1&&(l[t+1]=h)}d[t]=p,h[t]=f,u[t]=l}return{costsByGeom:h,budgetsByGeom:u,colorRGBAByGeom:d}}function Xn(t,e,n){const{explanation:o,votes:r}=t,{winnersByRound:i}=o,{costsByGeom:s,budgetsByGeom:a,colorRGBAByGeom:c}=n,{gridData:l}=r,h=i.length,u=l.length,d=1/3,f=-e.width/3,p=e.width/3,g=[],m=[];for(let t=0;t<u;t++){const{grid:n,voteIndex:o,voterGeom:r}=l[t],{w:i,densityProfile:c}=r,u=r.x,y=n.x,w="gaussian"===c,v=i/Math.sqrt(2*Math.PI),_=o.length,x=a[t],b=s[t],S=[],C=[];for(let t=0;t<h;t++){const n=x[t],o=b[t],r=[],i=[],s=t%3*p,a=(Math.floor(t/3)+1)*p;let c=0;const l=0*f+a,h=Math.max(-1,y[0])*d+s;r[c]=[h,l],i[c]=[h,l],c+=1;for(let t=0;t<_;t++){const l=y[t];if(l<-1)continue;if(l>e.width+1)continue;const h=w?Math.exp(-.5*((l-u)/v)**2):1,p=o[t]*h,g=l*d+s,m=n[t]*h*f+a;r[c]=[g,m];const _=l*d+s,x=p*f+a;i[c]=[_,x],c+=1}const g=Math.min(e.width+1,y[_-1])*d+s;r[c]=[g,l],i[c]=[g,l],c+=1,r[c]=[h,l],i[c]=[h,l],c+=1,C[t]=i,S[t]=r}g[t]=C,m[t]=S}return{costShapesbyGeom:g,budgetShapesbyGeom:m,colorRGBAByGeom:c}}function Yn(t,e){const n=t.length,o=[0,0,0];let r=0;for(let i=0;i<n;i++){for(let n=0;n<3;n++)o[n]+=t[i]*e[i][n]**2;r+=t[i]}return o.map((t=>Math.round(Math.sqrt(t/r))))}function Jn(t){return`rgb(${t[0]},${t[1]},${t[2]})`}function Kn(t,e){const{costShapesbyGeom:n,budgetShapesbyGeom:o,colorRGBAByGeom:r}=e,i=n.length,{mctx:s}=t;s.save(),s.globalAlpha=.7;for(let t=0;t<i;t++){const e=n[t],i=o[t],a=r[t],c=e.length;for(let t=0;t<c;t++){const n=e[t],o=i[t],r=a[t];s.fillStyle="#cccccc",s.strokeStyle="#555555",s.beginPath(),s.moveTo(o[0][0],o[0][1]);for(let t=1;t<o.length;t++)s.lineTo(o[t][0],o[t][1]);s.fill(),s.stroke(),s.fillStyle=Jn(r),s.strokeStyle=Jn(Yn([.5,.5],[r,[0,0,0]])),s.beginPath(),s.moveTo(n[0][0],n[0][1]);for(let t=1;t<n.length;t++)s.lineTo(n[t][0],n[t][1]);s.fill(),s.stroke()}}s.restore()}function Zn(t){const e=this;let n,o=!1;e.enter=()=>{t.showMaps()},e.exit=()=>{t.hideMaps()},e.update=function(e){const{error:r}=e;if(void 0!==r)return void(o=!0);o=!1;const i=zn(e);n=Xn(e,t,i)},e.render=function(){o||Kn(t,n)}}function Qn(t,e,n,o){const r=this;let i;function s(){const{electionMethod:e}=o.election.socialChoice,n=!o.geo,{dimensions:r}=o.election;i=new("methodOfEqualShares"===e&&n&&1===r?Zn:Hn)(t)}o.sims.one.pub.attach(r),s(),r.enter=()=>{s(),i.enter()},r.exit=()=>{i.exit()},r.update=t=>{n.checkNone()||(i.update(t),r.render())},r.render=()=>{i.render()}}function to(t,e){this.render=()=>{t.voterGeo.voterGroupsByTract.forEach((e=>{e.forEach((e=>{e.forEach((e=>{if(1===t.election.dimensions){const{x:t}=e.shape1,{y:n}=e.shape2;r(t,n%100+0)}else{const{x:t,y:n}=e.shape2;r(t,n)}}))}))}))};const n=document.createElement("canvas"),o=n.getContext("2d");function r(t,o){const{ctx:r}=e;r.drawImage(n,t-5,o-5,10,10)}n.width=10,n.height=10,o.beginPath(),o.fillStyle="#555",o.arc(5,5,1,0,2*Math.PI),o.fill()}function eo(t,e){const n=this;n.render=function(){const{ctx:n,darkMode:o}=e,{x:r,w:i,densityProfile:s}=t.shape1,a=100;n.save(),n.strokeStyle="#555",o&&(n.strokeStyle="#ddd"),n.beginPath(),"gaussian"===s?function(){const t=i/Math.sqrt(2*Math.PI),o=a,s=200;n.moveTo(0,s);const c=[];for(let i=0;i<=e.width;i+=1){const e=.5*((i-r)/t)**2,a=s-o*Math.exp(-e);c.push(a),n.lineTo(i,a)}n.lineTo(e.width,s),n.lineTo(0,s)}():n.rect(r-.5*i,100,i,a),n.stroke(),n.restore()},n.renderAt=()=>{n.render()}}function no(t,e){const n=this;n.render=function(){const{ctx:n,darkMode:o}=e,{x:r,y:i,w:s}=t.shape2;n.beginPath(),n.strokeStyle="#555",o&&(n.strokeStyle="#ddd"),n.arc(r,i,.5*s,0,2*Math.PI),n.stroke()},n.renderAt=function(n,o){const{ctx:r,darkMode:i}=e,{w:s}=t.shape2;r.beginPath(),r.strokeStyle="#555",i&&(r.strokeStyle="#ddd"),r.arc(n,o,.5*s,0,2*Math.PI),r.stroke()},n.renderCenterAt2=function(t,n){const{ctx:o,darkMode:r}=e;o.beginPath(),o.fillStyle="#555",r&&(o.fillStyle="#bbb"),o.arc(t,n,1,0,2*Math.PI),o.fill()}}function oo(t,e,n,o){const r=this,{dimensions:i}=o.election,s=1===i?eo:no;t.setRenderer((t=>new s(t,n)));const a=new to(o,n);r.enter=()=>{},r.exit=()=>{},r.update=()=>{},r.render=()=>{t.render(),a.render()}}function ro(t,e,n){let o,r;this.update=function(){r=e.getCandidates();const t=r.map((t=>[t.shape1.x,0])),i=be.from(t);o=i.voronoi([0,0,n.width,n.height])},this.render=function(){const{ctx:e}=n,{x:i,w:s,densityProfile:a}=t.shape1,c=100;e.save(),e.beginPath(),h(),e.clip();const l=r.length;for(let t=0;t<l;t++)e.beginPath(),o.renderCell(t,e),e.fillStyle=r[t].color,e.fill(),e.stroke();function h(){"gaussian"===a?function(){const t=s/Math.sqrt(2*Math.PI),o=c,r=200;e.moveTo(0,r);const a=[];for(let s=0;s<=n.width;s+=1){const n=.5*((s-i)/t)**2,c=r-o*Math.exp(-n);a.push(c),e.lineTo(s,c)}e.lineTo(n.width,r),e.lineTo(0,r)}():e.rect(i-.5*s,100,s,c)}e.beginPath(),h(),e.stroke(),e.restore()}}function io(t,e,n){let o,r;this.update=function(){r=e.getCandidates();const t=r.map((t=>[t.shape2.x,t.shape2.y])),i=be.from(t);o=i.voronoi([0,0,n.width,n.height])},this.render=function(){const{ctx:e}=n,{x:i,y:s,w:a}=t.shape2;e.save(),e.beginPath(),e.arc(i,s,.5*a,0,2*Math.PI),e.clip();const c=r.length;for(let t=0;t<c;t++)e.beginPath(),o.renderCell(t,e),e.fillStyle=r[t].color,e.fill(),e.stroke();e.beginPath(),e.arc(i,s,.5*a,0,2*Math.PI),e.stroke(),e.restore()}}function so(t,e,n,o){const r=this,{dimensions:i}=o.election,s=1===i?ro:io;t.setRenderer((t=>new s(t,e,n))),r.enter=()=>{},r.exit=()=>{},r.update=function(e){const{error:n}=e;void 0===n&&t.updateGraphic()},r.render=function(){t.render()}}function ao(t,e,n){let o,r,i;this.update=function(t){let n,s;if(void 0===t){o=e.getCandidates();const t=dt(o.map((t=>t.shape1)));n=t.ranking,s=t.intervalBorders}else n=t.ranking,s=t.intervalBorders;o=e.getCandidates();const a=o.length,c=o.map((t=>t.colorRGBA)),l=s.length-1;i=Array(l),r=Array(l);for(let t=0;t<l;t++){i[t]=[s[t],s[t+1]];const e=n[t].map((t=>a-t));r[t]=Jn(Yn(e,c))}},this.render=function(){const{ctx:e}=n,{x:o,w:s,densityProfile:a}=t.shape1,c=100;e.save(),e.beginPath(),h(),e.clip();const l=i.length;for(let t=0;t<l;t++)co(i[t],r[t],e,n);function h(){"gaussian"===a?function(){const t=s/Math.sqrt(2*Math.PI),r=c,i=200;e.moveTo(0,i);const a=[];for(let s=0;s<=n.width;s+=1){const n=.5*((s-o)/t)**2,c=i-r*Math.exp(-n);a.push(c),e.lineTo(s,c)}e.lineTo(n.width,i),e.lineTo(0,i)}():e.rect(o-.5*s,100,s,c)}e.beginPath(),h(),e.stroke(),e.restore()}}function co(t,e,n,o){const r=Math.max(0,t[0]),i=Math.min(o.width,t[1])-r,s=o.height;n.beginPath(),n.rect(r,0,i,s),n.fillStyle=e,n.fill(),n.stroke()}function lo(t,e,n){let o,r,i;this.update=function(n){let s;if(void 0===n){o=e.getCandidates();const n=o.map((t=>t.shape2)),r=lt(t.shape2,n);s=r.ranking,i=r.cells}else s=n.ranking,i=n.cells;o=e.getCandidates();const a=o.length,c=i.length;r=Array(c);const l=o.map((t=>t.colorRGBA));for(let t=0;t<c;t++){const e=s[t].map((t=>a-t));r[t]=Jn(Yn(e,l))}},this.render=function(){const{ctx:e}=n,{x:o,y:s,w:a}=t.shape2;e.save();const c=i.length;for(let t=0;t<c;t++)e.beginPath(),ho(e,i[t]),e.fillStyle=r[t],e.strokeStyle=r[t],e.fill(),e.stroke();e.strokeStyle="#222",e.beginPath(),e.arc(o,s,.5*a,0,2*Math.PI),e.stroke(),e.restore()}}function ho(t,e){const n=e.length,o=e[n-1];t.moveTo(o[0],o[1]);for(let o=0;o<n;o++){const n=e[o];t.lineTo(n[0],n[1])}}function uo(t,e,n,o){const r=this,{dimensions:i}=o.election,s=1===i?ao:lo;t.setRenderer((t=>new s(t,e,n))),r.enter=()=>{},r.exit=()=>{},r.update=function(e){const{error:n}=e;if(void 0!==n)return;const{cellData:o}=e.votes;t.updateGraphic(o)},r.render=function(){t.render()}}function fo(t,e){const n=this;let o,r;function i(t,n,i){const{grid:s,voteSet:a,voterGeom:c}=o,{x:l,w:h,densityProfile:u}=c,d=r.length,f="gaussian"===u,p=s.x,g=h/Math.sqrt(2*Math.PI),m=200/d,y=200-n*m,w=Math.max(-1,p[0]);t.moveTo(w,y);const v=p.length;for(let o=0;o<v;o+=1){const r=p[o];if(r<-1)continue;if(r>e.width)continue;const s=i?1:a[o].tallyFractions[n],c=y-m*(f?Math.exp(-.5*((r-l)/g)**2):1)*s;t.lineTo(r,c)}const _=Math.min(e.width,p[v-1]);t.lineTo(_,y),t.lineTo(w,y)}n.update=e=>{o=e,r=t.getCandidates()},n.renderBackground=function(){const{ctx:t}=e;t.save(),t.globalAlpha=.7;const n=r.length;for(let e=0;e<n;e++)t.strokeStyle="#dddddd",t.beginPath(),i(t,e,!0),t.stroke();t.restore()},n.render=function(){const{ctx:t}=e;t.save(),t.globalAlpha=.7;const n=r.length;for(let e=0;e<n;e++){t.fillStyle=r[e].color;const{colorRGBA:n}=r[e];t.strokeStyle=Jn(Yn([.5,.5],[n,[0,0,0]])),t.beginPath(),i(t,e,!1),t.fill(),t.stroke()}t.restore()}}function po(t,e){let n,o,r;const i=[];this.update=s=>{n=s,o=t.getCandidates();const{grid:a,voteSet:c,voterGeom:l}=n,h=o.length,u=Math.floor((h-1)/3)+1;e.setMapsHeight(u*(1/3)*e.height);const d="gaussian"===l.densityProfile;!function(){const{nx:t,ny:e,weight:n}=a;i.splice(0);for(let r=0;r<o.length;r++){const s=document.createElement("canvas");s.width=t,s.height=e;const a=s.getContext("2d"),l=a.createImageData(t,e),{data:h}=l,{colorRGBA:u}=o[r],[f,p,g]=u;let m=0;for(let o=0;o<e;o++)for(let e=0;e<t;e++){const i=c[m].tallyFractions[r]*(d?n[m]:1)*255;h[4*(e+o*t)+0]=f,h[4*(e+o*t)+1]=p,h[4*(e+o*t)+2]=g,h[4*(e+o*t)+3]=i,m+=1}i.push(s),a.putImageData(l,0,0)}}(),function(){const{nx:t,ny:e,weight:n}=a,i=o.map((t=>t.colorRGBA)),s=document.createElement("canvas");s.width=t,s.height=e;const l=s.getContext("2d"),h=l.createImageData(t,e),{data:u}=h;let f=0;for(let o=0;o<e;o++)for(let e=0;e<t;e++){const{tallyFractions:r}=c[f],[s,a,l]=Yn(r,i),h=255*(d?n[f]:1);u[4*(e+o*t)+0]=s,u[4*(e+o*t)+1]=a,u[4*(e+o*t)+2]=l,u[4*(e+o*t)+3]=h,f+=1}r=s,l.putImageData(h,0,0)}()},this.render=function(){const{ctx:t,mctx:s}=e,{x:a,y:c,w:l}=n.voterGeom;!function(){t.save(),t.beginPath(),t.arc(a,c,.5*l,0,2*Math.PI),t.clip();const e={w:1,h:1,x:0,y:0},n=r;t.imageSmoothingEnabled=!1;const o={x:a-.5*l+e.x,y:c-.5*l+e.y,w:l*e.w,h:l*e.h};t.drawImage(n,o.x,o.y,o.w,o.h),t.beginPath(),t.arc(a,c,.5*l,0,2*Math.PI),t.stroke(),t.restore()}(),function(){const t=o.length;for(let e=0;e<t;e++){s.save();const t={w:1/3,h:1/3,x:e%3*100,y:100*Math.floor(e/3)},n={x:a*t.w+t.x,y:c*t.h+t.y,r:l*t.w*.5};s.beginPath(),s.arc(n.x,n.y,n.r,0,2*Math.PI),s.clip(),s.beginPath(),s.rect(t.x,t.y,100,100),s.clip();const o=i[e],r={x:a*t.w-l*t.w*.5+t.x,y:c*t.w-l*t.w*.5+t.y,w:l*t.w,h:l*t.h};s.drawImage(o,r.x,r.y,r.w,r.h),s.beginPath(),s.arc(n.x,n.y,n.r,0,2*Math.PI),s.stroke(),s.restore()}}()}}function go(t,e,n,o){const r=this,{dimensions:i}=o.election,s=1===i?fo:po;t.setRenderer((()=>new s(e,n))),r.enter=function(){2===i&&n.showMaps()},r.exit=function(){n.hideMaps()},r.update=function(e){const{error:n}=e;if(void 0!==n)return;const{gridData:o}=e.votes;t.updateGraphic(o)},r.render=function(){1===o.election.dimensions&&t.renderBackground(),t.render()}}function mo(t,e,n,o,r,i,s,a,c){a.save(),a.globalAlpha=s,a.textAlign=c||"center",a.font=`${o}px Sans-serif`,a.lineWidth=r,a.fillStyle=i,a.fillText(t,e,n),a.restore()}function yo(t){return(100*t).toFixed(0)}function wo(){const t=this;t.list=[],t.updateNewG=e=>{t.add(e)},t.add=e=>{const n={};e.voterShape?(n.g=e.graphic.circle,n.r=e.graphic,n.o=e.voterShape,n.p={isCircle:!0}):e.candidate?(n.g=e.graphic.square,n.r=e.graphic,n.o=e.candidate,n.p={isSquare:!0}):e.canDn?(n.g=e.graphic.square,n.r=e.graphic,n.o=e.canDn,n.p={isSquare:!0}):(n.g=e.circle,n.r=e,n.o=e,n.p={isCircle:!0}),t.list.push(n)}}function vo(t,e,n,o,r){let i={};const s=t.list,a=n.tooltips,c=function(t){if(null!==t.target.closest(".tooltipBox"))return;const e=d(t),n=t.isTouch?10:0,o=s.length,c=[];for(let t=0;t<o;t++){const o=s[t];(o.o.exists||r.showGhosts)&&f(o,e,n)&&c.push(t)}if(c.length>0){const t=c.map((t=>{const n=s[t];return(n.r.x-e.x)**2+(n.r.y-e.y)**2})),n=c[I(t)],o=s[n];i.iDragging=n,i.isDragging=!0,i.offX=o.r.x-e.x,i.offY=o.r.y-e.y,o.g.pickUp(),a.dataset.cursor="grabbing"}!function(t){p=!0,g=q(t)}(e)},l=function(t){const e=d(t);if(i.isDragging){t.isTouch&&(t.preventDefault(),t.stopPropagation());const r=s[i.iDragging],a=n.width,c=n.height;r.r.setXYView({x:G(e.x+i.offX,0,a),y:G(e.y+i.offY,0,c)}),o.add(["draggables"])}else{const t=s.length;for(let n=0;n<t;n++){const t=s[n];if((r.showGhosts||t.o.exists)&&f(t,e,0))return void(a.dataset.cursor="grab")}a.dataset.cursor=""}!function(t){if(p){const e=Math.abs(g.x-t.x),n=Math.abs(g.y-t.y);e>5&&(p=!1),n>5&&(p=!1)}}(e)},h=function(){if(function(){if(p)if(p=!1,i.isDragging){s[i.iDragging].r.click()}else e.clickEmpty(g)}(),void 0!==i.iDragging){s[i.iDragging].g.drop()}i={}};function u(t){return t.isTouch=!0,t}function d(t){const e=n.canvas.getBoundingClientRect(),o=t.isTouch?t.changedTouches[0]:t;return{x:o.clientX-e.left,y:o.clientY-e.top}}function f(t,e,n){const o=t.r.x-e.x,r=t.r.y-e.y;if(t.p.isCircle){const{r:e}=t.g;return o*o+r*r<(e+n)*(e+n)}if(t.p.isSquare){const{w:e,h:i}=t.g;return Math.abs(o)<.5*e+n&&Math.abs(r)<.5*i+n}return!1}let p,g;this.eventHandlers={start:c,move:l,end:h,touchmove:t=>{const e=u(t);l(e)},touchstart:t=>{const e=u(t);c(e)},touchend:t=>{const e=u(t);l(e),h(),null===t.target.closest(".tooltipBox")&&t.preventDefault()}}}function _o(t,e,n){const o=this;o.dragm=new wo,o.clickDrag=new vo(o.dragm,o,t,e,n),o.enter=()=>{t.eventHandlers.set(o.clickDrag.eventHandlers)},o.exit=()=>{},o.update=()=>{if(e.checkNone())return;t.clear();const[n,o]=[150,150];mo("Not Yet Implemented",n,o,20,2,"#222",1,t.ctx)},o.render=()=>{},o.renderForeground=()=>{},o.testVoteView=()=>null}function xo(t){const e=this;e.voterShape=t,e.setRenderer=n=>{e.renderer=n(t)}}function bo(t){const e=this,n=[];e.list=n,e.rendererMaker=()=>({render:()=>{}}),t.attachNewE(e),e.updateNewE=t=>{e.newVoterShape(t)},e.newVoterShape=function(t){const o=new xo(t);n.push(o),o.setRenderer(e.rendererMaker)},e.getVoterShapes=()=>n.filter((t=>t.voterShape.exists)).map((t=>t.voterShape)),e.getVoterRenderers=()=>n.filter((t=>t.voterShape.exists)),e.setRenderer=t=>{e.rendererMaker=t,n.forEach((e=>e.setRenderer(t)))},e.updateGraphic=t=>{const n=e.getVoterRenderers();void 0===t?n.forEach((t=>t.renderer.update())):n.forEach(((e,n)=>e.renderer.update(t[n])))},e.render=()=>{n.forEach((t=>{t.voterShape.exists&&t.renderer.render()}))},e.renderBackground=()=>{n.forEach((t=>{t.voterShape.exists&&t.renderer.renderBackground()}))}}function So(t,e,n,o,r,i){const s=this;r.sims.one.pub.attach(s),_o.call(s,e,o,i);const{candidateList:a,voterShapeList:c}=t,l=new bo(c);let h;function u(){const{casterName:t}=r.election.socialChoice,n="score"===t||"scoreLong"===t?go:"ranking"===t||"pairwise"===t?uo:so,o=!0===r.geo?oo:n;h=new o(l,a,e,r)}u(),s.enter=()=>{u(),h.enter()},s.exit=()=>{h.exit()},s.update=t=>{o.checkNone()||(h.update(t),e.clear(),e.clearMaps(),s.render())},s.render=()=>{h.render()}}function Co(t,e,n,o,r){const{width:i}=n,s=Array(i).fill(0);let a=0;const{dimensions:c}=r.election,l=1===c?eo:no;t.setRenderer((t=>new l(t,n))),e.setRenderer((t=>new l(t,n))),this.update=function(t){o.checkAny()&&(s.fill(0),a=0);const{pointsChanged:e,points:n}=t;e&&function(t){const e=t.length;for(let n=0;n<e;n++){const{x:e}=t[n];for(let t=0;t<i;t++)s[t]+=u(t-e);a+=h}}(n)};const h=4/3;function u(t){return t>20||t<-20?0:(1-(t/20)**2)/20}this.render=()=>{!function(){const{ctx:t}=n;t.save(),t.beginPath(),function(t){const e=1/a,o=1e4,r=200;t.moveTo(0,r);const c=[];for(let n=0;n<=i;n+=1){const i=r-o*s[n]*e;c.push(i),t.lineTo(n,i)}t.lineTo(n.width,r),t.lineTo(0,r)}(t),t.strokeStyle="#ccc",t.stroke(),t.fillStyle="#ccc",t.fill(),t.restore()}(),t.render(),e.render()}}function Mo(t,e,n){t=+t,e=+e,n=(r=arguments.length)<2?(e=t,t=0,1):r<3?1:+n;for(var o=-1,r=0|Math.max(0,Math.ceil((e-t)/n)),i=new Array(r);++o<r;)i[o]=t+o*n;return i}var Ao=Math.sqrt(50),Eo=Math.sqrt(10),ko=Math.sqrt(2);function Po(t,e,n){var o,r,i,s,a=-1;if(n=+n,(t=+t)===(e=+e)&&n>0)return[t];if((o=e<t)&&(r=t,t=e,e=r),0===(s=function(t,e,n){var o=(e-t)/Math.max(0,n),r=Math.floor(Math.log(o)/Math.LN10),i=o/Math.pow(10,r);return r>=0?(i>=Ao?10:i>=Eo?5:i>=ko?2:1)*Math.pow(10,r):-Math.pow(10,-r)/(i>=Ao?10:i>=Eo?5:i>=ko?2:1)}(t,e,n))||!isFinite(s))return[];if(s>0){let n=Math.round(t/s),o=Math.round(e/s);for(n*s<t&&++n,o*s>e&&--o,i=new Array(r=o-n+1);++a<r;)i[a]=(n+a)*s}else{s=-s;let n=Math.round(t*s),o=Math.round(e*s);for(n/s<t&&++n,o/s>e&&--o,i=new Array(r=o-n+1);++a<r;)i[a]=(n+a)/s}return o&&i.reverse(),i}function To(t,e,n){var o=Math.abs(e-t)/Math.max(0,n),r=Math.pow(10,Math.floor(Math.log(o)/Math.LN10)),i=o/r;return i>=Ao?r*=10:i>=Eo?r*=5:i>=ko&&(r*=2),e<t?-r:r}function Fo(t){return Math.ceil(Math.log(function(t,e){let n=0;if(void 0===e)for(let e of t)null!=e&&(e=+e)>=e&&++n;else{let o=-1;for(let r of t)null!=(r=e(r,++o,t))&&(r=+r)>=r&&++n}return n}(t))/Math.LN2)+1}var No=Array.prototype.slice;function Do(t,e){return t-e}var Lo=t=>()=>t;function Vo(t,e){for(var n,o=-1,r=e.length;++o<r;)if(n=Io(t,e[o]))return n;return 0}function Io(t,e){for(var n=e[0],o=e[1],r=-1,i=0,s=t.length,a=s-1;i<s;a=i++){var c=t[i],l=c[0],h=c[1],u=t[a],d=u[0],f=u[1];if(Ro(c,u,e))return 0;h>o!=f>o&&n<(d-l)*(o-h)/(f-h)+l&&(r=-r)}return r}function Ro(t,e,n){var o,r,i,s;return function(t,e,n){return(e[0]-t[0])*(n[1]-t[1])==(n[0]-t[0])*(e[1]-t[1])}(t,e,n)&&(r=t[o=+(t[0]===e[0])],i=n[o],s=e[o],r<=i&&i<=s||s<=i&&i<=r)}function Oo(){}var Go=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function Bo(){var t=1,e=1,n=Fo,o=a;function r(t){var e=n(t);if(Array.isArray(e))e=e.slice().sort(Do);else{const n=function(t,e){let n,o;if(void 0===e)for(const e of t)null!=e&&(void 0===n?e>=e&&(n=o=e):(n>e&&(n=e),o<e&&(o=e)));else{let r=-1;for(let i of t)null!=(i=e(i,++r,t))&&(void 0===n?i>=i&&(n=o=i):(n>i&&(n=i),o<i&&(o=i)))}return[n,o]}(t),o=To(n[0],n[1],e);e=Po(Math.floor(n[0]/o)*o,Math.floor(n[1]/o-1)*o,e)}return e.map((e=>i(t,e)))}function i(n,r){var i=[],a=[];return function(n,o,r){var i,a,c,l,h,u,d=new Array,f=new Array;i=a=-1,l=n[0]>=o,Go[l<<1].forEach(p);for(;++i<t-1;)c=l,l=n[i+1]>=o,Go[c|l<<1].forEach(p);Go[l<<0].forEach(p);for(;++a<e-1;){for(i=-1,l=n[a*t+t]>=o,h=n[a*t]>=o,Go[l<<1|h<<2].forEach(p);++i<t-1;)c=l,l=n[a*t+t+i+1]>=o,u=h,h=n[a*t+i+1]>=o,Go[c|l<<1|h<<2|u<<3].forEach(p);Go[l|h<<3].forEach(p)}i=-1,h=n[a*t]>=o,Go[h<<2].forEach(p);for(;++i<t-1;)u=h,h=n[a*t+i+1]>=o,Go[h<<2|u<<3].forEach(p);function p(t){var e,n,o=[t[0][0]+i,t[0][1]+a],c=[t[1][0]+i,t[1][1]+a],l=s(o),h=s(c);(e=f[l])?(n=d[h])?(delete f[e.end],delete d[n.start],e===n?(e.ring.push(c),r(e.ring)):d[e.start]=f[n.end]={start:e.start,end:n.end,ring:e.ring.concat(n.ring)}):(delete f[e.end],e.ring.push(c),f[e.end=h]=e):(e=d[h])?(n=f[l])?(delete d[e.start],delete f[n.end],e===n?(e.ring.push(c),r(e.ring)):d[n.start]=f[e.end]={start:n.start,end:e.end,ring:n.ring.concat(e.ring)}):(delete d[e.start],e.ring.unshift(o),d[e.start=l]=e):d[l]=f[h]={start:l,end:h,ring:[o,c]}}Go[h<<3].forEach(p)}(n,r,(function(t){o(t,n,r),function(t){for(var e=0,n=t.length,o=t[n-1][1]*t[0][0]-t[n-1][0]*t[0][1];++e<n;)o+=t[e-1][1]*t[e][0]-t[e-1][0]*t[e][1];return o}(t)>0?i.push([t]):a.push(t)})),a.forEach((function(t){for(var e,n=0,o=i.length;n<o;++n)if(-1!==Vo((e=i[n])[0],t))return void e.push(t)})),{type:"MultiPolygon",value:r,coordinates:i}}function s(e){return 2*e[0]+e[1]*(t+1)*4}function a(n,o,r){n.forEach((function(n){var i,s=n[0],a=n[1],c=0|s,l=0|a,h=o[l*t+c];s>0&&s<t&&c===s&&(i=o[l*t+c-1],n[0]=s+(r-i)/(h-i)-.5),a>0&&a<e&&l===a&&(i=o[(l-1)*t+c],n[1]=a+(r-i)/(h-i)-.5)}))}return r.contour=i,r.size=function(n){if(!arguments.length)return[t,e];var o=Math.floor(n[0]),i=Math.floor(n[1]);if(!(o>=0&&i>=0))throw new Error("invalid size");return t=o,e=i,r},r.thresholds=function(t){return arguments.length?(n="function"==typeof t?t:Array.isArray(t)?Lo(No.call(t)):Lo(t),r):n},r.smooth=function(t){return arguments.length?(o=t?a:Oo,r):o===a},r}function qo(t,e,n){for(var o=t.width,r=t.height,i=1+(n<<1),s=0;s<r;++s)for(var a=0,c=0;a<o+n;++a)a<o&&(c+=t.data[a+s*o]),a>=n&&(a>=i&&(c-=t.data[a-i+s*o]),e.data[a-n+s*o]=c/Math.min(a+1,o-1+i-a,i))}function jo(t,e,n){for(var o=t.width,r=t.height,i=1+(n<<1),s=0;s<o;++s)for(var a=0,c=0;a<r+n;++a)a<r&&(c+=t.data[s+a*o]),a>=n&&(a>=i&&(c-=t.data[s+(a-i)*o]),e.data[s+(a-n)*o]=c/Math.min(a+1,r-1+i-a,i))}function Wo(t){return t[0]}function $o(t){return t[1]}function Uo(){return 1}function Ho(){var t=Wo,e=$o,n=Uo,o=960,r=500,i=20,s=2,a=3*i,c=o+2*a>>s,l=r+2*a>>s,h=Lo(20);function u(o){var r=new Float32Array(c*l),u=new Float32Array(c*l),f=Math.pow(2,-s);o.forEach((function(o,i,s){var h=(t(o,i,s)+a)*f,u=(e(o,i,s)+a)*f,d=+n(o,i,s);if(h>=0&&h<c&&u>=0&&u<l){var p=Math.floor(h),g=Math.floor(u),m=h-p-.5,y=u-g-.5;r[p+g*c]+=(1-m)*(1-y)*d,r[p+1+g*c]+=m*(1-y)*d,r[p+1+(g+1)*c]+=m*y*d,r[p+(g+1)*c]+=(1-m)*y*d}})),qo({width:c,height:l,data:r},{width:c,height:l,data:u},i>>s),jo({width:c,height:l,data:u},{width:c,height:l,data:r},i>>s),qo({width:c,height:l,data:r},{width:c,height:l,data:u},i>>s),jo({width:c,height:l,data:u},{width:c,height:l,data:r},i>>s),qo({width:c,height:l,data:r},{width:c,height:l,data:u},i>>s),jo({width:c,height:l,data:u},{width:c,height:l,data:r},i>>s);var p=h(r);if(!Array.isArray(p)){var g=function(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n<e||void 0===n&&e>=e)&&(n=e);else{let o=-1;for(let r of t)null!=(r=e(r,++o,t))&&(n<r||void 0===n&&r>=r)&&(n=r)}return n}(r);p=To(0,g,p),(p=Mo(0,Math.floor(g/p)*p,p)).shift()}return Bo().thresholds(p).size([c,l])(r).map(d)}function d(t){return t.value*=Math.pow(2,-2*s),t.coordinates.forEach(f),t}function f(t){t.forEach(p)}function p(t){t.forEach(g)}function g(t){t[0]=t[0]*Math.pow(2,s)-a,t[1]=t[1]*Math.pow(2,s)-a}function m(){return c=o+2*(a=3*i)>>s,l=r+2*a>>s,u}return u.x=function(e){return arguments.length?(t="function"==typeof e?e:Lo(+e),u):t},u.y=function(t){return arguments.length?(e="function"==typeof t?t:Lo(+t),u):e},u.weight=function(t){return arguments.length?(n="function"==typeof t?t:Lo(+t),u):n},u.size=function(t){if(!arguments.length)return[o,r];var e=+t[0],n=+t[1];if(!(e>=0&&n>=0))throw new Error("invalid size");return o=e,r=n,m()},u.cellSize=function(t){if(!arguments.length)return 1<<s;if(!((t=+t)>=1))throw new Error("invalid cell size");return s=Math.floor(Math.log(t)/Math.LN2),m()},u.thresholds=function(t){return arguments.length?(h="function"==typeof t?t:Array.isArray(t)?Lo(No.call(t)):Lo(t),u):h},u.bandwidth=function(t){if(!arguments.length)return Math.sqrt(i*(i+1));if(!((t=+t)>=0))throw new Error("invalid bandwidth");return i=Math.round((Math.sqrt(4*t*t+1)-1)/2),m()},u}class zo{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const e=this._partials;let n=0;for(let o=0;o<this._n&&o<32;o++){const r=e[o],i=t+r,s=Math.abs(t)<Math.abs(r)?t-(i-r):r-(i-t);s&&(e[n++]=s),t=i}return e[n]=t,this._n=n+1,this}valueOf(){const t=this._partials;let e,n,o,r=this._n,i=0;if(r>0){for(i=t[--r];r>0&&(e=i,n=t[--r],i=e+n,o=n-(i-e),!o););r>0&&(o<0&&t[r-1]<0||o>0&&t[r-1]>0)&&(n=2*o,e=i+n,n==e-i&&(i=e))}return i}}function Xo(t){return Array.from(function*(t){for(const e of t)yield*e}(t))}var Yo=1e-6,Jo=1e-12,Ko=Math.PI,Zo=Ko/2,Qo=Ko/4,tr=2*Ko,er=Ko/180,nr=Math.abs,or=Math.atan,rr=Math.atan2,ir=Math.cos,sr=(Math.ceil,Math.exp),ar=(Math.hypot,Math.log),cr=(Math.pow,Math.sin),lr=Math.sign||function(t){return t>0?1:t<0?-1:0},hr=Math.sqrt,ur=Math.tan;function dr(t){return t>1?0:t<-1?Ko:Math.acos(t)}function fr(t){return t>1?Zo:t<-1?-Zo:Math.asin(t)}function pr(){}function gr(t,e){t&&yr.hasOwnProperty(t.type)&&yr[t.type](t,e)}var mr={Feature:function(t,e){gr(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,o=-1,r=n.length;++o<r;)gr(n[o].geometry,e)}},yr={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,o=-1,r=n.length;++o<r;)t=n[o],e.point(t[0],t[1],t[2])},LineString:function(t,e){wr(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,o=-1,r=n.length;++o<r;)wr(n[o],e,0)},Polygon:function(t,e){vr(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,o=-1,r=n.length;++o<r;)vr(n[o],e)},GeometryCollection:function(t,e){for(var n=t.geometries,o=-1,r=n.length;++o<r;)gr(n[o],e)}};function wr(t,e,n){var o,r=-1,i=t.length-n;for(e.lineStart();++r<i;)o=t[r],e.point(o[0],o[1],o[2]);e.lineEnd()}function vr(t,e){var n=-1,o=t.length;for(e.polygonStart();++n<o;)wr(t[n],e,1);e.polygonEnd()}function _r(t,e){t&&mr.hasOwnProperty(t.type)?mr[t.type](t,e):gr(t,e)}new zo,new zo;function xr(t){var e=t[0],n=t[1],o=ir(n);return[o*ir(e),o*cr(e),cr(n)]}function br(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function Sr(t){var e=hr(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}function Cr(t,e){return[nr(t)>Ko?t+Math.round(-t/tr)*tr:t,e]}function Mr(){var t,e=[];return{point:function(e,n,o){t.push([e,n,o])},lineStart:function(){e.push(t=[])},lineEnd:pr,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function Ar(t,e){return nr(t[0]-e[0])<Yo&&nr(t[1]-e[1])<Yo}function Er(t,e,n,o){this.x=t,this.z=e,this.o=n,this.e=o,this.v=!1,this.n=this.p=null}function kr(t,e,n,o,r){var i,s,a=[],c=[];if(t.forEach((function(t){if(!((e=t.length-1)<=0)){var e,n,o=t[0],s=t[e];if(Ar(o,s)){if(!o[2]&&!s[2]){for(r.lineStart(),i=0;i<e;++i)r.point((o=t[i])[0],o[1]);return void r.lineEnd()}s[0]+=2e-6}a.push(n=new Er(o,t,null,!0)),c.push(n.o=new Er(o,null,n,!1)),a.push(n=new Er(s,t,null,!1)),c.push(n.o=new Er(s,null,n,!0))}})),a.length){for(c.sort(e),Pr(a),Pr(c),i=0,s=c.length;i<s;++i)c[i].e=n=!n;for(var l,h,u=a[0];;){for(var d=u,f=!0;d.v;)if((d=d.n)===u)return;l=d.z,r.lineStart();do{if(d.v=d.o.v=!0,d.e){if(f)for(i=0,s=l.length;i<s;++i)r.point((h=l[i])[0],h[1]);else o(d.x,d.n.x,1,r);d=d.n}else{if(f)for(l=d.p.z,i=l.length-1;i>=0;--i)r.point((h=l[i])[0],h[1]);else o(d.x,d.p.x,-1,r);d=d.p}l=(d=d.o).z,f=!f}while(!d.v);r.lineEnd()}}}function Pr(t){if(e=t.length){for(var e,n,o=0,r=t[0];++o<e;)r.n=n=t[o],n.p=r,r=n;r.n=n=t[0],n.p=r}}function Tr(t){return nr(t[0])<=Ko?t[0]:lr(t[0])*((nr(t[0])+Ko)%tr-Ko)}function Fr(t,e){var n=Tr(e),o=e[1],r=cr(o),i=[cr(n),-ir(n),0],s=0,a=0,c=new zo;1===r?o=Zo+Yo:-1===r&&(o=-Zo-Yo);for(var l=0,h=t.length;l<h;++l)if(d=(u=t[l]).length)for(var u,d,f=u[d-1],p=Tr(f),g=f[1]/2+Qo,m=cr(g),y=ir(g),w=0;w<d;++w,p=_,m=b,y=S,f=v){var v=u[w],_=Tr(v),x=v[1]/2+Qo,b=cr(x),S=ir(x),C=_-p,M=C>=0?1:-1,A=M*C,E=A>Ko,k=m*b;if(c.add(rr(k*M*cr(A),y*S+k*ir(A))),s+=E?C+M*tr:C,E^p>=n^_>=n){var P=br(xr(f),xr(v));Sr(P);var T=br(i,P);Sr(T);var F=(E^C>=0?-1:1)*fr(T[2]);(o>F||o===F&&(P[0]||P[1]))&&(a+=E^C>=0?1:-1)}}return(s<-1e-6||s<Yo&&c<-1e-12)^1&a}function Nr(t,e,n,o){return function(r){var i,s,a,c=e(r),l=Mr(),h=e(l),u=!1,d={point:f,lineStart:g,lineEnd:m,polygonStart:function(){d.point=y,d.lineStart=w,d.lineEnd=v,s=[],i=[]},polygonEnd:function(){d.point=f,d.lineStart=g,d.lineEnd=m,s=Xo(s);var t=Fr(i,o);s.length?(u||(r.polygonStart(),u=!0),kr(s,Lr,t,n,r)):t&&(u||(r.polygonStart(),u=!0),r.lineStart(),n(null,null,1,r),r.lineEnd()),u&&(r.polygonEnd(),u=!1),s=i=null},sphere:function(){r.polygonStart(),r.lineStart(),n(null,null,1,r),r.lineEnd(),r.polygonEnd()}};function f(e,n){t(e,n)&&r.point(e,n)}function p(t,e){c.point(t,e)}function g(){d.point=p,c.lineStart()}function m(){d.point=f,c.lineEnd()}function y(t,e){a.push([t,e]),h.point(t,e)}function w(){h.lineStart(),a=[]}function v(){y(a[0][0],a[0][1]),h.lineEnd();var t,e,n,o,c=h.clean(),d=l.result(),f=d.length;if(a.pop(),i.push(a),a=null,f)if(1&c){if((e=(n=d[0]).length-1)>0){for(u||(r.polygonStart(),u=!0),r.lineStart(),t=0;t<e;++t)r.point((o=n[t])[0],o[1]);r.lineEnd()}}else f>1&&2&c&&d.push(d.pop().concat(d.shift())),s.push(d.filter(Dr))}return d}}function Dr(t){return t.length>1}function Lr(t,e){return((t=t.x)[0]<0?t[1]-Zo-Yo:Zo-t[1])-((e=e.x)[0]<0?e[1]-Zo-Yo:Zo-e[1])}Cr.invert=Cr;Nr((function(){return!0}),(function(t){var e,n=NaN,o=NaN,r=NaN;return{lineStart:function(){t.lineStart(),e=1},point:function(i,s){var a=i>0?Ko:-Ko,c=nr(i-n);nr(c-Ko)<Yo?(t.point(n,o=(o+s)/2>0?Zo:-Zo),t.point(r,o),t.lineEnd(),t.lineStart(),t.point(a,o),t.point(i,o),e=0):r!==a&&c>=Ko&&(nr(n-r)<Yo&&(n-=r*Yo),nr(i-a)<Yo&&(i-=a*Yo),o=function(t,e,n,o){var r,i,s=cr(t-n);return nr(s)>Yo?or((cr(e)*(i=ir(o))*cr(n)-cr(o)*(r=ir(e))*cr(t))/(r*i*s)):(e+o)/2}(n,o,i,s),t.point(r,o),t.lineEnd(),t.lineStart(),t.point(a,o),e=0),t.point(n=i,o=s),r=a},lineEnd:function(){t.lineEnd(),n=o=NaN},clean:function(){return 2-e}}}),(function(t,e,n,o){var r;if(null==t)r=n*Zo,o.point(-Ko,r),o.point(0,r),o.point(Ko,r),o.point(Ko,0),o.point(Ko,-r),o.point(0,-r),o.point(-Ko,-r),o.point(-Ko,0),o.point(-Ko,r);else if(nr(t[0]-e[0])>Yo){var i=t[0]<e[0]?Ko:-Ko;r=n*i/2,o.point(-i,r),o.point(0,r),o.point(i,r)}else o.point(e[0],e[1])}),[-Ko,-Zo]);var Vr,Ir,Rr,Or,Gr=t=>t,Br=new zo,qr=new zo,jr={point:pr,lineStart:pr,lineEnd:pr,polygonStart:function(){jr.lineStart=Wr,jr.lineEnd=Hr},polygonEnd:function(){jr.lineStart=jr.lineEnd=jr.point=pr,Br.add(nr(qr)),qr=new zo},result:function(){var t=Br/2;return Br=new zo,t}};function Wr(){jr.point=$r}function $r(t,e){jr.point=Ur,Vr=Rr=t,Ir=Or=e}function Ur(t,e){qr.add(Or*t-Rr*e),Rr=t,Or=e}function Hr(){Ur(Vr,Ir)}var zr=1/0,Xr=zr,Yr=-zr,Jr=Yr,Kr={point:function(t,e){t<zr&&(zr=t);t>Yr&&(Yr=t);e<Xr&&(Xr=e);e>Jr&&(Jr=e)},lineStart:pr,lineEnd:pr,polygonStart:pr,polygonEnd:pr,result:function(){var t=[[zr,Xr],[Yr,Jr]];return Yr=Jr=-(Xr=zr=1/0),t}};var Zr,Qr,ti,ei,ni=0,oi=0,ri=0,ii=0,si=0,ai=0,ci=0,li=0,hi=0,ui={point:di,lineStart:fi,lineEnd:mi,polygonStart:function(){ui.lineStart=yi,ui.lineEnd=wi},polygonEnd:function(){ui.point=di,ui.lineStart=fi,ui.lineEnd=mi},result:function(){var t=hi?[ci/hi,li/hi]:ai?[ii/ai,si/ai]:ri?[ni/ri,oi/ri]:[NaN,NaN];return ni=oi=ri=ii=si=ai=ci=li=hi=0,t}};function di(t,e){ni+=t,oi+=e,++ri}function fi(){ui.point=pi}function pi(t,e){ui.point=gi,di(ti=t,ei=e)}function gi(t,e){var n=t-ti,o=e-ei,r=hr(n*n+o*o);ii+=r*(ti+t)/2,si+=r*(ei+e)/2,ai+=r,di(ti=t,ei=e)}function mi(){ui.point=di}function yi(){ui.point=vi}function wi(){_i(Zr,Qr)}function vi(t,e){ui.point=_i,di(Zr=ti=t,Qr=ei=e)}function _i(t,e){var n=t-ti,o=e-ei,r=hr(n*n+o*o);ii+=r*(ti+t)/2,si+=r*(ei+e)/2,ai+=r,ci+=(r=ei*t-ti*e)*(ti+t),li+=r*(ei+e),hi+=3*r,di(ti=t,ei=e)}function xi(t){this._context=t}xi.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(t,e){switch(this._point){case 0:this._context.moveTo(t,e),this._point=1;break;case 1:this._context.lineTo(t,e);break;default:this._context.moveTo(t+this._radius,e),this._context.arc(t,e,this._radius,0,tr)}},result:pr};var bi,Si,Ci,Mi,Ai,Ei=new zo,ki={point:pr,lineStart:function(){ki.point=Pi},lineEnd:function(){bi&&Ti(Si,Ci),ki.point=pr},polygonStart:function(){bi=!0},polygonEnd:function(){bi=null},result:function(){var t=+Ei;return Ei=new zo,t}};function Pi(t,e){ki.point=Ti,Si=Mi=t,Ci=Ai=e}function Ti(t,e){Mi-=t,Ai-=e,Ei.add(hr(Mi*Mi+Ai*Ai)),Mi=t,Ai=e}function Fi(){this._string=[]}function Ni(t){return"m0,"+t+"a"+t+","+t+" 0 1,1 0,"+-2*t+"a"+t+","+t+" 0 1,1 0,"+2*t+"z"}function Di(t,e){var n,o,r=4.5;function i(t){return t&&("function"==typeof r&&o.pointRadius(+r.apply(this,arguments)),_r(t,n(o))),o.result()}return i.area=function(t){return _r(t,n(jr)),jr.result()},i.measure=function(t){return _r(t,n(ki)),ki.result()},i.bounds=function(t){return _r(t,n(Kr)),Kr.result()},i.centroid=function(t){return _r(t,n(ui)),ui.result()},i.projection=function(e){return arguments.length?(n=null==e?(t=null,Gr):(t=e).stream,i):t},i.context=function(t){return arguments.length?(o=null==t?(e=null,new Fi):new xi(e=t),"function"!=typeof r&&o.pointRadius(r),i):e},i.pointRadius=function(t){return arguments.length?(r="function"==typeof t?t:(o.pointRadius(+t),+t),i):r},i.projection(t).context(e)}function Li(t){return function(e){var n=new Vi;for(var o in t)n[o]=t[o];return n.stream=e,n}}function Vi(){}Fi.prototype={_radius:4.5,_circle:Ni(4.5),pointRadius:function(t){return(t=+t)!==this._radius&&(this._radius=t,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(t,e){switch(this._point){case 0:this._string.push("M",t,",",e),this._point=1;break;case 1:this._string.push("L",t,",",e);break;default:null==this._circle&&(this._circle=Ni(this._radius)),this._string.push("M",t,",",e,this._circle)}},result:function(){if(this._string.length){var t=this._string.join("");return this._string=[],t}return null}},Vi.prototype={constructor:Vi,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};ir(30*er);Li({point:function(t,e){this.stream.point(t*er,e*er)}});function Ii(t){return function(e,n){var o=ir(e),r=ir(n),i=t(o*r);return i===1/0?[2,0]:[i*r*cr(e),i*cr(n)]}}function Ri(t){return function(e,n){var o=hr(e*e+n*n),r=t(o),i=cr(r),s=ir(r);return[rr(e*i,o*s),fr(o&&n*i/o)]}}var Oi=Ii((function(t){return hr(2/(1+t))}));Oi.invert=Ri((function(t){return 2*fr(t/2)}));var Gi=Ii((function(t){return(t=dr(t))&&t/cr(t)}));function Bi(t,e){return[t,ar(ur((Zo+e)/2))]}function qi(t,e){return[t,e]}Gi.invert=Ri((function(t){return t})),Bi.invert=function(t,e){return[t,2*or(sr(e))-Zo]},qi.invert=qi;var ji=1.340264,Wi=-.081106,$i=893e-6,Ui=.003796,Hi=hr(3)/2;function zi(t,e){var n=fr(Hi*cr(e)),o=n*n,r=o*o*o;return[t*ir(n)/(Hi*(ji+-.24331799999999998*o+r*(.0062510000000000005+.034164*o))),n*(ji+Wi*o+r*($i+Ui*o))]}function Xi(t,e){var n=ir(e),o=ir(t)*n;return[n*cr(t)/o,cr(e)/o]}function Yi(t,e){var n=e*e,o=n*n;return[t*(.8707-.131979*n+o*(o*(.003971*n-.001529*o)-.013791)),e*(1.007226+n*(.015085+o*(.028874*n-.044475-.005916*o)))]}function Ji(t,e){return[ir(e)*cr(t),cr(e)]}function Ki(t,e){var n=ir(e),o=1+ir(t)*n;return[n*cr(t)/o,cr(e)/o]}function Zi(t,e){return[ar(ur((Zo+e)/2)),-t]}function Qi(t,e,n,o,r){const i=this,{dimensions:s}=r.election,a=1===s?eo:no;t.setRenderer((t=>new a(t,n))),e.setRenderer((t=>new a(t,n))),i.update=function(t){const{pointsChanged:e,points:n}=t;e&&i.updatePoints(n)},i.render=()=>{i.renderCans(),t.render(),e.render()};let c;i.updatePoints=function(t){const e=t.length/1e4,n=F(20).map((t=>t*e)),o=Ho().x((t=>t.x)).y((t=>t.y)).bandwidth(10).thresholds(n);c=o(t)},i.renderCans=()=>{const{ctx:t,darkMode:e}=n,o=Di().context(t);t.save(),t.lineWidth=.5,t.strokeStyle="#aaa";const r=c.length;for(let n=0;n<r;n++){const r=255-10*n,i=e?255-r+33:r;t.fillStyle=`rgba(${i},${i},${i}, 1)`,t.beginPath(),o(c[n]),t.fill()}t.restore()}}function ts(t){const e=this;e.canDn=t,e.setRenderer=n=>{e.renderer=n(t)}}function es(t){const e=this,n=[];e.rendererMaker=()=>({render:()=>{}}),t.attachNewE(e),e.updateNewE=t=>{e.newCandidateDn(t)},e.newCandidateDn=function(t){const o=new ts(t);n.push(o),o.setRenderer(e.rendererMaker)},e.getCanDnRenderers=()=>n.filter((t=>t.canDn.exists)),e.getCandidateDistributions=()=>e.getCanDnRenderers().map((t=>t.canDn)),e.getCandidateDistributionsAll=()=>n.map((t=>t.canDn)),e.setRenderer=t=>{e.rendererMaker=t,n.forEach((e=>e.setRenderer(t)))},e.render=()=>{n.forEach((t=>{t.canDn.exists&&t.renderer.render()}))}}function ns(t,e,n,o,r,i){const s=this;r.sims.sample.pub.attach(s),_o.call(s,e,o,i);const{candidateDnList:a,voterShapeList:c}=t,l=new bo(c),h=new es(a);let u;function d(){const t=1===r.election.dimensions?Co:Qi;u=new t(l,h,e,o,r)}d(),s.enter=()=>{d()},s.exit=()=>{},s.update=t=>{u.update(t);const{pointsChanged:n}=t;n&&(e.clear(),s.render())},s.render=()=>{u.render()}}function os(t,e){const n=this;function o(n){const{mctx:o}=t,{centroids:r,polygonAreas:i}=e,s=r[n];mo(i[n].toFixed(0),s[0],s[1]+.5-.2,1,.2,"#222",1,o)}n.renderVoronoi=(t,e)=>{n.renderVoronoiGeneral(0,0,t,e,null,o)},n.renderVoronoiColors=(t,e,o,r,i)=>{n.renderVoronoiGeneral(t,e,o,r,i,void 0)},n.renderVoronoiGeneral=(n,o,r,i,s,a)=>{const{mctx:c}=t,{voronoi:l,nx:h,ny:u,nd:d}=e;c.save();const f=r/h,p=i/u;c.translate(n,o),c.scale(f,p);for(let t=0;t<d;t++)c.beginPath(),c.strokeStyle="#333",c.lineWidth=1/f,l.renderCell(t,c),null!==s&&(c.fillStyle=s[t],c.fill()),c.stroke(),void 0!==a&&a(t);c.restore()}}function rs(t,e,n){const{resultsByTract:o,resultsByDistrict:r}=t,i=e.getCandidates(),s=function(t,e){const n=e.map((t=>t.colorRGBA)),o=t.map((t=>t.map((t=>{const{tallyFractions:e}=t.votes;return Yn(e,n)}))));return o}(o,i),a=function(t,e,n){let o;if("singleWinner"===n.election.socialChoice.checkElectionType())o=t.map((t=>t.winner.color));else{const n=e.map((t=>t.colorRGBA));o=t.map((t=>{const{allocation:e}=t,o=e.reduce(((t,e)=>t+e));return Jn(Yn(e.map((t=>t/o)),n))}))}return o}(r,i,n),c=function(t,e){const n=t.map((t=>{const{tallyFractions:n}=t.votes;return Jn(Yn(n,e.map((t=>t.colorRGBA))))}));return n}(r,i);return{colorByTract:s,colorOfVoteByDistrict:c,colorOfWinsByDistrict:a}}function is(t,e,n){const o=this,r=document.createElement("canvas");r.width=t,r.height=e;const i=r.getContext("2d"),s=i.createImageData(t,e);o.load=n=>{const{data:o}=s;for(let r=0;r<t;r++)for(let i=0;i<e;i++){const e=n[r][i][0]+.5,s=n[r][i][1]+.5;o[4*(r+i*t)+0]=255*e,o[4*(r+i*t)+1]=200*(e+s),o[4*(r+i*t)+2]=200*s,o[4*(r+i*t)+3]=255}i.putImageData(s,0,0)},o.loadColors=n=>{const{data:o}=s;for(let r=0;r<e;r++)for(let e=0;e<t;e++){const i=n[e][r],[s,a,c]=i;o[4*(e+r*t)+0]=s,o[4*(e+r*t)+1]=a,o[4*(e+r*t)+2]=c,o[4*(e+r*t)+3]=255}i.putImageData(s,0,0)},o.render=(t,e)=>{const{mctx:o}=n;o.save(),o.imageSmoothingEnabled=!1,o.drawImage(r,0,0,t,e),o.restore()}}function ss(t,e,n,o){const r=this,{districtMaker:i}=t;r.districtDraw=new os(n,i),r.noiseImage=new is(t.nx,t.ny,n),r.update=t=>{const n=rs(t,e,o),{colorByTract:i,colorOfVoteByDistrict:s,colorOfWinsByDistrict:a}=n;r.colorOfVoteByDistrict=s,r.winnerColors=a,r.noiseImage.loadColors(i)};const s=100,a=100;r.render=()=>{r.renderTractVotes(),r.renderDistrictWins(),r.renderDistrictVotes()},r.renderTractVotes=()=>{r.noiseImage.render(s,a),r.districtDraw.renderVoronoi(s,a)},r.renderDistrictWins=()=>{const{renderVoronoiColors:t}=r.districtDraw;t(200,0,s,a,r.winnerColors)},r.renderDistrictVotes=()=>{const{renderVoronoiColors:t}=r.districtDraw;t(100,0,s,a,r.colorOfVoteByDistrict)}}function as(t,e,n){const o=this;n.sims.one.pub.attach(o);const r=new ss(n.voterGeo,t.candidateList,e,n);let i=!1;o.enter=()=>{n.geo&&e.showMaps()},o.exit=()=>{e.hideMaps()},o.update=function(t){const{error:e}=t;void 0===e?(i=!1,n.geo&&(r.update(t),o.render())):i=!0},o.render=function(){i||n.geo&&r.render()}}function cs(t,e){const n=n=>{if(!t.contains(n.target)&&((r=t)&&(r.offsetWidth||r.offsetHeight||r.getClientRects().length))){e()&&o()}var r},o=()=>{document.removeEventListener("mousedown",n),document.removeEventListener("touchstart",n)};document.addEventListener("mousedown",n),document.addEventListener("touchstart",n)}function ls(t,e){const n=document.createElement("div");function o(){const{x:o,y:r}=t;o>.5*e.width?(n.style.right=e.width-o+"px",n.style.left="unset"):(n.style.left=`${o}px`,n.style.right="unset"),n.style.top=`${r}px`}n.className="tooltipBox",n.style.position="absolute",o(),n.style.border=e.darkMode?"1px solid white":"1px solid black",n.style.padding="8px",n.style.background=e.darkMode?"#222":"white";let r=!1;return cs(n,(()=>!r&&(n.remove(),!0))),{box:n,update:o,setPin:t=>{r=t}}}function hs(t,e,n,o,r){const i=ls(t,n),{box:s}=i;s.innerText="- Properties -";const a={};a.exists=new us("checkbox","Exists","Exists: ",(t=>e.setE(t?1:0)),1===e.exists),s.appendChild(a.exists.div),1===o.dimensions?(e.shape1.w&&(a.w1=new us("range","Width","Width: ",(t=>e.setW1(t)),e.shape1.w),s.appendChild(a.w1.div)),e.shape1.densityProfile&&(a.densityProfile1=new us("select","Density Profile","Density Profile: ",(t=>e.setDensityProfile1(t)),e.shape1.densityProfile,["step","gaussian"]),s.appendChild(a.densityProfile1.div))):e.shape2.w&&(a.w2=new us("range","Width","Width: ",(t=>e.setW2(t)),e.shape2.w),s.appendChild(a.w2.div)),void 0!==e.setColor&&(a.color=new us("color","Color","Color: ",(t=>e.setColor(t)),e.color),s.appendChild(a.color.div)),void 0!==e.setParty&&(a.party=new us("select","Party","Party: ",(t=>e.setParty([Number(t)])),e.party,[0,1,2,3,4,5,6,7,8,9]),s.appendChild(a.party.div)),a.showGhosts=new us("checkbox","Show Ghosts","Show Ghosts: ",(t=>r.setShowNonExistingEntities(t)),r.showGhosts),s.appendChild(a.showGhosts.div),n.tooltips.appendChild(s)}function us(t,e,n,o,r,i){const s=this;if(s.div=document.createElement("div"),"select"===t){s.input=document.createElement("select");for(let t=0;t<i.length;t++){const e=document.createElement("option");e.value=i[t],e.innerText=i[t],s.input.appendChild(e)}s.input.value=r,s.input.addEventListener("input",(()=>o(s.input.value)))}else s.input=document.createElement("input"),s.input.type=t,s.input.id=e,s.input.name=e,"checkbox"===t?(r&&(s.input.checked=!0),s.input.addEventListener("change",(()=>o(s.input.checked)))):"range"===t?(s.input.min=1,s.input.max=300,s.input.value=r,s.input.step=1,s.input.addEventListener("input",(()=>o(s.input.value)))):"color"===t&&(s.input.value=r,s.input.addEventListener("input",(()=>o(s.input.value))));s.label=document.createElement("label"),s.label.for=e,s.label.innerText=n,s.label.style["margin-right"]="4px",s.div.appendChild(s.label),s.div.appendChild(s.input)}function ds(t,e,n){const o=this;o.setXYView=e=>{1===n.dimensions?t.setXY1(e):t.setXY2(e),o.updateViewXY()},o.updateViewXY=()=>{1===n.dimensions?(o.x=t.shape1.x,o.y=250):(o.x=t.shape2.x,o.y=t.shape2.y)}}function fs(t,e,n,o,r){const i=this;i.w=n,i.h=o,i.trueW=n,i.trueH=o,i.angleFraction=0,i.pickUp=function(){i.tweenSq=new bn(i),i.tweenSq.to({w:i.trueW+10,h:i.trueH+10},100),i.tweenSq.start()},i.drop=function(){i.tweenSq=new bn(i),i.tweenSq.to({w:i.trueW,h:i.trueH},100),i.tweenSq.start()},i.win=function(){i.tweenSq=new bn(i),i.tweenSq.to({angleFraction:.25},300),i.tweenSq.start()},i.lose=function(){i.tweenSq=new bn(i),i.tweenSq.to({angleFraction:-.25},300),i.tweenSq.start()},i.render=function(){const{fctx:n,darkMode:o}=r;n.save(),i.tweenSq&&i.tweenSq.update(),0===e.exists&&(n.globalAlpha=.2),0!==i.angleFraction&&(n.translate(t.x,t.y),n.rotate(i.angleFraction*Math.PI*2),n.translate(-t.x,-t.y)),n.beginPath(),n.fillStyle=e.color,o&&e.darkModeColor&&(n.fillStyle=e.darkModeColor),o&&(n.strokeStyle="white"),n.rect(t.x-.5*i.w-.5,t.y-.5*i.h-.5,i.w+1,i.h+1),n.fill(),n.stroke(),n.restore()}}function ps(t,e,n,o,r,i){const s=this,a=new fs(s,t,o,r,e);s.square=a,ds.call(s,t,e,n),s.fraction=0,s.setFraction=function(t){s.fraction=t},s.wins=0,s.setWins=t=>{s.wins!==t&&(t>s.wins?a.win():s.wins>t&&a.lose()),s.wins=t},s.renderForeground=function(){a.render();const{exists:o,party:r}=t,{x:i,y:c}=s,{fctx:l,darkMode:h}=e,u=h?"#fff":"#222";if(0===o)return;const d=c-.5*a.h-2;if(mo(yo(s.fraction),i,d,20,2,u,1,l),void 0!==s.wins){const t=c+.5*a.h+20+2;mo(s.wins,i,t,20,2,u,1,l)}if("olprA"===n.socialChoice.electionMethod){mo(`p${r}`,i+.1*a.w,c+8,13,2,u,1,l)}},s.click=()=>{hs(s,t,e,n,i)}}function gs(t,e,n,o,r,i){this.candidate=t,this.graphic=new ps(t,e,n,o,r,i)}function ms(t,e,n,o){const r=this,i=[],s=[];r.attachNewG=t=>{s.push(t)};e.attachNewE(r),r.updateNewE=t=>{r.newCandidate(t)},r.newCandidate=function(e){const r=new gs(e,n,o,21,21,t);var a;i.push(r),a=r,s.forEach((t=>t.updateNewG(a)))},r.getCanViews=()=>i.filter((t=>t.candidate.exists)),r.getCandidates=()=>r.getCanViews().map((t=>t.candidate)),r.getCandidatesAll=()=>i.map((t=>t.candidate)),r.setCandidateFractions=t=>{r.getCanViews().forEach(((e,n)=>{const o=t[n];e.graphic.setFraction(o)}))},r.setCandidateWins=t=>{r.getCanViews().forEach(((e,n)=>{const o=t[n];e.graphic.setWins(o)}))},r.unsetCandidateWins=()=>{const t=i.length,e=Array(t).fill(void 0);r.setCandidateWins(e)},r.updateViewXY=()=>{i.forEach((t=>t.graphic.updateViewXY()))},r.renderForeground=()=>{t.showGhosts?r.renderForegroundAll():r.renderForegroundExisting()},r.renderForegroundExisting=()=>{r.getCanViews().forEach((t=>t.graphic.renderForeground()))},r.renderForegroundAll=()=>{i.forEach((t=>t.graphic.renderForeground()))}}function ys(t,e,n,o){const r=this;r.r=n,r.trueR=n,r.pickUp=function(){r.tween=new bn(r),r.tween.to({r:2*r.trueR},100),r.tween.start()},r.drop=function(){r.tween=new bn(r),r.tween.to({r:r.trueR},100),r.tween.start()},r.render=function(){const{fctx:n,darkMode:i}=o,{color:s}=e;n.save(),r.tween&&r.tween.update(),0===e.exists&&(n.globalAlpha=.2),n.beginPath(),n.fillStyle=s,i&&(n.strokeStyle="white"),n.arc(t.x,t.y,r.r,0,2*Math.PI),n.fill(),n.stroke(),n.restore()}}function ws(t,e,n,o){const r=this,i=new ys(r,t,13,e);r.circle=i,ds.call(r,t,e,n),r.renderForeground=()=>{i.render()},r.setRenderer=e=>{r.renderer=e(t)},r.click=()=>{hs(r,t,e,n,o)}}function vs(t,e,n,o){this.voterShape=t,this.graphic=new ws(t,e,n,o)}function _s(t,e,n,o){const r=this,i=[];r.list=i;const s=[];r.attachNewG=t=>{s.push(t)};e.attachNewE(r),r.updateNewE=t=>{r.newVoterShape(t)},r.newVoterShape=function(e){const r=new vs(e,n,o,t);var a;i.push(r),a=r,s.forEach((t=>t.updateNewG(a)))},r.getVoterShapes=()=>i.filter((t=>t.voterShape.exists)).map((t=>t.voterShape)),r.getVoterViews=()=>i.filter((t=>t.voterShape.exists)),r.updateViewXY=()=>{i.forEach((t=>t.graphic.updateViewXY()))},r.renderForeground=()=>{t.showGhosts?r.renderForegroundAll():r.renderForegroundExisting()},r.renderForegroundExisting=()=>{i.forEach((t=>{t.voterShape.exists&&t.graphic.renderForeground()}))},r.renderForegroundAll=()=>{i.forEach((t=>{t.graphic.renderForeground()}))}}function xs(t){const{allocation:e,votes:n}=t,{tallyFractions:o}=n;if(void 0===e){const e=o.length,n=Array(e).fill(0);return n[t.iWinner]=1,{tallyFractions:o,allocation:n}}return{tallyFractions:o,allocation:e}}function bs(t){const e=document.createElement("div");t.append(e),this.update=(t,n,o)=>{const r=t=>`<span style="color:${t};">&#9632;</span>`;t.ranking?e.innerHTML=t.ranking.map(((t,e)=>r(o[e])+t)).join("<br />"):t.tallyFractions&&(e.innerHTML=t.tallyFractions.map(yo).map(((t,e)=>r(o[e])+t)).join("<br />"))}}function Ss(t,e){const n=ls(t,e),{box:o,setPin:r}=n;o.innerText="Vote",o.style["min-width"]="100px";const i=document.createElement("button");i.style["min-width"]="35px",i.style.float="right",i.style.clear="right",i.onclick=()=>{a()};let s=!0;function a(){s=!s,r(s),i.innerHTML=s?"&#x1F6AB;":"&#x1F4CC;"}a();const c=document.createElement("button");c.style.float="right",c.style["min-width"]="35px",c.style["font-size"]="10px",c.innerHTML="&#x2573;",c.onclick=()=>{o.remove(),t.setE(0)},o.appendChild(c),o.appendChild(i);const l=new bs(o);return e.tooltips.appendChild(o),{box:o,update:function(t,e,o){n.update(),l.update(t,e,o)}}}function Cs(t,e,n,o){const r=this;function i(){n.voterTest.setE(0)}r.shape1={},r.shape2={},r.setAction={},r.setAction.exists=t=>{r.exists=t},r.setE=t=>{r.setAction.exists(t)},r.setAction.shape2p=t=>{r.shape2.x=t.x,r.shape2.y=t.y},r.setAction.shape1x=t=>{r.shape1.x=t},r.setXY1=t=>{r.setAction.shape1x(t.x),n.testVoteView()},r.setXY2=t=>{r.setAction.shape2p(t),n.testVoteView()},r.setAction.shape1x(0),r.setAction.shape2p({x:0,y:0}),r.start=e=>{n.voterTest.setE(1),n.voterTest.setXYView(e),cs(t.wrap,i)},r.color="#999";const s=new ys(r,r,9,t);r.circle=s,ds.call(r,r,t,e.election),n.dragm.add(r);let a={};r.update=(t,e)=>{if(void 0===t)return null;const n=e.getCandidates(),o=n.map((t=>t.color)),i=n.map((t=>t.colorRGBA));r.colorSet=o;const{tallyFractions:s}=t;return r.color=Jn(Yn(s,i)),a.box&&a.update(t,r.color,r.colorSet),t},r.click=()=>{const e=n.testVoteView();null!==e&&(a.box&&a.box.remove(),a=Ss(r,t),a.update(e,r.color,r.colorSet))},r.renderForeground=()=>{(r.exists||o.showGhosts)&&s.render()}}function Ms(t,e,n,o,r,i){const s=this;r.sims.one.pub.attach(s),_o.call(s,e,o,i);const{candidateList:a,voterShapeList:c}=t,{election:l}=r,h=new ms(i,a,e,l),u=new _s(i,c,e,l);h.attachNewG(s.dragm),u.attachNewG(s.dragm),s.voterTest=new Cs(e,r,s,i);const d=s.enter;s.enter=()=>{d(),a.canButton.show(),u.updateViewXY(),h.updateViewXY(),s.voterTest.updateViewXY()},s.exit=()=>{h.unsetCandidateWins(),a.canButton.hide(),s.voterTest.setE(0)},s.update=t=>{if(o.checkNone())return;o.check(["draggables"])&&(u.updateViewXY(),h.updateViewXY());const{error:e}=t;if(void 0===e)if(r.geo){const{resultsStatewide:e,allocation:n}=t;h.setCandidateWins(n),h.setCandidateFractions(e.votes.tallyFractions)}else{const{tallyFractions:e,allocation:n}=xs(t);h.setCandidateWins(n),h.setCandidateFractions(e)}s.testVoteView()},s.clickEmpty=t=>{s.voterTest.start(t)},s.testVoteView=()=>{const t=l.testVoteE(s.voterTest,a);return s.voterTest.update(t,a),t},s.renderForeground=()=>{u.renderForeground(),h.renderForeground(),s.voterTest.renderForeground()}}function As(t,e,n,o,r,i){const s=this,a=new fs(s,t,o,r,e);s.square=a,ds.call(s,t,e,n),s.setWinFraction=t=>{s.winFraction!==t&&(t>s.winFraction?a.win():s.winFraction>t&&a.lose()),s.winFraction=t},s.renderForeground=()=>{a.render();const{party:o}=t,{x:r,y:i}=s,{fctx:c,darkMode:l}=e,h=l?"#fff":"#222";if("olprA"===n.socialChoice.electionMethod){mo(`p${o}`,r+.1*a.w,i+8,13,2,h,1,c)}if(void 0!==s.winFraction){const t=i+.5*a.h+20+2;mo(yo(s.winFraction),r,t,20,2,h,1,c)}},s.setRenderer=e=>{s.renderer=e(t)},s.click=()=>{hs(s,t,e,n,i)}}function Es(t,e,n,o,r,i){this.canDn=t,this.graphic=new As(t,e,n,o,r,i)}function ks(t,e,n,o){const r=this,i=[];r.rendererMaker=()=>({render:()=>{}});const s=[];r.attachNewG=t=>{s.push(t)};e.attachNewE(r),r.updateNewE=t=>{r.newCandidateDn(t)},r.newCandidateDn=function(e){const a=new Es(e,n,o,21,21,t);var c;i.push(a),a.graphic.setRenderer(r.rendererMaker),c=a,s.forEach((t=>t.updateNewG(c)))},r.getCanDnViews=()=>i.filter((t=>t.canDn.exists)),r.getCandidateDistributions=()=>r.getCanDnViews().map((t=>t.canDn)),r.getCandidateDistributionsAll=()=>i.map((t=>t.canDn)),r.setCandidateDnWins=t=>{const e=r.getCanDnViews();e.length>1&&e.forEach(((e,n)=>{const o=t[n];e.graphic.setWinFraction(o)}))},r.updateViewXY=()=>{i.forEach((t=>t.graphic.updateViewXY()))},r.render=()=>{i.forEach((t=>{t.canDn.exists&&t.graphic.renderer.render()}))},r.setRenderer=t=>{r.rendererMaker=t,i.forEach((e=>e.graphic.setRenderer(t)))},r.renderForeground=()=>{t.showGhosts?r.renderForegroundAll():r.renderForegroundExisting()},r.renderForegroundExisting=()=>{i.forEach((t=>{t.canDn.exists&&t.graphic.renderForeground()}))},r.renderForegroundAll=()=>{i.forEach((t=>t.graphic.renderForeground()))}}function Ps(t,e,n,o,r,i){const s=this;r.sims.sample.pub.attach(s),_o.call(s,e,o,i);const{candidateDnList:a,voterShapeList:c}=t,l=new ks(i,a,e,r.election),h=new _s(i,c,e,r.election);l.attachNewG(s.dragm),h.attachNewG(s.dragm);const u=s.enter;s.enter=()=>{u(),a.canDnButton.show(),h.updateViewXY(),l.updateViewXY()},s.exit=()=>{a.canDnButton.hide()},s.update=t=>{o.check(["draggables"])&&(h.updateViewXY(),l.updateViewXY());const{pointsChanged:e,partyWinFraction:n}=t;e&&l.setCandidateDnWins(n)},s.clickEmpty=()=>{},s.testVoteView=()=>null,s.renderForeground=()=>{h.renderForeground(),l.renderForeground()}}function Ts(t,n,r){const i=new e,s=new Le(["menu","darkModeSwitch","simControlsLabel","undo","redo","addVoter","addCandidate","addCandidateDistribution","screenWrap","maps","saveConfigToLink","saveConfigToText","loadConfigText","svgUIDiv"]),a=new Oe(n),c=new v(i,s,a);Ge(s,a),je(s,a,r),Be(s,a),qe(s,a);const l=new o(300,300,s);p(l,g,s),Mn(l,g,s);const h=new $n(c,i,a,s),u=new De(h,c,i);kn(u,c,s);const d=new An(i);new Ms(h,l,c,i,u,d),new Ps(h,l,c,i,u,d),new Un(u,i),new So(h,l,c,i,u,d),new ns(h,l,c,i,u,d),new Qn(l,c,i,u),new as(h,l,u),h.candidateList.addCandidate({x:50,y:100},{x:50},"#e05020",!0),h.candidateList.addCandidate({x:100,y:50},{x:100},"#50e020",!0),h.candidateList.addCandidate({x:200,y:250},{x:200},"#2050e0",!0),h.candidateDnList.addCandidateDistribution({x:150,y:150,w:200},{x:150,w:200,densityProfile:"gaussian"},!0),h.voterShapeList.addVoterCircle({x:50,y:150,w:200},{x:50,w:200,densityProfile:"gaussian"},!0),h.voterShapeList.addVoterCircle({x:250,y:150,w:200},{x:250,w:200,densityProfile:"gaussian"},!0),a.loadConfig(t),a.clearHistory();const f=s.makeComponent();return window.requestAnimationFrame((function t(){u.update(),Cn(),l.clearForeground(),u.renderForeground(),window.requestAnimationFrame(t)})),f;function g(){l.clear(),l.clearMaps(),l.clearForeground(),u.render(),u.renderForeground()}}function Fs(){const{search:t}=window.location,e=new URLSearchParams(t),n=e.has("a"),o=n?function(t){const e=t.get("a"),n=decodeURIComponent(e),o=JSON.parse(n);return o}(e):{};return{yes:n,config:o}}zi.invert=function(t,e){for(var n,o=e,r=o*o,i=r*r*r,s=0;s<12&&(i=(r=(o-=n=(o*(ji+Wi*r+i*($i+Ui*r))-e)/(ji+-.24331799999999998*r+i*(.0062510000000000005+.034164*r)))*o)*r*r,!(nr(n)<Jo));++s);return[Hi*t*(ji+-.24331799999999998*r+i*(.0062510000000000005+.034164*r))/ir(o),fr(cr(o)/Hi)]},Xi.invert=Ri(or),Yi.invert=function(t,e){var n,o=e,r=25;do{var i=o*o,s=i*i;o-=n=(o*(1.007226+i*(.015085+s*(.028874*i-.044475-.005916*s)))-e)/(1.007226+i*(.045255+s*(.259866*i-.311325-.005916*11*s)))}while(nr(n)>Yo&&--r>0);return[t/(.8707+(i=o*o)*(i*(i*i*i*(.003971-.001529*i)-.013791)-.131979)),o]},Ji.invert=Ri(fr),Ki.invert=Ri((function(t){return 2*or(t)})),Zi.invert=function(t,e){return[-e,2*or(sr(t))-Zo]},Array.from(document.getElementsByClassName("sandbox")).forEach((e=>{const n=void 0!==e.dataset.config?JSON.parse(e.dataset.config):{},o=Fs(),r=o.yes?o.config:n,i=void 0!==e.dataset.sandboxurl?e.dataset.sandboxurl:"",s=Ts(r,new t,i);e.parentNode.appendChild(s)})),Array.from(document.getElementsByClassName("double_sandbox")).forEach((e=>{const n=function(e,n){const o=new t,r=document.createElement("button");r.className="button2",r.innerText="linked",r.style["vertical-align"]="middle",r.style["min-width"]="70px",r.style.margin="5px",r.onclick=()=>{"linked"===r.innerText?(r.innerText="unlinked",o.setLinked(!1)):(r.innerText="linked",o.setLinked(!0))};const i=Ts(e,o,n),s=Ts(e,o,n);i.style.display="inline-block",s.style.display="inline-block",i.style["vertical-align"]="top",s.style["vertical-align"]="top";const a=document.createElement("div");return a.appendChild(i),a.appendChild(r),a.appendChild(s),a}(void 0!==e.dataset.config?JSON.parse(e.dataset.config):{},void 0!==e.dataset.sandboxurl?e.dataset.sandboxurl:"");e.parentNode.appendChild(n)}))})();
//# sourceMappingURL=addSandboxes.js.map
