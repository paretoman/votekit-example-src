{"mappings":"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","sources":["src/command/ComMessenger.js","src/ui/Changes.js","src/ui/EventHandlers.js","src/ui/Screen.js","src/lib/snowpack/build/snowpack/pkg/@mithrandirii/canvas2svg.js","src/ui/addSVGOutput.js","src/menu/Button.js","src/menu/ButtonGroup.js","src/menu/MenuItem.js","src/menu/Menu.js","src/candidates/CandidateSim.js","src/candidates/CandidateSimList.js","src/voters/VoterSimList.js","src/utilities/jsHelpers.js","src/sim/DraggableManager.js","src/sim/states/SimBase.js","src/voters/VoterSim.js","src/lib/colorBlendScript.js","src/election/colorBlend.js","src/viz/Grid2D.js","src/lib/snowpack/build/snowpack/pkg/d3-delaunay.js","src/viz/Voronoi2D.js","src/viz/VizOne2D.js","src/sim/states/SimOne2D.js","src/election/CandidateDistributionSampler.js","src/candidateDns/CandidateDnSimList.js","src/candidateDns/CandidateDnSim.js","src/viz/VizSample2D.js","src/sim/states/SimSample.js","src/voters/VoterGeoBasis.js","src/lib/snowpack/build/snowpack/pkg/simplex-noise.js","src/voters/geoNoise.js","src/lib/snowpack/build/snowpack/pkg/d3-polygon.js","src/voters/lloydVoronoi.js","src/utilities/graphicsUtilities.js","src/lib/polygonClip.js","src/voters/geoCensus.js","src/voters/DistrictMaker.js","src/voters/VoterGeoList.js","src/viz/NoiseImage.js","src/viz/VizGeo2D.js","src/sim/states/SimGeoOne.js","src/sim/Registrar.js","src/lib/snowpack/build/snowpack/pkg/@tweenjs/tweenjs.js","src/voters/CircleGraphic.js","src/tooltips/hideOnClickOutside.js","src/tooltips/tooltipBox.js","src/tooltips/tooltipForEntity.js","src/voters/VoterShape.js","src/voters/VoterCommander.js","src/voters/VoterShapeAdd.js","src/sim/VoterShapeAddMakeButton.js","src/candidates/SquareGraphic.js","src/candidates/Candidate.js","src/candidates/CandidateCommander.js","src/sim/CandidateAddMakeButton.js","src/candidates/CandidateAdd.js","src/candidateDns/CandidateDn.js","src/candidateDns/CandidateDnCommander.js","src/sim/CandidateDnAddMakeButton.js","src/candidateDns/CandidateDnAdd.js","src/viz/Grid1D.js","src/viz/Voronoi1D.js","src/viz/VizOne1D.js","src/sim/states/SimOne1D.js","src/tooltips/tooltipForTestVoter.js","src/voters/VoterTest.js","src/election/ElectionOne.js","src/election/ElectionSample.js","src/election/ElectionGeo.js","src/castVotes/CastPluralityAreaSummer.js","src/castVotes/CastPluralityLineSummer.js","src/castVotes/castPluralityTestVote.js","src/castVotes/castScoreTestVote.js","src/castVotes/CastScoreAreaSummer.js","src/castVotes/CastScoreLineSummer.js","src/castVotes/castVotes.js","src/castVotes/castPlurality.js","src/castVotes/CastScore.js","src/electionMethods/electionMethods.js","src/electionMethods/plurality.js","src/electionMethods/randomWinner.js","src/electionMethods/huntingtonHill.js","src/electionMethods/score.js","src/election/CountVotes.js","src/election/Election.js","src/sim/Sim.js","src/sim/addSimControlsLabel.js","src/ui/Layout.js","src/command/CommandStore.js","src/command/ConfigKeeper.js","src/command/History.js","src/command/Commander.js","src/command/addSaveConfigToText.js","src/command/addSaveConfigToLink.js","src/ui/sandbox.js","src/command/addUndo.js","src/command/loadConfigText.js","src/ui/addSingleSandboxes.js","src/command/checkURL.js","src/ui/addDoubleSandboxes.js","src/ui/doubleSandbox.js"],"sourcesContent":["/** @module */\r\n\r\n/** Connect two sandboxes by passing messages between their commanders.\r\n * This is kind of like a mediator pattern, but also maybe an observer pattern. */\r\nexport default class ComMessenger {\r\n    /** Make sure broadcasted commands don't trigger broadcasts */\r\n\r\n    // All variables are intended to be private.\r\n\r\n    constructor() {\r\n        this.linked = true\r\n        this.commanders = []\r\n        this.protect = false\r\n    }\r\n\r\n    setLinked(value) {\r\n        this.linked = value\r\n    }\r\n\r\n    addCommander(commander) {\r\n        this.commanders.push(commander)\r\n    }\r\n\r\n    broadcastDo(command, originCommander) {\r\n        if (this.linked && this.protect === false) {\r\n            this.protect = true\r\n            this.commanders.forEach((com) => com.passDo(command))\r\n            this.protect = false\r\n        } else {\r\n            originCommander.passDo(command)\r\n        }\r\n    }\r\n\r\n    broadcastDoCommands(commands, originCommander) {\r\n        if (this.linked && this.protect === false) {\r\n            this.protect = true\r\n            this.commanders.forEach(\r\n                (com) => com.passDoCommands(commands),\r\n            )\r\n            this.protect = false\r\n        } else {\r\n            originCommander.passDoCommands(commands)\r\n        }\r\n    }\r\n\r\n    broadcastLoadConfig(newConfig, originCommander) {\r\n        if (this.linked && this.protect === false) {\r\n            this.protect = true\r\n            this.commanders.forEach(\r\n                (com) => com.passLoadConfig(newConfig),\r\n            )\r\n            this.protect = false\r\n        } else {\r\n            originCommander.passLoadConfig(newConfig)\r\n        }\r\n    }\r\n\r\n    broadCastLoadCommands(commands, originCommander) {\r\n        if (this.linked && this.protect === false) {\r\n            this.protect = true\r\n            this.commanders.forEach(\r\n                (com) => com.passLoadCommands(commands),\r\n            )\r\n            this.protect = false\r\n        } else {\r\n            originCommander.passLoadCommands(commands)\r\n        }\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * keep track of changes that occur to a simulation's configuration.\r\n * @constructor\r\n */\r\nexport default function Changes() {\r\n    const self = this\r\n\r\n    const changes = ['init']\r\n\r\n    self.add = (changeList) => {\r\n        changeList.forEach(\r\n            (c) => changes.push(c),\r\n        )\r\n    }\r\n    self.check = (changeList) => {\r\n        let n = 0\r\n        changeList.forEach(\r\n            (c) => { n += changes.includes(c) ? 1 : 0 },\r\n        )\r\n        return n > 0\r\n    }\r\n    self.checkNone = () => (changes.length === 0)\r\n    self.clear = () => {\r\n        changes.splice(0, changes.length)\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Set event handlers for a screen.foreground.\r\n * We want to set the handlers once for the canvas,\r\n * and use this class to change the functions that the handlers call.\r\n * Then allow sims to set the functions called by the handlers.\r\n * @constructor\r\n */\r\nexport default function EventHandlers() {\r\n    const self = this\r\n\r\n    // Event Handlers - well, at least they handle the event handlers//\r\n    self.handlers = {\r\n        start: () => {},\r\n        move: () => {},\r\n        end: () => {},\r\n        touchmove: () => {},\r\n        touchstart: () => {},\r\n        touchend: () => {},\r\n    }\r\n\r\n    // overwrite event handlers\r\n    self.set = (eHandlers) => {\r\n        Object.assign(self.handlers, eHandlers)\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport EventHandlers from './EventHandlers.js'\r\n\r\n/**\r\n * Set up a screen to view some objects.\r\n * A detail here is that we have browser pixels and device pixels.\r\n * Broswer pixels feel about the same size on any device (visual arc length).\r\n * Device pixels can be much smaller for high-dpi devices.\r\n * @param {Number} w - width in browser pixels of the canvas.\r\n * @param {Number} h - height in browser pixels of the canvas.\r\n * @param {Layout} layout\r\n * @constructor\r\n */\r\nexport default function Screen(w, h, layout) {\r\n    const self = this\r\n\r\n    self.width = w // measured in browser pixels\r\n    self.height = h\r\n\r\n    // canvas\r\n    self.canvas = document.createElement('canvas')\r\n    self.canvas.setAttribute('class', 'background')\r\n    self.ctx = self.canvas.getContext('2d')\r\n\r\n    // tooltips\r\n    self.tooltips = document.createElement('div')\r\n    self.tooltips.setAttribute('class', 'tooltips')\r\n\r\n    // foreground\r\n    self.foreground = document.createElement('canvas')\r\n    self.foreground.setAttribute('class', 'foreground')\r\n    self.fctx = self.foreground.getContext('2d')\r\n\r\n    // maps\r\n    self.maps = document.createElement('canvas')\r\n    self.maps.setAttribute('class', 'maps')\r\n    self.mctx = self.maps.getContext('2d')\r\n\r\n    const clearDiv = document.createElement('div')\r\n\r\n    // wrap\r\n    self.wrap = document.createElement('div')\r\n    self.wrap.setAttribute('class', 'screenWrap')\r\n    self.wrap.appendChild(clearDiv)\r\n    self.wrap.appendChild(self.canvas)\r\n    self.wrap.appendChild(self.tooltips)\r\n    self.wrap.appendChild(self.foreground)\r\n\r\n    layout.newElement('screenWrap', self.wrap)\r\n    layout.newElement('maps', self.maps)\r\n\r\n    self.noBuffers = false\r\n\r\n    // use scaling for high DPI devices instead of multiplying every time inside draw calls\r\n    // https://www.html5rocks.com/en/tutorials/canvas/hidpi/\r\n    self.pixelRatio = getPixelRatio(self.ctx)\r\n\r\n    self.canvas.width = w * self.pixelRatio // measured in device pixels\r\n    self.canvas.height = h * self.pixelRatio\r\n\r\n    self.canvas.style.width = `${w}px`\r\n    self.canvas.style.height = `${h}px`\r\n\r\n    self.wrap.style.width = `${w}px`\r\n    self.wrap.style.height = `${h}px`\r\n\r\n    self.tooltips.style.width = `${w}px`\r\n    self.tooltips.style.height = `${h}px`\r\n\r\n    self.foreground.width = w * self.pixelRatio // measured in device pixels\r\n    self.foreground.height = h * self.pixelRatio\r\n\r\n    self.foreground.style.width = `${w}px`\r\n    self.foreground.style.height = `${h}px`\r\n\r\n    self.setMapsHeight = (height) => {\r\n        const h3 = Math.round(height)\r\n        self.maps.heightBrowser = h3\r\n        self.maps.height = h3 * self.pixelRatio // measured in device pixels\r\n        self.maps.style.height = `${h3}px` // measured in browser pixels\r\n        self.mctx.scale(self.pixelRatio, self.pixelRatio)\r\n    }\r\n    self.setMapsHeight((1 / 3) * h)\r\n    self.maps.width = w * self.pixelRatio // measured in device pixels\r\n    self.maps.style.width = `${w}px`\r\n\r\n    self.ctx.scale(self.pixelRatio, self.pixelRatio)\r\n    self.fctx.scale(self.pixelRatio, self.pixelRatio)\r\n\r\n    self.clear = function () {\r\n        self.ctx.clearRect(0, 0, self.canvas.width, self.canvas.height)\r\n    }\r\n    self.clearForeground = function () {\r\n        self.fctx.clearRect(0, 0, self.foreground.width, self.foreground.height)\r\n    }\r\n    self.clearMaps = function () {\r\n        self.mctx.clearRect(0, 0, self.maps.width, self.maps.height)\r\n    }\r\n    self.setCtx = function (c) {\r\n        self.ctx = c\r\n    }\r\n    self.setFCtx = function (c) {\r\n        self.fctx = c\r\n    }\r\n    self.setMCtx = function (c) {\r\n        self.mctx = c\r\n    }\r\n    self.setNoBuffers = function (noBuffers) {\r\n        self.noBuffers = noBuffers\r\n    }\r\n    self.showMaps = () => {\r\n        self.maps.style.display = 'block'\r\n    }\r\n    self.hideMaps = () => {\r\n        self.maps.style.display = 'none'\r\n    }\r\n\r\n    self.eventHandlers = new EventHandlers()\r\n    const { handlers } = self.eventHandlers\r\n\r\n    self.wrap.onmousedown = (e) => handlers.start(e)\r\n    self.wrap.onmousemove = (e) => handlers.move(e)\r\n    self.wrap.onmouseup = (e) => handlers.end(e)\r\n    self.wrap.addEventListener('touchmove', (e) => handlers.touchmove(e))\r\n    self.wrap.addEventListener('touchstart', (e) => handlers.touchstart(e))\r\n    self.wrap.addEventListener('touchend', (e) => handlers.touchend(e))\r\n\r\n    // mouse up outside of canvas\r\n    const current = document.onmouseup\r\n    document.onmouseup = (e) => {\r\n        if (current) current(e)\r\n        self.wrap.onmouseup(e)\r\n    }\r\n}\r\n\r\nfunction getPixelRatio(context) {\r\n    const backingStore = context.backingStorePixelRatio\r\n          || context.webkitBackingStorePixelRatio\r\n          || context.mozBackingStorePixelRatio\r\n          || context.msBackingStorePixelRatio\r\n          || context.oBackingStorePixelRatio\r\n          || context.backingStorePixelRatio || 1\r\n\r\n    return (window.devicePixelRatio || 1) / backingStore\r\n}\r\n","/*!!\r\n *  Canvas 2 Svg v1.0.21\r\n *  A low level canvas to SVG converter. Uses a mock canvas context to build an SVG document.\r\n *\r\n *  Licensed under the MIT license:\r\n *  http://www.opensource.org/licenses/mit-license.php\r\n *\r\n *  Author:\r\n *  Kerry Liu\r\n *\r\n *  Copyright (c) 2014 Gliffy Inc.\r\n */\r\n\r\n    var STYLES, ctx, CanvasGradient, CanvasPattern, namedEntities;\r\n\r\n    //helper function to format a string\r\n    function format(str, args) {\r\n        var keys = Object.keys(args), i;\r\n        for (i=0; i<keys.length; i++) {\r\n            str = str.replace(new RegExp(\"\\\\{\" + keys[i] + \"\\\\}\", \"gi\"), args[keys[i]]);\r\n        }\r\n        return str;\r\n    }\r\n\r\n    //helper function that generates a random string\r\n    function randomString(holder) {\r\n        var chars, randomstring, i;\r\n        if (!holder) {\r\n            throw new Error(\"cannot create a random attribute name for an undefined object\");\r\n        }\r\n        chars = \"ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz\";\r\n        randomstring = \"\";\r\n        do {\r\n            randomstring = \"\";\r\n            for (i = 0; i < 12; i++) {\r\n                randomstring += chars[Math.floor(Math.random() * chars.length)];\r\n            }\r\n        } while (holder[randomstring]);\r\n        return randomstring;\r\n    }\r\n\r\n    //helper function to map named to numbered entities\r\n    function createNamedToNumberedLookup(items, radix) {\r\n        var i, entity, lookup = {}, base10;\r\n        items = items.split(',');\r\n        radix = radix || 10;\r\n        // Map from named to numbered entities.\r\n        for (i = 0; i < items.length; i += 2) {\r\n            entity = '&' + items[i + 1] + ';';\r\n            base10 = parseInt(items[i], radix);\r\n            lookup[entity] = '&#'+base10+';';\r\n        }\r\n        //FF and IE need to create a regex from hex values ie &nbsp; == \\xa0\r\n        lookup[\"\\\\xa0\"] = '&#160;';\r\n        return lookup;\r\n    }\r\n\r\n    //helper function to map canvas-textAlign to svg-textAnchor\r\n    function getTextAnchor(textAlign) {\r\n        //TODO: support rtl languages\r\n        var mapping = {\"left\":\"start\", \"right\":\"end\", \"center\":\"middle\", \"start\":\"start\", \"end\":\"end\"};\r\n        return mapping[textAlign] || mapping.start;\r\n    }\r\n\r\n    //helper function to map canvas-textBaseline to svg-dominantBaseline\r\n    function getDominantBaseline(textBaseline) {\r\n        //INFO: not supported in all browsers\r\n        var mapping = {\"alphabetic\": \"alphabetic\", \"hanging\": \"hanging\", \"top\":\"text-before-edge\", \"bottom\":\"text-after-edge\", \"middle\":\"central\"};\r\n        return mapping[textBaseline] || mapping.alphabetic;\r\n    }\r\n\r\n    // Unpack entities lookup where the numbers are in radix 32 to reduce the size\r\n    // entity mapping courtesy of tinymce\r\n    namedEntities = createNamedToNumberedLookup(\r\n        '50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,' +\r\n            '5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,' +\r\n            '5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,' +\r\n            '5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,' +\r\n            '68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,' +\r\n            '6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,' +\r\n            '6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,' +\r\n            '75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,' +\r\n            '7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,' +\r\n            '7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,' +\r\n            'sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,' +\r\n            'st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,' +\r\n            't9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,' +\r\n            'tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,' +\r\n            'u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,' +\r\n            '81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,' +\r\n            '8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,' +\r\n            '8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,' +\r\n            '8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,' +\r\n            '8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,' +\r\n            'nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,' +\r\n            'rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,' +\r\n            'Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,' +\r\n            '80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,' +\r\n            '811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro', 32);\r\n\r\n\r\n    //Some basic mappings for attributes and default values.\r\n    STYLES = {\r\n        \"strokeStyle\":{\r\n            svgAttr : \"stroke\", //corresponding svg attribute\r\n            canvas : \"#000000\", //canvas default\r\n            svg : \"none\",       //svg default\r\n            apply : \"stroke\"    //apply on stroke() or fill()\r\n        },\r\n        \"fillStyle\":{\r\n            svgAttr : \"fill\",\r\n            canvas : \"#000000\",\r\n            svg : null, //svg default is black, but we need to special case this to handle canvas stroke without fill\r\n            apply : \"fill\"\r\n        },\r\n        \"lineCap\":{\r\n            svgAttr : \"stroke-linecap\",\r\n            canvas : \"butt\",\r\n            svg : \"butt\",\r\n            apply : \"stroke\"\r\n        },\r\n        \"lineJoin\":{\r\n            svgAttr : \"stroke-linejoin\",\r\n            canvas : \"miter\",\r\n            svg : \"miter\",\r\n            apply : \"stroke\"\r\n        },\r\n        \"miterLimit\":{\r\n            svgAttr : \"stroke-miterlimit\",\r\n            canvas : 10,\r\n            svg : 4,\r\n            apply : \"stroke\"\r\n        },\r\n        \"lineWidth\":{\r\n            svgAttr : \"stroke-width\",\r\n            canvas : 1,\r\n            svg : 1,\r\n            apply : \"stroke\"\r\n        },\r\n        \"globalAlpha\": {\r\n            svgAttr : \"opacity\",\r\n            canvas : 1,\r\n            svg : 1,\r\n            apply :  \"fill stroke\"\r\n        },\r\n        \"font\":{\r\n            //font converts to multiple svg attributes, there is custom logic for this\r\n            canvas : \"10px sans-serif\"\r\n        },\r\n        \"shadowColor\":{\r\n            canvas : \"#000000\"\r\n        },\r\n        \"shadowOffsetX\":{\r\n            canvas : 0\r\n        },\r\n        \"shadowOffsetY\":{\r\n            canvas : 0\r\n        },\r\n        \"shadowBlur\":{\r\n            canvas : 0\r\n        },\r\n        \"textAlign\":{\r\n            canvas : \"start\"\r\n        },\r\n        \"textBaseline\":{\r\n            canvas : \"alphabetic\"\r\n        },\r\n        \"lineDash\" : {\r\n            svgAttr : \"stroke-dasharray\",\r\n            canvas : [],\r\n            svg : null,\r\n            apply : \"stroke\"\r\n        }\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param gradientNode - reference to the gradient\r\n     * @constructor\r\n     */\r\n    CanvasGradient = function (gradientNode, ctx) {\r\n        this.__root = gradientNode;\r\n        this.__ctx = ctx;\r\n    };\r\n\r\n    /**\r\n     * Adds a color stop to the gradient root\r\n     */\r\n    CanvasGradient.prototype.addColorStop = function (offset, color) {\r\n        var stop = this.__ctx.__createElement(\"stop\"), regex, matches;\r\n        stop.setAttribute(\"offset\", offset);\r\n        if (color.indexOf(\"rgba\") !== -1) {\r\n            //separate alpha value, since webkit can't handle it\r\n            regex = /rgba\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d?\\.?\\d*)\\s*\\)/gi;\r\n            matches = regex.exec(color);\r\n            stop.setAttribute(\"stop-color\", format(\"rgb({r},{g},{b})\", {r:matches[1], g:matches[2], b:matches[3]}));\r\n            stop.setAttribute(\"stop-opacity\", matches[4]);\r\n        } else {\r\n            stop.setAttribute(\"stop-color\", color);\r\n        }\r\n        this.__root.appendChild(stop);\r\n    };\r\n\r\n    CanvasPattern = function (pattern, ctx) {\r\n        this.__root = pattern;\r\n        this.__ctx = ctx;\r\n    };\r\n\r\n    /**\r\n     * The mock canvas context\r\n     * @param o - options include:\r\n     * ctx - existing Context2D to wrap around\r\n     * width - width of your canvas (defaults to 500)\r\n     * height - height of your canvas (defaults to 500)\r\n     * enableMirroring - enables canvas mirroring (get image data) (defaults to false)\r\n     * document - the document object (defaults to the current document)\r\n     */\r\n    ctx = function (o) {\r\n        var defaultOptions = { width:500, height:500, enableMirroring : false}, options;\r\n\r\n        //keep support for this way of calling C2S: new C2S(width,height)\r\n        if (arguments.length > 1) {\r\n            options = defaultOptions;\r\n            options.width = arguments[0];\r\n            options.height = arguments[1];\r\n        } else if ( !o ) {\r\n            options = defaultOptions;\r\n        } else {\r\n            options = o;\r\n        }\r\n\r\n        if (!(this instanceof ctx)) {\r\n            //did someone call this without new?\r\n            return new ctx(options);\r\n        }\r\n\r\n        //setup options\r\n        this.width = options.width || defaultOptions.width;\r\n        this.height = options.height || defaultOptions.height;\r\n        this.enableMirroring = options.enableMirroring !== undefined ? options.enableMirroring : defaultOptions.enableMirroring;\r\n\r\n        this.canvas = this;   ///point back to this instance!\r\n        this.__document = options.document || document;\r\n\r\n        // allow passing in an existing context to wrap around\r\n        // if a context is passed in, we know a canvas already exist\r\n        if (options.ctx) {\r\n            this.__ctx = options.ctx;\r\n        } else {\r\n            this.__canvas = this.__document.createElement(\"canvas\");\r\n            this.__ctx = this.__canvas.getContext(\"2d\");\r\n        }\r\n\r\n        this.__setDefaultStyles();\r\n        this.__stack = [this.__getStyleState()];\r\n        this.__groupStack = [];\r\n\r\n        //the root svg element\r\n        this.__root = this.__document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\r\n        this.__root.setAttribute(\"version\", 1.1);\r\n        this.__root.setAttribute(\"xmlns\", \"http://www.w3.org/2000/svg\");\r\n        this.__root.setAttributeNS(\"http://www.w3.org/2000/xmlns/\", \"xmlns:xlink\", \"http://www.w3.org/1999/xlink\");\r\n        this.__root.setAttribute(\"width\", this.width);\r\n        this.__root.setAttribute(\"height\", this.height);\r\n\r\n        //make sure we don't generate the same ids in defs\r\n        this.__ids = {};\r\n\r\n        //defs tag\r\n        this.__defs = this.__document.createElementNS(\"http://www.w3.org/2000/svg\", \"defs\");\r\n        this.__root.appendChild(this.__defs);\r\n\r\n        //also add a group child. the svg element can't use the transform attribute\r\n        this.__currentElement = this.__document.createElementNS(\"http://www.w3.org/2000/svg\", \"g\");\r\n        this.__root.appendChild(this.__currentElement);\r\n    };\r\n\r\n\r\n    /**\r\n     * Creates the specified svg element\r\n     * @private\r\n     */\r\n    ctx.prototype.__createElement = function (elementName, properties, resetFill) {\r\n        if (typeof properties === \"undefined\") {\r\n            properties = {};\r\n        }\r\n\r\n        var element = this.__document.createElementNS(\"http://www.w3.org/2000/svg\", elementName),\r\n            keys = Object.keys(properties), i, key;\r\n        if (resetFill) {\r\n            //if fill or stroke is not specified, the svg element should not display. By default SVG's fill is black.\r\n            element.setAttribute(\"fill\", \"none\");\r\n            element.setAttribute(\"stroke\", \"none\");\r\n        }\r\n        for (i=0; i<keys.length; i++) {\r\n            key = keys[i];\r\n            element.setAttribute(key, properties[key]);\r\n        }\r\n        return element;\r\n    };\r\n\r\n    /**\r\n     * Applies default canvas styles to the context\r\n     * @private\r\n     */\r\n    ctx.prototype.__setDefaultStyles = function () {\r\n        //default 2d canvas context properties see:http://www.w3.org/TR/2dcontext/\r\n        var keys = Object.keys(STYLES), i, key;\r\n        for (i=0; i<keys.length; i++) {\r\n            key = keys[i];\r\n            this[key] = STYLES[key].canvas;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Applies styles on restore\r\n     * @param styleState\r\n     * @private\r\n     */\r\n    ctx.prototype.__applyStyleState = function (styleState) {\r\n        var keys = Object.keys(styleState), i, key;\r\n        for (i=0; i<keys.length; i++) {\r\n            key = keys[i];\r\n            this[key] = styleState[key];\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Gets the current style state\r\n     * @return {Object}\r\n     * @private\r\n     */\r\n    ctx.prototype.__getStyleState = function () {\r\n        var i, styleState = {}, keys = Object.keys(STYLES), key;\r\n        for (i=0; i<keys.length; i++) {\r\n            key = keys[i];\r\n            styleState[key] = this[key];\r\n        }\r\n        return styleState;\r\n    };\r\n\r\n    /**\r\n     * Apples the current styles to the current SVG element. On \"ctx.fill\" or \"ctx.stroke\"\r\n     * @param type\r\n     * @private\r\n     */\r\n    ctx.prototype.__applyStyleToCurrentElement = function (type) {\r\n    \tvar currentElement = this.__currentElement;\r\n    \tvar currentStyleGroup = this.__currentElementsToStyle;\r\n    \tif (currentStyleGroup) {\r\n    \t\tcurrentElement.setAttribute(type, \"\");\r\n    \t\tcurrentElement = currentStyleGroup.element;\r\n    \t\tcurrentStyleGroup.children.forEach(function (node) {\r\n    \t\t\tnode.setAttribute(type, \"\");\r\n    \t\t});\r\n    \t}\r\n\r\n        var keys = Object.keys(STYLES), i, style, value, id, regex, matches;\r\n        for (i = 0; i < keys.length; i++) {\r\n            style = STYLES[keys[i]];\r\n            value = this[keys[i]];\r\n            if (style.apply) {\r\n                //is this a gradient or pattern?\r\n                if (value instanceof CanvasPattern) {\r\n                    //pattern\r\n                    if (value.__ctx) {\r\n                        //copy over defs\r\n                        while(value.__ctx.__defs.childNodes.length) {\r\n                            id = value.__ctx.__defs.childNodes[0].getAttribute(\"id\");\r\n                            this.__ids[id] = id;\r\n                            this.__defs.appendChild(value.__ctx.__defs.childNodes[0]);\r\n                        }\r\n                    }\r\n                    currentElement.setAttribute(style.apply, format(\"url(#{id})\", {id:value.__root.getAttribute(\"id\")}));\r\n                }\r\n                else if (value instanceof CanvasGradient) {\r\n                    //gradient\r\n                    currentElement.setAttribute(style.apply, format(\"url(#{id})\", {id:value.__root.getAttribute(\"id\")}));\r\n                } else if (style.apply.indexOf(type)!==-1 && style.svg !== value) {\r\n                    if ((style.svgAttr === \"stroke\" || style.svgAttr === \"fill\") && value.indexOf(\"rgba\") !== -1) {\r\n                        //separate alpha value, since illustrator can't handle it\r\n                        regex = /rgba\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d?\\.?\\d*)\\s*\\)/gi;\r\n                        matches = regex.exec(value);\r\n                        currentElement.setAttribute(style.svgAttr, format(\"rgb({r},{g},{b})\", {r:matches[1], g:matches[2], b:matches[3]}));\r\n                        //should take globalAlpha here\r\n                        var opacity = matches[4];\r\n                        var globalAlpha = this.globalAlpha;\r\n                        if (globalAlpha != null) {\r\n                            opacity *= globalAlpha;\r\n                        }\r\n                        currentElement.setAttribute(style.svgAttr+\"-opacity\", opacity);\r\n                    } else {\r\n                        var attr = style.svgAttr;\r\n                        if (keys[i] === 'globalAlpha') {\r\n                            attr = type+'-'+style.svgAttr;\r\n                            if (currentElement.getAttribute(attr)) {\r\n                                 //fill-opacity or stroke-opacity has already been set by stroke or fill.\r\n                                continue;\r\n                            }\r\n                        }\r\n                        //otherwise only update attribute if right type, and not svg default\r\n                        currentElement.setAttribute(attr, value);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Will return the closest group or svg node. May return the current element.\r\n     * @private\r\n     */\r\n    ctx.prototype.__closestGroupOrSvg = function (node) {\r\n        node = node || this.__currentElement;\r\n        if (node.nodeName === \"g\" || node.nodeName === \"svg\") {\r\n            return node;\r\n        } else {\r\n            return this.__closestGroupOrSvg(node.parentNode);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Returns the serialized value of the svg so far\r\n     * @param fixNamedEntities - Standalone SVG doesn't support named entities, which document.createTextNode encodes.\r\n     *                           If true, we attempt to find all named entities and encode it as a numeric entity.\r\n     * @return serialized svg\r\n     */\r\n    ctx.prototype.getSerializedSvg = function (fixNamedEntities) {\r\n        var serialized = new XMLSerializer().serializeToString(this.__root),\r\n            keys, i, key, value, regexp, xmlns;\r\n\r\n        //IE search for a duplicate xmnls because they didn't implement setAttributeNS correctly\r\n        xmlns = /xmlns=\"http:\\/\\/www\\.w3\\.org\\/2000\\/svg\".+xmlns=\"http:\\/\\/www\\.w3\\.org\\/2000\\/svg/gi;\r\n        if (xmlns.test(serialized)) {\r\n            serialized = serialized.replace('xmlns=\"http://www.w3.org/2000/svg','xmlns:xlink=\"http://www.w3.org/1999/xlink');\r\n        }\r\n\r\n        if (fixNamedEntities) {\r\n            keys = Object.keys(namedEntities);\r\n            //loop over each named entity and replace with the proper equivalent.\r\n            for (i=0; i<keys.length; i++) {\r\n                key = keys[i];\r\n                value = namedEntities[key];\r\n                regexp = new RegExp(key, \"gi\");\r\n                if (regexp.test(serialized)) {\r\n                    serialized = serialized.replace(regexp, value);\r\n                }\r\n            }\r\n        }\r\n\r\n        return serialized;\r\n    };\r\n\r\n\r\n    /**\r\n     * Returns the root svg\r\n     * @return\r\n     */\r\n    ctx.prototype.getSvg = function () {\r\n        return this.__root;\r\n    };\r\n    /**\r\n     * Will generate a group tag.\r\n     */\r\n    ctx.prototype.save = function () {\r\n        var group = this.__createElement(\"g\");\r\n        var parent = this.__closestGroupOrSvg();\r\n        this.__groupStack.push(parent);\r\n        parent.appendChild(group);\r\n        this.__currentElement = group;\r\n        this.__stack.push(this.__getStyleState());\r\n    };\r\n    /**\r\n     * Sets current element to parent, or just root if already root\r\n     */\r\n    ctx.prototype.restore = function () {\r\n        this.__currentElement = this.__groupStack.pop();\r\n        this.__currentElementsToStyle = null;\r\n        //Clearing canvas will make the poped group invalid, currentElement is set to the root group node.\r\n        if (!this.__currentElement) {\r\n            this.__currentElement = this.__root.childNodes[1];\r\n        }\r\n        var state = this.__stack.pop();\r\n        this.__applyStyleState(state);\r\n    };\r\n\r\n    /**\r\n     * Helper method to add transform\r\n     * @private\r\n     */\r\n    ctx.prototype.__addTransform = function (t) {\r\n        //if the current element has siblings, add another group\r\n        var parent = this.__closestGroupOrSvg();\r\n        if (parent.childNodes.length > 0) {\r\n        \tif (this.__currentElement.nodeName === \"path\") {\r\n        \t\tif (!this.__currentElementsToStyle) this.__currentElementsToStyle = {element: parent, children: []};\r\n        \t\tthis.__currentElementsToStyle.children.push(this.__currentElement);\r\n        \t\tthis.__applyCurrentDefaultPath();\r\n        \t}\r\n\r\n            var group = this.__createElement(\"g\");\r\n            parent.appendChild(group);\r\n            this.__currentElement = group;\r\n        }\r\n\r\n        var transform = this.__currentElement.getAttribute(\"transform\");\r\n        if (transform) {\r\n            transform += \" \";\r\n        } else {\r\n            transform = \"\";\r\n        }\r\n        transform += t;\r\n        this.__currentElement.setAttribute(\"transform\", transform);\r\n    };\r\n\r\n    /**\r\n     *  scales the current element\r\n     */\r\n    ctx.prototype.scale = function (x, y) {\r\n        if (y === undefined) {\r\n            y = x;\r\n        }\r\n        this.__addTransform(format(\"scale({x},{y})\", {x:x, y:y}));\r\n    };\r\n\r\n    /**\r\n     * rotates the current element\r\n     */\r\n    ctx.prototype.rotate = function (angle) {\r\n        var degrees = (angle * 180 / Math.PI);\r\n        this.__addTransform(format(\"rotate({angle},{cx},{cy})\", {angle:degrees, cx:0, cy:0}));\r\n    };\r\n\r\n    /**\r\n     * translates the current element\r\n     */\r\n    ctx.prototype.translate = function (x, y) {\r\n        this.__addTransform(format(\"translate({x},{y})\", {x:x,y:y}));\r\n    };\r\n\r\n    /**\r\n     * applies a transform to the current element\r\n     */\r\n    ctx.prototype.transform = function (a, b, c, d, e, f) {\r\n        this.__addTransform(format(\"matrix({a},{b},{c},{d},{e},{f})\", {a:a, b:b, c:c, d:d, e:e, f:f}));\r\n    };\r\n\r\n    /**\r\n     * Create a new Path Element\r\n     */\r\n    ctx.prototype.beginPath = function () {\r\n        var path, parent;\r\n\r\n        // Note that there is only one current default path, it is not part of the drawing state.\r\n        // See also: https://html.spec.whatwg.org/multipage/scripting.html#current-default-path\r\n        this.__currentDefaultPath = \"\";\r\n        this.__currentPosition = {};\r\n\r\n        path = this.__createElement(\"path\", {}, true);\r\n        parent = this.__closestGroupOrSvg();\r\n        parent.appendChild(path);\r\n        this.__currentElement = path;\r\n    };\r\n\r\n    /**\r\n     * Helper function to apply currentDefaultPath to current path element\r\n     * @private\r\n     */\r\n    ctx.prototype.__applyCurrentDefaultPath = function () {\r\n    \tvar currentElement = this.__currentElement;\r\n        if (currentElement.nodeName === \"path\") {\r\n\t\t\tcurrentElement.setAttribute(\"d\", this.__currentDefaultPath);\r\n        } else {\r\n\t\t\tconsole.error(\"Attempted to apply path command to node\", currentElement.nodeName);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Helper function to add path command\r\n     * @private\r\n     */\r\n    ctx.prototype.__addPathCommand = function (command) {\r\n        this.__currentDefaultPath += \" \";\r\n        this.__currentDefaultPath += command;\r\n    };\r\n\r\n    /**\r\n     * Adds the move command to the current path element,\r\n     * if the currentPathElement is not empty create a new path element\r\n     */\r\n    ctx.prototype.moveTo = function (x,y) {\r\n        if (this.__currentElement.nodeName !== \"path\") {\r\n            this.beginPath();\r\n        }\r\n\r\n        // creates a new subpath with the given point\r\n        this.__currentPosition = {x: x, y: y};\r\n        this.__addPathCommand(format(\"M {x} {y}\", {x:x, y:y}));\r\n    };\r\n\r\n    /**\r\n     * Closes the current path\r\n     */\r\n    ctx.prototype.closePath = function () {\r\n        if (this.__currentDefaultPath) {\r\n            this.__addPathCommand(\"Z\");\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Adds a line to command\r\n     */\r\n    ctx.prototype.lineTo = function (x, y) {\r\n        this.__currentPosition = {x: x, y: y};\r\n        if (this.__currentDefaultPath.indexOf('M') > -1) {\r\n            this.__addPathCommand(format(\"L {x} {y}\", {x:x, y:y}));\r\n        } else {\r\n            this.__addPathCommand(format(\"M {x} {y}\", {x:x, y:y}));\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Add a bezier command\r\n     */\r\n    ctx.prototype.bezierCurveTo = function (cp1x, cp1y, cp2x, cp2y, x, y) {\r\n        this.__currentPosition = {x: x, y: y};\r\n        this.__addPathCommand(format(\"C {cp1x} {cp1y} {cp2x} {cp2y} {x} {y}\",\r\n            {cp1x:cp1x, cp1y:cp1y, cp2x:cp2x, cp2y:cp2y, x:x, y:y}));\r\n    };\r\n\r\n    /**\r\n     * Adds a quadratic curve to command\r\n     */\r\n    ctx.prototype.quadraticCurveTo = function (cpx, cpy, x, y) {\r\n        this.__currentPosition = {x: x, y: y};\r\n        this.__addPathCommand(format(\"Q {cpx} {cpy} {x} {y}\", {cpx:cpx, cpy:cpy, x:x, y:y}));\r\n    };\r\n\r\n\r\n    /**\r\n     * Return a new normalized vector of given vector\r\n     */\r\n    var normalize = function (vector) {\r\n        var len = Math.sqrt(vector[0] * vector[0] + vector[1] * vector[1]);\r\n        return [vector[0] / len, vector[1] / len];\r\n    };\r\n\r\n    /**\r\n     * Adds the arcTo to the current path\r\n     *\r\n     * @see http://www.w3.org/TR/2015/WD-2dcontext-20150514/#dom-context-2d-arcto\r\n     */\r\n    ctx.prototype.arcTo = function (x1, y1, x2, y2, radius) {\r\n        // Let the point (x0, y0) be the last point in the subpath.\r\n        var x0 = this.__currentPosition && this.__currentPosition.x;\r\n        var y0 = this.__currentPosition && this.__currentPosition.y;\r\n\r\n        // First ensure there is a subpath for (x1, y1).\r\n        if (typeof x0 == \"undefined\" || typeof y0 == \"undefined\") {\r\n            return;\r\n        }\r\n\r\n        // Negative values for radius must cause the implementation to throw an IndexSizeError exception.\r\n        if (radius < 0) {\r\n            throw new Error(\"IndexSizeError: The radius provided (\" + radius + \") is negative.\");\r\n        }\r\n\r\n        // If the point (x0, y0) is equal to the point (x1, y1),\r\n        // or if the point (x1, y1) is equal to the point (x2, y2),\r\n        // or if the radius radius is zero,\r\n        // then the method must add the point (x1, y1) to the subpath,\r\n        // and connect that point to the previous point (x0, y0) by a straight line.\r\n        if (((x0 === x1) && (y0 === y1))\r\n            || ((x1 === x2) && (y1 === y2))\r\n            || (radius === 0)) {\r\n            this.lineTo(x1, y1);\r\n            return;\r\n        }\r\n\r\n        // Otherwise, if the points (x0, y0), (x1, y1), and (x2, y2) all lie on a single straight line,\r\n        // then the method must add the point (x1, y1) to the subpath,\r\n        // and connect that point to the previous point (x0, y0) by a straight line.\r\n        var unit_vec_p1_p0 = normalize([x0 - x1, y0 - y1]);\r\n        var unit_vec_p1_p2 = normalize([x2 - x1, y2 - y1]);\r\n        if (unit_vec_p1_p0[0] * unit_vec_p1_p2[1] === unit_vec_p1_p0[1] * unit_vec_p1_p2[0]) {\r\n            this.lineTo(x1, y1);\r\n            return;\r\n        }\r\n\r\n        // Otherwise, let The Arc be the shortest arc given by circumference of the circle that has radius radius,\r\n        // and that has one point tangent to the half-infinite line that crosses the point (x0, y0) and ends at the point (x1, y1),\r\n        // and that has a different point tangent to the half-infinite line that ends at the point (x1, y1), and crosses the point (x2, y2).\r\n        // The points at which this circle touches these two lines are called the start and end tangent points respectively.\r\n\r\n        // note that both vectors are unit vectors, so the length is 1\r\n        var cos = (unit_vec_p1_p0[0] * unit_vec_p1_p2[0] + unit_vec_p1_p0[1] * unit_vec_p1_p2[1]);\r\n        var theta = Math.acos(Math.abs(cos));\r\n\r\n        // Calculate origin\r\n        var unit_vec_p1_origin = normalize([\r\n            unit_vec_p1_p0[0] + unit_vec_p1_p2[0],\r\n            unit_vec_p1_p0[1] + unit_vec_p1_p2[1]\r\n        ]);\r\n        var len_p1_origin = radius / Math.sin(theta / 2);\r\n        var x = x1 + len_p1_origin * unit_vec_p1_origin[0];\r\n        var y = y1 + len_p1_origin * unit_vec_p1_origin[1];\r\n\r\n        // Calculate start angle and end angle\r\n        // rotate 90deg clockwise (note that y axis points to its down)\r\n        var unit_vec_origin_start_tangent = [\r\n            -unit_vec_p1_p0[1],\r\n            unit_vec_p1_p0[0]\r\n        ];\r\n        // rotate 90deg counter clockwise (note that y axis points to its down)\r\n        var unit_vec_origin_end_tangent = [\r\n            unit_vec_p1_p2[1],\r\n            -unit_vec_p1_p2[0]\r\n        ];\r\n        var getAngle = function (vector) {\r\n            // get angle (clockwise) between vector and (1, 0)\r\n            var x = vector[0];\r\n            var y = vector[1];\r\n            if (y >= 0) { // note that y axis points to its down\r\n                return Math.acos(x);\r\n            } else {\r\n                return -Math.acos(x);\r\n            }\r\n        };\r\n        var startAngle = getAngle(unit_vec_origin_start_tangent);\r\n        var endAngle = getAngle(unit_vec_origin_end_tangent);\r\n\r\n        // Connect the point (x0, y0) to the start tangent point by a straight line\r\n        this.lineTo(x + unit_vec_origin_start_tangent[0] * radius,\r\n                    y + unit_vec_origin_start_tangent[1] * radius);\r\n\r\n        // Connect the start tangent point to the end tangent point by arc\r\n        // and adding the end tangent point to the subpath.\r\n        this.arc(x, y, radius, startAngle, endAngle);\r\n    };\r\n\r\n    /**\r\n     * Sets the stroke property on the current element\r\n     */\r\n    ctx.prototype.stroke = function () {\r\n        if (this.__currentElement.nodeName === \"path\") {\r\n            this.__currentElement.setAttribute(\"paint-order\", \"fill stroke markers\");\r\n        }\r\n        this.__applyCurrentDefaultPath();\r\n        this.__applyStyleToCurrentElement(\"stroke\");\r\n    };\r\n\r\n    /**\r\n     * Sets fill properties on the current element\r\n     */\r\n    ctx.prototype.fill = function () {\r\n        if (this.__currentElement.nodeName === \"path\") {\r\n            this.__currentElement.setAttribute(\"paint-order\", \"stroke fill markers\");\r\n        }\r\n        this.__applyCurrentDefaultPath();\r\n        this.__applyStyleToCurrentElement(\"fill\");\r\n    };\r\n\r\n    /**\r\n     *  Adds a rectangle to the path.\r\n     */\r\n    ctx.prototype.rect = function (x, y, width, height) {\r\n        if (this.__currentElement.nodeName !== \"path\") {\r\n            this.beginPath();\r\n        }\r\n        this.moveTo(x, y);\r\n        this.lineTo(x+width, y);\r\n        this.lineTo(x+width, y+height);\r\n        this.lineTo(x, y+height);\r\n        this.lineTo(x, y);\r\n        this.closePath();\r\n    };\r\n\r\n\r\n    /**\r\n     * adds a rectangle element\r\n     */\r\n    ctx.prototype.fillRect = function (x, y, width, height) {\r\n        var rect, parent;\r\n        rect = this.__createElement(\"rect\", {\r\n            x : x,\r\n            y : y,\r\n            width : width,\r\n            height : height\r\n        }, true);\r\n        parent = this.__closestGroupOrSvg();\r\n        parent.appendChild(rect);\r\n        this.__currentElement = rect;\r\n        this.__applyStyleToCurrentElement(\"fill\");\r\n    };\r\n\r\n    /**\r\n     * Draws a rectangle with no fill\r\n     * @param x\r\n     * @param y\r\n     * @param width\r\n     * @param height\r\n     */\r\n    ctx.prototype.strokeRect = function (x, y, width, height) {\r\n        var rect, parent;\r\n        rect = this.__createElement(\"rect\", {\r\n            x : x,\r\n            y : y,\r\n            width : width,\r\n            height : height\r\n        }, true);\r\n        parent = this.__closestGroupOrSvg();\r\n        parent.appendChild(rect);\r\n        this.__currentElement = rect;\r\n        this.__applyStyleToCurrentElement(\"stroke\");\r\n    };\r\n\r\n\r\n    /**\r\n     * Clear entire canvas:\r\n     * 1. save current transforms\r\n     * 2. remove all the childNodes of the root g element\r\n     */\r\n    ctx.prototype.__clearCanvas = function () {\r\n        var current = this.__closestGroupOrSvg(),\r\n            transform = current.getAttribute(\"transform\");\r\n        var rootGroup = this.__root.childNodes[1];\r\n        var childNodes = rootGroup.childNodes;\r\n        for (var i = childNodes.length - 1; i >= 0; i--) {\r\n            if (childNodes[i]) {\r\n                rootGroup.removeChild(childNodes[i]);\r\n            }\r\n        }\r\n        this.__currentElement = rootGroup;\r\n        //reset __groupStack as all the child group nodes are all removed.\r\n        this.__groupStack = [];\r\n        if (transform) {\r\n            this.__addTransform(transform);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * \"Clears\" a canvas by just drawing a white rectangle in the current group.\r\n     */\r\n    ctx.prototype.clearRect = function (x, y, width, height) {\r\n        //clear entire canvas\r\n        if (x === 0 && y === 0 && width === this.width && height === this.height) {\r\n            this.__clearCanvas();\r\n            return;\r\n        }\r\n        var rect, parent = this.__closestGroupOrSvg();\r\n        rect = this.__createElement(\"rect\", {\r\n            x : x,\r\n            y : y,\r\n            width : width,\r\n            height : height,\r\n            fill : \"#FFFFFF\"\r\n        }, true);\r\n        parent.appendChild(rect);\r\n    };\r\n\r\n    /**\r\n     * Adds a linear gradient to a defs tag.\r\n     * Returns a canvas gradient object that has a reference to it's parent def\r\n     */\r\n    ctx.prototype.createLinearGradient = function (x1, y1, x2, y2) {\r\n        var grad = this.__createElement(\"linearGradient\", {\r\n            id : randomString(this.__ids),\r\n            x1 : x1+\"px\",\r\n            x2 : x2+\"px\",\r\n            y1 : y1+\"px\",\r\n            y2 : y2+\"px\",\r\n            \"gradientUnits\" : \"userSpaceOnUse\"\r\n        }, false);\r\n        this.__defs.appendChild(grad);\r\n        return new CanvasGradient(grad, this);\r\n    };\r\n\r\n    /**\r\n     * Adds a radial gradient to a defs tag.\r\n     * Returns a canvas gradient object that has a reference to it's parent def\r\n     */\r\n    ctx.prototype.createRadialGradient = function (x0, y0, r0, x1, y1, r1) {\r\n        var grad = this.__createElement(\"radialGradient\", {\r\n            id : randomString(this.__ids),\r\n            cx : x1+\"px\",\r\n            cy : y1+\"px\",\r\n            r  : r1+\"px\",\r\n            fx : x0+\"px\",\r\n            fy : y0+\"px\",\r\n            \"gradientUnits\" : \"userSpaceOnUse\"\r\n        }, false);\r\n        this.__defs.appendChild(grad);\r\n        return new CanvasGradient(grad, this);\r\n\r\n    };\r\n\r\n    /**\r\n     * Parses the font string and returns svg mapping\r\n     * @private\r\n     */\r\n    ctx.prototype.__parseFont = function () {\r\n        var regex = /^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))(?:\\s*\\/\\s*(normal|[.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])))?\\s*([-,\\'\\\"\\sa-z0-9]+?)\\s*$/i;\r\n        var fontPart = regex.exec( this.font );\r\n        var data = {\r\n            style : fontPart[1] || 'normal',\r\n            size : fontPart[4] || '10px',\r\n            family : fontPart[6] || 'sans-serif',\r\n            weight: fontPart[3] || 'normal',\r\n            decoration : fontPart[2] || 'normal',\r\n            href : null\r\n        };\r\n\r\n        //canvas doesn't support underline natively, but we can pass this attribute\r\n        if (this.__fontUnderline === \"underline\") {\r\n            data.decoration = \"underline\";\r\n        }\r\n\r\n        //canvas also doesn't support linking, but we can pass this as well\r\n        if (this.__fontHref) {\r\n            data.href = this.__fontHref;\r\n        }\r\n\r\n        return data;\r\n    };\r\n\r\n    /**\r\n     * Helper to link text fragments\r\n     * @param font\r\n     * @param element\r\n     * @return {*}\r\n     * @private\r\n     */\r\n    ctx.prototype.__wrapTextLink = function (font, element) {\r\n        if (font.href) {\r\n            var a = this.__createElement(\"a\");\r\n            a.setAttributeNS(\"http://www.w3.org/1999/xlink\", \"xlink:href\", font.href);\r\n            a.appendChild(element);\r\n            return a;\r\n        }\r\n        return element;\r\n    };\r\n\r\n    /**\r\n     * Fills or strokes text\r\n     * @param text\r\n     * @param x\r\n     * @param y\r\n     * @param action - stroke or fill\r\n     * @private\r\n     */\r\n    ctx.prototype.__applyText = function (text, x, y, action) {\r\n        var font = this.__parseFont(),\r\n            parent = this.__closestGroupOrSvg(),\r\n            textElement = this.__createElement(\"text\", {\r\n                \"font-family\" : font.family,\r\n                \"font-size\" : font.size,\r\n                \"font-style\" : font.style,\r\n                \"font-weight\" : font.weight,\r\n                \"text-decoration\" : font.decoration,\r\n                \"x\" : x,\r\n                \"y\" : y,\r\n                \"text-anchor\": getTextAnchor(this.textAlign),\r\n                \"dominant-baseline\": getDominantBaseline(this.textBaseline)\r\n            }, true);\r\n\r\n        textElement.appendChild(this.__document.createTextNode(text));\r\n        this.__currentElement = textElement;\r\n        this.__applyStyleToCurrentElement(action);\r\n        parent.appendChild(this.__wrapTextLink(font,textElement));\r\n    };\r\n\r\n    /**\r\n     * Creates a text element\r\n     * @param text\r\n     * @param x\r\n     * @param y\r\n     */\r\n    ctx.prototype.fillText = function (text, x, y) {\r\n        this.__applyText(text, x, y, \"fill\");\r\n    };\r\n\r\n    /**\r\n     * Strokes text\r\n     * @param text\r\n     * @param x\r\n     * @param y\r\n     */\r\n    ctx.prototype.strokeText = function (text, x, y) {\r\n        this.__applyText(text, x, y, \"stroke\");\r\n    };\r\n\r\n    /**\r\n     * No need to implement this for svg.\r\n     * @param text\r\n     * @return {TextMetrics}\r\n     */\r\n    ctx.prototype.measureText = function (text) {\r\n        this.__ctx.font = this.font;\r\n        return this.__ctx.measureText(text);\r\n    };\r\n\r\n    /**\r\n     *  Arc command!\r\n     */\r\n    ctx.prototype.arc = function (x, y, radius, startAngle, endAngle, counterClockwise) {\r\n        // in canvas no circle is drawn if no angle is provided.\r\n        if (startAngle === endAngle) {\r\n            return;\r\n        }\r\n        startAngle = startAngle % (2*Math.PI);\r\n        endAngle = endAngle % (2*Math.PI);\r\n        if (startAngle === endAngle) {\r\n            //circle time! subtract some of the angle so svg is happy (svg elliptical arc can't draw a full circle)\r\n            endAngle = ((endAngle + (2*Math.PI)) - 0.001 * (counterClockwise ? -1 : 1)) % (2*Math.PI);\r\n        }\r\n        var endX = x+radius*Math.cos(endAngle),\r\n            endY = y+radius*Math.sin(endAngle),\r\n            startX = x+radius*Math.cos(startAngle),\r\n            startY = y+radius*Math.sin(startAngle),\r\n            sweepFlag = counterClockwise ? 0 : 1,\r\n            largeArcFlag = 0,\r\n            diff = endAngle - startAngle;\r\n\r\n        // https://github.com/gliffy/canvas2svg/issues/4\r\n        if (diff < 0) {\r\n            diff += 2*Math.PI;\r\n        }\r\n\r\n        if (counterClockwise) {\r\n            largeArcFlag = diff > Math.PI ? 0 : 1;\r\n        } else {\r\n            largeArcFlag = diff > Math.PI ? 1 : 0;\r\n        }\r\n\r\n        this.lineTo(startX, startY);\r\n        this.__addPathCommand(format(\"A {rx} {ry} {xAxisRotation} {largeArcFlag} {sweepFlag} {endX} {endY}\",\r\n            {rx:radius, ry:radius, xAxisRotation:0, largeArcFlag:largeArcFlag, sweepFlag:sweepFlag, endX:endX, endY:endY}));\r\n\r\n        this.__currentPosition = {x: endX, y: endY};\r\n    };\r\n\r\n    /**\r\n     * Generates a ClipPath from the clip command.\r\n     */\r\n    ctx.prototype.clip = function () {\r\n        var group = this.__closestGroupOrSvg(),\r\n            clipPath = this.__createElement(\"clipPath\"),\r\n            id =  randomString(this.__ids),\r\n            newGroup = this.__createElement(\"g\");\r\n\r\n        this.__applyCurrentDefaultPath();\r\n        group.removeChild(this.__currentElement);\r\n        clipPath.setAttribute(\"id\", id);\r\n        clipPath.appendChild(this.__currentElement);\r\n\r\n        this.__defs.appendChild(clipPath);\r\n\r\n        //set the clip path to this group\r\n        group.setAttribute(\"clip-path\", format(\"url(#{id})\", {id:id}));\r\n\r\n        //clip paths can be scaled and transformed, we need to add another wrapper group to avoid later transformations\r\n        // to this path\r\n        group.appendChild(newGroup);\r\n\r\n        this.__currentElement = newGroup;\r\n\r\n    };\r\n\r\n    /**\r\n     * Draws a canvas, image or mock context to this canvas.\r\n     * Note that all svg dom manipulation uses node.childNodes rather than node.children for IE support.\r\n     * http://www.whatwg.org/specs/web-apps/current-work/multipage/the-canvas-element.html#dom-context-2d-drawimage\r\n     */\r\n    ctx.prototype.drawImage = function () {\r\n        //convert arguments to a real array\r\n        var args = Array.prototype.slice.call(arguments),\r\n            image=args[0],\r\n            dx, dy, dw, dh, sx=0, sy=0, sw, sh, parent, svg, defs, group,\r\n            svgImage, canvas, context, id;\r\n\r\n        if (args.length === 3) {\r\n            dx = args[1];\r\n            dy = args[2];\r\n            sw = image.width;\r\n            sh = image.height;\r\n            dw = sw;\r\n            dh = sh;\r\n        } else if (args.length === 5) {\r\n            dx = args[1];\r\n            dy = args[2];\r\n            dw = args[3];\r\n            dh = args[4];\r\n            sw = image.width;\r\n            sh = image.height;\r\n        } else if (args.length === 9) {\r\n            sx = args[1];\r\n            sy = args[2];\r\n            sw = args[3];\r\n            sh = args[4];\r\n            dx = args[5];\r\n            dy = args[6];\r\n            dw = args[7];\r\n            dh = args[8];\r\n        } else {\r\n            throw new Error(\"Inavlid number of arguments passed to drawImage: \" + arguments.length);\r\n        }\r\n\r\n        parent = this.__closestGroupOrSvg();\r\n        this.__currentElement;\r\n        var translateDirective = \"translate(\" + dx + \", \" + dy + \")\";\r\n        if (image instanceof ctx) {\r\n            //canvas2svg mock canvas context. In the future we may want to clone nodes instead.\r\n            //also I'm currently ignoring dw, dh, sw, sh, sx, sy for a mock context.\r\n            svg = image.getSvg().cloneNode(true);\r\n            if (svg.childNodes && svg.childNodes.length > 1) {\r\n                defs = svg.childNodes[0];\r\n                while(defs.childNodes.length) {\r\n                    id = defs.childNodes[0].getAttribute(\"id\");\r\n                    this.__ids[id] = id;\r\n                    this.__defs.appendChild(defs.childNodes[0]);\r\n                }\r\n                group = svg.childNodes[1];\r\n                if (group) {\r\n                    //save original transform\r\n                    var originTransform = group.getAttribute(\"transform\");\r\n                    var transformDirective;\r\n                    if (originTransform) {\r\n                        transformDirective = originTransform+\" \"+translateDirective;\r\n                    } else {\r\n                        transformDirective = translateDirective;\r\n                    }\r\n                    group.setAttribute(\"transform\", transformDirective);\r\n                    parent.appendChild(group);\r\n                }\r\n            }\r\n        } else if (image.nodeName === \"IMG\") {\r\n            svgImage = this.__createElement(\"image\");\r\n            svgImage.setAttribute(\"width\", dw);\r\n            svgImage.setAttribute(\"height\", dh);\r\n            svgImage.setAttribute(\"preserveAspectRatio\", \"none\");\r\n\r\n            if (sx || sy || sw !== image.width || sh !== image.height) {\r\n                //crop the image using a temporary canvas\r\n                canvas = this.__document.createElement(\"canvas\");\r\n                canvas.width = dw;\r\n                canvas.height = dh;\r\n                context = canvas.getContext(\"2d\");\r\n                context.drawImage(image, sx, sy, sw, sh, 0, 0, dw, dh);\r\n                image = canvas;\r\n            }\r\n            svgImage.setAttribute(\"transform\", translateDirective);\r\n            svgImage.setAttributeNS(\"http://www.w3.org/1999/xlink\", \"xlink:href\",\r\n                image.nodeName === \"CANVAS\" ? image.toDataURL() : image.getAttribute(\"src\"));\r\n            parent.appendChild(svgImage);\r\n        } else if (image.nodeName === \"CANVAS\") {\r\n            svgImage = this.__createElement(\"image\");\r\n            svgImage.setAttribute(\"width\", dw);\r\n            svgImage.setAttribute(\"height\", dh);\r\n            svgImage.setAttribute(\"preserveAspectRatio\", \"none\");\r\n\r\n            // draw canvas onto temporary canvas so that smoothing can be handled\r\n            canvas = this.__document.createElement(\"canvas\");\r\n            canvas.width = dw;\r\n            canvas.height = dh;\r\n            context = canvas.getContext(\"2d\");\r\n            context.imageSmoothingEnabled = false;\r\n            context.mozImageSmoothingEnabled = false;\r\n            context.oImageSmoothingEnabled = false;\r\n            context.webkitImageSmoothingEnabled = false;\r\n            context.drawImage(image, sx, sy, sw, sh, 0, 0, dw, dh);\r\n            image = canvas;\r\n\r\n            svgImage.setAttribute(\"transform\", translateDirective);\r\n            svgImage.setAttributeNS(\"http://www.w3.org/1999/xlink\", \"xlink:href\", image.toDataURL());\r\n            parent.appendChild(svgImage);\r\n        }\r\n    };\r\n\r\n    ctx.prototype.drawImageSvg = function () {\r\n        //convert arguments to a real array\r\n        var args = Array.prototype.slice.call(arguments),\r\n            image=args[0],\r\n            dx, dy, dw, dh, sw, sh, parent, defs, group,\r\n            id;\r\n\r\n        if (args.length === 3) {\r\n            dx = args[1];\r\n            dy = args[2];\r\n            sw = image.width;\r\n            sh = image.height;\r\n            dw = sw;\r\n            dh = sh;\r\n        } else if (args.length === 5) {\r\n            dx = args[1];\r\n            dy = args[2];\r\n            dw = args[3];\r\n            dh = args[4];\r\n            sw = image.width;\r\n            sh = image.height;\r\n        } else if (args.length === 9) {\r\n            args[1];\r\n            args[2];\r\n            sw = args[3];\r\n            sh = args[4];\r\n            dx = args[5];\r\n            dy = args[6];\r\n            dw = args[7];\r\n            dh = args[8];\r\n        } else {\r\n            throw new Error(\"Inavlid number of arguments passed to drawImage: \" + arguments.length);\r\n        }\r\n\r\n        parent = this.__closestGroupOrSvg();\r\n        this.__currentElement;\r\n        var translateDirective = \"translate(\" + dx + \", \" + dy + \")\";\r\n        if (image instanceof SVGSVGElement) {\r\n            if (image.childNodes && image.childNodes.length > 1) {\r\n                var orgWidth = parseFloat(image.getAttribute(\"width\"));\r\n                var orgHeight = parseFloat(image.getAttribute(\"height\"));\r\n                image.setAttribute(\"width\", dw);\r\n                image.setAttribute(\"height\", dh);\r\n                var scaleW = dw / orgWidth;\r\n                var scaleH = dh / orgHeight;\r\n                defs = image.childNodes[0];\r\n                while(defs.childNodes.length) {\r\n                    id = defs.childNodes[0].getAttribute(\"id\");\r\n                    this.__ids[id] = id;\r\n                    this.__defs.appendChild(defs.childNodes[0]);\r\n                }\r\n                group = image.childNodes[1];\r\n                if (group) {\r\n                    //save original transform\r\n                    var originTransform = group.getAttribute(\"transform\");\r\n                    var transformDirective;\r\n                    if (originTransform) {\r\n                        transformDirective = originTransform+\" \"+translateDirective;\r\n                    } else {\r\n                        transformDirective = translateDirective;\r\n                    }\r\n                    group.setAttribute(\"transform\", transformDirective + \" scale(\" + scaleW + \", \" + scaleH +\")\");\r\n                    parent.appendChild(group);\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Generates a pattern tag\r\n     */\r\n    ctx.prototype.createPattern = function (image, repetition) {\r\n        var pattern = this.__document.createElementNS(\"http://www.w3.org/2000/svg\", \"pattern\"), id = randomString(this.__ids),\r\n            img;\r\n        pattern.setAttribute(\"id\", id);\r\n        pattern.setAttribute(\"width\", image.width);\r\n        pattern.setAttribute(\"height\", image.height);\r\n        if (image.nodeName === \"CANVAS\" || image.nodeName === \"IMG\") {\r\n            img = this.__document.createElementNS(\"http://www.w3.org/2000/svg\", \"image\");\r\n            img.setAttribute(\"width\", image.width);\r\n            img.setAttribute(\"height\", image.height);\r\n            img.setAttributeNS(\"http://www.w3.org/1999/xlink\", \"xlink:href\",\r\n                image.nodeName === \"CANVAS\" ? image.toDataURL() : image.getAttribute(\"src\"));\r\n            pattern.appendChild(img);\r\n            this.__defs.appendChild(pattern);\r\n        } else if (image instanceof ctx) {\r\n            pattern.appendChild(image.__root.childNodes[1]);\r\n            this.__defs.appendChild(pattern);\r\n        }\r\n        return new CanvasPattern(pattern, this);\r\n    };\r\n\r\n    ctx.prototype.setLineDash = function (dashArray) {\r\n        if (dashArray && dashArray.length > 0) {\r\n            this.lineDash = dashArray.join(\",\");\r\n        } else {\r\n            this.lineDash = null;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Not yet implemented\r\n     */\r\n    ctx.prototype.drawFocusRing = function () {};\r\n    ctx.prototype.createImageData = function () {};\r\n    ctx.prototype.getImageData = function () {};\r\n    ctx.prototype.putImageData = function () {};\r\n    ctx.prototype.globalCompositeOperation = function () {};\r\n    ctx.prototype.setTransform = function () {};\r\n\r\n    var ctx$1 = ctx;\r\n\r\nexport default ctx$1;\r\n","/** @module */\r\n\r\nimport C2S from '../lib/snowpack/build/snowpack/pkg/@mithrandirii/canvas2svg.js'\r\n/**\r\n * add a button so that we can generate an SVG of what is being rendered\r\n * @param {Object} screen the screen where the drawing context is.\r\n * We will temporarily change the drawing context.\r\n * @param {Object} draw the drawing function that renders drawings to the context.\r\n * @param {Layout} layout\r\n */\r\nexport default function addSVGOutput(screen, draw, layout) {\r\n    const w = screen.width\r\n    const h = screen.height\r\n\r\n    const svgUIDiv = document.createElement('div')\r\n    layout.newElement('svgUIDiv', svgUIDiv)\r\n\r\n    // svg output button\r\n    const button = document.createElement('button')\r\n    button.className = 'button2'\r\n    button.innerText = 'Make SVG'\r\n    button.onclick = makeSVG\r\n    svgUIDiv.appendChild(button)\r\n\r\n    // svg download link\r\n    const downloadLink = document.createElement('a')\r\n    downloadLink.innerText = 'Download SVG'\r\n    downloadLink.download = 'vote.svg'\r\n    downloadLink.hidden = true\r\n    downloadLink.style.margin = '4px'\r\n    svgUIDiv.appendChild(downloadLink)\r\n\r\n    // svg download link for maps\r\n    const mDownloadLink = document.createElement('a')\r\n    mDownloadLink.innerText = 'Download Map SVG'\r\n    mDownloadLink.download = 'vote_map.svg'\r\n    mDownloadLink.hidden = true\r\n    mDownloadLink.style.margin = '4px'\r\n    svgUIDiv.appendChild(mDownloadLink)\r\n\r\n    // svg hide button\r\n    const svgHideButton = document.createElement('button')\r\n    svgHideButton.className = 'button2'\r\n    svgHideButton.innerText = 'Hide SVG'\r\n    svgHideButton.hidden = true\r\n    svgHideButton.onclick = hideSVG\r\n    svgUIDiv.appendChild(svgHideButton)\r\n\r\n    // hidden svg output div\r\n    const svgDiv = document.createElement('div')\r\n    svgDiv.setAttribute('class', 'svgDiv')\r\n    svgDiv.style.width = `${w}px`\r\n    svgDiv.style.height = `${h}px`\r\n    svgDiv.hidden = true\r\n    svgUIDiv.appendChild(svgDiv)\r\n\r\n    // hidden svg output div for maps\r\n    const mSvgDiv = document.createElement('div')\r\n    mSvgDiv.setAttribute('class', 'mSvgDiv')\r\n    mSvgDiv.style.width = `${w}px`\r\n    mSvgDiv.style.height = `${Math.round(h / 3)}px`\r\n    mSvgDiv.hidden = true\r\n    svgUIDiv.appendChild(mSvgDiv)\r\n\r\n    const svgCtx = new C2S(w, h)\r\n    const svgMCtx = new C2S(w, Math.round(h / 3))\r\n\r\n    function setHeightGCtx(height) {\r\n        mSvgDiv.style.height = `${Math.round(height)}px`\r\n        mSvgDiv.height = height\r\n        // eslint-disable-next-line no-underscore-dangle\r\n        svgMCtx.__root.setAttribute('height', height)\r\n    }\r\n\r\n    function makeSVG() {\r\n        // temporarily swap drawing context, render SVG,\r\n        // then output SVG to div and to a download link\r\n\r\n        // set\r\n        const old = screen.ctx\r\n        const oldF = screen.fctx\r\n        screen.setCtx(svgCtx)\r\n        screen.setFCtx(svgCtx)\r\n        screen.setNoBuffers(true)\r\n\r\n        const oldM = screen.mctx\r\n        screen.setMCtx(svgMCtx)\r\n\r\n        // update\r\n        const { heightBrowser } = screen.maps\r\n        setHeightGCtx(heightBrowser)\r\n\r\n        // draw\r\n        draw()\r\n        outputSVG()\r\n        outputMSVG()\r\n\r\n        // unset\r\n        screen.setCtx(old)\r\n        screen.setFCtx(oldF)\r\n        screen.setNoBuffers(false)\r\n\r\n        screen.setMCtx(oldM)\r\n    }\r\n\r\n    function outputSVG() {\r\n        svgHideButton.hidden = false\r\n\r\n        const svg = svgCtx.getSerializedSvg(true)\r\n        svgDiv.innerHTML = svg\r\n        svgDiv.hidden = false\r\n        downloadLink.hidden = false\r\n        const url = `data:image/svg+xml;charset=utf-8,${encodeURIComponent(svg)}`\r\n        downloadLink.href = url\r\n    }\r\n    function outputMSVG() {\r\n        const mSvg = svgMCtx.getSerializedSvg(true)\r\n        mSvgDiv.innerHTML = mSvg\r\n        mSvgDiv.hidden = false\r\n        mDownloadLink.hidden = false\r\n        const mUrl = `data:image/svg+xml;charset=utf-8,${encodeURIComponent(mSvg)}`\r\n        mDownloadLink.href = mUrl\r\n    }\r\n\r\n    function hideSVG() {\r\n        svgHideButton.hidden = true\r\n\r\n        svgDiv.hidden = true\r\n        downloadLink.hidden = true\r\n\r\n        mSvgDiv.hidden = true\r\n        mDownloadLink.hidden = true\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Class for a single button.\r\n * @param {*} buttonConfig\r\n * @param {*} onChoose\r\n * @constructor\r\n */\r\nexport default function Button(buttonConfig, onChoose) {\r\n    const self = this\r\n\r\n    self.config = buttonConfig\r\n    self.name = buttonConfig.name\r\n    self.nameIsHTML = buttonConfig.nameIsHTML || false\r\n    self.dom = document.createElement('div')\r\n    self.dom.setAttribute('class', 'button button2')\r\n\r\n    // overwrite margins.  The old way was not working.\r\n    let fixMargin = buttonConfig.margin\r\n    fixMargin = fixMargin || 0\r\n    fixMargin = Math.max(fixMargin, 4)\r\n    self.dom.style.marginRight = `${fixMargin}px`\r\n\r\n    // Click!\r\n    self.draw = function () {\r\n        if (self.nameIsHTML) {\r\n            self.dom.innerHTML = self.name\r\n        } else {\r\n            self.dom.innerText = self.name\r\n        }\r\n    }\r\n    self.draw()\r\n    self.dom.setAttribute('title', buttonConfig.realname || '')\r\n    self.onClick = function () {\r\n        onChoose(self, buttonConfig)\r\n    }\r\n    self.dom.onclick = self.onClick\r\n    // Turn on or off!\r\n    self.turnOff = function () {\r\n        self.isOn = false\r\n        self.config.isOn = false\r\n        self.dom.setAttribute('on', 'no')\r\n    }\r\n    self.turnOn = function () {\r\n        self.isOn = true\r\n        self.config.isOn = true\r\n        self.dom.setAttribute('on', 'yes')\r\n    }\r\n    self.turnOff()\r\n}\r\n","/** @module */\r\n\r\nimport Button from './Button.js'\r\n\r\n/**\r\n * Create a group of buttons.\r\n * @param {*} config\r\n * @constructor\r\n */\r\nexport default function ButtonGroup(config) {\r\n    const self = this\r\n    self.config = config\r\n\r\n    // check if there is a function to make the data\r\n    // this function can be used later to update the buttons\r\n    if (config.data === undefined) {\r\n        config.data = []\r\n        if (config.makeData === undefined) {\r\n            config.makeData = () => []\r\n        }\r\n        self.makeData = config.makeData\r\n        self.buttonConfigs = self.makeData()\r\n        self.doMakeData = true\r\n    }\r\n    self.buttonConfigs = config.data\r\n\r\n    self.labelName = config.label\r\n    self.labelIsHTML = config.labelIsHTML || false\r\n\r\n    self.onChoose = config.onChoose\r\n    self.isCheckbox = config.isCheckbox || false\r\n    self.isCheckboxBool = config.isCheckboxBool || false\r\n    self.justButton = config.justButton || false\r\n    self.buttonHidden = config.buttonHidden || {}\r\n\r\n    // DOM!\r\n    self.dom = document.createElement('div')\r\n    self.dom.setAttribute('class', 'button-group')\r\n\r\n    self.buttonDOMByValue = []\r\n\r\n    self.init = function () {\r\n        if (self.doMakeData) self.buttonConfigs = self.makeData()\r\n\r\n        // clear\r\n        self.dom.innerHTML = ''\r\n        self.buttons = []\r\n        self.buttonsByName = {}\r\n\r\n        // Label!\r\n        self.labelDOM = document.createElement('div')\r\n        self.labelDOM.setAttribute('class', 'button-group-label')\r\n        self.draw()\r\n        self.dom.appendChild(self.labelDOM)\r\n\r\n        // Create & place buttons!\r\n        for (let i = 0; i < self.buttonConfigs.length; i++) {\r\n            const conf = self.buttonConfigs[i]\r\n            const button = new Button(conf, self.onToggle)\r\n            self.buttonsByName[conf.name] = button\r\n            button.dom.style.width = `${config.width}px` // whatever\r\n            if (conf.width) button.dom.style.width = `${conf.width}px` // whatever\r\n            self.buttons.push(button)\r\n            self.dom.appendChild(button.dom)\r\n            self.buttonDOMByValue[conf.value] = button.dom\r\n        }\r\n\r\n        // And then select the one that says \"selected\"! Fake a click.\r\n        for (let i = 0; i < self.buttons.length; i++) {\r\n            const button = self.buttons[i]\r\n            if (button.config.selected) {\r\n                button.turnOn()\r\n                break\r\n            }\r\n        }\r\n        self.draw()\r\n    }\r\n    self.updateNames = function () {\r\n        const data2 = self.makeData()\r\n        for (let i = 0; i < self.buttonConfigs.length; i++) {\r\n            self.buttonConfigs[i].name = data2[i].name\r\n            self.buttons[i].name = self.buttonConfigs[i].name\r\n        }\r\n    }\r\n    self.redraw = function () {\r\n        self.updateNames()\r\n        self.draw()\r\n    }\r\n    self.draw = function () {\r\n        if (self.labelIsHTML) {\r\n            self.labelDOM.innerHTML = self.labelName\r\n        } else {\r\n            self.labelDOM.innerText = self.labelName\r\n        }\r\n        for (const button of self.buttons) {\r\n            button.draw()\r\n        }\r\n    }\r\n\r\n    self.configureHidden = function () {\r\n        for (const [buttonName, hidden] of Object.entries(self.buttonHidden)) {\r\n            self.buttonsByName[buttonName].dom.hidden = hidden\r\n        }\r\n    }\r\n\r\n    // Toggle buttons\r\n    self.onToggle = function (button, buttonData) {\r\n        if (self.isCheckbox || self.isCheckboxBool) {\r\n            if (button.isOn) {\r\n                button.turnOff()\r\n            } else {\r\n                button.turnOn()\r\n            }\r\n        } else { // justButton means it doesn't get selected\r\n            // Turn all off\r\n            for (let i = 0; i < self.buttons.length; i++) self.buttons[i].turnOff()\r\n            button.turnOn() // except one\r\n            if (self.justButton) {\r\n                // turn on for a little while, then off\r\n                setTimeout(() => button.turnOff(), 800)\r\n            }\r\n        }\r\n        // And send the data up\r\n        self.onChoose(buttonData)\r\n    }\r\n\r\n    // Highlight based on data...\r\n    self.highlight = function (propName, propValue) {\r\n        // if we haven't set up the buttons yet, then don't do anything yet\r\n        if (self.buttons.length === 0) return\r\n\r\n        // Turn all off\r\n        for (let i = 0; i < self.buttons.length; i++) self.buttons[i].turnOff()\r\n\r\n        if (self.isCheckbox) {\r\n            for (const ibu in self.buttons) {\r\n                const bu = self.buttons[ibu]\r\n                if (propValue.includes(bu.config[propName])) { // the propValue is an array of values\r\n                    bu.turnOn()\r\n                }\r\n            }\r\n        } else if (self.isCheckboxBool) {\r\n            for (const ibu in self.buttons) {\r\n                const bu = self.buttons[ibu]\r\n                const buttonName = bu.config[propName]\r\n                // if (Object.keys(propValue).includes(buttonName)) { // the propValue is an array of values\r\n                if (buttonName in propValue) {\r\n                    if (propValue[buttonName]) {\r\n                        bu.turnOn()\r\n                    }\r\n                }\r\n            }\r\n        } else {\r\n            // Find the one...\r\n            const theButton = self.buttons.filter((button) => {\r\n                const { config } = button\r\n                return (config[propName] === propValue)\r\n            })[0]\r\n            if (theButton !== undefined) {\r\n                theButton.turnOn()\r\n            }\r\n        }\r\n    }\r\n\r\n    self.init()\r\n}\r\n","/** @module */\r\n\r\nimport ButtonGroup from './ButtonGroup.js'\r\n\r\n/**\r\n * Make a selection that determines a single property's value.\r\n * Defer handling dependent calculations to the next update step,\r\n * where we will look at a dependency tree to determine what else needs updating.\r\n * Functionality here is called from button presses.\r\n * Functionality here is also called from a command pattern (commander).\r\n * @param {Object.<string>} object\r\n * @param {(String|Number|Boolean)} object.prop - The property being selected in the menu.\r\n * @param {String} prop - Name of prop\r\n * @param {MenuItem~setProp} setProp - The action that is performed as part of onclick.\r\n * @param {String} label - The prompt presented to the user.\r\n * @param {Object[]} options - the list of options that the UI presents to the user.\r\n * @param {(String|Number|Boolean)} options[].value - Value to pass to setProp\r\n * @param {String[]} change - list of changes made when pressing a button.\r\n * @param {Changes} changes\r\n * @param {Commander} commander - Follows command pattern.\r\n * @constructor\r\n */\r\n// eslint-disable-next-line max-len\r\nexport default function MenuItem(object, prop, setProp, label, options, change, changes, commander) {\r\n    const self = this\r\n    self.list = options\r\n    self.onChoose = function (data) {\r\n        self.sender.go(data.value)\r\n    }\r\n    self.action = (value) => {\r\n        self.set(value)\r\n        self.select()\r\n    }\r\n    self.sender = commander.addSender({\r\n        name: prop,\r\n        action: self.action,\r\n        currentValue: object[prop],\r\n    })\r\n    self.set = function (value) {\r\n        // LOAD INPUT\r\n\r\n        setProp(value)\r\n        // CONFIGURE\r\n        self.configure()\r\n        // UPDATE\r\n        changes.add(change)\r\n    }\r\n    self.choose = new ButtonGroup({\r\n        label,\r\n        width: buttonWidth(3),\r\n        data: self.list,\r\n        onChoose: self.onChoose,\r\n    })\r\n    self.configure = function () {\r\n    }\r\n    self.select = function () {\r\n        self.choose.highlight('value', object[prop])\r\n    }\r\n}\r\n\r\nfunction buttonWidth(numButtons) {\r\n    const padding = 4\r\n    const border = 1\r\n    const margin = 4\r\n    const between = (padding + border + margin) * 2\r\n    const end = padding + border\r\n    const width = 302\r\n    const usableSpace = width - between * (numButtons - 1) - 2 * end\r\n    const buttonWidth1 = usableSpace / numButtons\r\n    return buttonWidth1\r\n}\r\n","/** @module */\r\n\r\nimport MenuItem from './MenuItem.js'\r\n\r\n/**\r\n * Make a menu.\r\n * @param {Changes} changes\r\n * @param {Layout} layout\r\n * @param {Commander} commander - Follows command pattern.\r\n * @constructor\r\n */\r\nexport default function Menu(changes, layout, commander) {\r\n    const self = this\r\n    self.divMenu = document.createElement('div')\r\n    layout.newElement('menu', self.divMenu)\r\n    self.addMenuItem = function (object, choice) {\r\n        const {\r\n            prop, setProp, label, options, change,\r\n        } = choice\r\n\r\n        // eslint-disable-next-line max-len\r\n        const menuItem = new MenuItem(object, prop, setProp, label, options, change, changes, commander)\r\n        menuItem.select()\r\n\r\n        self.divMenu.appendChild(menuItem.choose.dom)\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * CandidateSim has functionality for a candidate that is specific to a simulation.\r\n * CandidateSim has a candidate component.\r\n * The candidate component is a Candidate, for now.\r\n\r\n * @param {Candidate} candidate - a candidate component that CandidateSim builds upon.\r\n * @param {DraggableManager} dragm\r\n * @constructor\r\n */\r\nexport default function CandidateSim(candidate, dragm) {\r\n    const self = this\r\n    self.candidate = candidate\r\n\r\n    dragm.newSquareHandle(candidate, candidate.square)\r\n\r\n    self.renderForeground = () => {\r\n        self.candidate.renderForeground()\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n *\r\n * A simple list of candidateDnSim instances.\r\n * It really just passes along function calls to each member of the list.\r\n * It also checks if that member exists. Alternatively, it was deleted.\r\n * @constructor\r\n */\r\nexport default function CandidateSimList(sim) {\r\n    const self = this\r\n\r\n    const simCans = []\r\n\r\n    self.newCandidate = function (simCan) {\r\n        simCans.push(simCan)\r\n    }\r\n\r\n    self.getSimCandidates = () => simCans.filter((simCan) => simCan.candidate.exists)\r\n\r\n    self.getCandidates = () => {\r\n        const simCansEx = self.getSimCandidates()\r\n        return simCansEx.map((simCan) => simCan.candidate)\r\n    }\r\n\r\n    self.getCandidatesAll = () => simCans.map((simCan) => simCan.candidate)\r\n\r\n    self.setCandidateFractions = (fractions) => {\r\n        const cans = self.getCandidates()\r\n        cans.forEach((can, index) => {\r\n            const fraction = fractions[index]\r\n            can.setFraction(fraction)\r\n        })\r\n    }\r\n    self.setCandidateWins = (winsByCandidate) => {\r\n        const cans = self.getCandidates()\r\n        cans.forEach((can, index) => {\r\n            const win = winsByCandidate[index]\r\n            can.setWins(win)\r\n        })\r\n    }\r\n    self.updateXY = () => {\r\n        simCans.forEach((simCan) => simCan.candidate.updateXY())\r\n    }\r\n    self.renderForeground = () => {\r\n        if (sim.showGhosts) {\r\n            self.renderForegroundAll()\r\n        } else {\r\n            self.renderForegroundExisting()\r\n        }\r\n    }\r\n    self.renderForegroundExisting = () => {\r\n        const cans = self.getCandidates()\r\n        cans.forEach((can) => can.renderForeground())\r\n    }\r\n    self.renderForegroundAll = () => {\r\n        const cans = self.getCandidatesAll()\r\n        cans.forEach((can) => can.renderForeground())\r\n    }\r\n    self.numCandidates = () => simCans.length\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Made a super class, VoterSimList.\r\n * VoterGeoList inherits from VoterSimList.\r\n * There is no VoterOne because there isn't any additional functionality that VoterOne would need.\r\n * VoterSimList is different from voterRegistrar\r\n * because it is a list of VoterSim objects rather than VoterShape objects.\r\n * @constructor\r\n */\r\nexport default function VoterSimList(sim) {\r\n    const self = this\r\n\r\n    const list = []\r\n    self.list = list\r\n\r\n    self.newVoterSim = function (voterGroup) {\r\n        list.push(voterGroup)\r\n    }\r\n\r\n    self.getVoterShapes = () => list.filter((v) => v.voterShape.exists).map((v) => v.voterShape)\r\n    self.getVoterSims = () => list.filter((v) => v.voterShape.exists)\r\n\r\n    self.update = (candidates) => {\r\n        list.forEach((v) => { if (v.voterShape.exists) v.update(candidates) })\r\n    }\r\n    self.updateXY = () => {\r\n        list.forEach((v) => v.voterShape.updateXY())\r\n    }\r\n\r\n    self.render = () => {\r\n        list.forEach((v) => { if (v.voterShape.exists) v.render() })\r\n    }\r\n\r\n    self.renderForeground = () => {\r\n        if (sim.showGhosts) {\r\n            self.renderForegroundAll()\r\n        } else {\r\n            self.renderForegroundExisting()\r\n        }\r\n    }\r\n    self.renderForegroundExisting = () => {\r\n        list.forEach((v) => { if (v.voterShape.exists) v.renderForeground() })\r\n    }\r\n    self.renderForegroundAll = () => {\r\n        list.forEach((v) => { v.renderForeground() })\r\n    }\r\n}\r\n","/**\r\n * Javascript Utilities\r\n * Just a few helpful functions that are self-contained and don't need much context.\r\n * @module */\r\n\r\n/**\r\n * List the indices of an array of length n.\r\n * @param {Number} n - length of array\r\n * @returns {Number[]} - A number array from 0 to n-1.\r\n */\r\nexport function range(n) {\r\n    return [...Array(n).keys()]\r\n}\r\n\r\n/**\r\n * Try to deepcopy an object.\r\n * @param {Object} a - an object to copy.\r\n * @returns {Object} A copy of a.\r\n */\r\nexport function jcopy(a) {\r\n    return JSON.parse(JSON.stringify(a))\r\n}\r\n\r\n/** https://stackoverflow.com/a/35810961 */\r\nfunction sortObjByKey(value) {\r\n    // eslint-disable-next-line no-nested-ternary\r\n    return (typeof value === 'object')\r\n        ? (Array.isArray(value)\r\n            ? value.map(sortObjByKey)\r\n            : Object.keys(value).sort().reduce((o, key) => {\r\n                const v = value[key]\r\n                // eslint-disable-next-line no-param-reassign\r\n                o[key] = sortObjByKey(v)\r\n                return o\r\n            }, {})\r\n        )\r\n        : value\r\n}\r\n\r\nexport function orderedJsonStringify(obj) {\r\n    return JSON.stringify(sortObjByKey(obj), null, '\\t')\r\n}\r\n\r\nexport function normPDF(x, mean, sd) {\r\n    const coef = 1 / (sd * Math.sqrt(2 * Math.PI))\r\n    return coef * Math.exp(-0.5 * ((x - mean) / sd) ** 2)\r\n}\r\n\r\nexport function normCDF(x, mean, sd) {\r\n    if (x === Infinity) {\r\n        return 1\r\n    } if (x === -Infinity) {\r\n        return 0\r\n    }\r\n    return 0.5 * erf((x - mean) / (sd * Math.sqrt(2))) + 0.5\r\n}\r\n\r\nfunction erf(x) {\r\n    const ERF_A = 0.147\r\n    const x2 = x ** 2\r\n    const down = 1 + ERF_A * x2\r\n    const up = 4 / Math.PI + ERF_A * x2\r\n    const ratio = -(up / down) * x2\r\n    const expofun = Math.exp(ratio)\r\n    const radical = Math.sqrt(1 - expofun)\r\n    const z = radical * Math.sign(x)\r\n    return z\r\n}\r\n\r\n/** https://stackoverflow.com/a/47355187 */\r\nexport function standardizeColor(str) {\r\n    const canvas = document.createElement('canvas')\r\n    const ctx = canvas.getContext('2d')\r\n    ctx.fillStyle = str\r\n    const sColor = ctx.fillStyle\r\n    canvas.remove()\r\n    return sColor\r\n}\r\n\r\nexport function minIndex(a) {\r\n    let min = Infinity\r\n    let iClosest = null\r\n    for (let i = 0; i < a.length; i++) {\r\n        const d = a[i]\r\n        if (d < min) {\r\n            min = d\r\n            iClosest = i\r\n        }\r\n    }\r\n    return iClosest\r\n}\r\nexport function maxIndex(a) {\r\n    let max = -Infinity\r\n    let iMax = null\r\n    for (let i = 0; i < a.length; i++) {\r\n        const d = a[i]\r\n        if (d > max) {\r\n            max = d\r\n            iMax = i\r\n        }\r\n    }\r\n    return iMax\r\n}\r\n\r\nexport function minMax(a) {\r\n    let min = a[0]\r\n    let max = a[0]\r\n    for (let i = 0; i < a.length; i++) {\r\n        const d = a[i]\r\n        if (d < min) {\r\n            min = d\r\n        }\r\n        if (d > max) {\r\n            max = d\r\n        }\r\n    }\r\n    return [min, max]\r\n}\r\n\r\n/** https://stackoverflow.com/a/24719569 */\r\nexport function clamp(value, min, max) {\r\n    if (value < min) return min\r\n    if (value > max) return max\r\n    return value\r\n}\r\n","/** @module */\r\n\r\nimport { clamp, minIndex } from '../utilities/jsHelpers.js'\r\n\r\n/**\r\n * Draggable Manager gives draggable behavior to objects on a canvas.\r\n * If anything changes, an item is added to the \"changes\" array.\r\n * Calling screen.setEventHandlers(dragm.eventHandlers) sets the eventhandlers on the screen.\r\n * @param {Screen} screen\r\n * @param {Changes} changes\r\n * @constructor\r\n */\r\nexport default function DraggableManager(screen, changes, sim) {\r\n    const self = this\r\n\r\n    // private variables\r\n    let drag = {}\r\n    const draggables = []\r\n\r\n    const grabCanvas = screen.tooltips\r\n\r\n    // add draggable objects\r\n    self.newSquareHandle = function (o, g) {\r\n        // set properties here so that we don't set properties on the actual object\r\n        const p = { isSquare: true }\r\n        draggables.push({ o, g, p })\r\n    }\r\n    self.newCircleHandle = function (o, g) { // object, graphic\r\n        const p = { isCircle: true }\r\n        draggables.push({ o, g, p })\r\n    }\r\n\r\n    // Mouse Listeners\r\n    // As a sidenote, it is interesting that we don't need to call model.update here\r\n    // because we are using a game loop that will call model.update.\r\n    const start = function (event) {\r\n        // don't interact with stuff underneath a tooltip\r\n        if (event.target.closest('.tooltipBox') !== null) {\r\n            return\r\n        }\r\n        console.log(event)\r\n\r\n        const mouse = getMouse(event)\r\n        const extra = (event.isTouch) ? 10 : 0\r\n        const nd = draggables.length\r\n        // We are in the hitboxes of these draggables.\r\n        const hitList = []\r\n        for (let i = 0; i < nd; i++) {\r\n            const d = draggables[i]\r\n            if ((d.o.exists || sim.showGhosts) && hitTest(d, mouse, extra)) {\r\n                hitList.push(i)\r\n            }\r\n        }\r\n        if (hitList.length > 0) {\r\n            const distances2 = hitList.map((i) => {\r\n                const d = draggables[i]\r\n                const offX = d.o.x - mouse.x\r\n                const offY = d.o.y - mouse.y\r\n                return offX ** 2 + offY ** 2\r\n            })\r\n            // pick up\r\n            const iHitListClosest = minIndex(distances2)\r\n            const iDraggableClosest = hitList[iHitListClosest]\r\n\r\n            const d = draggables[iDraggableClosest]\r\n            drag.iDragging = iDraggableClosest\r\n            drag.isDragging = true\r\n            drag.offX = d.o.x - mouse.x\r\n            drag.offY = d.o.y - mouse.y\r\n            d.g.pickUp()\r\n            grabCanvas.dataset.cursor = 'grabbing' // CSS data attribute\r\n        }\r\n        startClickDetect(mouse)\r\n    }\r\n\r\n    const move = function (event) {\r\n        const mouse = getMouse(event)\r\n        if (drag.isDragging) { // because the mouse is moving\r\n            if (event.isTouch) {\r\n                event.preventDefault()\r\n                event.stopPropagation()\r\n            }\r\n            const dragging = draggables[drag.iDragging]\r\n\r\n            const w = screen.width\r\n            const h = screen.height\r\n            dragging.o.setXY({\r\n                x: clamp(mouse.x + drag.offX, 0, w),\r\n                y: clamp(mouse.y + drag.offY, 0, h),\r\n            })\r\n            changes.add(['draggables'])\r\n        } else {\r\n            // see if we're hovering over something grabbable\r\n            // because we want the user to see if they can grab something\r\n            const nd = draggables.length\r\n            for (let i = 0; i < nd; i++) {\r\n                const d = draggables[i]\r\n                if ((sim.showGhosts || d.o.exists) && hitTest(d, mouse, 0)) {\r\n                    grabCanvas.dataset.cursor = 'grab'\r\n                    return\r\n                }\r\n            }\r\n            grabCanvas.dataset.cursor = '' // nothing to grab\r\n        }\r\n        moveClickDetect(mouse)\r\n    }\r\n\r\n    const end = function () {\r\n        console.log('end')\r\n        endClickDetect()\r\n        if (drag.iDragging !== undefined) {\r\n            const dragging = draggables[drag.iDragging]\r\n            dragging.g.drop()\r\n        }\r\n        drag = {}\r\n    }\r\n\r\n    // Touch Listeners\r\n    const touchmove = (e) => {\r\n        const pass = passTouch(e)\r\n        move(pass)\r\n    }\r\n    const touchstart = (e) => {\r\n        const pass = passTouch(e)\r\n        start(pass)\r\n    }\r\n    const touchend = (e) => {\r\n        const pass = passTouch(e)\r\n        move(pass)\r\n        end(pass)\r\n\r\n        // prevent mousedown from firing unless we're on a tooltip\r\n        if (e.target.closest('.tooltipBox') === null) {\r\n            e.preventDefault()\r\n        }\r\n    }\r\n\r\n    self.eventHandlers = {\r\n        start, move, end, touchmove, touchstart, touchend,\r\n    }\r\n\r\n    /**\r\n     * Make a touch event look like a mouse event, with a flag.\r\n     * @param {Event} e - The event from the DOM\r\n     * @returns {Event} - The same event it received, plus some added properties.\r\n     */\r\n    function passTouch(e) {\r\n        e.isTouch = true\r\n        return e\r\n    }\r\n\r\n    /** Fix position relative to parent\r\n     *  https://stackoverflow.com/questions/2614461/javascript-get-mouse-position-relative-to-parent-element\r\n     */\r\n    function getMouse(e) {\r\n        const rect = screen.canvas.getBoundingClientRect()\r\n        const c = (e.isTouch) ? e.changedTouches[0] : e\r\n        const x = c.clientX - rect.left\r\n        const y = c.clientY - rect.top\r\n        const mouse = { x, y }\r\n        return mouse\r\n    }\r\n\r\n    /**\r\n     * Check whether m, e.g. a mouse, hits d, a draggable object.\r\n     * @param {Object} d - An entry in the draggables array.\r\n     * @param {Object} m - An object with properties x and y, e.g. a mouse.\r\n     * @param {Number} extra - Extra slack to catch touches outside of the hitbox.\r\n     * @returns {Boolean} - Whether m hits d.\r\n     */\r\n    function hitTest(d, m, extra) {\r\n        // Only drag an object if we're near it.\r\n        const x = d.o.x - m.x\r\n        const y = d.o.y - m.y\r\n        if (d.p.isCircle) {\r\n            const { r } = d.g\r\n            const hit = x * x + y * y < (r + extra) * (r + extra)\r\n            return hit\r\n        } if (d.p.isSquare) {\r\n            const { w, h } = d.g\r\n            const hit = Math.abs(x) < 0.5 * w + extra && Math.abs(y) < 0.5 * h + extra\r\n            return hit\r\n        }\r\n        return false\r\n    }\r\n\r\n    // click detection //\r\n\r\n    let couldBeClick\r\n    let startPos\r\n    function startClickDetect(mouse) {\r\n        couldBeClick = true\r\n        startPos = structuredClone(mouse)\r\n    }\r\n    function moveClickDetect(mouse) {\r\n        if (couldBeClick) {\r\n            const xDist = Math.abs(startPos.x - mouse.x)\r\n            const yDist = Math.abs(startPos.y - mouse.y)\r\n            if (xDist > 5) couldBeClick = false\r\n            if (yDist > 5) couldBeClick = false\r\n        }\r\n    }\r\n    function endClickDetect() {\r\n        if (couldBeClick) {\r\n            couldBeClick = false\r\n            if (drag.isDragging) { // because the mouse is moving\r\n                const dragging = draggables[drag.iDragging]\r\n                dragging.o.click()\r\n            } else {\r\n                // We are not dragging anything, and we clicked,\r\n                // and we're inside the screen because this could be a click,\r\n                // so let's do the click action for blank space.\r\n                clickEmpty(startPos)\r\n            }\r\n        }\r\n    }\r\n\r\n    // Test Point\r\n\r\n    function clickEmpty(p) {\r\n        sim.voterTest.start(p)\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport DraggableManager from '../DraggableManager.js'\r\n\r\n/**\r\n * The super class for each sim. Provides some basic required functionality.\r\n * @param {Screen} screen\r\n * @param {Changes} changes\r\n * @constructor\r\n */\r\nexport default function SimBase(screen, changes, sim) {\r\n    const self = this\r\n    self.dragm = new DraggableManager(screen, changes, sim)\r\n    self.enter = () => {\r\n        screen.eventHandlers.set(self.dragm.eventHandlers)\r\n    }\r\n    self.exit = () => {}\r\n    self.update = () => {}\r\n    self.render = () => { }\r\n    self.renderForeground = () => { }\r\n    self.testVote = () => {}\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Super class\r\n * A VoterSim has functionality for a voter that is specific to a simulation.\r\n * Each VoterSim has a voter component.\r\n * The voter component is a VoterShape, for now.\r\n * This voter component is common to all simulations.\r\n * An example of a VoterSim is a VoterGeoBasis.\r\n * This is an inheritance structure.\r\n * @param {VoterShape} voterShape - a voter component that VoterSim builds upon.\r\n * @param {DraggableManager} dragm\r\n * @constructor\r\n */\r\nexport default function VoterSim(voterShape, dragm) {\r\n    const self = this\r\n    self.voterShape = voterShape\r\n\r\n    dragm.newCircleHandle(voterShape, voterShape.circle)\r\n\r\n    self.renderForeground = () => {\r\n        self.voterShape.renderForeground()\r\n    }\r\n}\r\n","/* eslint-disable no-nested-ternary */\r\n// https://codepen.io/darsain/pen/XpgMGp\r\n\r\nconst r = Math.round\r\n\r\nexport function toRGBA(d1) {\r\n    const l = d1.length\r\n    const rgba = Array(4).fill()\r\n    if (d1.slice(0, 3).toLowerCase() === 'rgb') {\r\n        const d = d1.replace(' ', '').split(',')\r\n        rgba[0] = parseInt(d[0].slice(d[3].toLowerCase() === 'a' ? 5 : 4), 10)\r\n        rgba[1] = parseInt(d[1], 10)\r\n        rgba[2] = parseInt(d[2], 10)\r\n        rgba[3] = d[3] ? parseFloat(d[3]) : -1\r\n    } else {\r\n        let d\r\n        if (l < 6) d = parseInt(String(d1[1]) + d1[1] + d1[2] + d1[2] + d1[3] + d1[3] + (l > 4 ? String(d1[4]) + d1[4] : ''), 16)\r\n        else d = parseInt(d1.slice(1), 16)\r\n        rgba[0] = (d >> 16) & 255\r\n        rgba[1] = (d >> 8) & 255\r\n        rgba[2] = d & 255\r\n        rgba[3] = l === 9 || l === 5 ? r((((d >> 24) & 255) / 255) * 10000) / 10000 : -1\r\n    }\r\n    return rgba\r\n}\r\n\r\nexport function blend(from1, to1, p1 = 0.5) {\r\n    const from = from1.trim()\r\n    const to = to1.trim()\r\n    const b = p1 < 0\r\n    const p = b ? p1 * -1 : p1\r\n    const f = toRGBA(from)\r\n    const t = toRGBA(to)\r\n\r\n    if (to[0] === 'r') {\r\n        return `rgb${to[3] === 'a' ? 'a(' : '('\r\n        }${r(((t[0] - f[0]) * p) + f[0])},${\r\n            r(((t[1] - f[1]) * p) + f[1])},${\r\n            r(((t[2] - f[2]) * p) + f[2])\r\n        }${f[3] < 0 && t[3] < 0 ? '' : `,${\r\n            f[3] > -1 && t[3] > -1\r\n                ? r((((t[3] - f[3]) * p) + f[3]) * 10000) / 10000\r\n                : t[3] < 0 ? f[3] : t[3]}`})`\r\n    }\r\n\r\n    return `#${(0x100000000 + ((\r\n        f[3] > -1 && t[3] > -1\r\n            ? r((((t[3] - f[3]) * p) + f[3]) * 255)\r\n            : t[3] > -1 ? r(t[3] * 255) : f[3] > -1 ? r(f[3] * 255) : 255\r\n    ) * 0x1000000)\r\n    + (r(((t[0] - f[0]) * p) + f[0]) * 0x10000)\r\n        + (r(((t[1] - f[1]) * p) + f[1]) * 0x100)\r\n        + r(((t[2] - f[2]) * p) + f[2])\r\n    ).toString(16).slice(f[3] > -1 || t[3] > -1 ? 1 : 3)}`\r\n}\r\n","/** @module */\r\n\r\n// import { normal } from 'color-blend'\r\n\r\nimport { blend, toRGBA } from '../lib/colorBlendScript.js'\r\n\r\n/**\r\n * Blend colors in given proportions.\r\n * @param {Number[]} f - proportions of colors, as fraction of 1.\r\n * @param {String[]} colors -\r\n * @returns {String} - Color\r\n */\r\nexport default function colorBlend(f, colors) { // f fractions\r\n    let fracSum = f[0]\r\n    let colorB = colors[0]\r\n    for (let i = 1; i < f.length; i++) {\r\n        const fraction = frac(f[i], fracSum)\r\n        colorB = blend(colorB, colors[i], fraction)\r\n        fracSum += f[i]\r\n    }\r\n    return colorB\r\n}\r\n\r\nexport function colorBlend3(f, colors) { // f fractions\r\n    const fraction01 = frac(f[1], f[0])\r\n    const color01 = blend(colors[0], colors[1], fraction01)\r\n    const fraction012 = frac(f[2], f[1] + f[0])\r\n    const color012 = blend(color01, colors[2], fraction012)\r\n    return color012\r\n}\r\n\r\nfunction frac(thing, other) {\r\n    return thing / (thing + other)\r\n}\r\n\r\nexport { toRGBA }\r\n","import colorBlend from '../election/colorBlend.js'\r\nimport { toRGBA } from '../lib/colorBlendScript.js'\r\n\r\n/**\r\n * Draw grid cells to show votes.\r\n * Basically, we have a rectangular grid of voter support.\r\n * Even if the voterGeom is a circle.\r\n * Later, when we draw, we make a clip in the shape of the voterGeom,\r\n * and draw the grid inside the clip.\r\n * @param {Screen} screen\r\n * @constructor\r\n */\r\nexport default function Grid2D(gridData, candidateSimList, screen) {\r\n    const self = this\r\n\r\n    const cans = candidateSimList.getCandidates()\r\n    const { grid, voteSet, voterGeom } = gridData\r\n\r\n    const { x, y, w } = voterGeom\r\n\r\n    const canvases = []\r\n    let singleCanvas\r\n    // TODO: set up canvases ahead of time\r\n\r\n    const nCans = cans.length\r\n    const nHeight = Math.floor((nCans - 1) / 3) + 1\r\n    screen.setMapsHeight(nHeight * (1 / 3) * screen.height)\r\n\r\n    const isGauss = voterGeom.densityProfile === 'gaussian'\r\n\r\n    fillDataSeparate()\r\n    fillDataBlend()\r\n\r\n    function fillDataSeparate() {\r\n    // make image data\r\n        const { nx, ny, weight } = grid\r\n        for (let i = 0; i < cans.length; i++) {\r\n            const canvas = document.createElement('canvas')\r\n            canvas.width = nx\r\n            canvas.height = ny\r\n            const offCtx = canvas.getContext('2d')\r\n            const imageData = offCtx.createImageData(nx, ny)\r\n\r\n            const { data } = imageData\r\n\r\n            const { color } = cans[i]\r\n            const [r, g, b] = toRGBA(color)\r\n\r\n            let k = 0\r\n            for (let yp = 0; yp < ny; yp++) {\r\n                for (let xp = 0; xp < nx; xp++) {\r\n                    const support = voteSet[k].tallyFractions[i]\r\n                    const a = support * ((isGauss) ? weight[k] : 1) * 255\r\n\r\n                    data[(xp + yp * nx) * 4 + 0] = r\r\n                    data[(xp + yp * nx) * 4 + 1] = g\r\n                    data[(xp + yp * nx) * 4 + 2] = b\r\n                    data[(xp + yp * nx) * 4 + 3] = a\r\n                    k += 1\r\n                }\r\n            }\r\n            canvases.push(canvas)\r\n            offCtx.putImageData(imageData, 0, 0)\r\n        }\r\n    }\r\n\r\n    function fillDataBlend() {\r\n        // make image data\r\n        const { nx, ny, weight } = grid\r\n        const colorSet = cans.map((can) => can.color)\r\n\r\n        const canvas = document.createElement('canvas')\r\n        canvas.width = nx\r\n        canvas.height = ny\r\n        const offCtx = canvas.getContext('2d')\r\n        const imageData = offCtx.createImageData(nx, ny)\r\n\r\n        const { data } = imageData\r\n\r\n        let k = 0\r\n        for (let yp = 0; yp < ny; yp++) {\r\n            for (let xp = 0; xp < nx; xp++) {\r\n                const { tallyFractions } = voteSet[k]\r\n                const color = colorBlend(tallyFractions, colorSet)\r\n                const [r, g, b] = toRGBA(color)\r\n\r\n                const a = ((isGauss) ? weight[k] : 1) * 255\r\n\r\n                data[(xp + yp * nx) * 4 + 0] = r\r\n                data[(xp + yp * nx) * 4 + 1] = g\r\n                data[(xp + yp * nx) * 4 + 2] = b\r\n                data[(xp + yp * nx) * 4 + 3] = a\r\n                k += 1\r\n            }\r\n        }\r\n        singleCanvas = canvas\r\n        offCtx.putImageData(imageData, 0, 0)\r\n    }\r\n\r\n    self.render = function () {\r\n        const { ctx, mctx } = screen\r\n\r\n        drawBlend()\r\n\r\n        drawSeparate()\r\n\r\n        function drawSeparate() {\r\n            // draw each can separately\r\n            for (let i = 0; i < nCans; i++) {\r\n                // draw image\r\n                // transform is t\r\n                mctx.save()\r\n                // mctx.globalAlpha = 0.7\r\n                const t = {\r\n                    w: 1 / 3, h: 1 / 3, x: (i % 3) * 100, y: Math.floor(i / 3) * 100,\r\n                }\r\n\r\n                // shape\r\n                const sh = {\r\n                    x: x * t.w + t.x,\r\n                    y: y * t.h + t.y,\r\n                    r: w * t.w * 0.5,\r\n                }\r\n\r\n                // clip outline of shape\r\n                mctx.beginPath()\r\n                mctx.arc(sh.x, sh.y, sh.r, 0, 2 * Math.PI)\r\n                mctx.clip()\r\n\r\n                mctx.beginPath()\r\n                mctx.rect(t.x, t.y, 100, 100)\r\n                mctx.clip()\r\n\r\n                const canvas = canvases[i]\r\n                const im = {\r\n                    x: x * t.w - w * t.w * 0.5 + t.x,\r\n                    y: y * t.w - w * t.w * 0.5 + t.y,\r\n                    w: w * t.w,\r\n                    h: w * t.h,\r\n                }\r\n                mctx.drawImage(canvas, im.x, im.y, im.w, im.h)\r\n\r\n                // draw outline of shape\r\n                mctx.beginPath()\r\n                mctx.arc(sh.x, sh.y, sh.r, 0, 2 * Math.PI)\r\n                mctx.stroke()\r\n                mctx.restore()\r\n            }\r\n        }\r\n\r\n        function drawBlend() {\r\n            ctx.save()\r\n            // ctx.globalAlpha = 0.7\r\n\r\n            // clip outline of shape\r\n            ctx.beginPath()\r\n            ctx.arc(x, y, w * 0.5, 0, 2 * Math.PI)\r\n            ctx.clip()\r\n\r\n            // draw image\r\n            // transform is t\r\n            const t = {\r\n                w: 1, h: 1, x: 0, y: 0,\r\n            }\r\n            const canvas = singleCanvas\r\n            ctx.imageSmoothingEnabled = false\r\n            const ov = {\r\n                x: x - w * 0.5 + t.x,\r\n                y: y - w * 0.5 + t.y,\r\n                w: w * t.w,\r\n                h: w * t.h,\r\n            }\r\n            ctx.drawImage(canvas, ov.x, ov.y, ov.w, ov.h)\r\n\r\n            // draw outline of shape\r\n            ctx.beginPath()\r\n            ctx.arc(x, y, w * 0.5, 0, 2 * Math.PI)\r\n            ctx.stroke()\r\n\r\n            ctx.restore()\r\n        }\r\n    }\r\n}\r\n","const epsilon = 1.1102230246251565e-16;\r\nconst splitter = 134217729;\r\nconst resulterrbound = (3 + 8 * epsilon) * epsilon;\r\n\r\n// fast_expansion_sum_zeroelim routine from oritinal code\r\nfunction sum(elen, e, flen, f, h) {\r\n    let Q, Qnew, hh, bvirt;\r\n    let enow = e[0];\r\n    let fnow = f[0];\r\n    let eindex = 0;\r\n    let findex = 0;\r\n    if ((fnow > enow) === (fnow > -enow)) {\r\n        Q = enow;\r\n        enow = e[++eindex];\r\n    } else {\r\n        Q = fnow;\r\n        fnow = f[++findex];\r\n    }\r\n    let hindex = 0;\r\n    if (eindex < elen && findex < flen) {\r\n        if ((fnow > enow) === (fnow > -enow)) {\r\n            Qnew = enow + Q;\r\n            hh = Q - (Qnew - enow);\r\n            enow = e[++eindex];\r\n        } else {\r\n            Qnew = fnow + Q;\r\n            hh = Q - (Qnew - fnow);\r\n            fnow = f[++findex];\r\n        }\r\n        Q = Qnew;\r\n        if (hh !== 0) {\r\n            h[hindex++] = hh;\r\n        }\r\n        while (eindex < elen && findex < flen) {\r\n            if ((fnow > enow) === (fnow > -enow)) {\r\n                Qnew = Q + enow;\r\n                bvirt = Qnew - Q;\r\n                hh = Q - (Qnew - bvirt) + (enow - bvirt);\r\n                enow = e[++eindex];\r\n            } else {\r\n                Qnew = Q + fnow;\r\n                bvirt = Qnew - Q;\r\n                hh = Q - (Qnew - bvirt) + (fnow - bvirt);\r\n                fnow = f[++findex];\r\n            }\r\n            Q = Qnew;\r\n            if (hh !== 0) {\r\n                h[hindex++] = hh;\r\n            }\r\n        }\r\n    }\r\n    while (eindex < elen) {\r\n        Qnew = Q + enow;\r\n        bvirt = Qnew - Q;\r\n        hh = Q - (Qnew - bvirt) + (enow - bvirt);\r\n        enow = e[++eindex];\r\n        Q = Qnew;\r\n        if (hh !== 0) {\r\n            h[hindex++] = hh;\r\n        }\r\n    }\r\n    while (findex < flen) {\r\n        Qnew = Q + fnow;\r\n        bvirt = Qnew - Q;\r\n        hh = Q - (Qnew - bvirt) + (fnow - bvirt);\r\n        fnow = f[++findex];\r\n        Q = Qnew;\r\n        if (hh !== 0) {\r\n            h[hindex++] = hh;\r\n        }\r\n    }\r\n    if (Q !== 0 || hindex === 0) {\r\n        h[hindex++] = Q;\r\n    }\r\n    return hindex;\r\n}\r\n\r\nfunction estimate(elen, e) {\r\n    let Q = e[0];\r\n    for (let i = 1; i < elen; i++) Q += e[i];\r\n    return Q;\r\n}\r\n\r\nfunction vec(n) {\r\n    return new Float64Array(n);\r\n}\r\n\r\nconst ccwerrboundA = (3 + 16 * epsilon) * epsilon;\r\nconst ccwerrboundB = (2 + 12 * epsilon) * epsilon;\r\nconst ccwerrboundC = (9 + 64 * epsilon) * epsilon * epsilon;\r\n\r\nconst B = vec(4);\r\nconst C1 = vec(8);\r\nconst C2 = vec(12);\r\nconst D = vec(16);\r\nconst u = vec(4);\r\n\r\nfunction orient2dadapt(ax, ay, bx, by, cx, cy, detsum) {\r\n    let acxtail, acytail, bcxtail, bcytail;\r\n    let bvirt, c, ahi, alo, bhi, blo, _i, _j, _0, s1, s0, t1, t0, u3;\r\n\r\n    const acx = ax - cx;\r\n    const bcx = bx - cx;\r\n    const acy = ay - cy;\r\n    const bcy = by - cy;\r\n\r\n    s1 = acx * bcy;\r\n    c = splitter * acx;\r\n    ahi = c - (c - acx);\r\n    alo = acx - ahi;\r\n    c = splitter * bcy;\r\n    bhi = c - (c - bcy);\r\n    blo = bcy - bhi;\r\n    s0 = alo * blo - (s1 - ahi * bhi - alo * bhi - ahi * blo);\r\n    t1 = acy * bcx;\r\n    c = splitter * acy;\r\n    ahi = c - (c - acy);\r\n    alo = acy - ahi;\r\n    c = splitter * bcx;\r\n    bhi = c - (c - bcx);\r\n    blo = bcx - bhi;\r\n    t0 = alo * blo - (t1 - ahi * bhi - alo * bhi - ahi * blo);\r\n    _i = s0 - t0;\r\n    bvirt = s0 - _i;\r\n    B[0] = s0 - (_i + bvirt) + (bvirt - t0);\r\n    _j = s1 + _i;\r\n    bvirt = _j - s1;\r\n    _0 = s1 - (_j - bvirt) + (_i - bvirt);\r\n    _i = _0 - t1;\r\n    bvirt = _0 - _i;\r\n    B[1] = _0 - (_i + bvirt) + (bvirt - t1);\r\n    u3 = _j + _i;\r\n    bvirt = u3 - _j;\r\n    B[2] = _j - (u3 - bvirt) + (_i - bvirt);\r\n    B[3] = u3;\r\n\r\n    let det = estimate(4, B);\r\n    let errbound = ccwerrboundB * detsum;\r\n    if (det >= errbound || -det >= errbound) {\r\n        return det;\r\n    }\r\n\r\n    bvirt = ax - acx;\r\n    acxtail = ax - (acx + bvirt) + (bvirt - cx);\r\n    bvirt = bx - bcx;\r\n    bcxtail = bx - (bcx + bvirt) + (bvirt - cx);\r\n    bvirt = ay - acy;\r\n    acytail = ay - (acy + bvirt) + (bvirt - cy);\r\n    bvirt = by - bcy;\r\n    bcytail = by - (bcy + bvirt) + (bvirt - cy);\r\n\r\n    if (acxtail === 0 && acytail === 0 && bcxtail === 0 && bcytail === 0) {\r\n        return det;\r\n    }\r\n\r\n    errbound = ccwerrboundC * detsum + resulterrbound * Math.abs(det);\r\n    det += (acx * bcytail + bcy * acxtail) - (acy * bcxtail + bcx * acytail);\r\n    if (det >= errbound || -det >= errbound) return det;\r\n\r\n    s1 = acxtail * bcy;\r\n    c = splitter * acxtail;\r\n    ahi = c - (c - acxtail);\r\n    alo = acxtail - ahi;\r\n    c = splitter * bcy;\r\n    bhi = c - (c - bcy);\r\n    blo = bcy - bhi;\r\n    s0 = alo * blo - (s1 - ahi * bhi - alo * bhi - ahi * blo);\r\n    t1 = acytail * bcx;\r\n    c = splitter * acytail;\r\n    ahi = c - (c - acytail);\r\n    alo = acytail - ahi;\r\n    c = splitter * bcx;\r\n    bhi = c - (c - bcx);\r\n    blo = bcx - bhi;\r\n    t0 = alo * blo - (t1 - ahi * bhi - alo * bhi - ahi * blo);\r\n    _i = s0 - t0;\r\n    bvirt = s0 - _i;\r\n    u[0] = s0 - (_i + bvirt) + (bvirt - t0);\r\n    _j = s1 + _i;\r\n    bvirt = _j - s1;\r\n    _0 = s1 - (_j - bvirt) + (_i - bvirt);\r\n    _i = _0 - t1;\r\n    bvirt = _0 - _i;\r\n    u[1] = _0 - (_i + bvirt) + (bvirt - t1);\r\n    u3 = _j + _i;\r\n    bvirt = u3 - _j;\r\n    u[2] = _j - (u3 - bvirt) + (_i - bvirt);\r\n    u[3] = u3;\r\n    const C1len = sum(4, B, 4, u, C1);\r\n\r\n    s1 = acx * bcytail;\r\n    c = splitter * acx;\r\n    ahi = c - (c - acx);\r\n    alo = acx - ahi;\r\n    c = splitter * bcytail;\r\n    bhi = c - (c - bcytail);\r\n    blo = bcytail - bhi;\r\n    s0 = alo * blo - (s1 - ahi * bhi - alo * bhi - ahi * blo);\r\n    t1 = acy * bcxtail;\r\n    c = splitter * acy;\r\n    ahi = c - (c - acy);\r\n    alo = acy - ahi;\r\n    c = splitter * bcxtail;\r\n    bhi = c - (c - bcxtail);\r\n    blo = bcxtail - bhi;\r\n    t0 = alo * blo - (t1 - ahi * bhi - alo * bhi - ahi * blo);\r\n    _i = s0 - t0;\r\n    bvirt = s0 - _i;\r\n    u[0] = s0 - (_i + bvirt) + (bvirt - t0);\r\n    _j = s1 + _i;\r\n    bvirt = _j - s1;\r\n    _0 = s1 - (_j - bvirt) + (_i - bvirt);\r\n    _i = _0 - t1;\r\n    bvirt = _0 - _i;\r\n    u[1] = _0 - (_i + bvirt) + (bvirt - t1);\r\n    u3 = _j + _i;\r\n    bvirt = u3 - _j;\r\n    u[2] = _j - (u3 - bvirt) + (_i - bvirt);\r\n    u[3] = u3;\r\n    const C2len = sum(C1len, C1, 4, u, C2);\r\n\r\n    s1 = acxtail * bcytail;\r\n    c = splitter * acxtail;\r\n    ahi = c - (c - acxtail);\r\n    alo = acxtail - ahi;\r\n    c = splitter * bcytail;\r\n    bhi = c - (c - bcytail);\r\n    blo = bcytail - bhi;\r\n    s0 = alo * blo - (s1 - ahi * bhi - alo * bhi - ahi * blo);\r\n    t1 = acytail * bcxtail;\r\n    c = splitter * acytail;\r\n    ahi = c - (c - acytail);\r\n    alo = acytail - ahi;\r\n    c = splitter * bcxtail;\r\n    bhi = c - (c - bcxtail);\r\n    blo = bcxtail - bhi;\r\n    t0 = alo * blo - (t1 - ahi * bhi - alo * bhi - ahi * blo);\r\n    _i = s0 - t0;\r\n    bvirt = s0 - _i;\r\n    u[0] = s0 - (_i + bvirt) + (bvirt - t0);\r\n    _j = s1 + _i;\r\n    bvirt = _j - s1;\r\n    _0 = s1 - (_j - bvirt) + (_i - bvirt);\r\n    _i = _0 - t1;\r\n    bvirt = _0 - _i;\r\n    u[1] = _0 - (_i + bvirt) + (bvirt - t1);\r\n    u3 = _j + _i;\r\n    bvirt = u3 - _j;\r\n    u[2] = _j - (u3 - bvirt) + (_i - bvirt);\r\n    u[3] = u3;\r\n    const Dlen = sum(C2len, C2, 4, u, D);\r\n\r\n    return D[Dlen - 1];\r\n}\r\n\r\nfunction orient2d(ax, ay, bx, by, cx, cy) {\r\n    const detleft = (ay - cy) * (bx - cx);\r\n    const detright = (ax - cx) * (by - cy);\r\n    const det = detleft - detright;\r\n\r\n    if (detleft === 0 || detright === 0 || (detleft > 0) !== (detright > 0)) return det;\r\n\r\n    const detsum = Math.abs(detleft + detright);\r\n    if (Math.abs(det) >= ccwerrboundA * detsum) return det;\r\n\r\n    return -orient2dadapt(ax, ay, bx, by, cx, cy, detsum);\r\n}\r\n\r\nconst EPSILON = Math.pow(2, -52);\r\nconst EDGE_STACK = new Uint32Array(512);\r\n\r\nclass Delaunator {\r\n\r\n    static from(points, getX = defaultGetX, getY = defaultGetY) {\r\n        const n = points.length;\r\n        const coords = new Float64Array(n * 2);\r\n\r\n        for (let i = 0; i < n; i++) {\r\n            const p = points[i];\r\n            coords[2 * i] = getX(p);\r\n            coords[2 * i + 1] = getY(p);\r\n        }\r\n\r\n        return new Delaunator(coords);\r\n    }\r\n\r\n    constructor(coords) {\r\n        const n = coords.length >> 1;\r\n        if (n > 0 && typeof coords[0] !== 'number') throw new Error('Expected coords to contain numbers.');\r\n\r\n        this.coords = coords;\r\n\r\n        // arrays that will store the triangulation graph\r\n        const maxTriangles = Math.max(2 * n - 5, 0);\r\n        this._triangles = new Uint32Array(maxTriangles * 3);\r\n        this._halfedges = new Int32Array(maxTriangles * 3);\r\n\r\n        // temporary arrays for tracking the edges of the advancing convex hull\r\n        this._hashSize = Math.ceil(Math.sqrt(n));\r\n        this._hullPrev = new Uint32Array(n); // edge to prev edge\r\n        this._hullNext = new Uint32Array(n); // edge to next edge\r\n        this._hullTri = new Uint32Array(n); // edge to adjacent triangle\r\n        this._hullHash = new Int32Array(this._hashSize).fill(-1); // angular edge hash\r\n\r\n        // temporary arrays for sorting points\r\n        this._ids = new Uint32Array(n);\r\n        this._dists = new Float64Array(n);\r\n\r\n        this.update();\r\n    }\r\n\r\n    update() {\r\n        const {coords, _hullPrev: hullPrev, _hullNext: hullNext, _hullTri: hullTri, _hullHash: hullHash} =  this;\r\n        const n = coords.length >> 1;\r\n\r\n        // populate an array of point indices; calculate input data bbox\r\n        let minX = Infinity;\r\n        let minY = Infinity;\r\n        let maxX = -Infinity;\r\n        let maxY = -Infinity;\r\n\r\n        for (let i = 0; i < n; i++) {\r\n            const x = coords[2 * i];\r\n            const y = coords[2 * i + 1];\r\n            if (x < minX) minX = x;\r\n            if (y < minY) minY = y;\r\n            if (x > maxX) maxX = x;\r\n            if (y > maxY) maxY = y;\r\n            this._ids[i] = i;\r\n        }\r\n        const cx = (minX + maxX) / 2;\r\n        const cy = (minY + maxY) / 2;\r\n\r\n        let minDist = Infinity;\r\n        let i0, i1, i2;\r\n\r\n        // pick a seed point close to the center\r\n        for (let i = 0; i < n; i++) {\r\n            const d = dist(cx, cy, coords[2 * i], coords[2 * i + 1]);\r\n            if (d < minDist) {\r\n                i0 = i;\r\n                minDist = d;\r\n            }\r\n        }\r\n        const i0x = coords[2 * i0];\r\n        const i0y = coords[2 * i0 + 1];\r\n\r\n        minDist = Infinity;\r\n\r\n        // find the point closest to the seed\r\n        for (let i = 0; i < n; i++) {\r\n            if (i === i0) continue;\r\n            const d = dist(i0x, i0y, coords[2 * i], coords[2 * i + 1]);\r\n            if (d < minDist && d > 0) {\r\n                i1 = i;\r\n                minDist = d;\r\n            }\r\n        }\r\n        let i1x = coords[2 * i1];\r\n        let i1y = coords[2 * i1 + 1];\r\n\r\n        let minRadius = Infinity;\r\n\r\n        // find the third point which forms the smallest circumcircle with the first two\r\n        for (let i = 0; i < n; i++) {\r\n            if (i === i0 || i === i1) continue;\r\n            const r = circumradius(i0x, i0y, i1x, i1y, coords[2 * i], coords[2 * i + 1]);\r\n            if (r < minRadius) {\r\n                i2 = i;\r\n                minRadius = r;\r\n            }\r\n        }\r\n        let i2x = coords[2 * i2];\r\n        let i2y = coords[2 * i2 + 1];\r\n\r\n        if (minRadius === Infinity) {\r\n            // order collinear points by dx (or dy if all x are identical)\r\n            // and return the list as a hull\r\n            for (let i = 0; i < n; i++) {\r\n                this._dists[i] = (coords[2 * i] - coords[0]) || (coords[2 * i + 1] - coords[1]);\r\n            }\r\n            quicksort(this._ids, this._dists, 0, n - 1);\r\n            const hull = new Uint32Array(n);\r\n            let j = 0;\r\n            for (let i = 0, d0 = -Infinity; i < n; i++) {\r\n                const id = this._ids[i];\r\n                if (this._dists[id] > d0) {\r\n                    hull[j++] = id;\r\n                    d0 = this._dists[id];\r\n                }\r\n            }\r\n            this.hull = hull.subarray(0, j);\r\n            this.triangles = new Uint32Array(0);\r\n            this.halfedges = new Uint32Array(0);\r\n            return;\r\n        }\r\n\r\n        // swap the order of the seed points for counter-clockwise orientation\r\n        if (orient2d(i0x, i0y, i1x, i1y, i2x, i2y) < 0) {\r\n            const i = i1;\r\n            const x = i1x;\r\n            const y = i1y;\r\n            i1 = i2;\r\n            i1x = i2x;\r\n            i1y = i2y;\r\n            i2 = i;\r\n            i2x = x;\r\n            i2y = y;\r\n        }\r\n\r\n        const center = circumcenter(i0x, i0y, i1x, i1y, i2x, i2y);\r\n        this._cx = center.x;\r\n        this._cy = center.y;\r\n\r\n        for (let i = 0; i < n; i++) {\r\n            this._dists[i] = dist(coords[2 * i], coords[2 * i + 1], center.x, center.y);\r\n        }\r\n\r\n        // sort the points by distance from the seed triangle circumcenter\r\n        quicksort(this._ids, this._dists, 0, n - 1);\r\n\r\n        // set up the seed triangle as the starting hull\r\n        this._hullStart = i0;\r\n        let hullSize = 3;\r\n\r\n        hullNext[i0] = hullPrev[i2] = i1;\r\n        hullNext[i1] = hullPrev[i0] = i2;\r\n        hullNext[i2] = hullPrev[i1] = i0;\r\n\r\n        hullTri[i0] = 0;\r\n        hullTri[i1] = 1;\r\n        hullTri[i2] = 2;\r\n\r\n        hullHash.fill(-1);\r\n        hullHash[this._hashKey(i0x, i0y)] = i0;\r\n        hullHash[this._hashKey(i1x, i1y)] = i1;\r\n        hullHash[this._hashKey(i2x, i2y)] = i2;\r\n\r\n        this.trianglesLen = 0;\r\n        this._addTriangle(i0, i1, i2, -1, -1, -1);\r\n\r\n        for (let k = 0, xp, yp; k < this._ids.length; k++) {\r\n            const i = this._ids[k];\r\n            const x = coords[2 * i];\r\n            const y = coords[2 * i + 1];\r\n\r\n            // skip near-duplicate points\r\n            if (k > 0 && Math.abs(x - xp) <= EPSILON && Math.abs(y - yp) <= EPSILON) continue;\r\n            xp = x;\r\n            yp = y;\r\n\r\n            // skip seed triangle points\r\n            if (i === i0 || i === i1 || i === i2) continue;\r\n\r\n            // find a visible edge on the convex hull using edge hash\r\n            let start = 0;\r\n            for (let j = 0, key = this._hashKey(x, y); j < this._hashSize; j++) {\r\n                start = hullHash[(key + j) % this._hashSize];\r\n                if (start !== -1 && start !== hullNext[start]) break;\r\n            }\r\n\r\n            start = hullPrev[start];\r\n            let e = start, q;\r\n            while (q = hullNext[e], orient2d(x, y, coords[2 * e], coords[2 * e + 1], coords[2 * q], coords[2 * q + 1]) >= 0) {\r\n                e = q;\r\n                if (e === start) {\r\n                    e = -1;\r\n                    break;\r\n                }\r\n            }\r\n            if (e === -1) continue; // likely a near-duplicate point; skip it\r\n\r\n            // add the first triangle from the point\r\n            let t = this._addTriangle(e, i, hullNext[e], -1, -1, hullTri[e]);\r\n\r\n            // recursively flip triangles from the point until they satisfy the Delaunay condition\r\n            hullTri[i] = this._legalize(t + 2);\r\n            hullTri[e] = t; // keep track of boundary triangles on the hull\r\n            hullSize++;\r\n\r\n            // walk forward through the hull, adding more triangles and flipping recursively\r\n            let n = hullNext[e];\r\n            while (q = hullNext[n], orient2d(x, y, coords[2 * n], coords[2 * n + 1], coords[2 * q], coords[2 * q + 1]) < 0) {\r\n                t = this._addTriangle(n, i, q, hullTri[i], -1, hullTri[n]);\r\n                hullTri[i] = this._legalize(t + 2);\r\n                hullNext[n] = n; // mark as removed\r\n                hullSize--;\r\n                n = q;\r\n            }\r\n\r\n            // walk backward from the other side, adding more triangles and flipping\r\n            if (e === start) {\r\n                while (q = hullPrev[e], orient2d(x, y, coords[2 * q], coords[2 * q + 1], coords[2 * e], coords[2 * e + 1]) < 0) {\r\n                    t = this._addTriangle(q, i, e, -1, hullTri[e], hullTri[q]);\r\n                    this._legalize(t + 2);\r\n                    hullTri[q] = t;\r\n                    hullNext[e] = e; // mark as removed\r\n                    hullSize--;\r\n                    e = q;\r\n                }\r\n            }\r\n\r\n            // update the hull indices\r\n            this._hullStart = hullPrev[i] = e;\r\n            hullNext[e] = hullPrev[n] = i;\r\n            hullNext[i] = n;\r\n\r\n            // save the two new edges in the hash table\r\n            hullHash[this._hashKey(x, y)] = i;\r\n            hullHash[this._hashKey(coords[2 * e], coords[2 * e + 1])] = e;\r\n        }\r\n\r\n        this.hull = new Uint32Array(hullSize);\r\n        for (let i = 0, e = this._hullStart; i < hullSize; i++) {\r\n            this.hull[i] = e;\r\n            e = hullNext[e];\r\n        }\r\n\r\n        // trim typed triangle mesh arrays\r\n        this.triangles = this._triangles.subarray(0, this.trianglesLen);\r\n        this.halfedges = this._halfedges.subarray(0, this.trianglesLen);\r\n    }\r\n\r\n    _hashKey(x, y) {\r\n        return Math.floor(pseudoAngle(x - this._cx, y - this._cy) * this._hashSize) % this._hashSize;\r\n    }\r\n\r\n    _legalize(a) {\r\n        const {_triangles: triangles, _halfedges: halfedges, coords} = this;\r\n\r\n        let i = 0;\r\n        let ar = 0;\r\n\r\n        // recursion eliminated with a fixed-size stack\r\n        while (true) {\r\n            const b = halfedges[a];\r\n\r\n            /* if the pair of triangles doesn't satisfy the Delaunay condition\r\n             * (p1 is inside the circumcircle of [p0, pl, pr]), flip them,\r\n             * then do the same check/flip recursively for the new pair of triangles\r\n             *\r\n             *           pl                    pl\r\n             *          /||\\                  /  \\\r\n             *       al/ || \\bl            al/    \\a\r\n             *        /  ||  \\              /      \\\r\n             *       /  a||b  \\    flip    /___ar___\\\r\n             *     p0\\   ||   /p1   =>   p0\\---bl---/p1\r\n             *        \\  ||  /              \\      /\r\n             *       ar\\ || /br             b\\    /br\r\n             *          \\||/                  \\  /\r\n             *           pr                    pr\r\n             */\r\n            const a0 = a - a % 3;\r\n            ar = a0 + (a + 2) % 3;\r\n\r\n            if (b === -1) { // convex hull edge\r\n                if (i === 0) break;\r\n                a = EDGE_STACK[--i];\r\n                continue;\r\n            }\r\n\r\n            const b0 = b - b % 3;\r\n            const al = a0 + (a + 1) % 3;\r\n            const bl = b0 + (b + 2) % 3;\r\n\r\n            const p0 = triangles[ar];\r\n            const pr = triangles[a];\r\n            const pl = triangles[al];\r\n            const p1 = triangles[bl];\r\n\r\n            const illegal = inCircle(\r\n                coords[2 * p0], coords[2 * p0 + 1],\r\n                coords[2 * pr], coords[2 * pr + 1],\r\n                coords[2 * pl], coords[2 * pl + 1],\r\n                coords[2 * p1], coords[2 * p1 + 1]);\r\n\r\n            if (illegal) {\r\n                triangles[a] = p1;\r\n                triangles[b] = p0;\r\n\r\n                const hbl = halfedges[bl];\r\n\r\n                // edge swapped on the other side of the hull (rare); fix the halfedge reference\r\n                if (hbl === -1) {\r\n                    let e = this._hullStart;\r\n                    do {\r\n                        if (this._hullTri[e] === bl) {\r\n                            this._hullTri[e] = a;\r\n                            break;\r\n                        }\r\n                        e = this._hullPrev[e];\r\n                    } while (e !== this._hullStart);\r\n                }\r\n                this._link(a, hbl);\r\n                this._link(b, halfedges[ar]);\r\n                this._link(ar, bl);\r\n\r\n                const br = b0 + (b + 1) % 3;\r\n\r\n                // don't worry about hitting the cap: it can only happen on extremely degenerate input\r\n                if (i < EDGE_STACK.length) {\r\n                    EDGE_STACK[i++] = br;\r\n                }\r\n            } else {\r\n                if (i === 0) break;\r\n                a = EDGE_STACK[--i];\r\n            }\r\n        }\r\n\r\n        return ar;\r\n    }\r\n\r\n    _link(a, b) {\r\n        this._halfedges[a] = b;\r\n        if (b !== -1) this._halfedges[b] = a;\r\n    }\r\n\r\n    // add a new triangle given vertex indices and adjacent half-edge ids\r\n    _addTriangle(i0, i1, i2, a, b, c) {\r\n        const t = this.trianglesLen;\r\n\r\n        this._triangles[t] = i0;\r\n        this._triangles[t + 1] = i1;\r\n        this._triangles[t + 2] = i2;\r\n\r\n        this._link(t, a);\r\n        this._link(t + 1, b);\r\n        this._link(t + 2, c);\r\n\r\n        this.trianglesLen += 3;\r\n\r\n        return t;\r\n    }\r\n}\r\n\r\n// monotonically increases with real angle, but doesn't need expensive trigonometry\r\nfunction pseudoAngle(dx, dy) {\r\n    const p = dx / (Math.abs(dx) + Math.abs(dy));\r\n    return (dy > 0 ? 3 - p : 1 + p) / 4; // [0..1]\r\n}\r\n\r\nfunction dist(ax, ay, bx, by) {\r\n    const dx = ax - bx;\r\n    const dy = ay - by;\r\n    return dx * dx + dy * dy;\r\n}\r\n\r\nfunction inCircle(ax, ay, bx, by, cx, cy, px, py) {\r\n    const dx = ax - px;\r\n    const dy = ay - py;\r\n    const ex = bx - px;\r\n    const ey = by - py;\r\n    const fx = cx - px;\r\n    const fy = cy - py;\r\n\r\n    const ap = dx * dx + dy * dy;\r\n    const bp = ex * ex + ey * ey;\r\n    const cp = fx * fx + fy * fy;\r\n\r\n    return dx * (ey * cp - bp * fy) -\r\n           dy * (ex * cp - bp * fx) +\r\n           ap * (ex * fy - ey * fx) < 0;\r\n}\r\n\r\nfunction circumradius(ax, ay, bx, by, cx, cy) {\r\n    const dx = bx - ax;\r\n    const dy = by - ay;\r\n    const ex = cx - ax;\r\n    const ey = cy - ay;\r\n\r\n    const bl = dx * dx + dy * dy;\r\n    const cl = ex * ex + ey * ey;\r\n    const d = 0.5 / (dx * ey - dy * ex);\r\n\r\n    const x = (ey * bl - dy * cl) * d;\r\n    const y = (dx * cl - ex * bl) * d;\r\n\r\n    return x * x + y * y;\r\n}\r\n\r\nfunction circumcenter(ax, ay, bx, by, cx, cy) {\r\n    const dx = bx - ax;\r\n    const dy = by - ay;\r\n    const ex = cx - ax;\r\n    const ey = cy - ay;\r\n\r\n    const bl = dx * dx + dy * dy;\r\n    const cl = ex * ex + ey * ey;\r\n    const d = 0.5 / (dx * ey - dy * ex);\r\n\r\n    const x = ax + (ey * bl - dy * cl) * d;\r\n    const y = ay + (dx * cl - ex * bl) * d;\r\n\r\n    return {x, y};\r\n}\r\n\r\nfunction quicksort(ids, dists, left, right) {\r\n    if (right - left <= 20) {\r\n        for (let i = left + 1; i <= right; i++) {\r\n            const temp = ids[i];\r\n            const tempDist = dists[temp];\r\n            let j = i - 1;\r\n            while (j >= left && dists[ids[j]] > tempDist) ids[j + 1] = ids[j--];\r\n            ids[j + 1] = temp;\r\n        }\r\n    } else {\r\n        const median = (left + right) >> 1;\r\n        let i = left + 1;\r\n        let j = right;\r\n        swap(ids, median, i);\r\n        if (dists[ids[left]] > dists[ids[right]]) swap(ids, left, right);\r\n        if (dists[ids[i]] > dists[ids[right]]) swap(ids, i, right);\r\n        if (dists[ids[left]] > dists[ids[i]]) swap(ids, left, i);\r\n\r\n        const temp = ids[i];\r\n        const tempDist = dists[temp];\r\n        while (true) {\r\n            do i++; while (dists[ids[i]] < tempDist);\r\n            do j--; while (dists[ids[j]] > tempDist);\r\n            if (j < i) break;\r\n            swap(ids, i, j);\r\n        }\r\n        ids[left + 1] = ids[j];\r\n        ids[j] = temp;\r\n\r\n        if (right - i + 1 >= j - left) {\r\n            quicksort(ids, dists, i, right);\r\n            quicksort(ids, dists, left, j - 1);\r\n        } else {\r\n            quicksort(ids, dists, left, j - 1);\r\n            quicksort(ids, dists, i, right);\r\n        }\r\n    }\r\n}\r\n\r\nfunction swap(arr, i, j) {\r\n    const tmp = arr[i];\r\n    arr[i] = arr[j];\r\n    arr[j] = tmp;\r\n}\r\n\r\nfunction defaultGetX(p) {\r\n    return p[0];\r\n}\r\nfunction defaultGetY(p) {\r\n    return p[1];\r\n}\r\n\r\nconst epsilon$1 = 1e-6;\r\n\r\nclass Path {\r\n  constructor() {\r\n    this._x0 = this._y0 = // start of current subpath\r\n    this._x1 = this._y1 = null; // end of current subpath\r\n    this._ = \"\";\r\n  }\r\n  moveTo(x, y) {\r\n    this._ += `M${this._x0 = this._x1 = +x},${this._y0 = this._y1 = +y}`;\r\n  }\r\n  closePath() {\r\n    if (this._x1 !== null) {\r\n      this._x1 = this._x0, this._y1 = this._y0;\r\n      this._ += \"Z\";\r\n    }\r\n  }\r\n  lineTo(x, y) {\r\n    this._ += `L${this._x1 = +x},${this._y1 = +y}`;\r\n  }\r\n  arc(x, y, r) {\r\n    x = +x, y = +y, r = +r;\r\n    const x0 = x + r;\r\n    const y0 = y;\r\n    if (r < 0) throw new Error(\"negative radius\");\r\n    if (this._x1 === null) this._ += `M${x0},${y0}`;\r\n    else if (Math.abs(this._x1 - x0) > epsilon$1 || Math.abs(this._y1 - y0) > epsilon$1) this._ += \"L\" + x0 + \",\" + y0;\r\n    if (!r) return;\r\n    this._ += `A${r},${r},0,1,1,${x - r},${y}A${r},${r},0,1,1,${this._x1 = x0},${this._y1 = y0}`;\r\n  }\r\n  rect(x, y, w, h) {\r\n    this._ += `M${this._x0 = this._x1 = +x},${this._y0 = this._y1 = +y}h${+w}v${+h}h${-w}Z`;\r\n  }\r\n  value() {\r\n    return this._ || null;\r\n  }\r\n}\r\n\r\nclass Polygon {\r\n  constructor() {\r\n    this._ = [];\r\n  }\r\n  moveTo(x, y) {\r\n    this._.push([x, y]);\r\n  }\r\n  closePath() {\r\n    this._.push(this._[0].slice());\r\n  }\r\n  lineTo(x, y) {\r\n    this._.push([x, y]);\r\n  }\r\n  value() {\r\n    return this._.length ? this._ : null;\r\n  }\r\n}\r\n\r\nclass Voronoi {\r\n  constructor(delaunay, [xmin, ymin, xmax, ymax] = [0, 0, 960, 500]) {\r\n    if (!((xmax = +xmax) >= (xmin = +xmin)) || !((ymax = +ymax) >= (ymin = +ymin))) throw new Error(\"invalid bounds\");\r\n    this.delaunay = delaunay;\r\n    this._circumcenters = new Float64Array(delaunay.points.length * 2);\r\n    this.vectors = new Float64Array(delaunay.points.length * 2);\r\n    this.xmax = xmax, this.xmin = xmin;\r\n    this.ymax = ymax, this.ymin = ymin;\r\n    this._init();\r\n  }\r\n  update() {\r\n    this.delaunay.update();\r\n    this._init();\r\n    return this;\r\n  }\r\n  _init() {\r\n    const {delaunay: {points, hull, triangles}, vectors} = this;\r\n\r\n    // Compute circumcenters.\r\n    const circumcenters = this.circumcenters = this._circumcenters.subarray(0, triangles.length / 3 * 2);\r\n    for (let i = 0, j = 0, n = triangles.length, x, y; i < n; i += 3, j += 2) {\r\n      const t1 = triangles[i] * 2;\r\n      const t2 = triangles[i + 1] * 2;\r\n      const t3 = triangles[i + 2] * 2;\r\n      const x1 = points[t1];\r\n      const y1 = points[t1 + 1];\r\n      const x2 = points[t2];\r\n      const y2 = points[t2 + 1];\r\n      const x3 = points[t3];\r\n      const y3 = points[t3 + 1];\r\n\r\n      const dx = x2 - x1;\r\n      const dy = y2 - y1;\r\n      const ex = x3 - x1;\r\n      const ey = y3 - y1;\r\n      const ab = (dx * ey - dy * ex) * 2;\r\n\r\n      if (Math.abs(ab) < 1e-9) {\r\n        // degenerate case (collinear diagram)\r\n        // almost equal points (degenerate triangle)\r\n        // the circumcenter is at the infinity, in a\r\n        // direction that is:\r\n        // 1. orthogonal to the halfedge.\r\n        let a = 1e9;\r\n        // 2. points away from the center; since the list of triangles starts\r\n        // in the center, the first point of the first triangle\r\n        // will be our reference\r\n        const r = triangles[0] * 2;\r\n        a *= Math.sign((points[r] - x1) * ey - (points[r + 1] - y1) * ex);\r\n        x = (x1 + x3) / 2 - a * ey;\r\n        y = (y1 + y3) / 2 + a * ex;\r\n      } else {\r\n        const d = 1 / ab;\r\n        const bl = dx * dx + dy * dy;\r\n        const cl = ex * ex + ey * ey;\r\n        x = x1 + (ey * bl - dy * cl) * d;\r\n        y = y1 + (dx * cl - ex * bl) * d;\r\n      }\r\n      circumcenters[j] = x;\r\n      circumcenters[j + 1] = y;\r\n    }\r\n\r\n    // Compute exterior cell rays.\r\n    let h = hull[hull.length - 1];\r\n    let p0, p1 = h * 4;\r\n    let x0, x1 = points[2 * h];\r\n    let y0, y1 = points[2 * h + 1];\r\n    vectors.fill(0);\r\n    for (let i = 0; i < hull.length; ++i) {\r\n      h = hull[i];\r\n      p0 = p1, x0 = x1, y0 = y1;\r\n      p1 = h * 4, x1 = points[2 * h], y1 = points[2 * h + 1];\r\n      vectors[p0 + 2] = vectors[p1] = y0 - y1;\r\n      vectors[p0 + 3] = vectors[p1 + 1] = x1 - x0;\r\n    }\r\n  }\r\n  render(context) {\r\n    const buffer = context == null ? context = new Path : undefined;\r\n    const {delaunay: {halfedges, inedges, hull}, circumcenters, vectors} = this;\r\n    if (hull.length <= 1) return null;\r\n    for (let i = 0, n = halfedges.length; i < n; ++i) {\r\n      const j = halfedges[i];\r\n      if (j < i) continue;\r\n      const ti = Math.floor(i / 3) * 2;\r\n      const tj = Math.floor(j / 3) * 2;\r\n      const xi = circumcenters[ti];\r\n      const yi = circumcenters[ti + 1];\r\n      const xj = circumcenters[tj];\r\n      const yj = circumcenters[tj + 1];\r\n      this._renderSegment(xi, yi, xj, yj, context);\r\n    }\r\n    let h0, h1 = hull[hull.length - 1];\r\n    for (let i = 0; i < hull.length; ++i) {\r\n      h0 = h1, h1 = hull[i];\r\n      const t = Math.floor(inedges[h1] / 3) * 2;\r\n      const x = circumcenters[t];\r\n      const y = circumcenters[t + 1];\r\n      const v = h0 * 4;\r\n      const p = this._project(x, y, vectors[v + 2], vectors[v + 3]);\r\n      if (p) this._renderSegment(x, y, p[0], p[1], context);\r\n    }\r\n    return buffer && buffer.value();\r\n  }\r\n  renderBounds(context) {\r\n    const buffer = context == null ? context = new Path : undefined;\r\n    context.rect(this.xmin, this.ymin, this.xmax - this.xmin, this.ymax - this.ymin);\r\n    return buffer && buffer.value();\r\n  }\r\n  renderCell(i, context) {\r\n    const buffer = context == null ? context = new Path : undefined;\r\n    const points = this._clip(i);\r\n    if (points === null || !points.length) return;\r\n    context.moveTo(points[0], points[1]);\r\n    let n = points.length;\r\n    while (points[0] === points[n-2] && points[1] === points[n-1] && n > 1) n -= 2;\r\n    for (let i = 2; i < n; i += 2) {\r\n      if (points[i] !== points[i-2] || points[i+1] !== points[i-1])\r\n        context.lineTo(points[i], points[i + 1]);\r\n    }\r\n    context.closePath();\r\n    return buffer && buffer.value();\r\n  }\r\n  *cellPolygons() {\r\n    const {delaunay: {points}} = this;\r\n    for (let i = 0, n = points.length / 2; i < n; ++i) {\r\n      const cell = this.cellPolygon(i);\r\n      if (cell) cell.index = i, yield cell;\r\n    }\r\n  }\r\n  cellPolygon(i) {\r\n    const polygon = new Polygon;\r\n    this.renderCell(i, polygon);\r\n    return polygon.value();\r\n  }\r\n  _renderSegment(x0, y0, x1, y1, context) {\r\n    let S;\r\n    const c0 = this._regioncode(x0, y0);\r\n    const c1 = this._regioncode(x1, y1);\r\n    if (c0 === 0 && c1 === 0) {\r\n      context.moveTo(x0, y0);\r\n      context.lineTo(x1, y1);\r\n    } else if (S = this._clipSegment(x0, y0, x1, y1, c0, c1)) {\r\n      context.moveTo(S[0], S[1]);\r\n      context.lineTo(S[2], S[3]);\r\n    }\r\n  }\r\n  contains(i, x, y) {\r\n    if ((x = +x, x !== x) || (y = +y, y !== y)) return false;\r\n    return this.delaunay._step(i, x, y) === i;\r\n  }\r\n  *neighbors(i) {\r\n    const ci = this._clip(i);\r\n    if (ci) for (const j of this.delaunay.neighbors(i)) {\r\n      const cj = this._clip(j);\r\n      // find the common edge\r\n      if (cj) loop: for (let ai = 0, li = ci.length; ai < li; ai += 2) {\r\n        for (let aj = 0, lj = cj.length; aj < lj; aj += 2) {\r\n          if (ci[ai] == cj[aj]\r\n          && ci[ai + 1] == cj[aj + 1]\r\n          && ci[(ai + 2) % li] == cj[(aj + lj - 2) % lj]\r\n          && ci[(ai + 3) % li] == cj[(aj + lj - 1) % lj]\r\n          ) {\r\n            yield j;\r\n            break loop;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  _cell(i) {\r\n    const {circumcenters, delaunay: {inedges, halfedges, triangles}} = this;\r\n    const e0 = inedges[i];\r\n    if (e0 === -1) return null; // coincident point\r\n    const points = [];\r\n    let e = e0;\r\n    do {\r\n      const t = Math.floor(e / 3);\r\n      points.push(circumcenters[t * 2], circumcenters[t * 2 + 1]);\r\n      e = e % 3 === 2 ? e - 2 : e + 1;\r\n      if (triangles[e] !== i) break; // bad triangulation\r\n      e = halfedges[e];\r\n    } while (e !== e0 && e !== -1);\r\n    return points;\r\n  }\r\n  _clip(i) {\r\n    // degenerate case (1 valid point: return the box)\r\n    if (i === 0 && this.delaunay.hull.length === 1) {\r\n      return [this.xmax, this.ymin, this.xmax, this.ymax, this.xmin, this.ymax, this.xmin, this.ymin];\r\n    }\r\n    const points = this._cell(i);\r\n    if (points === null) return null;\r\n    const {vectors: V} = this;\r\n    const v = i * 4;\r\n    return V[v] || V[v + 1]\r\n        ? this._clipInfinite(i, points, V[v], V[v + 1], V[v + 2], V[v + 3])\r\n        : this._clipFinite(i, points);\r\n  }\r\n  _clipFinite(i, points) {\r\n    const n = points.length;\r\n    let P = null;\r\n    let x0, y0, x1 = points[n - 2], y1 = points[n - 1];\r\n    let c0, c1 = this._regioncode(x1, y1);\r\n    let e0, e1 = 0;\r\n    for (let j = 0; j < n; j += 2) {\r\n      x0 = x1, y0 = y1, x1 = points[j], y1 = points[j + 1];\r\n      c0 = c1, c1 = this._regioncode(x1, y1);\r\n      if (c0 === 0 && c1 === 0) {\r\n        e0 = e1, e1 = 0;\r\n        if (P) P.push(x1, y1);\r\n        else P = [x1, y1];\r\n      } else {\r\n        let S, sx0, sy0, sx1, sy1;\r\n        if (c0 === 0) {\r\n          if ((S = this._clipSegment(x0, y0, x1, y1, c0, c1)) === null) continue;\r\n          [sx0, sy0, sx1, sy1] = S;\r\n        } else {\r\n          if ((S = this._clipSegment(x1, y1, x0, y0, c1, c0)) === null) continue;\r\n          [sx1, sy1, sx0, sy0] = S;\r\n          e0 = e1, e1 = this._edgecode(sx0, sy0);\r\n          if (e0 && e1) this._edge(i, e0, e1, P, P.length);\r\n          if (P) P.push(sx0, sy0);\r\n          else P = [sx0, sy0];\r\n        }\r\n        e0 = e1, e1 = this._edgecode(sx1, sy1);\r\n        if (e0 && e1) this._edge(i, e0, e1, P, P.length);\r\n        if (P) P.push(sx1, sy1);\r\n        else P = [sx1, sy1];\r\n      }\r\n    }\r\n    if (P) {\r\n      e0 = e1, e1 = this._edgecode(P[0], P[1]);\r\n      if (e0 && e1) this._edge(i, e0, e1, P, P.length);\r\n    } else if (this.contains(i, (this.xmin + this.xmax) / 2, (this.ymin + this.ymax) / 2)) {\r\n      return [this.xmax, this.ymin, this.xmax, this.ymax, this.xmin, this.ymax, this.xmin, this.ymin];\r\n    }\r\n    return P;\r\n  }\r\n  _clipSegment(x0, y0, x1, y1, c0, c1) {\r\n    while (true) {\r\n      if (c0 === 0 && c1 === 0) return [x0, y0, x1, y1];\r\n      if (c0 & c1) return null;\r\n      let x, y, c = c0 || c1;\r\n      if (c & 0b1000) x = x0 + (x1 - x0) * (this.ymax - y0) / (y1 - y0), y = this.ymax;\r\n      else if (c & 0b0100) x = x0 + (x1 - x0) * (this.ymin - y0) / (y1 - y0), y = this.ymin;\r\n      else if (c & 0b0010) y = y0 + (y1 - y0) * (this.xmax - x0) / (x1 - x0), x = this.xmax;\r\n      else y = y0 + (y1 - y0) * (this.xmin - x0) / (x1 - x0), x = this.xmin;\r\n      if (c0) x0 = x, y0 = y, c0 = this._regioncode(x0, y0);\r\n      else x1 = x, y1 = y, c1 = this._regioncode(x1, y1);\r\n    }\r\n  }\r\n  _clipInfinite(i, points, vx0, vy0, vxn, vyn) {\r\n    let P = Array.from(points), p;\r\n    if (p = this._project(P[0], P[1], vx0, vy0)) P.unshift(p[0], p[1]);\r\n    if (p = this._project(P[P.length - 2], P[P.length - 1], vxn, vyn)) P.push(p[0], p[1]);\r\n    if (P = this._clipFinite(i, P)) {\r\n      for (let j = 0, n = P.length, c0, c1 = this._edgecode(P[n - 2], P[n - 1]); j < n; j += 2) {\r\n        c0 = c1, c1 = this._edgecode(P[j], P[j + 1]);\r\n        if (c0 && c1) j = this._edge(i, c0, c1, P, j), n = P.length;\r\n      }\r\n    } else if (this.contains(i, (this.xmin + this.xmax) / 2, (this.ymin + this.ymax) / 2)) {\r\n      P = [this.xmin, this.ymin, this.xmax, this.ymin, this.xmax, this.ymax, this.xmin, this.ymax];\r\n    }\r\n    return P;\r\n  }\r\n  _edge(i, e0, e1, P, j) {\r\n    while (e0 !== e1) {\r\n      let x, y;\r\n      switch (e0) {\r\n        case 0b0101: e0 = 0b0100; continue; // top-left\r\n        case 0b0100: e0 = 0b0110, x = this.xmax, y = this.ymin; break; // top\r\n        case 0b0110: e0 = 0b0010; continue; // top-right\r\n        case 0b0010: e0 = 0b1010, x = this.xmax, y = this.ymax; break; // right\r\n        case 0b1010: e0 = 0b1000; continue; // bottom-right\r\n        case 0b1000: e0 = 0b1001, x = this.xmin, y = this.ymax; break; // bottom\r\n        case 0b1001: e0 = 0b0001; continue; // bottom-left\r\n        case 0b0001: e0 = 0b0101, x = this.xmin, y = this.ymin; break; // left\r\n      }\r\n      // Note: this implicitly checks for out of bounds: if P[j] or P[j+1] are\r\n      // undefined, the conditional statement will be executed.\r\n      if ((P[j] !== x || P[j + 1] !== y) && this.contains(i, x, y)) {\r\n        P.splice(j, 0, x, y), j += 2;\r\n      }\r\n    }\r\n    if (P.length > 4) {\r\n      for (let i = 0; i < P.length; i+= 2) {\r\n        const j = (i + 2) % P.length, k = (i + 4) % P.length;\r\n        if (P[i] === P[j] && P[j] === P[k]\r\n        || P[i + 1] === P[j + 1] && P[j + 1] === P[k + 1])\r\n          P.splice(j, 2), i -= 2;\r\n      }\r\n    }\r\n    return j;\r\n  }\r\n  _project(x0, y0, vx, vy) {\r\n    let t = Infinity, c, x, y;\r\n    if (vy < 0) { // top\r\n      if (y0 <= this.ymin) return null;\r\n      if ((c = (this.ymin - y0) / vy) < t) y = this.ymin, x = x0 + (t = c) * vx;\r\n    } else if (vy > 0) { // bottom\r\n      if (y0 >= this.ymax) return null;\r\n      if ((c = (this.ymax - y0) / vy) < t) y = this.ymax, x = x0 + (t = c) * vx;\r\n    }\r\n    if (vx > 0) { // right\r\n      if (x0 >= this.xmax) return null;\r\n      if ((c = (this.xmax - x0) / vx) < t) x = this.xmax, y = y0 + (t = c) * vy;\r\n    } else if (vx < 0) { // left\r\n      if (x0 <= this.xmin) return null;\r\n      if ((c = (this.xmin - x0) / vx) < t) x = this.xmin, y = y0 + (t = c) * vy;\r\n    }\r\n    return [x, y];\r\n  }\r\n  _edgecode(x, y) {\r\n    return (x === this.xmin ? 0b0001\r\n        : x === this.xmax ? 0b0010 : 0b0000)\r\n        | (y === this.ymin ? 0b0100\r\n        : y === this.ymax ? 0b1000 : 0b0000);\r\n  }\r\n  _regioncode(x, y) {\r\n    return (x < this.xmin ? 0b0001\r\n        : x > this.xmax ? 0b0010 : 0b0000)\r\n        | (y < this.ymin ? 0b0100\r\n        : y > this.ymax ? 0b1000 : 0b0000);\r\n  }\r\n}\r\n\r\nconst tau = 2 * Math.PI, pow = Math.pow;\r\n\r\nfunction pointX(p) {\r\n  return p[0];\r\n}\r\n\r\nfunction pointY(p) {\r\n  return p[1];\r\n}\r\n\r\n// A triangulation is collinear if all its triangles have a non-null area\r\nfunction collinear(d) {\r\n  const {triangles, coords} = d;\r\n  for (let i = 0; i < triangles.length; i += 3) {\r\n    const a = 2 * triangles[i],\r\n          b = 2 * triangles[i + 1],\r\n          c = 2 * triangles[i + 2],\r\n          cross = (coords[c] - coords[a]) * (coords[b + 1] - coords[a + 1])\r\n                - (coords[b] - coords[a]) * (coords[c + 1] - coords[a + 1]);\r\n    if (cross > 1e-10) return false;\r\n  }\r\n  return true;\r\n}\r\n\r\nfunction jitter(x, y, r) {\r\n  return [x + Math.sin(x + y) * r, y + Math.cos(x - y) * r];\r\n}\r\n\r\nclass Delaunay {\r\n  static from(points, fx = pointX, fy = pointY, that) {\r\n    return new Delaunay(\"length\" in points\r\n        ? flatArray(points, fx, fy, that)\r\n        : Float64Array.from(flatIterable(points, fx, fy, that)));\r\n  }\r\n  constructor(points) {\r\n    this._delaunator = new Delaunator(points);\r\n    this.inedges = new Int32Array(points.length / 2);\r\n    this._hullIndex = new Int32Array(points.length / 2);\r\n    this.points = this._delaunator.coords;\r\n    this._init();\r\n  }\r\n  update() {\r\n    this._delaunator.update();\r\n    this._init();\r\n    return this;\r\n  }\r\n  _init() {\r\n    const d = this._delaunator, points = this.points;\r\n\r\n    // check for collinear\r\n    if (d.hull && d.hull.length > 2 && collinear(d)) {\r\n      this.collinear = Int32Array.from({length: points.length/2}, (_,i) => i)\r\n        .sort((i, j) => points[2 * i] - points[2 * j] || points[2 * i + 1] - points[2 * j + 1]); // for exact neighbors\r\n      const e = this.collinear[0], f = this.collinear[this.collinear.length - 1],\r\n        bounds = [ points[2 * e], points[2 * e + 1], points[2 * f], points[2 * f + 1] ],\r\n        r = 1e-8 * Math.hypot(bounds[3] - bounds[1], bounds[2] - bounds[0]);\r\n      for (let i = 0, n = points.length / 2; i < n; ++i) {\r\n        const p = jitter(points[2 * i], points[2 * i + 1], r);\r\n        points[2 * i] = p[0];\r\n        points[2 * i + 1] = p[1];\r\n      }\r\n      this._delaunator = new Delaunator(points);\r\n    } else {\r\n      delete this.collinear;\r\n    }\r\n\r\n    const halfedges = this.halfedges = this._delaunator.halfedges;\r\n    const hull = this.hull = this._delaunator.hull;\r\n    const triangles = this.triangles = this._delaunator.triangles;\r\n    const inedges = this.inedges.fill(-1);\r\n    const hullIndex = this._hullIndex.fill(-1);\r\n\r\n    // Compute an index from each point to an (arbitrary) incoming halfedge\r\n    // Used to give the first neighbor of each point; for this reason,\r\n    // on the hull we give priority to exterior halfedges\r\n    for (let e = 0, n = halfedges.length; e < n; ++e) {\r\n      const p = triangles[e % 3 === 2 ? e - 2 : e + 1];\r\n      if (halfedges[e] === -1 || inedges[p] === -1) inedges[p] = e;\r\n    }\r\n    for (let i = 0, n = hull.length; i < n; ++i) {\r\n      hullIndex[hull[i]] = i;\r\n    }\r\n\r\n    // degenerate case: 1 or 2 (distinct) points\r\n    if (hull.length <= 2 && hull.length > 0) {\r\n      this.triangles = new Int32Array(3).fill(-1);\r\n      this.halfedges = new Int32Array(3).fill(-1);\r\n      this.triangles[0] = hull[0];\r\n      inedges[hull[0]] = 1;\r\n      if (hull.length === 2) {\r\n        inedges[hull[1]] = 0;\r\n        this.triangles[1] = hull[1];\r\n        this.triangles[2] = hull[1];\r\n      }\r\n    }\r\n  }\r\n  voronoi(bounds) {\r\n    return new Voronoi(this, bounds);\r\n  }\r\n  *neighbors(i) {\r\n    const {inedges, hull, _hullIndex, halfedges, triangles, collinear} = this;\r\n\r\n    // degenerate case with several collinear points\r\n    if (collinear) {\r\n      const l = collinear.indexOf(i);\r\n      if (l > 0) yield collinear[l - 1];\r\n      if (l < collinear.length - 1) yield collinear[l + 1];\r\n      return;\r\n    }\r\n\r\n    const e0 = inedges[i];\r\n    if (e0 === -1) return; // coincident point\r\n    let e = e0, p0 = -1;\r\n    do {\r\n      yield p0 = triangles[e];\r\n      e = e % 3 === 2 ? e - 2 : e + 1;\r\n      if (triangles[e] !== i) return; // bad triangulation\r\n      e = halfedges[e];\r\n      if (e === -1) {\r\n        const p = hull[(_hullIndex[i] + 1) % hull.length];\r\n        if (p !== p0) yield p;\r\n        return;\r\n      }\r\n    } while (e !== e0);\r\n  }\r\n  find(x, y, i = 0) {\r\n    if ((x = +x, x !== x) || (y = +y, y !== y)) return -1;\r\n    const i0 = i;\r\n    let c;\r\n    while ((c = this._step(i, x, y)) >= 0 && c !== i && c !== i0) i = c;\r\n    return c;\r\n  }\r\n  _step(i, x, y) {\r\n    const {inedges, hull, _hullIndex, halfedges, triangles, points} = this;\r\n    if (inedges[i] === -1 || !points.length) return (i + 1) % (points.length >> 1);\r\n    let c = i;\r\n    let dc = pow(x - points[i * 2], 2) + pow(y - points[i * 2 + 1], 2);\r\n    const e0 = inedges[i];\r\n    let e = e0;\r\n    do {\r\n      let t = triangles[e];\r\n      const dt = pow(x - points[t * 2], 2) + pow(y - points[t * 2 + 1], 2);\r\n      if (dt < dc) dc = dt, c = t;\r\n      e = e % 3 === 2 ? e - 2 : e + 1;\r\n      if (triangles[e] !== i) break; // bad triangulation\r\n      e = halfedges[e];\r\n      if (e === -1) {\r\n        e = hull[(_hullIndex[i] + 1) % hull.length];\r\n        if (e !== t) {\r\n          if (pow(x - points[e * 2], 2) + pow(y - points[e * 2 + 1], 2) < dc) return e;\r\n        }\r\n        break;\r\n      }\r\n    } while (e !== e0);\r\n    return c;\r\n  }\r\n  render(context) {\r\n    const buffer = context == null ? context = new Path : undefined;\r\n    const {points, halfedges, triangles} = this;\r\n    for (let i = 0, n = halfedges.length; i < n; ++i) {\r\n      const j = halfedges[i];\r\n      if (j < i) continue;\r\n      const ti = triangles[i] * 2;\r\n      const tj = triangles[j] * 2;\r\n      context.moveTo(points[ti], points[ti + 1]);\r\n      context.lineTo(points[tj], points[tj + 1]);\r\n    }\r\n    this.renderHull(context);\r\n    return buffer && buffer.value();\r\n  }\r\n  renderPoints(context, r) {\r\n    if (r === undefined && (!context || typeof context.moveTo !== \"function\")) r = context, context = null;\r\n    r = r == undefined ? 2 : +r;\r\n    const buffer = context == null ? context = new Path : undefined;\r\n    const {points} = this;\r\n    for (let i = 0, n = points.length; i < n; i += 2) {\r\n      const x = points[i], y = points[i + 1];\r\n      context.moveTo(x + r, y);\r\n      context.arc(x, y, r, 0, tau);\r\n    }\r\n    return buffer && buffer.value();\r\n  }\r\n  renderHull(context) {\r\n    const buffer = context == null ? context = new Path : undefined;\r\n    const {hull, points} = this;\r\n    const h = hull[0] * 2, n = hull.length;\r\n    context.moveTo(points[h], points[h + 1]);\r\n    for (let i = 1; i < n; ++i) {\r\n      const h = 2 * hull[i];\r\n      context.lineTo(points[h], points[h + 1]);\r\n    }\r\n    context.closePath();\r\n    return buffer && buffer.value();\r\n  }\r\n  hullPolygon() {\r\n    const polygon = new Polygon;\r\n    this.renderHull(polygon);\r\n    return polygon.value();\r\n  }\r\n  renderTriangle(i, context) {\r\n    const buffer = context == null ? context = new Path : undefined;\r\n    const {points, triangles} = this;\r\n    const t0 = triangles[i *= 3] * 2;\r\n    const t1 = triangles[i + 1] * 2;\r\n    const t2 = triangles[i + 2] * 2;\r\n    context.moveTo(points[t0], points[t0 + 1]);\r\n    context.lineTo(points[t1], points[t1 + 1]);\r\n    context.lineTo(points[t2], points[t2 + 1]);\r\n    context.closePath();\r\n    return buffer && buffer.value();\r\n  }\r\n  *trianglePolygons() {\r\n    const {triangles} = this;\r\n    for (let i = 0, n = triangles.length / 3; i < n; ++i) {\r\n      yield this.trianglePolygon(i);\r\n    }\r\n  }\r\n  trianglePolygon(i) {\r\n    const polygon = new Polygon;\r\n    this.renderTriangle(i, polygon);\r\n    return polygon.value();\r\n  }\r\n}\r\n\r\nfunction flatArray(points, fx, fy, that) {\r\n  const n = points.length;\r\n  const array = new Float64Array(n * 2);\r\n  for (let i = 0; i < n; ++i) {\r\n    const p = points[i];\r\n    array[i * 2] = fx.call(that, p, i, points);\r\n    array[i * 2 + 1] = fy.call(that, p, i, points);\r\n  }\r\n  return array;\r\n}\r\n\r\nfunction* flatIterable(points, fx, fy, that) {\r\n  let i = 0;\r\n  for (const p of points) {\r\n    yield fx.call(that, p, i, points);\r\n    yield fy.call(that, p, i, points);\r\n    ++i;\r\n  }\r\n}\r\n\r\nexport { Delaunay, Voronoi };\r\n","/** @module */\r\n\r\n// d3-voronoi\r\n// d3-select\r\n// d3-range\r\n\r\nimport { Delaunay } from '../lib/snowpack/build/snowpack/pkg/d3-delaunay.js'\r\n// import { Delaunay } from 'd3-delaunay'\r\n// import { Delaunay } from 'https://cdn.skypack.dev/d3-delaunay@6'\r\n// https://github.com/d3/d3-delaunay\r\n\r\n/**\r\n * Draw Voronoi cells to show votes.\r\n * @param {VoterGroup} voterGroup\r\n * @param {CandidateSimList} candidateSimList\r\n * @param {Screen} screen\r\n * @constructor\r\n */\r\nexport default function Voronoi2D(voterGroup, candidateSimList, screen) {\r\n    const self = this\r\n\r\n    const cans = candidateSimList.getCandidates()\r\n    const points = cans.map((e) => [e.x, e.y])\r\n    const delaunay = Delaunay.from(points)\r\n    const voronoi = delaunay.voronoi([0, 0, screen.width, screen.height])\r\n\r\n    self.render = function () {\r\n        const { ctx } = screen\r\n\r\n        ctx.save()\r\n\r\n        // draw circle clip\r\n\r\n        // http://jsfiddle.net/jimrhoskins/dDUC3/1/\r\n        // https://dustinpfister.github.io/2019/10/08/canvas-clip/\r\n        ctx.beginPath()\r\n        ctx.arc(voterGroup.x, voterGroup.y, voterGroup.shape2.w * 0.5, 0, 2 * Math.PI)\r\n        // ctx.closePath()\r\n        ctx.clip()\r\n\r\n        const n = cans.length\r\n        for (let i = 0; i < n; i++) {\r\n            ctx.beginPath()\r\n            voronoi.renderCell(i, ctx)\r\n            ctx.fillStyle = cans[i].color\r\n            ctx.fill()\r\n            ctx.stroke()\r\n        }\r\n\r\n        ctx.beginPath()\r\n        ctx.arc(voterGroup.x, voterGroup.y, voterGroup.shape2.w * 0.5, 0, 2 * Math.PI)\r\n        ctx.stroke()\r\n\r\n        ctx.restore()\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport Grid2D from './Grid2D.js'\r\nimport Voronoi2D from './Voronoi2D.js'\r\n\r\n/**\r\n * Show votes\r\n * @param {Screen} screen\r\n * @constructor\r\n */\r\nexport default function VizOne2D(oneVoters, candidateSimList, screen, sim) {\r\n    const self = this\r\n\r\n    let voronoiGroups = []\r\n    let grid2Ds = []\r\n\r\n    self.update = function (votes) {\r\n        const voterShapes = oneVoters.getVoterShapes()\r\n        if (sim.election.countVotes.caster === 'castPlurality') {\r\n            voronoiGroups = voterShapes.map(\r\n                (voterShape) => new Voronoi2D(voterShape, candidateSimList, screen),\r\n            )\r\n        } else { // \"score\"\r\n            if (votes.error) return\r\n            grid2Ds = []\r\n            for (let i = 0; i < votes.gridData.length; i++) {\r\n                const vo = votes.gridData[i]\r\n\r\n                const grid2D = new Grid2D(vo, candidateSimList, screen)\r\n                grid2Ds.push(grid2D)\r\n            }\r\n        }\r\n    }\r\n\r\n    self.render = function () {\r\n        if (sim.election.countVotes.caster === 'castPlurality') {\r\n            voronoiGroups.forEach(\r\n                (voronoiGroup) => voronoiGroup.render(),\r\n            )\r\n        } else { // \"score\"\r\n            grid2Ds.forEach(\r\n                (grid2D) => grid2D.render(),\r\n            )\r\n        }\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport CandidateSim from '../../candidates/CandidateSim.js'\r\nimport CandidateSimList from '../../candidates/CandidateSimList.js'\r\nimport VoterSimList from '../../voters/VoterSimList.js'\r\nimport SimBase from './SimBase.js'\r\nimport VoterSim from '../../voters/VoterSim.js'\r\nimport VizOne2D from '../../viz/VizOne2D.js'\r\n\r\n/**\r\n * Simulate one election with\r\n *   candidates in defined positions, and\r\n *   voters in a distribution that will be summed over.\r\n * @param {Screen} screen\r\n * @param {Menu} menu\r\n * @param {Changes} changes\r\n * @param {ElectionOne} electionOne\r\n * @param {Sim} sim\r\n * @constructor\r\n */\r\nexport default function SimOne2D(screen, menu, changes, electionOne, sim) {\r\n    const self = this\r\n\r\n    SimBase.call(self, screen, changes, sim)\r\n\r\n    const oneVoters = new VoterSimList(sim)\r\n\r\n    const candidateSimList = new CandidateSimList(sim)\r\n\r\n    self.addSimCandidate = (candidate) => {\r\n        candidateSimList.newCandidate(new CandidateSim(candidate, self.dragm))\r\n    }\r\n\r\n    self.addSimVoterCircle = (voterShape) => {\r\n        oneVoters.newVoterSim(new VoterSim(voterShape, self.dragm, screen))\r\n    }\r\n\r\n    const vizOne2D = new VizOne2D(oneVoters, candidateSimList, screen, sim)\r\n\r\n    const superEnter = self.enter\r\n    self.enter = () => {\r\n        superEnter()\r\n        sim.candidateAdd.canButton.show()\r\n        sim.election.setDimensions(2)\r\n        oneVoters.updateXY()\r\n        candidateSimList.updateXY()\r\n        sim.voterTest.updateXY()\r\n    }\r\n\r\n    self.exit = () => {\r\n        screen.hideMaps()\r\n        sim.candidateAdd.canButton.hide()\r\n        sim.voterTest.setE(0)\r\n    }\r\n\r\n    self.update = () => {\r\n        if (changes.checkNone()) return\r\n\r\n        // deal with changes\r\n        if (changes.check(['simType', 'electionMethod'])) {\r\n            // show or hide maps\r\n            if (sim.election.countVotes.caster === 'castScore') {\r\n                screen.showMaps()\r\n            } else {\r\n                screen.hideMaps()\r\n            }\r\n        }\r\n        changes.clear()\r\n\r\n        const votes = electionOne.updateTallies(oneVoters, candidateSimList)\r\n        vizOne2D.update(votes)\r\n        sim.voterTest.update()\r\n        screen.clear()\r\n        screen.clearMaps()\r\n        self.render()\r\n    }\r\n\r\n    self.testVote = () => electionOne.testVote(sim.voterTest, candidateSimList)\r\n\r\n    self.render = () => {\r\n        vizOne2D.render()\r\n    }\r\n    self.renderForeground = () => {\r\n        // electionSample.renderForeground()\r\n        oneVoters.renderForeground()\r\n        candidateSimList.renderForeground()\r\n        sim.voterTest.renderForeground()\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Use this to sample a random candidate from a collection of distributions of candidates.\r\n * Sample a point multiple times after the constructor call.\r\n * @param {CandidateDn[]} candidateDistributions\r\n * @constructor\r\n */\r\nexport default function CandidateDistributionSampler(candidateDistributions) {\r\n    const self = this\r\n    // cumulative distribution function\r\n    const cdf = getCDF(candidateDistributions)\r\n    self.samplePoint = function () {\r\n        return samplePoint1(candidateDistributions, cdf)\r\n    }\r\n}\r\n\r\nfunction samplePoint1(candidateDistributions, cdf) {\r\n    // pick a voter distribution\r\n    const iDist = randomDistribution(cdf)\r\n    const cd = candidateDistributions[iDist]\r\n    // sample circle\r\n    const point = randomInsideCircle(cd.shape2.x, cd.shape2.y, cd.shape2.w * 0.5)\r\n    return point\r\n}\r\n\r\nfunction randomDistribution(cdf) {\r\n    // sample from distribution\r\n    // pick a random number from 0 to 1\r\n    const random1 = Math.random()\r\n    const selectDistribution = cdf.findIndex((x) => x >= random1)\r\n    return selectDistribution\r\n}\r\n\r\nfunction getCDF(candidateDistributions) {\r\n    // find the size of the voter distributions\r\n    const areasProportion = candidateDistributions.map((cd) => cd.shape2.w ** 2)\r\n\r\n    const sumAreasProportion = areasProportion.reduce((p, c) => p + c)\r\n\r\n    // probability mass function\r\n    const pmf = areasProportion.map((p) => p / sumAreasProportion)\r\n\r\n    // https://stackoverflow.com/a/20477613\r\n    // [5, 10, 3, 2];\r\n    // [5, 15, 18, 20]\r\n    // cumulative distribution function\r\n    const cdf = []\r\n    pmf.reduce((p, c, i) => {\r\n        const a = p + c\r\n        cdf[i] = a\r\n        return a\r\n    }, 0)\r\n\r\n    return cdf\r\n}\r\n\r\nfunction randomInsideCircle(X, Y, R) {\r\n    // https://stackoverflow.com/a/50746409\r\n    const r = R * Math.sqrt(Math.random())\r\n    const theta = Math.random() * 2 * Math.PI\r\n\r\n    // convert to cartesian\r\n\r\n    const x = X + r * Math.cos(theta)\r\n    const y = Y + r * Math.sin(theta)\r\n    return { x, y }\r\n}\r\n","/** @module */\r\n\r\nimport CandidateDistributionSampler from '../election/CandidateDistributionSampler.js'\r\n\r\n/**\r\n * A simple list of candidateDnSim instances.\r\n * It really just passes along function calls to each member of the list.\r\n * It also checks if that member exists. Alternatively, it was deleted.\r\n * @constructor\r\n */\r\nexport default function CandidateDnSimList(sim) {\r\n    const self = this\r\n\r\n    const simCanDns = []\r\n\r\n    self.newCandidate = function (simCanDn) {\r\n        simCanDns.push(simCanDn)\r\n    }\r\n\r\n    // get sim entities that exist\r\n    self.getSimCandidateDistributions = () => {\r\n        const a = simCanDns.filter((simCanDn) => simCanDn.canDn.exists)\r\n        return a\r\n    }\r\n\r\n    // get the underlying entities of the above\r\n    self.getCandidateDistributions = () => {\r\n        const simCanDnsEx = self.getSimCandidateDistributions()\r\n        return simCanDnsEx.map((simCanDn) => simCanDn.canDn)\r\n    }\r\n    self.getCandidateDistributionsAll = () => simCanDns.map((simCanDn) => simCanDn.canDn)\r\n\r\n    self.startSampler = () => {\r\n        const canDns = self.getCandidateDistributions()\r\n        if (canDns.length === 0) return\r\n        self.sampler = new CandidateDistributionSampler(canDns)\r\n    }\r\n    self.updateXY = () => {\r\n        simCanDns.forEach((simCanDn) => simCanDn.canDn.updateXY())\r\n    }\r\n    self.render = () => {\r\n        const canDns = self.getCandidateDistributions()\r\n        canDns.forEach((canDn) => canDn.render())\r\n    }\r\n    self.renderForeground = () => {\r\n        if (sim.showGhosts) {\r\n            self.renderForegroundAll()\r\n        } else {\r\n            self.renderForegroundExisting()\r\n        }\r\n    }\r\n    self.renderForegroundExisting = () => {\r\n        const canDns = self.getCandidateDistributions()\r\n        canDns.forEach((canDn) => canDn.renderForeground())\r\n    }\r\n    self.renderForegroundAll = () => {\r\n        const cans = self.getCandidateDistributionsAll()\r\n        cans.forEach((can) => can.renderForeground())\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * CandidateSim has functionality for a canDn that is specific to a simulation.\r\n * CandidateSim has a canDn component.\r\n * The canDn component is a CandidateDn, for now.\r\n\r\n * @param {CandidateDn} canDn - a canDn component that CandidateSim builds upon.\r\n * @param {DraggableManager} dragm\r\n * @constructor\r\n */\r\nexport default function CandidateDnSim(canDn, dragm) {\r\n    const self = this\r\n    self.canDn = canDn\r\n\r\n    dragm.newSquareHandle(canDn, canDn.square)\r\n\r\n    self.renderForeground = () => {\r\n        self.canDn.renderForeground()\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Show Voters\r\n * @param {SampleVoters} sampleVoters\r\n * @param {screen} screen - draw to the screen\r\n * @constructor\r\n */\r\nexport default function VizSample2D(sampleVoters, screen) {\r\n    const self = this\r\n\r\n    // Candidates //\r\n\r\n    // buffer canvas\r\n    const canvas2 = document.createElement('canvas')\r\n    canvas2.width = screen.canvas.width\r\n    canvas2.height = screen.canvas.height\r\n    const context2 = canvas2.getContext('2d')\r\n\r\n    self.start = function () {\r\n        clearBuffer()\r\n    }\r\n\r\n    self.update = function (newPoints, points) {\r\n        self.points = points\r\n        renderToBuffer(newPoints)\r\n    }\r\n\r\n    self.render = () => {\r\n        self.renderCans()\r\n        self.renderVoters()\r\n    }\r\n\r\n    self.renderCans = function () {\r\n        if (screen.noBuffers) {\r\n            noBufferRender()\r\n        } else {\r\n            bufferRender()\r\n        }\r\n    }\r\n\r\n    function clearBuffer() {\r\n        context2.clearRect(0, 0, canvas2.width, canvas2.height)\r\n    }\r\n\r\n    function renderToBuffer(newPoints) {\r\n        const ctx = context2\r\n        renderPoints(ctx, newPoints)\r\n    }\r\n\r\n    function renderPoints(ctx, points) {\r\n        ctx.fillStyle = 'grey'\r\n        const n = points.length\r\n        for (let i = 0; i < n; i++) {\r\n            const p = points[i]\r\n            // dot\r\n            ctx.beginPath()\r\n            ctx.arc(p.x, p.y, 3, 0, 2 * Math.PI)\r\n            ctx.fill()\r\n        }\r\n    }\r\n\r\n    function bufferRender() {\r\n        const { ctx } = screen\r\n        ctx.drawImage(canvas2, 0, 0)\r\n    }\r\n\r\n    // use this if we want to export to an SVG\r\n    function noBufferRender() {\r\n        const { ctx } = screen\r\n        renderPoints(ctx, self.points)\r\n    }\r\n\r\n    // Voters //\r\n\r\n    self.renderVoters = function () {\r\n        const { ctx } = screen\r\n        const voterShapes = sampleVoters.getVoterShapes()\r\n        voterShapes.forEach((voterGroup) => {\r\n            // circle\r\n            ctx.beginPath()\r\n            // ctx.fillStyle = \"#eee\"\r\n            const { x, y, shape2 } = voterGroup\r\n            ctx.arc(x, y, shape2.w * 0.5, 0, 2 * Math.PI)\r\n            // ctx.fill()\r\n            ctx.stroke()\r\n        })\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport CandidateDnSimList from '../../candidateDns/CandidateDnSimList.js'\r\nimport CandidateDnSim from '../../candidateDns/CandidateDnSim.js'\r\nimport VizSample2D from '../../viz/VizSample2D.js'\r\nimport VoterSimList from '../../voters/VoterSimList.js'\r\nimport SimBase from './SimBase.js'\r\nimport VoterSim from '../../voters/VoterSim.js'\r\n\r\n/**\r\n * Simulate many sample elections with\r\n *   candidates in random positions within a distribution, and\r\n *   voters in a distribution that will be summed over.\r\n * @param {Screen} screen\r\n * @param {Menu} menu\r\n * @param {Changes} changes\r\n * @param {ElectionSample} electionSample\r\n * @param {Sim} sim\r\n * @constructor\r\n */\r\nexport default function SimSample(screen, menu, changes, electionSample, sim) {\r\n    const self = this\r\n\r\n    SimBase.call(self, screen, changes, sim)\r\n\r\n    const candidateSimList = new CandidateDnSimList(sim)\r\n\r\n    self.addSimCandidateDistribution = (canDn) => {\r\n        candidateSimList.newCandidate(new CandidateDnSim(canDn, self.dragm))\r\n    }\r\n\r\n    const sampleVoters = new VoterSimList(sim)\r\n\r\n    self.addSimVoterCircle = (voterShape) => {\r\n        sampleVoters.newVoterSim(new VoterSim(voterShape, self.dragm, screen))\r\n    }\r\n\r\n    const vizSample2D = new VizSample2D(sampleVoters, screen)\r\n\r\n    const superEnter = self.enter\r\n    self.enter = () => {\r\n        superEnter()\r\n        sim.candidateDnAdd.canDnButton.show()\r\n        sim.election.setDimensions(2)\r\n        sampleVoters.updateXY()\r\n        candidateSimList.updateXY()\r\n    }\r\n\r\n    self.exit = () => {\r\n        sim.candidateDnAdd.canDnButton.hide()\r\n    }\r\n\r\n    self.update = () => {\r\n        if (changes.checkNone()) {\r\n            const addResult = electionSample.addSim(sampleVoters, candidateSimList)\r\n            const { noChange, newPoints, points } = addResult\r\n            // changes.clear()\r\n            if (!noChange) {\r\n                vizSample2D.update(newPoints, points)\r\n                // changed, so re-render\r\n                screen.clear()\r\n                self.render()\r\n            }\r\n        } else {\r\n            // clear changes, reset to []\r\n            changes.clear()\r\n            candidateSimList.startSampler()\r\n            vizSample2D.start()\r\n            electionSample.startSim()\r\n            screen.clear()\r\n            self.render()\r\n        }\r\n    }\r\n\r\n    self.render = () => {\r\n        vizSample2D.render()\r\n        candidateSimList.render()\r\n    }\r\n    self.renderForeground = () => {\r\n        sampleVoters.renderForeground()\r\n        candidateSimList.renderForeground()\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport VoterSim from './VoterSim.js'\r\n/**\r\n * A basis of voters, to be moved around according to noise.\r\n * Also, the user can move them around.\r\n * This is a Subclass of VoterSim.\r\n * @param {VoterShape} voterShape - a voter component that VoterSim builds upon.\r\n * @param {DraggableManager} dragm\r\n * @param {screen} screen - draw to the screen\r\n * @constructor\r\n */\r\nexport default function VoterGeoBasis(voterShape, dragm, screen) {\r\n    const self = this\r\n    VoterSim.call(self, voterShape, dragm)\r\n\r\n    // Graphics component\r\n    self.render = function () {\r\n        const { ctx } = screen\r\n        const { x, y, shape2 } = self.voterShape\r\n        // circle\r\n        ctx.beginPath()\r\n        // ctx.fillStyle = \"#eee\"\r\n        ctx.arc(x, y, shape2.w * 0.5, 0, 2 * Math.PI)\r\n        // ctx.fill()\r\n        ctx.stroke()\r\n    }\r\n    self.renderAt = function (newX, newY) {\r\n        const { ctx } = screen\r\n        const { w } = self.voterShape.shape2\r\n        // circle\r\n        ctx.beginPath()\r\n        // ctx.fillStyle = \"#eee\"\r\n        ctx.arc(newX, newY, w * 0.5, 0, 2 * Math.PI)\r\n        // ctx.fill()\r\n        ctx.stroke()\r\n    }\r\n    self.renderCenterAt = function (newX, newY) {\r\n        const { ctx } = screen\r\n        // circle\r\n        ctx.beginPath()\r\n        ctx.fillStyle = '#555'\r\n        ctx.arc(newX, newY, 1, 0, 2 * Math.PI)\r\n        ctx.fill()\r\n        // ctx.stroke()\r\n    }\r\n}\r\n","/*\r\n * A fast javascript implementation of simplex noise by Jonas Wagner\r\n\r\nBased on a speed-improved simplex noise algorithm for 2D, 3D and 4D in Java.\r\nWhich is based on example code by Stefan Gustavson (stegu@itn.liu.se).\r\nWith Optimisations by Peter Eastman (peastman@drizzle.stanford.edu).\r\nBetter rank ordering method by Stefan Gustavson in 2012.\r\n\r\n Copyright (c) 2021 Jonas Wagner\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights\r\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n copies of the Software, and to permit persons to whom the Software is\r\n furnished to do so, subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in all\r\n copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n SOFTWARE.\r\n */\r\nconst F2 = 0.5 * (Math.sqrt(3.0) - 1.0);\r\nconst G2 = (3.0 - Math.sqrt(3.0)) / 6.0;\r\nconst F3 = 1.0 / 3.0;\r\nconst G3 = 1.0 / 6.0;\r\nconst F4 = (Math.sqrt(5.0) - 1.0) / 4.0;\r\nconst G4 = (5.0 - Math.sqrt(5.0)) / 20.0;\r\nconst grad3 = new Float32Array([1, 1, 0,\r\n    -1, 1, 0,\r\n    1, -1, 0,\r\n    -1, -1, 0,\r\n    1, 0, 1,\r\n    -1, 0, 1,\r\n    1, 0, -1,\r\n    -1, 0, -1,\r\n    0, 1, 1,\r\n    0, -1, 1,\r\n    0, 1, -1,\r\n    0, -1, -1]);\r\nconst grad4 = new Float32Array([0, 1, 1, 1, 0, 1, 1, -1, 0, 1, -1, 1, 0, 1, -1, -1,\r\n    0, -1, 1, 1, 0, -1, 1, -1, 0, -1, -1, 1, 0, -1, -1, -1,\r\n    1, 0, 1, 1, 1, 0, 1, -1, 1, 0, -1, 1, 1, 0, -1, -1,\r\n    -1, 0, 1, 1, -1, 0, 1, -1, -1, 0, -1, 1, -1, 0, -1, -1,\r\n    1, 1, 0, 1, 1, 1, 0, -1, 1, -1, 0, 1, 1, -1, 0, -1,\r\n    -1, 1, 0, 1, -1, 1, 0, -1, -1, -1, 0, 1, -1, -1, 0, -1,\r\n    1, 1, 1, 0, 1, 1, -1, 0, 1, -1, 1, 0, 1, -1, -1, 0,\r\n    -1, 1, 1, 0, -1, 1, -1, 0, -1, -1, 1, 0, -1, -1, -1, 0]);\r\n/** Deterministic simplex noise generator suitable for 2D, 3D and 4D spaces. */\r\nclass SimplexNoise {\r\n    /**\r\n     * Creates a new `SimplexNoise` instance.\r\n     * This involves some setup. You can save a few cpu cycles by reusing the same instance.\r\n     * @param randomOrSeed A random number generator or a seed (string|number).\r\n     * Defaults to Math.random (random irreproducible initialization).\r\n     */\r\n    constructor(randomOrSeed = Math.random) {\r\n        const random = typeof randomOrSeed == 'function' ? randomOrSeed : alea(randomOrSeed);\r\n        this.p = buildPermutationTable(random);\r\n        this.perm = new Uint8Array(512);\r\n        this.permMod12 = new Uint8Array(512);\r\n        for (let i = 0; i < 512; i++) {\r\n            this.perm[i] = this.p[i & 255];\r\n            this.permMod12[i] = this.perm[i] % 12;\r\n        }\r\n    }\r\n    /**\r\n     * Samples the noise field in 2 dimensions\r\n     * @param x\r\n     * @param y\r\n     * @returns a number in the interval [-1, 1]\r\n     */\r\n    noise2D(x, y) {\r\n        const permMod12 = this.permMod12;\r\n        const perm = this.perm;\r\n        let n0 = 0; // Noise contributions from the three corners\r\n        let n1 = 0;\r\n        let n2 = 0;\r\n        // Skew the input space to determine which simplex cell we're in\r\n        const s = (x + y) * F2; // Hairy factor for 2D\r\n        const i = Math.floor(x + s);\r\n        const j = Math.floor(y + s);\r\n        const t = (i + j) * G2;\r\n        const X0 = i - t; // Unskew the cell origin back to (x,y) space\r\n        const Y0 = j - t;\r\n        const x0 = x - X0; // The x,y distances from the cell origin\r\n        const y0 = y - Y0;\r\n        // For the 2D case, the simplex shape is an equilateral triangle.\r\n        // Determine which simplex we are in.\r\n        let i1, j1; // Offsets for second (middle) corner of simplex in (i,j) coords\r\n        if (x0 > y0) {\r\n            i1 = 1;\r\n            j1 = 0;\r\n        } // lower triangle, XY order: (0,0)->(1,0)->(1,1)\r\n        else {\r\n            i1 = 0;\r\n            j1 = 1;\r\n        } // upper triangle, YX order: (0,0)->(0,1)->(1,1)\r\n        // A step of (1,0) in (i,j) means a step of (1-c,-c) in (x,y), and\r\n        // a step of (0,1) in (i,j) means a step of (-c,1-c) in (x,y), where\r\n        // c = (3-sqrt(3))/6\r\n        const x1 = x0 - i1 + G2; // Offsets for middle corner in (x,y) unskewed coords\r\n        const y1 = y0 - j1 + G2;\r\n        const x2 = x0 - 1.0 + 2.0 * G2; // Offsets for last corner in (x,y) unskewed coords\r\n        const y2 = y0 - 1.0 + 2.0 * G2;\r\n        // Work out the hashed gradient indices of the three simplex corners\r\n        const ii = i & 255;\r\n        const jj = j & 255;\r\n        // Calculate the contribution from the three corners\r\n        let t0 = 0.5 - x0 * x0 - y0 * y0;\r\n        if (t0 >= 0) {\r\n            const gi0 = permMod12[ii + perm[jj]] * 3;\r\n            t0 *= t0;\r\n            n0 = t0 * t0 * (grad3[gi0] * x0 + grad3[gi0 + 1] * y0); // (x,y) of grad3 used for 2D gradient\r\n        }\r\n        let t1 = 0.5 - x1 * x1 - y1 * y1;\r\n        if (t1 >= 0) {\r\n            const gi1 = permMod12[ii + i1 + perm[jj + j1]] * 3;\r\n            t1 *= t1;\r\n            n1 = t1 * t1 * (grad3[gi1] * x1 + grad3[gi1 + 1] * y1);\r\n        }\r\n        let t2 = 0.5 - x2 * x2 - y2 * y2;\r\n        if (t2 >= 0) {\r\n            const gi2 = permMod12[ii + 1 + perm[jj + 1]] * 3;\r\n            t2 *= t2;\r\n            n2 = t2 * t2 * (grad3[gi2] * x2 + grad3[gi2 + 1] * y2);\r\n        }\r\n        // Add contributions from each corner to get the final noise value.\r\n        // The result is scaled to return values in the interval [-1,1].\r\n        return 70.0 * (n0 + n1 + n2);\r\n    }\r\n    /**\r\n     * Samples the noise field in 3 dimensions\r\n     * @param x\r\n     * @param y\r\n     * @param z\r\n     * @returns a number in the interval [-1, 1]\r\n     */\r\n    noise3D(x, y, z) {\r\n        const permMod12 = this.permMod12;\r\n        const perm = this.perm;\r\n        let n0, n1, n2, n3; // Noise contributions from the four corners\r\n        // Skew the input space to determine which simplex cell we're in\r\n        const s = (x + y + z) * F3; // Very nice and simple skew factor for 3D\r\n        const i = Math.floor(x + s);\r\n        const j = Math.floor(y + s);\r\n        const k = Math.floor(z + s);\r\n        const t = (i + j + k) * G3;\r\n        const X0 = i - t; // Unskew the cell origin back to (x,y,z) space\r\n        const Y0 = j - t;\r\n        const Z0 = k - t;\r\n        const x0 = x - X0; // The x,y,z distances from the cell origin\r\n        const y0 = y - Y0;\r\n        const z0 = z - Z0;\r\n        // For the 3D case, the simplex shape is a slightly irregular tetrahedron.\r\n        // Determine which simplex we are in.\r\n        let i1, j1, k1; // Offsets for second corner of simplex in (i,j,k) coords\r\n        let i2, j2, k2; // Offsets for third corner of simplex in (i,j,k) coords\r\n        if (x0 >= y0) {\r\n            if (y0 >= z0) {\r\n                i1 = 1;\r\n                j1 = 0;\r\n                k1 = 0;\r\n                i2 = 1;\r\n                j2 = 1;\r\n                k2 = 0;\r\n            } // X Y Z order\r\n            else if (x0 >= z0) {\r\n                i1 = 1;\r\n                j1 = 0;\r\n                k1 = 0;\r\n                i2 = 1;\r\n                j2 = 0;\r\n                k2 = 1;\r\n            } // X Z Y order\r\n            else {\r\n                i1 = 0;\r\n                j1 = 0;\r\n                k1 = 1;\r\n                i2 = 1;\r\n                j2 = 0;\r\n                k2 = 1;\r\n            } // Z X Y order\r\n        }\r\n        else { // x0<y0\r\n            if (y0 < z0) {\r\n                i1 = 0;\r\n                j1 = 0;\r\n                k1 = 1;\r\n                i2 = 0;\r\n                j2 = 1;\r\n                k2 = 1;\r\n            } // Z Y X order\r\n            else if (x0 < z0) {\r\n                i1 = 0;\r\n                j1 = 1;\r\n                k1 = 0;\r\n                i2 = 0;\r\n                j2 = 1;\r\n                k2 = 1;\r\n            } // Y Z X order\r\n            else {\r\n                i1 = 0;\r\n                j1 = 1;\r\n                k1 = 0;\r\n                i2 = 1;\r\n                j2 = 1;\r\n                k2 = 0;\r\n            } // Y X Z order\r\n        }\r\n        // A step of (1,0,0) in (i,j,k) means a step of (1-c,-c,-c) in (x,y,z),\r\n        // a step of (0,1,0) in (i,j,k) means a step of (-c,1-c,-c) in (x,y,z), and\r\n        // a step of (0,0,1) in (i,j,k) means a step of (-c,-c,1-c) in (x,y,z), where\r\n        // c = 1/6.\r\n        const x1 = x0 - i1 + G3; // Offsets for second corner in (x,y,z) coords\r\n        const y1 = y0 - j1 + G3;\r\n        const z1 = z0 - k1 + G3;\r\n        const x2 = x0 - i2 + 2.0 * G3; // Offsets for third corner in (x,y,z) coords\r\n        const y2 = y0 - j2 + 2.0 * G3;\r\n        const z2 = z0 - k2 + 2.0 * G3;\r\n        const x3 = x0 - 1.0 + 3.0 * G3; // Offsets for last corner in (x,y,z) coords\r\n        const y3 = y0 - 1.0 + 3.0 * G3;\r\n        const z3 = z0 - 1.0 + 3.0 * G3;\r\n        // Work out the hashed gradient indices of the four simplex corners\r\n        const ii = i & 255;\r\n        const jj = j & 255;\r\n        const kk = k & 255;\r\n        // Calculate the contribution from the four corners\r\n        let t0 = 0.6 - x0 * x0 - y0 * y0 - z0 * z0;\r\n        if (t0 < 0)\r\n            n0 = 0.0;\r\n        else {\r\n            const gi0 = permMod12[ii + perm[jj + perm[kk]]] * 3;\r\n            t0 *= t0;\r\n            n0 = t0 * t0 * (grad3[gi0] * x0 + grad3[gi0 + 1] * y0 + grad3[gi0 + 2] * z0);\r\n        }\r\n        let t1 = 0.6 - x1 * x1 - y1 * y1 - z1 * z1;\r\n        if (t1 < 0)\r\n            n1 = 0.0;\r\n        else {\r\n            const gi1 = permMod12[ii + i1 + perm[jj + j1 + perm[kk + k1]]] * 3;\r\n            t1 *= t1;\r\n            n1 = t1 * t1 * (grad3[gi1] * x1 + grad3[gi1 + 1] * y1 + grad3[gi1 + 2] * z1);\r\n        }\r\n        let t2 = 0.6 - x2 * x2 - y2 * y2 - z2 * z2;\r\n        if (t2 < 0)\r\n            n2 = 0.0;\r\n        else {\r\n            const gi2 = permMod12[ii + i2 + perm[jj + j2 + perm[kk + k2]]] * 3;\r\n            t2 *= t2;\r\n            n2 = t2 * t2 * (grad3[gi2] * x2 + grad3[gi2 + 1] * y2 + grad3[gi2 + 2] * z2);\r\n        }\r\n        let t3 = 0.6 - x3 * x3 - y3 * y3 - z3 * z3;\r\n        if (t3 < 0)\r\n            n3 = 0.0;\r\n        else {\r\n            const gi3 = permMod12[ii + 1 + perm[jj + 1 + perm[kk + 1]]] * 3;\r\n            t3 *= t3;\r\n            n3 = t3 * t3 * (grad3[gi3] * x3 + grad3[gi3 + 1] * y3 + grad3[gi3 + 2] * z3);\r\n        }\r\n        // Add contributions from each corner to get the final noise value.\r\n        // The result is scaled to stay just inside [-1,1]\r\n        return 32.0 * (n0 + n1 + n2 + n3);\r\n    }\r\n    /**\r\n     * Samples the noise field in 4 dimensions\r\n     * @param x\r\n     * @param y\r\n     * @param z\r\n     * @returns a number in the interval [-1, 1]\r\n     */\r\n    noise4D(x, y, z, w) {\r\n        const perm = this.perm;\r\n        let n0, n1, n2, n3, n4; // Noise contributions from the five corners\r\n        // Skew the (x,y,z,w) space to determine which cell of 24 simplices we're in\r\n        const s = (x + y + z + w) * F4; // Factor for 4D skewing\r\n        const i = Math.floor(x + s);\r\n        const j = Math.floor(y + s);\r\n        const k = Math.floor(z + s);\r\n        const l = Math.floor(w + s);\r\n        const t = (i + j + k + l) * G4; // Factor for 4D unskewing\r\n        const X0 = i - t; // Unskew the cell origin back to (x,y,z,w) space\r\n        const Y0 = j - t;\r\n        const Z0 = k - t;\r\n        const W0 = l - t;\r\n        const x0 = x - X0; // The x,y,z,w distances from the cell origin\r\n        const y0 = y - Y0;\r\n        const z0 = z - Z0;\r\n        const w0 = w - W0;\r\n        // For the 4D case, the simplex is a 4D shape I won't even try to describe.\r\n        // To find out which of the 24 possible simplices we're in, we need to\r\n        // determine the magnitude ordering of x0, y0, z0 and w0.\r\n        // Six pair-wise comparisons are performed between each possible pair\r\n        // of the four coordinates, and the results are used to rank the numbers.\r\n        let rankx = 0;\r\n        let ranky = 0;\r\n        let rankz = 0;\r\n        let rankw = 0;\r\n        if (x0 > y0)\r\n            rankx++;\r\n        else\r\n            ranky++;\r\n        if (x0 > z0)\r\n            rankx++;\r\n        else\r\n            rankz++;\r\n        if (x0 > w0)\r\n            rankx++;\r\n        else\r\n            rankw++;\r\n        if (y0 > z0)\r\n            ranky++;\r\n        else\r\n            rankz++;\r\n        if (y0 > w0)\r\n            ranky++;\r\n        else\r\n            rankw++;\r\n        if (z0 > w0)\r\n            rankz++;\r\n        else\r\n            rankw++;\r\n        // simplex[c] is a 4-vector with the numbers 0, 1, 2 and 3 in some order.\r\n        // Many values of c will never occur, since e.g. x>y>z>w makes x<z, y<w and x<w\r\n        // impossible. Only the 24 indices which have non-zero entries make any sense.\r\n        // We use a thresholding to set the coordinates in turn from the largest magnitude.\r\n        // Rank 3 denotes the largest coordinate.\r\n        // Rank 2 denotes the second largest coordinate.\r\n        // Rank 1 denotes the second smallest coordinate.\r\n        // The integer offsets for the second simplex corner\r\n        const i1 = rankx >= 3 ? 1 : 0;\r\n        const j1 = ranky >= 3 ? 1 : 0;\r\n        const k1 = rankz >= 3 ? 1 : 0;\r\n        const l1 = rankw >= 3 ? 1 : 0;\r\n        // The integer offsets for the third simplex corner\r\n        const i2 = rankx >= 2 ? 1 : 0;\r\n        const j2 = ranky >= 2 ? 1 : 0;\r\n        const k2 = rankz >= 2 ? 1 : 0;\r\n        const l2 = rankw >= 2 ? 1 : 0;\r\n        // The integer offsets for the fourth simplex corner\r\n        const i3 = rankx >= 1 ? 1 : 0;\r\n        const j3 = ranky >= 1 ? 1 : 0;\r\n        const k3 = rankz >= 1 ? 1 : 0;\r\n        const l3 = rankw >= 1 ? 1 : 0;\r\n        // The fifth corner has all coordinate offsets = 1, so no need to compute that.\r\n        const x1 = x0 - i1 + G4; // Offsets for second corner in (x,y,z,w) coords\r\n        const y1 = y0 - j1 + G4;\r\n        const z1 = z0 - k1 + G4;\r\n        const w1 = w0 - l1 + G4;\r\n        const x2 = x0 - i2 + 2.0 * G4; // Offsets for third corner in (x,y,z,w) coords\r\n        const y2 = y0 - j2 + 2.0 * G4;\r\n        const z2 = z0 - k2 + 2.0 * G4;\r\n        const w2 = w0 - l2 + 2.0 * G4;\r\n        const x3 = x0 - i3 + 3.0 * G4; // Offsets for fourth corner in (x,y,z,w) coords\r\n        const y3 = y0 - j3 + 3.0 * G4;\r\n        const z3 = z0 - k3 + 3.0 * G4;\r\n        const w3 = w0 - l3 + 3.0 * G4;\r\n        const x4 = x0 - 1.0 + 4.0 * G4; // Offsets for last corner in (x,y,z,w) coords\r\n        const y4 = y0 - 1.0 + 4.0 * G4;\r\n        const z4 = z0 - 1.0 + 4.0 * G4;\r\n        const w4 = w0 - 1.0 + 4.0 * G4;\r\n        // Work out the hashed gradient indices of the five simplex corners\r\n        const ii = i & 255;\r\n        const jj = j & 255;\r\n        const kk = k & 255;\r\n        const ll = l & 255;\r\n        // Calculate the contribution from the five corners\r\n        let t0 = 0.6 - x0 * x0 - y0 * y0 - z0 * z0 - w0 * w0;\r\n        if (t0 < 0)\r\n            n0 = 0.0;\r\n        else {\r\n            const gi0 = (perm[ii + perm[jj + perm[kk + perm[ll]]]] % 32) * 4;\r\n            t0 *= t0;\r\n            n0 = t0 * t0 * (grad4[gi0] * x0 + grad4[gi0 + 1] * y0 + grad4[gi0 + 2] * z0 + grad4[gi0 + 3] * w0);\r\n        }\r\n        let t1 = 0.6 - x1 * x1 - y1 * y1 - z1 * z1 - w1 * w1;\r\n        if (t1 < 0)\r\n            n1 = 0.0;\r\n        else {\r\n            const gi1 = (perm[ii + i1 + perm[jj + j1 + perm[kk + k1 + perm[ll + l1]]]] % 32) * 4;\r\n            t1 *= t1;\r\n            n1 = t1 * t1 * (grad4[gi1] * x1 + grad4[gi1 + 1] * y1 + grad4[gi1 + 2] * z1 + grad4[gi1 + 3] * w1);\r\n        }\r\n        let t2 = 0.6 - x2 * x2 - y2 * y2 - z2 * z2 - w2 * w2;\r\n        if (t2 < 0)\r\n            n2 = 0.0;\r\n        else {\r\n            const gi2 = (perm[ii + i2 + perm[jj + j2 + perm[kk + k2 + perm[ll + l2]]]] % 32) * 4;\r\n            t2 *= t2;\r\n            n2 = t2 * t2 * (grad4[gi2] * x2 + grad4[gi2 + 1] * y2 + grad4[gi2 + 2] * z2 + grad4[gi2 + 3] * w2);\r\n        }\r\n        let t3 = 0.6 - x3 * x3 - y3 * y3 - z3 * z3 - w3 * w3;\r\n        if (t3 < 0)\r\n            n3 = 0.0;\r\n        else {\r\n            const gi3 = (perm[ii + i3 + perm[jj + j3 + perm[kk + k3 + perm[ll + l3]]]] % 32) * 4;\r\n            t3 *= t3;\r\n            n3 = t3 * t3 * (grad4[gi3] * x3 + grad4[gi3 + 1] * y3 + grad4[gi3 + 2] * z3 + grad4[gi3 + 3] * w3);\r\n        }\r\n        let t4 = 0.6 - x4 * x4 - y4 * y4 - z4 * z4 - w4 * w4;\r\n        if (t4 < 0)\r\n            n4 = 0.0;\r\n        else {\r\n            const gi4 = (perm[ii + 1 + perm[jj + 1 + perm[kk + 1 + perm[ll + 1]]]] % 32) * 4;\r\n            t4 *= t4;\r\n            n4 = t4 * t4 * (grad4[gi4] * x4 + grad4[gi4 + 1] * y4 + grad4[gi4 + 2] * z4 + grad4[gi4 + 3] * w4);\r\n        }\r\n        // Sum up and scale the result to cover the range [-1,1]\r\n        return 27.0 * (n0 + n1 + n2 + n3 + n4);\r\n    }\r\n}\r\n/**\r\n * Builds a random permutation table.\r\n * This is exported only for (internal) testing purposes.\r\n * Do not rely on this export.\r\n * @private\r\n */\r\nfunction buildPermutationTable(random) {\r\n    const p = new Uint8Array(256);\r\n    for (let i = 0; i < 256; i++) {\r\n        p[i] = i;\r\n    }\r\n    for (let i = 0; i < 255; i++) {\r\n        const r = i + ~~(random() * (256 - i));\r\n        const aux = p[i];\r\n        p[i] = p[r];\r\n        p[r] = aux;\r\n    }\r\n    return p;\r\n}\r\n/*\r\nThe ALEA PRNG and masher code used by simplex-noise.js\r\nis based on code by Johannes Baage, modified by Jonas Wagner.\r\nSee alea.md for the full license.\r\n*/\r\nfunction alea(seed) {\r\n    let s0 = 0;\r\n    let s1 = 0;\r\n    let s2 = 0;\r\n    let c = 1;\r\n    const mash = masher();\r\n    s0 = mash(' ');\r\n    s1 = mash(' ');\r\n    s2 = mash(' ');\r\n    s0 -= mash(seed);\r\n    if (s0 < 0) {\r\n        s0 += 1;\r\n    }\r\n    s1 -= mash(seed);\r\n    if (s1 < 0) {\r\n        s1 += 1;\r\n    }\r\n    s2 -= mash(seed);\r\n    if (s2 < 0) {\r\n        s2 += 1;\r\n    }\r\n    return function () {\r\n        const t = 2091639 * s0 + c * 2.3283064365386963e-10; // 2^-32\r\n        s0 = s1;\r\n        s1 = s2;\r\n        return s2 = t - (c = t | 0);\r\n    };\r\n}\r\nfunction masher() {\r\n    let n = 0xefc8249d;\r\n    return function (data) {\r\n        data = data.toString();\r\n        for (let i = 0; i < data.length; i++) {\r\n            n += data.charCodeAt(i);\r\n            let h = 0.02519603282416938 * n;\r\n            n = h >>> 0;\r\n            h -= n;\r\n            h *= n;\r\n            n = h >>> 0;\r\n            h -= n;\r\n            n += h * 0x100000000; // 2^32\r\n        }\r\n        return (n >>> 0) * 2.3283064365386963e-10; // 2^-32\r\n    };\r\n}\r\n\r\nexport default SimplexNoise;\r\nexport { SimplexNoise, buildPermutationTable };\r\n","/** @module */\r\n\r\n// import SimplexNoise from 'https://cdn.skypack.dev/simplex-noise@3.0.1'\r\nimport { SimplexNoise } from '../lib/snowpack/build/snowpack/pkg/simplex-noise.js'\r\n// https://runkit-packages.com/14.x.x/1644541101130/simplex-noise/#simplex-noisejs\r\n// https://npm.runkit.com/simplex-noise\r\n// https://www.npmjs.com/package/simplex-noise\r\n\r\n/**\r\n * Generate a noisy 2D map with two noise sources per pixel.\r\n * @param {Number} nx - Number of x pixels\r\n * @param {Number} ny - Number of y pixels\r\n * @constructor\r\n */\r\nexport default function GeoNoise(nx, ny) {\r\n    const self = this\r\n    // Simplex Noise Parameters\r\n    self.sn = []\r\n    const noiseWidth = 0.5\r\n    const noiseHeight = 0.5\r\n\r\n    // Geographic Noise Parameters - amplitude of noise\r\n    const xAmp = 100\r\n    const yAmp = 100\r\n\r\n    /** Generate simplex noise. */\r\n    self.genNoise = () => {\r\n        self.sn = makeGeoNoise(nx, ny, noiseWidth, noiseHeight, xAmp, yAmp)\r\n    }\r\n}\r\n\r\n/**\r\n * Generate a noisy 2D map with two noise sources per pixel.\r\n * @param {Number} nx - Number of x pixels\r\n * @param {Number} ny - Number of y pixels\r\n * @param {Number} noiseWidth -  A characteristic size of blobs, in pixels\r\n * @param {Number} noiseHeight - A characteristic size of blobs, in pixels\r\n * @returns {Number[][][]} - Noise in pixel displacement, indexed by row, col, dimension\r\n */\r\nexport function makeGeoNoise(nx, ny, noiseWidth, noiseHeight, xAmp, yAmp) {\r\n    const simplexX = new SimplexNoise('s')\r\n    const simplexY = new SimplexNoise('seed')\r\n    const map = zeros(nx, ny)\r\n    let sumX = 0\r\n    let sumY = 0\r\n    range(nx).forEach((ix) => {\r\n        range(ny).forEach((iy) => {\r\n            // fractional coordinate divided by period of waves\r\n            const x = (ix / nx) * (1 / noiseWidth)\r\n            const y = (iy / ny) * (1 / noiseHeight)\r\n            const noiseX = simplexX.noise2D(x, y)\r\n            const noiseY = simplexY.noise2D(x, y)\r\n            map[ix][iy][0] = (noiseX - 0.5)\r\n            map[ix][iy][1] = (noiseY - 0.5)\r\n            sumX += noiseX\r\n            sumY += noiseY\r\n        })\r\n    })\r\n    // normalize\r\n    const meanX = sumX / (nx * ny) - 0.5\r\n    const meanY = sumY / (nx * ny) - 0.5\r\n    map.forEach((a) => { // array\r\n        a.forEach((p) => { // pair\r\n            // eslint-disable-next-line no-param-reassign\r\n            p[0] = (p[0] - meanX) * xAmp\r\n            // eslint-disable-next-line no-param-reassign\r\n            p[1] = (p[1] - meanY) * yAmp\r\n        })\r\n    })\r\n    return map\r\n}\r\n\r\nfunction zeros(nx, ny) {\r\n    const empty = Array(nx).fill().map(() => Array(ny).fill().map(() => Array(2).fill(0)))\r\n    return empty\r\n}\r\n\r\nfunction range(n) {\r\n    return [...Array(n).keys()]\r\n}\r\n","function area(polygon) {\r\n  var i = -1,\r\n      n = polygon.length,\r\n      a,\r\n      b = polygon[n - 1],\r\n      area = 0;\r\n\r\n  while (++i < n) {\r\n    a = b;\r\n    b = polygon[i];\r\n    area += a[1] * b[0] - a[0] * b[1];\r\n  }\r\n\r\n  return area / 2;\r\n}\r\n\r\nfunction centroid(polygon) {\r\n  var i = -1,\r\n      n = polygon.length,\r\n      x = 0,\r\n      y = 0,\r\n      a,\r\n      b = polygon[n - 1],\r\n      c,\r\n      k = 0;\r\n\r\n  while (++i < n) {\r\n    a = b;\r\n    b = polygon[i];\r\n    k += c = a[0] * b[1] - b[0] * a[1];\r\n    x += (a[0] + b[0]) * c;\r\n    y += (a[1] + b[1]) * c;\r\n  }\r\n\r\n  return k *= 3, [x / k, y / k];\r\n}\r\n\r\n// Returns the 2D cross product of AB and AC vectors, i.e., the z-component of\r\n// the 3D cross product in a quadrant I Cartesian coordinate system (+x is\r\n// right, +y is up). Returns a positive value if ABC is counter-clockwise,\r\n// negative if clockwise, and zero if the points are collinear.\r\nfunction cross(a, b, c) {\r\n  return (b[0] - a[0]) * (c[1] - a[1]) - (b[1] - a[1]) * (c[0] - a[0]);\r\n}\r\n\r\nfunction lexicographicOrder(a, b) {\r\n  return a[0] - b[0] || a[1] - b[1];\r\n}\r\n\r\n// Computes the upper convex hull per the monotone chain algorithm.\r\n// Assumes points.length >= 3, is sorted by x, unique in y.\r\n// Returns an array of indices into points in left-to-right order.\r\nfunction computeUpperHullIndexes(points) {\r\n  const n = points.length,\r\n      indexes = [0, 1];\r\n  let size = 2, i;\r\n\r\n  for (i = 2; i < n; ++i) {\r\n    while (size > 1 && cross(points[indexes[size - 2]], points[indexes[size - 1]], points[i]) <= 0) --size;\r\n    indexes[size++] = i;\r\n  }\r\n\r\n  return indexes.slice(0, size); // remove popped points\r\n}\r\n\r\nfunction hull(points) {\r\n  if ((n = points.length) < 3) return null;\r\n\r\n  var i,\r\n      n,\r\n      sortedPoints = new Array(n),\r\n      flippedPoints = new Array(n);\r\n\r\n  for (i = 0; i < n; ++i) sortedPoints[i] = [+points[i][0], +points[i][1], i];\r\n  sortedPoints.sort(lexicographicOrder);\r\n  for (i = 0; i < n; ++i) flippedPoints[i] = [sortedPoints[i][0], -sortedPoints[i][1]];\r\n\r\n  var upperIndexes = computeUpperHullIndexes(sortedPoints),\r\n      lowerIndexes = computeUpperHullIndexes(flippedPoints);\r\n\r\n  // Construct the hull polygon, removing possible duplicate endpoints.\r\n  var skipLeft = lowerIndexes[0] === upperIndexes[0],\r\n      skipRight = lowerIndexes[lowerIndexes.length - 1] === upperIndexes[upperIndexes.length - 1],\r\n      hull = [];\r\n\r\n  // Add upper hull in right-to-l order.\r\n  // Then add lower hull in left-to-right order.\r\n  for (i = upperIndexes.length - 1; i >= 0; --i) hull.push(points[sortedPoints[upperIndexes[i]][2]]);\r\n  for (i = +skipLeft; i < lowerIndexes.length - skipRight; ++i) hull.push(points[sortedPoints[lowerIndexes[i]][2]]);\r\n\r\n  return hull;\r\n}\r\n\r\nfunction contains(polygon, point) {\r\n  var n = polygon.length,\r\n      p = polygon[n - 1],\r\n      x = point[0], y = point[1],\r\n      x0 = p[0], y0 = p[1],\r\n      x1, y1,\r\n      inside = false;\r\n\r\n  for (var i = 0; i < n; ++i) {\r\n    p = polygon[i], x1 = p[0], y1 = p[1];\r\n    if (((y1 > y) !== (y0 > y)) && (x < (x0 - x1) * (y - y1) / (y0 - y1) + x1)) inside = !inside;\r\n    x0 = x1, y0 = y1;\r\n  }\r\n\r\n  return inside;\r\n}\r\n\r\nfunction length(polygon) {\r\n  var i = -1,\r\n      n = polygon.length,\r\n      b = polygon[n - 1],\r\n      xa,\r\n      ya,\r\n      xb = b[0],\r\n      yb = b[1],\r\n      perimeter = 0;\r\n\r\n  while (++i < n) {\r\n    xa = xb;\r\n    ya = yb;\r\n    b = polygon[i];\r\n    xb = b[0];\r\n    yb = b[1];\r\n    xa -= xb;\r\n    ya -= yb;\r\n    perimeter += Math.hypot(xa, ya);\r\n  }\r\n\r\n  return perimeter;\r\n}\r\n\r\nexport { area as polygonArea, centroid as polygonCentroid, contains as polygonContains, hull as polygonHull, length as polygonLength };\r\n","/** @module */\r\n\r\n// import { polygonCentroid } from 'https://cdn.skypack.dev/d3-polygon@3'\r\nimport { polygonCentroid } from '../lib/snowpack/build/snowpack/pkg/d3-polygon.js'\r\n// import * as d3 from 'https://cdn.skypack.dev/d3@7'\r\nimport { Delaunay } from '../lib/snowpack/build/snowpack/pkg/d3-delaunay.js'\r\n/**\r\n * Calculate a voronoi diagram with some degree of equal capacity between voronoi cells.\r\n * Uses Lloyd's method.\r\n * @param {Number} w - number of discrete points wide of space to divide\r\n * @param {Number} h - number of points high\r\n * @param {Number} n - number of voronoi cells\r\n * @param {Number} tolFraction - fractional tolerance for relaxation. Maybe .01 is good.\r\n * @returns Centroids (list of points) and voronoi d3 object\r\n */\r\nexport default function lloydVoronoi(w, h, n, tolFraction) {\r\n    let centroids = randomPoints(w, h, n)\r\n    let converged = false\r\n    let voronoi\r\n    let polygons\r\n    const tol = tolFraction * Math.min(w, h)\r\n    for (let i = 0; i < 1000; i++) {\r\n        [centroids, converged, voronoi, polygons] = relax(centroids, w, h, tol)\r\n        if (converged) return centroids\r\n    }\r\n    return [centroids, voronoi, polygons]\r\n}\r\n\r\n// https://bl.ocks.org/veltman/3d1fb70e6993d4eb2eff7112c9e7bcf4\r\n\r\nfunction randomPoints(w, h, n) {\r\n    return Array(n).fill().map(() => [Math.random() * w, Math.random() * h])\r\n}\r\n\r\nfunction relax(points, w, h, tol) {\r\n    const delaunay = Delaunay.from(points)\r\n    const voronoi = delaunay.voronoi([0, 0, w, h])\r\n    const polygons = range(points.length).map((i) => voronoi.cellPolygon(i))\r\n    const centroids = polygons.map(polygonCentroid)\r\n    const converged = points.every((point, i) => distance2(point, centroids[i]) < tol)\r\n    return [centroids, converged, voronoi, polygons]\r\n}\r\n\r\n// function relax3(points, w, h) {\r\n//     const polygons = voronoi(points).polygons()\r\n//     polygons.map(d3.polygonCentroid)\r\n//     const converged = points.every((point, i) => distance2(point, centroids[i]) < 1)\r\n//     return { centroids, converged }\r\n// }\r\n\r\n// cellPolygons.prototype.map = function* (mapper, thisArg) {\r\n//     for (const val of this) {\r\n//         yield mapper.call(thisArg, val)\r\n//     }\r\n// }\r\n\r\nfunction distance2(x, y) {\r\n    return x ** 2 + y ** 2\r\n}\r\n\r\nfunction range(n) {\r\n    return [...Array(n).keys()]\r\n}\r\n","/**\r\n * Graphics Utilities\r\n * Just a few helpful functions that are self-contained and don't need much context.\r\n * @module */\r\n\r\nexport function drawStrokedColor(text, x, y, textsize, lw, color, alpha, ctx, textAlign) {\r\n    ctx.save()\r\n    ctx.globalAlpha = alpha\r\n    ctx.textAlign = textAlign || 'center'\r\n    ctx.font = `${textsize}px Sans-serif`\r\n    ctx.lineWidth = lw\r\n    ctx.fillStyle = color\r\n    ctx.fillText(text, x, y)\r\n    ctx.restore()\r\n}\r\n\r\nexport function textPercent(f) {\r\n    const a = (100 * f).toFixed(0)\r\n    return a\r\n}\r\n","/**\r\n * Clips a polygon with another polygon to return a polygon.\r\n * Polygons must be counter-clockwise.\r\n * https://observablehq.com/@d3/polygonclip@1237\r\n * @param {Number[][]} clip - polygon\r\n * @param {Number[][]} subject - polygon, gets mutated\r\n * @returns {Number[][]} - polygon\r\n */\r\nexport default function polygonClip(clip, subject0) {\r\n    const closed = polygonClosed(subject0)\r\n    const n = clip.length - polygonClosed(clip)\r\n    const subject = subject0.slice() // copy before mutate\r\n    for (let i = 0, a = clip[n - 1], b, c, d; i < n; ++i) {\r\n        const input = subject.slice()\r\n        const m = input.length - closed\r\n        subject.length = 0\r\n        b = clip[i]\r\n        c = input[m - 1]\r\n        for (let j = 0; j < m; ++j) {\r\n            d = input[j]\r\n            if (lineOrient(d, a, b)) {\r\n                if (!lineOrient(c, a, b)) {\r\n                    subject.push(lineIntersect(c, d, a, b))\r\n                }\r\n                subject.push(d)\r\n            } else if (lineOrient(c, a, b)) {\r\n                subject.push(lineIntersect(c, d, a, b))\r\n            }\r\n            c = d\r\n        }\r\n        if (closed) subject.push(subject[0])\r\n        a = b\r\n    }\r\n    return subject.length ? subject : null\r\n}\r\nfunction lineOrient([px, py], [ax, ay], [bx, by]) {\r\n    return (bx - ax) * (py - ay) < (by - ay) * (px - ax)\r\n}\r\nfunction lineIntersect([ax, ay], [bx, by], [cx, cy], [dx, dy]) {\r\n    const bax = bx - ax; const bay = by - ay; const dcx = dx - cx; const\r\n        dcy = dy - cy\r\n    const k = (bax * (cy - ay) - bay * (cx - ax)) / (bay * dcx - bax * dcy)\r\n    return [cx + k * dcx, cy + k * dcy]\r\n}\r\nfunction polygonClosed(points) {\r\n    const [ax, ay] = points[0]; const\r\n        [bx, by] = points[points.length - 1]\r\n    return ax === bx && ay === by\r\n}\r\nexport function polygonConvex(points) {\r\n    const n = points.length\r\n    const [rx, ry] = points[n - 2]\r\n    let [qx, qy] = points[n - 1]\r\n    let vx = rx - qx; let\r\n        vy = ry - qy\r\n    for (let i = 0; i < n; ++i) {\r\n        const [px, py] = points[i]\r\n        const wx = qx - px; const\r\n            wy = qy - py\r\n        if (wx * vy < wy * vx) return false\r\n        if (wx || wy) {\r\n            vx = wx\r\n            vy = wy\r\n        }\r\n        qx = px\r\n        qy = py\r\n    }\r\n    return true\r\n}\r\n\r\nexport function testClip() {\r\n    const subject = [\r\n        [79, 200], [266, 100],\r\n        [452, 200],\r\n        [359, 450],\r\n        [172, 420]]\r\n    const clip = [[210, 90], [110, 400], [420, 400], [490, 250]]\r\n\r\n    return polygonClip(clip, subject)\r\n}\r\n","/** @module */\r\n\r\n// import _ from 'https://cdn.skypack.dev/lodash@4.17.21'\r\nimport { polygonArea } from '../lib/snowpack/build/snowpack/pkg/d3-polygon.js'\r\nimport polygonClip from '../lib/polygonClip.js'\r\nimport { range, jcopy } from '../utilities/jsHelpers.js'\r\n\r\n/**\r\n * What fraction of each voterGroup lives in each district?\r\n * Return an array indexed by district.\r\n * Each element contains an array of pairs.\r\n * The first of the pair is a voterGroup pair of coordinates.\r\n * The second of the pair is the fraction of the voterGroup within that district.\r\n * @param {DistrictMaker} districtMaker\r\n * @returns {Number[][][]} - an array of districts,\r\n * each with a list of census tract properties [x,y,overlap]\r\n */\r\nexport default function geoCensus(districtMaker) {\r\n    const {\r\n        nd, nx, ny, polygons,\r\n    } = districtMaker\r\n\r\n    const census = Array(nd).fill().map(() => [])\r\n\r\n    for (let gx = 0; gx < nx; gx++) { // x-coordinate of group\r\n        for (let gy = 0; gy < ny; gy++) { // y-coordinate of group\r\n            const subject = makeSquare(gx, gy)\r\n            range(nd).forEach((iDistrict) => {\r\n                const poly = polygons[iDistrict]\r\n                const clip = jcopy(poly).reverse()\r\n                const overlap = polygonClip(clip, subject)\r\n\r\n                // store data more sparsely because it is more efficient\r\n                // loop through all districts\r\n                if (overlap !== null) {\r\n                    census[iDistrict].push([gx, gy, polygonArea(overlap)])\r\n                }\r\n            })\r\n        }\r\n    }\r\n\r\n    return census\r\n}\r\n\r\nfunction makeSquare(x, y) {\r\n    // the points are in counterclockwise order\r\n    // assuming a coordinate system where y points down and x points right.\r\n    // top left\r\n    // bottom left\r\n    // bottom right\r\n    // top right\r\n    const subject = [\r\n        [x, y],\r\n        [x, y + 1],\r\n        [x + 1, y + 1],\r\n        [x + 1, y],\r\n    ]\r\n    return subject\r\n}\r\n","/** @module */\r\n\r\nimport { polygonArea } from '../lib/snowpack/build/snowpack/pkg/d3-polygon.js'\r\nimport lloydVoronoi from './lloydVoronoi.js'\r\nimport { drawStrokedColor } from '../utilities/graphicsUtilities.js'\r\nimport geoCensus from './geoCensus.js'\r\n/**\r\n * Makes and draws district boundaries.\r\n * Right now, just for a uniform square geography.\r\n * @param {Screen} screen\r\n * @constructor\r\n */\r\nexport default function DistrictMaker(screen) {\r\n    const self = this\r\n\r\n    /**\r\n     * Define district lines and count demographics.\r\n     * @param {Number} nx - number of voter cells in x\r\n     * @param {Number} ny - number of voter cells in y\r\n     * @param {Number} nd - number of districts.\r\n     */\r\n    self.make = (nx, ny, nd) => {\r\n        [self.centroids, self.voronoi, self.polygons] = lloydVoronoi(nx, ny, nd, 0.01)\r\n        self.nx = nx\r\n        self.ny = ny\r\n        self.nd = nd\r\n        self.polygonAreas = self.polygons.map(polygonArea).map((x) => -x)\r\n        self.totalArea = nx * ny\r\n\r\n        self.census = geoCensus(self)\r\n    }\r\n\r\n    /**\r\n     * Draw Voronoi cell boundaries.\r\n     * @param {Number} geoMapWidth - width of image\r\n     * @param {Number} geoMapHeight - height of image\r\n     */\r\n    self.renderVoronoi = (geoMapWidth, geoMapHeight) => {\r\n        self.renderVoronoiGeneral(0, 0, geoMapWidth, geoMapHeight, null, renderAreaText)\r\n    }\r\n\r\n    self.renderVoronoiColors = (x, y, geoMapWidth, geoMapHeight, colors) => {\r\n        self.renderVoronoiGeneral(x, y, geoMapWidth, geoMapHeight, colors, undefined)\r\n    }\r\n    /**\r\n     * Draw a Voronoi Diagram\r\n     * @param {Number} x - translate image\r\n     * @param {Number} y - translate image\r\n     * @param {Number} geoMapWidth - width of image\r\n     * @param {Number} geoMapHeight - height of image\r\n     * @param {string[]} colors - an option, say \"null\" if do not want colors\r\n     * @param {Function} textFunction - an option, defaults to undefined\r\n     */\r\n    self.renderVoronoiGeneral = (x, y, geoMapWidth, geoMapHeight, colors, textFunction) => {\r\n        const { mctx } = screen\r\n        const {\r\n            voronoi, nx, ny, nd,\r\n        } = self\r\n        mctx.save()\r\n        const scaleX = geoMapWidth / nx\r\n        const scaleY = geoMapHeight / ny\r\n        mctx.translate(x, y)\r\n        mctx.scale(scaleX, scaleY)\r\n        for (let i = 0; i < nd; i++) {\r\n            mctx.beginPath()\r\n            mctx.strokeStyle = '#333'\r\n            mctx.lineWidth = 1 / scaleX\r\n            voronoi.renderCell(i, mctx)\r\n            if (colors !== null) { // option\r\n                mctx.fillStyle = colors[i]\r\n                mctx.fill()\r\n            }\r\n            mctx.stroke()\r\n            if (textFunction !== undefined) textFunction(i) // option\r\n        }\r\n        mctx.restore()\r\n    }\r\n\r\n    function renderAreaText(i) {\r\n        const { mctx } = screen\r\n        const c = self.centroids[i]\r\n        const textHeight = 1\r\n        // const area = textPercent(self.polygonAreas[i] / (self.nx * self.ny))\r\n        const area = self.polygonAreas[i].toFixed(0)\r\n        drawStrokedColor(area, c[0], c[1] + textHeight * 0.5 - 0.2, textHeight, 0.2, '#222', 1, mctx)\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport GeoNoise from './geoNoise.js'\r\nimport DistrictMaker from './DistrictMaker.js'\r\nimport { range } from '../utilities/jsHelpers.js'\r\nimport VoterSimList from './VoterSimList.js'\r\n\r\n/**\r\n * VoterGeoList inherits from VoterSimList.\r\n * @param {Screen} screen\r\n * @param {ElectionGeo} electionGeo\r\n * @constructor\r\n */\r\nexport default function VoterGeoList(screen, electionGeo, sim) {\r\n    const self = this\r\n\r\n    // VoterGeoList inherits from VoterSimList\r\n    // because we need to make a list instances of voterGeoBasis,\r\n    // and voterGeoBasis has a component called voter.\r\n    VoterSimList.call(self, sim)\r\n\r\n    /** Number of districts */\r\n    const nd = 20\r\n\r\n    /** Number of census tracts in x and y */\r\n    self.nx = 20\r\n    self.ny = 20\r\n\r\n    // Code that handles drawing districts of equal number of voters.\r\n    self.districtMaker = new DistrictMaker(screen)\r\n\r\n    // Code that handles making geographic noise.\r\n    self.geoNoise = new GeoNoise(self.nx, self.ny)\r\n    self.geoNoise.genNoise()\r\n\r\n    // Manage VoterBasisSet //\r\n\r\n    /** This voter basis is repeated at every census tract on the geo map.\r\n     *  It is altered by translating it in policy space.\r\n     *  */\r\n\r\n    // Update VoterGroup Sets //\r\n\r\n    let voterSimGroups = []\r\n\r\n    /** Make districts and update voter sets */\r\n    self.updateDistricts = () => {\r\n        self.districtMaker.make(self.nx, self.ny, nd)\r\n    }\r\n    self.updateVoters = () => {\r\n        voterSimGroups = self.getVoterSims()\r\n        self.updateFullSet()\r\n        self.updateVotersByDistrict()\r\n        self.updateVotersByTract()\r\n    }\r\n\r\n    // We want to copy a set of voter basis objects for each census tract.\r\n    // Then we add a little noise to represent differences due to geography.\r\n\r\n    self.updateFullSet = () => {\r\n        const { sn } = self.geoNoise\r\n        self.allVoterGroups = voterSimGroups.map(\r\n            (vb) => sn.map(\r\n                (rowNoise) => rowNoise.map(\r\n                    (cellNoise) => {\r\n                        const [xNoise, yNoise] = cellNoise\r\n                        const shape2 = structuredClone(vb.voterShape.shape2)\r\n                        shape2.x += xNoise\r\n                        shape2.y += yNoise\r\n                        const { shape1 } = vb.voterShape\r\n                        return { shape2, shape1 }\r\n                    },\r\n                ).flat(),\r\n            ).flat(),\r\n        ).flat()\r\n    }\r\n\r\n    self.updateVotersByDistrict = () => {\r\n        const { census } = self.districtMaker\r\n        const { sn } = self.geoNoise\r\n        self.voterGroupsByDistrict = range(nd).map(\r\n            (iDistrict) => voterSimGroups.map(\r\n                (vb) => census[iDistrict].map((g) => {\r\n                    const [gx, gy, gf] = g\r\n                    const [xNoise, yNoise] = sn[gx][gy]\r\n                    const shape2 = structuredClone(vb.voterShape.shape2)\r\n                    shape2.x += xNoise\r\n                    shape2.y += yNoise\r\n                    const { shape1 } = vb.voterShape\r\n                    return { shape2, shape1, weight: gf }\r\n                }).flat(),\r\n            ).flat(),\r\n        )\r\n    }\r\n\r\n    self.updateVotersByTract = () => {\r\n        const { sn } = self.geoNoise\r\n        self.voterGroupsByTract = sn.map(\r\n            (rowNoise) => rowNoise.map(\r\n                (cellNoise) => voterSimGroups.map(\r\n                    (vb) => {\r\n                        const [xNoise, yNoise] = cellNoise\r\n                        const shape2 = structuredClone(vb.voterShape.shape2)\r\n                        shape2.x += xNoise\r\n                        shape2.y += yNoise\r\n                        const { shape1 } = vb.voterShape\r\n                        return { shape2, shape1 }\r\n                    },\r\n                ).flat(),\r\n            ),\r\n        )\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Draws an image of noise, or anything really.\r\n * @param {Number} nx - Width in pixels\r\n * @param {Number} ny - Height in pixels\r\n * @param {Screen} screen - Draw here.\r\n * @constructor\r\n */\r\nexport default function NoiseImage(nx, ny, screen) {\r\n    const self = this\r\n\r\n    /*\r\n        Makes your pixel manip on an off-screen canvas\r\n        Returns the off-screen canvas\r\n        */\r\n\r\n    const canvas = document.createElement('canvas')\r\n    canvas.width = nx\r\n    canvas.height = ny\r\n    const offCtx = canvas.getContext('2d')\r\n    const imageData = offCtx.createImageData(nx, ny)\r\n\r\n    self.load = (sn) => {\r\n        const { data } = imageData\r\n\r\n        for (let x = 0; x < nx; x++) {\r\n            for (let y = 0; y < ny; y++) {\r\n                const r = sn[x][y][0] + 0.5\r\n                const g = sn[x][y][1] + 0.5\r\n                data[(x + y * nx) * 4 + 0] = r * 255\r\n                data[(x + y * nx) * 4 + 1] = (r + g) * 200\r\n                data[(x + y * nx) * 4 + 2] = g * 200\r\n                data[(x + y * nx) * 4 + 3] = 255\r\n            }\r\n        }\r\n\r\n        offCtx.putImageData(imageData, 0, 0)\r\n    }\r\n\r\n    self.loadColors = (colors) => {\r\n        const { data } = imageData\r\n\r\n        for (let y = 0; y < ny; y++) {\r\n            for (let x = 0; x < nx; x++) {\r\n                const color = colors[x][y]\r\n                const [r, g, b] = color\r\n                data[(x + y * nx) * 4 + 0] = r\r\n                data[(x + y * nx) * 4 + 1] = g\r\n                data[(x + y * nx) * 4 + 2] = b\r\n                data[(x + y * nx) * 4 + 3] = 255\r\n            }\r\n        }\r\n\r\n        offCtx.putImageData(imageData, 0, 0)\r\n    }\r\n\r\n    self.render = (renderWidth, renderHeight) => {\r\n        const { mctx } = screen\r\n        mctx.save()\r\n        mctx.imageSmoothingEnabled = false\r\n        mctx.drawImage(canvas, 0, 0, renderWidth, renderHeight)\r\n        mctx.restore()\r\n    }\r\n    // Draw simplex noise\r\n    // https://codepen.io/jwagner/pen/BNmpdm/?editors=0010\r\n    // Scale image\r\n    // https://stackoverflow.com/a/48858621\r\n}\r\n","/** @module */\r\n\r\nimport NoiseImage from './NoiseImage.js'\r\n\r\n/**\r\n * Show votes\r\n * @param {VoterGeoList} voterGeoList\r\n * @param {Screen} screen\r\n * @constructor\r\n */\r\nexport default function VizGeo2D(voterGeoList, screen) {\r\n    const self = this\r\n\r\n    // Code that handles making images of geographic noise.\r\n    self.noiseImage = new NoiseImage(voterGeoList.nx, voterGeoList.ny, screen)\r\n\r\n    // Update //\r\n\r\n    self.update = (geoElectionResults) => {\r\n        const { colorByTract, colorOfVoteByDistrict, colorOfWinsByDistrict } = geoElectionResults\r\n        self.colorOfVoteByDistrict = colorOfVoteByDistrict\r\n        self.winnerColors = colorOfWinsByDistrict\r\n        self.noiseImage.loadColors(colorByTract)\r\n    }\r\n\r\n    // Display //\r\n\r\n    const geoMapWidth = 100\r\n    const geoMapHeight = 100\r\n\r\n    /** Render all maps and  */\r\n    self.render = () => {\r\n        renderPolicyNoise()\r\n        self.renderTractVotes()\r\n        self.renderDistrictWins()\r\n        self.renderDistrictVotes()\r\n        self.renderVoterBasisSet()\r\n    }\r\n    // Render census tract votes.\r\n    self.renderTractVotes = () => {\r\n        self.noiseImage.render(geoMapWidth, geoMapHeight)\r\n        voterGeoList.districtMaker.renderVoronoi(geoMapWidth, geoMapHeight)\r\n    }\r\n    // Render district wins.\r\n    self.renderDistrictWins = () => {\r\n        const { renderVoronoiColors } = voterGeoList.districtMaker\r\n        renderVoronoiColors(200, 0, geoMapWidth, geoMapHeight, self.winnerColors)\r\n    }\r\n    // render district votes.\r\n    self.renderDistrictVotes = () => {\r\n        const { renderVoronoiColors } = voterGeoList.districtMaker\r\n        renderVoronoiColors(100, 0, geoMapWidth, geoMapHeight, self.colorOfVoteByDistrict)\r\n    }\r\n    self.renderVoterBasisSet = () => {\r\n        const voterSimGroups = voterGeoList.getVoterSims()\r\n        voterSimGroups.forEach((v) => v.render())\r\n    }\r\n\r\n    /** Draw dots to represent the political diversity across census tracts. */\r\n    function renderPolicyNoise() {\r\n        voterGeoList.voterGroupsByTract.forEach((row) => {\r\n            row.forEach((cell) => {\r\n                cell.forEach((group) => {\r\n                    smallCircle(group.shape2.x, group.shape2.y)\r\n                    // TODO: use .x and .y instead of shape2\r\n                })\r\n            })\r\n        })\r\n    }\r\n\r\n    /** Draw a small dot */\r\n\r\n    const canvas = document.createElement('canvas')\r\n    const offCtx = canvas.getContext('2d')\r\n    preDrawCircle()\r\n    function preDrawCircle() {\r\n        canvas.width = 10\r\n        canvas.height = 10\r\n        offCtx.beginPath()\r\n        offCtx.fillStyle = '#555'\r\n        offCtx.arc(5, 5, 1, 0, 2 * Math.PI)\r\n        offCtx.fill()\r\n    }\r\n\r\n    function smallCircle(x, y) {\r\n        const { ctx } = screen\r\n\r\n        ctx.drawImage(canvas, x - 5, y - 5, 10, 10)\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport VoterGeoBasis from '../../voters/VoterGeoBasis.js'\r\nimport CandidateSim from '../../candidates/CandidateSim.js'\r\nimport CandidateSimList from '../../candidates/CandidateSimList.js'\r\nimport VoterGeoList from '../../voters/VoterGeoList.js'\r\nimport SimBase from './SimBase.js'\r\nimport VizGeo2D from '../../viz/VizGeo2D.js'\r\n/**\r\n * Simulate one election with\r\n *   candidates in defined positions, and\r\n *   voters in a distribution that will be summed over.\r\n * Create a geographical map with variations of voter center.\r\n * @param {Screen} screen\r\n * @param {Menu} menu\r\n * @param {Changes} changes\r\n * @param {Election} election\r\n * @param {Sim} sim\r\n * @constructor\r\n */\r\nexport default function SimGeoOne(screen, menu, changes, electionGeo, sim) {\r\n    const self = this\r\n\r\n    SimBase.call(self, screen, changes, sim)\r\n\r\n    const voterGeoList = new VoterGeoList(screen, electionGeo, sim)\r\n\r\n    const candidateSimList = new CandidateSimList(sim)\r\n\r\n    self.addSimCandidate = (candidate) => {\r\n        candidateSimList.newCandidate(new CandidateSim(candidate, self.dragm))\r\n    }\r\n\r\n    self.addSimVoterCircle = (voterShape) => {\r\n        voterGeoList.newVoterSim(new VoterGeoBasis(voterShape, self.dragm, screen))\r\n    }\r\n\r\n    const vizGeo2D = new VizGeo2D(voterGeoList, screen)\r\n\r\n    changes.add(['districts'])\r\n\r\n    const superEnter = self.enter\r\n    self.enter = () => {\r\n        superEnter()\r\n        screen.showMaps()\r\n        sim.candidateAdd.canButton.show()\r\n        sim.election.setDimensions(2)\r\n        voterGeoList.updateXY()\r\n        candidateSimList.updateXY()\r\n        sim.voterTest.updateXY()\r\n    }\r\n\r\n    self.exit = () => {\r\n        screen.hideMaps()\r\n        sim.candidateAdd.canButton.hide()\r\n        // clean up fractions\r\n        const fillUndefined = Array(candidateSimList.numCandidates()).fill(undefined)\r\n        candidateSimList.setCandidateWins(fillUndefined)\r\n        sim.voterTest.setE(0)\r\n    }\r\n\r\n    self.update = () => {\r\n        if (changes.checkNone()) return\r\n        // clear changes, reset to []\r\n        if (changes.check(['districts', 'simType'])) {\r\n            voterGeoList.updateDistricts()\r\n        }\r\n        changes.clear()\r\n        voterGeoList.updateVoters() // can make this only trigger when voters change\r\n        const geoElectionResults = electionGeo.updateVotes(voterGeoList, candidateSimList)\r\n        vizGeo2D.update(geoElectionResults)\r\n        sim.voterTest.update()\r\n        screen.clear()\r\n        self.render()\r\n    }\r\n\r\n    self.testVote = () => electionGeo.testVote(sim.voterTest, candidateSimList)\r\n\r\n    self.render = () => {\r\n        vizGeo2D.render()\r\n    }\r\n    self.renderForeground = () => {\r\n        candidateSimList.renderForeground()\r\n        voterGeoList.renderForeground()\r\n        sim.voterTest.renderForeground()\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Gives an id to an entity.\r\n * @constructor\r\n */\r\nexport default function Registrar() {\r\n    const self = this\r\n\r\n    const entities = []\r\n    let nextID = 0\r\n\r\n    self.new = function (entity) {\r\n        entities.push(entity)\r\n        const id = nextID\r\n        nextID += 1\r\n        return id\r\n    }\r\n    self.num = () => nextID\r\n    self.get = (id) => entities[id]\r\n}\r\n","/* SNOWPACK PROCESS POLYFILL (based on https://github.com/calvinmetcalf/node-process-es6) */\r\nfunction defaultSetTimout() {\r\n    throw new Error('setTimeout has not been defined');\r\n}\r\nfunction defaultClearTimeout () {\r\n    throw new Error('clearTimeout has not been defined');\r\n}\r\nvar cachedSetTimeout = defaultSetTimout;\r\nvar cachedClearTimeout = defaultClearTimeout;\r\nvar globalContext;\r\nif (typeof window !== 'undefined') {\r\n    globalContext = window;\r\n} else if (typeof self !== 'undefined') {\r\n    globalContext = self;\r\n} else {\r\n    globalContext = {};\r\n}\r\nif (typeof globalContext.setTimeout === 'function') {\r\n    cachedSetTimeout = setTimeout;\r\n}\r\nif (typeof globalContext.clearTimeout === 'function') {\r\n    cachedClearTimeout = clearTimeout;\r\n}\r\n\r\nfunction runTimeout(fun) {\r\n    if (cachedSetTimeout === setTimeout) {\r\n        //normal enviroments in sane situations\r\n        return setTimeout(fun, 0);\r\n    }\r\n    // if setTimeout wasn't available but was latter defined\r\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\r\n        cachedSetTimeout = setTimeout;\r\n        return setTimeout(fun, 0);\r\n    }\r\n    try {\r\n        // when when somebody has screwed with setTimeout but no I.E. maddness\r\n        return cachedSetTimeout(fun, 0);\r\n    } catch(e){\r\n        try {\r\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\r\n            return cachedSetTimeout.call(null, fun, 0);\r\n        } catch(e){\r\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\r\n            return cachedSetTimeout.call(this, fun, 0);\r\n        }\r\n    }\r\n\r\n\r\n}\r\nfunction runClearTimeout(marker) {\r\n    if (cachedClearTimeout === clearTimeout) {\r\n        //normal enviroments in sane situations\r\n        return clearTimeout(marker);\r\n    }\r\n    // if clearTimeout wasn't available but was latter defined\r\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\r\n        cachedClearTimeout = clearTimeout;\r\n        return clearTimeout(marker);\r\n    }\r\n    try {\r\n        // when when somebody has screwed with setTimeout but no I.E. maddness\r\n        return cachedClearTimeout(marker);\r\n    } catch (e){\r\n        try {\r\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\r\n            return cachedClearTimeout.call(null, marker);\r\n        } catch (e){\r\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\r\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\r\n            return cachedClearTimeout.call(this, marker);\r\n        }\r\n    }\r\n\r\n\r\n\r\n}\r\nvar queue = [];\r\nvar draining = false;\r\nvar currentQueue;\r\nvar queueIndex = -1;\r\n\r\nfunction cleanUpNextTick() {\r\n    if (!draining || !currentQueue) {\r\n        return;\r\n    }\r\n    draining = false;\r\n    if (currentQueue.length) {\r\n        queue = currentQueue.concat(queue);\r\n    } else {\r\n        queueIndex = -1;\r\n    }\r\n    if (queue.length) {\r\n        drainQueue();\r\n    }\r\n}\r\n\r\nfunction drainQueue() {\r\n    if (draining) {\r\n        return;\r\n    }\r\n    var timeout = runTimeout(cleanUpNextTick);\r\n    draining = true;\r\n\r\n    var len = queue.length;\r\n    while(len) {\r\n        currentQueue = queue;\r\n        queue = [];\r\n        while (++queueIndex < len) {\r\n            if (currentQueue) {\r\n                currentQueue[queueIndex].run();\r\n            }\r\n        }\r\n        queueIndex = -1;\r\n        len = queue.length;\r\n    }\r\n    currentQueue = null;\r\n    draining = false;\r\n    runClearTimeout(timeout);\r\n}\r\nfunction nextTick(fun) {\r\n    var args = new Array(arguments.length - 1);\r\n    if (arguments.length > 1) {\r\n        for (var i = 1; i < arguments.length; i++) {\r\n            args[i - 1] = arguments[i];\r\n        }\r\n    }\r\n    queue.push(new Item(fun, args));\r\n    if (queue.length === 1 && !draining) {\r\n        runTimeout(drainQueue);\r\n    }\r\n}\r\n// v8 likes predictible objects\r\nfunction Item(fun, array) {\r\n    this.fun = fun;\r\n    this.array = array;\r\n}\r\nItem.prototype.run = function () {\r\n    this.fun.apply(null, this.array);\r\n};\r\nvar title = 'browser';\r\nvar platform = 'browser';\r\nvar browser = true;\r\nvar argv = [];\r\nvar version = ''; // empty string to avoid regexp issues\r\nvar versions = {};\r\nvar release = {};\r\nvar config = {};\r\n\r\nfunction noop() {}\r\n\r\nvar on = noop;\r\nvar addListener = noop;\r\nvar once = noop;\r\nvar off = noop;\r\nvar removeListener = noop;\r\nvar removeAllListeners = noop;\r\nvar emit = noop;\r\n\r\nfunction binding(name) {\r\n    throw new Error('process.binding is not supported');\r\n}\r\n\r\nfunction cwd () { return '/' }\r\nfunction chdir (dir) {\r\n    throw new Error('process.chdir is not supported');\r\n}function umask() { return 0; }\r\n\r\n// from https://github.com/kumavis/browser-process-hrtime/blob/master/index.js\r\nvar performance = globalContext.performance || {};\r\nvar performanceNow =\r\n  performance.now        ||\r\n  performance.mozNow     ||\r\n  performance.msNow      ||\r\n  performance.oNow       ||\r\n  performance.webkitNow  ||\r\n  function(){ return (new Date()).getTime() };\r\n\r\n// generate timestamp or delta\r\n// see http://nodejs.org/api/process.html#process_process_hrtime\r\nfunction hrtime(previousTimestamp){\r\n  var clocktime = performanceNow.call(performance)*1e-3;\r\n  var seconds = Math.floor(clocktime);\r\n  var nanoseconds = Math.floor((clocktime%1)*1e9);\r\n  if (previousTimestamp) {\r\n    seconds = seconds - previousTimestamp[0];\r\n    nanoseconds = nanoseconds - previousTimestamp[1];\r\n    if (nanoseconds<0) {\r\n      seconds--;\r\n      nanoseconds += 1e9;\r\n    }\r\n  }\r\n  return [seconds,nanoseconds]\r\n}\r\n\r\nvar startTime = new Date();\r\nfunction uptime() {\r\n  var currentTime = new Date();\r\n  var dif = currentTime - startTime;\r\n  return dif / 1000;\r\n}\r\n\r\nvar process = {\r\n  nextTick: nextTick,\r\n  title: title,\r\n  browser: browser,\r\n  env: {\"NODE_ENV\":\"production\"},\r\n  argv: argv,\r\n  version: version,\r\n  versions: versions,\r\n  on: on,\r\n  addListener: addListener,\r\n  once: once,\r\n  off: off,\r\n  removeListener: removeListener,\r\n  removeAllListeners: removeAllListeners,\r\n  emit: emit,\r\n  binding: binding,\r\n  cwd: cwd,\r\n  chdir: chdir,\r\n  umask: umask,\r\n  hrtime: hrtime,\r\n  platform: platform,\r\n  release: release,\r\n  config: config,\r\n  uptime: uptime\r\n};\r\n\r\n/**\r\n * The Ease class provides a collection of easing functions for use with tween.js.\r\n */\r\nvar Easing = {\r\n    Linear: {\r\n        None: function (amount) {\r\n            return amount;\r\n        },\r\n    },\r\n    Quadratic: {\r\n        In: function (amount) {\r\n            return amount * amount;\r\n        },\r\n        Out: function (amount) {\r\n            return amount * (2 - amount);\r\n        },\r\n        InOut: function (amount) {\r\n            if ((amount *= 2) < 1) {\r\n                return 0.5 * amount * amount;\r\n            }\r\n            return -0.5 * (--amount * (amount - 2) - 1);\r\n        },\r\n    },\r\n    Cubic: {\r\n        In: function (amount) {\r\n            return amount * amount * amount;\r\n        },\r\n        Out: function (amount) {\r\n            return --amount * amount * amount + 1;\r\n        },\r\n        InOut: function (amount) {\r\n            if ((amount *= 2) < 1) {\r\n                return 0.5 * amount * amount * amount;\r\n            }\r\n            return 0.5 * ((amount -= 2) * amount * amount + 2);\r\n        },\r\n    },\r\n    Quartic: {\r\n        In: function (amount) {\r\n            return amount * amount * amount * amount;\r\n        },\r\n        Out: function (amount) {\r\n            return 1 - --amount * amount * amount * amount;\r\n        },\r\n        InOut: function (amount) {\r\n            if ((amount *= 2) < 1) {\r\n                return 0.5 * amount * amount * amount * amount;\r\n            }\r\n            return -0.5 * ((amount -= 2) * amount * amount * amount - 2);\r\n        },\r\n    },\r\n    Quintic: {\r\n        In: function (amount) {\r\n            return amount * amount * amount * amount * amount;\r\n        },\r\n        Out: function (amount) {\r\n            return --amount * amount * amount * amount * amount + 1;\r\n        },\r\n        InOut: function (amount) {\r\n            if ((amount *= 2) < 1) {\r\n                return 0.5 * amount * amount * amount * amount * amount;\r\n            }\r\n            return 0.5 * ((amount -= 2) * amount * amount * amount * amount + 2);\r\n        },\r\n    },\r\n    Sinusoidal: {\r\n        In: function (amount) {\r\n            return 1 - Math.cos((amount * Math.PI) / 2);\r\n        },\r\n        Out: function (amount) {\r\n            return Math.sin((amount * Math.PI) / 2);\r\n        },\r\n        InOut: function (amount) {\r\n            return 0.5 * (1 - Math.cos(Math.PI * amount));\r\n        },\r\n    },\r\n    Exponential: {\r\n        In: function (amount) {\r\n            return amount === 0 ? 0 : Math.pow(1024, amount - 1);\r\n        },\r\n        Out: function (amount) {\r\n            return amount === 1 ? 1 : 1 - Math.pow(2, -10 * amount);\r\n        },\r\n        InOut: function (amount) {\r\n            if (amount === 0) {\r\n                return 0;\r\n            }\r\n            if (amount === 1) {\r\n                return 1;\r\n            }\r\n            if ((amount *= 2) < 1) {\r\n                return 0.5 * Math.pow(1024, amount - 1);\r\n            }\r\n            return 0.5 * (-Math.pow(2, -10 * (amount - 1)) + 2);\r\n        },\r\n    },\r\n    Circular: {\r\n        In: function (amount) {\r\n            return 1 - Math.sqrt(1 - amount * amount);\r\n        },\r\n        Out: function (amount) {\r\n            return Math.sqrt(1 - --amount * amount);\r\n        },\r\n        InOut: function (amount) {\r\n            if ((amount *= 2) < 1) {\r\n                return -0.5 * (Math.sqrt(1 - amount * amount) - 1);\r\n            }\r\n            return 0.5 * (Math.sqrt(1 - (amount -= 2) * amount) + 1);\r\n        },\r\n    },\r\n    Elastic: {\r\n        In: function (amount) {\r\n            if (amount === 0) {\r\n                return 0;\r\n            }\r\n            if (amount === 1) {\r\n                return 1;\r\n            }\r\n            return -Math.pow(2, 10 * (amount - 1)) * Math.sin((amount - 1.1) * 5 * Math.PI);\r\n        },\r\n        Out: function (amount) {\r\n            if (amount === 0) {\r\n                return 0;\r\n            }\r\n            if (amount === 1) {\r\n                return 1;\r\n            }\r\n            return Math.pow(2, -10 * amount) * Math.sin((amount - 0.1) * 5 * Math.PI) + 1;\r\n        },\r\n        InOut: function (amount) {\r\n            if (amount === 0) {\r\n                return 0;\r\n            }\r\n            if (amount === 1) {\r\n                return 1;\r\n            }\r\n            amount *= 2;\r\n            if (amount < 1) {\r\n                return -0.5 * Math.pow(2, 10 * (amount - 1)) * Math.sin((amount - 1.1) * 5 * Math.PI);\r\n            }\r\n            return 0.5 * Math.pow(2, -10 * (amount - 1)) * Math.sin((amount - 1.1) * 5 * Math.PI) + 1;\r\n        },\r\n    },\r\n    Back: {\r\n        In: function (amount) {\r\n            var s = 1.70158;\r\n            return amount * amount * ((s + 1) * amount - s);\r\n        },\r\n        Out: function (amount) {\r\n            var s = 1.70158;\r\n            return --amount * amount * ((s + 1) * amount + s) + 1;\r\n        },\r\n        InOut: function (amount) {\r\n            var s = 1.70158 * 1.525;\r\n            if ((amount *= 2) < 1) {\r\n                return 0.5 * (amount * amount * ((s + 1) * amount - s));\r\n            }\r\n            return 0.5 * ((amount -= 2) * amount * ((s + 1) * amount + s) + 2);\r\n        },\r\n    },\r\n    Bounce: {\r\n        In: function (amount) {\r\n            return 1 - Easing.Bounce.Out(1 - amount);\r\n        },\r\n        Out: function (amount) {\r\n            if (amount < 1 / 2.75) {\r\n                return 7.5625 * amount * amount;\r\n            }\r\n            else if (amount < 2 / 2.75) {\r\n                return 7.5625 * (amount -= 1.5 / 2.75) * amount + 0.75;\r\n            }\r\n            else if (amount < 2.5 / 2.75) {\r\n                return 7.5625 * (amount -= 2.25 / 2.75) * amount + 0.9375;\r\n            }\r\n            else {\r\n                return 7.5625 * (amount -= 2.625 / 2.75) * amount + 0.984375;\r\n            }\r\n        },\r\n        InOut: function (amount) {\r\n            if (amount < 0.5) {\r\n                return Easing.Bounce.In(amount * 2) * 0.5;\r\n            }\r\n            return Easing.Bounce.Out(amount * 2 - 1) * 0.5 + 0.5;\r\n        },\r\n    },\r\n};\r\n\r\nvar now;\r\n// Include a performance.now polyfill.\r\n// In node.js, use process.hrtime.\r\n// eslint-disable-next-line\r\n// @ts-ignore\r\nif (typeof self === 'undefined' && typeof process !== 'undefined' && process.hrtime) {\r\n    now = function () {\r\n        // eslint-disable-next-line\r\n        // @ts-ignore\r\n        var time = process.hrtime();\r\n        // Convert [seconds, nanoseconds] to milliseconds.\r\n        return time[0] * 1000 + time[1] / 1000000;\r\n    };\r\n}\r\n// In a browser, use self.performance.now if it is available.\r\nelse if (typeof self !== 'undefined' && self.performance !== undefined && self.performance.now !== undefined) {\r\n    // This must be bound, because directly assigning this function\r\n    // leads to an invocation exception in Chrome.\r\n    now = self.performance.now.bind(self.performance);\r\n}\r\n// Use Date.now if it is available.\r\nelse if (Date.now !== undefined) {\r\n    now = Date.now;\r\n}\r\n// Otherwise, use 'new Date().getTime()'.\r\nelse {\r\n    now = function () {\r\n        return new Date().getTime();\r\n    };\r\n}\r\nvar now$1 = now;\r\n\r\n/**\r\n * Controlling groups of tweens\r\n *\r\n * Using the TWEEN singleton to manage your tweens can cause issues in large apps with many components.\r\n * In these cases, you may want to create your own smaller groups of tween\r\n */\r\nvar Group = /** @class */ (function () {\r\n    function Group() {\r\n        this._tweens = {};\r\n        this._tweensAddedDuringUpdate = {};\r\n    }\r\n    Group.prototype.getAll = function () {\r\n        var _this = this;\r\n        return Object.keys(this._tweens).map(function (tweenId) {\r\n            return _this._tweens[tweenId];\r\n        });\r\n    };\r\n    Group.prototype.removeAll = function () {\r\n        this._tweens = {};\r\n    };\r\n    Group.prototype.add = function (tween) {\r\n        this._tweens[tween.getId()] = tween;\r\n        this._tweensAddedDuringUpdate[tween.getId()] = tween;\r\n    };\r\n    Group.prototype.remove = function (tween) {\r\n        delete this._tweens[tween.getId()];\r\n        delete this._tweensAddedDuringUpdate[tween.getId()];\r\n    };\r\n    Group.prototype.update = function (time, preserve) {\r\n        if (time === void 0) { time = now$1(); }\r\n        if (preserve === void 0) { preserve = false; }\r\n        var tweenIds = Object.keys(this._tweens);\r\n        if (tweenIds.length === 0) {\r\n            return false;\r\n        }\r\n        // Tweens are updated in \"batches\". If you add a new tween during an\r\n        // update, then the new tween will be updated in the next batch.\r\n        // If you remove a tween during an update, it may or may not be updated.\r\n        // However, if the removed tween was added during the current batch,\r\n        // then it will not be updated.\r\n        while (tweenIds.length > 0) {\r\n            this._tweensAddedDuringUpdate = {};\r\n            for (var i = 0; i < tweenIds.length; i++) {\r\n                var tween = this._tweens[tweenIds[i]];\r\n                var autoStart = !preserve;\r\n                if (tween && tween.update(time, autoStart) === false && !preserve) {\r\n                    delete this._tweens[tweenIds[i]];\r\n                }\r\n            }\r\n            tweenIds = Object.keys(this._tweensAddedDuringUpdate);\r\n        }\r\n        return true;\r\n    };\r\n    return Group;\r\n}());\r\n\r\n/**\r\n *\r\n */\r\nvar Interpolation = {\r\n    Linear: function (v, k) {\r\n        var m = v.length - 1;\r\n        var f = m * k;\r\n        var i = Math.floor(f);\r\n        var fn = Interpolation.Utils.Linear;\r\n        if (k < 0) {\r\n            return fn(v[0], v[1], f);\r\n        }\r\n        if (k > 1) {\r\n            return fn(v[m], v[m - 1], m - f);\r\n        }\r\n        return fn(v[i], v[i + 1 > m ? m : i + 1], f - i);\r\n    },\r\n    Bezier: function (v, k) {\r\n        var b = 0;\r\n        var n = v.length - 1;\r\n        var pw = Math.pow;\r\n        var bn = Interpolation.Utils.Bernstein;\r\n        for (var i = 0; i <= n; i++) {\r\n            b += pw(1 - k, n - i) * pw(k, i) * v[i] * bn(n, i);\r\n        }\r\n        return b;\r\n    },\r\n    CatmullRom: function (v, k) {\r\n        var m = v.length - 1;\r\n        var f = m * k;\r\n        var i = Math.floor(f);\r\n        var fn = Interpolation.Utils.CatmullRom;\r\n        if (v[0] === v[m]) {\r\n            if (k < 0) {\r\n                i = Math.floor((f = m * (1 + k)));\r\n            }\r\n            return fn(v[(i - 1 + m) % m], v[i], v[(i + 1) % m], v[(i + 2) % m], f - i);\r\n        }\r\n        else {\r\n            if (k < 0) {\r\n                return v[0] - (fn(v[0], v[0], v[1], v[1], -f) - v[0]);\r\n            }\r\n            if (k > 1) {\r\n                return v[m] - (fn(v[m], v[m], v[m - 1], v[m - 1], f - m) - v[m]);\r\n            }\r\n            return fn(v[i ? i - 1 : 0], v[i], v[m < i + 1 ? m : i + 1], v[m < i + 2 ? m : i + 2], f - i);\r\n        }\r\n    },\r\n    Utils: {\r\n        Linear: function (p0, p1, t) {\r\n            return (p1 - p0) * t + p0;\r\n        },\r\n        Bernstein: function (n, i) {\r\n            var fc = Interpolation.Utils.Factorial;\r\n            return fc(n) / fc(i) / fc(n - i);\r\n        },\r\n        Factorial: (function () {\r\n            var a = [1];\r\n            return function (n) {\r\n                var s = 1;\r\n                if (a[n]) {\r\n                    return a[n];\r\n                }\r\n                for (var i = n; i > 1; i--) {\r\n                    s *= i;\r\n                }\r\n                a[n] = s;\r\n                return s;\r\n            };\r\n        })(),\r\n        CatmullRom: function (p0, p1, p2, p3, t) {\r\n            var v0 = (p2 - p0) * 0.5;\r\n            var v1 = (p3 - p1) * 0.5;\r\n            var t2 = t * t;\r\n            var t3 = t * t2;\r\n            return (2 * p1 - 2 * p2 + v0 + v1) * t3 + (-3 * p1 + 3 * p2 - 2 * v0 - v1) * t2 + v0 * t + p1;\r\n        },\r\n    },\r\n};\r\n\r\n/**\r\n * Utils\r\n */\r\nvar Sequence = /** @class */ (function () {\r\n    function Sequence() {\r\n    }\r\n    Sequence.nextId = function () {\r\n        return Sequence._nextId++;\r\n    };\r\n    Sequence._nextId = 0;\r\n    return Sequence;\r\n}());\r\n\r\nvar mainGroup = new Group();\r\n\r\n/**\r\n * Tween.js - Licensed under the MIT license\r\n * https://github.com/tweenjs/tween.js\r\n * ----------------------------------------------\r\n *\r\n * See https://github.com/tweenjs/tween.js/graphs/contributors for the full list of contributors.\r\n * Thank you all, you're awesome!\r\n */\r\nvar Tween = /** @class */ (function () {\r\n    function Tween(_object, _group) {\r\n        if (_group === void 0) { _group = mainGroup; }\r\n        this._object = _object;\r\n        this._group = _group;\r\n        this._isPaused = false;\r\n        this._pauseStart = 0;\r\n        this._valuesStart = {};\r\n        this._valuesEnd = {};\r\n        this._valuesStartRepeat = {};\r\n        this._duration = 1000;\r\n        this._initialRepeat = 0;\r\n        this._repeat = 0;\r\n        this._yoyo = false;\r\n        this._isPlaying = false;\r\n        this._reversed = false;\r\n        this._delayTime = 0;\r\n        this._startTime = 0;\r\n        this._easingFunction = Easing.Linear.None;\r\n        this._interpolationFunction = Interpolation.Linear;\r\n        this._chainedTweens = [];\r\n        this._onStartCallbackFired = false;\r\n        this._id = Sequence.nextId();\r\n        this._isChainStopped = false;\r\n        this._goToEnd = false;\r\n    }\r\n    Tween.prototype.getId = function () {\r\n        return this._id;\r\n    };\r\n    Tween.prototype.isPlaying = function () {\r\n        return this._isPlaying;\r\n    };\r\n    Tween.prototype.isPaused = function () {\r\n        return this._isPaused;\r\n    };\r\n    Tween.prototype.to = function (properties, duration) {\r\n        // TODO? restore this, then update the 07_dynamic_to example to set fox\r\n        // tween's to on each update. That way the behavior is opt-in (there's\r\n        // currently no opt-out).\r\n        // for (const prop in properties) this._valuesEnd[prop] = properties[prop]\r\n        this._valuesEnd = Object.create(properties);\r\n        if (duration !== undefined) {\r\n            this._duration = duration;\r\n        }\r\n        return this;\r\n    };\r\n    Tween.prototype.duration = function (d) {\r\n        this._duration = d;\r\n        return this;\r\n    };\r\n    Tween.prototype.start = function (time) {\r\n        if (this._isPlaying) {\r\n            return this;\r\n        }\r\n        // eslint-disable-next-line\r\n        this._group && this._group.add(this);\r\n        this._repeat = this._initialRepeat;\r\n        if (this._reversed) {\r\n            // If we were reversed (f.e. using the yoyo feature) then we need to\r\n            // flip the tween direction back to forward.\r\n            this._reversed = false;\r\n            for (var property in this._valuesStartRepeat) {\r\n                this._swapEndStartRepeatValues(property);\r\n                this._valuesStart[property] = this._valuesStartRepeat[property];\r\n            }\r\n        }\r\n        this._isPlaying = true;\r\n        this._isPaused = false;\r\n        this._onStartCallbackFired = false;\r\n        this._isChainStopped = false;\r\n        this._startTime = time !== undefined ? (typeof time === 'string' ? now$1() + parseFloat(time) : time) : now$1();\r\n        this._startTime += this._delayTime;\r\n        this._setupProperties(this._object, this._valuesStart, this._valuesEnd, this._valuesStartRepeat);\r\n        return this;\r\n    };\r\n    Tween.prototype._setupProperties = function (_object, _valuesStart, _valuesEnd, _valuesStartRepeat) {\r\n        for (var property in _valuesEnd) {\r\n            var startValue = _object[property];\r\n            var startValueIsArray = Array.isArray(startValue);\r\n            var propType = startValueIsArray ? 'array' : typeof startValue;\r\n            var isInterpolationList = !startValueIsArray && Array.isArray(_valuesEnd[property]);\r\n            // If `to()` specifies a property that doesn't exist in the source object,\r\n            // we should not set that property in the object\r\n            if (propType === 'undefined' || propType === 'function') {\r\n                continue;\r\n            }\r\n            // Check if an Array was provided as property value\r\n            if (isInterpolationList) {\r\n                var endValues = _valuesEnd[property];\r\n                if (endValues.length === 0) {\r\n                    continue;\r\n                }\r\n                // handle an array of relative values\r\n                endValues = endValues.map(this._handleRelativeValue.bind(this, startValue));\r\n                // Create a local copy of the Array with the start value at the front\r\n                _valuesEnd[property] = [startValue].concat(endValues);\r\n            }\r\n            // handle the deepness of the values\r\n            if ((propType === 'object' || startValueIsArray) && startValue && !isInterpolationList) {\r\n                _valuesStart[property] = startValueIsArray ? [] : {};\r\n                // eslint-disable-next-line\r\n                for (var prop in startValue) {\r\n                    // eslint-disable-next-line\r\n                    // @ts-ignore FIXME?\r\n                    _valuesStart[property][prop] = startValue[prop];\r\n                }\r\n                _valuesStartRepeat[property] = startValueIsArray ? [] : {}; // TODO? repeat nested values? And yoyo? And array values?\r\n                // eslint-disable-next-line\r\n                // @ts-ignore FIXME?\r\n                this._setupProperties(startValue, _valuesStart[property], _valuesEnd[property], _valuesStartRepeat[property]);\r\n            }\r\n            else {\r\n                // Save the starting value, but only once.\r\n                if (typeof _valuesStart[property] === 'undefined') {\r\n                    _valuesStart[property] = startValue;\r\n                }\r\n                if (!startValueIsArray) {\r\n                    // eslint-disable-next-line\r\n                    // @ts-ignore FIXME?\r\n                    _valuesStart[property] *= 1.0; // Ensures we're using numbers, not strings\r\n                }\r\n                if (isInterpolationList) {\r\n                    // eslint-disable-next-line\r\n                    // @ts-ignore FIXME?\r\n                    _valuesStartRepeat[property] = _valuesEnd[property].slice().reverse();\r\n                }\r\n                else {\r\n                    _valuesStartRepeat[property] = _valuesStart[property] || 0;\r\n                }\r\n            }\r\n        }\r\n    };\r\n    Tween.prototype.stop = function () {\r\n        if (!this._isChainStopped) {\r\n            this._isChainStopped = true;\r\n            this.stopChainedTweens();\r\n        }\r\n        if (!this._isPlaying) {\r\n            return this;\r\n        }\r\n        // eslint-disable-next-line\r\n        this._group && this._group.remove(this);\r\n        this._isPlaying = false;\r\n        this._isPaused = false;\r\n        if (this._onStopCallback) {\r\n            this._onStopCallback(this._object);\r\n        }\r\n        return this;\r\n    };\r\n    Tween.prototype.end = function () {\r\n        this._goToEnd = true;\r\n        this.update(Infinity);\r\n        return this;\r\n    };\r\n    Tween.prototype.pause = function (time) {\r\n        if (time === void 0) { time = now$1(); }\r\n        if (this._isPaused || !this._isPlaying) {\r\n            return this;\r\n        }\r\n        this._isPaused = true;\r\n        this._pauseStart = time;\r\n        // eslint-disable-next-line\r\n        this._group && this._group.remove(this);\r\n        return this;\r\n    };\r\n    Tween.prototype.resume = function (time) {\r\n        if (time === void 0) { time = now$1(); }\r\n        if (!this._isPaused || !this._isPlaying) {\r\n            return this;\r\n        }\r\n        this._isPaused = false;\r\n        this._startTime += time - this._pauseStart;\r\n        this._pauseStart = 0;\r\n        // eslint-disable-next-line\r\n        this._group && this._group.add(this);\r\n        return this;\r\n    };\r\n    Tween.prototype.stopChainedTweens = function () {\r\n        for (var i = 0, numChainedTweens = this._chainedTweens.length; i < numChainedTweens; i++) {\r\n            this._chainedTweens[i].stop();\r\n        }\r\n        return this;\r\n    };\r\n    Tween.prototype.group = function (group) {\r\n        this._group = group;\r\n        return this;\r\n    };\r\n    Tween.prototype.delay = function (amount) {\r\n        this._delayTime = amount;\r\n        return this;\r\n    };\r\n    Tween.prototype.repeat = function (times) {\r\n        this._initialRepeat = times;\r\n        this._repeat = times;\r\n        return this;\r\n    };\r\n    Tween.prototype.repeatDelay = function (amount) {\r\n        this._repeatDelayTime = amount;\r\n        return this;\r\n    };\r\n    Tween.prototype.yoyo = function (yoyo) {\r\n        this._yoyo = yoyo;\r\n        return this;\r\n    };\r\n    Tween.prototype.easing = function (easingFunction) {\r\n        this._easingFunction = easingFunction;\r\n        return this;\r\n    };\r\n    Tween.prototype.interpolation = function (interpolationFunction) {\r\n        this._interpolationFunction = interpolationFunction;\r\n        return this;\r\n    };\r\n    Tween.prototype.chain = function () {\r\n        var tweens = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            tweens[_i] = arguments[_i];\r\n        }\r\n        this._chainedTweens = tweens;\r\n        return this;\r\n    };\r\n    Tween.prototype.onStart = function (callback) {\r\n        this._onStartCallback = callback;\r\n        return this;\r\n    };\r\n    Tween.prototype.onUpdate = function (callback) {\r\n        this._onUpdateCallback = callback;\r\n        return this;\r\n    };\r\n    Tween.prototype.onRepeat = function (callback) {\r\n        this._onRepeatCallback = callback;\r\n        return this;\r\n    };\r\n    Tween.prototype.onComplete = function (callback) {\r\n        this._onCompleteCallback = callback;\r\n        return this;\r\n    };\r\n    Tween.prototype.onStop = function (callback) {\r\n        this._onStopCallback = callback;\r\n        return this;\r\n    };\r\n    /**\r\n     * @returns true if the tween is still playing after the update, false\r\n     * otherwise (calling update on a paused tween still returns true because\r\n     * it is still playing, just paused).\r\n     */\r\n    Tween.prototype.update = function (time, autoStart) {\r\n        if (time === void 0) { time = now$1(); }\r\n        if (autoStart === void 0) { autoStart = true; }\r\n        if (this._isPaused)\r\n            return true;\r\n        var property;\r\n        var elapsed;\r\n        var endTime = this._startTime + this._duration;\r\n        if (!this._goToEnd && !this._isPlaying) {\r\n            if (time > endTime)\r\n                return false;\r\n            if (autoStart)\r\n                this.start(time);\r\n        }\r\n        this._goToEnd = false;\r\n        if (time < this._startTime) {\r\n            return true;\r\n        }\r\n        if (this._onStartCallbackFired === false) {\r\n            if (this._onStartCallback) {\r\n                this._onStartCallback(this._object);\r\n            }\r\n            this._onStartCallbackFired = true;\r\n        }\r\n        elapsed = (time - this._startTime) / this._duration;\r\n        elapsed = this._duration === 0 || elapsed > 1 ? 1 : elapsed;\r\n        var value = this._easingFunction(elapsed);\r\n        // properties transformations\r\n        this._updateProperties(this._object, this._valuesStart, this._valuesEnd, value);\r\n        if (this._onUpdateCallback) {\r\n            this._onUpdateCallback(this._object, elapsed);\r\n        }\r\n        if (elapsed === 1) {\r\n            if (this._repeat > 0) {\r\n                if (isFinite(this._repeat)) {\r\n                    this._repeat--;\r\n                }\r\n                // Reassign starting values, restart by making startTime = now\r\n                for (property in this._valuesStartRepeat) {\r\n                    if (!this._yoyo && typeof this._valuesEnd[property] === 'string') {\r\n                        this._valuesStartRepeat[property] =\r\n                            // eslint-disable-next-line\r\n                            // @ts-ignore FIXME?\r\n                            this._valuesStartRepeat[property] + parseFloat(this._valuesEnd[property]);\r\n                    }\r\n                    if (this._yoyo) {\r\n                        this._swapEndStartRepeatValues(property);\r\n                    }\r\n                    this._valuesStart[property] = this._valuesStartRepeat[property];\r\n                }\r\n                if (this._yoyo) {\r\n                    this._reversed = !this._reversed;\r\n                }\r\n                if (this._repeatDelayTime !== undefined) {\r\n                    this._startTime = time + this._repeatDelayTime;\r\n                }\r\n                else {\r\n                    this._startTime = time + this._delayTime;\r\n                }\r\n                if (this._onRepeatCallback) {\r\n                    this._onRepeatCallback(this._object);\r\n                }\r\n                return true;\r\n            }\r\n            else {\r\n                if (this._onCompleteCallback) {\r\n                    this._onCompleteCallback(this._object);\r\n                }\r\n                for (var i = 0, numChainedTweens = this._chainedTweens.length; i < numChainedTweens; i++) {\r\n                    // Make the chained tweens start exactly at the time they should,\r\n                    // even if the `update()` method was called way past the duration of the tween\r\n                    this._chainedTweens[i].start(this._startTime + this._duration);\r\n                }\r\n                this._isPlaying = false;\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    };\r\n    Tween.prototype._updateProperties = function (_object, _valuesStart, _valuesEnd, value) {\r\n        for (var property in _valuesEnd) {\r\n            // Don't update properties that do not exist in the source object\r\n            if (_valuesStart[property] === undefined) {\r\n                continue;\r\n            }\r\n            var start = _valuesStart[property] || 0;\r\n            var end = _valuesEnd[property];\r\n            var startIsArray = Array.isArray(_object[property]);\r\n            var endIsArray = Array.isArray(end);\r\n            var isInterpolationList = !startIsArray && endIsArray;\r\n            if (isInterpolationList) {\r\n                _object[property] = this._interpolationFunction(end, value);\r\n            }\r\n            else if (typeof end === 'object' && end) {\r\n                // eslint-disable-next-line\r\n                // @ts-ignore FIXME?\r\n                this._updateProperties(_object[property], start, end, value);\r\n            }\r\n            else {\r\n                // Parses relative end values with start as base (e.g.: +10, -3)\r\n                end = this._handleRelativeValue(start, end);\r\n                // Protect against non numeric properties.\r\n                if (typeof end === 'number') {\r\n                    // eslint-disable-next-line\r\n                    // @ts-ignore FIXME?\r\n                    _object[property] = start + (end - start) * value;\r\n                }\r\n            }\r\n        }\r\n    };\r\n    Tween.prototype._handleRelativeValue = function (start, end) {\r\n        if (typeof end !== 'string') {\r\n            return end;\r\n        }\r\n        if (end.charAt(0) === '+' || end.charAt(0) === '-') {\r\n            return start + parseFloat(end);\r\n        }\r\n        else {\r\n            return parseFloat(end);\r\n        }\r\n    };\r\n    Tween.prototype._swapEndStartRepeatValues = function (property) {\r\n        var tmp = this._valuesStartRepeat[property];\r\n        var endValue = this._valuesEnd[property];\r\n        if (typeof endValue === 'string') {\r\n            this._valuesStartRepeat[property] = this._valuesStartRepeat[property] + parseFloat(endValue);\r\n        }\r\n        else {\r\n            this._valuesStartRepeat[property] = this._valuesEnd[property];\r\n        }\r\n        this._valuesEnd[property] = tmp;\r\n    };\r\n    return Tween;\r\n}());\r\n\r\nvar VERSION = '18.6.4';\r\n\r\n/**\r\n * Tween.js - Licensed under the MIT license\r\n * https://github.com/tweenjs/tween.js\r\n * ----------------------------------------------\r\n *\r\n * See https://github.com/tweenjs/tween.js/graphs/contributors for the full list of contributors.\r\n * Thank you all, you're awesome!\r\n */\r\nvar nextId = Sequence.nextId;\r\n/**\r\n * Controlling groups of tweens\r\n *\r\n * Using the TWEEN singleton to manage your tweens can cause issues in large apps with many components.\r\n * In these cases, you may want to create your own smaller groups of tweens.\r\n */\r\nvar TWEEN = mainGroup;\r\n// This is the best way to export things in a way that's compatible with both ES\r\n// Modules and CommonJS, without build hacks, and so as not to break the\r\n// existing API.\r\n// https://github.com/rollup/rollup/issues/1961#issuecomment-423037881\r\nvar getAll = TWEEN.getAll.bind(TWEEN);\r\nvar removeAll = TWEEN.removeAll.bind(TWEEN);\r\nvar add = TWEEN.add.bind(TWEEN);\r\nvar remove = TWEEN.remove.bind(TWEEN);\r\nvar update = TWEEN.update.bind(TWEEN);\r\nvar exports = {\r\n    Easing: Easing,\r\n    Group: Group,\r\n    Interpolation: Interpolation,\r\n    now: now$1,\r\n    Sequence: Sequence,\r\n    nextId: nextId,\r\n    Tween: Tween,\r\n    VERSION: VERSION,\r\n    getAll: getAll,\r\n    removeAll: removeAll,\r\n    add: add,\r\n    remove: remove,\r\n    update: update,\r\n};\r\n\r\nexport default exports;\r\nexport { Easing, Group, Interpolation, Sequence, Tween, VERSION, add, getAll, nextId, now$1 as now, remove, removeAll, update };\r\n","/** @module */\r\n\r\nimport { Tween } from '../lib/snowpack/build/snowpack/pkg/@tweenjs/tweenjs.js'\r\n\r\n/**\r\n */\r\n\r\n/**\r\n * Shows a circle at the parent object xy coordinates.\r\n * Animates the circle when picking up and dropping.\r\n * @param {(Candidate|CandidateDn|VoterShape)} parent\r\n *  - something with x and y attributes.\r\n * @param {Number} r - radius of graphic\r\n * @param {String} color - color code\r\n * @param {Screen} screen - something with .ctx to draw to.\r\n * @constructor\r\n */\r\nexport default function CircleGraphic(parent, r, screen) {\r\n    const self = this\r\n\r\n    self.r = r\r\n    self.trueR = r\r\n\r\n    self.pickUp = function () {\r\n        self.tween = new Tween(self)\r\n        self.tween.to({ r: self.trueR * 2 }, 100)\r\n        self.tween.start()\r\n    }\r\n    self.drop = function () {\r\n        self.tween = new Tween(self)\r\n        self.tween.to({ r: self.trueR }, 100)\r\n        self.tween.start()\r\n    }\r\n\r\n    // Graphics component\r\n    self.render = function () {\r\n        const { fctx } = screen\r\n        const { color } = parent\r\n\r\n        fctx.save()\r\n\r\n        if (self.tween) {\r\n            self.tween.update()\r\n        }\r\n\r\n        // handle\r\n\r\n        if (parent.exists === 0) {\r\n            fctx.globalAlpha = 0.2\r\n        }\r\n        fctx.beginPath()\r\n        fctx.fillStyle = color\r\n        fctx.arc(parent.x, parent.y, self.r, 0, 2 * Math.PI)\r\n        fctx.fill()\r\n        fctx.stroke()\r\n\r\n        fctx.restore()\r\n    }\r\n}\r\n","export default function hideOnClickOutside(element, hide) {\r\n    const isVisible = (elem) => !!elem\r\n        && !!(elem.offsetWidth || elem.offsetHeight || elem.getClientRects().length)\r\n\r\n    const outsideClickListener = (event) => {\r\n        if (!element.contains(event.target) && isVisible(element)) {\r\n            // or use: event.target.closest(selector) === null\r\n            const success = hide()\r\n            // eslint-disable-next-line no-use-before-define\r\n            if (success) removeClickListener()\r\n        }\r\n    }\r\n\r\n    const removeClickListener = () => {\r\n        document.removeEventListener('mousedown', outsideClickListener)\r\n        document.removeEventListener('touchstart', outsideClickListener)\r\n    }\r\n\r\n    document.addEventListener('mousedown', outsideClickListener)\r\n    document.addEventListener('touchstart', outsideClickListener)\r\n}\r\n","import hideOnClickOutside from './hideOnClickOutside.js'\r\n\r\nexport default function tooltipBox(entity, screen) {\r\n    const box = document.createElement('div')\r\n\r\n    box.className = 'tooltipBox'\r\n    box.style.position = 'absolute'\r\n\r\n    function update() {\r\n        if (entity.x > screen.width * 0.5) {\r\n            box.style.right = `${screen.width - entity.x}px`\r\n            box.style.left = 'unset'\r\n        } else {\r\n            box.style.left = `${entity.x}px`\r\n            box.style.right = 'unset'\r\n        }\r\n        box.style.top = `${entity.y}px`\r\n    }\r\n    update(entity)\r\n    // box.style.width = '10px'\r\n    // box.style.height = '10px'\r\n    box.style.border = '1px solid black'\r\n    box.style.padding = '4px'\r\n    box.style.background = 'white'\r\n\r\n    let pinned = false\r\n    /**\r\n     * Set pinned to true or false, to keep the box persistent.\r\n     * @param {Boolean} b\r\n     */\r\n    const setPin = (b) => {\r\n        pinned = b\r\n    }\r\n\r\n    const hidebox = () => {\r\n        // box.style.display = 'none'\r\n        if (!pinned) {\r\n            box.remove()\r\n            return true\r\n        }\r\n        return false\r\n    }\r\n\r\n    hideOnClickOutside(box, hidebox)\r\n\r\n    return { box, update, setPin }\r\n}\r\n","import tooltipBox from './tooltipBox.js'\r\n\r\nexport default function tooltipForEntity(entity, screen, sim) {\r\n    // make a html box appear\r\n\r\n    const tbox = tooltipBox(entity, screen)\r\n    const { box } = tbox\r\n\r\n    box.innerText = '- Properties -'\r\n\r\n    // Items //\r\n\r\n    const items = {}\r\n\r\n    items.exists = new Item(\r\n        'checkbox',\r\n        'Exists',\r\n        'Exists: ',\r\n        (val) => entity.setE(val ? 1 : 0),\r\n        entity.exists === 1,\r\n    )\r\n    box.appendChild(items.exists.div)\r\n    if (sim.election.dimensions === 1) {\r\n        if (entity.shape1.w) {\r\n            items.w1 = new Item(\r\n                'range',\r\n                'Width',\r\n                'Width: ',\r\n                (val) => entity.setW1(val),\r\n                entity.shape1.w,\r\n            )\r\n            box.appendChild(items.w1.div)\r\n        }\r\n        if (entity.shape1.densityProfile) {\r\n            items.densityProfile1 = new Item(\r\n                'select',\r\n                'Density Profile',\r\n                'Density Profile: ',\r\n                (val) => entity.setDensityProfile1(val),\r\n                entity.shape1.densityProfile,\r\n                ['step', 'gaussian'],\r\n            )\r\n            box.appendChild(items.densityProfile1.div)\r\n        }\r\n    } else if (entity.shape2.w) {\r\n        items.w2 = new Item(\r\n            'range',\r\n            'Width',\r\n            'Width: ',\r\n            (val) => entity.setW2(val),\r\n            entity.shape2.w,\r\n        )\r\n        box.appendChild(items.w2.div)\r\n    }\r\n    if (entity.setColor !== undefined) {\r\n        items.color = new Item(\r\n            'color',\r\n            'Color',\r\n            'Color: ',\r\n            (val) => entity.setColor(val),\r\n            entity.color,\r\n        )\r\n        box.appendChild(items.color.div)\r\n    }\r\n    items.showGhosts = new Item(\r\n        'checkbox',\r\n        'Show Ghosts',\r\n        'Show Ghosts: ',\r\n        (val) => sim.setShowNonExistingEntities(val),\r\n        sim.showGhosts,\r\n    )\r\n    box.appendChild(items.showGhosts.div)\r\n\r\n    // Append //\r\n\r\n    screen.tooltips.appendChild(box)\r\n}\r\n\r\nfunction Item(type, name, text, onChange, defaultValue, choices) {\r\n    const self = this\r\n\r\n    self.div = document.createElement('div')\r\n\r\n    if (type === 'select') {\r\n        self.input = document.createElement('select')\r\n        for (let i = 0; i < choices.length; i++) {\r\n            const option = document.createElement('option')\r\n            option.value = choices[i]\r\n            option.innerText = choices[i]\r\n            self.input.appendChild(option)\r\n        }\r\n        self.input.value = defaultValue\r\n        self.input.addEventListener('input', () => onChange(self.input.value))\r\n    } else {\r\n        self.input = document.createElement('input')\r\n        self.input.type = type\r\n        self.input.id = name\r\n        self.input.name = name\r\n        if (type === 'checkbox') {\r\n            if (defaultValue) {\r\n                self.input.checked = true\r\n            }\r\n            self.input.addEventListener('change', () => onChange(self.input.checked))\r\n        } else if (type === 'range') {\r\n            self.input.min = 1\r\n            self.input.max = 300\r\n            self.input.value = defaultValue\r\n            self.input.step = 1\r\n            self.input.addEventListener('input', () => onChange(self.input.value))\r\n        } else if (type === 'color') {\r\n            self.input.value = defaultValue\r\n            self.input.addEventListener('input', () => onChange(self.input.value))\r\n        }\r\n    }\r\n    self.label = document.createElement('label')\r\n    self.label.for = name\r\n    self.label.innerText = text\r\n    self.label.style['margin-right'] = '4px'\r\n    self.div.appendChild(self.label)\r\n    self.div.appendChild(self.input)\r\n}\r\n","/** @module */\r\n\r\nimport CircleGraphic from './CircleGraphic.js'\r\nimport tooltipForEntity from '../tooltips/tooltipForEntity.js'\r\n\r\n/**\r\n * VoterShape class with Handle component to take care of dragging.\r\n * Voronoi2D component takes care of drawing votes.\r\n * @param {Object} shape2\r\n * @param {Object} shape1\r\n * @param {Screen} screen\r\n * @param {Registrar} voterRegistrar\r\n * @param {Commander} commander\r\n * @param {Changes} changes\r\n * @param {Boolean} doLoad - Should we add the voter without adding to the history?\r\n * @constructor\r\n */\r\nexport default function VoterShape(\r\n    shape2,\r\n    shape1,\r\n    screen,\r\n    voterRegistrar,\r\n    commander,\r\n    changes,\r\n    doLoad,\r\n    voterCommander,\r\n    sim,\r\n) {\r\n    const self = this\r\n\r\n    self.shape1 = {}\r\n    self.shape2 = {}\r\n\r\n    // Get assigned an id by the voterRegistrar list manager\r\n\r\n    const id = voterRegistrar.new(self)\r\n\r\n    // Instantiate Variables\r\n\r\n    // use commands to instantiate variables\r\n    self.instantiate = () => {\r\n        const shape2p = { x: shape2.x, y: shape2.y }\r\n\r\n        const commands = [\r\n            voterCommander.setForListSenders.exists.command(id, 1, 0), // set alive flag\r\n            voterCommander.setForListSenders.shape2p.command(id, shape2p, shape2p),\r\n            voterCommander.setForListSenders.shape1x.command(id, shape1.x, shape1.x),\r\n            voterCommander.setForListSenders.shape2w.command(id, shape2.w, shape2.w),\r\n            voterCommander.setForListSenders.shape1w.command(id, shape1.w, shape1.w),\r\n            voterCommander.setForListSenders.shape1densityProfile.command(\r\n                id,\r\n                shape1.densityProfile,\r\n                shape1.densityProfile,\r\n            ),\r\n        ]\r\n        // Either load the commands because we don't want to create an item of history\r\n        // Or do the commands because want to store an item in history, so that we can undo.\r\n        if (doLoad) {\r\n            commander.loadCommands(commands)\r\n        } else {\r\n            commander.doCommands(commands)\r\n        }\r\n    }\r\n\r\n    self.setAction = {}\r\n    self.setAction.exists = (e) => {\r\n        self.exists = e\r\n        changes.add(['draggables'])\r\n    }\r\n    self.setE = (e) => {\r\n        const cur = voterCommander.setForListSenders.exists.getCurrentValue(id)\r\n        voterCommander.setForListSenders.exists.go(id, e, cur)\r\n    }\r\n\r\n    self.setAction.shape2p = (p) => {\r\n        self.shape2.x = p.x\r\n        self.shape2.y = p.y\r\n        if (sim.election.dimensions === 2) {\r\n            self.x = p.x\r\n            self.y = p.y\r\n        }\r\n        changes.add(['draggables'])\r\n    }\r\n    self.setAction.shape1x = (p) => {\r\n        self.shape1.x = p\r\n        if (sim.election.dimensions === 1) {\r\n            self.x = p\r\n            self.y = 250\r\n        }\r\n        changes.add(['draggables'])\r\n    }\r\n    self.setXY = (p) => {\r\n        if (sim.election.dimensions === 1) {\r\n            const cur = voterCommander.setForListSenders.shape1x.getCurrentValue(id)\r\n            voterCommander.setForListSenders.shape1x.go(id, p.x, cur)\r\n        } else {\r\n            const cur = voterCommander.setForListSenders.shape2p.getCurrentValue(id)\r\n            voterCommander.setForListSenders.shape2p.go(id, p, cur)\r\n        }\r\n    }\r\n    /** Do this when entering a state because x and y change.\r\n     *  Maybe x and y should be in the VoterSim instead... just speculating. */\r\n    self.updateXY = () => {\r\n        if (sim.election.dimensions === 1) {\r\n            self.setAction.shape1x(self.shape1.x)\r\n        } else {\r\n            self.setAction.shape2p({ x: self.shape2.x, y: self.shape2.y })\r\n        }\r\n    }\r\n\r\n    self.setAction.shape2w = (newW) => {\r\n        self.shape2.w = newW\r\n        changes.add(['width'])\r\n    }\r\n    self.setW2 = (newW) => {\r\n        const cur = voterCommander.setForListSenders.shape2w.getCurrentValue(id)\r\n        voterCommander.setForListSenders.shape2w.go(id, newW, cur)\r\n    }\r\n\r\n    self.setAction.shape1w = (newW) => {\r\n        self.shape1.w = newW\r\n        changes.add(['width'])\r\n    }\r\n    self.setW1 = (newW) => {\r\n        const cur = voterCommander.setForListSenders.shape1w.getCurrentValue(id)\r\n        voterCommander.setForListSenders.shape1w.go(id, newW, cur)\r\n    }\r\n\r\n    /** Density Profile can be \"gaussian\" or \"step\" */\r\n    self.setAction.shape1densityProfile = (newDensityProfile1) => {\r\n        self.shape1.densityProfile = newDensityProfile1\r\n        changes.add(['densityProfile'])\r\n    }\r\n    self.setDensityProfile1 = (newDensityProfile1) => {\r\n        const cur = voterCommander.setForListSenders.shape1densityProfile.getCurrentValue(id)\r\n        voterCommander.setForListSenders.shape1densityProfile.go(id, newDensityProfile1, cur)\r\n    }\r\n\r\n    self.instantiate()\r\n\r\n    // Done instantiating variables\r\n\r\n    // Click Handler\r\n\r\n    self.click = () => {\r\n        tooltipForEntity(self, screen, sim)\r\n    }\r\n\r\n    // Rendering\r\n\r\n    self.color = '#88888888'\r\n    const circle = new CircleGraphic(self, 13, screen)\r\n    self.circle = circle\r\n\r\n    self.renderForeground = () => {\r\n        // handle\r\n        circle.render()\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Register senders with the commander for setting entity values.\r\n * This is here because we need an action that takes an id.\r\n * @param {Registrar} voterRegistrar\r\n * @param {Commander} commander\r\n * @param {VoterShapeAdd} voterShapeAdd\r\n * @constructor\r\n */\r\nexport default function VoterCommander(voterRegistrar, commander, voterShapeAdd) {\r\n    const self = this\r\n\r\n    const prefix = 'voters'\r\n\r\n    // a object with senders that set parameters for lists of entities.\r\n    // Like if you want to set the exists property of the 2nd voter to 1.\r\n    self.setForListSenders = {}\r\n\r\n    function makeSetForListSender(key, configKey, isChain) {\r\n        self.setForListSenders[key] = commander.addSenderForList({\r\n            action: (id, e) => {\r\n                self.setNumberVoters(id + 1)\r\n                const voter = voterRegistrar.get(id)\r\n                voter.setAction[key](e)\r\n            },\r\n            name: `${prefix}-${configKey}`,\r\n            props: { isChain },\r\n        })\r\n    }\r\n    makeSetForListSender('exists', 'exists', false)\r\n    makeSetForListSender('shape2p', 'shape2D-point', true)\r\n    makeSetForListSender('shape1x', 'shape1D-x', true)\r\n    makeSetForListSender('shape2w', 'shape2D-width', true)\r\n    makeSetForListSender('shape1w', 'shape1D-width', true)\r\n    makeSetForListSender('shape1densityProfile', 'shape1D-densityProfile', false)\r\n\r\n    // This is kind of weird because this value is not a good measure of the number of entities.\r\n    // An undo will reduce the number stored with the command name,\r\n    // but not reduce the number of entities.\r\n    // So we disable undo.\r\n    self.setNumberVotersSender = commander.addSender({\r\n        action: (num) => voterShapeAdd.setNumberVotersAction(num),\r\n        currentValue: 0,\r\n        name: `${prefix}-setNumberAtLeast`,\r\n        props: { isFirstAction: true },\r\n    })\r\n    self.setNumberVoters = (num) => {\r\n        commander.loadCommands([self.setNumberVotersSender.command(num)])\r\n    }\r\n}\r\n","import VoterShapeAddMakeButton from '../sim/VoterShapeAddMakeButton.js'\r\nimport Registrar from '../sim/Registrar.js'\r\nimport VoterShape from './VoterShape.js'\r\nimport VoterCommander from './VoterCommander.js'\r\n\r\n/** A component of sim.js that deals with adding voters. */\r\nexport default function VoterShapeAdd(screen, layout, changes, commander, sims, sim) {\r\n    const self = this\r\n\r\n    VoterShapeAddMakeButton(layout, self)\r\n\r\n    const voterRegistrar = new Registrar()\r\n    const voterCommander = new VoterCommander(voterRegistrar, commander, self)\r\n\r\n    self.addVoterPressed = () => {\r\n        const num = voterRegistrar.num() + 1\r\n        voterCommander.setNumberVoters(num)\r\n    }\r\n    self.setNumberVotersAction = (num) => {\r\n        while (voterRegistrar.num() < num) {\r\n            self.addVoterCircle({ x: 50, y: 50, w: 200 }, { x: 50, w: 200, densityProfile: 'gaussian' }, false)\r\n        }\r\n    }\r\n\r\n    self.addVoterCircle = (shape2, shape1, doLoad) => {\r\n        // eslint-disable-next-line max-len\r\n        const voterShape = new VoterShape(shape2, shape1, screen, voterRegistrar, commander, changes, doLoad, voterCommander, sim)\r\n\r\n        sims.one2D.addSimVoterCircle(voterShape)\r\n        sims.one1D.addSimVoterCircle(voterShape)\r\n        sims.geoOne.addSimVoterCircle(voterShape)\r\n        sims.sample.addSimVoterCircle(voterShape)\r\n\r\n        const num = voterRegistrar.num()\r\n        voterCommander.setNumberVoters(num)\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Add buttons to layout for undo and redo, and connect them to commander for functionality.\r\n * @param {Layout} layout\r\n * @param {VoterShapeAdd} voterShapeAdd\r\n */\r\nexport default function VoterShapeAddMakeButton(layout, voterShapeAdd) {\r\n    const addVoterButton = document.createElement('button')\r\n\r\n    addVoterButton.innerText = 'Add Voter'\r\n    addVoterButton.className = 'button2'\r\n\r\n    addVoterButton.onclick = () => {\r\n        voterShapeAdd.addVoterPressed()\r\n    }\r\n\r\n    layout.newElement('addVoter', addVoterButton)\r\n}\r\n","/** @module */\r\n\r\nimport { Tween } from '../lib/snowpack/build/snowpack/pkg/@tweenjs/tweenjs.js'\r\n/**\r\n * Square is a graphic.\r\n * It displays itself on a parent object.\r\n * Its parent object stores its x and y.\r\n * It shows a square at the parent object xy coordinates.\r\n * It animates the square when picking up and dropping.\r\n * @param {Object} parent\r\n * @param {Number} parent.x\r\n * @param {Number} parent.y\r\n * @param {Number} w - width of square to draw.\r\n * @param {Number} h - height of square to draw.\r\n * @param {Screen} screen\r\n * @constructor\r\n */\r\nexport default function SquareGraphic(parent, w, h, screen) {\r\n    const self = this\r\n    self.w = w // display width, because we're going to make animations with it\r\n    self.h = h\r\n    self.trueW = w // true width, because we want to return to this width after animating.\r\n    self.trueH = h\r\n\r\n    self.pickUp = function () {\r\n        self.tweenSq = new Tween(self)\r\n        self.tweenSq.to({ w: self.trueW + 10, h: self.trueH + 10 }, 100)\r\n        self.tweenSq.start()\r\n    }\r\n    self.drop = function () {\r\n        self.tweenSq = new Tween(self)\r\n        self.tweenSq.to({ w: self.trueW, h: self.trueH }, 100)\r\n        self.tweenSq.start()\r\n    }\r\n\r\n    // Graphics component\r\n    self.render = function () {\r\n        const { fctx } = screen\r\n\r\n        fctx.save()\r\n\r\n        if (self.tweenSq) {\r\n            self.tweenSq.update()\r\n        }\r\n\r\n        if (parent.exists === 0) { fctx.globalAlpha = 0.2 }\r\n\r\n        fctx.beginPath()\r\n        fctx.fillStyle = parent.color\r\n        fctx.rect(\r\n            (parent.x - 0.5 * self.w) - 0.5,\r\n            (parent.y - 0.5 * self.h) - 0.5,\r\n            self.w + 1,\r\n            self.h + 1,\r\n        )\r\n        fctx.fill()\r\n        fctx.stroke()\r\n\r\n        fctx.restore()\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport SquareGraphic from './SquareGraphic.js'\r\nimport { drawStrokedColor, textPercent } from '../utilities/graphicsUtilities.js'\r\nimport tooltipForEntity from '../tooltips/tooltipForEntity.js'\r\n\r\n/**\r\n * Candidate class on top of handle.\r\n * Candidate adds candidate behavior on top of a draggable handle handle.\r\n * @param {Object} shape2\r\n * @param {Object} shape1\r\n * @param {Number} wHandle\r\n * @param {Number} hHandle\r\n * @param {String} color\r\n * @param {Screen} screen\r\n * @param {Registrar} candidateRegistrar\r\n * @param {Commander} commander\r\n * @param {Changes} changes\r\n * @param {Boolean} doLoad - Should we add the candidateDn without adding to the history?\r\n * @constructor\r\n */\r\nexport default function Candidate(\r\n    shape2,\r\n    shape1,\r\n    wHandle,\r\n    hHandle,\r\n    color,\r\n    screen,\r\n    candidateRegistrar,\r\n    commander,\r\n    changes,\r\n    doLoad,\r\n    candidateCommander,\r\n    sim,\r\n) {\r\n    const self = this\r\n\r\n    self.shape1 = {}\r\n    self.shape2 = {}\r\n\r\n    const id = candidateRegistrar.new(self)\r\n\r\n    // Instantiate Variables\r\n\r\n    // use commands to instantiate variables\r\n    self.instantiate = () => {\r\n        const shape2p = { x: shape2.x, y: shape2.y }\r\n\r\n        const commands = [\r\n            candidateCommander.setForListSenders.exists.command(id, 1, 0), // set alive flag\r\n            candidateCommander.setForListSenders.shape2p.command(id, shape2p, shape2p),\r\n            candidateCommander.setForListSenders.shape1x.command(id, shape1.x, shape1.x),\r\n            candidateCommander.setForListSenders.color.command(id, color, color), // set alive flag\r\n        ]\r\n        // Either load the commands because we don't want to create an item of history\r\n        // Or do the commands because want to store an item in history, so that we can undo.\r\n        if (doLoad) {\r\n            commander.loadCommands(commands)\r\n        } else {\r\n            commander.doCommands(commands)\r\n        }\r\n    }\r\n\r\n    self.setAction = {}\r\n\r\n    self.setAction.exists = (e) => {\r\n        self.exists = e\r\n        changes.add(['draggables'])\r\n    }\r\n    self.setE = (e) => {\r\n        const cur = candidateCommander.setForListSenders.exists.getCurrentValue(id)\r\n        candidateCommander.setForListSenders.exists.go(id, e, cur)\r\n    }\r\n\r\n    self.setAction.shape2p = (p) => {\r\n        self.shape2.x = p.x\r\n        self.shape2.y = p.y\r\n        if (sim.election.dimensions === 2) {\r\n            self.x = p.x\r\n            self.y = p.y\r\n        }\r\n        changes.add(['draggables'])\r\n    }\r\n    self.setAction.shape1x = (p) => {\r\n        self.shape1.x = p\r\n        if (sim.election.dimensions === 1) {\r\n            self.x = p\r\n            self.y = 250\r\n        }\r\n        changes.add(['draggables'])\r\n    }\r\n    self.setXY = (p) => {\r\n        if (sim.election.dimensions === 1) {\r\n            const cur = candidateCommander.setForListSenders.shape1x.getCurrentValue(id)\r\n            candidateCommander.setForListSenders.shape1x.go(id, p.x, cur)\r\n        } else {\r\n            const cur = candidateCommander.setForListSenders.shape2p.getCurrentValue(id)\r\n            candidateCommander.setForListSenders.shape2p.go(id, p, cur)\r\n        }\r\n    }\r\n    /** Do this when entering a state because x and y change.\r\n     *  Maybe x and y should be in the CandidateSim instead... just speculating. */\r\n    self.updateXY = () => {\r\n        if (sim.election.dimensions === 1) {\r\n            self.setAction.shape1x(self.shape1.x)\r\n        } else {\r\n            self.setAction.shape2p({ x: self.shape2.x, y: self.shape2.y })\r\n        }\r\n    }\r\n\r\n    self.setAction.color = (newColor) => {\r\n        self.color = newColor\r\n        changes.add(['color'])\r\n    }\r\n    self.setColor = (e) => {\r\n        const cur = candidateCommander.setForListSenders.color.getCurrentValue(id)\r\n        candidateCommander.setForListSenders.color.go(id, e, cur)\r\n    }\r\n\r\n    self.instantiate()\r\n\r\n    // Click Handler\r\n\r\n    self.click = () => {\r\n        tooltipForEntity(self, screen, sim)\r\n    }\r\n\r\n    // Rendering\r\n\r\n    const square = new SquareGraphic(self, wHandle, hHandle, screen)\r\n    self.square = square\r\n\r\n    self.fraction = 0\r\n    self.setFraction = function (fraction) {\r\n        self.fraction = fraction\r\n    }\r\n\r\n    self.setWins = (wins) => {\r\n        self.wins = wins\r\n    }\r\n\r\n    self.renderForeground = function () {\r\n        square.render()\r\n\r\n        // show minimal graphics when rendering as a ghost.\r\n        if (self.exists === 0) return\r\n\r\n        drawStrokedColor(textPercent(self.fraction), self.x, self.y - square.h * 0.5 - 2, 20, 2, '#222', 1, screen.fctx)\r\n\r\n        if (self.wins !== undefined) {\r\n            drawStrokedColor(self.wins, self.x, self.y + square.h * 0.5 + 20 + 2, 20, 2, '#222', 1, screen.fctx)\r\n        }\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Register senders with the commander for setting entity values.\r\n * This is here because we need an action that takes an id.\r\n * @param {Registrar} candidateRegistrar\r\n * @param {Commander} commander\r\n * @param {Sim} sim\r\n * @constructor\r\n */\r\nexport default function CandidateCommander(candidateRegistrar, commander, sim) {\r\n    const self = this\r\n\r\n    const prefix = 'candidates'\r\n\r\n    // a object with senders that set parameters for lists of entities.\r\n    // Like if you want to set the exists property of the 2nd candidate to 1.\r\n    self.setForListSenders = {}\r\n\r\n    function makeSetForListSender(key, configKey, isChain) {\r\n        self.setForListSenders[key] = commander.addSenderForList({\r\n            action: (id, e) => {\r\n                self.setNumberCandidates(id + 1)\r\n                const candidate = candidateRegistrar.get(id)\r\n                candidate.setAction[key](e)\r\n            },\r\n            name: `${prefix}-${configKey}`,\r\n            props: { isChain },\r\n        })\r\n    }\r\n\r\n    makeSetForListSender('exists', 'exists', false)\r\n    makeSetForListSender('shape2p', 'shape2D-point', true)\r\n    makeSetForListSender('shape1x', 'shape1D-x', true)\r\n    makeSetForListSender('color', 'color', false)\r\n\r\n    // This is kind of weird because this value is not a good measure of the number of entities.\r\n    // An undo will reduce the number stored with the command name,\r\n    // but not reduce the number of entities.\r\n    // So we disable undo.\r\n    // Well, actually we can just loadCommands in order to avoid undo.\r\n    self.setNumberCandidatesSender = commander.addSender({\r\n        action: (num) => {\r\n            sim.setNumberCandidatesAction(num)\r\n        },\r\n        currentValue: 0,\r\n        name: `${prefix}-setNumberAtLeast`,\r\n        props: { isFirstAction: true },\r\n    })\r\n    self.setNumberCandidates = (num) => {\r\n        commander.loadCommands([self.setNumberCandidatesSender.command(num)])\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Add button to layout for adding a candidate\r\n * @param {Layout} layout\r\n * @param {Sim} sim\r\n */\r\nexport default function CandidateAddMakeButton(layout, sim) {\r\n    const self = this\r\n\r\n    const addCandidateButton = document.createElement('button')\r\n\r\n    addCandidateButton.className = 'button2'\r\n    addCandidateButton.innerText = 'Add Candidate'\r\n\r\n    addCandidateButton.onclick = () => {\r\n        sim.addCandidatePressed()\r\n    }\r\n\r\n    layout.newElement('addCandidate', addCandidateButton)\r\n\r\n    self.show = () => {\r\n        addCandidateButton.hidden = false\r\n    }\r\n    self.hide = () => {\r\n        addCandidateButton.hidden = true\r\n    }\r\n}\r\n","import Candidate from './Candidate.js'\r\nimport CandidateCommander from './CandidateCommander.js'\r\nimport { standardizeColor } from '../utilities/jsHelpers.js'\r\nimport CandidateAddMakeButton from '../sim/CandidateAddMakeButton.js'\r\nimport Registrar from '../sim/Registrar.js'\r\n\r\n/** A component of sim.js that deals with adding candidates. */\r\nexport default function CandidateAdd(screen, layout, changes, commander, sims, sim) {\r\n    const self = this\r\n    self.canButton = new CandidateAddMakeButton(layout, self)\r\n    const candidateRegistrar = new Registrar()\r\n    const candidateCommander = new CandidateCommander(candidateRegistrar, commander, self)\r\n\r\n    self.addCandidatePressed = () => {\r\n        // really, we want to make a command to set numCandidates to at least an amount\r\n        const num = candidateRegistrar.num() + 1\r\n        candidateCommander.setNumberCandidates(num)\r\n    }\r\n    self.setNumberCandidatesAction = (num) => {\r\n        while (candidateRegistrar.num() < num) {\r\n            const color = standardizeColor('yellow')\r\n            self.addCandidate({ x: 50, y: 50 }, { x: 50 }, color, false)\r\n        }\r\n    }\r\n\r\n    self.addCandidate = (shape2, shape1, c, doLoad) => {\r\n        // eslint-disable-next-line no-new, max-len\r\n        const candidate = new Candidate(shape2, shape1, 21, 21, c, screen, candidateRegistrar, commander, changes, doLoad, candidateCommander, sim)\r\n        sims.one2D.addSimCandidate(candidate)\r\n        sims.one1D.addSimCandidate(candidate)\r\n        sims.geoOne.addSimCandidate(candidate)\r\n\r\n        const num = candidateRegistrar.num()\r\n        candidateCommander.setNumberCandidates(num)\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport tooltipForEntity from '../tooltips/tooltipForEntity.js'\r\nimport SquareGraphic from '../candidates/SquareGraphic.js'\r\n\r\n/**\r\n * This represents a spatial distribution of candidates.\r\n * A draggable handle handle provides draggable behavior.\r\n * @param {Object} shape2\r\n * @param {Object} shape1\r\n * @param {Screen} screen\r\n * @param {Registrar} candidateDnRegistrar\r\n * @param {Commander} commander\r\n * @param {Changes} changes\r\n * @param {Boolean} doLoad - Should we add the candidateDn without adding to the history?\r\n * @constructor\r\n */\r\nexport default function CandidateDistribution(\r\n    shape2,\r\n    shape1,\r\n    screen,\r\n    candidateDnRegistrar,\r\n    commander,\r\n    changes,\r\n    doLoad,\r\n    candidateDnCommander,\r\n    sim,\r\n) {\r\n    const self = this\r\n\r\n    self.shape2 = {}\r\n    self.shape1 = {}\r\n\r\n    const id = candidateDnRegistrar.new(self)\r\n\r\n    // Instantiate Variables\r\n\r\n    // use commands to instantiate variables\r\n    self.instantiate = () => {\r\n        const shape2p = { x: shape2.x, y: shape2.y }\r\n\r\n        const commands = [\r\n            candidateDnCommander.setForListSenders.exists.command(id, 1, 0), // set alive flag\r\n            candidateDnCommander.setForListSenders.shape2p.command(id, shape2p, shape2p),\r\n            candidateDnCommander.setForListSenders.shape1x.command(id, shape1.x, shape1.x),\r\n            candidateDnCommander.setForListSenders.shape2w.command(id, shape2.w, shape2.w),\r\n        ]\r\n        // Either load the commands because we don't want to create an item of history\r\n        // Or do the commands because want to store an item in history, so that we can undo.\r\n        if (doLoad) {\r\n            commander.loadCommands(commands)\r\n        } else {\r\n            commander.doCommands(commands)\r\n        }\r\n    }\r\n\r\n    self.setAction = {}\r\n\r\n    self.setAction.exists = (e) => {\r\n        self.exists = e\r\n        changes.add(['draggables'])\r\n    }\r\n    self.setE = (e) => {\r\n        const cur = candidateDnCommander.setForListSenders.exists.getCurrentValue(id)\r\n        candidateDnCommander.setForListSenders.exists.go(id, e, cur)\r\n    }\r\n\r\n    self.setAction.shape2p = (p) => {\r\n        self.shape2.x = p.x\r\n        self.shape2.y = p.y\r\n        if (sim.election.dimensions === 2) {\r\n            self.x = p.x\r\n            self.y = p.y\r\n        }\r\n        changes.add(['draggables'])\r\n    }\r\n    self.setAction.shape1x = (p) => {\r\n        self.shape1.x = p\r\n        if (sim.election.dimensions === 1) {\r\n            self.x = p\r\n            self.y = 150\r\n        }\r\n        changes.add(['draggables'])\r\n    }\r\n    self.setXY = (p) => {\r\n        if (sim.election.dimensions === 1) {\r\n            const cur = candidateDnCommander.setForListSenders.shape1x.getCurrentValue(id)\r\n            candidateDnCommander.setForListSenders.shape1x.go(id, p.x, cur)\r\n        } else {\r\n            const cur = candidateDnCommander.setForListSenders.shape2p.getCurrentValue(id)\r\n            candidateDnCommander.setForListSenders.shape2p.go(id, p, cur)\r\n        }\r\n    }\r\n    /** Do this when entering a state because x and y change.\r\n     *  Maybe x and y should be in the SimCandidateDn instead... just speculating. */\r\n    self.updateXY = () => {\r\n        if (sim.election.dimensions === 1) {\r\n            self.setAction.shape1x(self.shape1.x)\r\n        } else {\r\n            self.setAction.shape2p({ x: self.shape2.x, y: self.shape2.y })\r\n        }\r\n    }\r\n\r\n    self.setAction.shape2w = (newW) => {\r\n        self.shape2.w = newW\r\n        changes.add(['width'])\r\n    }\r\n    self.setW2 = (newW) => {\r\n        const cur = candidateDnCommander.setForListSenders.shape2w.getCurrentValue(id)\r\n        candidateDnCommander.setForListSenders.shape2w.go(id, newW, cur)\r\n    }\r\n\r\n    self.instantiate()\r\n\r\n    // Click Handler\r\n\r\n    self.click = () => {\r\n        tooltipForEntity(self, screen, sim)\r\n    }\r\n\r\n    // Rendering\r\n\r\n    self.color = '#ccc'\r\n\r\n    const square = new SquareGraphic(self, 21, 21, screen) // square is for rendering\r\n    self.square = square\r\n\r\n    self.render = function () {\r\n        const { ctx } = screen\r\n\r\n        ctx.beginPath()\r\n        // ctx.fillStyle = \"grey\"\r\n        ctx.arc(self.x, self.y, self.shape2.w * 0.5, 0, 2 * Math.PI)\r\n        // ctx.fill()\r\n        ctx.stroke()\r\n    }\r\n    self.renderForeground = () => {\r\n        square.render()\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Register senders with the commander for setting entity values.\r\n * This is here because we need an action that takes an id.\r\n * @param {Registrar} candidateDnRegistrar\r\n * @param {Commander} commander\r\n * @param {Sim} sim\r\n * @constructor\r\n */\r\nexport default function CandidateDnCommander(candidateDnRegistrar, commander, sim) {\r\n    const self = this\r\n\r\n    const prefix = 'candidateDns'\r\n\r\n    // a object with senders that set parameters for lists of entities.\r\n    // Like if you want to set the exists property of the 2nd candidate to 1.\r\n    self.setForListSenders = {}\r\n\r\n    function makeSetForListSender(key, configKey, isChain) {\r\n        self.setForListSenders[key] = commander.addSenderForList({\r\n            action: (id, e) => {\r\n                self.setNumberCandidateDns(id + 1)\r\n                const candidateDn = candidateDnRegistrar.get(id)\r\n                candidateDn.setAction[key](e)\r\n            },\r\n            name: `${prefix}-${configKey}`,\r\n            props: { isChain },\r\n        })\r\n    }\r\n\r\n    makeSetForListSender('exists', 'exists', false)\r\n    makeSetForListSender('shape2p', 'shape2D-point', true)\r\n    makeSetForListSender('shape1x', 'shape1D-x', true)\r\n    makeSetForListSender('shape2w', 'shape2D-width', true)\r\n\r\n    // This is kind of weird because this value is not a good measure of the number of entities.\r\n    // An undo will reduce the number stored with the command name,\r\n    // but not reduce the number of entities.\r\n    // So we disable undo.\r\n    self.setNumberCandidateDnsSender = commander.addSender({\r\n        action: (num) => {\r\n            sim.setNumberCandidateDnsAction(num)\r\n        },\r\n        currentValue: 0,\r\n        name: `${prefix}-setNumberAtLeast`,\r\n        props: { isFirstAction: true },\r\n    })\r\n    self.setNumberCandidateDns = (num) => {\r\n        commander.loadCommands([self.setNumberCandidateDnsSender.command(num)])\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Add button to layout for adding a candidate\r\n * @param {Layout} layout\r\n * @param {Commander} commander\r\n */\r\nexport default function CandidateDnAddMakeButton(layout, sim) {\r\n    const self = this\r\n    const addCandidateDistributionButton = document.createElement('button')\r\n\r\n    addCandidateDistributionButton.className = 'button2'\r\n    addCandidateDistributionButton.innerText = 'Add Candidate Distribution'\r\n\r\n    addCandidateDistributionButton.onclick = () => {\r\n        sim.addCandidateDistributionPressed()\r\n    }\r\n\r\n    layout.newElement('addCandidateDistribution', addCandidateDistributionButton)\r\n\r\n    self.show = () => {\r\n        addCandidateDistributionButton.hidden = false\r\n    }\r\n    self.hide = () => {\r\n        addCandidateDistributionButton.hidden = true\r\n    }\r\n}\r\n","import CandidateDn from './CandidateDn.js'\r\nimport CandidateDnCommander from './CandidateDnCommander.js'\r\nimport CandidateDnAddMakeButton from '../sim/CandidateDnAddMakeButton.js'\r\nimport Registrar from '../sim/Registrar.js'\r\n\r\n/** A component of sim.js that deals with adding candidate distributions. */\r\nexport default function CandidateDnAdd(screen, layout, changes, commander, sims, sim) {\r\n    const self = this\r\n\r\n    self.canDnButton = new CandidateDnAddMakeButton(layout, self)\r\n    const candidateDnRegistrar = new Registrar()\r\n    const candidateDnCommander = new CandidateDnCommander(candidateDnRegistrar, commander, self)\r\n\r\n    self.addCandidateDistributionPressed = () => {\r\n        const num = candidateDnRegistrar.num() + 1\r\n        candidateDnCommander.setNumberCandidateDns(num)\r\n    }\r\n    self.setNumberCandidateDnsAction = (num) => {\r\n        while (candidateDnRegistrar.num() < num) {\r\n            self.addCandidateDistribution({ x: 50, y: 50, w: 200 }, { x: 50 }, false)\r\n        }\r\n    }\r\n\r\n    self.addCandidateDistribution = (shape2, shape1, doLoad) => {\r\n        // eslint-disable-next-line no-new, max-len\r\n        const candidateDn = new CandidateDn(shape2, shape1, screen, candidateDnRegistrar, commander, changes, doLoad, candidateDnCommander, sim)\r\n        sims.sample.addSimCandidateDistribution(candidateDn)\r\n\r\n        const num = candidateDnRegistrar.num()\r\n        candidateDnCommander.setNumberCandidateDns(num)\r\n    }\r\n}\r\n","import colorBlend from '../election/colorBlend.js'\r\n\r\n/**\r\n * Draw grid cells to show votes.\r\n * @param {VoterShape} voterGeom\r\n * @param {Screen} screen\r\n * @constructor\r\n */\r\nexport default function Grid1D(gridData, candidateSimList, screen) {\r\n    const self = this\r\n\r\n    const cans = candidateSimList.getCandidates()\r\n    const { grid, voteSet, voterGeom } = gridData\r\n\r\n    const { x, w, densityProfile } = voterGeom\r\n    const h = 200\r\n    const center = 100\r\n\r\n    const { ctx } = screen\r\n\r\n    const nCans = cans.length\r\n\r\n    self.renderBackground = function () {\r\n        ctx.save()\r\n        ctx.globalAlpha = 0.7\r\n\r\n        // draw each can separately\r\n        for (let i = 0; i < nCans; i++) {\r\n            ctx.strokeStyle = '#dddddd'\r\n            // ctx.strokeStyle = '#333333'\r\n            ctx.beginPath()\r\n            shapePath(i, true)\r\n            ctx.stroke()\r\n        }\r\n        ctx.restore()\r\n    }\r\n    self.render = function () {\r\n        ctx.save()\r\n        ctx.globalAlpha = 0.7\r\n        for (let i = 0; i < nCans; i++) {\r\n            // draw image\r\n            ctx.fillStyle = cans[i].color\r\n            ctx.strokeStyle = colorBlend([0.8, 0.2], [cans[i].color, '#000000'])\r\n            ctx.beginPath()\r\n            shapePath(i, false)\r\n            ctx.fill()\r\n            ctx.stroke()\r\n        }\r\n        ctx.restore()\r\n    }\r\n    function shapePath(iCan, drawOutline) {\r\n        const isGauss = (densityProfile === 'gaussian')\r\n        const gridX = grid.x\r\n        const sigma = w / Math.sqrt(2 * Math.PI) // w = sigma * sqrt(2*pi)\r\n        const amp = h / nCans\r\n        const bottom = center + h * 0.5 - iCan * amp\r\n        // start bottom left\r\n        // go outside of screen by one pixel\r\n        const left = Math.max(-1, gridX[0])\r\n        ctx.moveTo(left, bottom)\r\n        const gl = gridX.length\r\n        for (let i = 0; i < gl; i += 1) {\r\n            const xg = gridX[i]\r\n            if (xg < -1) continue\r\n            if (xg > screen.width + 1) continue\r\n            const voteMult = (drawOutline) ? 1 : voteSet[i].tallyFractions[iCan]\r\n            const shapeMult = (isGauss) ? Math.exp(-0.5 * ((xg - x) / sigma) ** 2) : 1\r\n            const y = bottom - amp * shapeMult * voteMult\r\n            ctx.lineTo(xg, y)\r\n        }\r\n        // end bottom right\r\n        const right = Math.min(screen.width + 1, gridX[gl - 1])\r\n        ctx.lineTo(right, bottom)\r\n        // close path\r\n        ctx.lineTo(left, bottom)\r\n    }\r\n}\r\n","/** @module */\r\n\r\n// d3-voronoi\r\n// d3-select\r\n// d3-range\r\n\r\nimport { Delaunay } from '../lib/snowpack/build/snowpack/pkg/d3-delaunay.js'\r\n// import { Delaunay } from 'd3-delaunay'\r\n// import { Delaunay } from 'https://cdn.skypack.dev/d3-delaunay@6'\r\n// https://github.com/d3/d3-delaunay\r\n\r\n/**\r\n * Draw Voronoi cells to show votes.\r\n * Voronoi1D is called by VizOne1D.\r\n * @param {VoterGroup} voterGroup\r\n * @param {CandidateSimList} candidateSimList\r\n * @param {Screen} screen\r\n * @constructor\r\n */\r\nexport default function Voronoi1D(voterGroup, candidateSimList, screen) {\r\n    const self = this\r\n\r\n    const cans = candidateSimList.getCandidates()\r\n    const points = cans.map((e) => [e.x, e.y])\r\n    const delaunay = Delaunay.from(points)\r\n    const voronoi = delaunay.voronoi([0, 0, screen.width, screen.height])\r\n\r\n    self.render = function () {\r\n        const { ctx } = screen\r\n        const { x, shape1 } = voterGroup\r\n        const { w, densityProfile } = shape1\r\n        const h = 100\r\n\r\n        ctx.save()\r\n\r\n        // clip the voronoi diagram\r\n\r\n        // http://jsfiddle.net/jimrhoskins/dDUC3/1/\r\n        // https://dustinpfister.github.io/2019/10/08/canvas-clip/\r\n\r\n        ctx.beginPath()\r\n        doPath()\r\n        // ctx.closePath()\r\n        ctx.clip()\r\n\r\n        const n = cans.length\r\n        for (let i = 0; i < n; i++) {\r\n            ctx.beginPath()\r\n            voronoi.renderCell(i, ctx)\r\n            ctx.fillStyle = cans[i].color\r\n            ctx.fill()\r\n            ctx.stroke()\r\n        }\r\n\r\n        ctx.beginPath()\r\n        doPath()\r\n        ctx.stroke()\r\n\r\n        ctx.restore()\r\n\r\n        function doPath() {\r\n            if (densityProfile === 'gaussian') {\r\n                gaussianPath()\r\n            } else {\r\n                rectanglePath()\r\n            }\r\n        }\r\n        function gaussianPath() {\r\n            const sigma = w / Math.sqrt(2 * Math.PI) // w = sigma * sqrt(2*pi)\r\n            const amp = h\r\n            const bottom = 150 + h * 0.5\r\n            // start bottom left\r\n            ctx.moveTo(0, bottom)\r\n            const pa = []\r\n            for (let i = 0; i <= screen.width; i += 1) {\r\n                const xp = 0.5 * ((i - x) / sigma) ** 2\r\n                const y = bottom - amp * Math.exp(-xp)\r\n                pa.push(y)\r\n                ctx.lineTo(i, y)\r\n            }\r\n            // end bottom right\r\n            ctx.lineTo(screen.width, bottom)\r\n            ctx.lineTo(0, bottom)\r\n            // ctx.closePath()\r\n        }\r\n        function rectanglePath() {\r\n            ctx.rect(x - w * 0.5, 150 - h * 0.5, w, h)\r\n        }\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport Grid1D from './Grid1D.js'\r\nimport Voronoi1D from './Voronoi1D.js'\r\n\r\n/**\r\n * Show votes\r\n * @param {Screen} screen\r\n * @constructor\r\n */\r\nexport default function VizOne1D(oneVoters, candidateSimList, screen, sim) {\r\n    const self = this\r\n\r\n    let voronoiGroups = []\r\n    let grid1Ds = []\r\n\r\n    self.update = function (votes) {\r\n        const voterShapes = oneVoters.getVoterShapes()\r\n        if (sim.election.countVotes.caster === 'castPlurality') {\r\n            voronoiGroups = voterShapes.map(\r\n                (voterShape) => new Voronoi1D(voterShape, candidateSimList, screen),\r\n            )\r\n        } else { // \"score\"\r\n            grid1Ds = []\r\n            for (let i = 0; i < votes.gridData.length; i++) {\r\n                const vo = votes.gridData[i]\r\n\r\n                const grid1D = new Grid1D(vo, candidateSimList, screen)\r\n                grid1Ds.push(grid1D)\r\n            }\r\n        }\r\n    }\r\n\r\n    self.render = function () {\r\n        if (sim.election.countVotes.caster === 'castPlurality') {\r\n            voronoiGroups.forEach(\r\n                (voronoiGroup) => voronoiGroup.render(),\r\n            )\r\n        } else { // \"score\"\r\n            grid1Ds.forEach(\r\n                (grid1D) => grid1D.renderBackground(),\r\n            )\r\n            grid1Ds.forEach(\r\n                (grid1D) => grid1D.render(),\r\n            )\r\n        }\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport CandidateSim from '../../candidates/CandidateSim.js'\r\nimport CandidateSimList from '../../candidates/CandidateSimList.js'\r\nimport VoterSimList from '../../voters/VoterSimList.js'\r\nimport SimBase from './SimBase.js'\r\nimport VoterSim from '../../voters/VoterSim.js'\r\nimport VizOne1D from '../../viz/VizOne1D.js'\r\n\r\n/**\r\n * Simulate one election with\r\n *   candidates in defined positions, and\r\n *   voters in a distribution that will be summed over.\r\n * Plan:\r\n * * SimOne1D is a subclass of SimBase.\r\n * * VizOne1D is a subclass of VoterSim.\r\n * * Voronoi1D is called by VizOne1D.\r\n * @param {Screen} screen\r\n * @param {Menu} menu\r\n * @param {Changes} changes\r\n * @param {Election} election\r\n * @param {Sim} sim\r\n * @constructor\r\n */\r\nexport default function SimOne1D(screen, menu, changes, electionOne, sim) {\r\n    const self = this\r\n\r\n    SimBase.call(self, screen, changes, sim)\r\n\r\n    const oneVoters = new VoterSimList(sim)\r\n\r\n    const candidateSimList = new CandidateSimList(sim)\r\n\r\n    self.addSimCandidate = (candidate) => {\r\n        candidateSimList.newCandidate(new CandidateSim(candidate, self.dragm))\r\n    }\r\n\r\n    self.addSimVoterCircle = (voterShape) => {\r\n        oneVoters.newVoterSim(new VoterSim(voterShape, self.dragm, screen))\r\n    }\r\n\r\n    const vizOne1D = new VizOne1D(oneVoters, candidateSimList, screen, sim)\r\n\r\n    const superEnter = self.enter\r\n    self.enter = () => {\r\n        superEnter()\r\n        sim.candidateAdd.canButton.show()\r\n        sim.election.setDimensions(1)\r\n        oneVoters.updateXY()\r\n        candidateSimList.updateXY()\r\n        sim.voterTest.updateXY()\r\n    }\r\n\r\n    self.exit = () => {\r\n        sim.candidateAdd.canButton.hide()\r\n        sim.voterTest.setE(0)\r\n    }\r\n\r\n    self.update = () => {\r\n        if (changes.checkNone()) return\r\n        // clear changes, reset to []\r\n        changes.clear()\r\n        const votes = electionOne.updateTallies(oneVoters, candidateSimList)\r\n        vizOne1D.update(votes)\r\n        sim.voterTest.update()\r\n        screen.clear()\r\n        self.render()\r\n    }\r\n\r\n    self.testVote = () => electionOne.testVote(sim.voterTest, candidateSimList)\r\n\r\n    self.render = () => {\r\n        vizOne1D.render()\r\n    }\r\n    self.renderForeground = () => {\r\n        // electionSample.renderForeground()\r\n        oneVoters.renderForeground()\r\n        candidateSimList.renderForeground()\r\n        sim.voterTest.renderForeground()\r\n    }\r\n}\r\n","import tooltipBox from './tooltipBox.js'\r\n\r\nexport default function tooltipForTestVoter(entity, screen, vote) {\r\n    // make a html box appear\r\n\r\n    const tbox = tooltipBox(entity, screen)\r\n    const { box, setPin } = tbox\r\n\r\n    box.innerText = '- Test Vote - '\r\n\r\n    const button = document.createElement('button')\r\n    button.className = 'button2'\r\n    button.innerText = 'Pin'\r\n\r\n    button.onclick = () => {\r\n        togglePin()\r\n    }\r\n    box.appendChild(button)\r\n    let pinned = false\r\n    function togglePin() {\r\n        pinned = !pinned\r\n        setPin(pinned)\r\n        button.innerText = (pinned) ? 'Pinned' : 'Pin'\r\n    }\r\n\r\n    const button2 = document.createElement('button')\r\n    button2.className = 'button2'\r\n    button2.innerText = 'X'\r\n    button2.onclick = () => {\r\n        box.remove()\r\n        entity.setE(0)\r\n    }\r\n    box.appendChild(button2)\r\n\r\n    box.style.backgroundColor = vote.color\r\n    // box.style['pointer-events'] = 'none'\r\n    screen.tooltips.appendChild(box)\r\n\r\n    function update(newVote) {\r\n        box.style.backgroundColor = newVote.color\r\n        tbox.update()\r\n    }\r\n\r\n    return { box, update }\r\n}\r\n","import CircleGraphic from './CircleGraphic.js'\r\nimport hideOnClickOutside from '../tooltips/hideOnClickOutside.js'\r\nimport tooltipForTestVoter from '../tooltips/tooltipForTestVoter.js'\r\n\r\nexport default function VoterTest(screen, sims, sim) {\r\n    const self = this\r\n\r\n    // Position\r\n\r\n    self.shape1 = {}\r\n    self.shape2 = {}\r\n\r\n    self.setAction = {}\r\n    self.setAction.exists = (e) => {\r\n        self.exists = e\r\n    }\r\n    self.setE = (e) => {\r\n        self.setAction.exists(e)\r\n    }\r\n\r\n    self.setAction.shape2p = (p) => {\r\n        self.shape2.x = p.x\r\n        self.shape2.y = p.y\r\n        if (sim.election.dimensions === 2) {\r\n            self.x = p.x\r\n            self.y = p.y\r\n        }\r\n    }\r\n    self.setAction.shape1x = (p) => {\r\n        self.shape1.x = p\r\n        if (sim.election.dimensions === 1) {\r\n            self.x = p\r\n            self.y = 250\r\n        }\r\n    }\r\n    self.setXY = (p) => {\r\n        if (sim.election.dimensions === 1) {\r\n            self.setAction.shape1x(p.x)\r\n        } else {\r\n            self.setAction.shape2p(p)\r\n        }\r\n        self.update()\r\n    }\r\n    /** Do this when entering a state because x and y change. */\r\n    self.updateXY = () => {\r\n        if (sim.election.dimensions === 1) {\r\n            self.setAction.shape1x(self.shape1.x)\r\n        } else {\r\n            self.setAction.shape2p({ x: self.shape2.x, y: self.shape2.y })\r\n        }\r\n    }\r\n\r\n    // Initialize\r\n\r\n    self.setAction.shape1x(0)\r\n    self.setAction.shape2p({ x: 0, y: 0 })\r\n\r\n    // Start displaying testvoter\r\n    self.start = (p) => {\r\n        sim.voterTest.setE(1)\r\n        sim.voterTest.setXY(p)\r\n        hideOnClickOutside(screen.wrap, removeTestPoint)\r\n    }\r\n    function removeTestPoint() {\r\n        sim.voterTest.setE(0)\r\n    }\r\n\r\n    // Dragging\r\n\r\n    self.color = '#999'\r\n    const circle = new CircleGraphic(self, 9, screen)\r\n    self.circle = circle\r\n\r\n    sims.one2D.dragm.newCircleHandle(self, self.circle)\r\n    sims.one1D.dragm.newCircleHandle(self, self.circle)\r\n    sims.geoOne.dragm.newCircleHandle(self, self.circle)\r\n    sims.sample.dragm.newCircleHandle(self, self.circle)\r\n\r\n    // Rendering\r\n\r\n    let tooltip = {}\r\n\r\n    self.update = () => {\r\n        // who would this test point vote for?\r\n        const vote = sim.testVote()\r\n        if (vote === undefined) return null\r\n\r\n        self.color = vote.color\r\n\r\n        if (tooltip.box) {\r\n            tooltip.update(vote)\r\n        }\r\n\r\n        return vote\r\n    }\r\n\r\n    self.click = () => {\r\n        const vote = self.update()\r\n        if (tooltip.box) tooltip.box.remove()\r\n        tooltip = tooltipForTestVoter(self, screen, vote)\r\n    }\r\n\r\n    self.renderForeground = () => {\r\n        // handle\r\n        if (self.exists || sim.showGhosts) {\r\n            circle.render()\r\n        }\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport colorBlend from './colorBlend.js'\r\n\r\n/**\r\n * A simple election.\r\n * Voters are in shaped distributions.\r\n * @param {Screen} screen\r\n * @param {Menu} menu\r\n * @param {Election} election\r\n * @constructor\r\n */\r\nexport default function ElectionOne(election) {\r\n    const self = this\r\n\r\n    const optionCast = { usr: 4 }\r\n\r\n    self.updateTallies = function (oneVoters, candidates) {\r\n        // only update the tallies for each candidate so they can be shown\r\n\r\n        // Voters cast votes for candidates.\r\n        // There is also a separate graphical representation in Voronoi2D.js\r\n\r\n        if (oneVoters.getVoterShapes().length === 0) return { error: 'No Voters' }\r\n        if (candidates.getCandidates().length === 0) return { error: 'No Candidates' }\r\n        const votes = election.castVotes(oneVoters, candidates, optionCast)\r\n        candidates.setCandidateFractions(votes.tallyFractions)\r\n        return votes\r\n    }\r\n\r\n    self.testVote = (voterTest, candidates) => {\r\n        const vote = election.testVote(voterTest, candidates)\r\n\r\n        const cans = candidates.getCandidates()\r\n        const colorSet = cans.map((can) => can.color)\r\n\r\n        const { tallyFractions } = vote\r\n        const color = colorBlend(tallyFractions, colorSet)\r\n\r\n        vote.color = color\r\n        return vote\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Simulate winners from many sampled elections.\r\n * Candidates are sampled from a distribution.\r\n * Winners are drawn as points.\r\n * The simulation is dynamic. More simulations are performed at each frame.\r\n * @param {Screen} screen\r\n * @param {Menu} menu\r\n * @param {Election} election\r\n * @constructor\r\n */\r\nexport default function ElectionSample(election) {\r\n    const self = this\r\n\r\n    const optionCast = { usr: 16 }\r\n\r\n    const maxPoints = 5000\r\n\r\n    let points = []\r\n\r\n    self.startSim = function () {\r\n        points = []\r\n    }\r\n\r\n    self.addSim = function (sampleVoters, sampleCandidates) {\r\n        // add more points\r\n\r\n        if (sampleVoters.getVoterShapes().length === 0) return { noChange: 1 }\r\n        if (sampleCandidates.getCandidateDistributions().length === 0) return { noChange: 1 }\r\n\r\n        if (points.length > maxPoints) return { noChange: 1 }\r\n        // this limit right now is about graphics rendering.\r\n        // todo: render to a buffer\r\n\r\n        // number of sample elections\r\n        const ns = 20\r\n\r\n        // number of new points\r\n        const { seats } = election.countVotes\r\n        const nnp = seats * ns\r\n        const newPoints = Array(nnp)\r\n\r\n        const voterShapes = sampleVoters.getVoterShapes()\r\n\r\n        for (let i = 0; i < ns; i++) {\r\n            // choose a number of candidates\r\n            let nk\r\n            if (election.countVotes.checkElectionType() === 'singleWinner') {\r\n                nk = 5\r\n            } else if (election.countVotes.checkElectionType() === 'allocation') {\r\n                nk = 10\r\n            }\r\n            const canList = []\r\n            for (let k = 0; k < nk; k++) {\r\n                // sample a point from the distribution of candidates\r\n                const point = sampleCandidates.sampler.samplePoint()\r\n\r\n                // make a candidate\r\n                canList.push({ shape2: point })\r\n            }\r\n\r\n            // find winner position\r\n            const electionResults = election.runElection(voterShapes, canList, optionCast)\r\n\r\n            if (election.countVotes.checkElectionType() === 'singleWinner') {\r\n                const { winner } = electionResults\r\n\r\n                // record point\r\n                const winPoint = winner.shape2\r\n                points.push(winPoint)\r\n                newPoints[i] = winPoint\r\n            } else {\r\n                const { allocation } = electionResults\r\n\r\n                const jitterSize = 10\r\n                let q = 0\r\n                for (let k = 0; k < canList.length; k++) {\r\n                    const can = canList[k]\r\n                    const numPoints = allocation[k]\r\n                    for (let m = 0; m < numPoints; m++) {\r\n                        let winPoint\r\n                        if (m === 0) {\r\n                            // record point\r\n                            winPoint = can.shape2\r\n                        } else {\r\n                            // add jitter\r\n                            winPoint = {\r\n                                x: can.shape2.x + (Math.random() - 0.5) * jitterSize,\r\n                                y: can.shape2.y + (Math.random() - 0.5) * jitterSize,\r\n                            }\r\n                        }\r\n                        // record point\r\n                        points.push(winPoint)\r\n                        newPoints[i * seats + q] = winPoint\r\n                        q += 1\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return { noChange: 0, newPoints, points }\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport colorBlend, { toRGBA } from './colorBlend.js'\r\n\r\n/**\r\n * An election with many districts.\r\n * Voters are from many groups.\r\n * Voter groups are centered around a point.\r\n * The point is moved by simplex noise to create distinct districts.\r\n * All the voter groups share the same voter basis.\r\n * @param {Menu} menu\r\n * @param {Election} election\r\n * @constructor\r\n */\r\nexport default function ElectionGeo(election) {\r\n    const self = this\r\n\r\n    const optionCast = { usr: 32 }\r\n\r\n    self.updateVotes = (voterGeoList, candidateSimList) => {\r\n        const cans = candidateSimList.getCandidates()\r\n\r\n        if (voterGeoList.getVoterSims().length === 0) return { error: 'no voters' }\r\n        if (cans.length === 0) return { error: 'no candidates' }\r\n\r\n        const resultsStatewide = runStatewideElection(voterGeoList, cans)\r\n\r\n        const resultsByTract = runTractElections(voterGeoList, cans)\r\n        const colorByTract = colorTracts(resultsByTract, cans)\r\n\r\n        const resultsByDistrict = runDistrictElections(voterGeoList, cans)\r\n        const colorOfWinsByDistrict = colorDistrictWins(resultsByDistrict, cans)\r\n        const colorOfVoteByDistrict = colorDistrictVote(resultsByDistrict, cans)\r\n        const winsByDistrict = updateWins(resultsByDistrict, cans)\r\n\r\n        candidateSimList.setCandidateWins(winsByDistrict)\r\n        candidateSimList.setCandidateFractions(resultsStatewide.votes.tallyFractions)\r\n\r\n        return {\r\n            resultsStatewide,\r\n            resultsByTract,\r\n            colorByTract,\r\n            resultsByDistrict,\r\n            colorOfVoteByDistrict,\r\n            winsByDistrict,\r\n            colorOfWinsByDistrict,\r\n        }\r\n    }\r\n\r\n    /** Show tallies over all the districts\r\n     * Find statewide support for candidates (parties).\r\n     */\r\n    function runStatewideElection(voterGeoList, cans) {\r\n        const { allVoterGroups } = voterGeoList\r\n        const resultsStatewide = election.runElection(allVoterGroups, cans, optionCast)\r\n        return resultsStatewide\r\n    }\r\n\r\n    /** Visualize voter demographics according to votes for candidates within a voterGroup.\r\n     * Hold mini-elections within a voterGroup.\r\n     */\r\n    function runTractElections(voterGeoList, cans) {\r\n        const { voterGroupsByTract } = voterGeoList\r\n\r\n        const resultsByTract = voterGroupsByTract.map(\r\n            (row) => row.map(\r\n                (voterShapes) => election.runElection(voterShapes, cans, optionCast),\r\n            ),\r\n        )\r\n        return resultsByTract\r\n    }\r\n\r\n    function colorTracts(resultsByTract, cans) {\r\n        // get color\r\n        const colorSet = cans.map((can) => can.color)\r\n        const colorByTract = resultsByTract.map(\r\n            (row) => row.map(\r\n                (electionResults) => {\r\n                    const { tallyFractions } = electionResults.votes\r\n                    const color = toRGBA(colorBlend(tallyFractions, colorSet))\r\n                    return color\r\n                },\r\n            ),\r\n        )\r\n        return colorByTract\r\n    }\r\n\r\n    /** Run separate elections in each district. */\r\n    function runDistrictElections(voterGeoList, cans) {\r\n        // Loop through districts.\r\n        // Find who won.\r\n\r\n        const { voterGroupsByDistrict } = voterGeoList\r\n\r\n        const resultsByDistrict = voterGroupsByDistrict.map(\r\n            (voterShapes) => election.runElection(voterShapes, cans, optionCast),\r\n        )\r\n        return resultsByDistrict\r\n    }\r\n    function colorDistrictWins(resultsByDistrict, cans) {\r\n        // calculate color for win map\r\n        let colorOfWinsByDistrict\r\n        if (election.countVotes.checkElectionType() === 'singleWinner') {\r\n            colorOfWinsByDistrict = resultsByDistrict.map(\r\n                (electionResults) => electionResults.winner.color,\r\n            )\r\n        } else {\r\n            const colorSet = cans.map((can) => can.color)\r\n            colorOfWinsByDistrict = resultsByDistrict.map(\r\n                (electionResults) => {\r\n                    const { allocation } = electionResults\r\n                    const sum = allocation.reduce((p, c) => p + c)\r\n                    const fractions = allocation.map((x) => x / sum)\r\n                    const color = colorBlend(fractions, colorSet)\r\n                    return color\r\n                },\r\n            )\r\n        }\r\n        return colorOfWinsByDistrict\r\n    }\r\n\r\n    // Show wins across all districts for each candidate\r\n    function updateWins(resultsByDistrict, cans) {\r\n        // make a histogram of winsByDistrict\r\n        const numCandidates = cans.length\r\n        const winsByDistrict = Array(numCandidates).fill(0)\r\n        if (election.countVotes.checkElectionType() === 'singleWinner') {\r\n            const iWinners = resultsByDistrict.map((electionResults) => electionResults.iWinner)\r\n            iWinners.forEach((iWinner) => {\r\n                winsByDistrict[iWinner] += 1\r\n            })\r\n        } else {\r\n            resultsByDistrict.forEach(\r\n                (electionResults) => {\r\n                    const { allocation } = electionResults\r\n                    for (let i = 0; i < numCandidates; i++) {\r\n                        winsByDistrict[i] += allocation[i]\r\n                    }\r\n                },\r\n            )\r\n        }\r\n        return winsByDistrict\r\n    }\r\n\r\n    /** Update color for each district, based on votes for each candidate.\r\n     * Blend candidate colors in proportion to their votes.\r\n     */\r\n    function colorDistrictVote(resultsByDistrict, cans) {\r\n        const colorOfVoteByDistrict = resultsByDistrict.map((electionResults) => {\r\n            const { tallyFractions } = electionResults.votes\r\n            const colorSet = cans.map((can) => can.color)\r\n            const color = colorBlend(tallyFractions, colorSet)\r\n            return color\r\n        })\r\n        return colorOfVoteByDistrict\r\n    }\r\n\r\n    self.testVote = (voterTest, candidateSimList) => {\r\n        const vote = election.testVote(voterTest, candidateSimList)\r\n        const i = vote.tallyFractions.indexOf(1)\r\n        const cans = candidateSimList.getCandidates()\r\n        vote.color = cans[i].color\r\n        return vote\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Sum area of voter distributions to tally the votes.\r\n * @param {Candidate[]} cans\r\n * @constructor\r\n */\r\nexport default function AreaSummer(cans) {\r\n    const self = this\r\n\r\n    const lines = findLines(cans)\r\n\r\n    // todo: figure out if this is really just a function rather than a class.\r\n\r\n    self.sumArea = function sumArea(voterGeom) {\r\n        // draw lines across shape of voterGeom\r\n\r\n        const n = lines.length\r\n        const area = Array(n)\r\n        for (let i = 0; i < n; i++) {\r\n            const lineSet = lines[i]\r\n            // return area for each candidate\r\n            area[i] = sumCircle(voterGeom, lineSet)\r\n        }\r\n        return area\r\n    }\r\n}\r\n\r\nfunction findLines(cans) {\r\n    // find all lines\r\n    const n = cans.length\r\n    const lines = new Array(n) // each candidate has a set of lines for themselves\r\n    for (let i = 0; i < n; i++) {\r\n        lines[i] = []\r\n        for (let k = 0; k < n; k++) {\r\n            // skip sames\r\n            if (i === k) continue\r\n            // find equation for a line\r\n            const c1 = cans[i]\r\n            const c2 = cans[k]\r\n            // lines[i][k] = equidistantLine(c1,c2) // problem when i === k\r\n            lines[i].push(equidistantLine(c1, c2))\r\n        }\r\n    }\r\n\r\n    return lines\r\n}\r\n\r\n/**\r\n * Test for the function equidistantLine, which finds a line equidistant from two points.\r\n * @param {Function} eq - assertion function for equality\r\n * @param {Function} assert - assertion function for true\r\n * @returns {Object[]} an array of test objects, each with a label and a test function.\r\n */\r\nexport function testEquidistantLine(eq, assert) {\r\n    // Takes an assertion function.\r\n    // Returns a test function.\r\n\r\n    return [{\r\n        label: 'Finds line equation equidistant from two points.',\r\n        test: () => {\r\n            const m = equidistantLine({ x: 0, y: 0 }, { x: 1, y: 1 })\r\n            const e = { A: { x: 1, y: 1 }, b: 1 }\r\n            eq(e.A.x / e.b, m.A.x / m.b)\r\n            eq(e.A.y / e.b, m.A.y / m.b)\r\n        },\r\n    }, {\r\n        label: 'The first point satisfies Ac < b. A[0,0] < b. ',\r\n        test: () => {\r\n            const m = equidistantLine({ x: 0, y: 0 }, { x: 1, y: 1 })\r\n            assert(m.b > 0)\r\n        },\r\n    },\r\n    ]\r\n}\r\n\r\nfunction equidistantLine(c1, c2) {\r\n    // Ac < b\r\n    // this is the condition that x counts for a candidate.\r\n\r\n    // line equidistant from two points\r\n    // https://math.stackexchange.com/a/771773\r\n\r\n    // difference between points\r\n    const dx = c2.x - c1.x\r\n    const dy = c2.y - c1.y\r\n\r\n    // midpoint between points\r\n    const mx = (c1.x + c2.x) * 0.5\r\n    const my = (c1.y + c2.y) * 0.5\r\n\r\n    // equation for line\r\n    // (y-my) / (x-mx) = - dx / dy\r\n    // implies y * dy - my * dy = - x * dx + mx * dx\r\n    // implies dx * x + dy * y = mx * dx + my * dy\r\n    // rename to A = [dx;dy]\r\n    //           b = mx * dx + my * dy\r\n    const A = { x: dx, y: dy }\r\n    const b = mx * dx + my * dy\r\n\r\n    // is c1 or c2 closer?\r\n    // c1 is closer is equivalent to Ac < b\r\n\r\n    return { A, b }\r\n}\r\n\r\nfunction sumCircle(circle, lineSet) {\r\n    // integrate inside\r\n    //   Need a direction for \"inside\" for each line.\r\n    //   Then do a 1D consideration of what is inside.\r\n\r\n    // for each x coordinate,\r\n    const dx = 2\r\n    let sum = 0\r\n    const x1 = circle.x\r\n    const y1 = circle.y\r\n    const { w } = circle\r\n    const r = 0.5 * w\r\n    // x only goes from x1-r to x1+r\r\n    for (let x = x1 - r; x < x1 + r; x += dx) {\r\n        // find bounds\r\n\r\n        // find equation for circle\r\n\r\n        // (y - y1)**2 + (x-x1)**2 < r**2\r\n        const diff2 = r ** 2 - (x - x1) ** 2\r\n        let half\r\n        if (diff2 > 0) {\r\n            half = Math.sqrt(diff2)\r\n        } else {\r\n            half = 0\r\n        }\r\n        let high = y1 + half\r\n        let low = y1 - half\r\n\r\n        // for each of the constraints, figure out if it is an upper or lower bound,\r\n        // then adjust the bound.\r\n        // The y coefficient tells us whether this is an upper or lower bound.\r\n        // Imagine infinite +y.\r\n        // If the y coefficient is negative, then Ac < b, and Ac = b is a lower bound.\r\n        // A.x * x + A.y * y = b\r\n        // y = (b - A.x * x) / A.y\r\n        for (let i = 0; i < lineSet.length; i++) {\r\n            const line = lineSet[i]\r\n            const ay = line.A.y\r\n            const ax = line.A.x\r\n            const { b } = line\r\n            if (ay === 0) {\r\n                if (ax * x < b) {\r\n                    // no bounds\r\n                } else {\r\n                    low = Infinity // bounded by x\r\n                }\r\n                // not handling 0,0 case\r\n            } else {\r\n                const y2 = (b - ax * x) / ay\r\n                if (ay < 0) {\r\n                    low = Math.max(low, y2)\r\n                } else {\r\n                    high = Math.min(high, y2)\r\n                }\r\n            }\r\n        }\r\n\r\n        // count area inside lines\r\n        const dy = high - low\r\n        if (dy > 0) {\r\n            const area = dy * dx\r\n            sum += area\r\n        }\r\n    }\r\n    return sum\r\n}\r\n","/** @module */\r\n\r\nimport { range, normCDF } from '../utilities/jsHelpers.js'\r\n\r\n/**\r\n * Sum area of voter distributions to tally the votes.\r\n * @param {Object[]} cans - position of each candidate {x}\r\n * @constructor\r\n */\r\nexport default function LineSummer(cans) {\r\n    const self = this\r\n\r\n    const intervals = findIntervals(cans)\r\n\r\n    self.sumArea = function sumArea(voterGeom) {\r\n        const n = cans.length\r\n        const area = Array(n)\r\n        // return sum for each candidate\r\n        if (voterGeom.densityProfile === 'gaussian') {\r\n            for (let i = 0; i < n; i++) {\r\n                area[i] = sumGaussian(voterGeom, intervals[i])\r\n            }\r\n        } else {\r\n            for (let i = 0; i < n; i++) {\r\n                area[i] = sumBlock(voterGeom, intervals[i])\r\n            }\r\n        }\r\n        return area\r\n    }\r\n}\r\n\r\n/** Find boundary between candidates */\r\nfunction findIntervals(cans) {\r\n    const n = cans.length\r\n    const iSorted = range(n).sort((a, b) => cans[a].x - cans[b].x)\r\n    const midpoints = new Array(n - 1)\r\n    for (let i = 0; i < n - 1; i++) {\r\n        midpoints[i] = (cans[iSorted[i]].x + cans[iSorted[i + 1]].x) * 0.5\r\n    }\r\n    const intervals = new Array(n)\r\n    for (let i = 0; i < n; i++) {\r\n        const lower = (i === 0) ? -Infinity : midpoints[i - 1]\r\n        const upper = (i === n - 1) ? Infinity : midpoints[i]\r\n        intervals[iSorted[i]] = { lower, upper }\r\n    }\r\n\r\n    return intervals\r\n}\r\n\r\nfunction sumBlock(block, interval) {\r\n    const { lower, upper } = interval\r\n    const { x, w } = block\r\n    const r = 0.5 * w\r\n    const lower2 = x - r\r\n    const upper2 = x + r\r\n    const lower3 = Math.max(lower, lower2)\r\n    const upper3 = Math.min(upper, upper2)\r\n    const sum = Math.max(0, upper3 - lower3)\r\n    return sum\r\n}\r\n\r\nfunction sumGaussian(block, interval) {\r\n    const { lower, upper } = interval\r\n    const { x, w } = block\r\n    const center = x\r\n    const sigma = w / Math.sqrt(2 * Math.PI) // w = sigma * sqrt(2*pi)\r\n    // evaluate integral of gaussian on interval\r\n    const sum = w * normCDF(upper, center, sigma) - w * normCDF(lower, center, sigma)\r\n\r\n    return sum\r\n}\r\n","import { minIndex } from '../utilities/jsHelpers.js'\r\n\r\n/**\r\n * Vote for the closest candidate.\r\n * @param {Objects[]} candidates - For 2D, an array of objects: {x,y}.\r\n * For 1D, an array of objects: {x}.\r\n * @param {*} voterGeom\r\n * @param {*} dimensions\r\n */\r\nexport default function castPluralityTestVote(candidates, voterGeom, dimensions) {\r\n    const df = (dimensions === 1) ? df1 : df2\r\n    const dist2 = candidates.map((c) => df(c, voterGeom))\r\n    const i = minIndex(dist2)\r\n    const n = candidates.length\r\n    const tally = (new Array(n)).fill(0)\r\n    tally[i] = 1\r\n    return tally\r\n}\r\nfunction df1(a, b) {\r\n    return (a.x - b.x) ** 2\r\n}\r\nfunction df2(a, b) {\r\n    return (a.x - b.x) ** 2 + (a.y - b.y) ** 2\r\n}\r\n","import { minMax } from '../utilities/jsHelpers.js'\r\n\r\n/**\r\n * Vote for the closest candidate.\r\n * @param {Objects[]} candidates - For 2D, an array of objects: {x,y}.\r\n * For 1D, an array of objects: {x}.\r\n * @param {*} voter\r\n * @param {*} dimensions\r\n */\r\nexport default function castScoreTestVote(candidates, voterGeom, dimensions) {\r\n    const lc = candidates.length\r\n    const tally = (new Array(lc)).fill(0)\r\n    const df = (dimensions === 1) ? df1 : df2\r\n\r\n    // in the current implementation, all candidates are frontrunners\r\n    const dist = candidates.map((c) => df(c, voterGeom))\r\n    const [min, max] = minMax(dist)\r\n    const maxscore = 1\r\n    const minscore = 0\r\n    for (let i = 0; i < lc; i++) {\r\n        const d = dist[i]\r\n        if (d <= min) {\r\n            tally[i] = maxscore\r\n        } else if (d >= max) {\r\n            // in the case that the voter likes the frontrunner candidates equally,\r\n            // he just votes for everyone better\r\n            tally[i] = minscore\r\n        } else { // putting this last avoids max==min giving division by 0\r\n            const frac = (d - min) / (max - min)\r\n            // tally[i] = Math.floor(0.5 + minscore + (maxscore - minscore) * (1 - frac))\r\n            tally[i] = minscore + (maxscore - minscore) * (1 - frac)\r\n        }\r\n    }\r\n    return tally\r\n}\r\nfunction df1(a, b) {\r\n    return Math.abs(a.x - b.x)\r\n}\r\nfunction df2(a, b) {\r\n    return Math.sqrt((a.x - b.x) ** 2 + (a.y - b.y) ** 2)\r\n}\r\n","/** @module */\r\n\r\nimport { normPDF, range } from '../utilities/jsHelpers.js'\r\nimport castScoreTestVote from './castScoreTestVote.js'\r\n\r\n/**\r\n * Sum area of voter distributions to tally the votes.\r\n * @param {Candidate[]} cans\r\n * @constructor\r\n */\r\nexport default function CastScoreAreaSummer(cans, optionCast) {\r\n    const self = this\r\n\r\n    self.sumArea = function sumArea(voterGeom) {\r\n        // just find the vote at each grid point and weight according to type\r\n        const grid = makeGrid(voterGeom, optionCast)\r\n\r\n        const n = cans.length\r\n        const area = Array(n).fill(0)\r\n        let totalArea = 0\r\n\r\n        // find vote\r\n        const gridLength = grid.x.length\r\n        const voteSet = Array(gridLength)\r\n        for (let i = 0; i < gridLength; i++) {\r\n            const weight = grid.weight[i]\r\n            // if (weight === 0) continue\r\n            const xi = grid.x[i]\r\n            const yi = grid.y[i]\r\n            const testVoter = { x: xi, y: yi }\r\n            const tallyFractions = castScoreTestVote(cans, testVoter, 2)\r\n            voteSet[i] = { tallyFractions }\r\n            totalArea += weight\r\n            for (let k = 0; k < n; k++) {\r\n                area[k] += tallyFractions[k] * weight\r\n            }\r\n        }\r\n        return {\r\n            grid, voteSet, area, totalArea,\r\n        }\r\n    }\r\n}\r\n\r\nfunction makeGrid(voterGeom, optionCast) {\r\n    const isGauss = voterGeom.densityProfile === 'gaussian'\r\n    const spread = (isGauss) ? 3 : 1\r\n    const { x, y, w } = voterGeom\r\n\r\n    const width = w * spread\r\n    const { usr } = optionCast // undersampling ratio\r\n    const iWidth = Math.round(width / usr)\r\n\r\n    // TODO: sample from middle of square\r\n    const ixGrid = range(iWidth)\r\n    const iyGrid = range(iWidth)\r\n    const gridXMargin = ixGrid.map((i) => (i + 0.5) * usr - width * 0.5 + x)\r\n    const gridYMargin = iyGrid.map((i) => (i + 0.5) * usr - width * 0.5 + y)\r\n\r\n    const nx = ixGrid.length\r\n    const ny = iyGrid.length\r\n    const gridLength = nx * ny\r\n    const gridX = Array(gridLength)\r\n    const gridY = Array(gridLength)\r\n    const weight = Array(gridLength)\r\n    let i = 0\r\n    for (let iy = 0; iy < iyGrid.length; iy++) {\r\n        for (let ix = 0; ix < ixGrid.length; ix++) {\r\n            const gx = gridXMargin[ix]\r\n            const gy = gridYMargin[iy]\r\n            gridX[i] = gx\r\n            gridY[i] = gy\r\n            weight[i] = findWeight(voterGeom, gx, gy)\r\n            i += 1\r\n        }\r\n    }\r\n\r\n    const grid = {\r\n        x: gridX, y: gridY, weight, nx, ny,\r\n    }\r\n    return grid\r\n}\r\n\r\nfunction findWeight(voterGeom, gx, gy) {\r\n    // need to cut away circle\r\n\r\n    const isGauss = voterGeom.densityProfile === 'gaussian'\r\n\r\n    const { x, y, w } = voterGeom\r\n    if (!isGauss) {\r\n        const d2 = (gx - x) ** 2 + (gy - y) ** 2\r\n        const r2 = (0.5 * w) ** 2\r\n        // TODO: for edges, determine how much of the area of the pixel is within the shape.\r\n        if (d2 < r2) {\r\n            return 1\r\n        }\r\n        return 0\r\n\r\n        // const weight = (d2 < r2) ? 1 : 0\r\n        // return weight\r\n    }\r\n    // w = sigma * sqrt(2*pi)\r\n    const sigma = w / Math.sqrt(2 * Math.PI)\r\n    // TODO: is this pdf multiplication correct? Does sigma need to be modified?\r\n    const weight = w * normPDF(gx, x, sigma) * normPDF(gy, y, sigma)\r\n    return weight\r\n}\r\n","/** @module */\r\n\r\nimport { range, normPDF } from '../utilities/jsHelpers.js'\r\nimport castScoreTestVote from './castScoreTestVote.js'\r\n\r\n/**\r\n * Sum area of voter distributions to tally the votes.\r\n * @param {Object[]} cans - position of each candidate {x}\r\n * @constructor\r\n */\r\nexport default function CastScoreLineSummer(cans) {\r\n    const self = this\r\n\r\n    self.sumArea = function sumArea(voterGeom) {\r\n        // just find the vote at each grid point and weight according to type\r\n        const grid = makeGrid(voterGeom)\r\n\r\n        const n = cans.length\r\n        const area = Array(n).fill(0)\r\n        let totalArea = 0\r\n\r\n        // find vote\r\n        const gridLength = grid.x.length\r\n        const voteSet = Array(gridLength)\r\n        for (let i = 0; i < gridLength; i++) {\r\n            const xi = grid.x[i]\r\n            const testVoter = { x: xi }\r\n            const tallyFractions = castScoreTestVote(cans, testVoter, 1)\r\n            voteSet[i] = { tallyFractions }\r\n            const weight = findWeight(voterGeom, xi)\r\n            totalArea += weight\r\n            for (let k = 0; k < n; k++) {\r\n                area[k] += tallyFractions[k] * weight\r\n            }\r\n        }\r\n        return {\r\n            grid, voteSet, area, totalArea,\r\n        }\r\n    }\r\n}\r\n\r\nfunction makeGrid(voterGeom) {\r\n    const isGauss = voterGeom.densityProfile === 'gaussian'\r\n    const spread = (isGauss) ? 3 : 1\r\n    const { x, w } = voterGeom\r\n    const iWidth = Math.round(w * spread)\r\n    const iGrid = range(iWidth)\r\n    const gridX = iGrid.map((i) => i + 0.5 - iWidth * 0.5 + x)\r\n    const grid = { x: gridX }\r\n    return grid\r\n}\r\n\r\nfunction findWeight(voterGeom, xi) {\r\n    const isGauss = voterGeom.densityProfile === 'gaussian'\r\n    if (!isGauss) {\r\n        return 1\r\n    }\r\n    const { x, w } = voterGeom\r\n    const sigma = w / Math.sqrt(2 * Math.PI) // w = sigma * sqrt(2*pi)\r\n    const weight = w * normPDF(xi, x, sigma)\r\n    return weight\r\n}\r\n","/** @module */\r\n\r\nimport castPlurality from './castPlurality.js'\r\nimport castScore from './CastScore.js'\r\n\r\n/**\r\n * a collection of ways to cast votes\r\n */\r\n\r\nconst castVotes = { castPlurality, castScore }\r\n\r\nexport default castVotes\r\n","/** @module */\r\n\r\nimport CastPluralityAreaSummer from './CastPluralityAreaSummer.js'\r\nimport CastPluralityLineSummer from './CastPluralityLineSummer.js'\r\nimport castPluralityTestVote from './castPluralityTestVote.js'\r\n\r\n/**\r\n * Vote for one.\r\n * Voters cast votes for candidates.\r\n * There is also a separate graphical representation in Voronoi2D.js.\r\n * @param {Objects[]} candidates - For 2D, an array of objects: {x,y}.\r\n * For 1D, an array of objects: {x}.\r\n * @param {Objects[]} voterGeoms - For 2D, an array of objects: {x,y,w}.\r\n * For 1D, an array of objects: {x,w,densityProfile}.\r\n * @returns votes, an object\r\n */\r\nexport default function castPlurality(candidates, voterGeoms, dimensions, optionCast, isTestVoter) {\r\n    if (isTestVoter) {\r\n        const tallyFractions = castPluralityTestVote(candidates, voterGeoms[0], dimensions)\r\n        const votes = { tallyFractions }\r\n        return votes\r\n    }\r\n\r\n    const summer = (dimensions === 1)\r\n        ? new CastPluralityLineSummer(candidates)\r\n        : new CastPluralityAreaSummer(candidates)\r\n\r\n    // get fraction of votes for each candidate so we can summarize results\r\n    const n = candidates.length\r\n    let tally = (new Array(n)).fill(0)\r\n    voterGeoms.forEach((voterGeom) => {\r\n        const area = summer.sumArea(voterGeom)\r\n        const weight = ((voterGeom.weight === undefined) ? 1 : voterGeom.weight)\r\n        tally = tally.map((value, index) => value + area[index] * weight)\r\n    })\r\n    const total = tally.reduce((p, c) => p + c)\r\n    const tallyFractions = tally.map((x) => x / total)\r\n    const votes = { tallyFractions }\r\n    return votes\r\n}\r\n","/** @module */\r\n\r\nimport CastScoreAreaSummer from './CastScoreAreaSummer.js'\r\nimport CastScoreLineSummer from './CastScoreLineSummer.js'\r\nimport castScoreTestVote from './castScoreTestVote.js'\r\n\r\n// The main difference between this and plurality is we need to return a grid from here.\r\n// We also will return a set of votes from that grid.\r\n\r\n/**\r\n * Vote for one.\r\n * Voters cast votes for candidates.\r\n * There is also a separate graphical representation in VoronoiGroup.js.\r\n * @param {Objects[]} candidates - For 2D, an array of objects: {x,y}.\r\n * For 1D, an array of objects: {x}.\r\n * @param {Objects[]} voterShapes - For 2D, an array of objects: {x,y,w}.\r\n * For 1D, an array of objects: {x,w,densityProfile}.\r\n * @returns votes, an object\r\n */\r\nexport default function castScore(candidates, voterGeoms, dimensions, optionCast, isTestVoter) {\r\n    if (isTestVoter) {\r\n        const testVoter = voterGeoms[0]\r\n        const tallyFractions = castScoreTestVote(candidates, testVoter, dimensions)\r\n        const votes = { tallyFractions }\r\n        return votes\r\n    }\r\n\r\n    const summer = (dimensions === 1)\r\n        ? new CastScoreLineSummer(candidates)\r\n        : new CastScoreAreaSummer(candidates, optionCast)\r\n\r\n    // get fraction of votes for each candidate so we can summarize results\r\n    const n = candidates.length\r\n    let tally = (new Array(n)).fill(0)\r\n    let total = 0\r\n    const gridData = []\r\n    for (let i = 0; i < voterGeoms.length; i++) {\r\n        const voterGeom = voterGeoms[i]\r\n        const {\r\n            grid, voteSet, area, totalArea,\r\n        } = summer.sumArea(voterGeom)\r\n\r\n        const gridDataEntry = { grid, voteSet, voterGeom }\r\n        gridData.push(gridDataEntry)\r\n\r\n        const weight = ((voterGeom.weight === undefined) ? 1 : voterGeom.weight)\r\n        tally = tally.map((value, index) => value + area[index] * weight)\r\n        total += totalArea\r\n    }\r\n    const tallyFractions = tally.map((x) => x / total)\r\n    const votes = {\r\n        tallyFractions, gridData,\r\n    }\r\n    return votes\r\n}\r\n","/** @module */\r\n\r\nimport plurality from './plurality.js'\r\nimport randomWinner from './randomWinner.js'\r\nimport huntingtonHill from './huntingtonHill.js'\r\nimport score from './score.js'\r\n\r\n/** a collection of election methods\r\n *  */\r\nconst electionMethods = {\r\n    plurality, randomWinner, huntingtonHill, score,\r\n}\r\n\r\nexport default electionMethods\r\n","/** @module */\r\n\r\n/**\r\n * the candidate with the highest tally wins\r\n * @param {Object} votes\r\n * @param {Number[]} votes.tallyFractions\r\n * @returns {countResults}\r\n */\r\nexport default function plurality(votes) {\r\n    const max = Math.max(...votes.tallyFractions)\r\n    const iWinner = votes.tallyFractions.indexOf(max)\r\n\r\n    const countResults = { iWinner }\r\n    return countResults\r\n}\r\n/**\r\n * @typedef {Object} countResults\r\n * @property {Number} iWinner - Index of winner. Indexing according to votes[].\r\n */\r\n","/** @module */\r\n\r\n/**\r\n * pick a random candidate as the winner\r\n * @param {Object} votes\r\n * @param {Number} votes.tallyFractions.length - Number of candidates.\r\n * @returns {countResults}\r\n */\r\nexport default function randomWinner(votes) {\r\n    const nk = votes.tallyFractions.length\r\n    const iWinner = Math.floor(Math.random() * nk)\r\n    const countResults = { iWinner }\r\n    return countResults\r\n}\r\n/**\r\n * @typedef {Object} countResults\r\n * @property {Number} iWinner - Index of winner. Indexing according to votes[].\r\n */\r\n","/** @module */\r\n\r\n/**\r\n * Run the Huntington-Hill method of apportionment and return an allocation of seats.\r\n * @param {Object} votes\r\n * @param {number[]} votes.tallyFractions - tallies for each party as a fraction of 1.\r\n * @param {Object} electionMethodOptions\r\n * @param {number} electionMethodOptions.seats - The number of seats to fill.\r\n * @param {number} electionMethodOptions.threshold - The minimum fraction of voters\r\n * that a party needs to be eligible for a seat.\r\n * @returns {{allocation:number[]}} - countResults, with property allocation.\r\n * Allocation is an array of integers that say how many representatives each party gets.\r\n */\r\n\r\nexport default function huntingtonHill(votes, electionMethodOptions) {\r\n    const { seats, threshold } = electionMethodOptions\r\n\r\n    const populations = votes.tallyFractions.map(\r\n        (p) => ((p < threshold) ? 0 : p),\r\n    )\r\n\r\n    const nparties = populations.length\r\n\r\n    // When the threshold is 0, we have to give each party a seat.\r\n    if (threshold === 0 && nparties > seats) {\r\n        // sort parties by population\r\n        // sort decreasing\r\n        const populationsSorted = [...populations].sort(\r\n            (a, b) => b - a,\r\n        )\r\n        const minPopulation = populationsSorted[seats - 1]\r\n        const pops2 = votes.tallyFractions\r\n\r\n        // todo: consider ties\r\n        const allocation = pops2.map(\r\n            (p) => p >= minPopulation,\r\n        )\r\n        const countResults = { allocation }\r\n        return countResults\r\n    }\r\n\r\n    // make a list of break points / divisors, independent of vote totals\r\n    const divisorPattern = Array(seats).fill().map(\r\n        (_, i) => Math.sqrt((i) * (i + 1)),\r\n    )\r\n\r\n    // Scale the divisor pattern for each party.\r\n    // Call them signposts, like Balinski and Young.\r\n    // Ref: Balinski and Young 1982, pages 60-66, Chapter 7, Overview of Methods.\r\n    // Really, these are the divisors for each party.\r\n    // They are also a ratio of the representatives to the population\r\n    // except that the divisorPattern is used to substitute a slightly different number\r\n    // than the number of respresentatives.\r\n    const signposts = populations.map(\r\n        (p) => (p === 0 ? Infinity : divisorPattern.map((d) => d / p)),\r\n    ).flat()\r\n\r\n    // find last signpost to fill all seats\r\n    // sort increasing\r\n    const sortedSignposts = signposts.flat().sort(\r\n        (a, b) => a - b,\r\n    )\r\n\r\n    const lastSignpost = sortedSignposts[seats - 1]\r\n\r\n    // In the jargon:\r\n    //   Divide by populations by the divisors to get the quotients.\r\n    // Or, more clearly:\r\n    //   Count how many signposts each party has passed.\r\n\r\n    // lastSignpost = d/p\r\n    // d = p * lastSignpost\r\n    // sqrt(i*(i+1)) = d\r\n    // i=0 is one seat\r\n    // n = i + 1\r\n    // sqrt(n*(n-1)) = d\r\n    // n**2 - n = d**2\r\n    // n = (-b + sqrt(b-4ac) ) / 2a\r\n    // a = 1, b = -1, c = -d**2\r\n    // n = (1 + sqrt(1+4d**2) ) / 2\r\n    const quotients = populations.map(\r\n        (p) => ((p === 0) ? 0 : (1 + Math.sqrt(1 + 4 * (p * lastSignpost) ** 2)) * 0.5),\r\n    )\r\n    const allocation = quotients.map(\r\n        (p) => Math.floor(p),\r\n    )\r\n\r\n    // Todo: consider if there is a tie.\r\n    // Right now, we give extra seats to all the tied parties if there is a tie.\r\n    const countResults = { allocation }\r\n    return countResults\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * the candidate with the highest tally wins\r\n * @param {Object} votes\r\n * @param {Number[]} votes.tallyFractions\r\n * @returns {results}\r\n */\r\nexport default function score(votes) {\r\n    const max = Math.max(...votes.tallyFractions)\r\n    const iWinner = votes.tallyFractions.indexOf(max)\r\n\r\n    const results = { iWinner }\r\n    return results\r\n}\r\n/**\r\n * @typedef {Object} results\r\n * @property {Number} iWinner - Index of winner. Indexing according to votes[].\r\n */\r\n","/** @module */\r\n\r\nimport electionMethods from '../electionMethods/electionMethods.js'\r\n\r\n/**\r\n * Store settings and functions that deal with the election method.\r\n * The difference between CountVotes and Election is that\r\n * Election encompasses all concepts of an election such as casting a vote\r\n * or the number of dimensions,\r\n * while CountVotes just considers the votes and the result of counting.\r\n * Then CountVotes returns a summary of how the election went.\r\n * Perhaps CountingMethod is a more specific name.\r\n * @param {Candidate[]} candidates\r\n * @param {Menu} menu\r\n * @constructor\r\n */\r\nexport default function CountVotes(menu) {\r\n    const self = this\r\n\r\n    self.seats = 1\r\n\r\n    self.run = (candidates, votes) => {\r\n        // why have two different kinds of results?\r\n        // countResults, the smaller one,\r\n        //   is in the context of the election method,\r\n        //   which has tallies go in and analysis come out\r\n        // electionResults, the larger one,\r\n        //   is in the context of candidate objects and voter objects.\r\n        let electionResults\r\n        if (self.checkElectionType() === 'allocation') {\r\n            const electionMethodOptions = { seats: 5, threshold: 0.2 }\r\n            self.seats = electionMethodOptions.seats\r\n            const countResults = electionMethods[self.electionMethod](votes, electionMethodOptions)\r\n            const { allocation } = countResults\r\n            electionResults = { allocation, candidates, votes }\r\n        } else {\r\n            self.seats = 1\r\n            const countResults = electionMethods[self.electionMethod](votes)\r\n            const { iWinner } = countResults\r\n            const winner = candidates[iWinner]\r\n            electionResults = { iWinner, winner, votes }\r\n        }\r\n        return electionResults\r\n    }\r\n\r\n    // -- Menu --\r\n\r\n    // a list of election methods\r\n    self.electionMethodList = [\r\n        {\r\n            name: 'Huntington Hill', value: 'huntingtonHill', type: 'allocation', caster: 'castPlurality',\r\n        },\r\n        {\r\n            name: 'Plurality', value: 'plurality', type: 'singleWinner', caster: 'castPlurality',\r\n        },\r\n        {\r\n            name: 'Random Winner', value: 'randomWinner', type: 'singleWinner', caster: 'castPlurality',\r\n        },\r\n        {\r\n            name: 'Score', value: 'score', type: 'singleWinner', caster: 'castScore',\r\n        },\r\n    ]\r\n\r\n    // utilities for looking up this list\r\n    self.checkElectionType = () => self.electionMethodListByFunctionName[self.electionMethod].type\r\n    self.electionMethodListByFunctionName = []\r\n    self.electionMethodList.forEach(\r\n        (x) => { self.electionMethodListByFunctionName[x.value] = x },\r\n    )\r\n\r\n    /**\r\n     * Called in onclick.\r\n     * @param {(String|Number|Boolean)} value\r\n     */\r\n    self.setElectionMethod = (value) => {\r\n        self.electionMethod = value\r\n        self.caster = self.electionMethodListByFunctionName[value].caster\r\n    }\r\n\r\n    // add a menu item to switch between types of elections\r\n    self.setElectionMethod('plurality')\r\n\r\n    menu.addMenuItem(\r\n        self,\r\n        {\r\n            label: 'Election Method:',\r\n            prop: 'electionMethod',\r\n            setProp: self.setElectionMethod,\r\n            options: self.electionMethodList,\r\n            change: ['electionMethod'],\r\n        },\r\n    )\r\n}\r\n","/** @module */\r\n\r\nimport castVotes from '../castVotes/castVotes.js'\r\nimport CountVotes from './CountVotes.js'\r\n\r\n/**\r\n * Here we are in the context of a single election with voter objects and candidate objects.\r\n * @param {Menu} menu\r\n * @constructor\r\n */\r\nexport default function Election(menu) {\r\n    const self = this\r\n\r\n    self.countVotes = new CountVotes(menu)\r\n    self.dimensions = 1\r\n\r\n    self.setDimensions = (d) => { self.dimensions = d }\r\n\r\n    // Dimensions //\r\n\r\n    /** Get the correct geometry, depending on dimension. */\r\n    const mapVoters = (voterShapes) => {\r\n        if (self.dimensions === 1) {\r\n            return voterShapes.map((vg) => (vg.shape1))\r\n        }\r\n        return voterShapes.map((vg) => (vg.shape2))\r\n    }\r\n\r\n    /** Get the correct geometry, depending on dimension. */\r\n    const mapCans = (canList) => {\r\n        if (self.dimensions === 1) {\r\n            return canList.map((can) => (can.shape1))\r\n        }\r\n        return canList.map((can) => (can.shape2))\r\n    }\r\n\r\n    // Election //\r\n\r\n    self.runElection = function (voterShapes, canList, optionCast) {\r\n        const voterGeom = mapVoters(voterShapes)\r\n        const canGeom = mapCans(canList)\r\n        const casterFun = castVotes[self.countVotes.caster]\r\n        const votes = casterFun(canGeom, voterGeom, self.dimensions, optionCast)\r\n        const electionResults = self.countVotes.run(canList, votes)\r\n        return electionResults\r\n    }\r\n\r\n    // Voters cast votes for candidates.\r\n    // There is also a separate graphical representation in Voronoi2D.js\r\n    self.castVotes = (voters, candidates, optionCast) => {\r\n        const voterShapes = voters.getVoterShapes()\r\n        const canList = candidates.getCandidates()\r\n        const voterGeom = mapVoters(voterShapes)\r\n        const canGeom = mapCans(canList)\r\n        const casterFun = castVotes[self.countVotes.caster]\r\n        const votes = casterFun(canGeom, voterGeom, self.dimensions, optionCast)\r\n        return votes\r\n    }\r\n\r\n    self.testVote = (voterTest, candidates, optionCast) => {\r\n        const voterShapes = [voterTest]\r\n        const canList = candidates.getCandidates()\r\n        const voterGeom = mapVoters(voterShapes)\r\n        const canGeom = mapCans(canList)\r\n        const casterFun = castVotes[self.countVotes.caster]\r\n        const vote = casterFun(canGeom, voterGeom, self.dimensions, optionCast, true)\r\n        return vote\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport SimOne2D from './states/SimOne2D.js'\r\nimport SimSample from './states/SimSample.js'\r\nimport SimGeoOne from './states/SimGeoOne.js'\r\nimport VoterShapeAdd from '../voters/VoterShapeAdd.js'\r\nimport CandidateAdd from '../candidates/CandidateAdd.js'\r\nimport CandidateDnAdd from '../candidateDns/CandidateDnAdd.js'\r\nimport addSimControlsLabel from './addSimControlsLabel.js'\r\nimport SimOne1D from './states/SimOne1D.js'\r\nimport VoterTest from '../voters/VoterTest.js'\r\nimport ElectionOne from '../election/ElectionOne.js'\r\nimport ElectionSample from '../election/ElectionSample.js'\r\nimport ElectionGeo from '../election/ElectionGeo.js'\r\nimport Election from '../election/Election.js'\r\n\r\n/**\r\n * Simulation is the main task we're trying to accomplish in this program.\r\n * There are multiple states that the sim can be in.\r\n * Each state simulates something different.\r\n * Each state has initialization, update, and render procedures.\r\n * This is a state machine.\r\n * @param {Screen} screen\r\n * @param {Menu} menu\r\n * @param {Changes} changes\r\n * @param {Commander} commander\r\n *\r\n * @constructor\r\n */\r\nexport default function Sim(\r\n    screen,\r\n    menu,\r\n    changes,\r\n    commander,\r\n    layout,\r\n) {\r\n    const self = this\r\n\r\n    // Components //\r\n\r\n    const election = new Election(menu)\r\n    const electionOne = new ElectionOne(election)\r\n    const electionSample = new ElectionSample(election)\r\n    const electionGeo = new ElectionGeo(election)\r\n\r\n    self.election = election\r\n\r\n    // States //\r\n\r\n    const sims = {\r\n        one2D: new SimOne2D(screen, menu, changes, electionOne, self),\r\n        one1D: new SimOne1D(screen, menu, changes, electionOne, self),\r\n        // eslint-disable-next-line max-len\r\n        sample: new SimSample(screen, menu, changes, electionSample, self),\r\n        geoOne: new SimGeoOne(screen, menu, changes, electionGeo, self),\r\n    }\r\n    self.sims = sims\r\n\r\n    // Entities //\r\n\r\n    self.voterShapeAdd = new VoterShapeAdd(screen, layout, changes, commander, sims, self)\r\n    self.candidateAdd = new CandidateAdd(screen, layout, changes, commander, sims, self)\r\n    self.candidateDnAdd = new CandidateDnAdd(screen, layout, changes, commander, sims, self)\r\n\r\n    self.voterTest = new VoterTest(screen, sims, self)\r\n    self.testVote = () => sims[self.state].testVote()\r\n\r\n    // Default Entities //\r\n\r\n    self.candidateAdd.addCandidate({ x: 50, y: 100 }, { x: 50 }, '#e05020', true)\r\n    self.candidateAdd.addCandidate({ x: 100, y: 50 }, { x: 100 }, '#50e020', true)\r\n    self.candidateAdd.addCandidate({ x: 300 - 100, y: 300 - 50 }, { x: 200 }, '#2050e0', true)\r\n    self.candidateDnAdd.addCandidateDistribution({ x: 150, y: 150, w: 200 }, { x: 150 }, true)\r\n    self.voterShapeAdd.addVoterCircle({ x: 50, y: 150, w: 200 }, { x: 50, w: 200, densityProfile: 'gaussian' }, true)\r\n    self.voterShapeAdd.addVoterCircle({ x: 250, y: 150, w: 200 }, { x: 250, w: 200, densityProfile: 'gaussian' }, true)\r\n\r\n    // State Machine //\r\n\r\n    self.state = 'one2D' // default\r\n    // self.typeExit = self.state\r\n    changes.add(['simType'])\r\n\r\n    self.update = () => {\r\n        // state change\r\n        if (changes.check(['simType'])) {\r\n            // exit states\r\n            Object.keys(sims).forEach((k) => sims[k].exit())\r\n            // enter state\r\n            sims[self.state].enter()\r\n        }\r\n\r\n        // state update\r\n        sims[self.state].update()\r\n    }\r\n    self.renderForeground = () => { sims[self.state].renderForeground() }\r\n    self.render = () => { sims[self.state].render() }\r\n\r\n    self.setShowNonExistingEntities = (a) => {\r\n        self.showGhosts = a\r\n        changes.add(['showGhosts'])\r\n    }\r\n\r\n    // Buttons //\r\n\r\n    addSimControlsLabel(layout)\r\n\r\n    // -- Menu -- //\r\n\r\n    // add a menu item to switch between types of sims\r\n    // a list of simulation types\r\n    self.typeList = [\r\n        { name: 'One Election', value: 'one2D', state: '' },\r\n        { name: '1D One Election', value: 'one1D', state: '' },\r\n        { name: 'Sample Elections', value: 'sample', state: '' },\r\n        { name: 'Geo Election', value: 'geoOne', state: '' },\r\n    ]\r\n    menu.addMenuItem(\r\n        self,\r\n        {\r\n            label: 'Simulation:',\r\n            prop: 'state',\r\n            setProp: (p) => { self.state = p },\r\n            options: self.typeList,\r\n            change: ['simType'],\r\n        },\r\n    )\r\n}\r\n","/** Add a label for the sim controls */\r\nexport default function addSimControlsLabel(layout) {\r\n    const label = document.createElement('div')\r\n    label.setAttribute('class', 'button-group-label')\r\n    label.innerText = 'Sim Controls:'\r\n    layout.newElement('simControlsLabel', label)\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Layout keeps an internal ordered list of div names.\r\n * It creates a parent div to fill with these divs.\r\n * New divs are added according to the order of the names.\r\n * If the new div isn't in the list, then it is added at the end of the parent div.\r\n * @param {String[]} - Names in an ordered list for the layout.\r\n * @constructor\r\n */\r\nexport default function Layout(order) {\r\n    const self = this\r\n\r\n    const divsByName = {}\r\n    const extraDivs = []\r\n\r\n    /**\r\n     * Adds a new div with a name that should be in Layout's internal ordered list.\r\n     * @param {String} name\r\n     * @param {HTMLElement} div\r\n     */\r\n    self.newElement = (name, div) => {\r\n        if (order.includes(name)) {\r\n            divsByName[name] = div\r\n        } else {\r\n            extraDivs.push(div)\r\n        }\r\n    }\r\n\r\n    /**\r\n     * When we're done adding new divs, we return a parent div.\r\n     * @returns The parent div containing all other divs in order.\r\n     */\r\n    self.makeComponent = () => {\r\n        const parent = document.createElement('div')\r\n        order.forEach((name) => {\r\n            const div = divsByName[name]\r\n            if (div !== undefined) {\r\n                parent.appendChild(div)\r\n            }\r\n        })\r\n        extraDivs.forEach((div) => {\r\n            parent.appendChild(div)\r\n        })\r\n        return parent\r\n    }\r\n}\r\n","/**\r\n * Keep a\r\n * @param {Commander} commander  */\r\nexport default function CommandStore(commander) {\r\n    const self = this\r\n\r\n    // A list of actions we can execute (for sender)\r\n    const actions = []\r\n\r\n    /**\r\n     * A menu item or other object can add an action that it wants to execute with a value.\r\n     * The action can be performed by calling commander.do(command),\r\n     * where command has a name and value.\r\n     * @param {String} name - The name of the action.\r\n     * @param {Function} action - The action function itself, which is called with a value.\r\n     */\r\n    self.addSender = (args) => {\r\n        const {\r\n            name, action, props,\r\n        } = args\r\n\r\n        actions[name] = action\r\n        const command = (value) => ({ name, value, props })\r\n        const go = (value) => commander.do(command(value))\r\n        const sender = { command, go }\r\n        return sender\r\n    }\r\n\r\n    /**\r\n     * Make a sender with a command and a way to do the command.\r\n     * This type of sender deals with lists.\r\n     *\r\n     * Say we want to change a value for the nth candidate.\r\n     * And say the nth candidate doesn't exist.\r\n     * Then we have to use an action which acts on the list of candidates,\r\n     * rather than the candidate itself.\r\n     *\r\n     * @param {Object} args\r\n     * @returns {Object} - methods command(id,value) and go(id,value)\r\n     */\r\n    self.addSenderForList = (args) => {\r\n        const {\r\n            name, action, props,\r\n        } = args\r\n\r\n        actions[name] = action\r\n        const command = (id, value, currentValue) => ({\r\n            name, id, value, props, currentValue,\r\n        })\r\n        const go = (id, value, currentValue) => commander.do(command(id, value, currentValue))\r\n        const sender = { command, go }\r\n        return sender\r\n    }\r\n\r\n    /**\r\n     * Actually execute the action.\r\n     * @param {Object} command -\r\n     */\r\n    self.execute = (command) => {\r\n        const { name, id, value } = command\r\n        const action = actions[name]\r\n        if (id !== undefined) {\r\n            action(id, value)\r\n        } else {\r\n            action(value)\r\n        }\r\n    }\r\n}\r\n","/** Handle the Config */\r\nexport default function ConfigKeeper(commander) {\r\n    const self = this\r\n\r\n    // The list of all mementos\r\n    const config = {}\r\n\r\n    const firstActions = []\r\n\r\n    /**\r\n     * A menu item or other object can add an action that it wants to execute with a value.\r\n     * The action can be performed by calling commander.do(command),\r\n     * where command has a name and value.\r\n     * @param {String} name - The name of the action.\r\n     * @param {Function} action - The action function itself, which is called with a value.\r\n     */\r\n    self.addSender = (args) => {\r\n        const { name, currentValue, props } = args\r\n        if (props !== undefined && props.isFirstAction) {\r\n            firstActions[name] = true\r\n        }\r\n        config[name] = currentValue\r\n    }\r\n\r\n    /**\r\n     * Make a sender with a command and a way to do the command.\r\n     * This type of sender deals with lists.\r\n     *\r\n     * Say we want to change a value for the nth candidate.\r\n     * And say the nth candidate doesn't exist.\r\n     * Then we have to use an action which acts on the list of candidates,\r\n     * rather than the candidate itself.\r\n     *\r\n     * @param {Object} args\r\n     * @returns {Function} - a method to get the current value at an id.\r\n     */\r\n    self.addSenderForList = (args) => {\r\n        const { name, props } = args\r\n        if (props !== undefined && props.isFirstAction) {\r\n            firstActions[name] = true\r\n        }\r\n        config[name] = []\r\n\r\n        const getCurrentValue = (id) => config[name][id]\r\n        return getCurrentValue\r\n    }\r\n\r\n    /**\r\n     * Update the config when executing a command.\r\n     * @param {Object} command -\r\n     */\r\n    self.execute = (command) => {\r\n        const { name, id, value } = command\r\n        if (id !== undefined) {\r\n            config[name][id] = value\r\n        } else {\r\n            config[name] = value\r\n        }\r\n    }\r\n\r\n    self.makeUndo = (command) => {\r\n        const { name, id, props } = command // command is {name, value, props}\r\n\r\n        // Store the current value so we can undo the command.\r\n        let currentValue\r\n        if (id === undefined) {\r\n            currentValue = config[name]\r\n        } else {\r\n            currentValue = config[name][id]\r\n            if (currentValue === undefined) {\r\n                currentValue = command.currentValue\r\n            }\r\n        }\r\n\r\n        // Store how to undo the command.\r\n        const undoCommand = {\r\n            name, id, value: currentValue, props,\r\n        }\r\n\r\n        return undoCommand\r\n    }\r\n\r\n    self.passLoadConfig = (newConfig) => {\r\n        // newConfig is a list of commands to execute.\r\n        self.loadConfigPriority(newConfig, 'high')\r\n        self.loadConfigPriority(newConfig, 'low')\r\n    }\r\n\r\n    self.loadConfigPriority = (newConfig, priority) => {\r\n        // newConfig is a list of commands to execute.\r\n        const names = Object.keys(newConfig)\r\n        names.forEach((name) => {\r\n            // Decide whether to process commands, based on their priority.\r\n            const isHigh = firstActions[name] !== undefined\r\n            if (priority === 'low' && isHigh) {\r\n                return\r\n            }\r\n            if (priority === 'high' && !isHigh) {\r\n                return\r\n            }\r\n\r\n            // if we have a list, then create commands for each item in the list\r\n            const valueArray = newConfig[name]\r\n            if (valueArray instanceof Array) {\r\n                valueArray.forEach((value, id) => {\r\n                    // const subValue = newConfig[name][id]\r\n                    const command = { name, id, value }\r\n                    commander.execute(command)\r\n                })\r\n            } else {\r\n                const value = valueArray\r\n                const command = { name, value }\r\n                commander.execute(command)\r\n            }\r\n        })\r\n    }\r\n\r\n    self.passLoadCommands = (commands) => {\r\n        // execute commands without adding to history\r\n        commands.forEach((command) => {\r\n            commander.execute(command)\r\n        })\r\n    }\r\n\r\n    self.getConfig = () => structuredClone(config)\r\n}\r\n","export default function History(commander) {\r\n    const self = this\r\n\r\n    // Keep commands and undos in history\r\n    const history = []\r\n    let head = -1 // Head is where we are in history, where our head is at.\r\n\r\n    self.clearHistory = () => {\r\n        history.splice(0, history.length)\r\n        head = -1\r\n    }\r\n\r\n    /**\r\n     * We want to do a command. We need to keep track of what we do so we can undo it.\r\n     * @param {Object} command\r\n     * @param {String} command.name\r\n     * @param {(String|Number|Boolean)} command.value\r\n     * @param {Object} command.props - a catchall for easier coding\r\n     */\r\n    self.passDo = (command) => {\r\n        const undoCommand = commander.makeUndo(command)\r\n\r\n        // remove future redos\r\n        // example: head:-1 means history will be cleared splice(0,length)\r\n        history.splice(head + 1, history.length - (head + 1))\r\n\r\n        // Actually preform the command.\r\n        commander.execute(command)\r\n\r\n        // Add command to history\r\n        history.push([{ command, undoCommand }])\r\n        head += 1\r\n    }\r\n\r\n    /**\r\n     * Do a set of commands together, so they have one history item.\r\n     * @param {Object[]} commands - a list of command objects\r\n     */\r\n    self.passDoCommands = (commands) => {\r\n        // remove future redos\r\n        // example: head:-1 means history will be cleared splice(0,length)\r\n        history.splice(head + 1, history.length - (head + 1))\r\n\r\n        const historyItem = []\r\n        commands.forEach((command) => {\r\n        // todo: make into one undo item\r\n\r\n            const undoCommand = commander.makeUndo(command)\r\n\r\n            // Store in one history item\r\n            historyItem.push({ command, undoCommand })\r\n\r\n            // Actually preform the command.\r\n            commander.execute(command)\r\n        })\r\n\r\n        // Add command to history\r\n        history.push(historyItem)\r\n        head += 1\r\n    }\r\n\r\n    // control the duration of the setXY undos with a timeout. Here's a default timeout.\r\n    const chainDuration = 30\r\n    let chainTimer = setTimeout(() => null, chainDuration)\r\n\r\n    self.undo = () => {\r\n        if (head === -1) return // There is no history\r\n\r\n        const last = history[head]\r\n        last.forEach((pair) => { commander.execute(pair.undoCommand) })\r\n\r\n        head -= 1 // Now we're in the past.\r\n\r\n        // If we're in a setXY chain, then continue with another undo after a pause.\r\n        const { undoCommand } = last[0]\r\n        if (undoCommand.props === undefined) return\r\n        if (undoCommand.props.isChain !== true) return\r\n        if (head === -1) return\r\n        const penUltimate = history[head][0]\r\n        if (penUltimate.undoCommand.name === undoCommand.name) {\r\n            // todo: make this only work for repeated setXY commands\r\n            // set timer and callback\r\n            clearTimeout(chainTimer)\r\n            chainTimer = setTimeout(self.undo, chainDuration)\r\n        }\r\n    }\r\n\r\n    self.redo = () => {\r\n        if (head === history.length - 1) return // Nothing to do\r\n\r\n        const next = history[head + 1]\r\n        next.forEach((pair) => commander.execute(pair.command))\r\n\r\n        head += 1 // Now we're in the future.\r\n\r\n        // If we're in a setXY chain, then continue with another redo after a pause.\r\n        const { command } = next[0]\r\n        if (command.props === undefined) return\r\n        if (command.props.isChain !== true) return\r\n        if (head === history.length - 1) return\r\n        const nextnext = history[head + 1][0]\r\n        if (nextnext.command.name === command.name) {\r\n            // todo: make this only work for repeated setXY commands\r\n            // set timer and callback\r\n            clearTimeout(chainTimer)\r\n            chainTimer = setTimeout(self.redo, chainDuration)\r\n        }\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport CommandStore from './CommandStore.js'\r\nimport ConfigKeeper from './ConfigKeeper.js'\r\nimport History from './History.js'\r\n\r\n/**\r\n * Both the command pattern and the memento pattern are used here.\r\n * Commands are performed to make changes to the mementos.\r\n *\r\n * Memento Pattern:\r\n *  Caretaker: ConfigKeeper class. It keeps config as a list of mementos.\r\n *  Originator: sender returned by CommandStore.addSender, used by menuItem, Candidate, Voter, etc\r\n *  Mementos: Config is a list of mementos. It's not a strict pattern.\r\n *  Also, the way we are storing commands is like storing mementos of a commands (not strictly).\r\n *\r\n * Command Pattern:\r\n * * Client: a CandidateCommander, VoterCommander, MenuItem, etc\r\n * * Command: Here, a command is a memento of a way to make a command.\r\n *     CommandStore stores lists of ways to make commands.\r\n *     mostly with a name and an action.\r\n *     Also, History stores a list of commands.\r\n *  Sender: A sender is returned by CommandStore.addSender.\r\n *  Receiver: a property of a Candidate, Voter, MenuItem, etc.\r\n *  For example, Candidate.setXY calls CandidateCommander.setXYSenderForList.go(id, value),\r\n *    which then calls Candidate.setXYAction to set Candidate.x and Candidate.y\r\n *\r\n * This isn't exactly either pattern.\r\n * Instead of commands with execute functions,\r\n * we use CommandStore, a class that stores lists of ways to make commands, given parameters.\r\n * Instead of mementos, the lists of ways to make commands act as mementos.\r\n *\r\n * Initially, the three component classes here were part of one larger class,\r\n * but hopefully it is easier to read code that is shorter and sticks to one context.\r\n * This class is similar to the mediator in the mediator pattern.\r\n *\r\n * References:\r\n * * [Command Pattern on refactoring.guru](https://refactoring.guru/design-patterns/command)\r\n * * [Memento Pattern on refactoring.guru](https://refactoring.guru/design-patterns/memento)\r\n * * [Mediator Pattern on refactoring.guru](https://refactoring.guru/design-patterns/mediator)\r\n * @constructor\r\n */\r\nexport default function Commander(comMessenger) {\r\n    const self = this\r\n\r\n    const commandStore = new CommandStore(self)\r\n    const configKeeper = new ConfigKeeper(self)\r\n    const history = new History(self)\r\n    comMessenger.addCommander(self)\r\n\r\n    /**\r\n     * A menu item or other object can add an action that it wants to execute with a value.\r\n     * The action can be performed by calling commander.do(command),\r\n     * where command has a name and value.\r\n     * @param {Object} args - argument catchall\r\n     * @param {String} args.name - The name of the action.\r\n     * @param {Function} args.action - The action function itself, which is called with a value.\r\n     */\r\n\r\n    // make a sender with a command and a way to do the command\r\n    self.addSender = (args) => {\r\n        configKeeper.addSender(args)\r\n        const sender = commandStore.addSender(args)\r\n        return sender\r\n    }\r\n\r\n    /** Say we want to change a value for the nth candidate.\r\n     * And say the nth candidate doesn't exist.\r\n     * Then we have to use an action which acts on the list of candidates,\r\n     * rather than the candidate itself.\r\n     */\r\n\r\n    /**\r\n     * Make a sender with a command and a way to do the command.\r\n     * This type of sender deals with lists.\r\n     * @param {Object} args\r\n     * @returns {Object} - methods command(id,value) and go(id,value)\r\n     */\r\n    self.addSenderForList = (args) => {\r\n        const sender = commandStore.addSenderForList(args)\r\n        sender.getCurrentValue = configKeeper.addSenderForList(args)\r\n        return sender\r\n    }\r\n\r\n    /**\r\n     * Actually execute the action.\r\n     * @param {Object} command -\r\n     */\r\n    self.execute = (command) => {\r\n        configKeeper.execute(command)\r\n        commandStore.execute(command)\r\n    }\r\n\r\n    // ConfigKeeper functions\r\n\r\n    self.makeUndo = configKeeper.makeUndo\r\n    self.passLoadConfig = configKeeper.passLoadConfig\r\n    self.passLoadCommands = configKeeper.passLoadCommands\r\n    self.getConfig = configKeeper.getConfig\r\n\r\n    self.loadConfig = (newConfig) => {\r\n        // the broadcast will call passLoadConfig\r\n        comMessenger.broadcastLoadConfig(newConfig, self)\r\n    }\r\n\r\n    self.loadCommands = (commands) => {\r\n        // the broadcast will call passLoadComands\r\n        comMessenger.broadCastLoadCommands(commands, self)\r\n    }\r\n\r\n    // History functions\r\n\r\n    /**\r\n     * Put a commandMessenger in the middle,\r\n     * between the command being asked for and the command being done.\r\n     * @param {Object} command - a command to do. See passDo.\r\n     */\r\n    self.do = (command) => {\r\n        // the broadcast will call passDo\r\n        comMessenger.broadcastDo(command, self)\r\n    }\r\n\r\n    self.doCommands = (commands) => {\r\n        // the broadcast will call passDoCommands\r\n        comMessenger.broadcastDoCommands(commands, self)\r\n    }\r\n\r\n    self.passDo = history.passDo\r\n    self.passDoCommands = history.passDoCommands\r\n    self.undo = history.undo\r\n    self.redo = history.redo\r\n    self.clearHistory = history.clearHistory\r\n}\r\n","/** @module */\r\n\r\nimport { orderedJsonStringify } from '../utilities/jsHelpers.js'\r\n\r\n/**\r\n * Add buttons for saving the configuration to a textbox.\r\n * @param {Layout} layout\r\n * @param {Commander} commander\r\n */\r\nexport default function addSaveConfigToText(layout, commander) {\r\n    const button = document.createElement('button')\r\n\r\n    button.className = 'button2'\r\n\r\n    button.innerText = 'Save Config To Text'\r\n\r\n    const text = document.createElement('textarea')\r\n\r\n    button.onclick = () => {\r\n        const config = commander.getConfig()\r\n        text.value = orderedJsonStringify(config)\r\n    }\r\n\r\n    const clearDiv = document.createElement('div')\r\n\r\n    const div = document.createElement('div')\r\n    div.appendChild(button)\r\n    div.appendChild(clearDiv)\r\n    div.appendChild(text)\r\n\r\n    layout.newElement('saveConfigToText', div)\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Add buttons for saving the configuration to a link.\r\n * @param {Layout} layout\r\n * @param {Commander} commander\r\n */\r\nexport default function addSaveConfigToLink(layout, commander, sandboxURL) {\r\n    const button = document.createElement('button')\r\n    button.className = 'button2'\r\n    button.innerText = 'Save Link'\r\n\r\n    const button2 = document.createElement('button')\r\n    button2.className = 'button2'\r\n    button2.innerText = 'Copy Link to Clipboard'\r\n\r\n    const text = document.createElement('textarea')\r\n\r\n    button.onclick = () => {\r\n        const link = getLink()\r\n        text.value = link\r\n    }\r\n    button2.onclick = () => {\r\n        const link = getLink()\r\n        navigator.clipboard.writeText(link)\r\n    }\r\n    function getLink() {\r\n        const config = commander.getConfig()\r\n        const encodedConfig = encodeURIComponent(JSON.stringify(config))\r\n        const currentUrlFolder = getFolder()\r\n\r\n        const link = `${currentUrlFolder}/${sandboxURL}?a=${encodedConfig}`\r\n        return link\r\n    }\r\n    function getFolder() {\r\n        const sp = document.location.href.split('/')\r\n        const sl = sp.slice(0, sp.length - 1)\r\n        const folder = sl.join('/')\r\n        return folder\r\n    }\r\n\r\n    const clearDiv = document.createElement('div')\r\n\r\n    const div = document.createElement('div')\r\n    div.appendChild(button)\r\n    div.appendChild(button2)\r\n    div.appendChild(clearDiv)\r\n    div.appendChild(text)\r\n\r\n    layout.newElement('saveConfigToLink', div)\r\n}\r\n","/** @module */\r\n\r\nimport Changes from './Changes.js'\r\nimport Screen from './Screen.js'\r\nimport addSVGOutput from './addSVGOutput.js'\r\nimport Menu from '../menu/Menu.js'\r\nimport Sim from '../sim/Sim.js'\r\nimport Layout from './Layout.js'\r\nimport Commander from '../command/Commander.js'\r\nimport addUndo from '../command/addUndo.js'\r\nimport addSaveConfigToText from '../command/addSaveConfigToText.js'\r\nimport addLoadConfigText from '../command/loadConfigText.js'\r\nimport addSaveConfigToLink from '../command/addSaveConfigToLink.js'\r\n\r\n/**\r\n * Set up a user interface to run a simulation.\r\n * @param {Object} config - An object containing commands. A command is a {name,value} pair.\r\n */\r\nexport default function sandbox(config, comMessenger, sandboxURL) {\r\n    // manage dependent calculations because we only want to do calculations if we need to\r\n    const changes = new Changes()\r\n\r\n    const layout = new Layout([\r\n        'menu',\r\n        'simControlsLabel',\r\n        'addVoter',\r\n        'addCandidate',\r\n        'addCandidateDistribution',\r\n        'undo',\r\n        'redo',\r\n        'screenWrap',\r\n        'maps',\r\n        'saveConfigToLink',\r\n        'saveConfigToText',\r\n        'loadConfigText',\r\n        'svgUIDiv',\r\n    ])\r\n\r\n    const commander = new Commander(comMessenger)\r\n\r\n    const menu = new Menu(changes, layout, commander)\r\n\r\n    addUndo(layout, commander)\r\n\r\n    addSaveConfigToLink(layout, commander, sandboxURL)\r\n\r\n    addSaveConfigToText(layout, commander)\r\n\r\n    addLoadConfigText(layout, commander)\r\n\r\n    const screen = new Screen(300, 300, layout)\r\n\r\n    addSVGOutput(screen, draw, layout)\r\n\r\n    const sim = new Sim(screen, menu, changes, commander, layout)\r\n\r\n    commander.loadConfig(config)\r\n    commander.clearHistory()\r\n\r\n    const div = layout.makeComponent()\r\n\r\n    window.requestAnimationFrame(gameLoop)\r\n\r\n    return div\r\n\r\n    function gameLoop() {\r\n        update()\r\n        drawForeground()\r\n        window.requestAnimationFrame(gameLoop)\r\n    }\r\n\r\n    function update() {\r\n        sim.update()\r\n    }\r\n\r\n    function drawForeground() {\r\n        screen.clearForeground()\r\n        sim.renderForeground()\r\n    }\r\n\r\n    function draw() {\r\n        screen.clear()\r\n        screen.clearMaps()\r\n        screen.clearForeground()\r\n        sim.render()\r\n        sim.renderForeground()\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Add buttons to layout for undo and redo, and connect them to commander for functionality.\r\n * @param {Layout} layout\r\n * @param {Commander} commander\r\n */\r\nexport default function addUndo(layout, commander) {\r\n    const undoButton = document.createElement('button')\r\n    const redoButton = document.createElement('button')\r\n\r\n    undoButton.className = 'button2'\r\n    redoButton.className = 'button2'\r\n\r\n    undoButton.innerText = 'Undo'\r\n    redoButton.innerText = 'Redo'\r\n\r\n    undoButton.onclick = commander.undo\r\n    redoButton.onclick = commander.redo\r\n\r\n    layout.newElement('undo', undoButton)\r\n    layout.newElement('redo', redoButton)\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Add buttons to layout for undo and redo, and connect them to commander for functionality.\r\n * @param {Layout} layout\r\n * @param {Commander} commander\r\n */\r\nexport default function addLoadConfigText(layout, commander) {\r\n    const button = document.createElement('button')\r\n\r\n    button.className = 'button2'\r\n\r\n    button.innerText = 'Load Config Text'\r\n\r\n    const text = document.createElement('textarea')\r\n\r\n    button.onclick = () => {\r\n        if (text.value === '') return\r\n        const config = JSON.parse(text.value)\r\n        commander.loadConfig(config)\r\n    }\r\n\r\n    const clearDiv = document.createElement('div')\r\n\r\n    const div = document.createElement('div')\r\n    div.appendChild(button)\r\n    div.appendChild(clearDiv)\r\n    div.appendChild(text)\r\n\r\n    layout.newElement('loadConfigText', div)\r\n}\r\n","/** @module */\r\n\r\nimport checkURL from '../command/checkURL.js'\r\nimport ComMessenger from '../command/ComMessenger.js'\r\nimport sandbox from './sandbox.js'\r\n\r\n/** Find all the divs of class \"sandbox\".\r\n * Add the sandbox as a neighbor under the same parent. */\r\nexport default function addSingleSandboxes() {\r\n    const targets = Array.from(document.getElementsByClassName('sandbox'))\r\n    targets.forEach((target) => {\r\n        const hasConfig = target.dataset.config !== undefined\r\n        const targetConfig = (hasConfig) ? JSON.parse(target.dataset.config) : {}\r\n        const cu = checkURL()\r\n        const config = (cu.yes) ? cu.config : targetConfig\r\n\r\n        const hasSandboxURL = target.dataset.sandboxurl !== undefined\r\n        const sandboxURL = hasSandboxURL ? target.dataset.sandboxurl : ''\r\n\r\n        const comMessenger = new ComMessenger()\r\n        const div = sandbox(config, comMessenger, sandboxURL)\r\n        const parent = target.parentNode\r\n        parent.appendChild(div)\r\n    })\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Check if the URL is giving a configuration.\r\n * @returns {Object} - Property yes means we have a config to use from the URL.\r\n */\r\nexport default function checkURL() {\r\n    const urlParams = new URLSearchParams(window.location.search)\r\n\r\n    const yes = urlParams.has('a')\r\n\r\n    const config = yes ? JSON.parse(urlParams.get('a')) : {}\r\n\r\n    return { yes, config }\r\n}\r\n","/** @module */\r\n\r\nimport doubleSandbox from './doubleSandbox.js'\r\n\r\n/** Find all the divs of class \"double_sandbox\".\r\n * Add the double_sandbox as a neighbor under the same parent. */\r\nexport default function addDoubleSandboxes() {\r\n    const targets = Array.from(document.getElementsByClassName('double_sandbox'))\r\n    targets.forEach((target) => {\r\n        const hasConfig = target.dataset.config !== undefined\r\n        const config = (hasConfig) ? JSON.parse(target.dataset.config) : {}\r\n\r\n        const hasSandboxURL = target.dataset.sandboxurl !== undefined\r\n        const sandboxURL = hasSandboxURL ? target.dataset.sandboxurl : ''\r\n\r\n        const div = doubleSandbox(config, sandboxURL)\r\n        const parent = target.parentNode\r\n        parent.appendChild(div)\r\n    })\r\n}\r\n","/** @module */\r\n\r\nimport ComMessenger from '../command/ComMessenger.js'\r\nimport sandbox from './sandbox.js'\r\n\r\n/**\r\n * Makes Two sandboxes and links their commands together.\r\n * @param {Object} config - To pass to commander to set the initial configuration of the sim.\r\n * @param {String} sandboxURL - String to add to the current url directory to get to the sandbox.\r\n * @returns {HTMLElement} - div containing the two sandboxes.\r\n */\r\nexport default function doubleSandbox(config, sandboxURL) {\r\n    const comMessenger = new ComMessenger()\r\n\r\n    const divLink = document.createElement('button')\r\n    divLink.className = 'button2'\r\n    divLink.innerText = 'linked'\r\n    divLink.style['vertical-align'] = 'middle'\r\n    divLink.style['min-width'] = '70px'\r\n    divLink.style.margin = '5px'\r\n    const toggle = () => {\r\n        if (divLink.innerText === 'linked') {\r\n            divLink.innerText = 'unlinked'\r\n            comMessenger.setLinked(false)\r\n        } else {\r\n            divLink.innerText = 'linked'\r\n            comMessenger.setLinked(true)\r\n        }\r\n    }\r\n    divLink.onclick = toggle\r\n\r\n    const div1 = sandbox(config, comMessenger, sandboxURL)\r\n    const div2 = sandbox(config, comMessenger, sandboxURL)\r\n    div1.style.display = 'inline-block'\r\n    div2.style.display = 'inline-block'\r\n\r\n    div1.style['vertical-align'] = 'top'\r\n    div2.style['vertical-align'] = 'top'\r\n\r\n    const div = document.createElement('div')\r\n    div.appendChild(div1)\r\n    div.appendChild(divLink)\r\n    div.appendChild(div2)\r\n    return div\r\n}\r\n"],"names":["this","linked","commanders","protect","setLinked","value","addCommander","commander","push","broadcastDo","command","originCommander","forEach","com","passDo","broadcastDoCommands","commands","passDoCommands","broadcastLoadConfig","newConfig","passLoadConfig","broadCastLoadCommands","passLoadCommands","self","changes","add","changeList","c","check","n","includes","checkNone","length","clear","splice","handlers","start","move","end","touchmove","touchstart","touchend","set","eHandlers","Object","assign","w","h","layout","width","height","canvas","document","createElement","setAttribute","ctx","getContext","tooltips","foreground","fctx","maps","mctx","clearDiv","wrap","appendChild","newElement","noBuffers","pixelRatio","context","backingStore","backingStorePixelRatio","webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio","window","devicePixelRatio","$705ca8a2f34171f8$var$getPixelRatio","style","setMapsHeight","h3","Math","round","heightBrowser","scale","clearRect","clearForeground","clearMaps","setCtx","setFCtx","setMCtx","setNoBuffers","showMaps","display","hideMaps","eventHandlers","$506b705d01454b72$export$2e2bcd8739ae039","onmousedown","e","onmousemove","onmouseup","addEventListener","current","$71a639b9e6c25c65$var$STYLES","$71a639b9e6c25c65$var$ctx","$71a639b9e6c25c65$var$CanvasGradient","$71a639b9e6c25c65$var$CanvasPattern","$71a639b9e6c25c65$var$namedEntities","$71a639b9e6c25c65$var$format","str","args","i","keys","replace","RegExp","$71a639b9e6c25c65$var$randomString","holder","randomstring","Error","chars","floor","random","$71a639b9e6c25c65$var$getDominantBaseline","textBaseline","mapping","alphabetic","hanging","top","bottom","middle","items","radix","entity","base10","lookup","split","parseInt","$71a639b9e6c25c65$var$createNamedToNumberedLookup","strokeStyle","svgAttr","svg","apply","fillStyle","lineCap","lineJoin","miterLimit","lineWidth","shadowColor","shadowOffsetX","shadowOffsetY","textAlign","lineDash","gradientNode","__root","__ctx","prototype","addColorStop","offset","color","matches","stop","__createElement","indexOf","exec","r","g","b","pattern","o","defaultOptions","enableMirroring","arguments","options","undefined","__document","__canvas","__setDefaultStyles","__stack","__getStyleState","__groupStack","createElementNS","setAttributeNS","__ids","__defs","__currentElement","elementName","properties","resetFill","key","element","__applyStyleState","styleState","__applyStyleToCurrentElement","type","__currentElementsToStyle","currentStyleGroup","children","node","id","childNodes","getAttribute","currentElement","attr","opacity","globalAlpha","__closestGroupOrSvg","nodeName","parentNode","getSerializedSvg","fixNamedEntities","regexp","serialized","XMLSerializer","serializeToString","test","getSvg","save","group","parent","restore","pop","state","__addTransform","t","__applyCurrentDefaultPath","transform","x","y","rotate","angle","degrees","PI","cx","translate","a","d","f","beginPath","path","__currentDefaultPath","__currentPosition","console","error","__addPathCommand","moveTo","closePath","lineTo","bezierCurveTo","cp1x","cp1y","cp2x","cp2y","quadraticCurveTo","cpx","cpy","$71a639b9e6c25c65$var$normalize","vector","len","sqrt","arcTo","x1","y1","x2","y2","radius","x0","y0","unit_vec_p1_p0","unit_vec_p1_p2","cos","theta","acos","abs","unit_vec_p1_origin","len_p1_origin","sin","x3","y3","unit_vec_origin_start_tangent","unit_vec_origin_end_tangent","getAngle","startAngle","endAngle","arc","stroke","fill","rect","fillRect","strokeRect","__clearCanvas","rootGroup","removeChild","createLinearGradient","grad","gradientUnits","createRadialGradient","r0","r1","cy","fx","fy","__parseFont","fontPart","font","data","size","family","weight","decoration","__fontHref","href","__wrapTextLink","__applyText","text","action","textElement","left","right","center","createTextNode","fillText","strokeText","measureText","counterClockwise","endX","endY","startX","startY","sweepFlag","largeArcFlag","diff","clip","clipPath","newGroup","drawImage","dx","dy","dw","dh","sw","sh","defs","svgImage","Array","slice","call","image","sx","sy","screen","draw","svgUIDiv","button","className","innerText","onclick","old","oldF","svgCtx","oldM","svgMCtx","mSvgDiv","svgHideButton","hidden","svgDiv","innerHTML","downloadLink","url","encodeURIComponent","outputSVG","mSvg","mDownloadLink","mUrl","outputMSVG","download","margin","$71a639b9e6c25c65$export$2e2bcd8739ae039","buttonConfig","onChoose","config","name","nameIsHTML","dom","fixMargin","max","marginRight","realname","onClick","turnOff","isOn","turnOn","config1","makeData","buttonConfigs","doMakeData","labelName","label","labelIsHTML","isCheckbox","isCheckboxBool","justButton","buttonHidden","buttonDOMByValue","init","buttons","buttonsByName","labelDOM","conf","$d019958dda7398e8$export$2e2bcd8739ae039","onToggle","i1","selected","updateNames","data2","redraw","configureHidden","buttonName","entries","buttonData","setTimeout","highlight","propName","propValue","ibu","bu","ibu1","theButton","filter","object","prop","setProp","change","list","sender","go","select","addSender","currentValue","configure","choose","$4088c71a26df2b7b$export$2e2bcd8739ae039","$ced2438c3869b330$var$buttonWidth","numButtons","divMenu","addMenuItem","choice","menuItem","$ced2438c3869b330$export$2e2bcd8739ae039","candidate","dragm","newSquareHandle","square","renderForeground","sim","simCans","newCandidate","simCan","getSimCandidates","exists","getCandidates","map","getCandidatesAll","setCandidateFractions","fractions","can","index","fraction","setFraction","setCandidateWins","winsByCandidate","win","setWins","updateXY","showGhosts","renderForegroundAll","renderForegroundExisting","numCandidates","newVoterSim","voterGroup","getVoterShapes","v","voterShape","getVoterSims","update","candidates","render","$51d4c6038662af31$export$d02631cccf789723","$51d4c6038662af31$var$sortObjByKey","isArray","sort","reduce","$51d4c6038662af31$export$f6e9b6133dd229d9","mean","sd","exp","$51d4c6038662af31$export$e94e7ee3b047a94d","Infinity","ERF_A","down","ratio","expofun","radical","sign","$51d4c6038662af31$var$erf","$51d4c6038662af31$export$7f57f51729968d3b","sColor","remove","$51d4c6038662af31$export$e410eba367ce792b","min","iClosest","$51d4c6038662af31$export$7d15b64cf5a3a4c4","drag","draggables","grabCanvas","isSquare","newCircleHandle","isCircle","event","target","closest","log","mouse","getMouse","extra","isTouch","nd","hitList","hitTest","distances2","iDraggableClosest","d1","iDragging","isDragging","offX","offY","pickUp","dataset","cursor","couldBeClick","structuredClone","startClickDetect","preventDefault","stopPropagation","dragging","setXY","xDist","startPos","yDist","moveClickDetect","endClickDetect","drop","passTouch","getBoundingClientRect","changedTouches","clientX","clientY","m","p","pass","$ddb4de2d334b0195$export$2e2bcd8739ae039","enter","exit","testVote","circle","$3c16a28e6169e80f$var$r","$3c16a28e6169e80f$export$8da5152a7cb9deca","l","rgba","toLowerCase","parseFloat","String","$3c16a28e6169e80f$export$fdb28526eb2966c3","from1","to1","p1","from","trim","to","toString","colors","fracSum","colorB","$ef353fcd6eb81187$var$frac","thing","other","gridData","candidateSimList","cans","grid","voteSet","voterGeom","canvases","singleCanvas","nCans","nHeight","isGauss","densityProfile","nx","ny","offCtx","imageData","createImageData","k","yp","xp","tallyFractions","putImageData","fillDataSeparate","colorSet","$ef353fcd6eb81187$export$2e2bcd8739ae039","fillDataBlend","imageSmoothingEnabled","ov","drawBlend","im","drawSeparate","$c198e5ea557823b0$var$splitter","$c198e5ea557823b0$var$sum","elen","flen","Q","Qnew","hh","bvirt","enow","fnow","eindex","findex","hindex","$c198e5ea557823b0$var$vec","Float64Array","$c198e5ea557823b0$var$B","$c198e5ea557823b0$var$C1","$c198e5ea557823b0$var$C2","$c198e5ea557823b0$var$D","$c198e5ea557823b0$var$u","$c198e5ea557823b0$var$orient2d","ax","ay","bx","by","detleft","detright","det","detsum","acxtail","acytail","bcxtail","bcytail","ahi","alo","bhi","blo","_i","_j","_0","s1","s0","t1","t0","u3","acx","bcx","acy","bcy","$c198e5ea557823b0$var$estimate","errbound","C1len","C2len","Dlen","$c198e5ea557823b0$var$orient2dadapt","$c198e5ea557823b0$var$EPSILON","pow","$c198e5ea557823b0$var$EDGE_STACK","Uint32Array","$c198e5ea557823b0$var$Delaunator","points","getX","$c198e5ea557823b0$var$defaultGetX","getY","$c198e5ea557823b0$var$defaultGetY","coords","maxTriangles","_triangles","_halfedges","Int32Array","_hashSize","ceil","_hullPrev","_hullNext","_hullTri","_hullHash","_ids","_dists","hullPrev","hullNext","hullTri","hullHash","minX","minY","maxX","maxY","i0","i2","minDist","i3","$c198e5ea557823b0$var$dist","i0x","i0y","i4","i1x","i1y","minRadius","i5","$c198e5ea557823b0$var$circumradius","i2x","i2y","$c198e5ea557823b0$var$quicksort","hull","j","i8","d0","subarray","triangles","halfedges","ex","ey","bl","cl","$c198e5ea557823b0$var$circumcenter","_cx","_cy","i6","_hullStart","hullSize","_hashKey","trianglesLen","_addTriangle","q","_legalize","i7","$c198e5ea557823b0$var$pseudoAngle","ar","a0","al","$c198e5ea557823b0$var$inCircle","p0","pr","pl","hbl","_link","br","b0","px","py","bp","cp","ids","dists","temp","tempDist","$c198e5ea557823b0$var$swap","arr","tmp","$c198e5ea557823b0$var$epsilon$1","$c198e5ea557823b0$var$Path","_x0","_y0","_x1","_y1","_","$c198e5ea557823b0$export$20f0351992a349","constructor","delaunay","xmin","ymin","xmax","ymax","_circumcenters","vectors","_init","circumcenters","t2","t3","ab","i9","buffer","inedges","ti","tj","xi","yi","xj","yj","_renderSegment","h0","h1","i10","_project","_clip","i11","cell","cellPolygon","polygon","$c198e5ea557823b0$var$Polygon","renderCell","S","c0","_regioncode","c1","_clipSegment","_step","ci","neighbors","cj","loop","ai","li","aj","lj","_cell","e0","V","_clipInfinite","_clipFinite","P","e1","sx0","sy0","sx1","sy1","_edgecode","_edge","contains","vx0","vy0","vxn","vyn","unshift","i12","vx","vy","$c198e5ea557823b0$var$tau","$c198e5ea557823b0$var$pow","$c198e5ea557823b0$var$pointX","$c198e5ea557823b0$var$pointY","$c198e5ea557823b0$var$jitter","static","that","$c198e5ea557823b0$export$42fc3f3b24093a06","array","$c198e5ea557823b0$var$flatArray","$c198e5ea557823b0$var$flatIterable","_delaunator","$c198e5ea557823b0$var$collinear","collinear","bounds","hypot","i13","hullIndex","_hullIndex","n1","dt","dc","renderHull","trianglePolygon","renderTriangle","voronoi","shape2","oneVoters","voronoiGroups","grid2Ds","votes","voterShapes","election","countVotes","caster","$ec52817c6fba578b$export$2e2bcd8739ae039","grid2D","$4362eb6203983c70$export$2e2bcd8739ae039","voronoiGroup","menu","electionOne","$da9ab18c28e2e6aa$export$2e2bcd8739ae039","$48e6e04bfb61f2eb$export$2e2bcd8739ae039","$7abf5c6aa34f05fd$export$2e2bcd8739ae039","addSimCandidate","$2112dbf0cba3cbca$export$2e2bcd8739ae039","addSimVoterCircle","$3ab88a43bf356d6f$export$2e2bcd8739ae039","vizOne2D","$72f6c7c2936ed02c$export$2e2bcd8739ae039","superEnter","candidateAdd","canButton","show","setDimensions","voterTest","hide","setE","updateTallies","candidateDistributions","cdf","areasProportion","cd","sumAreasProportion","pmf","$cba26d0191240401$var$getCDF","samplePoint","iDist","random1","findIndex","$cba26d0191240401$var$randomDistribution","X","Y","R","$cba26d0191240401$var$randomInsideCircle","$cba26d0191240401$var$samplePoint1","simCanDns","simCanDn","getSimCandidateDistributions","canDn","getCandidateDistributions","getCandidateDistributionsAll","startSampler","canDns","sampler","$cba26d0191240401$export$2e2bcd8739ae039","sampleVoters","canvas2","context2","renderPoints","newPoints","renderToBuffer","renderCans","renderVoters","noBufferRender","bufferRender","electionSample","$2ae91dc6708f284d$export$2e2bcd8739ae039","addSimCandidateDistribution","$6b03fe144d120a5a$export$2e2bcd8739ae039","vizSample2D","$3462f9c465296c80$export$2e2bcd8739ae039","candidateDnAdd","canDnButton","addResult","addSim","noChange","startSim","renderAt","newX","newY","renderCenterAt","$4a707d0bede71212$var$F2","$4a707d0bede71212$var$G2","$4a707d0bede71212$var$G3","$4a707d0bede71212$var$F4","$4a707d0bede71212$var$G4","$4a707d0bede71212$var$grad3","Float32Array","$4a707d0bede71212$var$grad4","$4a707d0bede71212$export$7cef8d54b4fb09be","randomOrSeed","$4a707d0bede71212$var$alea","$4a707d0bede71212$export$98cd52c6119fe283","perm","Uint8Array","permMod12","noise2D","n0","n2","s","j1","ii","jj","gi0","gi1","gi2","noise3D","z","n3","z0","k1","j2","k2","z1","z2","z3","kk","gi3","noise4D","n4","w0","rankx","ranky","rankz","rankw","l1","l2","j3","k3","l3","w1","w2","x4","y4","z4","w4","ll","w3","t4","gi4","sn","genNoise","noiseWidth","noiseHeight","xAmp","yAmp","simplexX","simplexY","$c913a56498196062$var$zeros","sumX","sumY","$c913a56498196062$var$range","ix","iy","noiseX","noiseY","meanX","meanY","$c913a56498196062$export$8cea35b328240292","$47bb62cfe9482204$export$7c04771a442b0848","$47bb62cfe9482204$export$31875faf3fe0de4d","tolFraction","polygons","centroids","$b88c6a1775da370c$var$randomPoints","converged","tol","$b88c6a1775da370c$var$relax","every","point","$b88c6a1775da370c$var$distance2","$11eb5e0ad93fc4ca$export$a2f18a0619b13ed4","textsize","lw","alpha","subject0","closed","$1c9b910f94fe5a4d$var$polygonClosed","subject","input","$1c9b910f94fe5a4d$var$lineOrient","$1c9b910f94fe5a4d$var$lineIntersect","bax","bay","dcx","dcy","$fbefcda9c3d500d6$var$makeSquare","make","polygonAreas","totalArea","census","districtMaker","gx","gy","iDistrict","overlap","$1c9b910f94fe5a4d$export$2e2bcd8739ae039","JSON","parse","stringify","reverse","$fbefcda9c3d500d6$export$2e2bcd8739ae039","renderVoronoi","geoMapWidth","geoMapHeight","renderVoronoiGeneral","renderAreaText","renderVoronoiColors","textFunction","scaleX","scaleY","electionGeo","$ea87173ebe7c496f$export$2e2bcd8739ae039","geoNoise","$c913a56498196062$export$2e2bcd8739ae039","voterSimGroups","updateDistricts","updateVoters","updateFullSet","updateVotersByDistrict","updateVotersByTract","vb","rowNoise","cellNoise","xNoise","yNoise","shape1","flat","gf","renderWidth","renderHeight","voterGeoList","noiseImage","$0531784a545936ff$export$2e2bcd8739ae039","geoElectionResults","colorByTract","colorOfVoteByDistrict","colorOfWinsByDistrict","winnerColors","loadColors","voterGroupsByTract","row","smallCircle","renderTractVotes","renderDistrictWins","renderDistrictVotes","renderVoterBasisSet","$65ba3e089739ee2d$export$2e2bcd8739ae039","$e8eae5f5128fc46f$export$2e2bcd8739ae039","vizGeo2D","$8d0072b19be091b2$export$2e2bcd8739ae039","fillUndefined","updateVotes","entities","nextID","new","num","get","$6bae94082fec84ac$var$defaultSetTimout","$6bae94082fec84ac$var$defaultClearTimeout","$6bae94082fec84ac$var$globalContext","$6bae94082fec84ac$var$cachedSetTimeout","$6bae94082fec84ac$var$cachedClearTimeout","$6bae94082fec84ac$var$runTimeout","fun","clearTimeout","$6bae94082fec84ac$var$currentQueue","$6bae94082fec84ac$var$queue","$6bae94082fec84ac$var$draining","$6bae94082fec84ac$var$queueIndex","$6bae94082fec84ac$var$cleanUpNextTick","concat","$6bae94082fec84ac$var$drainQueue","timeout","run","marker","$6bae94082fec84ac$var$runClearTimeout","$6bae94082fec84ac$var$Item","$6bae94082fec84ac$var$noop","$6bae94082fec84ac$var$on","$6bae94082fec84ac$var$addListener","$6bae94082fec84ac$var$once","$6bae94082fec84ac$var$off","$6bae94082fec84ac$var$removeListener","$6bae94082fec84ac$var$removeAllListeners","$6bae94082fec84ac$var$emit","$6bae94082fec84ac$var$performance","performance","$6bae94082fec84ac$var$performanceNow","now","mozNow","msNow","oNow","webkitNow","Date","getTime","$6bae94082fec84ac$var$startTime","$6bae94082fec84ac$var$process","nextTick","title","browser","env","NODE_ENV","argv","version","versions","on","addListener","once","off","removeListener","removeAllListeners","emit","binding","cwd","chdir","dir","umask","hrtime","previousTimestamp","clocktime","seconds","nanoseconds","platform","release","uptime","$6bae94082fec84ac$export$cea96571ebbff9dd","None","amount","In","Out","InOut","Bounce","time","bind","$6bae94082fec84ac$export$eb2fcfdbd7ba97d4","_tweens","_tweensAddedDuringUpdate","getAll","_this","tweenId","removeAll","tween","getId","preserve","$6bae94082fec84ac$export$461939dd4422153","tweenIds","autoStart","$6bae94082fec84ac$export$b0cc4f9860136880","Linear","fn","Utils","pw","bn","Bernstein","CatmullRom","fc","Factorial","p2","p3","v0","v1","$6bae94082fec84ac$export$edde1bcb1b2b310e","nextId","_nextId","$6bae94082fec84ac$export$208a41d6b4e37b97","_object","_group","$6bae94082fec84ac$var$mainGroup","_isPaused","_pauseStart","_valuesStart","_valuesEnd","_valuesStartRepeat","_duration","_initialRepeat","_repeat","_yoyo","_isPlaying","_reversed","_delayTime","_startTime","_easingFunction","_interpolationFunction","_chainedTweens","_onStartCallbackFired","_id","_isChainStopped","_goToEnd","isPlaying","isPaused","duration","create","property","_swapEndStartRepeatValues","_setupProperties","startValue","startValueIsArray","propType","isInterpolationList","endValues","_handleRelativeValue","stopChainedTweens","_onStopCallback","pause","resume","numChainedTweens","delay","repeat","times","repeatDelay","_repeatDelayTime","yoyo","easing","easingFunction","interpolation","interpolationFunction","chain","tweens","onStart","callback","_onStartCallback","onUpdate","_onUpdateCallback","onRepeat","_onRepeatCallback","onComplete","_onCompleteCallback","onStop","endTime","elapsed","_updateProperties","startIsArray","endIsArray","charAt","endValue","trueR","outsideClickListener","elem","offsetWidth","offsetHeight","getClientRects","removeClickListener","removeEventListener","box","position","border","padding","background","pinned","tbox","$8224c2fe391551b0$export$2e2bcd8739ae039","$b72a214e9bbfb6d2$var$Item","val","div","dimensions","setW1","densityProfile1","setDensityProfile1","setW2","setColor","setShowNonExistingEntities","onChange","defaultValue","choices","option","checked","step","for","voterRegistrar","doLoad","voterCommander","instantiate","shape2p","setForListSenders","shape1x","shape2w","shape1w","shape1densityProfile","loadCommands","doCommands","setAction","cur","getCurrentValue","newW","newDensityProfile1","click","$b72a214e9bbfb6d2$export$2e2bcd8739ae039","$6096d1144969c10b$export$2e2bcd8739ae039","voterShapeAdd","makeSetForListSender","configKey","isChain","addSenderForList","setNumberVoters","props","setNumberVotersSender","setNumberVotersAction","isFirstAction","sims","addVoterButton","addVoterPressed","$3feb239f40f58b63$export$2e2bcd8739ae039","$93bf61687e0acd03$export$2e2bcd8739ae039","$5fb6d77d2d952ec4$export$2e2bcd8739ae039","addVoterCircle","$16caf0f33023bbc5$export$2e2bcd8739ae039","one2D","one1D","geoOne","sample","trueW","trueH","tweenSq","wHandle","hHandle","candidateRegistrar","candidateCommander","newColor","$16cfe2bdd82d8091$export$2e2bcd8739ae039","wins","toFixed","prefix","setNumberCandidates","setNumberCandidatesSender","setNumberCandidatesAction","addCandidateButton","addCandidatePressed","$91bf2eeacf63b307$export$2e2bcd8739ae039","$7cad4102d954b952$export$2e2bcd8739ae039","addCandidate","$857f7aab49c32763$export$2e2bcd8739ae039","candidateDnRegistrar","candidateDnCommander","setNumberCandidateDns","setNumberCandidateDnsSender","setNumberCandidateDnsAction","addCandidateDistributionButton","addCandidateDistributionPressed","$7f43295cb5239d6b$export$2e2bcd8739ae039","$63963ec4d8ba9e59$export$2e2bcd8739ae039","addCandidateDistribution","candidateDn","$3cfb90248ef34c32$export$2e2bcd8739ae039","shapePath","iCan","drawOutline","gridX","sigma","amp","gl","xg","voteMult","renderBackground","doPath","pa","gaussianPath","grid1Ds","$a46639894e63747d$export$2e2bcd8739ae039","grid1D","$e9b32b3bcad2ef12$export$2e2bcd8739ae039","vizOne1D","$79b3207004488628$export$2e2bcd8739ae039","vote","setPin","button2","backgroundColor","newVote","removeTestPoint","$2f7b5309260671ab$export$2e2bcd8739ae039","tooltip","$bbe0cc4489022f53$export$2e2bcd8739ae039","optionCast","usr","castVotes","sampleCandidates","seats","nk","checkElectionType","canList","electionResults","runElection","winner","winPoint","allocation","jitterSize","numPoints","resultsStatewide","allVoterGroups","runStatewideElection","resultsByTract","runTractElections","colorTracts","resultsByDistrict","voterGroupsByDistrict","runDistrictElections","sum","colorDistrictWins","colorDistrictVote","winsByDistrict","iWinner","updateWins","lines","c2","$ecaf00bf58169ce4$var$equidistantLine","$ecaf00bf58169ce4$var$findLines","sumArea","area","lineSet","$ecaf00bf58169ce4$var$sumCircle","diff2","half","high","low","line","A","intervals","iSorted","midpoints","lower","upper","$46cc7dc62139509d$var$findIntervals","$46cc7dc62139509d$var$sumGaussian","$46cc7dc62139509d$var$sumBlock","block","interval","lower2","upper2","lower3","upper3","$e61ec6b437df561a$var$df1","$e61ec6b437df561a$var$df2","lc","tally","df","$05244c126866791b$var$df1","$05244c126866791b$var$df2","dist","$51d4c6038662af31$export$6fb785c609d82593","frac","spread","iWidth","ixGrid","iyGrid","gridXMargin","gridYMargin","gridLength","gridY","$5b08a4a549bd3869$var$findWeight","$5b08a4a549bd3869$var$makeGrid","$05244c126866791b$export$2e2bcd8739ae039","$658ad754d0cd1b50$var$makeGrid","$658ad754d0cd1b50$var$findWeight","castPlurality","voterGeoms","isTestVoter","$e61ec6b437df561a$export$2e2bcd8739ae039","summer","$46cc7dc62139509d$export$2e2bcd8739ae039","$ecaf00bf58169ce4$export$2e2bcd8739ae039","total","castScore","$658ad754d0cd1b50$export$2e2bcd8739ae039","$5b08a4a549bd3869$export$2e2bcd8739ae039","gridDataEntry","electionMethodOptions","threshold","populations","nparties","populationsSorted","minPopulation","divisorPattern","sortedSignposts","lastSignpost","score","countResults","$ee120a7268fdcb91$export$2e2bcd8739ae039","electionMethod","electionMethodList","electionMethodListByFunctionName","setElectionMethod","$0deca86f373e1023$export$2e2bcd8739ae039","mapVoters","vg","mapCans","canGeom","casterFun","$a0cd9654243cb66c$export$2e2bcd8739ae039","voters","$1090428139f5fe20$export$2e2bcd8739ae039","$c7822207b3410824$export$2e2bcd8739ae039","$79ff5d573d845791$export$2e2bcd8739ae039","$027ff3d7a1d790c2$export$2e2bcd8739ae039","$2266cbfcdcd5b8b3$export$2e2bcd8739ae039","$23b09a1f65961c47$export$2e2bcd8739ae039","$2a17d13d0aa17349$export$2e2bcd8739ae039","$813812d418de76d3$export$2e2bcd8739ae039","$55758a9e8aceb8b6$export$2e2bcd8739ae039","$2f640b767ee089ea$export$2e2bcd8739ae039","$df1e11ac7eec2625$export$2e2bcd8739ae039","$1da972e65817be71$export$2e2bcd8739ae039","$f086f5d770a501ff$export$2e2bcd8739ae039","typeList","order","divsByName","extraDivs","makeComponent","actions","do","firstActions","makeUndo","loadConfigPriority","priority","isHigh","valueArray","execute","history","head","clearHistory","undoCommand","historyItem","undo","last","pair","chainTimer","redo","next","comMessenger","commandStore","$6130f44f768a268d$export$2e2bcd8739ae039","configKeeper","$6332fa552f960b2e$export$2e2bcd8739ae039","$28203dcb19e526a2$export$2e2bcd8739ae039","getConfig","loadConfig","obj","sandboxURL","getLink","encodedConfig","sp","location","sl","join","getFolder","link","navigator","clipboard","writeText","$5b0e6872a2899b94$export$2e2bcd8739ae039","$e0b757014bff90a3$export$2e2bcd8739ae039","$ab56d101b96b38ee$export$2e2bcd8739ae039","$391ef04f7f5158b8$export$2e2bcd8739ae039","undoButton","redoButton","$b18b7541dc28940b$export$2e2bcd8739ae039","$fe9b20ad1af12252$export$2e2bcd8739ae039","$1fe54c51b774a9e8$export$2e2bcd8739ae039","$8ddddc532219b614$export$2e2bcd8739ae039","$705ca8a2f34171f8$export$2e2bcd8739ae039","$cc1b5be8d2aed4c2$export$2e2bcd8739ae039","$24bbb315554fbe91$export$2e2bcd8739ae039","requestAnimationFrame","gameLoop","getElementsByClassName","targetConfig","cu","urlParams","URLSearchParams","search","yes","has","$d5ff4bfd7950f485$export$2e2bcd8739ae039","sandboxurl","$c79d11f6216552bb$export$2e2bcd8739ae039","$474f7ac0806c1369$export$2e2bcd8739ae039","divLink","div1","div2","$e5ac3f639b04e02f$export$2e2bcd8739ae039"],"version":3,"file":"addSandboxes.js.map"}