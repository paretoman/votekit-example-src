{"mappings":"4BAUQA,KAAKC,QAAS,EACdD,KAAKE,WAAa,GAClBF,KAAKG,SAAU,EAGnBC,UAAUC,GACNL,KAAKC,OAASI,EAGlBC,aAAaC,GACTP,KAAKE,WAAWM,KAAKD,GAGzBE,YAAYC,EAASC,GACbX,KAAKC,SAA2B,IAAjBD,KAAKG,SACpBH,KAAKG,SAAU,EACfH,KAAKE,WAAWU,SAASC,GAAQA,EAAIC,OAAOJ,KAC5CV,KAAKG,SAAU,GAEfQ,EAAgBG,OAAOJ,GAI/BK,oBAAoBC,EAAUL,GACtBX,KAAKC,SAA2B,IAAjBD,KAAKG,SACpBH,KAAKG,SAAU,EACfH,KAAKE,WAAWU,SACXC,GAAQA,EAAII,eAAeD,KAEhChB,KAAKG,SAAU,GAEfQ,EAAgBM,eAAeD,GAIvCE,oBAAoBC,EAAWR,GACvBX,KAAKC,SAA2B,IAAjBD,KAAKG,SACpBH,KAAKG,SAAU,EACfH,KAAKE,WAAWU,SACXC,GAAQA,EAAIO,eAAeD,KAEhCnB,KAAKG,SAAU,GAEfQ,EAAgBS,eAAeD,GAIvCE,sBAAsBL,EAAUL,GACxBX,KAAKC,SAA2B,IAAjBD,KAAKG,SACpBH,KAAKG,SAAU,EACfH,KAAKE,WAAWU,SACXC,GAAQA,EAAIS,iBAAiBN,KAElChB,KAAKG,SAAU,GAEfQ,EAAgBW,iBAAiBN,iBC1DzC,MAAMO,EAAOvB,KAEPwB,EAAU,CAAC,QAEjBD,EAAKE,IAAOC,IACRA,EAAWd,SACNe,GAAMH,EAAQhB,KAAKmB,MAG5BJ,EAAKK,MAASF,IACV,IAAIG,EAAI,EAIR,OAHAH,EAAWd,SACNe,IAAQE,GAAKL,EAAQM,SAASH,GAAK,EAAI,KAErCE,EAAI,GAEfN,EAAKQ,UAAS,IAA6B,IAAnBP,EAAQQ,OAChCT,EAAKU,MAAK,KACNT,EAAQU,OAAO,EAAGV,EAAQQ,sBCf9B,MAAMT,EAAOvB,KAGbuB,EAAKY,SAAW,CACZC,MAAK,OACLC,KAAI,OACJC,IAAG,OACHC,UAAS,OACTC,WAAU,OACVC,SAAQ,QAIZlB,EAAKmB,IAAOC,IACRC,OAAOC,OAAOtB,EAAKY,SAAUQ,eCVNG,EAAGC,EAAGC,GACjC,MAAMzB,EAAOvB,KAEbuB,EAAK0B,MAAQH,EACbvB,EAAK2B,OAASH,EAGdxB,EAAK4B,OAASC,SAASC,cAAc,UACrC9B,EAAK4B,OAAOG,aAAa,QAAS,cAClC/B,EAAKgC,IAAMhC,EAAK4B,OAAOK,WAAW,MAGlCjC,EAAKkC,SAAWL,SAASC,cAAc,OACvC9B,EAAKkC,SAASH,aAAa,QAAS,YAGpC/B,EAAKmC,WAAaN,SAASC,cAAc,UACzC9B,EAAKmC,WAAWJ,aAAa,QAAS,cACtC/B,EAAKoC,KAAOpC,EAAKmC,WAAWF,WAAW,MAGvCjC,EAAKqC,KAAOR,SAASC,cAAc,UACnC9B,EAAKqC,KAAKN,aAAa,QAAS,QAChC/B,EAAKsC,KAAOtC,EAAKqC,KAAKJ,WAAW,MAEjC,MAAMM,EAAWV,SAASC,cAAc,OAGxC9B,EAAKwC,KAAOX,SAASC,cAAc,OACnC9B,EAAKwC,KAAKT,aAAa,QAAS,cAChC/B,EAAKwC,KAAKC,YAAYF,GACtBvC,EAAKwC,KAAKC,YAAYzC,EAAK4B,QAC3B5B,EAAKwC,KAAKC,YAAYzC,EAAKkC,UAC3BlC,EAAKwC,KAAKC,YAAYzC,EAAKmC,YAE3BV,EAAOiB,WAAW,aAAc1C,EAAKwC,MACrCf,EAAOiB,WAAW,OAAQ1C,EAAKqC,MAE/BrC,EAAK2C,WAAY,EAIjB3C,EAAK4C,oBAiFcC,GACnB,MAAMC,EAAeD,EAAQE,wBACpBF,EAAQG,8BACRH,EAAQI,2BACRJ,EAAQK,0BACRL,EAAQM,yBACRN,EAAQE,wBAA0B,EAE3C,OAAQK,OAAOC,kBAAoB,GAAKP;;;;;;;;;;;;GAzFtBQ,CAActD,EAAKgC,KAErChC,EAAK4B,OAAOF,MAAQH,EAAIvB,EAAK4C,WAC7B5C,EAAK4B,OAAOD,OAASH,EAAIxB,EAAK4C,WAE9B5C,EAAK4B,OAAO2B,MAAM7B,MAAK,GAAMH,MAC7BvB,EAAK4B,OAAO2B,MAAM5B,OAAM,GAAMH,MAE9BxB,EAAKwC,KAAKe,MAAM7B,MAAK,GAAMH,MAC3BvB,EAAKwC,KAAKe,MAAM5B,OAAM,GAAMH,MAE5BxB,EAAKkC,SAASqB,MAAM7B,MAAK,GAAMH,MAC/BvB,EAAKkC,SAASqB,MAAM5B,OAAM,GAAMH,MAEhCxB,EAAKmC,WAAWT,MAAQH,EAAIvB,EAAK4C,WACjC5C,EAAKmC,WAAWR,OAASH,EAAIxB,EAAK4C,WAElC5C,EAAKmC,WAAWoB,MAAM7B,MAAK,GAAMH,MACjCvB,EAAKmC,WAAWoB,MAAM5B,OAAM,GAAMH,MAElCxB,EAAKqC,KAAKX,MAAQH,EAAIvB,EAAK4C,WAC3B5C,EAAKqC,KAAKkB,MAAM7B,MAAK,GAAMH,MAC3BvB,EAAKwD,cAAiB7B,IAClB,MAAM8B,EAAKC,KAAKC,MAAMhC,GACtB3B,EAAKqC,KAAKuB,cAAgBH,EAC1BzD,EAAKqC,KAAKV,OAAS8B,EAAKzD,EAAK4C,WAC7B5C,EAAKqC,KAAKkB,MAAM5B,OAAM,GAAM8B,MAC5BzD,EAAKsC,KAAKuB,MAAM7D,EAAK4C,WAAY5C,EAAK4C,aAE1C5C,EAAKwD,cAAe,EAAI,EAAKhC,GAE7BxB,EAAKgC,IAAI6B,MAAM7D,EAAK4C,WAAY5C,EAAK4C,YACrC5C,EAAKoC,KAAKyB,MAAM7D,EAAK4C,WAAY5C,EAAK4C,YAEtC5C,EAAKU,MAAQ,WACTV,EAAKgC,IAAI8B,UAAU,EAAG,EAAG9D,EAAK4B,OAAOF,MAAO1B,EAAK4B,OAAOD,SAE5D3B,EAAK+D,gBAAkB,WACnB/D,EAAKoC,KAAK0B,UAAU,EAAG,EAAG9D,EAAKmC,WAAWT,MAAO1B,EAAKmC,WAAWR,SAErE3B,EAAKgE,UAAY,WACbhE,EAAKsC,KAAKwB,UAAU,EAAG,EAAG9D,EAAKqC,KAAKX,MAAO1B,EAAKqC,KAAKV,SAEzD3B,EAAKiE,OAAS,SAAU7D,GACpBJ,EAAKgC,IAAM5B,GAEfJ,EAAKkE,QAAU,SAAU9D,GACrBJ,EAAKoC,KAAOhC,GAEhBJ,EAAKmE,QAAU,SAAU/D,GACrBJ,EAAKsC,KAAOlC,GAEhBJ,EAAKoE,aAAe,SAAUzB,GAC1B3C,EAAK2C,UAAYA,GAErB3C,EAAKqE,SAAQ,KACTrE,EAAKqC,KAAKkB,MAAMe,QAAU,SAE9BtE,EAAKuE,SAAQ,KACTvE,EAAKqC,KAAKkB,MAAMe,QAAU,QAE9BtE,EAAKuE,WAELvE,EAAKwE,cAAgB,IAAIC,EACzB,MAAO7D,SAACA,GAAaZ,EAAKwE,cAE1BxE,EAAKwC,KAAKkC,YAAeC,GAAM/D,EAASC,MAAM8D,GAC9C3E,EAAKwC,KAAKoC,YAAeD,GAAM/D,EAASE,KAAK6D,GAC7C3E,EAAKwC,KAAKqC,UAAaF,GAAM/D,EAASG,IAAI4D,GAC1C3E,EAAKwC,KAAKsC,iBAAiB,aAAcH,GAAM/D,EAASI,UAAU2D,KAClE3E,EAAKwC,KAAKsC,iBAAiB,cAAeH,GAAM/D,EAASK,WAAW0D,KACpE3E,EAAKwC,KAAKsC,iBAAiB,YAAaH,GAAM/D,EAASM,SAASyD,KAGhE,MAAMI,EAAUlD,SAASgD,UACzBhD,SAASgD,UAAaF,IACdI,GAASA,EAAQJ,GACrB3E,EAAKwC,KAAKqC,UAAUF,ICvGpB,IAAAK,EAA6DC,EAAAC,EAAAC,EAAAC,WAEzDC,EAAAC,EAAAC,OACiBC,EAAjBC,EAAApE,OAAYoE,KAAKF,OACjBC,EAAK,EAACA,EAAMC,EAAIhF,OACZ+E,IAAAF,EAAAA,EAAYI,QAAU,IAAKC,OAAM,MAAKF,EAAMD,GAAK,MAAM,MAAMD,EAAAE,EAAAD,KAErE,OAACF,EAIL,SAAmDM,EAAAC,SAC1CC,EAAAN,EACL,IAAKK,EAAQ,MAAE,IAAME,MAAI,iEAAAC,EAAG,sDAC5BF,EAAc,GACd,GAEK,IADkCA,EAAA,GAC9BN,EAAI,EAAGA,EAAA,GAAMA,IAAMM,GAAWE,EAAAtC,KAAAuC,MAAAvC,KAAAwC,SAAAF,EAAAvF,eACnCoF,EAAYC,WACZA,EAsBR,SAA8EK,EAAAC,GAE9E,IAAAC,EAAA,CA4BwDC,WAAA,aACxDC,QAAA,UACiBC,IAAA,mBACTC,OAAkB,kBAClBC,OAAkB,kBAElBL,EAAgBD,IAAiCC,EAAAC,sBAvDeK,EAAAC,GACpE,IAAApB,EAAOqB,EACPC,EADcC,EAAY,GAM1B,IAJHJ,EAAAA,EAAAK,MAAA,KAE0DJ,EAAAA,GAAA,GAE1BpB,EAAA,EAAAA,EAAAmB,EAAAlG,OAAA+E,GAAA,EACzBqB,EAAO,IAAIF,EAAAnB,EAAA,GAAA,IAAAsB,EAAcG,SAAAN,EAAAnB,GAAAoB,GAAEG,EAAOF,GAAM,KAAAC,EAAA,IAAiD,SAAN,SAAM,SAACC,EAmDxEG,CAAA,+rEAAA,MAEJ,CAClBC,YAAC,CACQC,QAAE,SACPxF,OAAO,UACPyF,IAAA,OACAC,MAAY,UAEhBC,UAAC,CACSH,QAAE,OACRxF,OAAO,UACPyF,IAAA,KACAC,MAAa,QAEjBE,QAAC,CACWJ,QAAA,iBACRxF,OAAO,OACPyF,IAAA,OACAC,MAAO,UAEXG,SAAC,CACUL,QAAC,kBACRxF,OAAO,QACPyF,IAAA,QACAC,MAAO,UAEXI,WAAC,CACYN,QAAA,oBACTxF,OAAO,GACPyF,IAAA,EACAC,MAAO,UAEXK,UAAC,CACKP,QAAE,eACJxF,OAA0E,EAC1EyF,IAAA,EACHC,MAAA,sBAEqB,CACrBF,QAAA,UACcxF,OAAA,EACXyF,IAAA,EACHC,MAAA,oBAEG,CAEQ1F,OAAA,mBAEZgG,YAAC,CACUhG,OAAA,WAEXiG,cAAC,CACajG,OAAA,GAEdkG,cAAC,CACSlG,OAAG,cAEE,CACXA,OAAM,GAEVmG,UAAC,CACJnG,OAAA,SAQGwE,aAAc,CACVxE,OAAM,cAKXoG,SAAA,CAEKZ,QAAO,mBACPxF,OAAC,GACDyF,IAAK,KACLC,MAAoD,YAGgDpC,EAAC,SAAA+C,EAAAjG,QACrGkG,OAAKD,EACTxJ,KAAC0J,MACQnG,IAMYoG,UAAAC,aAAA,SAAAC,EAAAC,GACrB,IAAgBC,EAAZC,EAAMhK,KAAM0J,MAAAO,gBAAA,QACnBD,EAAA1G,aAAA,SAAAuG,IAUE,IAAAC,EAAAI,QAAA,SAEmCH,EAAL,kEAAeI,KAAAL,GAAEE,EAAA1G,aAAkB,aAAKsD,EAAA,mBAAA,CAAGwD,EAAOL,EAAA,GAEdM,EAAAN,EAAA,GAC7DO,EAAAP,EAAU,MAEVC,EAAA1G,aAAgB,eAAWyG,EAAA,KAC3BC,EAAQ1G,aAAS,aAAWwG,GAChC9J,KAACyJ,OAAYzF,YACFgG,MAKW,SAAAO,EACkBhH,GACpCvD,KAAAyJ,OAAWc,EAGfvK,KAAe0J,MAAAnG,IAaXiD,EAAqB,SAAWgE,SAChCC,EAAiB,CACpBxH,MAAA,IAEGC,OAAC,IACDwH,iBAAY,GAQhB,GAPIC,UAAC3I,OAAiB,IAEA4I,EAAAH,GACXxH,MAAQ0H,UAAW,GAC1BC,EAAQ1H,OAAAyH,UAAsB,IAE7BC,EADOJ,GAAaC,IAEpBzK,gBAAOwG,GACZ,OAAK,IAAMA,EAAwBoE,GAGnC5K,KAAKiD,MAAQ2H,EAAC3H,OAAAwH,EAAAxH,MAAAjD,KAACkD,OAAA0H,EAAA1H,QAAAuH,EAAAvH,OAEflD,KAAU0K,qBAAAG,IAAAD,EAAAF,gBAAAE,EAAAF,gBAAAD,EAAAC,gBACV1K,KAAKmD,OAASnD,KACdA,KAAK8K,WAAOF,EAAYxH,UAAWA,SAI/BwH,EAAQrH,IAAAvD,KAAA0J,MAAiBkB,EAAArH,KAO9BvD,KAAA+K,SAAA/K,KAAA8K,WAAAzH,cAAA,UAEKrD,KAAA0J,MAAO1J,KAAU+K,SAAgBvH,WACjC,OAGJxD,KAAIgL,qBAEJhL,KAAIiL,QAAW,CACXjL,KAAyGkL,wBAEzGC,aAAQ,GAEZnL,KAAMyJ,OAAKzJ,KAAK8K,WAAUM,gBAAK,6BAAA,YAC3B3B,OAAMnG,aAAM,UAAA,UACZmG,OAAQnG,aAAa,QAAK,8BAC9BtD,KAACyJ,OAAA4B,eAAA,gCAAA,cAAA,gCACDrL,KAAAyJ,OAAOnG,aAAO,QAAAtD,KAAAiD,OACjBjD,KAAAyJ,OAAAnG,aAAA,SAAAtD,KAAAkD,QAOGlD,KAA0EsL,MAAA,QAGtEC,OAAUvL,KAAE8K,WAAAM,gBAAA,6BAAA,aACZ3B,OAAQzF,YAAIhE,KAAAuL,QAEnBvL,KAAAwL,iBAAAxL,KAAA8K,WAAAM,gBAAA,6BAAA,KAMEpL,KAAAyJ,OAAAzF,YAAAhE,KAAAwL,oBAME7B,UAAAM,gBAAA,SAAAwB,EAAAC,EAAAC,QACJ,IAAAD,IAAAA,EAAA,IAQG,IAAqB3E,EAAA6E,EAAjBC,EAAG7L,KAAU8K,WAAIM,gBAAA,6BAAAK,GAAAzE,EAAApE,OAAAoE,KAAA0E,GAKrB,IALwBC,IAEpBE,EAAMvI,aAAM,OAAA,QACZuI,EAAAvI,aAAkB,SAAQ,SAE9ByD,EAAO,EAAAA,EAAAC,EAAUhF,OAAA+E,IACpB6E,EAAA5E,EAAAD,GAME8E,EAAAvI,aAAAsI,EAAAF,EAAAE,IAGF,OAAIC,KAKoBlC,UAAIqB,mBAAA,WAE5B,IAACjE,EAAA6E,EAAA5E,EAAApE,OAAAoE,KAAAT,GAEE,IAAIQ,EAAI,EAAGA,EAAAC,EAAOhF,OAAK+E,IAEnB/G,KADC4L,EAAK5E,EAAMD,IACJR,EAAWqF,GAAEzI,UAQSwG,UAAOmC,kBAAoB,SAAAC,OACxBhF,EAAM6E,WAArB5E,KAAG+E,eACD/J,OAAO+E,iBAEdgF,EAAAH,MAM6FjC,UAAAuB,gBAAA,iBAEzDU,IADlC,YACF5E,KAAKT,eACmDvE,OAAA+E,cAEzD/G,KAAU4L,eAINjC,UAAmBqC,6BAAW,SAAAC,SAC9BjM,KAAAwL,mBAGJxL,KAAAkM,+BAEG5I,aAAa2I,EAAC,MACbE,EAAyBN,UACzBO,SAAWxL,SAAI,SAAOyL,kBAClBJ,EAAA,YAM0BlF,EAAKjC,EAAAzE,EAAAiM,EAAAvC,WAAvC/C,KAAAT,aACHS,EAAAhF,OAAA+E,IAGZ,aADG1G,EAACL,KAAAgH,EAAAD,IACJjC,EAAA+D,MAMF,GAAAxI,aAAAqG,EAAA,CAGU,GAAArG,EAAaqJ,MAGX,KAAKrJ,EAAAqJ,MAAA6B,OAAoBgB,WAAKvK,QAE5CsK,EAAAjM,EAAAqJ,MAAA6B,OAAAgB,WAAA,GAAAC,aAAA,MAOExM,KAAAsL,MAAAgB,GAAAA,EAEetM,KAAOuL,OAAAvH,YAAgB3D,EAAAqJ,MAAA6B,OAAsBgB,WACvD,IAGCE,EAAAnJ,aAAAwB,EAAA+D,MAAAjC,EAAA,aAAA,CACU0F,GAAAjM,EAAUoJ,OACrB+C,aAAa,cAIN,GAAOnM,aAAKoG,EACkDgG,EAAAnJ,aAAAwB,EAAA+D,MAAAjC,EAAA,aAAA,CAC9D0F,GAAIjM,EAACoJ,OAAK+C,aAAc,cAEtB,IAAG,IAAA1H,EAAA+D,MAAAqB,QAAA+B,IAAcnH,EAAG8D,MAAAvI,EACzB,GAA6B,WAApByE,EAAI6D,SAAgB,SAAA7D,EAAA6D,UAAA,IAAAtI,EAAA6J,QAAA,QA0BhC,CACQ,IAAKwC,EAAK5H,EAAA6D,QAC1B,GAAA,gBAAA3B,EAAAD,KAGE2F,EAAAT,EAAA,IAAAnH,EAAA6D,QAEyB8D,EAAKD,aAAgBE,IAAA,SAGnCD,EACNnJ,aAAKoJ,EAAgBrM,OArCY,CAKpC0J,EADI,kEACJI,KAAA9J,GAEMoM,EAAUnJ,aAAAwB,EAAA6D,QAAA/B,EAAA,mBAAA,CACpBwD,EAAAL,EAAA,GAMEM,EAAAN,EAAA,GAEmBO,EAAAP,EAAA,MAMF,IAAC4C,EAAA5C,EAAmB,GAClB6C,EAAA5M,KAAmB4M,YACR,MAAXA,IAAWD,GAAAC,GACtBH,EAAiBnJ,aAAAwB,EAAA6D,QAAA,WAAAgE,OA2BZhD,UAAAkD,oBAA+B,SAAAR,SAAuD,YAA3BrM,KAAOwL,4BAAsB,QAAAa,EAAAS,SAAAT,EAACrM,KAAA6M,oBAAAR,EAAAU,aAQpGvG,EAAAmD,UAAAqD,iBAAA,SAAAC,GAED,IAA8DjG,EAAAD,EAAA6E,EAAAvL,EAAA6M,EAA1DC,GAAY,IAAKC,eAAgBC,kBAAyBrN,KAAAyJ,QAO9D,GAHI,sFAEK6D,KAAKH,KAAAA,EAAAA,EAAAlG,QAAA,oCAAA,8CACVgG,EAOA,IANPjG,EAAApE,OAAAoE,KAAAL,GAMQI,EAAK,EAAAA,EAASC,EACdhF,OAAI+E,IAEJ6E,EAAA5E,EAAcD,GAA8B1G,EAAAsG,EAAAiF,IAAKsB,EAAA,IAAAhG,OAAA0E,EAAA,OAAC0B,KAAAH,KAAAA,EAAAA,EAAAlG,QAAAiG,EAAA7M,IAOvD,OAAI8M,GAC+E3G,EAAAmD,UAAA4D,OAAA,WACtF,OAAAvN,KAAAyJ,QAMyDjD,EAAGmD,UAAA6D,KAAA,WAAA,IAACC,EAAAzN,KAAAiK,gBAAA,KAC7DyD,EAAA1N,KAAA6M,sBAIE7M,KAAAmL,aAAA3K,KAAAkN,GAECA,EAAK1J,YAAcyJ,QAA6CjC,iBAAEiC,OAAGxC,QAAEzK,KAAAR,KAAAkL,oBAAiB1E,EAAGmD,UAAAgE,QAAA,WAAA3N,KAACwL,iBAAAxL,KAAAmL,aAAAyC,MAC/F5N,KAAAkM,yBAAA,KAMOlM,KAAMwL,mBAAMxL,KAAAwL,iBAAAxL,KAAAyJ,OAAA8C,WAAA,IAEhB,IAAyFsB,EAAA7N,KAAAiL,QAAA2C,MACzF5N,KAAuF8L,kBAAA+B,IAI/CrH,EAAImD,UAAAmE,eAAA,SAAAC,GAE5C,IAAAL,EAAO1N,KAAW6M,sBAClB,GAAIa,EAACnB,WAAgBvK,OAAO,EAAA,CAC/B,SAAAhC,KAAAwL,iBAAAsB,WAKE9M,KAAAkM,2BAAAlM,KAAAkM,yBAAA,CAEEL,QAAiB6B,EACdtB,SAAe,KAKtBpM,KAAAkM,yBAAAE,SAAA5L,KAAAR,KAAAwL,kBAKExL,KAAAgO,6BAGK,IAACP,EAAAzN,KAAAiK,gBAA+B,KACvCyD,EAAA1J,YAAAyJ,GAKEzN,KAAAwL,iBAAAiC,EAMC,IAA6CQ,EAAAjO,KAAAwL,iBAAAgB,aAAA,aACzCyB,EAACA,GAAqB,IAACA,EAAG,MAAMF,EAAA/N,KAACwL,iBAAAlI,aAAA,YAAA2K,IACezH,EAAAmD,UAAAvE,MAAA,SAAA8I,EAAAC,QACvDtD,IAAAsD,IAAAA,EAAAD,GAIElO,KAAA8N,eAAAlH,EACH,iBAAI,CACIsH,EAAAA,EAGPC,EAAAA,MAMwC3H,EAAAmD,UAAAyE,OAAA,SAAAC,GACrC,IAAIC,EAAK,IAAAD,EAAApJ,KAAqBsJ,QACkBT,eAAElH,EAAA,4BAAA,CAAEyH,MAAGC,EAACE,GAAA,KAEpD,MAMLhI,EAAAmD,UACH8E,UAAA,SAAAP,EAAIC,GACAnO,KAAK8N,eAAAlH,EAAqB,qBAAA,CAAAsH,EAAGA,EAAGC,EAAGA,MAER3H,EAASmD,UAAAsE,UAAA,SAAAS,EAAApE,EAAA3I,EAAAgN,EAAAzI,EAAA0I,QAAEd,eAASlH,EAAA,kCAAA,CAAE8H,EAAEA,EAAGpE,EAAEA,EAAE3I,EAAAA,EAC7DgN,EAAAA,EAIEzI,EAAAA,EAEK0I,EAACA,MACkDpI,EAAOmD,UAAAkF,UAAA,eAAEC,EAAiB9O,KAAC+O,qBAAA,GACrF/O,KAAAgP,kBAAA,GAOGF,EAAO9O,KAAGiK,gBAAkB,OAAI,IAChC,GAAQjK,KAAQ6M,sBAAS7I,YAAe8K,GAAA9O,KAACwL,iBAAAsD,GAWrCtI,EAAUmD,UAA0BqE,0BAAmB,WAE3D,IAAgDvB,EAAAzM,KAAAwL,iBAChB,SAA5BiB,EAAwBK,SAAWL,EAAiBnJ,aAC9C,IAAAtD,KAAA+O,sBAGuFE,QAAAC,MAAA,0CAAAzC,EAAAK,WAQnCtG,EAAAmD,UAAAwF,iBAAA,SAAAzO,GAC9DV,KAA4E+O,sBAAA,IAC5E/O,KAAM+O,sBAAwBrO,GAQgC8F,EAAAmD,UAAAyF,OAAA,SAAAlB,EAAAC,GACc,SAAAnO,KAAAwL,iBAAAsB,UAAA9M,KAAA6O,iBAC5CG,kBAAO,CAAEd,EAAEA,EAAMC,EAAAA,QACjBgB,iBAAOvI,EAAA,YAAA,CAAEsH,EAAEA,EAAMC,EAAAA,MAMyD3H,EAAAmD,UAAA0F,UAAA,WACiBrP,KAAA+O,sBAAA/O,KAAAmP,iBAAA,MAKvH3I,EAA2BmD,UAAA2F,OAAgB,SAAIpB,EAAAC,GACnDnO,KAAIgP,kBAAkB,CAEHd,EAAAA,EACfC,EAAAA,GAEAnO,KAAA+O,qBAAoB7E,QAAc,MAAE,EAAAlK,KAAAmP,iBAAAvI,EAAA,YAAA,CACvCsH,EAAAA,EACGC,EAAAA,KAEAnO,KAAImP,iBAAkBvI,EAAuB,YAAA,CAEXsH,EAAAA,EACyBC,EAAAA,MAKQ3H,EAAAmD,UAAA4F,cAAA,SAAAC,EAAAC,EAAAC,EAAAC,EAAAzB,EAAAC,GACvEnO,KAAIgP,kBAAA,CACAd,EAAAA,IACCC,GAELnO,KAAImP,iBAAWvI,EAAmB,wCAAA,CAC9B4I,KAAkDA,EAClDC,KAAKA,EACLC,KAAKA,EACLC,KAAKA,MAKRxB,EAAAA,MAQiE3H,EAAAmD,UAAAiG,iBAAA,SAAAC,EAAAC,EAAA5B,EAAAC,GAClEnO,KAAmDgP,kBAAA,CAC/Cd,EAACA,EACRC,EAAAA,GAMGnO,KAAImP,iBAAKvI,EACD,wBAAkB,CAEtBiJ,IAACA,EACDC,IAACA,EACR5B,EAAAA,EAIEC,EAAAA,MAWA,IAAA4B,EAAA,SACHC,GACI,IAAIC,EAAKhL,KAAAiL,KAAAF,EAAiB,GAAAA,EAAa,GAAMA,EACrC,GAACA,EAAS,IAElB,MAAK,CACDA,EAAO,GAAGC,EACVD,EAAO,GAAGC,IAYVzJ,EAA8BmD,UAAGwG,MAAA,SAAAC,EAAAC,EAAAC,EAAAC,EAAAC,OAEjCC,EAAKzQ,KAAAgP,mBAAAhP,KAAAgP,kBAAAd,EACLwC,EAAK1Q,KAAGgP,mBAAKhP,KAAAgP,kBAAAb,EAEjB,QAAO,IAAAsC,QAAA,IAAAC,EAAP,CAEA,GAAAF,EAAO,EAAA,MAAY,IAAIlJ,MAAA,wCAAAkJ,EAAA,kBAcvB,GAAIC,IAAOL,GAACM,IAAAL,GAAsBD,IAAGE,GAAAD,IAAAE,GAAA,IAAAC,EACjCxQ,KAAKsP,OAAAc,EAAAC,OADT,CAOA,IAAAM,EAAmBZ,EAAI,CACnBU,EAACL,EACDM,EAACL,IAQNO,EAAAb,EAAA,CAEKO,EAAAF,EAEAG,EAAAF,IAEJ,GAAKM,EAAQ,GAAWC,EAAa,IAAQD,EAC3B,GACVC,EAAU,GAFlB,KAmBIC,EAAKF,EAAa,GAAAC,EAAA,GAAAD,EAAA,GAAAC,EAAA,GAClBE,EAAM7L,KAAA8L,KAAA9L,KAAA+L,IAAAH,IAENI,EAAoBlB,EAAmB,CACvCY,EAAQ,GAAAC,EAAyB,GACjCD,EAAK,GAAAC,EAAA,KAELM,EAAaV,EAAAvL,KAAAkM,IAAAL,EAAA,GACbM,EAAAhB,EAASc,EAAMD,EAAA,GACfI,EAAIhB,EAAYa,EAAAD,EAAA,GAGvBK,EAAA,EAKEX,EAAA,GAEKA,EAAY,IAGZY,EAAY,CACZX,EAAY,IACZA,EAAY,IAEbY,EAAK,SAAAxB,GAER,IAAO9B,EAAI8B,EAAA,GAMZ,OALFA,EAAA,IAKE,EAAA/K,KAAA8L,KAAA7C,IAEiBjJ,KAAA8L,KAAA7C,IAEZuD,EAAYD,EAAAF,GACZI,EAAYF,EAAAD,QAEZjC,OAAO8B,EAAKE,EAAA,GAAAd,EAAAa,EAAAC,EAAA,GAAAd,GAGhBxQ,KAAG2R,IAAKP,EAAAC,EAAAb,EAAAiB,EAAAC,QA1DJ1R,KAACsP,OAAAc,EAAAC,MAmEN7J,EAAAmD,UAAAiI,OAAA,WAEU,SAAL5R,KAAKwL,iBAAAsB,UAAA9M,KAAAwL,iBAAAlI,aAAA,cAAA,uBACTtD,KAAIgO,4BACJhO,KAAIgM,6BAAQ,WAIRxF,EAA+BmD,UAAAkI,KAAA,WACK,SAApC7R,KAAAwL,iBAAuBsB,UAAa9M,KAAAwL,iBAAAlI,aAAA,cAAA,4BACpC0K,4BACJhO,KAACgM,6BAAA,SAQGxF,EACSmD,UAAQmI,KAAA,SAAU5D,EAAAC,EAAAlL,EAAAC,GAGpB,SAAXlD,KAAOwL,iBAAIsB,UAAA9M,KAAA6O,YACd7O,KAAAoP,OAAAlB,EAAAC,GAQEnO,KAAAsP,OAAApB,EAAAjL,EAAAkL,GAECnO,KAAIsP,OAAKpB,EAAOjL,EAAAkL,EAAAjL,QACZoM,OAAQpB,EAAAC,EAAKjL,QACZoM,OAACpB,EAAAC,QACDkB,aAIR7I,EAAAmD,UAAAoI,SAAA,SAAA7D,EAAAC,EAAAlL,EAAAC,GASE,IAAA4O,EAECA,EAAI9R,KAAOiK,gBAAgB,OACvB,CAEIiE,EAAaA,EACbC,EAAWA,EACXlL,MAAYA,EACZC,OAAaA,OAEPlD,KAAC6M,sBACJ7I,YAAI8N,QACMtG,iBAAEsG,OACI9F,6BAAE,SAgBzBxF,EAA+BmD,UAAAqI,WAAA,SAAA9D,EAAAC,EAAAlL,EAAAC,GACtC,IAAA4O,EAOEA,EAAA9R,KAAAiK,gBAAA,OAAA,CAEKiE,EAACA,EACRC,EAAAA,EAMElL,MAAAA,EAEKC,OAAOA,IACX,GACHlD,KAAA6M,sBAIE7I,YAAA8N,GAEC9R,KAAwDwL,iBAAAsG,EACxD9R,KAAIgM,6BACA,WAgB4CxF,EAAAmD,UAAAsI,cAAA,WAWhD,IAVA,IACqBhE,EAAjBjO,KAAI6M,sBAAaL,aAAA,aAGjB0F,EAAAlS,KAAgByJ,OAChB8C,WAAe,KAEH2F,EAAU3F,WAGrBxF,EAAOwF,EAAQvK,OAAM,EAAA+E,GAAA,EAAAA,IAAAwF,EAAAxF,IAAAmL,EAAAC,YAAA5F,EAAAxF,IAC1B/G,KAAKwL,iBAAiB0G,OACN/G,aAAS,GAAE8C,GAAAjO,KAAe8N,eAAAG,IAA6DzH,EAASmD,UAAAtE,UAAA,SAAA6I,EAAAC,EAAAlL,EAAAC,GAEhH,GAAK,IAADgL,GAAC,IAAAC,GAAqBlL,IAAAjD,KAAAiD,OAAAC,IAAAlD,KAAAkD,OAA1B,CACH,IAAA4O,EAAApE,EAAA1N,KAAA6M,sBAIEiF,EAAA9R,KAAAiK,gBAAA,OAAA,CAEKiE,EAAAA,EAKAC,EAACA,EACLlL,MAAMA,EACNC,OAASA,EACT2O,KAAS,YAET,GAEAnE,EAAiC1J,YAAA8N,QAnBP9R,KAAGiS,iBAuBdzL,EAAAmD,UAAAyI,qBAAA,SAAAhC,EAAAC,EAAAC,EAAAC,GACf,IAAA8B,EAAMrS,KAAAiK,gBAAoB,iBAAA,CAEtBqC,GAACnF,EAA2BnH,KAAAsL,OAEnC8E,GAAAA,EAAA,KAMEE,GAAAA,EAAA,KAEoCD,GAAAA,EAAA,KAC/BE,GAAIA,EAAG,KAKP+B,cAAiB,kCAEjB/G,OAAKvH,YAAMqO,GACT,IAAG5L,EAAW4L,EAAArS,OAKhBwG,EAAWmD,UAAA4I,qBAAA,SAAA9B,EAAAC,EAAA8B,EAAApC,EAAAC,EAAAoC,OACXJ,EAAKrS,KAAMiK,gBAAA,iBAAA,CACXqC,GAAEnF,EAASnH,KAAAsL,OACXkD,GAAE4B,EAAO,KACTsC,GAAErC,EAAG,KACLjG,EAAEqI,EAAG,KACRE,GAAMlC,EAAI,KACPmC,GAAElC,EAAO,KACT4B,cAAW,kCAEX/G,OAAKvH,YAAMqO,GACT,IAAG5L,EAAM4L,EAAArS,OAQfwG,EAAcmD,UAAmBkJ,YAAA,WACjC,IACIC,EADC,sVACD3I,KAAiCnK,KAAA+S,MACjCC,EAAK,CACLlO,MAAmFgO,EAAA,IAAA,SACnFG,KAAwEH,EAAA,IAAA,OACxEI,OAAMJ,EAAM,IAAS,aACrBK,OAAQL,EAAA,IAAc,oBACXA,EAAI,IAAY,0BAIP,qCAAiBE,EAAAI,WAAY,kBAE7CC,aAAYL,EAAAM,KAAYtT,KAAAqT,iBAYvB1J,UAAA4J,eAAA,SAAAR,EAAAlH,MACLkH,EAACO,KAAA,CACJ,IAAM5E,EAAI1O,KAAMiK,gBAAkB,KAG/B,OAFAyE,EAAArD,eAAgB,+BAAuB,aAAA0H,EAAAO,MACvC5E,EAAA1K,YAAS6H,GACT6C,SAGE7C,GASFrF,EAAiCmD,UAAE6J,YAAA,SAAkBC,EAAAvF,EAAAC,EAAAuF,OA9jCOpK,EAE3B1B,EA6jCjCmL,EAAA/S,KAAS6S,cAA6CnF,EAAA1N,KAAA6M,sBAAc8G,EAC1D3T,KAAAiK,gBAAqB,OAAS,CACxC,cAAO8I,EAAYG,OACtB,YAAgBH,EAAAE,KACb,aAAWF,EAAKjO,MAChB,cAASiO,EAAAI,OACT,kBAASJ,EAAqBK,WAC9BlF,EAAAA,EAEAC,EAAqEA,EACrE,eAzkC4D7E,EAykCbtJ,KAAAsJ,UAvkCd1B,EAAA,CACjCgM,KAAO,QAAIC,MAAY,MAAgBC,OAAS,SAAa1R,MAAwB,QAAEE,IAAQ,OAAuCsF,EAAA0B,IAAA1B,EAAAxF,OAukCtI,oBAAiBsF,EAAA1H,KAAA2H,qBAEV3D,YAAUhE,KAAA8K,WAAeiJ,eAAAN,SAChCjI,iBAAQmI,OACR3H,6BAAQ0H,KACR1P,YAAQhE,KAAAuT,eAAyBR,EAAKY,KAQzCnN,EAAAmD,UAAAqK,SAAA,SAAAP,EAAAvF,EAAAC,GACJnO,KAAAwT,YAAAC,EAAAvF,EAAAC,EAAA,SAYO3H,EAAgBmD,UAAAsK,WAAA,SAAAR,EAAAvF,EAAAC,QAChBqF,YAAWC,EAAMvF,EAAAC,EAAA,WAMjB3H,EAAWmD,UAAAuK,YAAA,SAAAT,eACX/J,MAAKqJ,KAAM/S,KAAA+S,KACT/S,KAAG0J,MAAMwK,YAAKT,IAIhBjN,EAAMmD,UAAAgI,IAAA,SAAAzD,EAAAC,EAAAqC,EAAAiB,EAAAC,EAAAyC,MAEN1C,IAAWC,OACA,EAAAzM,KAAAsJ,UACA,EAAAtJ,KAAAsJ,SAENmD,EAAM,EAAAzM,KAAAsJ,GAAA,MAAA4F,GAAA,EAAA,KAAA,EAAAlP,KAAAsJ,KACf,IAAC6F,EACGlG,EAAMsC,EAA6DvL,KAAA4L,IAAAa,GAAA2C,EAAAlG,EAAAqC,EAAAvL,KAAAkM,IAAAO,GAAG4C,EAAgBpG,EAAAsC,EAAAvL,KAAA4L,IAAAY,GAAA8C,EAAApG,EAAAqC,EAAAvL,KAAAkM,IAAAM,GAAA+C,EAAAL,EAAA,EAAA,EAAAM,EAAA,EAAAC,EAAAhD,EAAAD,EAItFiD,EAAC,IAAAA,GAAgB,EAAAzP,KAAAsJ,IACCkG,EAAlBN,EAAiCO,EAAKzP,KAAOsJ,GAAK,EAAM,EACnDmG,EAAYzP,KAAAsJ,GAChB,EAAA,OAADe,OAAIgF,EAAMC,yBACM3N,EAAoB,uEAAoB,IACpD4J,KACAA,gBACM,eACIiE,YACND,OACJJ,mCAGiB,cAOTzK,UAAkBgL,KAAA,iBACtB3U,KAAI6M,sBACA+H,EAAkB5U,KAAGiK,gBAAgB,YAAIqC,EAAAnF,EAAkBnH,KAAAsL,OAAAuJ,EAAA7U,KAAAiK,gBAAA,oDAIzDjK,KAAAwL,iCACC,KAAAc,KACVtI,YAAAhE,KAAAwL,uBACJD,OAAAvH,YAAA4Q,GAERnH,EAAAnK,aAAA,YAAAsD,EAAA,aAAA,CAIE0F,GAAAA,KAMCmB,EAAAzJ,YAAQ6Q,GACR7U,KAAIwL,iBAA2BqJ,GAO3BrO,EAAwBmD,UAAOmL,UAAA,eAEcC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAA1H,EAAA9E,EAAAyM,EAAA5H,EAAA6H,EAAAnS,EAAAiB,EAAAkI,EAA7CxF,EAAOyO,MAAC5L,UAAY6L,MAAMC,KAAO9K,WAAY+K,EAAA5O,EAAA,GAAA6O,EAAA,EAAAC,EAAA,KACjC,IAAZ9O,EAAK9E,OACR+S,EAAAjO,EAAA,GACDkO,EAAOlO,EAAI,GAIPmO,EAHPE,EAAAO,EAAAzS,QAEDmS,EAAAM,EAAAxS,YAMC,GAAA,IAAA4D,EAAA9E,OAIE+S,EAAAjO,EAAA,GACyCkO,EAAAlO,EAAA,GAC5CmO,EAAAnO,EAAA,GAA8CoO,EAAApO,EAAA,GAC9CqO,EAAAO,EAAAzS,MAA2CmS,EAAAM,EAAAxS,WAC3C,CAAA,GAAI,IAAJ4D,EAAA9E,6FAA2C2T,EAAA7O,EAAA,GAC3C8O,EAAA9O,EAAA,GAAuDqO,EAAArO,EAAA,GACvDsO,EAAAtO,EAAA,GAA2CiO,EAAAjO,EAAA,GAEvCkO,EAAAlO,EAAA,GAERmO,EAAAnO,EAAA,g2GChwCqC+O,EAAQC,EAAM9S,GAC/C,MAAMF,EAAI+S,EAAO5S,MACXF,EAAI8S,EAAO3S,OAEX6S,EAAW3S,SAASC,cAAc,OACxCL,EAAOiB,WAAW,WAAY8R,GAG9B,MAAMC,EAAS5S,SAASC,cAAc,UACtC2S,EAAOC,UAAY,UACnBD,EAAOE,UAAY,WACnBF,EAAOG,mBA0DH,MAAMC,EAAMP,EAAOtS,IACb8S,EAAOR,EAAOlS,KACpBkS,EAAOrQ,OAAO8Q,GACdT,EAAOpQ,QAAQ6Q,GACfT,EAAOlQ,cAAa,GAEpB,MAAM4Q,EAAOV,EAAOhS,KACpBgS,EAAOnQ,QAAQ8Q,GAGf,MAAOrR,cAACA,GAAkB0Q,EAAOjS,KAtBdV,EAuBLiC,EAtBdsR,EAAQ3R,MAAM5B,OAAM,GAAM+B,KAAKC,MAAMhC,OACrCuT,EAAQvT,OAASA,EAEjBsT,EAAQ/M,OAAOnG,aAAa,SAAUJ,GAsBtC4S,eAaAY,EAAcC,QAAS,EAEvB,MAAM/N,EAAM0N,EAAOtJ,kBAAiB,GACpC4J,EAAOC,UAAYjO,EACnBgO,EAAOD,QAAS,EAChBG,EAAaH,QAAS,EACtB,MAAMI,EAAG,oCAAuCC,mBAAmBpO,KACnEkO,EAAaxD,KAAOyD,EAnBpBE,cAsBA,MAAMC,EAAOV,EAAQxJ,kBAAiB,GACtCyJ,EAAQI,UAAYK,EACpBT,EAAQE,QAAS,EACjBQ,EAAcR,QAAS,EACvB,MAAMS,EAAI,oCAAuCJ,mBAAmBE,KACpEC,EAAc7D,KAAO8D,EA1BrBC,GAGAxB,EAAOrQ,OAAO4Q,GACdP,EAAOpQ,QAAQ4Q,GACfR,EAAOlQ,cAAa,GAEpBkQ,EAAOnQ,QAAQ6Q,OAnCIrT,GA7CvB6S,EAAS/R,YAAYgS,GAGrB,MAAMc,EAAe1T,SAASC,cAAc,KAC5CyT,EAAaZ,UAAY,eACzBY,EAAaQ,SAAW,WACxBR,EAAaH,QAAS,EACtBG,EAAahS,MAAMyS,OAAS,MAC5BxB,EAAS/R,YAAY8S,GAGrB,MAAMK,EAAgB/T,SAASC,cAAc,KAC7C8T,EAAcjB,UAAY,mBAC1BiB,EAAcG,SAAW,eACzBH,EAAcR,QAAS,EACvBQ,EAAcrS,MAAMyS,OAAS,MAC7BxB,EAAS/R,YAAYmT,GAGrB,MAAMT,EAAgBtT,SAASC,cAAc,UAC7CqT,EAAcT,UAAY,UAC1BS,EAAcR,UAAY,WAC1BQ,EAAcC,QAAS,EACvBD,EAAcP,mBAgFVO,EAAcC,QAAS,EAEvBC,EAAOD,QAAS,EAChBG,EAAaH,QAAS,EAEtBF,EAAQE,QAAS,EACjBQ,EAAcR,QAAS,GArF3BZ,EAAS/R,YAAY0S,GAGrB,MAAME,EAASxT,SAASC,cAAc,OACtCuT,EAAOtT,aAAa,QAAS,UAC7BsT,EAAO9R,MAAM7B,MAAK,GAAMH,MACxB8T,EAAO9R,MAAM5B,OAAM,GAAMH,MACzB6T,EAAOD,QAAS,EAChBZ,EAAS/R,YAAY4S,GAGrB,MAAMH,EAAUrT,SAASC,cAAc,OACvCoT,EAAQnT,aAAa,QAAS,WAC9BmT,EAAQ3R,MAAM7B,MAAK,GAAMH,MACzB2T,EAAQ3R,MAAM5B,OAAM,GAAM+B,KAAKC,MAAMnC,EAAI,OACzC0T,EAAQE,QAAS,EACjBZ,EAAS/R,YAAYyS,GAErB,MAAMH,EAAS,IAAIkB,EAAI1U,EAAGC,GACpByT,EAAU,IAAIgB,EAAI1U,EAAGmC,KAAKC,MAAMnC,EAAI,eCzDf0U,EAAcC,GACzC,MAAMnW,EAAOvB,KAEbuB,EAAKoW,OAASF,EACdlW,EAAKqW,KAAOH,EAAaG,KACzBrW,EAAKsW,WAAaJ,EAAaI,aAAc,EAC7CtW,EAAKuW,IAAM1U,SAASC,cAAc,OAClC9B,EAAKuW,IAAIxU,aAAa,QAAS,kBAG/B,IAAIyU,EAAYN,EAAaF,OAC7BQ,EAAYA,GAAa,EACzBA,EAAY9S,KAAK+S,IAAID,EAAW,GAChCxW,EAAKuW,IAAIhT,MAAMmT,YAAW,GAAMF,MAGhCxW,EAAKuU,KAAO,WACJvU,EAAKsW,WACLtW,EAAKuW,IAAIjB,UAAYtV,EAAKqW,KAE1BrW,EAAKuW,IAAI5B,UAAY3U,EAAKqW,MAGlCrW,EAAKuU,OACLvU,EAAKuW,IAAIxU,aAAa,QAASmU,EAAaS,UAAY,IACxD3W,EAAK4W,QAAU,WACXT,EAASnW,EAAMkW,IAEnBlW,EAAKuW,IAAI3B,QAAU5U,EAAK4W,QAExB5W,EAAK6W,QAAU,WACX7W,EAAK8W,MAAO,EACZ9W,EAAKoW,OAAOU,MAAO,EACnB9W,EAAKuW,IAAIxU,aAAa,KAAM,OAEhC/B,EAAK+W,OAAS,WACV/W,EAAK8W,MAAO,EACZ9W,EAAKoW,OAAOU,MAAO,EACnB9W,EAAKuW,IAAIxU,aAAa,KAAM,QAEhC/B,EAAK6W,qBCvC2BG,GAChC,MAAMhX,EAAOvB,KACbuB,EAAKoW,OAASY,OAIM1N,IAAhB0N,EAAOvF,OACPuF,EAAOvF,KAAO,QACUnI,IAApB0N,EAAOC,WACPD,EAAOC,SAAQ,IAAS,IAE5BjX,EAAKiX,SAAWD,EAAOC,SACvBjX,EAAKkX,cAAgBlX,EAAKiX,WAC1BjX,EAAKmX,YAAa,GAEtBnX,EAAKkX,cAAgBF,EAAOvF,KAE5BzR,EAAKoX,UAAYJ,EAAOK,MACxBrX,EAAKsX,YAAcN,EAAOM,cAAe,EAEzCtX,EAAKmW,SAAWa,EAAOb,SACvBnW,EAAKuX,WAAaP,EAAOO,aAAc,EACvCvX,EAAKwX,eAAiBR,EAAOQ,iBAAkB,EAC/CxX,EAAKyX,WAAaT,EAAOS,aAAc,EACvCzX,EAAK0X,aAAeV,EAAOU,cAAgB,GAG3C1X,EAAKuW,IAAM1U,SAASC,cAAc,OAClC9B,EAAKuW,IAAIxU,aAAa,QAAS,gBAE/B/B,EAAK2X,iBAAmB,GAExB3X,EAAK4X,KAAO,WACJ5X,EAAKmX,aAAYnX,EAAKkX,cAAgBlX,EAAKiX,YAG/CjX,EAAKuW,IAAIjB,UAAY,GACrBtV,EAAK6X,QAAU,GACf7X,EAAK8X,cAAgB,GAGrB9X,EAAK+X,SAAWlW,SAASC,cAAc,OACvC9B,EAAK+X,SAAShW,aAAa,QAAS,sBACpC/B,EAAKuU,OACLvU,EAAK+X,SAASC,UAAUC,OAAO,SAC/BjY,EAAK+X,SAASnD,QAAO,KACjB5U,EAAK+X,SAASC,UAAUC,OAAO,UAEnCjY,EAAKuW,IAAI9T,YAAYzC,EAAK+X,UAG1B,IAAK,IAAIvS,EAAI,EAAGA,EAAIxF,EAAKkX,cAAczW,OAAQ+E,IAAK,CAChD,MAAM0S,EAAOlY,EAAKkX,cAAc1R,GAC1BiP,EAAS,IAAI0D,EAAOD,EAAMlY,EAAKoY,UACrCpY,EAAK8X,cAAcI,EAAK7B,MAAQ5B,EAChCA,EAAO8B,IAAIhT,MAAM7B,MAAK,GAAMsV,EAAOtV,UAC/BwW,EAAKxW,QAAO+S,EAAO8B,IAAIhT,MAAM7B,MAAK,GAAMwW,EAAKxW,WACjD1B,EAAK6X,QAAQ5Y,KAAKwV,GAClBzU,EAAKuW,IAAI9T,YAAYgS,EAAO8B,KAC5BvW,EAAK2X,iBAAiBO,EAAKpZ,OAAS2V,EAAO8B,IAI/C,IAAK,IAAI8B,EAAI,EAAGA,EAAIrY,EAAK6X,QAAQpX,OAAQ4X,IAAK,CAC1C,MAAM5D,EAASzU,EAAK6X,QAAQQ,GAC5B,GAAI5D,EAAO2B,OAAOkC,SAAU,CACxB7D,EAAOsC,SACP,OAGR/W,EAAKuU,QAETvU,EAAKuY,YAAc,WACf,MAAMC,EAAQxY,EAAKiX,WACnB,IAAK,IAAIzR,EAAI,EAAGA,EAAIxF,EAAKkX,cAAczW,OAAQ+E,IAC3CxF,EAAKkX,cAAc1R,GAAG6Q,KAAOmC,EAAMhT,GAAG6Q,KACtCrW,EAAK6X,QAAQrS,GAAG6Q,KAAOrW,EAAKkX,cAAc1R,GAAG6Q,MAGrDrW,EAAKyY,OAAS,WACVzY,EAAKuY,cACLvY,EAAKuU,QAETvU,EAAKuU,KAAO,WACJvU,EAAKsX,YACLtX,EAAK+X,SAASzC,UAAYtV,EAAKoX,UAE/BpX,EAAK+X,SAASpD,UAAY3U,EAAKoX,UAEnC,IAAK,MAAM3C,KAAUzU,EAAK6X,QACtBpD,EAAOF,QAIfvU,EAAK0Y,gBAAkB,WACnB,IAAK,MAAOC,EAAYvD,KAAW/T,OAAOuX,QAAQ5Y,EAAK0X,cACnD1X,EAAK8X,cAAca,GAAYpC,IAAInB,OAASA,GAKpDpV,EAAKoY,SAAW,SAAU3D,EAAQoE,GAC9B,GAAI7Y,EAAKuX,YAAcvX,EAAKwX,eACpB/C,EAAOqC,KACPrC,EAAOoC,UAEPpC,EAAOsC,aAER,CAEH,IAAK,IAAIvR,EAAI,EAAGA,EAAIxF,EAAK6X,QAAQpX,OAAQ+E,IAAKxF,EAAK6X,QAAQrS,GAAGqR,UAC9DpC,EAAOsC,SACH/W,EAAKyX,YAELqB,YAAU,IAAOrE,EAAOoC,WAAW,KAI3C7W,EAAKmW,SAAS0C,IAIlB7Y,EAAK+Y,UAAY,SAAUC,EAAUC,GAEjC,GAA4B,IAAxBjZ,EAAK6X,QAAQpX,OAAjB,CAGA,IAAK,IAAI+E,EAAI,EAAGA,EAAIxF,EAAK6X,QAAQpX,OAAQ+E,IAAKxF,EAAK6X,QAAQrS,GAAGqR,UAE9D,GAAI7W,EAAKuX,WACL,IAAK,MAAM2B,KAAOlZ,EAAK6X,QAAS,CAC5B,MAAMsB,EAAKnZ,EAAK6X,QAAQqB,GACpBD,EAAU1Y,SAAS4Y,EAAG/C,OAAO4C,KAC7BG,EAAGpC,cAGR,GAAI/W,EAAKwX,eACZ,IAAK,MAAM4B,KAAOpZ,EAAK6X,QAAS,CAC5B,MAAMsB,EAAKnZ,EAAK6X,QAAQuB,GAClBT,EAAaQ,EAAG/C,OAAO4C,GAEzBL,KAAcM,GACVA,EAAUN,IACVQ,EAAGpC,aAIZ,CAEH,MAAMsC,EAAYrZ,EAAK6X,QAAQyB,QAAQ7E,IACnC,MAAO2B,OAACA,GAAW3B,EACnB,OAAQ2B,EAAO4C,KAAcC,KAC9B,QACe3P,IAAd+P,GACAA,EAAUtC,YAKtB/W,EAAK4X,kBCjJwB2B,EAAQC,EAAMC,EAASpC,EAAOhO,EAASqQ,EAAQzZ,EAASjB,GACrF,MAAMgB,EAAOvB,KACbuB,EAAK2Z,KAAOtQ,EACZrJ,EAAKmW,SAAW,SAAU1E,GACtBzR,EAAK4Z,OAAOC,GAAGpI,EAAK3S,QAExBkB,EAAKmS,OAAUrT,IACXkB,EAAKmB,IAAIrC,GACTkB,EAAK8Z,UAET9Z,EAAK4Z,OAAS5a,EAAU+a,UAAU,CAC9B1D,KAAMmD,EACNrH,OAAQnS,EAAKmS,OACb6H,aAAcT,EAAOC,KAEzBxZ,EAAKmB,IAAM,SAAUrC,GAGjB2a,EAAQ3a,GAERkB,EAAKia,YAELha,EAAQC,IAAIwZ,IAEhB1Z,EAAKka,OAAS,IAAIC,EAAY,OAC1B9C,EACA3V,MAAO0Y,EAAY,GACnB3I,KAAMzR,EAAK2Z,KACXxD,SAAUnW,EAAKmW,WAEnBnW,EAAKia,UAAY,aAEjBja,EAAK8Z,OAAS,WACV9Z,EAAKka,OAAOnB,UAAU,QAASQ,EAAOC,cAIrCY,EAAYC,GASjB,OAHc,IAFD,IAG0BA,EAAa,GAAK,IACtBA,aCzDVpa,EAASwB,EAAQzC,GAC1C,MAAMgB,EAAOvB,KACbuB,EAAKsa,QAAUzY,SAASC,cAAc,OACtCL,EAAOiB,WAAW,OAAQ1C,EAAKsa,SAC/Bta,EAAKua,YAAc,SAAUhB,EAAQiB,GACjC,MAAOhB,KACHA,EAAIC,QAAEA,EAAOpC,MAAEA,EAAKhO,QAAEA,EAAOqQ,OAAEA,GAC/Bc,EAGEC,EAAW,IAAIC,EAASnB,EAAQC,EAAMC,EAASpC,EAAOhO,EAASqQ,EAAQzZ,EAASjB,GACtFyb,EAASX,SAET9Z,EAAKsa,QAAQ7X,YAAYgY,EAASP,OAAO3D,iBChBMoE,GACnD,MAEMC,WAyBMD,GAEZ,MAAME,EAAaF,EAAuBG,KAAKC,GAAOA,EAAGC,OAAOzZ,IAE1D0Z,EAAgBJ,EAAWK,QAAM,CAAEC,EAAG/a,IAAM+a,EAAI/a,IAGhDgb,EAAMP,EAAWC,KAAKK,GAAMA,EAAIF,IAMhCL,EAAM,GAOZ,OANAQ,EAAIF,QAAM,CAAEC,EAAG/a,EAAGoF,KACd,MAAM2H,EAAIgO,EAAI/a,EAEd,OADAwa,EAAIpV,GAAK2H,EACFA,IACR,GAEIyN,EA7CKS,CAAOV,GAFNlc,KAGR6c,YAAc,WACf,gBAIcX,EAAwBC,GAE1C,MAAMW,WASkBX,GAGxB,MAAMY,EAAU9X,KAAKwC,SAErB,OAD2B0U,EAAIa,WAAW9O,GAAMA,GAAK6O,IAbvCE,CAAmBd,GAC3BG,EAAKJ,EAAuBY,GAE5BI,EAA0C,aAA7BZ,EAAGC,OAAOY,eAG7B,OAFgBD,EAAcE,EAAiBC,GAC1Bf,EAAGC,OAAOrO,EAAiB,GAAdoO,EAAGC,OAAOzZ,GAXjCwa,CAAapB,EAAwBC,aA8C3CkB,EAAqBE,EAAGC,GAE7B,MAAO,IADoB,EAAhBvY,KAAKwC,SAAe,GAAK+V,EAAID,YAInCH,EAAeG,EAAGC,GAGvB,MAAMC,EAAKxY,KAAKwC,SACViW,EAAKzY,KAAKwC,SAMhB,MAAO,GAJQ,EAAI+V,EAAKvY,KAAKiL,KAAK,EAAIjL,KAAKsJ,IACvBtJ,KAAKiL,MAAK,EAAKjL,KAAK0Y,IAAIF,IAC5BxY,KAAK4L,IAAI,EAAI5L,KAAKsJ,GAAKmP,GAAMH,cChEMrB,GACnD,MAEMC,WAuBMD,GAEZ,MAAM0B,EAAkB1B,EAAuBG,KAAKC,GAAOA,EAAGuB,OAAO/a,GAAK,IAEpEgb,EAAqBF,EAAgBnB,QAAM,CAAEC,EAAG/a,IAAM+a,EAAI/a,IAG1Dgb,EAAMiB,EAAgBvB,KAAKK,GAAMA,EAAIoB,IAMrC3B,EAAM,GAOZ,OANAQ,EAAIF,QAAM,CAAEC,EAAG/a,EAAGoF,KACd,MAAM2H,EAAIgO,EAAI/a,EAEd,OADAwa,EAAIpV,GAAK2H,EACFA,IACR,GAEIyN,EA3CK4B,CAAO7B,GAFNlc,KAGR6c,YAAc,WACf,gBAIcX,EAAwBC,GAE1C,MAAMW,WAOkBX,GAGxB,MAAMY,EAAU9X,KAAKwC,SAErB,OAD2B0U,EAAIa,WAAW9O,GAAMA,GAAK6O,IAXvCiB,CAAmB7B,GAC3BG,EAAKJ,EAAuBY,GAGlC,gBAkCwBS,EAAGU,EAAGT,GAE9B,MAAMpT,EAAIoT,EAAIvY,KAAKiL,KAAKjL,KAAKwC,UACvBqJ,EAAwB,EAAhB7L,KAAKwC,SAAexC,KAAKsJ,GAIjCL,EAAIqP,EAAInT,EAAInF,KAAK4L,IAAIC,GACrB3C,EAAI8P,EAAI7T,EAAInF,KAAKkM,IAAIL,GAC3B,MAAO,GAAE5C,IAAGC,GA5CE+P,CAAmB5B,EAAGuB,OAAO3P,EAAGoO,EAAGuB,OAAO1P,EAAiB,GAAdmO,EAAGuB,OAAO/a,GAT1Dqb,CAAajC,EAAwBC,eCFTiC,EAAK5c,GAC5C,MAAMD,EAAOvB,KAEPqe,EAAY,GAClB9c,EAAK+c,cAAa,KAAA,CAAYC,OAAM,SAIpChd,EAAKid,aAAe,SAAUC,GAC1BJ,EAAU7d,KAAKie,GACfA,EAASC,QAAQC,YAAYpd,EAAK+c,gBAItC/c,EAAKqd,6BAA4B,IACnBP,EAAUxD,QAAQ4D,GAAaA,EAASI,MAAMC,SAK5Dvd,EAAKwd,0BAAyB,IACNxd,EAAKqd,+BACNvC,KAAKoC,GAAaA,EAASI,QAElDtd,EAAKyd,6BAA4B,IAASX,EAAUhC,KAAKoC,GAAaA,EAASI,QAI/Etd,EAAK0d,OAAM,KACHzd,EAAQO,aAEZR,EAAK2d,gBAGT3d,EAAK2d,aAAY,KACb,MAAMC,EAAa5d,EAAKwd,4BACxB,GAA0B,IAAtBI,EAAWnd,OAAc,OAC7B,MAAOod,WAACA,GAAehB,EAAIiB,SACrBC,EAA6B,IAAfF,EACdG,EACAC,EACNje,EAAKke,QAAU,IAAIH,EAAWH,IAElC5d,EAAKme,SAAQ,KACTrB,EAAUzd,SAAS6d,GAAaA,EAASI,MAAMa,cAKnDne,EAAKgd,OAAM,KACPF,EAAUzd,SAAS6d,IACXA,EAASI,MAAMC,QAAQL,EAASC,QAAQiB,SAASpB,aAI7Dhd,EAAKod,YAAeL,IAChB/c,EAAK+c,cAAgBA,EACrBD,EAAUzd,SAAS6d,GAAaA,EAASC,QAAQC,YAAYL,MAEjE/c,EAAKqe,iBAAgB,KACbxB,EAAIyB,WACJte,EAAKue,sBAELve,EAAKwe,4BAGbxe,EAAKwe,yBAAwB,KACzB1B,EAAUzd,SAAS6d,IACXA,EAASI,MAAMC,QAAQL,EAASC,QAAQkB,uBAGpDre,EAAKue,oBAAmB,KACpBzB,EAAUzd,SAAS6d,GAAaA,EAASC,QAAQkB,sBCnFmC,SACnFI,IACL,MAAM,IAAI1Y,MAAM,4CAEX2Y,IACL,MAAM,IAAI3Y,MAAM,qCAEpB,IAEI4Y,EAFAC,EAAmBH,EACnBI,EAAqBH,WAgBhBI,EAAWC,GAChB,GAAIH,IAAqB9F,WAErB,OAAOA,WAAWiG,EAAK,GAG3B,IAAKH,IAAqBH,IAAqBG,IAAqB9F,WAEhE,OADA8F,EAAmB9F,WACZA,WAAWiG,EAAK,GAE3B,IAEI,OAAOH,EAAiBG,EAAK,GAC/B,MAAMpa,GACJ,IAEI,OAAOia,EAAiB1K,KAAK,KAAM6K,EAAK,GAC1C,MAAMpa,GAEJ,OAAOia,EAAiB1K,KAAKzV,KAAMsgB,EAAK,KA1BZ,mBANpCJ,EADkB,oBAAXvb,OACSA,OACO,oBAATpD,KACEA,KAEA,IAEK8Y,aACrB8F,EAAmB9F,YAEmB,mBAA/B6F,EAAcK,eACrBH,EAAqBG,cAuDzB,IAEIC,EAFAC,EAAQ,GACRC,GAAW,EAEXC,GAAa,WAERC,IACAF,GAAaF,IAGlBE,GAAW,EACPF,EAAaxe,OACbye,EAAQD,EAAaK,OAAOJ,GAE5BE,GAAa,EAEbF,EAAMze,QACN8e,cAICA,IACL,IAAIJ,EAAJ,CAGA,IAAIK,EAAUV,EAAWO,GACzBF,GAAW,MAEX,IAAIzQ,EAAMwQ,EAAMze,OACViO,GAAK,KACPuQ,EAAeC,EACfA,EAAQ,KACCE,EAAa1Q,GACduQ,GACAA,EAAaG,GAAYK,MAGjCL,GAAa,EACb1Q,EAAMwQ,EAAMze,OAEhBwe,EAAe,KACfE,GAAW,WAnEUO,GACrB,GAAIb,IAAuBG,aAEvB,OAAOA,aAAaU,GAGxB,IAAKb,IAAuBH,IAAwBG,IAAuBG,aAEvE,OADAH,EAAqBG,aACdA,aAAaU,GAExB,IAEWb,EAAmBa,GAC5B,MAAO/a,GACL,IAEI,OAAOka,EAAmB3K,KAAK,KAAMwL,GACvC,MAAO/a,GAGL,OAAOka,EAAmB3K,KAAKzV,KAAMihB,KAgD7CC,CAAgBH,aAeXI,EAAKb,EAAKc,GACfphB,KAAKsgB,IAAMA,EACXtgB,KAAKohB,MAAQA,EAEjBD,EAAKxX,UAAUqX,IAAM,WACjBhhB,KAAKsgB,IAAIzX,MAAM,KAAM7I,KAAKohB,iBAWrBC,KAET,IAAIC,EAAKD,EACLE,EAAcF,EACdG,EAAOH,EACPI,EAAMJ,EACNK,EAAiBL,EACjBM,EAAqBN,EACrBO,EAAOP,EAYX,IAAIQ,EAAc3B,EAAc4B,aAAe,GAC3CC,EACFF,EAAYG,KACZH,EAAYI,QACZJ,EAAYK,OACZL,EAAYM,MACZN,EAAYO,WACZ,WAAY,OAAQ,IAAIC,MAAQC,WAmBlC,IAAIC,EAAY,IAAIF,KAOpB,IAiXa3T,EAjXT8T,EAAU,CACZC,kBAnFgBnC,GACd,IAAIxZ,EAAO,IAAIyO,MAAM5K,UAAU3I,OAAS,GACxC,GAAI2I,UAAU3I,OAAS,EACnB,IAAK,IAAI+E,EAAI,EAAGA,EAAI4D,UAAU3I,OAAQ+E,IAClCD,EAAKC,EAAI,GAAK4D,UAAU5D,GAGhC0Z,EAAMjgB,KAAK,IAAI2gB,EAAKb,EAAKxZ,IACJ,IAAjB2Z,EAAMze,QAAiB0e,GACvBL,EAAWS,IA2EjB4B,MAhEU,UAiEVC,SA/DY,EAgEZC,IAAK,CAACC,SAAW,cACjBC,KAhES,GAiETC,QAhEY,GAiEZC,SAhEa,GAiEbC,GAAI3B,EACJ4B,YAAa3B,EACb4B,KAAM3B,EACN4B,IAAK3B,EACL4B,eAAgB3B,EAChB4B,mBAAoB3B,EACpB4B,KAAM3B,EACN4B,iBA1De5L,GACb,MAAM,IAAItQ,MAAM,qCA0DlBmc,eAvDgB,MAAO,KAwDvBC,eAvDcC,GACZ,MAAM,IAAIrc,MAAM,mCAuDlBsc,iBAtDkB,OAAO,GAuDzBC,gBAzCcC,GACd,IAAIC,EAA6C,KAAjChC,EAAetM,KAAKoM,GAChCmC,EAAU/e,KAAKuC,MAAMuc,GACrBE,EAAchf,KAAKuC,MAAOuc,EAAU,EAAG,KAS3C,OARID,IACFE,GAAoBF,EAAkB,IACtCG,GAA4BH,EAAkB,IAC9B,IACdE,IACAC,GAAe,MAGZ,CAACD,EAAQC,IA8BhBC,SAjFa,UAkFbC,QA7EY,GA8EZxM,OA7EW,GA8EXyM,kBA1BA,OAFkB,IAAI/B,KACEE,GACX,MAkCP8B,EAAyB,QACrB,CACJC,KAAC,SAAAC,GACJ,OAAAA,cAGO,CACJC,GAAC,SAAAD,GACE,OAAEA,EAAgBA,GAErBE,IAAC,SAAAF,GACD,OAAOA,GAAU,EAASA,UAItB,SAAWA,GACd,OAAAA,GAAA,GAAA,EAAA,GAAAA,EAAAA,GACJ,MAAAA,GAAAA,EAAA,GAAA,YAIGC,GAAC,SAAAD,GACE,OAAEA,EAAgBA,EAAGA,GAExBE,IAAC,SAAAF,GACD,QAAOA,EAAgBA,EAAGA,EAAA,SAItB,SAAUA,GACb,OAAAA,GAAA,GAAA,EAAA,GAAAA,EAAAA,EAAAA,EACJ,KAAAA,GAAA,GAAAA,EAAAA,EAAA,aAGO,CACJC,GAAC,SAAAD,GACE,OAAEA,EAAgBA,EAAGA,EAAAA,GAExBE,IAAC,SAAAF,GACD,OAAO,KAAUA,EAASA,EAAAA,EAAAA,SAItB,SAAWA,GACd,OAAAA,GAAA,GAAA,EAAA,GAAAA,EAAAA,EAAAA,EAAAA,GACJ,KAAAA,GAAA,GAAAA,EAAAA,EAAAA,EAAA,aAGO,CACJC,GAAC,SAAAD,GACE,OAAEA,EAAgBA,EAAGA,EAAAA,EAAAA,GAExBE,IAAC,SAAAF,GACD,QAAOA,EAAgBA,EAAGA,EAAAA,EAAAA,EAAA,SAItB,SAAUA,GACb,OAAAA,GAAA,GAAA,EAAA,GAAAA,EAAAA,EAAAA,EAAAA,EAAAA,EACJ,KAAAA,GAAA,GAAAA,EAAAA,EAAAA,EAAAA,EAAA,gBAGO,CACJC,GAAC,SAAAD,GACE,OAAE,EAAUtf,KAAM4L,IAAG0T,EAAAtf,KAAAsJ,GAAA,IAExBkW,IAAC,SAAAF,GACD,OAAOtf,KAAUkM,IAAAoT,EAAStf,KAAAsJ,GAAA,IAE1BmW,MAAC,SAAAH,GACJ,MAAA,IAAA,EAAAtf,KAAA4L,IAAA5L,KAAAsJ,GAAAgW,kBAGO,CACJC,GAAC,SAAAD,GACE,OAAoB,IAAlBA,EAAmB,EAAAtf,KAAA0f,IAAA,KAAAJ,EAAA,IAExBE,IAAC,SAAAF,GACD,OAAuB,IAAhBA,EAAmB,EAAA,EAAAtf,KAAA0f,IAAA,GAAA,GAAAJ,UAIpB,SAAQA,GAGV,OAAe,IAAbA,EACE,EAEW,IAAfA,EAAyB,GAC5BA,GAAA,GAAA,EAAA,GAAAtf,KAAA0f,IAAA,KAAAJ,EAAA,GACJ,IAAA,EAAAtf,KAAA0f,IAAA,GAAA,IAAAJ,EAAA,gBAGO,CACJC,GAAC,SAAAD,GACE,OAAE,EAAUtf,KAAMiL,KAAG,EAAAqU,EAAAA,IAExBE,IAAC,SAAAF,GACD,OAAOtf,KAAUiL,KAAA,KAASqU,EAAAA,UAItB,SAAUA,GACb,OAAAA,GAAA,GAAA,GAAA,IAAAtf,KAAAiL,KAAA,EAAAqU,EAAAA,GAAA,GACJ,IAAAtf,KAAAiL,KAAA,GAAAqU,GAAA,GAAAA,GAAA,aAGO,IAGA,SAAIA,GAGJ,OAAa,IAAbA,EAAsB,EACzB,IAAAA,EAAA,GACItf,KAAU0f,IAAM,EAAG,IAAAJ,EAAA,IAAAtf,KAAAkM,IAAA,GAAAoT,EAAA,KAAAtf,KAAAsJ,SAIpB,SAAUgW,GAGV,OAAe,IAAfA,EAAyB,EAC5B,IAAAA,EAAA,EACMtf,KAAU0f,IAAA,GAAQ,GAACJ,GAAAtf,KAAAkM,IAAA,GAAAoT,EAAA,IAAAtf,KAAAsJ,IAAA,SAIpB,SAAQgW,GAGV,OAAW,IAAXA,EAAW,EACG,IAAVA,EACO,GAEXA,GAAU,GACb,GAAA,GAAAtf,KAAA0f,IAAA,EAAA,IAAAJ,EAAA,IAAAtf,KAAAkM,IAAA,GAAAoT,EAAA,KAAAtf,KAAAsJ,IACJ,GAAAtJ,KAAA0f,IAAA,GAAA,IAAAJ,EAAA,IAAAtf,KAAAkM,IAAA,GAAAoT,EAAA,KAAAtf,KAAAsJ,IAAA,aAIO,SAAOgW,GACV,IAAAK,EAAA,QACE,OAAEL,EAAgBA,IAAGK,EAAA,GAAAL,EAAAK,QAEpB,SAASL,GACZ,IAAAK,EAAA,QACD,QAAOL,EAAgBA,IAAGK,EAAA,GAAAL,EAAAK,GAAA,SAEpB,SAASL,GAGX,IAAAK,EAAO,UACV,OAAAL,GAAA,GAAA,EAAAA,EAAAA,IAAAK,EAAA,GAAAL,EAAAK,GAAA,GACJ,KAAAL,GAAA,GAAAA,IAAAK,EAAA,GAAAL,EAAAK,GAAA,YAGO,CACJJ,GAAC,SAAAD,GACE,OAAE,EAAUF,EAASQ,OAAAJ,IAAA,EAAAF,iBAIXA,YAGA,EAAM,KACX,OAAOA,EAAUA,EAGjBA,EAAa,EAAI,KAAU,QAAYA,GAAU,IAAG,MAAQA,EAAA,IAEnEA,EAAA,IAAA,KAAA,QAAAA,GAAA,KAAA,MAAAA,EAAA,MACgB,QAASA,GAAA,MAAA,MAAAA,EAAA,eAItB,SAAOA,GACV,OAAAA,EAAA,GAAA,GAAAF,EAAAQ,OAAAL,GAAA,EAAAD,GACJ,GAAAF,EAAAQ,OAAAJ,IAAA,EAAAF,EAAA,GAAA,QAWgB,oBAAAhjB,WAAA,IAAAihB,GAAAA,EAAAqB,OAAA,WAGb,IAAAiB,EAAWtC,EAA8BqB,gBAI7B,IAAXiB,EAAO,GAAoBA,EAAA,GAAA,KAG7B,oBAAHvjB,WAAqCsJ,IAA1BtJ,KAAYugB,kBAAyBjX,IAAAtJ,KAAAugB,YAAAE,IAQhDzgB,KAAMugB,YAAaE,IAAA+C,KAAAxjB,KAAAugB,kBACGjX,IAAlBwX,KAAUL,IAAeK,KAAAL,IAC5B,WAED,OAAA,IAAAK,MAAAC,WAaA0C,EAAM,oBACEA,IACJhlB,KAAAilB,QAAc,GAEdjlB,KAACklB,yBAAA,YAGevb,UAAAwb,OAAA,WAAA,IAACC,EAAAplB,KACpB,OAAA4C,OAAAoE,KAAAhH,KAAAilB,SAAA5I,KAAA,SAAAgJ,GACD,OAAAD,EAAAH,QAAAI,OAGAL,EAACrb,UAAA2b,UAAA,WACDtlB,KAAAilB,QAAA,IAGAD,EAACrb,UAAAlI,IAAA,SAAA8jB,GACDvlB,KAAAilB,QAAAM,EAAAC,SAAAD,EACIvlB,KAAIklB,yBAA0BK,EAAAC,SAAAD,KAEE5b,UAAO8b,OAAA,SAAAF,UACnCvlB,KAAQilB,QAAOM,EAAMC,gBAG2CxlB,KAAAklB,yBAAAK,EAAAC,YAEI7b,UAAAsV,OAAA,SAAA6F,EAAAY,QACJ,IAAAZ,IAAAA,EAAAa,UACrC,IAAAD,IAAAA,GAAA,SACf9iB,OAAMoE,KAAOhH,KAAAilB,YACpB,IAALW,EAAK5jB,OAAA,OAAwB,OAO5B4jB,EAAA5jB,OAAA,GAAA,CACDhC,KAAAklB,yBAA4B,GAEhC,IAAO,IAAIne,EAAA,EAAAA,EAAA6e,EAAA5jB,OAAA+E,IAAA,CACd,IAAAwe,EAAAvlB,KAAAilB,QAAAW,EAAA7e,IACM8e,GAAAH,EACVH,IAAA,IAAAA,EAAAtG,OAAA6F,EAAAe,KAAAH,UAAA1lB,KAAAilB,QAAAW,EAAA7e,IAMW6e,EAAWhjB,OAAMoE,KAAAhH,KAAAklB,0BAErB,OAAK,GAEFF,EArDD,GA6DLc,GAAA,CACDC,OAAQ,SAAUC,EAAGC,GACjB,IAAIC,EAAIF,EAAChkB,OAAA,EACL4M,EAAIsX,EAAED,EACNlf,EAAE9B,KAAOuC,MAAIoH,GACbuX,EAAKL,GAAcM,MAAML,OAC7B,OAAKE,EAAI,EAAQE,EAAKH,EAAE,GACpBA,EAAC,GAAIpX,GAETqX,EAAQ,EAAAE,EAAAH,EAAAE,GAAAF,EAAAE,EAAA,GAAAA,EAAAtX,GACXuX,EAAAH,EAAAjf,GAAAif,EAAAjf,EAAA,EAAAmf,EAAAA,EAAAnf,EAAA,GAAA6H,EAAA7H,WAEO,SAAMif,EAAMC,OAChB,IAAI3b,EAAI,EACJzI,EAAImkB,EAAAhkB,OAAW,EACfqkB,EAAKphB,KAAA0f,IACL2B,EAAGR,GAAaM,MAAAG,UACZxf,EAAI,EACJA,GAAIlF,EAAIkF,IAACuD,GAAQ+b,EAAI,EAAIJ,EAACpkB,EAAIkF,GAAAsf,EAAAJ,EAAAlf,GAAAif,EAAAjf,GAAAuf,EAAAzkB,EAAAkF,UAElCuD,cAGI,SACA0b,EAAAC,OAEJC,EAAIF,EAAChkB,OACD,EAEJ4M,EAAAsX,EAAOD,EACVlf,EAAA9B,KAAAuC,MAAAoH,GACJuX,EAAAL,GAAAM,MAAAI,WACD,OAAQR,EAAA,KAAAA,EAAAE,IACID,EAAA,IAAAlf,EAAY9B,KAAIuC,MAAMoH,EAAAsX,GAAA,EAAAD,KACpBE,EAAIH,GAAGjf,EAAE,EAAKmf,GAAKA,GAAAF,EAAAjf,GAAAif,GAAAjf,EAAA,GAAAmf,GAAAF,GAAAjf,EAAA,GAAAmf,GAAAtX,EAAA7H,IAE7Bkf,EAAW,EAAWD,EAAG,IAAGG,EAAAH,EAAA,GAAAA,EAAA,GAAAA,EAAA,GAAAA,EAAA,IAAApX,GAAAoX,EAAA,IACpBC,EAAE,EAAGD,EAAAE,IAAAC,EAAAH,EAAAE,GAAAF,EAAAE,GAAAF,EAAAE,EAAA,GAAcF,EAAAE,EAAM,GAAAtX,EAAAsX,GAASF,EAAAE,IAC/BC,EAAGH,EAACjf,EAAIA,EAAI,EAAI,GAAIif,EAAGjf,GAACif,EAAAE,EAAAnf,EAAA,EAAAmf,EAAAnf,EAAA,GAAAif,EAAAE,EAAAnf,EAAA,EAAAmf,EAAAnf,EAAA,GAAA6H,EAAA7H,WAGtBgf,OAAA,SAACU,EAAAC,EAAA3Y,GAAA,OAAC2Y,EAAAD,GAAA1Y,EAAA0Y,aAEJ,SAAM5kB,EAAAkF,OACT4f,EAAKb,GACSM,MAAAQ,iBAEXD,EAAE9kB,GAAK8kB,EAAI5f,GAAM4f,EAAG9kB,EACnBkF,eAIP2H,EAAA,CACJ,GAES,SAAS7M,GACX,IAAE+iB,EAAM,EACR,GAAElW,EAAI7M,GAAI,OAAA6M,EAAA7M,GACV,IAAE,IAAIkF,EAAKlF,EAAAkF,EAAA,EAAAA,IAAA6d,GAAA7d,EAElB,OADG2H,EAAM7M,GAAG+iB,EACZA,IAMN4B,WACH,SAAIC,EAAAC,EAAAG,EAAAC,EAAA/Y,OACSgZ,EAAA,IAAAF,EAAAJ,GACRO,EAAA,IAAAF,EAAAJ,GACDO,EAAAlZ,EAAAA,EAEC,OAAA,EAAA2Y,EAAA,EAAAG,EAAAE,EAAAC,IADUjZ,EAAAkZ,KACV,EAAAP,EAAA,EAAAG,EAAA,EAAAE,EAAAC,GAAAC,EAAAF,EAAAhZ,EAAA2Y,QAgBQ,oBACDQ,cAEgBC,OAAA,WACpB,OAAKD,EAAiBE,aAEDA,QAAA,EAACF,EANjB,MAOe,IAAAlC,EAOpBqC,GAAsB,oBACjBA,EAAcC,EAAAC,QACJ,IAAXA,IAAeA,EAAAC,IACnBxnB,KAAKsnB,QAAAA,EACLtnB,KAAKunB,OAAAA,EACLvnB,KAAKynB,WAAA,EACLznB,KAAK0nB,YAAA,EACL1nB,KAAK2nB,aAAM,GAEX3nB,KAAK4nB,WAAW,GAEpB5nB,KAAA6nB,mBAAA,GAEC7nB,KAAA8nB,UAAA,IACD9nB,KAAA+nB,eAAA,EACI/nB,KAAAgoB,QAAY,EACfhoB,KAAAioB,OAAA,EACDjoB,KAAAkoB,YAAA,EACIloB,KAAAmoB,WAAY,EACfnoB,KAAAooB,WAAA,EACDpoB,KAAAqoB,WAAA,EACIroB,KAAuEsoB,gBAAAjE,EAAA0B,OAAAzB,KACvEtkB,KAAsEuoB,uBAAAzC,GAAAC,OACtE/lB,KAAyBwoB,eAAA,GACzBxoB,KAA0EyoB,uBAAA,EAC1EzoB,KAAK0oB,IAAAxB,GAAqCC,SAC1CnnB,KAAI2oB,iBAAa,EAGjB3oB,KAAA4oB,UAAW,EAmXf,OAjXAvB,EAAM1d,UAAU6b,MAAQ,WACpB,OAAKxlB,KAAA0oB,KAETrB,EAAC1d,UAAAkf,UAAA,WACD,OAAA7oB,KAAAkoB,cAI+Bve,UAAAmf,SAAA,WAC3B,OAAK9oB,KAAMynB,aAEU9d,UAAAof,GAAA,SAAArd,EAAAsd,0BAKRpmB,OAAAqmB,OAAAvd,QACAb,QAAa7K,KAAA8nB,UAAiBkB,GACtChpB,QAEiB2J,UAAAqf,SAAA,SAAAra,GAEtB,OADA3O,KAAK8nB,UAAYnZ,EACZ3O,QAE+B2J,UAAWvH,MAAiB,SAAA0iB,GAChE,GAAI9kB,KAACkoB,WAAc,OAAKloB,KAI5B,GAFIA,KAAAunB,QAAWvnB,KAAAunB,OAAA9lB,IAAAzB,MACdA,KAAAgoB,QAAAhoB,KAAA+nB,eACD/nB,KAAAmoB,UAIQ,IAAI,IAAAe,KADJlpB,KAAImoB,WAAA,EACWnoB,KAAA6nB,mBACX7nB,KAAAmpB,0BAAuBD,GAC+ClpB,KAAA2nB,aAAAuB,GAAAlpB,KAAA6nB,mBAAAqB,eAK1EhB,YAAmD,OACnDT,WAAI,8BACgB,wBACF,uBAGuB5c,IAAAia,EAAA,iBAAAA,EAAAa,IAAAyD,WAAAtE,GAAAA,EAAAa,qBAC5B3lB,KAAGooB,iCACyDpoB,KAAAsnB,QAAAtnB,KAAA2nB,aAAA3nB,KAAA4nB,WAAA5nB,KAAA6nB,4BACjBle,UAAA0f,iBAAA,SAAA/B,EAAAK,EAAAC,EAAAC,OACxD,IAACqB,KAAAtB,EAAA,CACD,IAAoC0B,EAAAhC,EAAA4B,GAClCK,EAAwBhU,MAAIiU,QAAAF,GAC1BG,EAAAF,EAAyB,eAAsBD,EAAII,GAACH,GAAAhU,MAAAiU,QAAA5B,EAAAsB,OAI5B,cAApBO,GAAoB,aAAAA,MAGxBC,EAAmB,CAAsC,IAA6DC,EAAA/B,EAAAsB,GACtH,GAA2B,IAAAS,EAAA3nB,OAAA,SAE3B2nB,EAAKA,EAAiBtN,IAAArc,KAAA4pB,qBAAyB7E,KAAQ/kB,KAAGspB,IAG1D1B,EAA0CsB,GAAA,CACtCI,GAGFzI,OAAG8I,MAKD,WAAJF,IACIF,IAA2BD,GAAAI,OAmBD,IAAnB/B,EAAQuB,KAAWvB,EAAAuB,GAAAI,GACjCC,IAEG5B,EAACuB,IACA,GAIbrB,EAAAqB,GAFeQ,EAET9B,EAAUsB,GAAM1T,QAAaqU,UACXlC,EAAAuB,IAAA,MA5BmB,CAOlC,IAAA,IAAAnO,KANO4M,EAAoBuB,GAAAK,EAAA,GAAA,GAM3BD,EAER3B,EAAAuB,GAAAnO,GAAAuO,EAAAvO,GACD8M,EAAAqB,GAAMK,EAAiB,GAAQ,GAI1BvpB,KAAAqpB,iBAAAC,EAAA3B,EAAAuB,GAAAtB,EAAAsB,GAAArB,EAAAqB,QAkBL7B,EAAM1d,UAAUK,KAAK,WAOjB,OANIhK,KAAI2oB,kBACJ3oB,KAAK2oB,iBAAkB,EAGvB3oB,KAAC8pB,qBAEsB9pB,KAAAkoB,YAE3BloB,KAAAunB,QAAWvnB,KAAAunB,OAAA9B,OAAAzlB,MACdA,KAAAkoB,YAAA,EACDloB,KAAAynB,WAAA,EACQznB,KAAI+pB,iBAAmB/pB,KAAG+pB,gBAAA/pB,KAAAsnB,SACzBtnB,MANsBA,QAUI2J,UAAWrH,IAAA,WAG1C,OAFAtC,KAAK4oB,UAAW,EAChB5oB,KAA2Bif,OAAA+K,EAAAA,GACtBhqB,MAETqnB,EAAC1d,UAAAsgB,MAAA,SAAAnF,GAEG,YADJ,IAAAA,IAAAA,EAAAa,KACS3lB,KAAKynB,YAAMznB,KAAAkoB,aAGhBloB,KAAAynB,WAAW,EACdznB,KAAA0nB,YAAA5C,EAEG9kB,KAAKunB,QAASvnB,KAAKunB,OAAA9B,OAAAzlB,OANqBA,MAS5CqnB,EAAM1d,UAAUugB,OAAQ,SAAUpF,GAE9B,YADK,IAADA,IAAcA,EAAMa,KACxB3lB,KAAOynB,WAAIznB,KAAAkoB,YACdloB,KAAAynB,WAAA,EACDznB,KAAAqoB,YAAAvD,EAAA9kB,KAAA0nB,YACI1nB,KAAK0nB,YAAc,EAEnB1nB,KAAAunB,QAAWvnB,KAAAunB,OAAA9lB,IAAAzB,MACdA,MANcA,QAQmB2J,UAAAmgB,kBAAA,WAC9B,IAAA,IAAO/iB,EAAI,EAAAojB,EAAAnqB,KAAAwoB,eAAAxmB,OAAA+E,EAAAojB,EAAApjB,IAAA/G,KAAAwoB,eAAAzhB,GAAAiD,OACd,OAAAhK,QAEoB2J,UAAA8D,MAAA,SAAAA,GAEpB,OADGzN,KAAAunB,OAAW9Z,EACdzN,QAEwC2J,UAAAygB,MAAA,SAAA7F,GAExC,OADGvkB,KAAAooB,WAAW7D,EACdvkB,QAEiC2J,UAAA0gB,OAAqB,SAAAC,GAGvD,OAFItqB,KAAA+nB,eAAWuC,EACdtqB,KAAAgoB,QAAAsC,EACDtqB,QAE0C2J,UAClC4gB,YAAa,SAAYhG,GAG7B,OADAvkB,KAAKwqB,iBAAiBjG,EACfvkB,MAEXqnB,EAAM1d,UAAU8gB,KAAO,SAAGA,GAEtB,OADAzqB,KAAKioB,MAAAwC,EACEzqB,MAEXqnB,EAAM1d,UAAU+gB,OAAQ,SAAGC,GAEvB,OADA3qB,KAAKsoB,gBAAiBqC,EACf3qB,MAEXqnB,EAAM1d,UAAUihB,cAAW,SAAUC,GAEjC,OADA7qB,KAAKuoB,uBAAoBsC,EAClB7qB,MAEXqnB,EAAM1d,UAAUmhB,MAAA,WAEZ,IADA,IAAIC,EAAC,GACEC,EAAI,EAAAA,EAAArgB,UAAA3I,OAAAgpB,IAAAD,EAAAC,GAAArgB,UAAAqgB,GAEf,OADChrB,KAAAwoB,eAAAuC,EACD/qB,QAEe2J,UAAAshB,QAAA,SAAAC,GAMZ,OALFlrB,KAAAmrB,iBAAAD,EAKElrB,QAGyC2J,UAAIyhB,SAAA,SAAAF,GAG5C,OAFAlrB,KAAIqrB,kBACAH,EACAlrB,QAEiC2J,UAAS2hB,SAAA,SAAAJ,UAC9ClrB,KAAKurB,kBAAkBL,EACjBlrB,QAIL2J,UAAA6hB,WAAA,SAAAN,GAED,OADAlrB,KAAKyrB,oBAAgBP,EACjBlrB,QAKS2J,UAAA+hB,OAAqB,SAAQR,GAG1C,YADInB,gBAAKmB,EACRlrB,MAMDqnB,EACS1d,UAAkBsV,OAAK,SAAS6F,EAAOe,WAErC,IAAPf,IAAaA,EAAAa,UACJ,IAATE,IAAsBA,GAAC,QACnB4B,UAAY,OAAM,YAKZznB,KAAGqoB,WAAcroB,KAAM8nB,8BAGG9nB,KAAAkoB,WAAA,MACpByD,EAAK,OAAA,KAET3rB,KAAKoC,MACL0iB,qBAGP,IACC9kB,KAAMqoB,WACA,OAAC,GAEgB,SAAzBI,6BAII0C,kBAAkBnrB,KAAImrB,iBAAkBnrB,KAAAsnB,cAE5CmB,uBAAS,MAKR3D,EAAC9kB,KAAAqoB,YAAAroB,KAAA8nB,YACO,IAAP9nB,KAAE8nB,WAAK8D,EACA,EAAA,EAAAA,QAEJ5rB,KAAKsoB,gBAAMsD,6BAGP5rB,KAAesnB,QAAStnB,KAAK2nB,aAAa3nB,KAAK4nB,WAASvnB,QAEjEgrB,mBAAkBrrB,KAAKqrB,kBAAArrB,KAAAsnB,QAAAsE,GAChB,MAAA,CACX,GAAC5rB,KAAAgoB,QAAA,EAAA,CAGR,IAAAkB,4CAAAlpB,KAAA6nB,mBACD7nB,KAAAioB,OAAoC,iBAA9BjoB,KAAA4nB,WAAUsB,KAA8BlpB,KAAA6nB,mBAAuBqB,GAEIlpB,KAAA6nB,mBAAAqB,GAAAE,WAAAppB,KAAA4nB,WAAAsB,KAC7DlpB,KAAaioB,OAAAjoB,KAAQmpB,0BACbD,GAERlpB,KAAQ2nB,aAAauB,GAAalpB,KAAC6nB,mBAAAqB,UAEnClpB,KAAAioB,QAAejoB,KAAMmoB,WAAQnoB,KAAQmoB,gBACPtd,IAA9B7K,KAAAwqB,iBAA8BxqB,KAAAqoB,WAAAvD,EAAA9kB,KAAAwqB,iBAC9BxqB,KAAAqoB,WAAuBvD,EAAA9kB,KAAYooB,WACnCpoB,KAAAurB,mBACOvrB,KAACurB,kBAAiBvrB,KAAAsnB,UAEpB,EAGAtnB,KAAAyrB,qBAA0BzrB,KAAQyrB,oBAAoBzrB,KAAAsnB,aAEzD,IAAAvgB,EAAA,EAAAojB,EAAAnqB,KAAAwoB,eAAAxmB,OAAA+E,EAAAojB,EAAApjB,IAEF/G,KAAGwoB,eAAQzhB,GAAA3E,MAAApC,KAAqBqoB,WAAUroB,KAAA8nB,WAE1C,OADA9nB,KAA0CkoB,YAAA,GACtC,SAKP,GAETb,EAAC1d,UAAAkiB,kBAAA,SAAAvE,EAAAK,EAAAC,EAAAvnB,GACD,IAAA,IAAA6oB,KAAAtB,EAIQ,QAA6B/c,IAAzB8c,EAAQuB,GAAZ,KAIA9mB,EAAOulB,EAAcuB,IAAA,EAE5B5mB,EAAAslB,EAAAsB,GACD4C,EAAAvW,MAAAiU,QAAKlC,EAAC4B,IACK6C,EAAQxW,MAAAiU,QAAmBlnB,IACHwpB,GAAQC,EACPzE,EAC5B4B,GAAKlpB,KAAAuoB,uBAAoCjmB,EAAAjC,GAGlB,iBAAlBiC,GAA2BA,EAGvCtC,KAAA6rB,kBAAAvE,EAAA4B,GAAA9mB,EAAAE,EAAAjC,GAoBF,iBAhBCiC,EAAAtC,KAAA4pB,qBAAUxnB,EAAQE,MAmBkDglB,EAAA4B,GAAA9mB,GAAAE,EAAAF,GAAA/B,KAIpEgnB,EAAS1d,UAAGigB,qBAAM,SAAUxnB,EAAKE,GACjC,MAAA,iBAAAA,EAAAA,EACA,MAAAA,EAAA0pB,OAAA,IAAS,MAAT1pB,EAAA0pB,OAAS,GAAA5pB,EAAKgnB,WAAQ9mB,GACtB8mB,WAAA9mB,IAEA+kB,EAAQ1d,UAAMwf,0BAAA,SAAAD,GACd,IAAO+C,EAAAjsB,KAAA6nB,mBAAAqB,GACPgD,EAAelsB,KAAA4nB,WAAAsB,GACVlpB,KAAA6nB,mBAAKqB,GAAL,iBAAAgD,EAAKlsB,KAAA6nB,mBAAAqB,GAAAE,WAAA8C,GACAlsB,KAAA4nB,WAAQsB,GAClBlpB,KAAQ4nB,WAAAsB,GAAA+C,GAED5E,EAhZmB,gIC3lBQ3Z,EAAQ5K,EAAGC,EAAG8S,GAChD,MAAMtU,EAAOvB,KACbuB,EAAKuB,EAAIA,EACTvB,EAAKwB,EAAIA,EACTxB,EAAK4qB,MAAQrpB,EACbvB,EAAK6qB,MAAQrpB,EAEbxB,EAAK8qB,OAAS,WACV9qB,EAAK+qB,QAAU,IAAIjF,GAAM9lB,GACzBA,EAAK+qB,QAAQvD,GAAG,CAAEjmB,EAAGvB,EAAK4qB,MAAQ,GAAIppB,EAAGxB,EAAK6qB,MAAQ,IAAM,KAC5D7qB,EAAK+qB,QAAQlqB,SAEjBb,EAAKgrB,KAAO,WACRhrB,EAAK+qB,QAAU,IAAIjF,GAAM9lB,GACzBA,EAAK+qB,QAAQvD,GAAG,CAAEjmB,EAAGvB,EAAK4qB,MAAOppB,EAAGxB,EAAK6qB,OAAS,KAClD7qB,EAAK+qB,QAAQlqB,SAIjBb,EAAKgd,OAAS,WACV,MAAO5a,KAACA,GAASkS,EAEjBlS,EAAK6J,OAEDjM,EAAK+qB,SACL/qB,EAAK+qB,QAAQrN,SAGK,IAAlBvR,EAAOoR,SAAgBnb,EAAKiJ,YAAc,IAE9CjJ,EAAKkL,YACLlL,EAAKmF,UAAY4E,EAAO5D,MACxBnG,EAAKmO,KACApE,EAAOQ,EAAI,GAAM3M,EAAKuB,EAAK,GAC3B4K,EAAOS,EAAI,GAAM5M,EAAKwB,EAAK,GAC5BxB,EAAKuB,EAAI,EACTvB,EAAKwB,EAAI,GAEbY,EAAKkO,OACLlO,EAAKiO,SAELjO,EAAKgK,uBCxD8B6e,EAAa3W,GACpD,MAAMtU,EAAOvB,KAEPysB,EAAS,IAAIC,GAAcF,EAAa,GAAI,GAAI3W,GACtDtU,EAAKkrB,OAASA,EAEdlrB,EAAKqe,iBAAgB,KACjB6M,EAAOlO,UAEXhd,EAAKod,YAAeL,IAChB/c,EAAKoe,SAAWrB,EAAckO,gBCCC3N,EAAO8N,EAAO9W,GACjD,MAAMtU,EAAOvB,KACbuB,EAAKsd,MAAQA,EAEbtd,EAAKmd,QAAU,IAAIkO,GAAmB/N,EAAOhJ,GAE7C8W,EAAME,gBAAgBhO,EAAOtd,EAAKmd,QAAQ+N,oBCTTrO,GACjC,MAAM7c,EAAOvB,KAEPkb,EAAO,GACb3Z,EAAK2Z,KAAOA,EACZ3Z,EAAK+c,cAAa,KAAA,CAAYC,OAAM,SAEpChd,EAAKurB,YAAc,SAAUC,GACzB7R,EAAK1a,KAAKusB,GACVA,EAASrO,QAAQC,YAAYpd,EAAK+c,gBAGtC/c,EAAKyrB,eAAc,IAAS9R,EAAKL,QAAQmL,GAAMA,EAAEiH,WAAWnO,SAAQzC,KAAK2J,GAAMA,EAAEiH,aACjF1rB,EAAK2rB,aAAY,IAAShS,EAAKL,QAAQmL,GAAMA,EAAEiH,WAAWnO,SAE1Dvd,EAAK0d,OAAM,OACX1d,EAAKme,SAAQ,KACTxE,EAAKta,SAASolB,GAAMA,EAAEiH,WAAWvN,cAErCne,EAAK4rB,aAAY,OAEjB5rB,EAAKgd,OAAM,KACPrD,EAAKta,SAASolB,IAAYA,EAAEiH,WAAWnO,QAAQkH,EAAEtH,QAAQiB,SAASpB,aAGtEhd,EAAKod,YAAeL,IAChB/c,EAAK+c,cAAgBA,EACrBpD,EAAKta,SAASolB,GAAMA,EAAEtH,QAAQC,YAAYL,MAE9C/c,EAAK6rB,cAAiBpa,IAClB,MAAMqa,EAAoB9rB,EAAK2rB,oBAClBriB,IAATmI,EACAqa,EAAkBzsB,SAASolB,GAAMA,EAAEtH,QAAQiB,SAASV,WAEpDoO,EAAkBzsB,SAAO,CAAEolB,EAAGjf,IAAMif,EAAEtH,QAAQiB,SAASV,OAAOjM,EAAKjM,OAI3ExF,EAAKqe,iBAAgB,KACbxB,EAAIyB,WACJte,EAAKue,sBAELve,EAAKwe,4BAGbxe,EAAKwe,yBAAwB,KACzB7E,EAAKta,SAASolB,IAAYA,EAAEiH,WAAWnO,QAAQkH,EAAEtH,QAAQkB,uBAE7Dre,EAAKue,oBAAmB,KACpB5E,EAAKta,SAASolB,IAAQA,EAAEtH,QAAQkB,uBAEpCre,EAAK+rB,iBAAgB,KACjBpS,EAAKta,SAASolB,IAAYA,EAAEiH,WAAWnO,QAAQkH,EAAEtH,QAAQiB,SAAS2N,gCCzD1DC,GAAiB9Z,EAAMvF,EAAGC,EAAGqf,EAAUC,EAAI3jB,EAAO4jB,EAAOnqB,EAAK+F,GAC1E/F,EAAIiK,OACJjK,EAAIqJ,YAAc8gB,EAClBnqB,EAAI+F,UAAYA,GAAa,SAC7B/F,EAAIwP,KAAI,GAAMya,iBACdjqB,EAAI2F,UAAYukB,EAChBlqB,EAAIuF,UAAYgB,EAChBvG,EAAIyQ,SAASP,EAAMvF,EAAGC,GACtB5K,EAAIoK,mBAGQggB,GAAY/e,GAExB,OADW,IAAMA,GAAGgf,QAAQ,YCPhBC,GAAMhsB,GAClB,MAAO,IAAI0T,MAAM1T,GAAGmF,iBAQR8mB,GAAMpf,GAClB,OAAOqf,KAAKC,MAAMD,KAAKE,UAAUvf,IAGM,SAClCwf,GAAa7tB,GAElB,MAAyB,iBAAVA,EACRkV,MAAMiU,QAAQnpB,GACXA,EAAMgc,IAAI6R,IACVtrB,OAAOoE,KAAK3G,GAAO8tB,OAAO1R,QAAM,CAAEjS,EAAGoB,KACnC,MAAMoa,EAAI3lB,EAAMuL,GAGhB,OADApB,EAAEoB,GAAOsiB,GAAalI,GACfxb,IACR,IAELnK,WAOM+tB,GAAQlgB,EAAGmgB,EAAMC,GAE7B,OADa,GAAKA,EAAKrpB,KAAKiL,KAAK,EAAIjL,KAAKsJ,KAC5BtJ,KAAKspB,KAAI,KAASrgB,EAAImgB,GAAQC,IAAO,YAGvCE,GAAQtgB,EAAGmgB,EAAMC,GAC7B,OAAIpgB,IAAM8b,EAAAA,EACC,EACL9b,KAAO8b,EAAAA,EACF,EAEJ,YAGE9b,GACT,MAAMugB,EAAQ,KACRne,EAAKpC,GAAK,EACVwgB,EAAO,EAAID,EAAQne,EAEnBqe,IADK,EAAI1pB,KAAKsJ,GAAKkgB,EAAQne,GACZoe,EAAQpe,EACvBse,EAAU3pB,KAAKspB,IAAII,GACnBE,EAAU5pB,KAAKiL,KAAK,EAAI0e,GAE9B,OADUC,EAAU5pB,KAAK6pB,KAAK5gB,GAXjB6gB,EAAK7gB,EAAImgB,IAASC,EAAKrpB,KAAKiL,KAAK,KAAO,YAgBzC8e,GAAiBnoB,GAC7B,MAAM1D,EAASC,SAASC,cAAc,UAChCE,EAAMJ,EAAOK,WAAW,MAC9BD,EAAIuF,UAAYjC,EAChB,MAAMooB,EAAS1rB,EAAIuF,UAEnB,OADA3F,EAAOsiB,SACAwJ,WAGKC,GAASxgB,GACrB,IAAIygB,EAAMnF,EAAAA,EACNoF,EAAW,KACf,IAAK,IAAIroB,EAAI,EAAGA,EAAI2H,EAAE1M,OAAQ+E,IAAK,CAC/B,MAAM4H,EAAID,EAAE3H,GACR4H,EAAIwgB,IACJA,EAAMxgB,EACNygB,EAAWroB,GAGnB,OAAOqoB,WAEKC,GAAS3gB,GACrB,IAAIsJ,GAAOgS,EAAAA,EACPsF,EAAO,KACX,IAAK,IAAIvoB,EAAI,EAAGA,EAAI2H,EAAE1M,OAAQ+E,IAAK,CAC/B,MAAM4H,EAAID,EAAE3H,GACR4H,EAAIqJ,IACJA,EAAMrJ,EACN2gB,EAAOvoB,GAGf,OAAOuoB,WAmBKC,GAAMlvB,EAAO8uB,EAAKnX,GAC9B,OAAI3X,EAAQ8uB,EAAYA,EACpB9uB,EAAQ2X,EAAYA,EACjB3X,WAGKmvB,GAAiB9gB,GAC7B,MAAM7M,EAAI6M,EAAE1M,OACNsI,EAAIiL,MAAM1T,GAChB,IAAK,IAAIkF,EAAI,EAAGA,EAAIlF,EAAGkF,IACnBuD,EAAEvD,GAAK2H,EAAE3H,GAEb,OAAOuD,WAgBKmlB,GAAkB/gB,GAE9B,MADU,IAAKA,eCzIsBmH,EAAQrU,EAAS4c,GACtD,MAAM7c,EAAOvB,KAGb,IAAI0vB,EAAO,GACX,MAAMC,EAAa,GAEbC,EAAa/Z,EAAOpS,SAG1BlC,EAAKsrB,gBAAkB,SAAUriB,EAAGH,GAGhCslB,EAAWnvB,KAAK,GAAEgK,IAAGH,IADX,CAAEwlB,UAAU,MAG1BtuB,EAAKuuB,gBAAkB,SAAUtlB,EAAGH,GAEhCslB,EAAWnvB,KAAK,GAAEgK,IAAGH,IADX,CAAE0lB,UAAU,MAO1B,MAAM3tB,EAAQ,SAAU4tB,GAEpB,GAA4C,OAAxCA,EAAMC,OAAOC,QAAQ,eACrB,OAGJ,MAAMC,EAAQC,EAASJ,GACjBK,EAASL,EAAMM,QAAW,GAAK,EAC/BC,EAAKZ,EAAW3tB,OAEhBwuB,EAAU,GAChB,IAAK,IAAIzpB,EAAI,EAAGA,EAAIwpB,EAAIxpB,IAAK,CACzB,MAAM4H,EAAIghB,EAAW5oB,IAChB4H,EAAEnE,EAAEsU,QAAUV,EAAIyB,aAAe4Q,EAAQ9hB,EAAGwhB,EAAOE,IACpDG,EAAQhwB,KAAKuG,GAGrB,GAAIypB,EAAQxuB,OAAS,EAAG,CACpB,MAAM0uB,EAAaF,EAAQnU,KAAKtV,IAC5B,MAAM4H,EAAIghB,EAAW5oB,GAGrB,OAFa4H,EAAEnE,EAAE0D,EAAIiiB,EAAMjiB,IAEZ,GADFS,EAAEnE,EAAE2D,EAAIgiB,EAAMhiB,IACA,KAIzBwiB,EAAoBH,EADFtB,GAASwB,IAG3BE,EAAIjB,EAAWgB,GACrBjB,EAAKmB,UAAYF,EACjBjB,EAAKoB,YAAa,EAClBpB,EAAKqB,KAAOH,EAAEpmB,EAAE0D,EAAIiiB,EAAMjiB,EAC1BwhB,EAAKsB,KAAOJ,EAAEpmB,EAAE2D,EAAIgiB,EAAMhiB,EAC1ByiB,EAAEvmB,EAAEgiB,SACJuD,EAAWqB,QAAQC,OAAS,qBAmIVf,GACtBgB,GAAI,IACA1B,GAAoBU,GAnIxBiB,CAAiBjB,IAGf9tB,EAAO,SAAU2tB,GACnB,MAAMG,EAAQC,EAASJ,GACvB,GAAIN,EAAKoB,WAAY,CACbd,EAAMM,UACNN,EAAMqB,iBACNrB,EAAMsB,mBAEV,MAAMC,EAAW5B,EAAWD,EAAKmB,WAE3B/tB,EAAI+S,EAAO5S,MACXF,EAAI8S,EAAO3S,OACjBquB,EAAS/mB,EAAEgnB,MAAM,CACbtjB,EAAGqhB,GAAMY,EAAMjiB,EAAIwhB,EAAKqB,KAAM,EAAGjuB,GACjCqL,EAAGohB,GAAMY,EAAMhiB,EAAIuhB,EAAKsB,KAAM,EAAGjuB,KAErCvB,EAAQC,IAAI,CAAC,mBACV,CAGH,MAAM8uB,EAAKZ,EAAW3tB,OACtB,IAAK,IAAI+E,EAAI,EAAGA,EAAIwpB,EAAIxpB,IAAK,CACzB,MAAM4H,EAAIghB,EAAW5oB,GACrB,IAAKqX,EAAIyB,YAAclR,EAAEnE,EAAEsU,SAAW2R,EAAQ9hB,EAAGwhB,EAAO,GAEpD,YADAP,EAAWqB,QAAQC,OAAS,QAIpCtB,EAAWqB,QAAQC,OAAS,aAuGlBf,QACI,CACd,MAACsB,EACmDxsB,KAAA+L,IAAA0gB,EAAAxjB,EAAAiiB,EAAAjiB,GACayjB,EAAA1sB,KAAA+L,IAAA0gB,EAAAvjB,EAAAgiB,EAAAhiB,GACbsjB,EAAA,IAAAN,GAAA,GAChDQ,EAAW,IAAAR,GAAQ,IA3G3BS,CAAgBzB,IAGd7tB,EAAM,WAER,GA2GJ,gBAIC,GADO6uB,GAAe,EACtBzB,EAAAoB,WAAA,CACJnB,EAAAD,EAAAmB,yDAjHOgB,QACuBhnB,IAAnB6kB,EAAKmB,UAAyB,CACblB,EAAWD,EAAKmB,WACxBxmB,EAAEkiB,OAEfmD,EAAO,IAuCR,SAAAoC,EAAA5rB,GAGC,OADAA,EAAAoqB,SAAU,EACHpqB,WAGUkqB,EAAAlqB,WAAG2P,EAAA1S,OAAA4uB,wBAAEpwB,EAAAuE,EAAAoqB,QAAApqB,EAAA8rB,eAAA,GAAA9rB,EAetB,MALD,CAEyCgI,EAXjCvM,EAAKswB,QAAAngB,EAAA8B,KAYZzF,EAXHxM,EAAAuwB,QAAApgB,EAAA/J,cAoBO0oB,EAAU9hB,EAAAuX,EAAAmK,GAEd,MAAMniB,EAACS,EAAKnE,EAAA0D,EAAAgY,EAAAhY,EACfC,EAAAQ,EAAAnE,EAAA2D,EAAA+X,EAAA/X,EAEoB,GAAAQ,EAAA+N,EAAAqT,SAAA,CAEjB,MAAY3lB,EAAAA,GAAAuE,EAAAtE,SACJ6D,EAAAA,EAAAC,EAAAA,GAAA/D,EAAAimB,IAAAjmB,EAAAimB,GAGR,GAAA1hB,EAAA+N,EAAQmT,SAAG,CACd,MAAA/sB,EAAAA,EAAAC,EAAAA,GAAA4L,EAAAtE,EAEO,OADCpF,KAAgB+L,IAAA9C,GAAQ,GAAApL,EAAAutB,GAAAprB,KAAA+L,IAAA7C,GAAA,GAAApL,EAAAstB,SAGzB,MAGJc,EACHO,EAhEDnwB,EAAKwE,cAAgB,OACjB3D,OAAOC,MAAMC,YApBE4D,IACf,MAAMisB,EAAOL,EAAU5rB,GACvB7D,EAAK8vB,eAEWjsB,IAChB,MAAMisB,EAAOL,EAAU5rB,GACvB9D,EAAM+vB,aAEQjsB,IACd,MAAMisB,EAAOL,EAAU5rB,GACvB7D,EAAK8vB,GACL7vB,IAGwC,OAApC4D,EAAE+pB,OAAOC,QAAQ,gBACjBhqB,EAAEmrB,+BCxHkBxb,EAAQrU,EAAS4c,GAC7C,MAAM7c,EAAOvB,KACbuB,EAAKorB,MAAQ,IAAIyF,GAAiBvc,EAAQrU,EAAS4c,GACnD7c,EAAK8wB,MAAK,KACNxc,EAAO9P,cAAcrD,IAAInB,EAAKorB,MAAM5mB,gBAExCxE,EAAK+wB,KAAI,OACT/wB,EAAK0d,OAAM,KACP,GAAIzd,EAAQO,YAAa,OACzB8T,EAAO5T,QACP,MAAOiM,EAAGC,GAAK,CAAC,IAAK,KACrBof,GAAiB,sBAAuBrf,EAAGC,EAAG,GAAI,EAAG,OAAQ,EAAG0H,EAAOtS,MAE3EhC,EAAKgd,OAAM,OACXhd,EAAKqe,iBAAgB,OACrBre,EAAKgxB,YAAW,mBCTkB7kB,EAAQtD,EAAGyL,GAC7C,MAAMtU,EAAOvB,KAEbuB,EAAK6I,EAAIA,EACT7I,EAAKixB,MAAQpoB,EAEb7I,EAAK8qB,OAAS,WACV9qB,EAAKgkB,MAAQ,IAAI8B,GAAM9lB,GACvBA,EAAKgkB,MAAMwD,GAAG,CAAE3e,EAAgB,EAAb7I,EAAKixB,OAAa,KACrCjxB,EAAKgkB,MAAMnjB,SAEfb,EAAKgrB,KAAO,WACRhrB,EAAKgkB,MAAQ,IAAI8B,GAAM9lB,GACvBA,EAAKgkB,MAAMwD,GAAG,CAAE3e,EAAG7I,EAAKixB,OAAS,KACjCjxB,EAAKgkB,MAAMnjB,SAIfb,EAAKgd,OAAS,WACV,MAAO5a,KAACA,GAASkS,GACV/L,MAACA,GAAU4D,EAElB/J,EAAK6J,OAEDjM,EAAKgkB,OACLhkB,EAAKgkB,MAAMtG,SAKO,IAAlBvR,EAAOoR,SACPnb,EAAKiJ,YAAc,IAEvBjJ,EAAKkL,YACLlL,EAAKmF,UAAYgB,EACjBnG,EAAKgO,IAAIjE,EAAOQ,EAAGR,EAAOS,EAAG5M,EAAK6I,EAAG,EAAG,EAAInF,KAAKsJ,IACjD5K,EAAKkO,OACLlO,EAAKiO,SAELjO,EAAKgK,uBCtDwBsf,EAAYpX,GAC7C,MAAMtU,EAAOvB,KAEPyyB,EAAS,IAAIC,GAAczF,EAAY,GAAIpX,GACjDtU,EAAKkxB,OAASA,EAEdlxB,EAAKqe,iBAAgB,KAEjB6S,EAAOlU,UAGXhd,EAAKod,YAAeL,IAChB/c,EAAKoe,SAAWrB,EAAc2O,gBCELA,EAAYN,EAAO9W,GAChD,MAAMtU,EAAOvB,KACbuB,EAAK0rB,WAAaA,EAElB1rB,EAAKmd,QAAU,IAAIiU,GAAa1F,EAAYpX,GAE5C8W,EAAMmD,gBAAgB7C,EAAY1rB,EAAKmd,QAAQ+T,QCkBzC,MAAEG,GAAA,IAAA3tB,KAAAiL,KAAA,GAAA,GACN2iB,IAAA,EAAA5tB,KAAAiL,KAAA,IAAA,EAAO4iB,GAAA,EAAA,EACRC,IAAA9tB,KAAAiL,KAAA,GAAA,GAAA,EAAG8iB,IAAA,EAAA/tB,KAAAiL,KAAA,IAAA,GAAG+iB,GAAA,IAAAC,aAAA,CACP,EAAG,EAAI,GACN,EAAE,EAAG,EACN,GAAG,EAAI,GAAG,GACT,EAA2B,EAAG,EAAG,EAAG,GAAI,EAAE,EAAG,EAAG,EAAI,GAAI,GAAE,EAAI,GAAI,EAAE,EAAG,EAAI,EAC5E,GAAG,EAAI,EAAG,EAAG,GAAG,EAAI,GAAG,GAAK,IAAQC,GAAA,IAAAD,aAAA,CAAE,EAAG,EAAG,EAAI,EAAI,EACpD,EAAG,GAAI,EAAE,EAAG,GAAI,EAAE,EAAG,EAAI,GAAI,GAAE,EAAI,GAAI,EAAE,EAAG,EAAI,GAChD,EAAI,GAAI,EAAE,GAAG,GAAK,EAAE,EAAG,GAAI,GAAK,GAAE,EAAI,EAAG,EAAI,EAAG,EAAI,EACpD,EAAG,GAAI,EAAE,EAAG,GAAI,EAAE,EAAG,EAAI,GAAG,GAAK,GAAG,EAAE,EAAG,EAAI,GAAG,EAChD,EAAI,GAAI,GAAG,EAAE,GAAK,EAAE,GAAG,EAAI,GAAI,GAAK,EAAE,EAAG,EAAI,EAAI,EAAG,EACpD,EAAG,GAAI,EAAE,GAAI,EAAE,EAAG,EAAI,GAAI,EAAE,GAAK,GAAG,EAAE,EAAG,EAAI,GAAK,EAClD,EAAI,GAAI,GAAG,GAAE,EAAI,EAAG,GAAK,GAAE,EAAI,GAAK,EAAE,EAAG,EAAI,EAAI,EAAI,EAAE,GACoB,EAE3E,sBAeC,EACD,uCAsByC,MAAAE,eAO3BC,EAAApuB,KAAAwC,cACJA,EAAI,mBAAA4rB,EAAAA,2bAAAC,CAAAD,GACVrzB,KAAkD0c,yJAAA6W,CAAA9rB,GAClDzH,KAAkEwzB,KAAA,IAAAC,WAAA,KAClEzzB,KAAoE0zB,UAAA,IAAAD,WAAA,KACpE,IAAoB,IAAA1sB,EAAA,EAAAA,EAAA,IAAAA,IACpB/G,KAAQwzB,KAAKzsB,GAAK/G,KAAG0c,EAAA,IAAA3V,GACrB/G,KAAQ0zB,UAAU3sB,GAAG/G,KAAAwzB,KAAAzsB,GAAA,GAQrB4sB,QAAMzlB,EAAKC,SACPulB,EAAY1zB,KAAA0zB,UACVF,EAAMxzB,KAAAwzB,SACRI,EAAK,EACRC,EAAA,EACGC,EAAK,QAELlP,GAAM1W,EAAGC,GAAGykB,GACV7rB,EAAI9B,KAAEuC,MAAA0G,EAAA0W,GACNmP,EAAG9uB,KAAKuC,MAAM2G,EAAAyW,GACnB7W,GAAAhH,EAAAgtB,GAAAlB,GAGGpiB,EAAMvC,GAFDnH,EAAMgH,GAGT2C,EAAIvC,GAFC4lB,EAAGhmB,GAKd,IAAmE6L,EAAAoa,EACHvjB,EAAAC,GAChEkJ,EAAW,EACdoa,EAAA,IASGpa,EAAM,EACNoa,EAAM,GAKN,MAAM5jB,EAAIK,EAAKmJ,EAAMiZ,GACfxiB,EAAIK,EAAKsjB,EAAMnB,GACfviB,EAAKG,EAAK,EAAI,EAAIoiB,GAClBtiB,EAAKG,EAAK,EAAiD,EAAAmiB,GAE3DoB,EAAS,IAAJltB,EACLmtB,EAAS,IAAJH,EAEX,IAAAI,EAAQ,GAAO1jB,EAAEA,EAAAC,EAAAA,EACjB,GAA0EyjB,GAAA,EAAA,CACrC,MAAAC,EAAA,EAAAV,EAAAO,EAAAT,EAAAU,IACjCC,GAAMA,EACNP,EAAIO,EAAMA,GAA0DlB,GAAAmB,GAAA3jB,EAAAwiB,GAAAmB,EAAA,GAAA1jB,OAEpE2jB,EAAI,GAAMjkB,EAAKA,EAAAC,EAAAA,QACT,EAAG,OACHikB,EAAI,EAAAZ,EAAAO,EAAAra,EAAA4Z,EAAAU,EAAAF,OACJK,IACFA,EAAMA,GAAApB,GAAAqB,GAAAlkB,EAAA6iB,GAAAqB,EAAA,GAAAjkB,SAEN,GAAMC,EAAAA,EAAAC,EAAAA,KACV0W,GAAC,EACM,OACDsN,EAAI,EAAAb,EAAAO,EAAA,EAAAT,EAAAU,EAAA,OACJjN,IACFA,EAAMA,GAAAgM,GAAAsB,GAAAjkB,EAAA2iB,GAAAsB,EAAA,GAAAhkB,UAIT,IACKqjB,EAAAC,EAAAC,GAQVU,QACMtmB,EAAAC,EAAAsmB,SACAf,EAAY1zB,KAAA0zB,YACL1zB,KAACwzB,WACNK,EAAEC,EAAIY,UAxJb,mBA0JSxmB,EAAIC,EAAAsmB,KACJxvB,KAAIuC,MAAA0G,EAAA0W,KACJ3f,KAAIuC,MAAA2G,EAAAyW,GACTqB,EAAAhhB,KACQuC,MAAKitB,EAAK7P,MACb7d,EAAIgtB,EAAA9N,GAAA6M,KAIJ5kB,GAHAnH,EAAIgH,KAIJI,GAHA4lB,EAAIhmB,GAIT4mB,EACIF,GAJCxO,EAAIlY,SAONimB,EAAEY,IACFC,EAAEC,KACApkB,EACFA,GAAMikB,GACM/a,EAAA,EACnBoa,EAAA,EACsEY,EAAA,EACIG,EAAA,EACEF,EAAA,EAClEC,EAAA,GACErkB,GAAQkkB,GACb/a,EAAK,EACLoa,EAAK,EACLY,EAAK,EACLG,EAAK,EACLF,EAAK,EACLC,EAAK,IAELlb,EAAK,EACsDoa,EAAA,EAC3DY,EAAI,EACJG,EAAI,EACJF,EAAI,EACuCC,EAAA,GAI7CpkB,EAAAikB,GACF/a,EAAS,EACPoa,EAAM,EACNY,EAAK,EACVG,EAAA,EACKF,EAAM,EACNC,EACF,GACErkB,EAAAkkB,GACF/a,EAAS,EACPoa,EAAM,EACNY,EAAK,EACVG,EAAA,EACKF,EAAM,EACNC,EACF,IAEAlb,EAAS,EACPoa,EAAM,EACNY,EAAK,EACVG,EAAA,EACKF,EAAM,EACNC,EACF,GAOJ,MAAkD1kB,EAAAK,EAAAmJ,EAAAkZ,GAC5CziB,EAAKK,EAAMsjB,EAAKlB,GACzBkC,EAAAL,EAAAC,EAAA9B,GAOExiB,EAAAG,EAAAskB,EAAA,kBAEOxkB,EAAIG,EAAGmkB,EAAK,kBACZI,EAAIN,EAAMG,EAAI,kBACwD1jB,EAAAX,EAAA,EAAA,GACtEY,EAAKX,EAAK,EAAI,GACdwkB,EAAIP,EAAK,EAAK,GAEdV,EAAS,IAALltB,EACJmtB,EAAS,IAALH,EACJoB,EAAS,IAAJlP,EAEX,IAAAkO,EAAQ,GAAO1jB,EAACA,EAAAC,EAAAA,EAAAikB,EAAAA,EAChB,GAAAR,EAAQ,EAAIP,EAAI,MACX,CACL,MAAQQ,EAAwD,EAAjDV,EAAiDO,EAAAT,EAAAU,EAAAV,EAAA2B,KAChEhB,GAAQA,EACRP,EAAQO,EAAIA,GAAKlB,GAAAmB,GAAA3jB,EAAAwiB,GAAAmB,EAAA,GAAA1jB,EAAAuiB,GAAAmB,EAAA,GAAAO,GAEjB,IAA2EN,EAAA,GAAAjkB,EAAAA,EAAAC,EAAAA,EAAA2kB,EAAAA,EAC3E,GAAsEX,EAAA,EAAAR,EAAA,MACb,CACY,MAAAS,EAAA,EAAAZ,EAAAO,EAAAra,EAAA4Z,EAAAU,EAAAF,EAAAR,EAAA2B,EAAAP,KACIP,GAAAA,EACrER,EAAKQ,EAAIA,GAAApB,GAAAqB,GAAAlkB,EAAA6iB,GAAAqB,EAAA,GAAAjkB,EAAA4iB,GAAAqB,EAAA,GAAAU,GAEb,IAAI/N,EAAK,GAAI3W,EAAAA,EAAAC,EAAAA,EAAA0kB,EAAAA,EACb,GAAIhO,EAAK,EAAG6M,EAAC,MACT,OAGKS,EAAA,EAAAb,EAAAO,EAAAc,EAAAvB,EAAAU,EAAAW,EAAArB,EAAA2B,EAAAL,KACL7N,GAAKA,IAGLA,EAAKA,GAAAgM,GAAAsB,GAAAjkB,EAAA2iB,GAAAsB,EAAA,GAAAhkB,EAAA0iB,GAAAsB,EAAA,GAAAU,SAIL,GAAK7jB,EAAAA,EAAAC,EAAAA,EAAA6jB,EAAAA,EACT,GAAIE,EAAK,EAAEV,EACP,MAEA,CACA,MAAKW,EACA,EAAL3B,EAAKO,EAAA,EAAAT,EAAAU,EAAA,EAAAV,EAAA2B,EAAA,QAEAC,EACLV,EAAKU,EACLA,GAAKnC,GAAAoC,GAAAjkB,EAAA6hB,GAAAoC,EAAA,GAAAhkB,EAAA4hB,GAAAoC,EAAA,GAAAH,GAKT,OAA8E,IAAAtB,EAAAC,EAAAC,EAAAY,GAQ9EY,QAAQpnB,EAAGC,EAAAsmB,EAAK3xB,GAChB,MAAM0wB,EAAKxzB,KAAKwzB,KAChB,IAAmDI,EAAAC,EAAAC,EAAAY,EAAAa,EAEnD,MAAM3Q,GAAK1W,EAAAC,EAAKsmB,EAAK3xB,GAAOiwB,GACtBhsB,EAAE9B,KAAGuC,MAAU0G,EAAI0W,GACnBmP,EAAE9uB,KAAGuC,MAAU2G,EAAIyW,GAC2BqB,EAAAhhB,KAAAuC,MAAAitB,EAAA7P,GAC9C4Q,EAAEvwB,KAAGuC,MAAU1E,EAAI8hB,GACnB7W,GAAKhH,EAAAgtB,EAAK9N,EAAKuP,GAAOxC,GAKtBviB,EAAKvC,GAJAnH,EAAAgH,GAKL2C,EAAKvC,GAJA4lB,EAAAhmB,GAKL4mB,EAAKF,GAJoExO,EAAAlY,GAKzE0nB,EAAK3yB,GAJA0yB,EAAEznB,GAUb,IAAA2nB,EAAW,EACXC,EAAW,EACXC,EAAW,EACXC,EAAW,EACXplB,EAAQC,EAAKglB,IACRC,IAC8DllB,EAAAkkB,EAAAe,IAC9DE,IACLnlB,EAAQglB,EAAIC,IACPG,IACLnlB,EAAQikB,EAAIgB,IACuCC,IAC/CllB,EAAK+kB,EAAGE,IACRE,MAEEJ,EAAAG,IACFC,UAUEjc,EAAK8b,GAAS,EAAA,EAAA,EACnB1B,EAAA2B,GAAA,EAAA,EAAA,EACKf,EAAGgB,GAAW,EAAE,EAAK,EACrBE,EAAID,GACE,EAAA,EAAA,EAERd,EAAMW,GAAW,EAAG,EAAK,EACvBb,EAAIc,GAAE,EAAA,EAAA,EACNb,EAAKc,GAAS,EAAA,EAAA,EACnBG,EAAAF,GAAA,EAAA,EAAA,EAEKG,EAAIN,GACE,EAAA,EAAA,EACNO,EAAAN,GAAA,EAAA,EAAA,EACFO,EAAMN,GAAW,EAAG,EAAK,EACvBO,EAAIN,GAAE,EAAA,EAAA,EAEXzlB,EAAAK,EAAAmJ,EAAAoZ,GACK3iB,EAAGK,EAAMsjB,EAAKhB,GACdgC,EAAIL,EACJC,EAAM5B,GACNoD,EAAAX,EAAAK,EAAA9C,GACF1iB,EAAMG,EAAOskB,EAAK,EAAE/B,GAClBziB,EAAIG,EAAEmkB,EAAA,EAAA7B,GACNiC,EAAKN,EAAKG,EAAI,EAAA9B,GACnBqD,EAAAZ,EAAAM,EAAA,EAAA/C,GACuD5hB,EAAAX,EAAAulB,EAAA,EAAAhD,GAClD3hB,EAAKX,EAAMulB,EAAK,EAAKjD,GAC9BkC,EAAAP,EAAAuB,EAAA,EAAAlD,cAOFsD,EAAA7lB,EAAA,EAAA,EAAAuiB,GAEWuD,EAAI7lB,EAAA,EAAU,EAAIsiB,GAClBwD,EAAM7B,EAAI,EAAK,EACrB3B,GAEMyD,EAAIhB,EAAG,EAAM,EAAGzC,GAEhBiB,EAAQ,IAALltB,EACNmtB,EAAO,IAAAH,EACPoB,GAAO,IAAAlP,EACbyQ,GAAA,IAAAlB,EAEJ,IAAArB,GAAA,GAAA1jB,EAAAA,EAAAC,EAAAA,EAAAikB,EAAAA,EAAAc,EAAAA,EAKC,GAAAtB,GAAA,EAAAP,EAAA,MAEW,CACH,MAAIQ,EAAAZ,EAAAS,EAAAT,EAAAU,EAAAV,EAAA2B,GAAA3B,EAAAkD,OAAA,GAAA,EACJvC,IAAIA,GACFP,EAACO,GAAAA,IAAAhB,GAAAiB,GAAA3jB,EAAA0iB,GAAAiB,EAAA,GAAA1jB,EAAAyiB,GAAAiB,EAAA,GAAAO,EAAAxB,GAAAiB,EAAA,GAAAqB,GAEP,IAAGpB,GAAQ,GAAAjkB,EAAAA,EAAAC,EAAAA,EAAA2kB,EAAAA,EAAAoB,EAAAA,EACX,GAAG/B,GAAQ,EAAAR,EAAA,MACJ,CACH,MAAKS,EAAId,EAAAS,EAAAra,EAAA4Z,EAAAU,EAAAF,EAAAR,EAAA2B,GAAAP,EAAApB,EAAAkD,GAAAZ,MAAA,GAAA,EACTzB,IACAA,GAEAR,EAAKQ,GAAIA,IAAAlB,GAAAmB,GAAAlkB,EAAA+iB,GAAAmB,EAAA,GAAAjkB,EAAA8iB,GAAAmB,EAAA,GAAAU,EAAA7B,GAAAmB,EAAA,GAAA8B,GAIb,IAAInP,GAAK,GAAI3W,EAAAA,EAAAC,EAAAA,EAAA0kB,EAAAA,EAAAoB,EAAAA,EACX,GAAEpP,GACF,EAAE6M,EAAK,MAEJ,CACH,MAAUS,EAAAf,EAAUS,EAAMc,EAAGvB,EAAAU,EAAAW,EAAArB,EAAA2B,GAAAL,EAAgCtB,EAAAkD,GAAAX,MAAA,GAAA,EAC3D9O,IAAKA,GACL6M,EAAK7M,GAAAA,IAAAkM,GAAAoB,GAAAjkB,EAAA6iB,GAAAoB,EAAA,GAAAhkB,EAAA4iB,GAAAoB,EAAA,GAAAU,EAAA9B,GAAAoB,EAAA,GAAA8B,GAEV,IAAAjB,GAAA,GAAAhkB,EAAAA,EAAAC,EAAAA,EAAA6jB,EAAAA,EAAAyB,EAAAA,EACJ,GAAAvB,GAAA,EAAAV,EAAA,MACQ,CACG,MAAAW,EAAU7B,EAAAS,EAAA+B,EAAAxC,EAAAU,EAAA+B,EAAAzC,EAAA2B,GAAAe,EAAA1C,EAAAkD,GAAAP,MAAA,GAAA,EACXf,IAAAA,GACCV,EAAGU,GAAKA,IAAQjC,GAAAkC,GAAAjkB,EAAA+hB,GAAAkC,EAAA,GAAAhkB,EAAA8hB,GAAAkC,EAAA,GAAAH,EAAA/B,GAAAkC,EAAA,GAAAsB,OAEhBC,GAAK,GAAKN,EAAAA,EAAWC,EAACA,EAAAC,EAAAA,EAAAC,EAAAA,KACtBG,GAAK,EAAGrB,EAAA,MACP,CACD,MAAMsB,EAAArD,EAAAS,EAAA,EAAAT,EAAAU,EAAA,EAAAV,EAAA2B,GAAA,EAAA3B,EAAAkD,GAAA,MAAA,GAAA,EACNE,IAAMA,GACNrB,EAAKqB,GAAKA,IAACzD,GAAA0D,GAAAP,EAAAnD,GAAA0D,EAAA,GAAAN,EAAApD,GAAA0D,EAAA,GAAAL,EAAArD,GAAA0D,EAAA,GAAAJ,GAGf,OAAC,IAAA7C,EAAAC,EAAAC,EAAAY,EAAAa,gBCpdwBuB,EAAIC,GACjC,MAAMx1B,EAAOvB,KAEbuB,EAAKy1B,GAAK,GASVz1B,EAAK01B,SAAQ,KACT11B,EAAKy1B,YAYgBF,EAAIC,EAAIG,EAAYC,EAAaC,EAAMC,GAChE,MAAMC,EAAW,IAAIlE,GAAa,KAC5BmE,EAAW,IAAInE,GAAa,QAC5B/W,WA8BKya,EAAIC,GAEf,OADcxhB,MAAMuhB,GAAIjlB,OAAOwK,KAAG,IAAO9G,MAAMwhB,GAAIllB,OAAOwK,KAAG,IAAO9G,MAAM,GAAG1D,KAAK,OA/BtE2lB,CAAMV,EAAIC,GACtB,IAAIU,EAAO,EACPC,EAAO,EACXC,GAAMb,GAAIl2B,SAASg3B,IACfD,GAAMZ,GAAIn2B,SAASi3B,IAEf,MAAM3pB,EAAK0pB,EAAKd,GAAO,EAAII,GACrB/oB,EAAK0pB,EAAKd,GAAO,EAAII,GACrBW,EAASR,EAAS3D,QAAQzlB,EAAGC,GAC7B4pB,EAASR,EAAS5D,QAAQzlB,EAAGC,GACnCkO,EAAIub,GAAIC,GAAI,GAAMC,EAAS,GAC3Bzb,EAAIub,GAAIC,GAAI,GAAME,EAAS,GAC3BN,GAAQK,EACRJ,GAAQK,QAIhB,MAAMC,EAAQP,GAAQX,EAAKC,GAAM,GAC3BkB,EAAQP,GAAQZ,EAAKC,GAAM,GASjC,OARA1a,EAAIzb,SAAS8N,IACTA,EAAE9N,SAAS8b,IAEPA,EAAE,IAAMA,EAAE,GAAKsb,GAASZ,EAExB1a,EAAE,IAAMA,EAAE,GAAKub,GAASZ,QAGzBhb,EA1CO6b,CAAapB,EAAIC,EATZ,GACC,GAGP,IACA,eAsDRY,GAAM91B,GACX,MAAO,IAAI0T,MAAM1T,GAAGmF,iBC9EfmxB,GAAKC,OACZ,IAEI1pB,EAFA3H,GAAI,EACJlF,EAAIu2B,EAAQp2B,OAEZsI,EAAI8tB,EAAQv2B,EAAI,GAChBs2B,EAAO,IAEFpxB,EAAIlF,GACX6M,EAAIpE,EACJA,EAAI8tB,EAAQrxB,GACZoxB,GAAQzpB,EAAE,GAAKpE,EAAE,GAAKoE,EAAE,GAAKpE,EAAE,GAGjC,OAAO6tB,EAAO,WAGPE,GAASD,OAChB,IAII1pB,EAEA/M,EANAoF,GAAI,EACJlF,EAAIu2B,EAAQp2B,OACZkM,EAAI,EACJC,EAAI,EAEJ7D,EAAI8tB,EAAQv2B,EAAI,GAEhBokB,EAAI,IAEClf,EAAIlF,GACX6M,EAAIpE,EACJA,EAAI8tB,EAAQrxB,GACZkf,GAAKtkB,EAAI+M,EAAE,GAAKpE,EAAE,GAAKA,EAAE,GAAKoE,EAAE,GAChCR,IAAMQ,EAAE,GAAKpE,EAAE,IAAM3I,EACrBwM,IAAMO,EAAE,GAAKpE,EAAE,IAAM3I,EAGvB,MAAe,CAACuM,GAAT+X,GAAK,GAAW9X,EAAI8X,GClC7B,MACMqS,GAAW,mBAIRC,GAAIC,EAAMtyB,EAAGuyB,EAAM7pB,EAAG7L,GAC3B,IAAI21B,EAAGC,EAAMC,EAAIC,EACbC,EAAO5yB,EAAE,GACT6yB,EAAOnqB,EAAE,GACToqB,EAAS,EACTC,EAAS,EACRF,EAAOD,GAAWC,GAAQD,GAC3BJ,EAAII,EACJA,EAAO5yB,IAAI8yB,KAEXN,EAAIK,EACJA,EAAOnqB,IAAIqqB,IAEf,IAAIC,EAAS,EACb,GAAIF,EAASR,GAAQS,EAASR,MACrBM,EAAOD,GAAWC,GAAQD,GAC3BH,EAAOG,EAAOJ,EACdE,EAAKF,GAAKC,EAAOG,GACjBA,EAAO5yB,IAAI8yB,KAEXL,EAAOI,EAAOL,EACdE,EAAKF,GAAKC,EAAOI,GACjBA,EAAOnqB,IAAIqqB,IAEfP,EAAIC,EACO,IAAPC,IACA71B,EAAEm2B,KAAYN,GAEXI,EAASR,GAAQS,EAASR,GACxBM,EAAOD,GAAWC,GAAQD,GAC3BH,EAAOD,EAAII,EACXD,EAAQF,EAAOD,EACfE,EAAKF,GAAKC,EAAOE,IAAUC,EAAOD,GAClCC,EAAO5yB,IAAI8yB,KAEXL,EAAOD,EAAIK,EACXF,EAAQF,EAAOD,EACfE,EAAKF,GAAKC,EAAOE,IAAUE,EAAOF,GAClCE,EAAOnqB,IAAIqqB,IAEfP,EAAIC,EACO,IAAPC,IACA71B,EAAEm2B,KAAYN,QAInBI,EAASR,GACZG,EAAOD,EAAII,EACXD,EAAQF,EAAOD,EACfE,EAAKF,GAAKC,EAAOE,IAAUC,EAAOD,GAClCC,EAAO5yB,IAAI8yB,GACXN,EAAIC,EACO,IAAPC,IACA71B,EAAEm2B,KAAYN,QAGfK,EAASR,GACZE,EAAOD,EAAIK,EACXF,EAAQF,EAAOD,EACfE,EAAKF,GAAKC,EAAOE,IAAUE,EAAOF,GAClCE,EAAOnqB,IAAIqqB,GACXP,EAAIC,EACO,IAAPC,IACA71B,EAAEm2B,KAAYN,GAMtB,OAHU,IAANF,GAAsB,IAAXQ,IACXn2B,EAAEm2B,KAAYR,GAEXQ,WASFC,GAAIt3B,GACT,OAAO,IAAIu3B,aAAav3B,GAG5B,MAIMw3B,GAAIF,GAAI,GACRG,GAAKH,GAAI,GACTI,GAAKJ,GAAI,IACTK,GAAIL,GAAI,IACRM,GAAIN,GAAI,YAgKLO,GAASC,EAAIC,EAAIC,EAAIC,EAAItrB,EAAIkE,GAClC,MAAMqnB,GAAWH,EAAKlnB,IAAOmnB,EAAKrrB,GAC5BwrB,GAAYL,EAAKnrB,IAAOsrB,EAAKpnB,GAC7BunB,EAAMF,EAAUC,EAEtB,GAAgB,IAAZD,GAA8B,IAAbC,GAAmBD,EAAU,GAAQC,EAAW,EAAI,OAAOC,EAEhF,MAAMC,EAASj1B,KAAK+L,IAAI+oB,EAAUC,GAClC,OAAI/0B,KAAK+L,IAAIipB,IAhLC,sBAgLsBC,EAAeD,YAtKhCN,EAAIC,EAAIC,EAAIC,EAAItrB,EAAIkE,EAAIwnB,GAC3C,IAAIC,EAASC,EAASC,EAASC,EAC3BzB,EAAOl3B,EAAG44B,EAAKC,EAAKC,EAAKC,EAAK1P,EAAI2P,EAAIC,EAAIC,EAAIC,EAAIzG,EAAIF,EAAI4G,EAE9D,MAAMC,EAAMrB,EAAKnrB,EACXysB,EAAMpB,EAAKrrB,EACX0sB,EAAMtB,EAAKlnB,EACXyoB,EAAMrB,EAAKpnB,EAEjBmoB,EAAKG,EAAMG,EACXx5B,EAAI22B,GAAW0C,EACfT,EAAM54B,GAAKA,EAAIq5B,GACfR,EAAMQ,EAAMT,EACZ54B,EAAI22B,GAAW6C,EACfV,EAAM94B,GAAKA,EAAIw5B,GACfT,EAAMS,EAAMV,EACZK,EAAKN,EAAME,GAAOG,EAAKN,EAAME,EAAMD,EAAMC,EAAMF,EAAMG,GACrDrG,EAAK6G,EAAMD,EACXt5B,EAAI22B,GAAW4C,EACfX,EAAM54B,GAAKA,EAAIu5B,GACfV,EAAMU,EAAMX,EACZ54B,EAAI22B,GAAW2C,EACfR,EAAM94B,GAAKA,EAAIs5B,GACfP,EAAMO,EAAMR,EACZtG,EAAKqG,EAAME,GAAOrG,EAAKkG,EAAME,EAAMD,EAAMC,EAAMF,EAAMG,GACrD1P,EAAK8P,EAAK3G,EACV0E,EAAQiC,EAAK9P,EACbqO,GAAE,GAAKyB,GAAM9P,EAAK6N,IAAUA,EAAQ1E,GACpCwG,EAAKE,EAAK7P,EACV6N,EAAQ8B,EAAKE,EACbD,EAAKC,GAAMF,EAAK9B,IAAU7N,EAAK6N,GAC/B7N,EAAK4P,EAAKvG,EACVwE,EAAQ+B,EAAK5P,EACbqO,GAAE,GAAKuB,GAAM5P,EAAK6N,IAAUA,EAAQxE,GACpC0G,EAAKJ,EAAK3P,EACV6N,EAAQkC,EAAKJ,EACbtB,GAAE,GAAKsB,GAAMI,EAAKlC,IAAU7N,EAAK6N,GACjCQ,GAAE,GAAK0B,EAEP,IAAId,WA3DUzB,EAAMtyB,GACpB,IAAIwyB,EAAIxyB,EAAE,GACV,IAAK,IAAIa,EAAI,EAAGA,EAAIyxB,EAAMzxB,IAAK2xB,GAAKxyB,EAAEa,GACtC,OAAO2xB,EAwDG0C,CAAS,EAAG/B,IAClBgC,EAjDU,sBAiDgBnB,EAC9B,GAAID,GAAOoB,IAAapB,GAAOoB,EAC3B,OAAOpB,EAYX,GATApB,EAAQc,EAAKqB,EACbb,EAAUR,GAAMqB,EAAMnC,IAAUA,EAAQrqB,GACxCqqB,EAAQgB,EAAKoB,EACbZ,EAAUR,GAAMoB,EAAMpC,IAAUA,EAAQrqB,GACxCqqB,EAAQe,EAAKsB,EACbd,EAAUR,GAAMsB,EAAMrC,IAAUA,EAAQnmB,GACxCmmB,EAAQiB,EAAKqB,EACbb,EAAUR,GAAMqB,EAAMtC,IAAUA,EAAQnmB,GAExB,IAAZynB,GAA6B,IAAZC,GAA6B,IAAZC,GAA6B,IAAZC,EACnD,OAAOL,EAKX,GAFAoB,EAlEc,sBAkEYnB,EAzJV,sBAyJoCj1B,KAAK+L,IAAIipB,GAC7DA,GAAQe,EAAMV,EAAUa,EAAMhB,GAAYe,EAAMb,EAAUY,EAAMb,GAC5DH,GAAOoB,IAAapB,GAAOoB,EAAU,OAAOpB,EAEhDY,EAAKV,EAAUgB,EACfx5B,EAAI22B,GAAW6B,EACfI,EAAM54B,GAAKA,EAAIw4B,GACfK,EAAML,EAAUI,EAChB54B,EAAI22B,GAAW6C,EACfV,EAAM94B,GAAKA,EAAIw5B,GACfT,EAAMS,EAAMV,EACZK,EAAKN,EAAME,GAAOG,EAAKN,EAAME,EAAMD,EAAMC,EAAMF,EAAMG,GACrDrG,EAAK+F,EAAUa,EACft5B,EAAI22B,GAAW8B,EACfG,EAAM54B,GAAKA,EAAIy4B,GACfI,EAAMJ,EAAUG,EAChB54B,EAAI22B,GAAW2C,EACfR,EAAM94B,GAAKA,EAAIs5B,GACfP,EAAMO,EAAMR,EACZtG,EAAKqG,EAAME,GAAOrG,EAAKkG,EAAME,EAAMD,EAAMC,EAAMF,EAAMG,GACrD1P,EAAK8P,EAAK3G,EACV0E,EAAQiC,EAAK9P,EACbyO,GAAE,GAAKqB,GAAM9P,EAAK6N,IAAUA,EAAQ1E,GACpCwG,EAAKE,EAAK7P,EACV6N,EAAQ8B,EAAKE,EACbD,EAAKC,GAAMF,EAAK9B,IAAU7N,EAAK6N,GAC/B7N,EAAK4P,EAAKvG,EACVwE,EAAQ+B,EAAK5P,EACbyO,GAAE,GAAKmB,GAAM5P,EAAK6N,IAAUA,EAAQxE,GACpC0G,EAAKJ,EAAK3P,EACV6N,EAAQkC,EAAKJ,EACblB,GAAE,GAAKkB,GAAMI,EAAKlC,IAAU7N,EAAK6N,GACjCY,GAAE,GAAKsB,EACP,MAAMO,EAAQ/C,GAAI,EAAGc,GAAG,EAAGI,GAAGH,IAE9BuB,EAAKG,EAAMV,EACX34B,EAAI22B,GAAW0C,EACfT,EAAM54B,GAAKA,EAAIq5B,GACfR,EAAMQ,EAAMT,EACZ54B,EAAI22B,GAAWgC,EACfG,EAAM94B,GAAKA,EAAI24B,GACfI,EAAMJ,EAAUG,EAChBK,EAAKN,EAAME,GAAOG,EAAKN,EAAME,EAAMD,EAAMC,EAAMF,EAAMG,GACrDrG,EAAK6G,EAAMb,EACX14B,EAAI22B,GAAW4C,EACfX,EAAM54B,GAAKA,EAAIu5B,GACfV,EAAMU,EAAMX,EACZ54B,EAAI22B,GAAW+B,EACfI,EAAM94B,GAAKA,EAAI04B,GACfK,EAAML,EAAUI,EAChBtG,EAAKqG,EAAME,GAAOrG,EAAKkG,EAAME,EAAMD,EAAMC,EAAMF,EAAMG,GACrD1P,EAAK8P,EAAK3G,EACV0E,EAAQiC,EAAK9P,EACbyO,GAAE,GAAKqB,GAAM9P,EAAK6N,IAAUA,EAAQ1E,GACpCwG,EAAKE,EAAK7P,EACV6N,EAAQ8B,EAAKE,EACbD,EAAKC,GAAMF,EAAK9B,IAAU7N,EAAK6N,GAC/B7N,EAAK4P,EAAKvG,EACVwE,EAAQ+B,EAAK5P,EACbyO,GAAE,GAAKmB,GAAM5P,EAAK6N,IAAUA,EAAQxE,GACpC0G,EAAKJ,EAAK3P,EACV6N,EAAQkC,EAAKJ,EACblB,GAAE,GAAKkB,GAAMI,EAAKlC,IAAU7N,EAAK6N,GACjCY,GAAE,GAAKsB,EACP,MAAMQ,EAAQhD,GAAI+C,EAAOhC,GAAI,EAAGG,GAAGF,IAEnCsB,EAAKV,EAAUG,EACf34B,EAAI22B,GAAW6B,EACfI,EAAM54B,GAAKA,EAAIw4B,GACfK,EAAML,EAAUI,EAChB54B,EAAI22B,GAAWgC,EACfG,EAAM94B,GAAKA,EAAI24B,GACfI,EAAMJ,EAAUG,EAChBK,EAAKN,EAAME,GAAOG,EAAKN,EAAME,EAAMD,EAAMC,EAAMF,EAAMG,GACrDrG,EAAK+F,EAAUC,EACf14B,EAAI22B,GAAW8B,EACfG,EAAM54B,GAAKA,EAAIy4B,GACfI,EAAMJ,EAAUG,EAChB54B,EAAI22B,GAAW+B,EACfI,EAAM94B,GAAKA,EAAI04B,GACfK,EAAML,EAAUI,EAChBtG,EAAKqG,EAAME,GAAOrG,EAAKkG,EAAME,EAAMD,EAAMC,EAAMF,EAAMG,GACrD1P,EAAK8P,EAAK3G,EACV0E,EAAQiC,EAAK9P,EACbyO,GAAE,GAAKqB,GAAM9P,EAAK6N,IAAUA,EAAQ1E,GACpCwG,EAAKE,EAAK7P,EACV6N,EAAQ8B,EAAKE,EACbD,EAAKC,GAAMF,EAAK9B,IAAU7N,EAAK6N,GAC/B7N,EAAK4P,EAAKvG,EACVwE,EAAQ+B,EAAK5P,EACbyO,GAAE,GAAKmB,GAAM5P,EAAK6N,IAAUA,EAAQxE,GACpC0G,EAAKJ,EAAK3P,EACV6N,EAAQkC,EAAKJ,EACblB,GAAE,GAAKkB,GAAMI,EAAKlC,IAAU7N,EAAK6N,GACjCY,GAAE,GAAKsB,EACP,MAAMS,EAAOjD,GAAIgD,EAAOhC,GAAI,EAAGE,GAAGD,IAElC,OAAOA,GAAEgC,EAAO,GAaRC,CAAc9B,EAAIC,EAAIC,EAAIC,EAAItrB,EAAIkE,EAAIwnB,GAGlD,MAAMwB,GAAUz2B,KAAK0f,IAAI,GAAG,IACtBgX,GAAa,IAAIC,YAAY,WAE7BC,eAEUC,EAAQC,EAAOC,GAAaC,EAAOC,IAC3C,MAAMr6B,EAAIi6B,EAAO95B,OACXm6B,EAAS,IAAI/C,aAAiB,EAAJv3B,GAEhC,IAAK,IAAIkF,EAAI,EAAGA,EAAIlF,EAAGkF,IAAK,CACxB,MAAM2V,EAAIof,EAAO/0B,GACjBo1B,EAAO,EAAIp1B,GAAKg1B,EAAKrf,GACrByf,EAAO,EAAIp1B,EAAI,GAAKk1B,EAAKvf,GAG7B,OAAO,IAAImf,GAAWM,eAGdA,GACR,MAAMt6B,EAAIs6B,EAAOn6B,QAAU,EAC3B,GAAIH,EAAI,GAA0B,iBAAds6B,EAAO,GAAiB,MAAM,IAAI70B,MAAM,uCAE5DtH,KAAKm8B,OAASA,EAGd,MAAMC,EAAen3B,KAAK+S,IAAI,EAAInW,EAAI,EAAG,GACzC7B,KAAKq8B,WAAa,IAAIT,YAA2B,EAAfQ,GAClCp8B,KAAKs8B,WAAa,IAAIC,WAA0B,EAAfH,GAGjCp8B,KAAKw8B,UAAYv3B,KAAKw3B,KAAKx3B,KAAKiL,KAAKrO,IACrC7B,KAAK08B,UAAY,IAAId,YAAY/5B,GACjC7B,KAAK28B,UAAY,IAAIf,YAAY/5B,GACjC7B,KAAK48B,SAAW,IAAIhB,YAAY/5B,GAChC7B,KAAK68B,UAAY,IAAIN,WAAWv8B,KAAKw8B,WAAW3qB,MAAK,GAGrD7R,KAAK88B,KAAO,IAAIlB,YAAY/5B,GAC5B7B,KAAK+8B,OAAS,IAAI3D,aAAav3B,GAE/B7B,KAAKif,SAGTA,SACI,MAAOkd,OAAAA,EAAQO,UAAWM,EAAUL,UAAWM,EAAUL,SAAUM,EAASL,UAAWM,GAAan9B,KAC9F6B,EAAIs6B,EAAOn6B,QAAU,EAG3B,IAAIo7B,EAAOpT,EAAAA,EACPqT,EAAOrT,EAAAA,EACPsT,GAAQtT,EAAAA,EACRuT,GAAQvT,EAAAA,EAEZ,IAAK,IAAIjjB,EAAI,EAAGA,EAAIlF,EAAGkF,IAAK,CACxB,MAAMmH,EAAIiuB,EAAO,EAAIp1B,GACfoH,EAAIguB,EAAO,EAAIp1B,EAAI,GACrBmH,EAAIkvB,IAAMA,EAAOlvB,GACjBC,EAAIkvB,IAAMA,EAAOlvB,GACjBD,EAAIovB,IAAMA,EAAOpvB,GACjBC,EAAIovB,IAAMA,EAAOpvB,GACrBnO,KAAK88B,KAAK/1B,GAAKA,EAEnB,MAAMyH,GAAM4uB,EAAOE,GAAQ,EACrB5qB,GAAM2qB,EAAOE,GAAQ,EAE3B,IACIC,EAAI5jB,EAAImb,EADR0I,EAAUzT,EAAAA,EAId,IAAK,IAAIgM,EAAI,EAAGA,EAAIn0B,EAAGm0B,IAAK,CACxB,MAAMrnB,EAAI+uB,GAAKlvB,EAAIkE,EAAIypB,EAAO,EAAInG,GAAImG,EAAO,EAAInG,EAAI,IACjDrnB,EAAI8uB,IACJD,EAAKxH,EACLyH,EAAU9uB,GAGlB,MAAMgvB,EAAMxB,EAAO,EAAIqB,GACjBI,EAAMzB,EAAO,EAAIqB,EAAK,GAE5BC,EAAUzT,EAAAA,EAGV,IAAK,IAAI6T,EAAI,EAAGA,EAAIh8B,EAAGg8B,IAAK,CACxB,GAAIA,IAAML,EAAI,SACd,MAAM7uB,EAAI+uB,GAAKC,EAAKC,EAAKzB,EAAO,EAAI0B,GAAI1B,EAAO,EAAI0B,EAAI,IACnDlvB,EAAI8uB,GAAW9uB,EAAI,IACnBiL,EAAKikB,EACLJ,EAAU9uB,GAGlB,IAAImvB,EAAM3B,EAAO,EAAIviB,GACjBmkB,EAAM5B,EAAO,EAAIviB,EAAK,GAEtBokB,EAAYhU,EAAAA,EAGhB,IAAK,IAAIiU,EAAI,EAAGA,EAAIp8B,EAAGo8B,IAAK,CACxB,GAAIA,IAAMT,GAAMS,IAAMrkB,EAAI,SAC1B,MAAMxP,EAAI8zB,GAAaP,EAAKC,EAAKE,EAAKC,EAAK5B,EAAO,EAAI8B,GAAI9B,EAAO,EAAI8B,EAAI,IACrE7zB,EAAI4zB,IACJjJ,EAAKkJ,EACLD,EAAY5zB,GAGpB,IAAI+zB,EAAMhC,EAAO,EAAIpH,GACjBqJ,EAAMjC,EAAO,EAAIpH,EAAK,GAE1B,GAAIiJ,IAAchU,EAAAA,EAAU,CAGxB,IAAK,IAAIjjB,EAAI,EAAGA,EAAIlF,EAAGkF,IACnB/G,KAAK+8B,OAAOh2B,GAAMo1B,EAAO,EAAIp1B,GAAKo1B,EAAO,IAAQA,EAAO,EAAIp1B,EAAI,GAAKo1B,EAAO,GAEhFkC,GAAUr+B,KAAK88B,KAAM98B,KAAK+8B,OAAQ,EAAGl7B,EAAI,GACzC,MAAMy8B,EAAO,IAAI1C,YAAY/5B,GAC7B,IAAIkyB,EAAI,EACR,IAAK,IAAIwK,EAAI,EAAGC,GAAMxU,EAAAA,EAAUuU,EAAI18B,EAAG08B,IAAK,CACxC,MAAMjyB,EAAKtM,KAAK88B,KAAKyB,GACjBv+B,KAAK+8B,OAAOzwB,GAAMkyB,IAClBF,EAAKvK,KAAOznB,EACZkyB,EAAKx+B,KAAK+8B,OAAOzwB,IAMzB,OAHAtM,KAAKs+B,KAAOA,EAAKG,SAAS,EAAG1K,GAC7B/zB,KAAK0+B,UAAY,IAAI9C,YAAY,QACjC57B,KAAK2+B,UAAY,IAAI/C,YAAY,IAKrC,GAAIlC,GAASiE,EAAKC,EAAKE,EAAKC,EAAKI,EAAKC,GAAO,EAAG,CAC5C,MAAMr3B,EAAI6S,EACJ1L,EAAI4vB,EACJ3vB,EAAI4vB,EACVnkB,EAAKmb,EACL+I,EAAMK,EACNJ,EAAMK,EACNrJ,EAAKhuB,EACLo3B,EAAMjwB,EACNkwB,EAAMjwB,EAGV,MAAM2F,EA4Rd,SAAC6lB,EAAAC,EAAAC,EAAAC,EAAAtrB,EAAAkE,SAEQqC,EAAA8kB,EAAAF,EACD3kB,EAAK8kB,EAAOF,EAERgF,EAAMpwB,EAAImrB,EACVkF,EAAMnsB,EAAAknB,EACNkF,EAAK/pB,EAAOA,EAACC,EAAAA,IACL4pB,EAAIA,EAAIC,EAAIA,EACpBlwB,EAAK,IAAQoG,EAAI8pB,EAAA7pB,EAAA4pB,SAGrB,CACA1wB,EAHCyrB,GAAAkF,EAAAC,EAAA9pB,EAAA+pB,GAAApwB,EAIDR,EAHIyrB,GAAA7kB,EAAAgqB,EAAAH,EAAAE,GAAAnwB,GAvSWqwB,CAAarB,EAAKC,EAAKE,EAAKC,EAAKI,EAAKC,GACrDp+B,KAAKi/B,IAAMnrB,EAAO5F,EAClBlO,KAAKk/B,IAAMprB,EAAO3F,EAElB,IAAK,IAAIgxB,EAAI,EAAGA,EAAIt9B,EAAGs9B,IACnBn/B,KAAK+8B,OAAOoC,GAAKzB,GAAKvB,EAAO,EAAIgD,GAAIhD,EAAO,EAAIgD,EAAI,GAAIrrB,EAAO5F,EAAG4F,EAAO3F,GAI7EkwB,GAAUr+B,KAAK88B,KAAM98B,KAAK+8B,OAAQ,EAAGl7B,EAAI,GAGzC7B,KAAKo/B,WAAa5B,EAClB,IAAI6B,EAAW,EAEfpC,EAASO,GAAMR,EAASjI,GAAMnb,EAC9BqjB,EAASrjB,GAAMojB,EAASQ,GAAMzI,EAC9BkI,EAASlI,GAAMiI,EAASpjB,GAAM4jB,EAE9BN,EAAQM,GAAM,EACdN,EAAQtjB,GAAM,EACdsjB,EAAQnI,GAAM,EAEdoI,EAAStrB,MAAK,GACdsrB,EAASn9B,KAAKs/B,SAAS3B,EAAKC,IAAQJ,EACpCL,EAASn9B,KAAKs/B,SAASxB,EAAKC,IAAQnkB,EACpCujB,EAASn9B,KAAKs/B,SAASnB,EAAKC,IAAQrJ,EAEpC/0B,KAAKu/B,aAAe,EACpBv/B,KAAKw/B,aAAahC,EAAI5jB,EAAImb,GAAI,GAAI,GAAI,GAEtC,IAAK,IAAW0K,EAAIC,EAAXzZ,EAAI,EAAWA,EAAIjmB,KAAK88B,KAAK96B,OAAQikB,IAAK,CAC/C,MAAMlf,EAAI/G,KAAK88B,KAAK7W,GACd/X,EAAIiuB,EAAO,EAAIp1B,GACfoH,EAAIguB,EAAO,EAAIp1B,EAAI,GAGzB,GAAIkf,EAAI,GAAKhhB,KAAK+L,IAAI9C,EAAIuxB,IAAO/D,IAAWz2B,KAAK+L,IAAI7C,EAAIuxB,IAAOhE,GAAS,SAKzE,GAJA+D,EAAKvxB,EACLwxB,EAAKvxB,EAGDpH,IAAMy2B,GAAMz2B,IAAM6S,GAAM7S,IAAMguB,EAAI,SAGtC,IAAI3yB,EAAQ,EACZ,IAAK,IAAI2xB,EAAI,EAAGnoB,EAAM5L,KAAKs/B,SAASpxB,EAAGC,GAAI4lB,EAAI/zB,KAAKw8B,YAChDp6B,EAAQ+6B,GAAUvxB,EAAMmoB,GAAK/zB,KAAKw8B,YACpB,IAAVp6B,GAAgBA,IAAU66B,EAAS76B,IAFoB2xB,KAK/D3xB,EAAQ46B,EAAS56B,GACjB,IAAeu9B,EAAXz5B,EAAI9D,OACDu9B,EAAI1C,EAAS/2B,GAAIwzB,GAASxrB,EAAGC,EAAGguB,EAAO,EAAIj2B,GAAIi2B,EAAO,EAAIj2B,EAAI,GAAIi2B,EAAO,EAAIwD,GAAIxD,EAAO,EAAIwD,EAAI,KAAO,GAE1G,GADAz5B,EAAIy5B,EACAz5B,IAAM9D,EAAO,CACb8D,GAAI,EACJ,MAGR,IAAU,IAANA,EAAU,SAGd,IAAI6H,EAAI/N,KAAKw/B,aAAat5B,EAAGa,EAAGk2B,EAAS/2B,IAAI,GAAI,EAAIg3B,EAAQh3B,IAG7Dg3B,EAAQn2B,GAAK/G,KAAK4/B,UAAU7xB,EAAI,GAChCmvB,EAAQh3B,GAAK6H,EACbsxB,IAGA,IAAIx9B,EAAIo7B,EAAS/2B,QACVy5B,EAAI1C,EAASp7B,GAAI63B,GAASxrB,EAAGC,EAAGguB,EAAO,EAAIt6B,GAAIs6B,EAAO,EAAIt6B,EAAI,GAAIs6B,EAAO,EAAIwD,GAAIxD,EAAO,EAAIwD,EAAI,IAAM,GACzG5xB,EAAI/N,KAAKw/B,aAAa39B,EAAGkF,EAAG44B,EAAGzC,EAAQn2B,IAAI,EAAIm2B,EAAQr7B,IACvDq7B,EAAQn2B,GAAK/G,KAAK4/B,UAAU7xB,EAAI,GAChCkvB,EAASp7B,GAAKA,EACdw9B,IACAx9B,EAAI89B,EAIR,GAAIz5B,IAAM9D,EAAK,KACJu9B,EAAI3C,EAAS92B,GAAIwzB,GAASxrB,EAAGC,EAAGguB,EAAO,EAAIwD,GAAIxD,EAAO,EAAIwD,EAAI,GAAIxD,EAAO,EAAIj2B,GAAIi2B,EAAO,EAAIj2B,EAAI,IAAM,GACzG6H,EAAI/N,KAAKw/B,aAAaG,EAAG54B,EAAGb,GAAG,EAAIg3B,EAAQh3B,GAAIg3B,EAAQyC,IACvD3/B,KAAK4/B,UAAU7xB,EAAI,GACnBmvB,EAAQyC,GAAK5xB,EACbkvB,EAAS/2B,GAAKA,EACdm5B,IACAn5B,EAAIy5B,EAKZ3/B,KAAKo/B,WAAapC,EAASj2B,GAAKb,EAChC+2B,EAAS/2B,GAAK82B,EAASn7B,GAAKkF,EAC5Bk2B,EAASl2B,GAAKlF,EAGds7B,EAASn9B,KAAKs/B,SAASpxB,EAAGC,IAAMpH,EAChCo2B,EAASn9B,KAAKs/B,SAASnD,EAAO,EAAIj2B,GAAIi2B,EAAO,EAAIj2B,EAAI,KAAOA,EAGhElG,KAAKs+B,KAAO,IAAI1C,YAAYyD,GAC5B,IAAK,IAAIQ,EAAI,EAAG35B,EAAIlG,KAAKo/B,WAAYS,EAAIR,EAAUQ,IAC/C7/B,KAAKs+B,KAAKuB,GAAK35B,EACfA,EAAI+2B,EAAS/2B,GAIjBlG,KAAK0+B,UAAY1+B,KAAKq8B,WAAWoC,SAAS,EAAGz+B,KAAKu/B,cAClDv/B,KAAK2+B,UAAY3+B,KAAKs8B,WAAWmC,SAAS,EAAGz+B,KAAKu/B,cAGtDD,SAASpxB,EAAGC,GACR,OAAOlJ,KAAKuC,eAgIEuN,EAAAC,GAClB,MAAM0H,EAAE3H,GAAQ9P,KAAE+L,IAAA+D,GAAA9P,KAAA+L,IAAAgE,IAElB,OAAQA,EAAK,EAAG,EAAK0H,EAAE,EAAKA,GAAA,EAnINojB,CAAY5xB,EAAIlO,KAAKi/B,IAAK9wB,EAAInO,KAAKk/B,KAAOl/B,KAAKw8B,WAAax8B,KAAKw8B,UAGvFoD,UAAUlxB,GACN,MAAO2tB,WAAYqC,EAAWpC,WAAYqC,EAASxC,OAAEA,GAAUn8B,KAE/D,IAAI+G,EAAI,EACJg5B,EAAK,SAGI,CACT,MAAMz1B,EAAIq0B,EAAUjwB,GAmCdsxB,EAAOtxB,EAAGA,EAAA,KAMhBqxB,EAAIC,GAAOtxB,EAAG,GAAA,GACV,IAAApE,EAAU,CACV,GAAU,IAAVvD,EAAW,MAEX2H,EAAAitB,KAAwB50B,GAExB,iBAEOuD,EAAEA,EAAG,IACL01B,GAACtxB,EAAA,GAAA,OACIpE,EAAK,GAAA,MACAy1B,OACArxB,OACRuxB,OACQnB,MACJoB,GAAqB/D,EAAA,EAAA1V,GAAA0V,EAAA,EAAA1V,EAAA,GAAA0V,EAAA,EAAAgE,GAAAhE,EAAA,EAAAgE,EAAA,GAAAhE,EAAA,EAAAiE,GAAAjE,EAAA,EAAAiE,EAAA,GAAAjE,EAAA,EAAAzV,GAAAyV,EAAA,EAAAzV,EAAA,IACjC,CACDgY,EAAUhwB,GAAIgY,EACdgY,EAAUp0B,GAAImc,EACd,MAAK4Z,EAAM1B,EAAMG,GAIjB,IAAsF,IAAAuB,EAAA,CAClF,IAAIn6B,EAAAlG,KAAAo/B,WAGJ,EAAA,CACC,GAAMp/B,KAAE48B,SAAK12B,KAAA44B,EAAA,CACd9+B,KAAA48B,SAAA12B,GAAAwI,EACP,MAGIxI,EAAAlG,KAAA08B,UAAAx2B,SACZA,IAAAlG,KAAAo/B,YAGQp/B,KAAAsgC,MAAY5xB,EAAK2xB,GACjBrgC,KAAOsgC,MAAOh2B,EAAAq0B,EAAYoB,IAClC//B,KAAAsgC,MAAAP,EAAAjB,GAEoE,MAAAyB,EAAAC,GAAAl2B,EAAA,GAAA,EAEvDvD,EAAK40B,GAAY35B,SAAA25B,GAAA50B,KAAAw5B,OAEtB,CACA,GAAY,IAAZx5B,EAAgB,MAChB2H,EAAAitB,KAAsB50B,IAI3B,OAAKg5B,QAILrxB,EAAApE,GACHtK,KAAAs8B,WAAA5tB,GAAApE,iCAKDk1B,aAAYhC,EAAI5jB,EAAKmb,EAAIrmB,EAAEpE,EAAI3I,GAC/B,MAAUoM,EAAI/N,KAAIu/B,aAUlB,OATHv/B,KAAAq8B,WAAAtuB,GAAAyvB,OAEQnB,WAAAtuB,EAAA,GAAA6L,EACL5Z,KAAQq8B,WAAUtuB,EAAA,GAAAgnB,EAClB/0B,KAAQsgC,MAAKvyB,EAAKW,GAClB1O,KAASsgC,MAAKvyB,EAAK,EAAGzD,GACzBtK,KAAAsgC,MAAAvyB,EAAA,EAAApM,QAEQ49B,cAAA,EACMxxB,YASN2vB,GAAuB/D,EAAAC,EAAAC,EAAAC,GAE5B,MAAM/kB,EAAG4kB,EAAME,EAGlB7kB,EAAA4kB,EAAAE,SAEQ/kB,EAAAA,EAAAC,EAAAA,WAEAkrB,GAAavG,EAAAC,EAAAC,EAAAC,EAAAtrB,EAAAkE,EAAA+tB,EAAAC,GAClB,MAAM3rB,EAAK4kB,EAAK8G,EACVzrB,EAAK4kB,EAAK8G,EAEV9B,EAAK/E,EAAK4G,EACV5B,EAAK/E,EAAK4G,EACV/tB,EAAInE,EAAGiyB,EAEP7tB,EAAKF,EAAKguB,EAGVC,EAAK/B,EAAKA,EAAIC,EAAAA,EACvB+B,EAAAjuB,EAAAA,EAAAC,EAAAA,SAEQmC,GAAA8pB,EAAA+B,EAAAD,EAAA/tB,GAAAoC,GAAa4pB,EAAIgC,EAAMD,EAAIhuB,IALrBoC,EAAKA,EAAKC,EAAKA,IAKiB4pB,EAAAhsB,EAAAisB,EAAAlsB,GAAA,WAEtCurB,GAAavE,EAAAC,EAAAC,EAAAC,EAAAtrB,EAAAkE,GAClB,MAAMqC,EAAK8kB,EAAKF,EACV3kB,EAAK8kB,EAAKF,EAEVgF,EAAKpwB,EAAKmrB,EACVkF,EAAKnsB,EAAKknB,EACVkF,EAAI/pB,EAAGA,EAAMC,EAAKA,EAElB+pB,EAAIH,EAAMA,EAAKC,EAAKA,EACpBlwB,EAAI,IAAMoG,EAAK8pB,EAAK7pB,EAAK4pB,GAEzB1wB,GAAE2wB,EAAAC,EAAA9pB,EAAA+pB,GAAApwB,KAACoG,EAAAgqB,EAAAH,EAAAE,GAAAnwB,SAAET,EAACA,EAAAC,EAAAA,WAkBRkwB,GAA8BwC,EAAKC,EAAIltB,EAAAC,MACvCA,EAAID,GAAU,GAAI,IAAK,IAAK7M,EAAI6M,EAAM,EAAA7M,GAAA8M,EAAA9M,IAAA,CAEtC,MAAMg6B,EAAOF,EAAI95B,GACXi6B,EAAWF,EAAMC,SAChBh6B,EAAO,UACN6M,GAAAktB,EAAAD,EAAA9M,IAAAiN,GAAAH,EAAA9M,EAAA,GAAA8M,EAAA9M,YAAWgN,WAGfh6B,EAAA6M,EAAA,EACHmgB,EAAAlgB,EACDotB,GAAqBJ,EAHNjtB,EAAKC,GAAA,EAGC9M,GACjB+5B,EAAKD,EAAIjtB,IAAAktB,EAAAD,EAAAhtB,KAAAotB,GAAAJ,EAAAjtB,EAAAC,GAETitB,EAAKD,EAAI95B,IAAI+5B,EAAQD,EAAIhtB,KAAGotB,GAAAJ,EAAA95B,EAAA8M,GAC5BitB,EAAAD,EAAAjtB,IAAAktB,EAAAD,EAAA95B,KAAUk6B,GAAoBJ,EAAAjtB,EAAA7M,SAC9Bg6B,EAAAF,EAAA95B,GACHi6B,EAAOF,EAAAC,UACJ,CACA,GAAAh6B,UACH+5B,EAAAD,EAAA95B,IAAAi6B,GACJ,GAAAjN,UACJ+M,EAAAD,EAAA9M,IAAAiN,GAEQ,GAAAjN,EAAAhtB,EAAA,MACCk6B,GAAWJ,EAAA95B,EAAAgtB,GAEb8M,EAACjtB,EAAO,GAAAitB,EAAA9M,GACf8M,EAAA9M,GAAAgN,EAEQltB,EAAA9M,EAAA,GAAAgtB,EAAAngB,GACGyqB,GAAEwC,EAAAC,EAAA/5B,EAAA8M,GACbwqB,GAAAwC,EAAAC,EAAAltB,EAAAmgB,EAAA,KAEWsK,GAAEwC,EAAAC,EAAAltB,EAAAmgB,EAAA,GACbsK,GAAAwC,EAAAC,EAAA/5B,EAAA8M,cAMGotB,GACKC,EAAMn6B,EAAAgtB,SACX9H,EAAMiV,EAAKn6B,GACbm6B,EAACn6B,GAAAm6B,EAAAnN,GACDmN,EAAAnN,GAAQ9H,WAEP+P,GAAAtf,GACD,OAAAA,EAAS,eAEwBA,YAC7B,SAEHykB,GAAA,WACDC,iBAECphC,KAAAqhC,IAAArhC,KAAAshC,IAAAthC,KAAAuhC,IAAAvhC,KAAAwhC,IAAA,KACGxhC,KAAIyhC,EAAK,UAEXvzB,EAAMC,GACNnO,KAAKyhC,GAAG,IAAIzhC,KAAAqhC,IAAArhC,KAAAuhC,KAAArzB,KAAAlO,KAAAshC,IAAAthC,KAAAwhC,KAAArzB,gBAGK,YAARozB,MACPvhC,KAAMuhC,IAAMvhC,KAAAqhC,IAAArhC,KAAAwhC,IAAAxhC,KAAAshC,IACVthC,KAAEyhC,GAAQ,YAGdvzB,EAAMC,GACPnO,KAAAyhC,GAAA,IAAAzhC,KAAAuhC,KAAArzB,KAAAlO,KAAAwhC,KAAArzB,QAECD,EAAAC,EAAM/D,YACP8D,GAAAA,IAAA9D,GAAAA,GAGGsG,EAHHvC,GAAAA,SAIc,MAAA,IAAA7G,MAAA,mBACF,OAAPtH,KAAKuhC,IAAEvhC,KAAAyhC,GAAA,IAAAhxB,KAAAC,KACZzL,KAAA+L,IAAAhR,KAAAuhC,IAAA9wB,GAAA0wB,IAAAl8B,KAAA+L,IAAAhR,KAAAwhC,IAAA9wB,GAAAywB,MAAAnhC,KAAAyhC,GAAA,IAAAhxB,EAAA,IAAAC,GACOtG,IACNpK,KAAKyhC,GAAE,IAAMr3B,KAAAA,WAAA8D,EAAA9D,KAAA+D,KAAA/D,KAAAA,WAAApK,KAAAuhC,IAAA9wB,KAAAzQ,KAAAwhC,IAAA9wB,YAAGvC,EAACrL,EAAAC,GAAA/C,KAACyhC,GAAA,IAAAzhC,KAAAqhC,IAAArhC,KAAAuhC,KAAArzB,KAAAlO,KAAAshC,IAAAthC,KAAAwhC,KAAArzB,MAAArL,MAAAC,MAAAD,KAEpBzC,QACE,OAAOL,KAAKyhC,GAAK,kCAGAA,EAAA,GACnBryB,OAAClB,EAAAC,GACDnO,KAASyhC,EAAAjhC,KAAA,CACP0N,EACDC,gBAIiDnO,KAACyhC,EAAAjhC,KAAAR,KAAAyhC,EAAA,GAAAjsB,SAAKlG,OAAGpB,EAAAC,GAAEnO,KAAGyhC,EAAAjhC,KAAA,CAAI0N,EAChEC,YAIF,OAAKnO,KAAOyhC,EAAAz/B,OAAWhC,KAAIyhC,EAAG,YAG/BC,GACDC,YAAUC,GAAAC,EAAAC,EAAAC,EAAAC,GAAA,CACR,EACA,EACA,IACD,MAEC,MAAOD,GAAAA,KAAWF,GAAAA,KAAQG,GAAIA,KAAEF,GAASA,IAAC,MAAE,IAAAx6B,MAAQ,kBAEpDtH,KAAyB4hC,SAAAA,EACzB5hC,KAAKiiC,eAAiB,IAAI7I,aAAqC,EAApCwI,EAAqB9F,OAAA95B,QAChDhC,KAAKkiC,QAAW,IAAI9I,aAAsC,EAA/BwI,EAAU9F,OAAY95B,aAC/C+/B,KAAQA,EAAG/hC,KAAA6hC,KAAeA,OAC1BG,KAAQA,EAAGhiC,KAAA8hC,KAAeA,OAC1BK,6BAGAP,SAAQ3iB,cACRkjB,QACAniC,mBAIA4hC,UAAgB9F,OAAEA,EAAAwC,KAAAA,EAAAI,UAAAA,GAAAwD,QAAAA,GAAAliC,KAElBoiC,EAAkBpiC,KAAAoiC,cAAApiC,KAAAiiC,eAAAxD,SAAA,EAAAC,EAAA18B,OAAA,EAAA,OAClB,IAAkCkM,EAAAC,EAAlCpH,EAAQ,EAAAgtB,EAAM,EAAGlyB,EAAK68B,EAAO18B,OAAK+E,EAAAlF,EAAAkF,GAAA,EAAAgtB,GAAA,EAAA,CAElC,MAAIM,EAAe,EAAVqK,EAAU33B,GACqBkgB,EAAA,EAAAyX,EAAA33B,EAAA,GACMquB,EAAA,EAAAsJ,EAAA33B,EAAA,GACAqJ,EAAA0rB,EAAAzH,GACvBhkB,EAAAyrB,EAAAzH,EAAA,GACY/jB,EAAAwrB,EAAA7U,GACjC1W,EAAKurB,EAAG7U,EAAG,GAC0D7V,EAAA0qB,EAAA1G,GACd/jB,EAAAyqB,EAAA1G,EAAA,GAC/BrgB,EAAAzE,EAAAF,EACxB4E,EAAOzE,EAAGF,EACTuuB,EAAIxtB,EAAKhB,EACTyuB,EAAMxtB,EAAKhB,EACXgyB,EAAyB,GAAnBttB,EAAK8pB,EAAK7pB,EAAI4pB,GACvB,GAAC35B,KAAO+L,IAAAqxB,GAAA,KAAA,CAMP,IAAA3zB,EAAA,IAK2B,MAAAtE,EAAA,EAAAs0B,EAAA,GACtBhwB,GAAKzJ,KAAK6pB,MAAMgN,EAAI1xB,GAAAgG,GAAAyuB,GAAA/C,EAAA1xB,EAAA,GAAAiG,GAAAuuB,GACpB1wB,GAAKkC,EAAKgB,GAAA,EAAA1C,EAAAmwB,EACV1wB,GAAKkC,EAAAgB,GAAW,EAAC3C,EAAAkwB,MACf,CACF,MAAMjwB,EAAA,EAAA0zB,EACAvD,EAAG/pB,EAAGA,EAAKC,EAAMA,EACpB+pB,EAACH,EAAAA,EAAAC,EAAAA,EACR3wB,EAAKkC,GAAOyuB,EAAIC,EAAK9pB,EAAE+pB,GAAApwB,EACvBR,EAAIkC,GAAQ0E,EAAGgqB,EAAOH,EAAKE,GAAKnwB,EAElCyzB,EAAcrO,GAAI7lB,EACnBk0B,EAAArO,EAAA,GAAA5lB,EAGD,IACAsY,EACIhW,EACCC,EAHL3N,EAAMu7B,EAAMA,EAAGt8B,OAAW,GACnB0kB,EAAQ,EAAR3jB,EACCqN,EAAC0rB,EAAW,EAAE/4B,GACbsN,EAAKyrB,EAAM,EAAA/4B,EAAS,KAC3B8O,KAAO,OACP,IAAIywB,EAAK,EAAEA,EAAAhE,EAAQt8B,SAAAsgC,EACnBv/B,EAAAu7B,EAAQgE,GACR7b,EAAKC,EAAGjW,EAAGL,EAAKM,EAAOL,EACvBqW,EAAQ,EAAH3jB,EAAMqN,EAAA0rB,EAAa,EAAG/4B,GAAAsN,EAAAyrB,EAAA,EAAA/4B,EAAA,GAC3Bm/B,EAAQzb,EAAG,GAAAyb,EAAcxb,GAAMhW,EAAAL,EAC/B6xB,EAAQzb,EAAG,GAAAyb,EAAcxb,EAAE,GAAAtW,EAAAK,SAG5BrM,GACD,MAAMm+B,EAAiB,MAAVn+B,EAAoBA,EAAA,IAAAg9B,QAAAv2B,GACxB+2B,UAAQjD,UAAQA,EAAc6D,QAAAA,EAAAlE,KAAAA,GAAA8D,cAAAA,EAAAF,QAAAA,GAAAliC,QACrCs+B,EAAKt8B,QAAS,EAAI,OAAE,SACpB,IAAA+E,EAAO,EAAGlF,EAAK88B,EAAM38B,OAAU+E,EAAKlF,IAAKkF,EAAA,CACzC,MAAMgtB,EAAI4K,EAAA53B,GACV,GAAAgtB,EAAOhtB,EAAG,SACV,MAAM07B,EAAU,EAANx9B,KAAMuC,MAAAT,EAAA,GACV27B,EAAwB,EAApBz9B,KAAKuC,MAAAusB,EAAU,GACpB4O,EAAMP,EAACK,GACbG,EAAAR,EAAAK,EAAA,GACMI,EAAMT,EAAgBM,GAC9BI,EAAAV,EAAAM,EAAA,GACD1iC,KAAa+iC,eAAUJ,EAAAC,EAAAC,EAAAC,EAAA1+B,GAErB,IAAA4+B,EAAQC,EAAK3E,EAAKA,EAAIt8B,OAAO,GAC7B,IAAA,IAAOkhC,EAAM,EAAIA,EAAM5E,EAACt8B,SAAKkhC,EAAA,CAC9BF,EAAAC,EAAAA,EAAA3E,EAAA4E,GACD,MAAcn1B,EAAU,EAAV9I,KAASuC,MAACg7B,EAAAS,GAAA,GAChB/0B,EAAMk0B,EAAcr0B,GACpBI,EAAMi0B,EAAer0B,EAAA,GACjBiY,EAAS,EAATgd,EACFtmB,EAAM1c,KAACmjC,SAAWj1B,EAAAC,EAAQ+zB,EAAAlc,EAAA,GAAAkc,EAAAlc,EAAA,IAC1BtJ,GAAA1c,KAAO+iC,eAAM70B,EAAAC,EAAAuO,EAAA,GAAAA,EAAA,GAAAtY,GAErB,OAAQm+B,GAAQA,EAAKliC,qBAKd+D,GACR,MAAAm+B,EAAA,MAAAn+B,EAAAA,EAAA,IAAAg9B,QAAAv2B,EAEC,OADDzG,EAAA0N,KAAgB9R,KAAA6hC,KAAA7hC,KAAA8hC,KAAA9hC,KAAA+hC,KAAA/hC,KAAA6hC,KAAA7hC,KAAAgiC,KAAAhiC,KAAA8hC,MACRS,GAAQA,EAAGliC,mBAEhB0G,EAAM3C,SACJm+B,EAAkB,MAAVn+B,EAAcA,EAAY,IAAAg9B,QAAAv2B,EACrCixB,EAAA97B,KAAAojC,MAAAr8B,GACF,GAAA,OAAA+0B,IAAAA,EAAA95B,OAAA,OACDoC,EAAYgL,OAAI0sB,EAAA,GAAAA,EAAA,IACd,IAAAj6B,EAAMi6B,EAAO95B,OACb,KAAK85B,EAAA,KAAcA,EAAOj6B,EAAA,IAAAi6B,EAAA,KAAAA,EAAAj6B,EAAA,IAAAA,EAAA,GAAAA,GAAA,EAC1B,IAAA,IAAOwhC,EAAO,EAACA,EAAKxhC,EAAAwhC,GAAA,EAAAvH,EAAAuH,KAAAvH,EAAAuH,EAAA,IAAAvH,EAAAuH,EAAA,KAAAvH,EAAAuH,EAAA,IAAAj/B,EAAAkL,OAAAwsB,EAAAuH,GAAAvH,EAAAuH,EAAA,IAEtB,OADCj/B,EAAAiL,YACDkzB,GAAqBA,EAAMliC,wBAGzB,MAAQuhC,UAAQ9F,OAAYA,IAAM97B,KAClC,IAAI,IAAE+G,EAAM,EAAAlF,EAAMi6B,EAAQ95B,OAAC,EAAA+E,EAAAlF,IAAAkF,EAAA,CACzB,MAAAu8B,EAAQtjC,KAASujC,YAAIx8B,GACrBu8B,IAAQA,EAAOE,MAAMz8B,QAAAu8B,gBAGrBv8B,GACF,MAACqxB,EAAA,IAAAqL,GAEH,OADCzjC,KAAA0jC,WAAA38B,EAAAqxB,GACSA,EAAS/3B,uBAENoQ,EAACC,EAAAN,EAASC,EAAMjM,GAC5B,IAAAu/B,EACA,MAASC,EAAK5jC,KAAA6jC,YAAApzB,EAAAC,GACPozB,EAAK9jC,KAAK6jC,YAAOzzB,EAAAC,GACZ,IAAPuzB,GAAgB,IAAPE,GACX1/B,EAAQgL,OAAOqB,EAACC,GAChBtM,EAAuBkL,OAAAc,EAAAC,KACjBszB,EAAE3jC,KAAM+jC,aAAetzB,EAAIC,EAAKN,EAACC,EAAMuzB,EAAIE,QAC1C10B,OAAMu0B,EAAG,GAAGA,EAAE,aAMRA,EAAA,GAAAA,EAAA,cAIZ58B,EAAAmH,EAAAC,GACH,OAACD,GAAAA,IAAAA,IAAAC,GAAAA,IAAAA,GACFnO,KAAA4hC,SAAAoC,MAAAj9B,EAAAmH,EAAAC,KAAApH,aAEQA,GACP,MAAMk9B,EAAKjkC,KAAAojC,MAASr8B,GACpB,GAAIk9B,EAAE,IAAO,MAAElQ,KAAO/zB,KAAyB4hC,SAAAsC,UAAAn9B,GAAA,CAC/C,MAAMo9B,EAASnkC,KAAEojC,MAAArP,GAEb,GAAAoQ,EAAAC,EAAA,IAAA,IAAAC,EAAA,EAAAC,EAAAL,EAAAjiC,OAAAqiC,EAAAC,EAAAD,GAAA,EACF,IAAO,IAAGE,EAAK,EAAKC,EAAKL,EAACniC,OAAAuiC,EAAAC,EAAAD,GAAA,EAAA,GAAAN,EAAAI,IAAAF,EAAAI,IAAAN,EAAAI,EAAA,IAAAF,EAAAI,EAAA,IAAAN,GAAAI,EAAA,GAAAC,IAAAH,GAAAI,EAAAC,EAAA,GAAAA,IAAAP,GAAAI,EAAA,GAAAC,IAAAH,GAAAI,EAAAC,EAAA,GAAAA,GAAA,OACdzQ,EACJ,MAAMqQ,IAKlBK,MAAC19B,GACD,MAAUq7B,cAAAA,EAAAR,UAAAY,QAAAA,EAAA7D,UAAAA,EAAAD,UAAAA,IAAA1+B,KAC0C0kC,EAAAlC,EAAAz7B,GAClD,IAAW,IAAP29B,EAAW,OAAK,WACV5I,EAAS,OAAE51B,EAAIw+B,KAAkB,MAAK32B,EAAI9I,KAAAuC,MAAAtB,EAAA,GAAwB,GAAtB41B,EAAKt7B,KAAI4hC,EAAA,EAAAr0B,GAAAq0B,EAAA,EAAAr0B,EAAA,IAAE7H,EAAIA,EAAC,GAAI,EAAAA,EAAA,EAAAA,EAAA,EAAMw4B,EAAKx4B,KAAAa,EAAA,MAAEb,EAAIy4B,EAAKz4B,SAACA,IAAAw+B,IAAA,IAAAx+B,GAEjG,OAAM41B,QAEN/0B,GAEA,GAAU,IAAVA,GACyB,IADV/G,KAAG4hC,SACZtD,KAAKt8B,OAAiB,MAAM,CAEnChC,KAAA+hC,KACD/hC,KAAa8hC,KACX9hC,KAAO+hC,KACH/hC,KAAIgiC,KACJhiC,KAAI6hC,KACJ7hC,KAAIgiC,KACJhiC,KAAI6hC,KACH7hC,KAAK8hC,YAENhG,EAAS97B,KAAGykC,MAAK19B,MACR,OAAX+0B,EAAgB,OAAQ,WACtBoG,QAASyC,GAAM3kC,OACV,EAAH+G,eACI49B,EAAG3e,EAAC,GAAAhmB,KAAA4kC,cAAA79B,EAAA+0B,EAAA6I,EAAA3e,GAAA2e,EAAA3e,EAAA,GAAA2e,EAAA3e,EAAA,GAAA2e,EAAA3e,EAAA,IAAAhmB,KAAA6kC,YAAA99B,EAAA+0B,4BAAOA,EAAA95B,aAEjB0O,MADFo0B,EAAC,KACK10B,EAAG0rB,EAAQj6B,EAAK,GAAEwO,EAAGyrB,EAAAj6B,EAAA,GACzBiiC,EAAI9jC,KAAE6jC,YAASzzB,EAAAC,KACb,cACC0jB,EAAKlyB,EAAGkyB,GAAK,OACf3jB,EAAAM,EAAOL,EAAAD,EAAA0rB,EAAA/H,GAAA1jB,EAAAyrB,EAAA/H,EAAA,OACN+P,EAAM9jC,KAAG6jC,YAAKzzB,EAAaC,GAC1B,OAAa,IAARyzB,IACNiB,EAAKA,EAAI,EACTD,EAAEA,EAAEtkC,KAAM4P,EAAIC,GACdy0B,EAAK,WAEP,IAACnB,EAAAqB,EAAAC,EAAAC,EAAAC,EACD,GAAW,IAATvB,EAAY,CACV,GAA2C,QAAzCD,EAAM3jC,KAAM+jC,aAAYtzB,EAAIC,EAAKN,EAAEC,EAAMuzB,EAAAE,IAAA,UAC1CkB,EAAIC,EAAKC,EAAKC,GAAGxB,MAChB,CAAI,GAAG,QAAAA,EAAA3jC,KAAA+jC,aAAA3zB,EAAAC,EAAAI,EAAAC,EAAAozB,EAAAF,IAAA,UAAEsB,EAAGC,EAAAH,EAAAC,GAAAtB,EAACe,EAAAK,EAAAA,EAAA/kC,KAAAolC,UAAAJ,EAAAC,GACpBP,GAAAK,GAAA/kC,KAAAqlC,MAAAt+B,EAAA29B,EAAAK,EAAAD,EAAAA,EAAA9iC,QACF8iC,EAAAA,EAAAtkC,KAAAwkC,EAAAC,GACOH,EAAA,CACKE,EACCC,GAEWP,EAAKK,EAAAA,EAAA/kC,KAAAolC,UAAAF,EAAAC,GAAOT,GAAIK,GAAA/kC,KAAAqlC,MAAAt+B,EAAA29B,EAAAK,EAAAD,EAAAA,EAAA9iC,QAAO8iC,EAAIA,EAAAtkC,KAAA0kC,EAAAC,GAAWL,EAAA,CAAOI,EAAWC,GAGlF,GAAAL,EACDJ,EAAaK,EAAIA,EAAI/kC,KAAMolC,UAAUN,EAAC,GAAAA,EAAA,IAC7BJ,GAAOK,GAAA/kC,KAAAqlC,MAAAt+B,EAAA29B,EAAAK,EAAAD,EAAAA,EAAA9iC,aACV,GAAIhC,KAAMslC,SAAMv+B,GAAM/G,KAAE6hC,KAAQ7hC,KAAA+hC,MAAA,GAAA/hC,KAAA8hC,KAAA9hC,KAAAgiC,MAAA,GAAA,MAAA,MAAAD,UAAID,UAAIC,UAAIC,KAAEhiC,KAAC6hC,KACjD7hC,KAAIgiC,KACJhiC,KAAK6hC,KACL7hC,KAAK8hC,4BAIDrxB,EAAIC,EAAKN,EAAGC,EAAKuzB,EAAGE,UACjB,CACR,GAAA,IAAAF,GAAA,IAAAE,EAAA,MAAA,CACFrzB,EACDC,EACUN,EACAC,GAEJ,GAAIuzB,EAAKE,EAAA,OAAW,KAEpB,IAAE51B,EAAKC,EAAExM,EAAKiiC,GAAKE,EACb,EAAFniC,GAAMuM,EAAKuC,GAAGL,EAAKK,IAASzQ,KAAMgiC,KAAMtxB,IAAQL,EAACK,GAAMvC,EAAAnO,KAAAgiC,MAC5D,EAAArgC,GAAAuM,EAAAuC,GAAAL,EAAAK,IAAAzQ,KAAA8hC,KAAApxB,IAAAL,EAAAK,GAAAvC,EAAAnO,KAAA8hC,MACa,EAADngC,GAACwM,EAAUuC,GAAGL,EAAKK,IAAO1Q,KAAK+hC,KAAStxB,IAAQL,EAAIK,GAAGvC,EAAKlO,KAAI+hC,OACnE5zB,EAAIuC,GAAAL,EAAAK,IAAA1Q,KAAA6hC,KAAApxB,IAAAL,EAAAK,GAAAvC,EAAAlO,KAAA6hC,MAAM+B,GAACnzB,EAAIvC,EAAAwC,EAAAvC,EAAAy1B,EAAA5jC,KAAA6jC,YAAApzB,EAAAC,KAAON,EAAIlC,EAAAmC,EAAAlC,EAAA21B,EAAA9jC,KAAA6jC,YAAAzzB,EAAAC,mBAA6BtJ,EAAI+0B,EAAAyJ,EAAAC,EAAAC,EAAAC,OAAWhpB,EAATooB,EAAIvvB,MAAKowB,KAAA7J,GAElF,IAFoFpf,EAAI1c,KAAKmjC,SAAA2B,EAAA,GAAAA,EAAA,GAAAS,EAAAC,KAAAV,EAAAc,QAAAlpB,EAAA,GAAAA,EAAA,KAACA,EAAA1c,KAAAmjC,SAAA2B,EAAAA,EAAA9iC,OAAA,GAAA8iC,EAAAA,EAAA9iC,OAAA,GAAAyjC,EAAAC,KAAAZ,EAAAtkC,KAAAkc,EAAA,GAAAA,EAAA,IAE9FooB,EAAQ9kC,KAAA6kC,YAAA99B,EAAA+9B,GAAA,IAAA,IAAAlB,EAAA7P,EAAA,EAAAlyB,EAAAijC,EAAA9iC,OAAA8hC,EAAA9jC,KAAAolC,UAAAN,EAAAjjC,EAAA,GAAAijC,EAAAjjC,EAAA,IAAAkyB,EAAAlyB,EAAAkyB,GAAA,EACT6P,EAAAE,EAAAA,EAAA9jC,KAAAolC,UAAAN,EAAA/Q,GAAA+Q,EAAA/Q,EAAA,IACU6P,GAAOE,IAAG/P,EAAG/zB,KAAAqlC,MAAAt+B,EAAA68B,EAAAE,EAAAgB,EAAA/Q,GAAAlyB,EAAAijC,EAAA9iC,aAEfhC,KAAGslC,SAAAv+B,GAAA/G,KAAA6hC,KAAA7hC,KAAA+hC,MAAA,GAAA/hC,KAAA8hC,KAAA9hC,KAAAgiC,MAAA,KAAA8C,EAAA,CACR9kC,KAAA6hC,UACEC,8BACAC,8BACAC,4BACa8C,EAAE/Q,YAAyCgR,GAAA,KACxD72B,EAAAC,iBAA0B,EACtBu2B,EAAO,EAAE,cAA2C,EACpDA,EAAO,EAAAx2B,EAAAlO,KAAA+hC,KAAA5zB,EAAAnO,KAAA8hC,KAAE,WAAa,EACtB4C,EAAO,EAAE,cAA2C,+BAEc,MACf,KAAA,GACjDA,EAAA,EAGT,SACK,KAAM,EAEDA,EAAI,EAACx2B,EAAIlO,KAAM6hC,KAAM1zB,EAAGnO,KAAKgiC,KAC9B,MAGP,KAAA,EAEK0C,EAAA,EACT,SACU,KAAM,EACPA,EAAQ,EAAGx2B,EAAKlO,KAAC6hC,KAAA1zB,EAAAnO,KAAA8hC,KAKnBgD,EAAE/Q,KAAQ7lB,GAAK42B,EAAE/Q,EAAA,KAAW5lB,IAAAnO,KAAAslC,SAAAv+B,EAAAmH,EAAAC,KAAA22B,EAAA5iC,OAAA6xB,EAAA,EAAA7lB,EAAAC,GAAA4lB,GAAA,GAElC,GAAC+Q,EAAA9iC,OAAA,EAAA,IAAA,IAAA6jC,EAAA,EAAAA,EAAAf,EAAA9iC,OAAA6jC,GAAA,EAAA,CACG,MAAM9R,GAAG8R,EAAA,GAAAf,EAAA9iC,OAAAikB,GAAA4f,EAAA,GAAAf,EAAA9iC,QACP8iC,EAAEe,KAASf,EAAA/Q,IAAM+Q,EAAA/Q,KAAW+Q,EAAA7e,IAAA6e,EAAAe,EAAA,KAAAf,EAAA/Q,EAAA,IAAA+Q,EAAA/Q,EAAA,KAAA+Q,EAAA7e,EAAA,MAAA6e,EAAA5iC,OAAA6xB,EAAA,GAAA8R,GAAA,GAElC,OAAO9R,WAELtjB,EAAKC,EAACo1B,EAAIC,GACZ,IAACpkC,EAAAuM,EAAAC,EAAAJ,EAAAic,EAAAA,EACD,GAAA+b,EAAQ,EAAA,CAAA,GAACr1B,GAAA1Q,KAAA8hC,KAAA,OAAA,MAAGngC,GAAA3B,KAAA8hC,KAAApxB,GAAAq1B,GAAAh4B,IAAAI,EAAAnO,KAAA8hC,KAAA5zB,EAAAuC,GAAA1C,EAAApM,GAAAmkC,QAAC,GAAAC,EAAA,EAAA,CACd,GAAAr1B,GAAA1Q,KAAAgiC,KAAA,OAAA,MACYrgC,GAAI3B,KAAAgiC,KAAAtxB,GAAAq1B,GAAAh4B,IAAAI,EAAAnO,KAAAgiC,KAAA9zB,EAAAuC,GAAA1C,EAAApM,GAAAmkC,GAKhB,GAAAA,EAAA,EAAA,CACD,GAAYr1B,GAAMzQ,KAAC+hC,KAAA,OAAA,MACRpgC,GAAG3B,KAAK+hC,KAAatxB,GACpBq1B,GAAK/3B,IAAIG,EAASlO,KAAS+hC,KAC7B5zB,EAAGuC,GAAK3C,EAAOpM,GAChBokC,QACR,GAAAD,EAAA,EAAA,8BAGGnkC,GAAA3B,KAAA6hC,KAAMpxB,GAAIq1B,GAAO/3B,IAAEG,EAAAlO,KAAA6hC,KAAA1zB,EAAAuC,GAAG3C,EAAGpM,GAAQokC,GAGrC,MAAU,CACX73B,EAEQC,GAIgEi3B,UAAAl3B,EAAAC,UAChED,IAAAlO,KAAA6hC,KAAA,EAAA3zB,IAAalO,KAAC+hC,KAAA,EAAA,IAAA5zB,IAAAnO,KAAA8hC,KAAA,EAAA3zB,IAAAnO,KAAAgiC,KAAA,EAAA,GAErB6B,YAAa31B,EAAGC,GACd,OAAOD,EAAIlO,KAAG6hC,KAAU,EAClB3zB,EAAIlO,KAAI+hC,KAAA,EAAW,IACnB5zB,EAAInO,KAAI8hC,KAAA,EAAW3zB,EAAInO,KACvBgiC,KAAS,EAAA,UAIjBgE,GAAW,EAAA/gC,KAAAsJ,GAAA03B,GAAAhhC,KAAA0f,IACb,SAACuhB,GAAAxpB,UAEQA,EAAA,YACEypB,GAAsBzpB,UAAGA,EAAG,YAanC0pB,GAA8Bl4B,EAACC,EAAA/D,SAC/B,CACD8D,EAAAjJ,KAAAkM,IAAAjD,EAAAC,GAAA/D,EACD+D,EAAMlJ,KAAI4L,IAAA3C,EAAAC,GAAA/D,YAIVi8B,YAACvK,EAAAnpB,EAAAuzB,GAAAtzB,EAAAuzB,GAAAG,GACD,OAAS,IAAAC,GAAA,WAAAzK,WAiMyBA,EAAAnpB,EAAAC,EAAA0zB,SAC9BzkC,EAACi6B,EAAA95B,OACJof,EAAA,IAAAgY,aAAA,EAAAv3B,GACF,IAAA,IAAAkF,EAAA,EAAAA,EAAAlF,IAAAkF,EAAA,uEApMUy/B,CAAA1K,EAAAnpB,EAAAC,EAAA0zB,GAAAlN,aAAAuM,iGAAAc,CAAA3K,EAAAnpB,EAAAC,EAAA0zB,iBAGexK,GACtB97B,KAAK0mC,YAAW,IAAK7K,GAAcC,QACjC0G,QAAK,IAASjG,WAAGT,EAAgB95B,OAAC,mBAAQ,IAAMu6B,WAAST,EAAA95B,OAAA,QAAC85B,OAAM97B,KAAM0mC,YAAAvK,qDAGjDld,yCAErBtQ,EAAK3O,KAAK0mC,YAAU5K,EAAO97B,KAAU87B,kBAE7BntB,EAAE2vB,KAAGt8B,OAAQ,YA9BrB2M,SACG+vB,UAAWA,EAAOvC,OAAAA,GAAAxtB,MACvB,IAAA5H,EAAO,EAAIA,EAAA23B,EAAA18B,OAAA+E,GAAA,EAAA,CAGZ,MAAA2H,EAAA,EAAAgwB,EAAA33B,GAAAuD,EAAA,EAAAo0B,EAAA33B,EAAA,GAAApF,EAAA,EAAA+8B,EAAA33B,EAAA,OAAAo1B,EAAAx6B,GAAAw6B,EAAAztB,KAAAytB,EAAA7xB,EAAA,GAAA6xB,EAAAztB,EAAA,KAAAytB,EAAA7xB,GAAA6xB,EAAAztB,KAAAytB,EAAAx6B,EAAA,GAAAw6B,EAAAztB,EAAA,IACW,MAAS,OAAA,SAEnB,EAsBuBi4B,CAAAh4B,GAAA,MACnBi4B,UAAWrK,WAAWoJ,KAAC,CACxB3jC,OAAA85B,EAAA95B,OAAA,IACD,CAAIy/B,EAAC16B,IAAAA,IACNonB,MACC,CAAApnB,EAAOgtB,IAAK+H,EAAA,EAAS/0B,GAAA+0B,EAAA,EAAA/H,IAAA+H,EAAA,EAAA/0B,EAAA,GAAA+0B,EAAA,EAAA/H,EAAA,KAIvB,MAAU7tB,EAAGlG,KAAK4mC,UAAW,GAACh4B,EAAA5O,KAAY4mC,UAAI5mC,KAAA4mC,UAAA5kC,OAAA,GAAA6kC,EAAA,CACxC/K,EAAS,EAAG51B,GACZ41B,EAAO,EAAG51B,EAAK,GACf41B,EAAS,EAAGltB,GAEqDktB,EAAA,EAAAltB,EAAA,IACLxE,EAAA,KAAAnF,KAAA6hC,MAAAD,EAAA,GAAAA,EAAA,GAAAA,EAAA,GAAAA,EAAA,IACb,IAAA,IAAAE,EAAA,EAAAllC,EAAAi6B,EAAA95B,OAAA,EAAA+kC,EAAAllC,IAAAklC,EAAA,CAC5C,MAAKrqB,EAAG0pB,GAA+BtK,EAAG,EAAAiL,GAAAjL,EAAA,EAAAiL,EAAA,GAAA38B,GACjD0xB,EAAU,EAAAiL,GAAWrqB,EAAG,GACpBof,EAAA,EAAWiL,EAAM,GAAErqB,EAAI,GAExB1c,KAAK0mC,YAAU,IAAK7K,GACRC,eAG2B97B,KAAA4mC,UAC5C,MAAIjI,EAAW3+B,KAAK2+B,UAAe3+B,KAAI0mC,YAAG/H,UACxCL,EAAKt+B,KAASs+B,KAAOt+B,KAAA0mC,YAAcpI,KACnCI,EAAc1+B,KAAG0+B,UAAc1+B,KAAI0mC,YAAOhI,UAC1C8D,EAAKxiC,KAAWwiC,QAAS3wB,MAAC,GAC1Bm1B,EAAchnC,KAAKinC,WAACp1B,MAAA,WAIlB3L,EAAI,EAACrE,EAAA88B,EAAe38B,OAAMkE,EAAArE,IAAAqE,EAAA,CAC5B,MAACwW,EAAAgiB,EAAAx4B,EAAA,GAAA,EAAAA,EAAA,EAAAA,EAAA,IACF,IAAAy4B,EAAAz4B,KAAA,IAAAs8B,EAAA9lB,KAAA8lB,EAAA9lB,GAAAxW,GAEH,IAAQ,IAAAa,EAAQ,EAAC8sB,EAAAyK,EAAAt8B,OAAA+E,EAAA8sB,IAAA9sB,EAAAigC,EAAA1I,EAAAv3B,IAAAA,EAEhBu3B,EAAAt8B,QAAA,GAAAs8B,EAAAt8B,OAAA,IACAhC,KAAW0+B,UAAG,IAAAnC,WAAA,GAAA1qB,MAAA,GACb7R,KAAO2+B,UAAA,IAAOpC,WAAE,GAAI1qB,MAAA,GAE4B7R,KAAA0+B,UAAA,GAAAJ,EAAA,GAC5CkE,EAAAlE,EAAY,IAAA,EACM,IAApBA,EAAOt8B,SACHwgC,EAAKlE,EAAQ,IAAA,EACbt+B,KAAI0+B,UAAU,GAAMJ,EAAI,GAC5Bt+B,KAAM0+B,UAAA,GAAAJ,EAAA,aAKJuI,UACA,IAAAnF,GAAA1hC,KAAA6mC,cAED9/B,SACGy7B,QAASA,EAASlE,KAAEA,EAA4B2I,WAAAA,EAAAtI,UAAAA,EAAAD,UAAAA,EAAAkI,UAAAA,GAAA5mC,QAEpD4mC,EAAU,OACRpR,EAAMoR,EAAU18B,QAAAnD,GAGlB,OAFEyuB,EAAI,UAAQoR,EAASpR,EAAA,SACrBA,EAAAoR,EAAM5kC,OAAA,UAAA4kC,EAAApR,EAAA,KAGX,MAAAkP,EAAAlC,EAAAz7B,GACG,IAAY,IAAR29B,EAAW,OACjB,IAAEx+B,EAAIw+B,EAAKje,GAAG,EACd,EAAA,CAGA,SAFKA,EAAAiY,EAAAx4B,KACIA,EAAG,GAAK,EAAMA,EAAI,EAAGA,EAAA,EACtBw4B,EAAAx4B,KAAAa,EAAA,OAEH,GADNb,EAAAy4B,EAAAz4B,IACe,IAAJA,EAAI,CACP,MAAAwW,EAAA4hB,GAAO2I,EAAElgC,GAAI,GAAAu3B,EAAAt8B,QAEZ,YADI0a,IAAC+J,UAAa/J,WAGlBxW,IAAGw+B,UAEPv2B,EAAApH,EAAA,OACFmH,GAAKA,IAAGA,IAAWC,GAAAA,IAAAA,EAAA,OAAA,QACnBqvB,EAAMz2B,MACNpF,QACCA,EAAI3B,KAAIgkC,MAASj9B,EAACmH,EAAIC,KAAQ,GAAAxM,IAAAoF,GAAApF,IAAA67B,GAAAz2B,EAAApF,SAC7BA,UAEFuM,EAAIC,SACFq0B,QAAQA,EAAElE,KAAYA,EAAS2I,WAAWA,EAAAtI,UAAAA,EAAAD,UAAAA,EAAA5C,OAAAA,GAAA97B,SAC/B,MAAP+G,KAAU+0B,EAAA95B,OAAA,OAAA+E,EAAA,IAAA+0B,EAAA95B,QAAA,aAEbikC,GAAA/3B,EAAA4tB,EAAA,EAAA/0B,GAAA,GAAAk/B,GAAA93B,EAAA2tB,EAAA,EAAA/0B,EAAA,GAAA,WACDy7B,EAAKz7B,OACPb,EAACw+B,EACH,EAAC,CACD,IAAQ32B,EAAA2wB,EAAAx4B,GACT,MAAAghC,EAAAjB,GAAA/3B,EAAA4tB,EAAA,EAAA/tB,GAAA,GAAAk4B,GAAA93B,EAAA2tB,EAAA,EAAA/tB,EAAA,GAAA,GAGC,GAFKm5B,EAAUC,IAAAA,EAAAD,EAAAvlC,EAAAoM,GACf7H,EAAMA,EAAM,GAAG,EAAOA,EAAI,EAAIA,EAAG,EAC1Bw4B,EAAAx4B,KAAMa,EAAA,MAEX,GADGb,EAAIy4B,EAAQz4B,IACL,IAAVA,EAAU,CAEV,GADIA,EAAIo4B,GAAG2I,EAAQlgC,GAAA,GAAAu3B,EAAAt8B,QACXkE,IAAG6H,GACAk4B,GAAgB/3B,EAAA4tB,EAAA,EAAA51B,GAAA,GAAA+/B,GAAA93B,EAAA2tB,EAAA,EAAA51B,EAAA,GAAA,GAAAihC,EAAA,OAAAjhC,EAE3B,aAEGA,IAAAw+B,GACL,OAAO/iC,EAET4c,OAAAna,GACE,MAAKm+B,EAAoB,MAAfn+B,EAAsBA,EAAW,IAAAg9B,QAAiCv2B,GACvEixB,OAAIA,EAAa6C,UAAKA,EAAAD,UAAAA,GAAA1+B,KAC3B,IAAA,IAAM+G,EAAM,EAAGlF,EAAA88B,EAAW38B,OAAO+E,EAAOlF,IAAMkF,EAAC,CAC/C,MAAOgtB,EAAA4K,EAAM53B,GACR,GAAIgtB,EAAIhtB,EAAG,SACd,MAAM07B,EAAmB,EAAf/D,EAAW33B,GACrB27B,EAAuB,EAAfhE,EAAY3K,GACpB3vB,EAAQgL,OAAO0sB,EAAO2G,GAAE3G,EAAA2G,EAAA,IACzBr+B,EAAAkL,OAAAwsB,EAAA4G,GAAA5G,EAAA4G,EAAA,IAGH,OADC1iC,KAAAonC,WAAAhjC,GACUm+B,GAAUA,EAAAliC,qBAEZ+D,EAAIgG,QACDS,IAAVT,GAAwBhG,GAAc,mBAAAA,EAAAgL,SAAAhF,EAAAhG,EAAAA,EAAA,MACtCgG,EAAQS,MAART,EAAqB,GAAKA,EAC1B,MAAKm4B,EAAuB,MAAZn+B,EAAaA,EAAA,IAAAg9B,QAAAv2B,GAC3BixB,OAAWA,GAAS97B,SACpB,IAAA+G,EAAQ,EAAAlF,EAAOi6B,EAAO95B,OAAI+E,EAAQlF,EAAGkF,GAAC,EAAA,CACvC,MAAAmH,EAAA4tB,EAAA/0B,GAAAoH,EAAA2tB,EAAA/0B,EAAA,GACD3C,EAAQgL,OAASlB,EAAA9D,EAAA+D,GACjB/J,EAAOuN,IAAMzD,EAAIC,EAAA/D,EAAO,EAAA47B,IAE1B,OAAWzD,GAAIA,EAAAliC,mBAER+D,GACL,MAAMm+B,EAAc,MAALn+B,EAAKA,EAAA,IAAAg9B,QAAAv2B,GACrByzB,KAAAA,EAAAxC,OAAAA,GAAA97B,KACD+C,EAAkB,EAAJu7B,EAAI,GAASz8B,EAACy8B,EAAAt8B,OAC1BoC,EAAMgL,OAAS0sB,EAAO/4B,GAAI+4B,EAAO/4B,EAAA,IACjC,IAAA,IAAOgE,EAAA,EAAAA,EAAAlF,IAAMkF,EAAA,CACb,MAAQhE,EAAG,EAAAu7B,EAAWv3B,GACtB3C,EAAWkL,OAAAwsB,EAAe/4B,GAAI+4B,EAAC/4B,EAAA,IAG/B,OADAqB,EAAQiL,YACDkzB,GAAQA,EAASliC,sBAGxB,MAAM+3B,EAAO,IAAIqL,GAElB,OADAzjC,KAAAonC,WAAAhP,GACAA,EAAgB/3B,uBAEL0G,EAAI3C,GAGf,MAAAm+B,EAAA,MAAAn+B,EAAAA,EAAA,IAAAg9B,QAAAv2B,GACDixB,OAAoBA,EAAA4C,UAAAA,GAAA1+B,KACZm0B,EAAc,EAAduK,EAAc33B,GAAA,GACfstB,EAAyB,EAAzBqK,EAAgB33B,EAAE,GACjBkgB,EAAc,EAAbyX,EAAa33B,EAAA,GAMtB,OALC3C,EAAAgL,OAAA0sB,EAAA3H,GAAA2H,EAAA3H,EAAA,4BAGM7kB,OAAAwsB,EAAA7U,GAAA6U,EAAU7U,EAAM,IACvB7iB,EAAUiL,YACCkzB,GAAOA,EAAAliC,4BAGhB,MAAOq+B,UAAWA,GAAe1+B,KACjC,IAAA,IAAO+G,EAAI,EAAIlF,EAAI68B,EAAQ18B,OAAU,EAAE+E,EAAMlF,IAAAkF,QAAA/G,KAAAqnC,gBAAAtgC,GAE/CsgC,gBAAYtgC,GACb,MAAAqxB,EAAA,IAAAqL,GAGK,YADI6D,eAAAvgC,EAAAqxB,GACCA,EAAA/3B,qBCt0C0ByC,EAAGC,EAAGlB,EAAG0lC,GAC1C,IAEIC,EACAC,EAHAC,WAcc5kC,EAAGC,EAAGlB,GACxB,OAAO0T,MAAM1T,GAAGgQ,OAAOwK,KAAG,IAAO,CAACpX,KAAKwC,SAAW3E,EAAGmC,KAAKwC,SAAW1E,KAfrD4kC,CAAa7kC,EAAGC,EAAGlB,GAC/B+lC,GAAY,EAGhB,MAAMC,EAAMN,EAActiC,KAAKkqB,IAAIrsB,EAAGC,GACtC,IAAK,IAAIgE,EAAI,EAAGA,EAAI,IAAMA,IAEtB,IADC2gC,EAAWE,EAAWJ,EAASC,GAAYK,GAAMJ,EAAW5kC,EAAGC,EAAG8kC,GAC/DD,EAAW,OAAOF,EAE1B,MAAO,CAACA,EAAWF,EAASC,YASvBK,GAAMhM,EAAQh5B,EAAGC,EAAG8kC,GACzB,MACML,EADWjB,GAASZ,KAAK7J,GACN0L,QAAQ,CAAC,EAAG,EAAG1kC,EAAGC,IACrC0kC,GAuBK5lC,EAvBYi6B,EAAO95B,OAwBvB,IAAIuT,MAAM1T,GAAGmF,SAxBkBqV,KAAKtV,GAAMygC,EAAQjE,YAAYx8B,SAuB1DlF,EAtBX,MAAM6lC,EAAYD,EAASprB,IAAIgc,IACzBuP,EAAY9L,EAAOiM,OAAK,CAAEC,EAAOjhC,KAAMkhC,OAiB9B/5B,EAjBwC85B,EAiBrC75B,EAjB4Cu5B,EAAU3gC,GAkBjEmH,GAAK,EAAIC,GAAK,EAlByD05B,MAiB/D35B,EAAGC,KAhBlB,MAAO,CAACu5B,EAAWE,EAAWJ,EAASC,eChCP9yB,EAAMuzB,GACtC,MAAMC,EAASC,GAAcF,GACvBrmC,EAAI8S,EAAK3S,OAASomC,GAAczzB,GAChC0zB,EAAUH,EAAS1yB,QACzB,IAAK,IAA4BlL,EAAG3I,EAAGgN,EAA9B5H,EAAI,EAAG2H,EAAIiG,EAAK9S,EAAI,GAAakF,EAAIlF,IAAKkF,EAAG,CAClD,MAAMuhC,EAAQD,EAAQ7yB,QAChB0Q,EAAIoiB,EAAMtmC,OAASmmC,EACzBE,EAAQrmC,OAAS,EACjBsI,EAAIqK,EAAK5N,GACTpF,EAAI2mC,EAAMpiB,EAAI,GACd,IAAK,IAAI6N,EAAI,EAAGA,EAAI7N,IAAK6N,EACrBplB,EAAI25B,EAAMvU,GACNwU,GAAW55B,EAAGD,EAAGpE,IACZi+B,GAAW5mC,EAAG+M,EAAGpE,IAClB+9B,EAAQ7nC,KAAKgoC,GAAc7mC,EAAGgN,EAAGD,EAAGpE,IAExC+9B,EAAQ7nC,KAAKmO,IACN45B,GAAW5mC,EAAG+M,EAAGpE,IACxB+9B,EAAQ7nC,KAAKgoC,GAAc7mC,EAAGgN,EAAGD,EAAGpE,IAExC3I,EAAIgN,EAEJw5B,GAAQE,EAAQ7nC,KAAK6nC,EAAQ,IACjC35B,EAAIpE,EAER,OAAO+9B,EAAQrmC,OAASqmC,EAAU,cAE7BE,IAAY9H,EAAIC,IAAM/G,EAAIC,IAAMC,EAAIC,IACzC,OAAQD,EAAKF,IAAO+G,EAAK9G,IAAOE,EAAKF,IAAO6G,EAAK9G,YAE5C6O,IAAe7O,EAAIC,IAAMC,EAAIC,IAAMtrB,EAAIkE,IAAMqC,EAAIC,IACtD,MAAMyzB,EAAM5O,EAAKF,EAAU+O,EAAM5O,EAAKF,EAAU+O,EAAM5zB,EAAKvG,EACvDo6B,EAAM5zB,EAAKtC,EACTuT,GAAKwiB,GAAO/1B,EAAKknB,GAAM8O,GAAOl6B,EAAKmrB,KAAQ+O,EAAMC,EAAMF,EAAMG,GACnE,MAAO,CAACp6B,EAAKyX,EAAI0iB,EAAKj2B,EAAKuT,EAAI2iB,YAE1BR,GAActM,GACnB,MAAOnC,EAAIC,GAAMkC,EAAO,IACnBjC,EAAIC,GAAMgC,EAAOA,EAAO95B,OAAS,GACtC,OAAO23B,IAAOE,GAAMD,IAAOE,WCHtB+O,GAAW36B,EAAGC,GAanB,MANgB,CACZ,CAACD,EAAGC,GACJ,CAACD,EAAGC,EAAI,GACR,CAACD,EAAI,EAAGC,EAAI,GACZ,CAACD,EAAI,EAAGC,gBC3CsB0H,GAClC,MAAMtU,EAAOvB,qHAaTuB,EAAKunC,KAAA,CAAAhS,EAAYC,EAAGxG,sDACpBhvB,EAAKu1B,GAAAA,EAELv1B,EAAKw1B,GAAAA,EACRx1B,EAAAgvB,GAAAA,EAMEhvB,EAAAwnC,aAAAxnC,EAAAkmC,SAAAprB,IAAA8b,IAAA9b,KAAAnO,IAAAA,IAGF3M,EAAAynC,UAAAlS,EAAAC,EAEGx1B,EAAC0nC,gBDxByBC,GAC9B,MAAO3Y,GACHA,EAAEuG,GAAEA,EAAEC,GAAEA,EAAE0Q,SAAEA,GACZyB,EAEED,EAAS1zB,MAAMgb,GAAI1e,OAAOwK,KAAG,IAAO,KAE1C,IAAK,IAAI8sB,EAAK,EAAGA,EAAKrS,EAAIqS,IACtB,IAAK,IAAIC,EAAK,EAAGA,EAAKrS,EAAIqS,IAAM,CAC5B,MAAMf,EAAUQ,GAAWM,EAAIC,GAC/Bvb,GAAM0C,GAAI3vB,SAASyoC,IACf,MAEMC,EAAUC,GADHzb,GADA2Z,EAAS4B,IACGxf,UACSwe,GAIlB,OAAZiB,GACAL,EAAOI,GAAW7oC,KAAK,CAAC2oC,EAAIC,EAAIjR,GAAYmR,QAM5D,OAAOL,ECAFO,CAA0CjoC,IAiB3CA,EAAKkoC,cAAI,CAAAC,EAAAC,KACTpoC,EAAKqoC,qBAAqB,EAAG,EAAEF,EAAAC,EAAA,KAAAE,MAE/BC,oBAAmB,CAAA57B,EAAAC,EAAAu7B,EAAAC,EAAAI,KACnBxoC,EAAKqoC,qBAAoB17B,EAAAC,EAAAu7B,EAAAC,EAAAI,OAAAl/B,MAUrB++B,qBAAW,CAAA17B,EAAAC,EAAAu7B,EAAAC,EAAAI,EAAAC,WACPnmC,KAAAA,GAAYgS,+BACpBhS,EAAC2J,OACD,MAAKy8B,EAAOP,EAAA5S,EACfoT,EAAAP,EAAA5S,IAEQtoB,UAAAP,EAAAC,GACLtK,EAAKuB,MAAE6kC,EAAKC,GACZ,IAAA,IAAOnjC,EAAG,EAAKA,EAAAwpB,EAAAxpB,IACflD,EAAMgL,YACiEhL,EAAA6E,YAAA,OACvE7E,EAAMqF,UAAY,EAAA+gC,EAClBzC,EAAA9D,WAAA38B,EAAAlD,GACH,OAAAkmC,IACJlmC,EAAAiF,UAAAihC,EAAAhjC,kEC1EoC8O,EAAQuI,EAAK5c,GAC9C,MAAMD,EAAOvB,KAKbmqC,GAAa10B,KAAKlU,EAAM6c,GAGxB7c,EAAKgvB,GAAK,GAGVhvB,EAAKu1B,GAAK,GACVv1B,EAAKw1B,GAAK,GAGVx1B,EAAK2nC,cAAgB,IAAIkB,GAAcv0B,GAGvCtU,EAAK8oC,SAAW,IAAIC,GAAS/oC,EAAKu1B,GAAIv1B,EAAKw1B,IAC3Cx1B,EAAK8oC,SAASpT,aAYVhY,OAAI,KAAezd,EAAWO,cAAEP,EAAKI,MAAA,CAAE,YAAO,MAC1C,MAEA,oCACPL,EAAA4rB,qBAQGod,EAAK,GACRhpC,EAAAipC,gBAAA,KACGjpC,EAAC2nC,cAAYJ,KAAUvnC,EAAAu1B,GAAAv1B,EAAAw1B,GAAAx1B,EAAAgvB,OAEvBpD,aAAK,KACLod,EAAKhpC,EAAA2rB,eACL3rB,EAAKkpC,gBACRlpC,EAAAmpC,yBAEqEnpC,EAAAopC,yBAKlEF,cAAK,cAIWzT,GAAOz1B,EAAM8oC,0BACPE,EAASluB,KAAAuuB,GAAA5T,EAAA3a,KAAAwuB,GAAAA,EAAAxuB,KAAAyuB,IACf,MAAMC,EAASC,GAAAF,EACTvuB,EAAMkT,GAAMmb,EAAA3d,WAAA1Q,QACZsB,EAAM4R,GAAMmb,EAAA3d,WAAApP,eAClBtB,EAAOrO,GAAK68B,EACZltB,EAAO3P,GAAC68B,OAACC,GAAgBntB,OAAAA,EAE3BtB,OAAAA,MAER0uB,SACTA,SAEIA,UAEDP,uBAAoB,KACpB,MAAKzB,OAAAA,GAAqB1nC,EAAG2nC,kBAGjBlS,GAAOz1B,EAAM8oC,iCACExc,GAAmBtsB,EAAAgvB,IAAAlU,KAAAgtB,GAAAkB,EAAAluB,KAAAuuB,GAAA3B,EAAAI,GAAAhtB,KAAAhS,IAClC,MAAM8+B,EAAAC,EAAS8B,GAAA7gC,GACT0gC,EAASC,GAAAhU,EAAAmS,GAAAC,GACT7sB,EAAMkT,GAAMmb,EAAA3d,WAAA1Q,QACZsB,EAAM4R,GAAMmb,EAAA3d,WAAApP,eAClBtB,EAAOrO,GAAK68B,EACZltB,EAAO3P,GAAC68B,OAACC,GAAgBntB,OAAQA,EAAItB,OAAAA,EAClCpJ,OAAA+3B,eAGlBD,YAIGN,oBAAuB,cAIP3T,GAAOz1B,EAAM8oC,8BACDrT,EAAG3a,KAAAwuB,GAAAA,EAAAxuB,KAAAyuB,GAAAP,EAAAluB,KAAkBuuB,IACjC,MAAMG,EAASC,GAAAF,EACTvuB,EAAMkT,GAAMmb,EAAA3d,WAAA1Q,QACZsB,EAAM4R,GAAMmb,EAAA3d,WAAApP,eAClBtB,EAAOrO,GAAK68B,EACZltB,EAAO3P,GAAC68B,OAACC,GAAgBntB,OAAAA,EAE3BtB,OAAAA,8BClHgB0Q,EAAYpX,GAC9C,MAAMtU,EAAOvB,KAEbuB,EAAKgd,OAAS,WACV,MAAOhb,IAACA,GAAQsS,GACT3H,EAACA,EAACqO,OAAEA,GAAW0Q,GACfnqB,EAACA,EAACqa,eAAEA,GAAmBZ,EACxBxZ,EAAI,IAGVQ,EAAIiK,OAEJjK,EAAIsL,YAMuB,aAAnBsO,aAQJ,MAAMguB,EAAQroC,EAAImC,KAAKiL,KAAK,EAAIjL,KAAKsJ,IAC/B68B,EAAMroC,EACNiF,EAASC,IAEf1E,EAAI6L,OAAO,EAAGpH,GACd,MAAMqjC,EAAK,GACX,IAAK,IAAItkC,EAAI,EAAGA,GAAK8O,EAAO5S,MAAO8D,GAAK,EAAG,CACvC,MAAM04B,EAAK,KAAQ14B,EAAImH,GAAKi9B,IAAU,EAChCh9B,EAAInG,EAASojC,EAAMnmC,KAAKspB,KAAKkR,GACnC4L,EAAG7qC,KAAK2N,GACR5K,EAAI+L,OAAOvI,EAAGoH,GAGlB5K,EAAI+L,OAAOuG,EAAO5S,MAAO+E,GACzBzE,EAAI+L,OAAO,EAAGtH,GArBVsjC,GAyBJ/nC,EAAIuO,KAAK5D,EAAQ,GAAJpL,EAASmF,IAAkBnF,EAAGC,GA9B/CQ,EAAIqO,SAEJrO,EAAIoK,WAgCRpM,EAAKgqC,SAAQ,KAAWhqC,EAAKgd,sBChDK0O,EAAYpX,GAC9C,MAAMtU,EAAOvB,KAEbuB,EAAKgd,OAAS,WACV,MAAOhb,IAACA,GAAQsS,GACT3H,EAACA,EAACC,EAAEA,EAAC0P,OAAEA,GAAWoP,EAEzB1pB,EAAIsL,YAEJtL,EAAIoO,IAAIzD,EAAGC,EAAc,GAAX0P,EAAO/a,EAAS,EAAG,EAAImC,KAAKsJ,IAE1ChL,EAAIqO,UAERrQ,EAAKgqC,SAAW,SAAUC,EAAMC,GAC5B,MAAOloC,IAACA,GAAQsS,GACT/S,EAACA,GAAMmqB,EAAWpP,OAEzBta,EAAIsL,YAEJtL,EAAIoO,IAAI65B,EAAMC,EAAU,GAAJ3oC,EAAS,EAAG,EAAImC,KAAKsJ,IAEzChL,EAAIqO,UAERrQ,EAAKmqC,gBAAkB,SAAUF,EAAMC,GACnC,MAAOloC,IAACA,GAAQsS,EAEhBtS,EAAIsL,YACJtL,EAAIuF,UAAY,OAChBvF,EAAIoO,IAAI65B,EAAMC,EAAM,EAAG,EAAG,EAAIxmC,KAAKsJ,IACnChL,EAAIsO,oBCvB+B85B,EAAcC,EAAoB/1B,EAAQrU,EAAS4c,GAC1F,MAQOnb,MAACA,GAAU4S,EACZg2B,EAAMt2B,MAAMtS,GAAO4O,KAAK,GAC9B,IAAIi6B,EAAQ,EAEZ,MAAO1sB,WAACA,GAAehB,EAAIiB,SAGrB0sB,EAAgC,IAAf3sB,EAAoB4sB,GAAgBC,GAC3DN,EAAahtB,aAAasO,GAAe,IAAI8e,EAAc9e,EAAYpX,KACvE+1B,EAAmBjtB,aAAasO,GAAe,IAAI8e,EAAc9e,EAAYpX,KAjBhE7V,KAmBRif,OAAS,SAAUitB,IACQ,IAAxB1qC,EAAQO,cAYZ8pC,EAAIh6B,KAAK,GACTi6B,EAAQ,GATR,MAAOK,cAACA,EAAaC,UAAEA,GAAcF,EAEjCC,YAWcC,GAElB,MAAMC,EAAKD,EAAUpqC,OACrB,IAAK,IAAIikB,EAAI,EAAGA,EAAIomB,EAAIpmB,IAAK,CACzB,MAAO/X,EAACA,GAAMk+B,EAAUnmB,GACxB,IAAK,IAAIlf,EAAI,EAAGA,EAAI9D,EAAO8D,IACvB8kC,EAAI9kC,IAAMulC,EAAOvlC,EAAImH,GAEzB49B,GAASS,GAlBTC,CAAaJ,IASrB,MAAMG,EAAa,EAAI,WAadD,EAAOp+B,GACZ,OAAIA,EA/CG,IA+COA,GA/CP,GA+CuB,GACtB,GAAKA,EAhDN,KAgDiB,GAhDjB,GAHElO,KAsDRue,OAAM,iBASP,MAAOhb,IAACA,GAAQsS,EAChBtS,EAAIiK,OAEJjK,EAAIsL,qBAYQtL,GACZ,MAAMkpC,EAAO,EAAIX,EAEXV,EAAMroC,IACNiF,EAASC,IAEf1E,EAAI6L,OAAO,EAAGpH,GACd,MAAMqjC,EAAK,GACX,IAAK,IAAItkC,EAAI,EAAGA,GAAK9D,EAAO8D,GAAK,EAAG,CAChC,MAAMoH,EAAInG,EAASojC,EAAMS,EAAI9kC,GAAK0lC,EAClCpB,EAAG7qC,KAAK2N,GACR5K,EAAI+L,OAAOvI,EAAGoH,GAGlB5K,EAAI+L,OAAOuG,EAAO5S,MAAO+E,GACzBzE,EAAI+L,OAAO,EAAGtH,GA1Bd0kC,CAAOnpC,GACPA,EAAImF,YAAc,OAClBnF,EAAIqO,SACJrO,EAAIuF,UAAY,OAChBvF,EAAIsO,OAEJtO,EAAIoK,UAjBJg/B,GAEAhB,EAAaptB,SACbqtB,EAAmBrtB,mBCxElBquB,GAAMxqC,EAAO4H,EAAM6iC,GAC1BzqC,GAASA,EAAO4H,GAAQA,EAAM6iC,GAAQhrC,EAAI8I,UAAU3I,QAAU,GAAKgI,EAAO5H,EAAOA,EAAQ,EAAG,GAAKP,EAAI,EAAI,GAAKgrC,MAE9G,IAAI9lC,GAAI,EACJlF,EAAoD,EAAhDoD,KAAK+S,IAAI,EAAG/S,KAAKw3B,MAAMzyB,EAAO5H,GAASyqC,IAC3CD,EAAQ,IAAIr3B,MAAM1T,KAEbkF,EAAIlF,GACX+qC,EAAM7lC,GAAK3E,EAAQ2E,EAAI8lC,EAGzB,OAAOD,ECwCT,IAAIE,GAAM7nC,KAAKiL,KAAK,IAChB68B,GAAK9nC,KAAKiL,KAAK,IACf88B,GAAK/nC,KAAKiL,KAAK,YAEV+8B,GAAM7qC,EAAO4H,EAAMkjC,GAC1B,IAAIrjB,EAEAhoB,EACAsrC,EACAN,EAHA9lC,GAAI,EAMR,GAD8BmmC,GAASA,GAAzB9qC,GAASA,MAAvB4H,GAAQA,IACckjC,EAAQ,EAAG,MAAO,CAAC9qC,GAEzC,IADIynB,EAAU7f,EAAO5H,KAAOP,EAAIO,EAAOA,EAAQ4H,EAAMA,EAAOnI,GACT,KAA9CgrC,WAsBgBzqC,EAAO4H,EAAMkjC,GAClC,IAAIL,GAAQ7iC,EAAO5H,GAAS6C,KAAK+S,IAAI,EAAGk1B,GACpCE,EAAQnoC,KAAKuC,MAAMvC,KAAK0Y,IAAIkvB,GAAQ5nC,KAAKooC,MACzCn+B,EAAQ29B,EAAO5nC,KAAK0f,IAAI,GAAIyoB,GAChC,OAAOA,GAAS,GACTl+B,GAAS49B,GAAM,GAAK59B,GAAS69B,GAAK,EAAI79B,GAAS89B,GAAK,EAAI,GAAK/nC,KAAK0f,IAAI,GAAIyoB,IAC1EnoC,KAAK0f,IAAI,IAAKyoB,IAAUl+B,GAAS49B,GAAM,GAAK59B,GAAS69B,GAAK,EAAI79B,GAAS89B,GAAK,EAAI,GA5B3EM,CAAclrC,EAAO4H,EAAMkjC,MAAkBK,SAASV,GAAO,MAAO,GAEhF,GAAIA,EAAO,EAAG,CACZ,IAAIr6B,EAAKvN,KAAKC,MAAM9C,EAAQyqC,GAAOp6B,EAAKxN,KAAKC,MAAM8E,EAAO6iC,OACtDr6B,EAAKq6B,EAAOzqC,KAASoQ,EACrBC,EAAKo6B,EAAO7iC,KAAQyI,EACxB06B,EAAQ,IAAI53B,MAAM1T,EAAI4Q,EAAKD,EAAK,KACvBzL,EAAIlF,GAAGsrC,EAAMpmC,IAAMyL,EAAKzL,GAAK8lC,MACjC,CACLA,GAAQA,EACR,IAAIr6B,EAAKvN,KAAKC,MAAM9C,EAAQyqC,GAAOp6B,EAAKxN,KAAKC,MAAM8E,EAAO6iC,OACtDr6B,EAAKq6B,EAAOzqC,KAASoQ,EACrBC,EAAKo6B,EAAO7iC,KAAQyI,EACxB06B,EAAQ,IAAI53B,MAAM1T,EAAI4Q,EAAKD,EAAK,KACvBzL,EAAIlF,GAAGsrC,EAAMpmC,IAAMyL,EAAKzL,GAAK8lC,EAKxC,OAFIhjB,GAASsjB,EAAMtjB,UAEZsjB,WAYAK,GAASprC,EAAO4H,EAAMkjC,GAC7B,IAAIO,EAAQxoC,KAAK+L,IAAIhH,EAAO5H,GAAS6C,KAAK+S,IAAI,EAAGk1B,GAC7CQ,EAAQzoC,KAAK0f,IAAI,GAAI1f,KAAKuC,MAAMvC,KAAK0Y,IAAI8vB,GAASxoC,KAAKooC,OACvDn+B,EAAQu+B,EAAQC,EAIpB,OAHIx+B,GAAS49B,GAAKY,GAAS,GAClBx+B,GAAS69B,GAAIW,GAAS,EACtBx+B,GAAS89B,KAAIU,GAAS,GACxB1jC,EAAO5H,GAASsrC,EAAQA,WAGxBC,GAAiBC,GACxB,OAAO3oC,KAAKw3B,KAAKx3B,KAAK0Y,aAzGTiwB,EAAQC,GACrB,IAAIX,EAAQ,EACZ,QAAgBriC,IAAZgjC,EACF,IAAK,IAAIxtC,KAASutC,EACH,MAATvtC,IAAkBA,GAASA,IAAUA,KACrC6sC,MAGD,CACL,IAAI1J,GAAQ,EACZ,IAAK,IAAInjC,KAASutC,EACiC,OAA5CvtC,EAAQwtC,EAAQxtC,IAASmjC,EAAOoK,MAAqBvtC,GAASA,IAAUA,KACzE6sC,EAIR,OAAOA,EAyFmBY,CAAMF,IAAW3oC,KAAK8oC,KAAO,EAwBzD,IAEIC,GAFQz4B,MAAM5L,UAEA6L,eAETy4B,GAAUv/B,EAAGpE,GACpB,OAAOoE,EAAIpE,EASb,IAAI4jC,GAAWhgC,GAAC,IAAUA,WAEjBigC,GAASC,EAAMC,OACtB,IAA6B1sC,EAAzBoF,GAAI,EAAIlF,EAAIwsC,EAAKrsC,SACZ+E,EAAIlF,MAAOF,EAAI2sC,GAAaF,EAAMC,EAAKtnC,IAAK,OAAOpF,EAC5D,OAAO,WAGA2sC,GAAaF,EAAMpG,GAE1B,IADA,IAAI95B,EAAI85B,EAAM,GAAI75B,EAAI65B,EAAM,GAAI1C,GAAW,EAClCv+B,EAAI,EAAGlF,EAAIusC,EAAKpsC,OAAQ+xB,EAAIlyB,EAAI,EAAGkF,EAAIlF,EAAGkyB,EAAIhtB,IAAK,CAC1D,IAAIwnC,EAAKH,EAAKrnC,GAAI47B,EAAK4L,EAAG,GAAI3L,EAAK2L,EAAG,GAAIC,EAAKJ,EAAKra,GAAI8O,EAAK2L,EAAG,GAAI1L,EAAK0L,EAAG,GAC5E,GAAIC,GAAgBF,EAAIC,EAAIxG,GAAQ,OAAO,EACrCpF,EAAKz0B,GAAQ20B,EAAK30B,GAASD,GAAK20B,EAAKF,IAAOx0B,EAAIy0B,IAAOE,EAAKF,GAAMD,IAAM2C,GAAYA,GAE5F,OAAOA,WAGAmJ,GAAgB//B,EAAGpE,EAAG3I,GAC7B,IAAIoF,EAOU2V,EAAGijB,EAAGv1B,EAPb,gBAGUsE,EAAGpE,EAAG3I,GACvB,OAAQ2I,EAAE,GAAKoE,EAAE,KAAO/M,EAAE,GAAK+M,EAAE,MAAS/M,EAAE,GAAK+M,EAAE,KAAOpE,EAAE,GAAKoE,EAAE,IAJrDggC,CAAUhgC,EAAGpE,EAAG3I,KAOhB+a,EAP6BhO,EAAE3H,IAAM2H,EAAE,KAAOpE,EAAE,KAO7Cq1B,EAPmDh+B,EAAEoF,GAOlDqD,EAPsDE,EAAEvD,GAQrE2V,GAAKijB,GAAKA,GAAKv1B,GAAKA,GAAKu1B,GAAKA,GAAKjjB,YAGnCiyB,MAET,IAAIC,GAAQ,CACV,GACA,CAAC,CAAC,CAAC,EAAK,KAAM,CAAC,GAAK,KACpB,CAAC,CAAC,CAAC,IAAK,GAAM,CAAC,EAAK,OACpB,CAAC,CAAC,CAAC,IAAK,GAAM,CAAC,GAAK,KACpB,CAAC,CAAC,CAAC,EAAK,IAAM,CAAC,IAAK,KACpB,CAAC,CAAC,CAAC,EAAK,KAAM,CAAC,GAAK,IAAO,CAAC,CAAC,EAAK,IAAM,CAAC,IAAK,KAC9C,CAAC,CAAC,CAAC,EAAK,IAAM,CAAC,EAAK,OACpB,CAAC,CAAC,CAAC,EAAK,IAAM,CAAC,GAAK,KACpB,CAAC,CAAC,CAAC,GAAK,GAAM,CAAC,EAAK,MACpB,CAAC,CAAC,CAAC,EAAK,KAAM,CAAC,EAAK,MACpB,CAAC,CAAC,CAAC,GAAK,GAAM,CAAC,EAAK,KAAO,CAAC,CAAC,IAAK,GAAM,CAAC,EAAK,OAC9C,CAAC,CAAC,CAAC,IAAK,GAAM,CAAC,EAAK,MACpB,CAAC,CAAC,CAAC,GAAK,GAAM,CAAC,IAAK,KACpB,CAAC,CAAC,CAAC,EAAK,KAAM,CAAC,IAAK,KACpB,CAAC,CAAC,CAAC,GAAK,GAAM,CAAC,EAAK,OACpB,aAGOC,KACP,IAAI95B,EAAK,EACLC,EAAK,EACL85B,EAAYnB,GACZoB,EAASC,WAEJH,EAASjB,GAChB,IAAIqB,EAAKH,EAAUlB,GAGnB,GAAKr4B,MAAMiU,QAAQylB,GAIjBA,EAAKA,EAAGz5B,QAAQ2Y,KAAK8f,QAJC,CACtB,MAAM/nC,WA1LI0nC,EAAQC,GACtB,IAAI1e,EACAnX,EACJ,QAAgBnN,IAAZgjC,EACF,IAAK,MAAMxtC,KAASutC,EACL,MAATvtC,SACUwK,IAARskB,EACE9uB,GAASA,IAAO8uB,EAAMnX,EAAM3X,IAE5B8uB,EAAM9uB,IAAO8uB,EAAM9uB,GACnB2X,EAAM3X,IAAO2X,EAAM3X,SAIxB,CACL,IAAImjC,GAAQ,EACZ,IAAK,IAAInjC,KAASutC,EACiC,OAA5CvtC,EAAQwtC,EAAQxtC,IAASmjC,EAAOoK,WACvB/iC,IAARskB,EACE9uB,GAASA,IAAO8uB,EAAMnX,EAAM3X,IAE5B8uB,EAAM9uB,IAAO8uB,EAAM9uB,GACnB2X,EAAM3X,IAAO2X,EAAM3X,KAK/B,MAAO,CAAC8uB,EAAKnX,GA+JCk3B,CAAOtB,GAASuB,EAAK3B,GAAStnC,EAAE,GAAIA,EAAE,GAAI+oC,GACpDA,EAAKhC,GAAMhoC,KAAKuC,MAAMtB,EAAE,GAAKipC,GAAMA,EAAIlqC,KAAKuC,MAAMtB,EAAE,GAAKipC,EAAK,GAAKA,EAAIF,GAKzE,OAAOA,EAAG5yB,KAAIhc,GAAS+uC,EAAQxB,EAAQvtC,cAKhC+uC,EAAQxB,EAAQvtC,GACvB,IAAIonC,EAAW,GACX4H,EAAQ,GAiBZ,gBASgBzB,EAAQvtC,EAAO6qB,GAC/B,IAEIhd,EAAGC,EAAGgmB,EAAIE,EAAIpN,EAAImO,EAFlBka,EAAkB,IAAI/5B,MACtBg6B,EAAgB,IAAIh6B,MAIxBrH,EAAIC,GAAI,EACRkmB,EAAKuZ,EAAO,IAAMvtC,EAClBuuC,GAAMva,GAAM,GAAGzzB,QAAQ4uC,UACdthC,EAAI6G,EAAK,GAChBof,EAAKE,EAAIA,EAAKuZ,EAAO1/B,EAAI,IAAM7N,EAC/BuuC,GAAMza,EAAKE,GAAM,GAAGzzB,QAAQ4uC,GAE9BZ,GAAMva,GAAM,GAAGzzB,QAAQ4uC,UAGdrhC,EAAI6G,EAAK,GAAG,KACnB9G,GAAI,EACJmmB,EAAKuZ,EAAOz/B,EAAI4G,EAAKA,IAAO1U,EAC5B4mB,EAAK2mB,EAAOz/B,EAAI4G,IAAO1U,EACvBuuC,GAAMva,GAAM,EAAIpN,GAAM,GAAGrmB,QAAQ4uC,KACxBthC,EAAI6G,EAAK,GAChBof,EAAKE,EAAIA,EAAKuZ,EAAOz/B,EAAI4G,EAAKA,EAAK7G,EAAI,IAAM7N,EAC7C+0B,EAAKnO,EAAIA,EAAK2mB,EAAOz/B,EAAI4G,EAAK7G,EAAI,IAAM7N,EACxCuuC,GAAMza,EAAKE,GAAM,EAAIpN,GAAM,EAAImO,GAAM,GAAGx0B,QAAQ4uC,GAElDZ,GAAMva,EAAKpN,GAAM,GAAGrmB,QAAQ4uC,GAI9BthC,GAAI,EACJ+Y,EAAK2mB,EAAOz/B,EAAI4G,IAAO1U,EACvBuuC,GAAM3nB,GAAM,GAAGrmB,QAAQ4uC,UACdthC,EAAI6G,EAAK,GAChBqgB,EAAKnO,EAAIA,EAAK2mB,EAAOz/B,EAAI4G,EAAK7G,EAAI,IAAM7N,EACxCuuC,GAAM3nB,GAAM,EAAImO,GAAM,GAAGx0B,QAAQ4uC,YAI1BA,EAAOC,GACd,IAII7gC,EAAGvE,EAJHjI,EAAQ,CAACqtC,EAAK,GAAG,GAAKvhC,EAAGuhC,EAAK,GAAG,GAAKthC,GACtC7L,EAAM,CAACmtC,EAAK,GAAG,GAAKvhC,EAAGuhC,EAAK,GAAG,GAAKthC,GACpCuhC,EAAalM,EAAMphC,GACnButC,EAAWnM,EAAMlhC,IAEjBsM,EAAI2gC,EAAcG,KAChBrlC,EAAIilC,EAAgBK,YACfJ,EAAc3gC,EAAEtM,YAChBgtC,EAAgBjlC,EAAEjI,OACrBwM,IAAMvE,GACRuE,EAAEw/B,KAAK5tC,KAAK8B,GACZ4oB,EAAStc,EAAEw/B,OAEXkB,EAAgB1gC,EAAExM,OAASmtC,EAAcllC,EAAE/H,KAAO,CAACF,MAAOwM,EAAExM,MAAOE,IAAK+H,EAAE/H,IAAK8rC,KAAMx/B,EAAEw/B,KAAKvtB,OAAOxW,EAAE+jC,gBAGhGmB,EAAc3gC,EAAEtM,KACvBsM,EAAEw/B,KAAK5tC,KAAK8B,GACZitC,EAAc3gC,EAAEtM,IAAMqtC,GAAY/gC,IAE3BA,EAAI0gC,EAAgBK,KACzBtlC,EAAIklC,EAAcG,YACbJ,EAAgB1gC,EAAExM,cAClBmtC,EAAcllC,EAAE/H,KACnBsM,IAAMvE,GACRuE,EAAEw/B,KAAK5tC,KAAK8B,GACZ4oB,EAAStc,EAAEw/B,OAEXkB,EAAgBjlC,EAAEjI,OAASmtC,EAAc3gC,EAAEtM,KAAO,CAACF,MAAOiI,EAAEjI,MAAOE,IAAKsM,EAAEtM,IAAK8rC,KAAM/jC,EAAE+jC,KAAKvtB,OAAOjS,EAAEw/B,gBAGhGkB,EAAgB1gC,EAAExM,OACzBwM,EAAEw/B,KAAKxI,QAAQxjC,GACfktC,EAAgB1gC,EAAExM,MAAQstC,GAAc9gC,GAG1C0gC,EAAgBI,GAAcH,EAAcI,GAAY,CAACvtC,MAAOstC,EAAYptC,IAAKqtC,EAAUvB,KAAM,CAAChsC,EAAOE,IAvC7GssC,GAAM3nB,GAAM,GAAGrmB,QAAQ4uC,GA7DvBI,CAAShC,EAAQvtC,GAAO,SAAS+tC,GAC/BW,EAAOX,EAAMR,EAAQvtC,YApFb+tC,OACZ,IAAIrnC,EAAI,EAAGlF,EAAIusC,EAAKpsC,OAAQ6tC,EAAOzB,EAAKvsC,EAAI,GAAG,GAAKusC,EAAK,GAAG,GAAKA,EAAKvsC,EAAI,GAAG,GAAKusC,EAAK,GAAG,KACjFrnC,EAAIlF,GAAGguC,GAAQzB,EAAKrnC,EAAI,GAAG,GAAKqnC,EAAKrnC,GAAG,GAAKqnC,EAAKrnC,EAAI,GAAG,GAAKqnC,EAAKrnC,GAAG,GAC/E,OAAO8oC,EAkFCC,CAAK1B,GAAQ,EAAG3G,EAASjnC,KAAK,CAAC4tC,IAC9BiB,EAAM7uC,KAAK4tC,MAGlBiB,EAAMzuC,SAAQ,SAASytC,GACrB,IAAK,IAAgCjW,EAA5BrxB,EAAI,EAAGlF,EAAI4lC,EAASzlC,OAAiB+E,EAAIlF,IAAKkF,EACrD,IAAmD,IAA/ConC,IAAU/V,EAAUqP,EAAS1gC,IAAI,GAAIsnC,GAEvC,YADAjW,EAAQ53B,KAAK6tC,MAMZ,CACLpiC,KAAM,eACN5L,MAAOA,EACP0vC,YAAatI,YAuFRjE,EAAMwE,GACb,OAAkB,EAAXA,EAAM,GAASA,EAAM,IAAMjzB,EAAK,GAAK,WAGrCi6B,EAAaZ,EAAMR,EAAQvtC,GAClC+tC,EAAKxtC,SAAQ,SAASonC,GACpB,IAIIjhB,EAJA7Y,EAAI85B,EAAM,GACV75B,EAAI65B,EAAM,GACVgI,EAAS,EAAJ9hC,EACL+hC,EAAS,EAAJ9hC,EAEL6Y,EAAK4mB,EAAOqC,EAAKl7B,EAAKi7B,GACtB9hC,EAAI,GAAKA,EAAI6G,GAAMi7B,IAAO9hC,IAC5B6Y,EAAK6mB,EAAOqC,EAAKl7B,EAAKi7B,EAAK,GAC3BhI,EAAM,GAAK95B,GAAK7N,EAAQ0mB,IAAOC,EAAKD,GAAM,IAExC5Y,EAAI,GAAKA,EAAI6G,GAAMi7B,IAAO9hC,IAC5B4Y,EAAK6mB,GAAQqC,EAAK,GAAKl7B,EAAKi7B,GAC5BhI,EAAM,GAAK75B,GAAK9N,EAAQ0mB,IAAOC,EAAKD,GAAM,OAsBhD,OAjBA8nB,EAASO,QAAUA,EAEnBP,EAAS57B,KAAO,SAASwuB,GACvB,IAAK92B,UAAU3I,OAAQ,MAAO,CAAC+S,EAAIC,GACnC,IAAI4lB,EAAK31B,KAAKuC,MAAMi6B,EAAE,IAAKyO,EAAKjrC,KAAKuC,MAAMi6B,EAAE,IAC7C,KAAM7G,GAAM,GAAKsV,GAAM,GAAI,MAAM,IAAI5oC,MAAM,gBAC3C,OAAOyN,EAAK6lB,EAAI5lB,EAAKk7B,EAAIrB,GAG3BA,EAASsB,WAAa,SAAS1O,GAC7B,OAAO92B,UAAU3I,QAAU8sC,EAAyB,mBAANrN,EAAmBA,EAAIlsB,MAAMiU,QAAQiY,GAAKyM,GAASF,GAAMv4B,KAAKgsB,IAAMyM,GAASzM,GAAIoN,GAAYC,GAG7ID,EAASE,OAAS,SAAStN,GACzB,OAAO92B,UAAU3I,QAAU+sC,EAAStN,EAAIuN,EAAeL,GAAME,GAAYE,IAAWC,GAG/EH,WAMAuB,GAAMC,EAAQpgB,EAAQ7lB,GAI7B,IAHA,IAAIvI,EAAIwuC,EAAOptC,MACXijB,EAAImqB,EAAOntC,OACXJ,EAAe,GAAVsH,GAAK,GACL2pB,EAAI,EAAGA,EAAI7N,IAAK6N,EACvB,IAAK,IAAIhtB,EAAI,EAAGupC,EAAK,EAAGvpC,EAAIlF,EAAIuI,IAAKrD,EAC/BA,EAAIlF,IACNyuC,GAAMD,EAAOr9B,KAAKjM,EAAIgtB,EAAIlyB,IAExBkF,GAAKqD,IACHrD,GAAKjE,IACPwtC,GAAMD,EAAOr9B,KAAKjM,EAAIjE,EAAIixB,EAAIlyB,IAEhCouB,EAAOjd,KAAKjM,EAAIqD,EAAI2pB,EAAIlyB,GAAKyuC,EAAKrrC,KAAKkqB,IAAIpoB,EAAI,EAAGlF,EAAI,EAAIiB,EAAIiE,EAAGjE,aAShEytC,GAAMF,EAAQpgB,EAAQ7lB,GAI7B,IAHA,IAAIvI,EAAIwuC,EAAOptC,MACXijB,EAAImqB,EAAOntC,OACXJ,EAAe,GAAVsH,GAAK,GACLrD,EAAI,EAAGA,EAAIlF,IAAKkF,EACvB,IAAK,IAAIgtB,EAAI,EAAGuc,EAAK,EAAGvc,EAAI7N,EAAI9b,IAAK2pB,EAC/BA,EAAI7N,IACNoqB,GAAMD,EAAOr9B,KAAKjM,EAAIgtB,EAAIlyB,IAExBkyB,GAAK3pB,IACH2pB,GAAKjxB,IACPwtC,GAAMD,EAAOr9B,KAAKjM,GAAKgtB,EAAIjxB,GAAKjB,IAElCouB,EAAOjd,KAAKjM,GAAKgtB,EAAI3pB,GAAKvI,GAAKyuC,EAAKrrC,KAAKkqB,IAAI4E,EAAI,EAAG7N,EAAI,EAAIpjB,EAAIixB,EAAGjxB,aAMlE0tC,GAAS7hC,GAChB,OAAOA,EAAE,YAGF8hC,GAAS9hC,GAChB,OAAOA,EAAE,YAGF+hC,KACP,OAAO,QCpaHC,iBAEF3wC,KAAK4wC,UAAY,IAAIxX,aAAa,IAClCp5B,KAAK6wC,GAAK,EAEZpvC,IAAIyM,GACF,MAAMwO,EAAI1c,KAAK4wC,UACf,IAAI7pC,EAAI,EACR,IAAK,IAAIgtB,EAAI,EAAGA,EAAI/zB,KAAK6wC,IAAM9c,EAAI,GAAIA,IAAK,CAC1C,MAAM5lB,EAAIuO,EAAEqX,GACV+c,EAAK5iC,EAAIC,EACT4iC,EAAK9rC,KAAK+L,IAAI9C,GAAKjJ,KAAK+L,IAAI7C,GAAKD,GAAK4iC,EAAK3iC,GAAKA,GAAK2iC,EAAK5iC,GACxD6iC,IAAIr0B,EAAE3V,KAAOgqC,GACjB7iC,EAAI4iC,EAIN,OAFAp0B,EAAE3V,GAAKmH,EACPlO,KAAK6wC,GAAK9pC,EAAI,EACP/G,KAETgxC,UACE,MAAMt0B,EAAI1c,KAAK4wC,UACf,IAAiB1iC,EAAGC,EAAG4iC,EAAnBlvC,EAAI7B,KAAK6wC,GAAcC,EAAK,EAChC,GAAIjvC,EAAI,EAAG,KACTivC,EAAKp0B,IAAI7a,GACFA,EAAI,IACTqM,EAAI4iC,EACJ3iC,EAAIuO,IAAI7a,GACRivC,EAAK5iC,EAAIC,EACT4iC,EAAK5iC,GAAK2iC,EAAK5iC,IACX6iC,KAEFlvC,EAAI,IAAOkvC,EAAK,GAAKr0B,EAAE7a,EAAI,GAAK,GAAOkvC,EAAK,GAAKr0B,EAAE7a,EAAI,GAAK,KAC9DsM,EAAS,EAAL4iC,EACJ7iC,EAAI4iC,EAAK3iC,EACLA,GAAKD,EAAI4iC,IAAIA,EAAK5iC,IAG1B,OAAO4iC,YAUFG,GAAMC,GACb,OAAO37B,MAAMowB,eAPGuL,GAChB,IAAK,MAAM9vB,KAAS8vB,QACX9vB,EAKS+vB,CAAQD,IAG5B,IAAIE,GAAU,KACVC,GAAW,MACXC,GAAKrsC,KAAKsJ,GACVgjC,GAASD,GAAK,EACdE,GAAYF,GAAK,EACjBG,GAAW,EAALH,GAGNI,GAAUJ,GAAK,IAEfK,GAAM1sC,KAAK+L,IACX4gC,GAAO3sC,KAAK4sC,KACZC,GAAQ7sC,KAAK8sC,MACbC,GAAM/sC,KAAK4L,IAEXohC,IADOhtC,KAAKw3B,KACNx3B,KAAKspB,KAEX2jB,IADQjtC,KAAK6hC,MACP7hC,KAAK0Y,KAEXw0B,IADMltC,KAAK0f,IACL1f,KAAKkM,KACXihC,GAAOntC,KAAK6pB,MAAQ,SAAS5gB,GAAK,OAAOA,EAAI,EAAI,EAAIA,EAAI,GAAI,EAAK,GAClEmkC,GAAOptC,KAAKiL,KACZoiC,GAAMrtC,KAAKstC,aAENC,GAAKtkC,GACZ,OAAOA,EAAI,EAAI,EAAIA,GAAI,EAAKojC,GAAKrsC,KAAK8L,KAAK7C,YAGpCukC,GAAKvkC,GACZ,OAAOA,EAAI,EAAIqjC,GAASrjC,GAAI,GAAMqjC,GAAStsC,KAAKytC,KAAKxkC,YAO9CykC,eAEAC,GAAeC,EAAUC,GAC5BD,GAAYE,GAAmBC,eAAeH,EAAS5mC,OACzD8mC,GAAmBF,EAAS5mC,MAAM4mC,EAAUC,GAIhD,IAAIG,GAAmB,CACrBC,QAAS,SAASp4B,EAAQg4B,GACxBF,GAAe93B,EAAO+3B,SAAUC,IAElCK,kBAAmB,SAASr4B,EAAQg4B,OAClC,IAAIM,EAAWt4B,EAAOs4B,SAAUrsC,GAAI,EAAIlF,EAAIuxC,EAASpxC,SAC5C+E,EAAIlF,GAAG+wC,GAAeQ,EAASrsC,GAAG8rC,SAAUC,KAIrDC,GAAqB,CACvBM,OAAQ,SAASv4B,EAAQg4B,GACvBA,EAAOQ,UAETC,MAAO,SAASz4B,EAAQg4B,GACtBh4B,EAASA,EAAOi1B,YAChB+C,EAAO9K,MAAMltB,EAAO,GAAIA,EAAO,GAAIA,EAAO,KAE5C04B,WAAY,SAAS14B,EAAQg4B,OAC3B,IAAI/C,EAAcj1B,EAAOi1B,YAAahpC,GAAI,EAAIlF,EAAIkuC,EAAY/tC,SACrD+E,EAAIlF,GAAGiZ,EAASi1B,EAAYhpC,GAAI+rC,EAAO9K,MAAMltB,EAAO,GAAIA,EAAO,GAAIA,EAAO,KAErF24B,WAAY,SAAS34B,EAAQg4B,GAC3BY,GAAW54B,EAAOi1B,YAAa+C,EAAQ,IAEzCa,gBAAiB,SAAS74B,EAAQg4B,OAChC,IAAI/C,EAAcj1B,EAAOi1B,YAAahpC,GAAI,EAAIlF,EAAIkuC,EAAY/tC,SACrD+E,EAAIlF,GAAG6xC,GAAW3D,EAAYhpC,GAAI+rC,EAAQ,IAErDc,QAAS,SAAS94B,EAAQg4B,GACxBe,GAAc/4B,EAAOi1B,YAAa+C,IAEpCgB,aAAc,SAASh5B,EAAQg4B,OAC7B,IAAI/C,EAAcj1B,EAAOi1B,YAAahpC,GAAI,EAAIlF,EAAIkuC,EAAY/tC,SACrD+E,EAAIlF,GAAGgyC,GAAc9D,EAAYhpC,GAAI+rC,IAEhDiB,mBAAoB,SAASj5B,EAAQg4B,OACnC,IAAIkB,EAAal5B,EAAOk5B,WAAYjtC,GAAI,EAAIlF,EAAImyC,EAAWhyC,SAClD+E,EAAIlF,GAAG+wC,GAAeoB,EAAWjtC,GAAI+rC,cAIzCY,GAAW3D,EAAa+C,EAAQ3K,GACvC,IAA6C8L,EAAzCltC,GAAI,EAAIlF,EAAIkuC,EAAY/tC,OAASmmC,MACrC2K,EAAOoB,cACEntC,EAAIlF,GAAGoyC,EAAalE,EAAYhpC,GAAI+rC,EAAO9K,MAAMiM,EAAW,GAAIA,EAAW,GAAIA,EAAW,IACnGnB,EAAOqB,mBAGAN,GAAc9D,EAAa+C,GAClC,IAAI/rC,GAAI,EAAIlF,EAAIkuC,EAAY/tC,WAC5B8wC,EAAOsB,iBACErtC,EAAIlF,GAAG6xC,GAAW3D,EAAYhpC,GAAI+rC,EAAQ,GACnDA,EAAOuB,sBAGAC,GAAUx5B,EAAQg4B,GACrBh4B,GAAUm4B,GAAiBD,eAAel4B,EAAO7O,MACnDgnC,GAAiBn4B,EAAO7O,MAAM6O,EAAQg4B,GAEtCF,GAAe93B,EAAQg4B,GAIT,IAAInC,GAIR,IAAIA,YAwET4D,GAAUC,GACjB,IAAIC,EAASD,EAAU,GAAIE,EAAMF,EAAU,GAAIG,EAAS3C,GAAI0C,GAC5D,MAAO,CAACC,EAAS3C,GAAIyC,GAASE,EAASxC,GAAIsC,GAAStC,GAAIuC,aAOjDE,GAAelmC,EAAGpE,GACzB,MAAO,CAACoE,EAAE,GAAKpE,EAAE,GAAKoE,EAAE,GAAKpE,EAAE,GAAIoE,EAAE,GAAKpE,EAAE,GAAKoE,EAAE,GAAKpE,EAAE,GAAIoE,EAAE,GAAKpE,EAAE,GAAKoE,EAAE,GAAKpE,EAAE,aAa9EuqC,GAA0BlmC,GACjC,IAAI6mB,EAAI6c,GAAK1jC,EAAE,GAAKA,EAAE,GAAKA,EAAE,GAAKA,EAAE,GAAKA,EAAE,GAAKA,EAAE,IAClDA,EAAE,IAAM6mB,EAAG7mB,EAAE,IAAM6mB,EAAG7mB,EAAE,IAAM6mB,WA+UvBsf,GAAiBL,EAAQC,GAChC,MAAO,CAAC/C,GAAI8C,GAAUnD,GAAKmD,EAASxvC,KAAKC,OAAOuvC,EAAShD,IAAOA,GAAMgD,EAAQC,YA6IvEK,KACP,IACItF,EADAuF,EAAQ,GAEZ,MAAO,CACLhN,MAAO,SAAS95B,EAAGC,EAAG+X,GACpBupB,EAAKjvC,KAAK,CAAC0N,EAAGC,EAAG+X,KAEnBguB,UAAW,WACTc,EAAMx0C,KAAKivC,EAAO,KAEpB0E,QAASxB,GACTsC,OAAQ,WACFD,EAAMhzC,OAAS,GAAGgzC,EAAMx0C,KAAKw0C,EAAMpnC,MAAMiT,OAAOm0B,EAAME,WAE5DC,OAAQ,WACN,IAAIA,EAASH,EAGb,OAFAA,EAAQ,GACRvF,EAAO,KACA0F,aAKJC,GAAW1mC,EAAGpE,GACrB,OAAOqnC,GAAIjjC,EAAE,GAAKpE,EAAE,IAAM8mC,IAAWO,GAAIjjC,EAAE,GAAKpE,EAAE,IAAM8mC,YAGjDiE,GAAarN,EAAOlM,EAAQwZ,EAAOC,GAC1Cv1C,KAAKkO,EAAI85B,EACThoC,KAAKy0B,EAAIqH,EACT97B,KAAKwK,EAAI8qC,EACTt1C,KAAKkG,EAAIqvC,EACTv1C,KAAKgmB,GAAI,EACThmB,KAAK6B,EAAI7B,KAAK0c,EAAI,cAMX84B,GAAWC,EAAUC,EAAqBC,EAAaC,EAAa9C,GAC3E,IAEI/rC,EACA8sB,EAHAwU,EAAU,GACV1zB,EAAO,GAyBX,GArBA8gC,EAAS70C,SAAQ,SAASi1C,GACxB,MAAKh0C,EAAIg0C,EAAQ7zC,OAAS,IAAM,GAAhC,CACA,IAAIH,EAAqCqM,EAAlCuY,EAAKovB,EAAQ,GAAInvB,EAAKmvB,EAAQh0C,GAErC,GAAIuzC,GAAW3uB,EAAIC,GAAK,CACtB,IAAKD,EAAG,KAAOC,EAAG,GAAI,CAEpB,IADAosB,EAAOoB,YACFntC,EAAI,EAAGA,EAAIlF,IAAKkF,EAAG+rC,EAAO9K,OAAOvhB,EAAKovB,EAAQ9uC,IAAI,GAAI0f,EAAG,IAE9D,YADAqsB,EAAOqB,UAITztB,EAAG,IAAM,KAGX2hB,EAAQ7nC,KAAK0N,EAAI,IAAImnC,GAAa5uB,EAAIovB,EAAS,MAAM,IACrDlhC,EAAKnU,KAAK0N,EAAE1D,EAAI,IAAI6qC,GAAa5uB,EAAI,KAAMvY,GAAG,IAC9Cm6B,EAAQ7nC,KAAK0N,EAAI,IAAImnC,GAAa3uB,EAAImvB,EAAS,MAAM,IACrDlhC,EAAKnU,KAAK0N,EAAE1D,EAAI,IAAI6qC,GAAa3uB,EAAI,KAAMxY,GAAG,QAG3Cm6B,EAAQrmC,OAAb,CAMA,IAJA2S,EAAKwZ,KAAKunB,GACVI,GAAKzN,GACLyN,GAAKnhC,GAEA5N,EAAI,EAAG8sB,EAAIlf,EAAK3S,OAAQ+E,EAAI8sB,IAAK9sB,EACpC4N,EAAK5N,GAAGb,EAAIyvC,GAAeA,MAG7B,IACI7Z,EACAkM,EAFA5lC,EAAQimC,EAAQ,KAIV,KAER,IAAI/hC,EAAUlE,EACV2zC,GAAY,EACTzvC,EAAQ0f,OAAQ1f,EAAUA,EAAQzE,KAAOO,EAAO,OACvD05B,EAASx1B,EAAQmuB,EACjBqe,EAAOoB,cACJ,CAED,GADA5tC,EAAQ0f,EAAI1f,EAAQkE,EAAEwb,GAAI,EACtB1f,EAAQJ,EAAG,CACb,GAAI6vC,EACF,IAAKhvC,EAAI,EAAG8sB,EAAIiI,EAAO95B,OAAQ+E,EAAI8sB,IAAK9sB,EAAG+rC,EAAO9K,OAAOA,EAAQlM,EAAO/0B,IAAI,GAAIihC,EAAM,SAEtF4N,EAAYtvC,EAAQ4H,EAAG5H,EAAQzE,EAAEqM,EAAG,EAAG4kC,GAEzCxsC,EAAUA,EAAQzE,MACb,CACL,GAAIk0C,EAEF,IADAja,EAASx1B,EAAQoW,EAAE+X,EACd1tB,EAAI+0B,EAAO95B,OAAS,EAAG+E,GAAK,IAAKA,EAAG+rC,EAAO9K,OAAOA,EAAQlM,EAAO/0B,IAAI,GAAIihC,EAAM,SAEpF4N,EAAYtvC,EAAQ4H,EAAG5H,EAAQoW,EAAExO,GAAG,EAAI4kC,GAE1CxsC,EAAUA,EAAQoW,EAGpBof,GADAx1B,EAAUA,EAAQkE,GACDiqB,EACjBshB,GAAaA,SACLzvC,EAAQ0f,GAClB8sB,EAAOqB,qBAIF2B,GAAK10B,GACZ,GAAMvf,EAAIuf,EAAMpf,OAAhB,KACA,IAAIH,EAGAyI,EAFAvD,EAAI,EACJ2H,EAAI0S,EAAM,KAELra,EAAIlF,GACX6M,EAAE7M,EAAIyI,EAAI8W,EAAMra,GAChBuD,EAAEoS,EAAIhO,EACNA,EAAIpE,EAENoE,EAAE7M,EAAIyI,EAAI8W,EAAM,GAChB9W,EAAEoS,EAAIhO,YAGCsnC,GAAUhO,GACjB,OAAO2J,GAAI3J,EAAM,KAAOsJ,GAAKtJ,EAAM,GAAKoK,GAAKpK,EAAM,MAAQ2J,GAAI3J,EAAM,IAAMsJ,IAAMG,GAAMH,aAGhF2E,GAAgB7d,EAAS4P,GAChC,IAAIyM,EAASuB,GAAUhO,GACnB0M,EAAM1M,EAAM,GACZkO,EAAS/D,GAAIuC,GACbyB,EAAS,CAAChE,GAAIsC,IAAUzC,GAAIyC,GAAS,GACrCpmC,EAAQ,EACR+nC,EAAU,EAEVvK,EAAM,IAAI8E,GAEC,IAAXuF,EAAcxB,EAAMnD,GAASH,IACb,IAAX8E,IAAexB,GAAOnD,GAASH,IAExC,IAAK,IAAIrqC,EAAI,EAAGlF,EAAIu2B,EAAQp2B,OAAQ+E,EAAIlF,IAAKkF,EAC3C,GAAMmf,GAAKkoB,EAAOhW,EAAQrxB,IAAI/E,OAS9B,IARA,IAAIosC,EACAloB,EACAmwB,EAASjI,EAAKloB,EAAI,GAClBowB,EAAUN,GAAUK,GACpBE,EAAOF,EAAO,GAAK,EAAI7E,GACvBgF,EAAUrE,GAAIoE,GACdE,EAAUzE,GAAIuE,GAETxiB,EAAI,EAAGA,EAAI7N,IAAK6N,EAAGuiB,EAAUI,EAASF,EAAUG,EAASF,EAAUG,EAASP,EAASQ,EAAQ,CACpG,IAAIA,EAASzI,EAAKra,GACd2iB,EAAUV,GAAUa,GACpBC,EAAOD,EAAO,GAAK,EAAIrF,GACvBmF,EAAUxE,GAAI2E,GACdF,EAAU5E,GAAI8E,GACdC,EAAQL,EAAUJ,EAClBxnB,EAAOioB,GAAS,EAAI,GAAI,EACxBC,EAAWloB,EAAOioB,EAClBE,EAAeD,EAAW1F,GAC1BrrB,EAAIuwB,EAAUG,EAOlB,GALA9K,EAAIpqC,IAAIqwC,GAAM7rB,EAAI6I,EAAOqjB,GAAI6E,GAAWP,EAAUG,EAAU3wB,EAAI+rB,GAAIgF,KACpE3oC,GAAS4oC,EAAeF,EAAQjoB,EAAO2iB,GAAMsF,EAIzCE,EAAeX,GAAW7B,EAASiC,GAAWjC,EAAQ,CACxD,IAAI9iC,EAAMijC,GAAeL,GAAU8B,GAAS9B,GAAUsC,IACtDhC,GAA0BljC,GAC1B,IAAIulC,EAAetC,GAAeuB,EAAQxkC,GAC1CkjC,GAA0BqC,GAC1B,IAAIC,GAAUF,EAAeF,GAAS,GAAI,EAAK,GAAKtE,GAAKyE,EAAa,KAClExC,EAAMyC,GAAUzC,IAAQyC,IAAWxlC,EAAI,IAAMA,EAAI,OACnDykC,GAAWa,EAAeF,GAAS,EAAI,GAAI,IAiBnD,OAAQ1oC,GAAK,MAAeA,EAAQ+iC,IAAWvF,GAAG,OAA2B,EAAVuK,WAG5DgB,GAAKC,EAAcC,EAAU1B,EAAaxzC,GACjD,OAAO,SAASm1C,GACd,IAIInf,EACAqd,EACArH,EANAqB,EAAO6H,EAASC,GAChBC,EAAazC,KACb0C,EAAWH,EAASE,GACpBE,GAAiB,EAKjB/iC,EAAO,CACTqzB,MAAO6O,EACP3C,UAAWA,EACXC,QAASA,EACTC,aAAc,WACZz/B,EAAKqzB,MAAQ2P,EACbhjC,EAAKu/B,UAAY0D,EACjBjjC,EAAKw/B,QAAU0D,EACfpC,EAAW,GACXrd,EAAU,IAEZic,WAAY,WACV1/B,EAAKqzB,MAAQ6O,EACbliC,EAAKu/B,UAAYA,EACjBv/B,EAAKw/B,QAAUA,EACfsB,EAAWxE,GAAMwE,GACjB,IAAIE,EAAcM,GAAgB7d,EAASh2B,GACvCqzC,EAASzzC,QACN01C,IAAgBH,EAAKnD,eAAgBsD,GAAiB,GAC3DlC,GAAWC,EAAUqC,GAAqBnC,EAAaC,EAAa2B,IAC3D5B,IACJ+B,IAAgBH,EAAKnD,eAAgBsD,GAAiB,GAC3DH,EAAKrD,YACL0B,EAAY,KAAM,KAAM,EAAG2B,GAC3BA,EAAKpD,WAEHuD,IAAgBH,EAAKlD,aAAcqD,GAAiB,GACxDjC,EAAWrd,EAAU,MAEvBkb,OAAQ,WACNiE,EAAKnD,eACLmD,EAAKrD,YACL0B,EAAY,KAAM,KAAM,EAAG2B,GAC3BA,EAAKpD,UACLoD,EAAKlD,wBAIAwC,EAAMpC,EAAQC,GACjB2C,EAAa5C,EAAQC,IAAM6C,EAAKvP,MAAMyM,EAAQC,YAG3CqD,EAAUtD,EAAQC,GACzBjF,EAAKzH,MAAMyM,EAAQC,YAGZR,IACPv/B,EAAKqzB,MAAQ+P,EACbtI,EAAKyE,qBAGEC,IACPx/B,EAAKqzB,MAAQ6O,EACbpH,EAAK0E,mBAGEwD,EAAUlD,EAAQC,GACzBtG,EAAK5tC,KAAK,CAACi0C,EAAQC,IACnB+C,EAASzP,MAAMyM,EAAQC,YAGhBkD,IACPH,EAASvD,YACT9F,EAAO,YAGAyJ,IACPF,EAAUvJ,EAAK,GAAG,GAAIA,EAAK,GAAG,IAC9BqJ,EAAStD,UAET,IAEIptC,EAA4Bmf,EAC5B2vB,EACA7N,EAJAgQ,EAAQP,EAASO,QACjBC,EAAeT,EAAWrC,SACvBtzC,EAAIo2C,EAAaj2C,OAQxB,GAJAosC,EAAKxgC,MACLwqB,EAAQ53B,KAAK4tC,GACbA,EAAO,KAEFvsC,EAGL,GAAY,EAARm2C,GAEF,IAAK9xB,GADL2vB,EAAUoC,EAAa,IACNj2C,OAAS,GAAK,EAAG,CAGhC,IAFK01C,IAAgBH,EAAKnD,eAAgBsD,GAAiB,GAC3DH,EAAKrD,YACAntC,EAAI,EAAGA,EAAImf,IAAKnf,EAAGwwC,EAAKvP,OAAOA,EAAQ6N,EAAQ9uC,IAAI,GAAIihC,EAAM,IAClEuP,EAAKpD,gBAOLtyC,EAAI,GAAa,EAARm2C,GAAWC,EAAaz3C,KAAKy3C,EAAarqC,MAAMiT,OAAOo3B,EAAa/C,UAEjFO,EAASj1C,KAAKy3C,EAAap9B,OAAOq9B,KAGpC,OAAOvjC,YAIFujC,GAAarC,GACpB,OAAOA,EAAQ7zC,OAAS,WAKjB81C,GAAoBppC,EAAGpE,GAC9B,QAASoE,EAAIA,EAAER,GAAG,GAAK,EAAIQ,EAAE,GAAK6iC,GAASH,GAAUG,GAAS7iC,EAAE,MACvDpE,EAAIA,EAAE4D,GAAG,GAAK,EAAI5D,EAAE,GAAKinC,GAASH,GAAUG,GAASjnC,EAAE,IA5clEwqC,GAAiBqD,OAASrD,GA+cHsC,IACrB,WAAa,OAAO,cASQtE,GAC5B,IAGIkF,EAHA1B,EAAU8B,IACV7B,EAAO6B,IACPC,EAAQD,IAGZ,MAAO,CACLlE,UAAW,WACTpB,EAAOoB,YACP8D,EAAQ,GAEVhQ,MAAO,SAAS0O,EAASI,GACvB,IAAIwB,EAAQ5B,EAAU,EAAIpF,IAAMA,GAC5ByF,EAAQpF,GAAI+E,EAAUJ,GACtB3E,GAAIoF,EAAQzF,IAAMF,IACpB0B,EAAO9K,MAAMsO,EAASC,GAAQA,EAAOO,GAAQ,EAAI,EAAIvF,IAAUA,IAC/DuB,EAAO9K,MAAMqQ,EAAO9B,GACpBzD,EAAOqB,UACPrB,EAAOoB,YACPpB,EAAO9K,MAAMsQ,EAAO/B,GACpBzD,EAAO9K,MAAM0O,EAASH,GACtByB,EAAQ,GACCK,IAAUC,GAASvB,GAASzF,KACjCK,GAAI2E,EAAU+B,GAASjH,KAASkF,GAAW+B,EAAQjH,IACnDO,GAAI+E,EAAU4B,GAASlH,KAASsF,GAAW4B,EAAQlH,IACvDmF,WAoB2BD,EAASC,EAAMG,EAASI,GACzD,IAAIL,EACAG,EACA2B,EAAoBpG,GAAImE,EAAUI,GACtC,OAAO/E,GAAI4G,GAAqBnH,GAC1BQ,IAAMO,GAAIoE,IAASK,EAAU5E,GAAI8E,IAAS3E,GAAIuE,GAC1CvE,GAAI2E,IAASL,EAAUzE,GAAIuE,IAASpE,GAAImE,KACvCG,EAAUG,EAAU2B,KACxBhC,EAAOO,GAAQ,EA5BT0B,CAA0BlC,EAASC,EAAMG,EAASI,GACzDhE,EAAO9K,MAAMqQ,EAAO9B,GACpBzD,EAAOqB,UACPrB,EAAOoB,YACPpB,EAAO9K,MAAMsQ,EAAO/B,GACpByB,EAAQ,GAEVlF,EAAO9K,MAAMsO,EAAUI,EAASH,EAAOO,GACvCuB,EAAQC,GAEVnE,QAAS,WACPrB,EAAOqB,UACPmC,EAAUC,EAAO6B,KAEnBJ,MAAO,WACL,OAAO,EAAIA,gBAgBoBrS,EAAM5c,EAAI0vB,EAAW3F,GACxD,IAAI4B,EACJ,GAAY,MAAR/O,EACF+O,EAAM+D,EAAYlH,GAClBuB,EAAO9K,OAAOsJ,GAAIoD,GAClB5B,EAAO9K,MAAM,EAAG0M,GAChB5B,EAAO9K,MAAMsJ,GAAIoD,GACjB5B,EAAO9K,MAAMsJ,GAAI,GACjBwB,EAAO9K,MAAMsJ,IAAKoD,GAClB5B,EAAO9K,MAAM,GAAI0M,GACjB5B,EAAO9K,OAAOsJ,IAAKoD,GACnB5B,EAAO9K,OAAOsJ,GAAI,GAClBwB,EAAO9K,OAAOsJ,GAAIoD,QACb,GAAI/C,GAAIhM,EAAK,GAAK5c,EAAG,IAAMqoB,GAAS,CACzC,IAAIqD,EAAS9O,EAAK,GAAK5c,EAAG,GAAKuoB,IAAMA,GACrCoD,EAAM+D,EAAYhE,EAAS,EAC3B3B,EAAO9K,OAAOyM,EAAQC,GACtB5B,EAAO9K,MAAM,EAAG0M,GAChB5B,EAAO9K,MAAMyM,EAAQC,QAErB5B,EAAO9K,MAAMjf,EAAG,GAAIA,EAAG,MAlFzB,EAAEuoB,IAAKC,KAsxBT,IAIImH,GACAC,GACAC,GACAC,GAPAC,GAAW5qC,GAAKA,EAEhB6qC,GAAY,IAAIpI,GAChBqI,GAAgB,IAAIrI,GAMpBsI,GAAe,CACjBjR,MAAO2K,GACPuB,UAAWvB,GACXwB,QAASxB,GACTyB,aAAc,WACZ6E,GAAa/E,UAAYgF,GACzBD,GAAa9E,QAAUgF,IAEzB9E,WAAY,WACV4E,GAAa/E,UAAY+E,GAAa9E,QAAU8E,GAAajR,MAAQ2K,GACrEoG,GAAUt3C,IAAIkwC,GAAIqH,KAClBA,GAAgB,IAAIrI,IAEtBwE,OAAQ,WACN,IAAIiE,EAAOL,GAAY,EAEvB,OADAA,GAAY,IAAIpI,GACTyI,aAIFF,KACPD,GAAajR,MAAQqR,YAGdA,GAAiBnrC,EAAGC,GAC3B8qC,GAAajR,MAAQsR,GACrBZ,GAAME,GAAO1qC,EAAGyqC,GAAME,GAAO1qC,WAGtBmrC,GAAYprC,EAAGC,GACtB6qC,GAAcv3C,IAAIo3C,GAAO3qC,EAAI0qC,GAAOzqC,GACpCyqC,GAAO1qC,EAAG2qC,GAAO1qC,WAGVgrC,KACPG,GAAYZ,GAAKC,IAGnB,IAAIY,GAAOvvB,EAAAA,EACPwvB,GAAOD,GACPE,IAAMF,GACNG,GAAKD,GAELE,GAAiB,CACnB3R,eAYqB95B,EAAGC,GACpBD,EAAIqrC,KAAMA,GAAOrrC,GACjBA,EAAIurC,KAAIA,GAAKvrC,GACbC,EAAIqrC,KAAMA,GAAOrrC,GACjBA,EAAIurC,KAAIA,GAAKvrC,IAfjB+lC,UAAWvB,GACXwB,QAASxB,GACTyB,aAAczB,GACd0B,WAAY1B,GACZwC,OAAQ,WACN,IAAIyE,EAAS,CAAC,CAACL,GAAMC,IAAO,CAACC,GAAIC,KAEjC,OADAD,GAAKC,KAAOF,GAAOD,GAAOvvB,EAAAA,GACnB4vB,IAaX,IASIC,GACAC,GACAC,GACAC,GAZAC,GAAO,EACPC,GAAO,EACPC,GAAO,EACPC,GAAO,EACPC,GAAO,EACPC,GAAO,EACPC,GAAO,EACPC,GAAO,EACPC,GAAO,EAMPC,GAAmB,CACrB1S,MAAO2S,GACPzG,UAAW0G,GACXzG,QAAS0G,GACTzG,aAAc,WACZsG,GAAiBxG,UAAY4G,GAC7BJ,GAAiBvG,QAAU4G,IAE7B1G,WAAY,WACVqG,GAAiB1S,MAAQ2S,GACzBD,GAAiBxG,UAAY0G,GAC7BF,GAAiBvG,QAAU0G,IAE7B1F,OAAQ,WACN,IAAI6F,EAAWP,GAAO,CAACF,GAAOE,GAAMD,GAAOC,IACrCH,GAAO,CAACF,GAAOE,GAAMD,GAAOC,IAC5BH,GAAO,CAACF,GAAOE,GAAMD,GAAOC,IAC5B,CAAC/B,IAAKA,KAIZ,OAHA6B,GAAOC,GAAOC,GACdC,GAAOC,GAAOC,GACdC,GAAOC,GAAOC,GAAO,EACdO,aAIFL,GAAgBzsC,EAAGC,GAC1B8rC,IAAQ/rC,EACRgsC,IAAQ/rC,IACNgsC,YAGKS,KACPF,GAAiB1S,MAAQiT,YAGlBA,GAAuB/sC,EAAGC,GACjCusC,GAAiB1S,MAAQkT,GACzBP,GAAgBZ,GAAO7rC,EAAG8rC,GAAO7rC,YAG1B+sC,GAAkBhtC,EAAGC,GAC5B,IAAI4G,EAAK7G,EAAI6rC,GAAM/kC,EAAK7G,EAAI6rC,GAAMvlB,EAAI4d,GAAKt9B,EAAKA,EAAKC,EAAKA,GAC1DolC,IAAQ3lB,GAAKslB,GAAO7rC,GAAK,EACzBmsC,IAAQ5lB,GAAKulB,GAAO7rC,GAAK,EACzBmsC,IAAQ7lB,EACRkmB,GAAgBZ,GAAO7rC,EAAG8rC,GAAO7rC,YAG1B0sC,KACPH,GAAiB1S,MAAQ2S,YAGlBG,KACPJ,GAAiB1S,MAAQmT,YAGlBJ,KACPK,GAAkBvB,GAAOC,aAGlBqB,GAAuBjtC,EAAGC,GACjCusC,GAAiB1S,MAAQoT,GACzBT,GAAgBd,GAAQE,GAAO7rC,EAAG4rC,GAAQE,GAAO7rC,YAG1CitC,GAAkBltC,EAAGC,GAC5B,IAAI4G,EAAK7G,EAAI6rC,GACT/kC,EAAK7G,EAAI6rC,GACTvlB,EAAI4d,GAAKt9B,EAAKA,EAAKC,EAAKA,GAE5BolC,IAAQ3lB,GAAKslB,GAAO7rC,GAAK,EACzBmsC,IAAQ5lB,GAAKulB,GAAO7rC,GAAK,EACzBmsC,IAAQ7lB,EAGR8lB,KADA9lB,EAAIulB,GAAO9rC,EAAI6rC,GAAO5rC,IACT4rC,GAAO7rC,GACpBssC,IAAQ/lB,GAAKulB,GAAO7rC,GACpBssC,IAAY,EAAJhmB,EACRkmB,GAAgBZ,GAAO7rC,EAAG8rC,GAAO7rC,YAG1BktC,GAAYj3C,GACnBpE,KAAKs7C,SAAWl3C,EAGlBi3C,GAAY1xC,UAAY,CACtB4xC,QAAS,IACTC,YAAa,SAAS/Z,GACpB,OAAOzhC,KAAKu7C,QAAU9Z,EAAGzhC,MAE3Bo0C,aAAc,WACZp0C,KAAKy7C,MAAQ,GAEfpH,WAAY,WACVr0C,KAAKy7C,MAAQrD,KAEflE,UAAW,WACTl0C,KAAK07C,OAAS,GAEhBvH,QAAS,WACY,IAAfn0C,KAAKy7C,OAAaz7C,KAAKs7C,SAASjsC,YACpCrP,KAAK07C,OAAStD,KAEhBpQ,MAAO,SAAS95B,EAAGC,GACjB,OAAQnO,KAAK07C,QACX,KAAK,EACH17C,KAAKs7C,SAASlsC,OAAOlB,EAAGC,GACxBnO,KAAK07C,OAAS,EACd,MAEF,KAAK,EACH17C,KAAKs7C,SAAShsC,OAAOpB,EAAGC,GACxB,cAGAnO,KAAKs7C,SAASlsC,OAAOlB,EAAIlO,KAAKu7C,QAASptC,GACvCnO,KAAKs7C,SAAS3pC,IAAIzD,EAAGC,EAAGnO,KAAKu7C,QAAS,EAAG9J,MAK/C0D,OAAQxC,IAGV,IACIgJ,GACAC,GACAC,GACAC,GACAC,GALAC,GAAc,IAAIrL,GAOlBsL,GAAiB,CACnBjU,MAAO2K,GACPuB,UAAW,WACT+H,GAAejU,MAAQkU,IAEzB/H,QAAS,WACHwH,IAAYQ,GAAcP,GAAOC,IACrCI,GAAejU,MAAQ2K,IAEzByB,aAAc,WACZuH,IAAa,GAEftH,WAAY,WACVsH,GAAa,MAEfxG,OAAQ,WACN,IAAIiH,GAAUJ,GAEd,OADAA,GAAc,IAAIrL,GACXyL,aAIFF,GAAmBhuC,EAAGC,GAC7B8tC,GAAejU,MAAQmU,GACvBP,GAAQE,GAAO5tC,EAAG2tC,GAAQE,GAAO5tC,WAG1BguC,GAAcjuC,EAAGC,GACxB2tC,IAAQ5tC,EAAG6tC,IAAQ5tC,EACnB6tC,GAAYv6C,IAAI4wC,GAAKyJ,GAAOA,GAAOC,GAAOA,KAC1CD,GAAO5tC,EAAG6tC,GAAO5tC,WAGVkuC,KACPr8C,KAAKs8C,QAAU,YAoDRC,GAAS/rC,GAChB,MAAO,MAAQA,EACT,IAAMA,EAAS,IAAMA,EAAS,aAAc,EAAKA,EACjD,IAAMA,EAAS,IAAMA,EAAS,YAAc,EAAIA,EAChD,aA8DCgsC,GAAYC,GACnB,OAAO,SAAS3J,GACd,IAAIluB,EAAI,IAAI83B,GACZ,IAAK,IAAI9wC,KAAO6wC,EAAS73B,EAAEhZ,GAAO6wC,EAAQ7wC,GAE1C,OADAgZ,EAAEkuB,OAASA,EACJluB,YAIF83B,MA5HTL,GAAW1yC,UAAY,CACrB4xC,QAAS,IACToB,QAASJ,GAAS,KAClBf,YAAa,SAAS/Z,GAEpB,OADKA,GAAKA,KAAOzhC,KAAKu7C,UAASv7C,KAAKu7C,QAAU9Z,EAAGzhC,KAAK28C,QAAU,MACzD38C,MAETo0C,aAAc,WACZp0C,KAAKy7C,MAAQ,GAEfpH,WAAY,WACVr0C,KAAKy7C,MAAQrD,KAEflE,UAAW,WACTl0C,KAAK07C,OAAS,GAEhBvH,QAAS,WACY,IAAfn0C,KAAKy7C,OAAaz7C,KAAKs8C,QAAQ97C,KAAK,KACxCR,KAAK07C,OAAStD,KAEhBpQ,MAAO,SAAS95B,EAAGC,GACjB,OAAQnO,KAAK07C,QACX,KAAK,EACH17C,KAAKs8C,QAAQ97C,KAAK,IAAK0N,EAAG,IAAKC,GAC/BnO,KAAK07C,OAAS,EACd,MAEF,KAAK,EACH17C,KAAKs8C,QAAQ97C,KAAK,IAAK0N,EAAG,IAAKC,GAC/B,cAGoB,MAAhBnO,KAAK28C,UAAiB38C,KAAK28C,QAAUJ,GAASv8C,KAAKu7C,UACvDv7C,KAAKs8C,QAAQ97C,KAAK,IAAK0N,EAAG,IAAKC,EAAGnO,KAAK28C,WAK7CxH,OAAQ,WACN,GAAIn1C,KAAKs8C,QAAQt6C,OAAQ,CACvB,IAAImzC,EAASn1C,KAAKs8C,QAAQM,KAAK,IAE/B,OADA58C,KAAKs8C,QAAU,GACRnH,EAEP,OAAO,OAkFbuH,GAAgB/yC,UAAY,CAC1Bg4B,YAAa+a,GACb1U,MAAO,SAAS95B,EAAGC,GAAKnO,KAAK8yC,OAAO9K,MAAM95B,EAAGC,IAC7CmlC,OAAQ,WAAatzC,KAAK8yC,OAAOQ,UACjCY,UAAW,WAAal0C,KAAK8yC,OAAOoB,aACpCC,QAAS,WAAan0C,KAAK8yC,OAAOqB,WAClCC,aAAc,WAAap0C,KAAK8yC,OAAOsB,gBACvCC,WAAY,WAAar0C,KAAK8yC,OAAOuB,eAiDlBrC,GAAI,GAAKN,IAkGP8K,GAAY,CACjCxU,MAAO,SAAS95B,EAAGC,GACjBnO,KAAK8yC,OAAO9K,MAAM95B,EAAIwjC,GAASvjC,EAAIujC,gBAkV9BmL,GAAaz3C,GACpB,OAAO,SAAS8I,EAAGC,GACjB,IAAIK,EAAKwjC,GAAI9jC,GACTwE,EAAKs/B,GAAI7jC,GACT8X,EAAI7gB,EAAMoJ,EAAKkE,GACf,OAAIuT,IAAM+D,EAAAA,EAAiB,CAAC,EAAG,GAC5B,CACL/D,EAAIvT,EAAKy/B,GAAIjkC,GACb+X,EAAIksB,GAAIhkC,cAKL2uC,GAAgBzuC,GACvB,OAAO,SAASH,EAAGC,GACjB,IAAIsmB,EAAI4d,GAAKnkC,EAAIA,EAAIC,EAAIA,GACrBxM,EAAI0M,EAAMomB,GACVsoB,EAAK5K,GAAIxwC,GACTq7C,EAAKhL,GAAIrwC,GACb,MAAO,CACLmwC,GAAM5jC,EAAI6uC,EAAItoB,EAAIuoB,GAClBvK,GAAKhe,GAAKtmB,EAAI4uC,EAAKtoB,KAKzB,IAAIwoB,GAAwBJ,IAAa,SAASK,GAChD,OAAO7K,GAAK,GAAK,EAAI6K,OAGvBD,GAAsB9E,OAAS2E,IAAgB,SAASroB,GACtD,OAAO,EAAIge,GAAKhe,EAAI,MAStB,IAAI0oB,GAA0BN,IAAa,SAASl7C,GAClD,OAAQA,EAAI6wC,GAAK7wC,KAAOA,EAAIwwC,GAAIxwC,eAazBy7C,GAAY3I,EAAQC,GAC3B,MAAO,CAACD,EAAQvC,GAAII,IAAKf,GAASmD,GAAO,cAmFlC2I,GAAmB5I,EAAQC,GAClC,MAAO,CAACD,EAAQC,GA/FlByI,GAAwBhF,OAAS2E,IAAgB,SAASroB,GACxD,OAAOA,KAaT2oB,GAAYjF,OAAS,SAASjqC,EAAGC,GAC/B,MAAO,CAACD,EAAG,EAAI0jC,GAAKK,GAAI9jC,IAAMojC,KAmFhC8L,GAAmBlF,OAASkF,GAoC5B,IAAIC,GAAK,SACLC,IAAK,QACLC,GAAK,OACLC,GAAK,QACLC,GAAIrL,GAAK,GAAK,WAGTsL,GAAclJ,EAAQC,GAC7B,IAAIlf,EAAIid,GAAKiL,GAAIvL,GAAIuC,IAAO3e,EAAKP,EAAIA,EAAGooB,EAAK7nB,EAAKA,EAAKA,EACvD,MAAO,CACL0e,EAASzC,GAAIxc,IAAMkoB,IAAKJ,IAAK,mBAASvnB,EAAK6nB,GAAM,qBAAS,QAAS7nB,KACnEP,GAAK8nB,GAAKC,GAAKxnB,EAAK6nB,GAAMJ,GAAKC,GAAK1nB,cAuB/B8nB,GAAY3vC,EAAGC,GACtB,IAAIuE,EAAKs/B,GAAI7jC,GAAI8X,EAAI+rB,GAAI9jC,GAAKwE,EAC9B,MAAO,CAACA,EAAKy/B,GAAIjkC,GAAK+X,EAAGksB,GAAIhkC,GAAK8X,YA2F3B63B,GAAiBrJ,EAAQC,GAChC,IAAIqJ,EAAOrJ,EAAMA,EAAKsJ,EAAOD,EAAOA,EACpC,MAAO,CACLtJ,GAAU,MAAS,QAAWsJ,EAAOC,GAAoBA,GAAQ,QAAWD,EAAO,QAAWC,GAAjD,UAC7CtJ,GAAO,SAAWqJ,GAAQ,QAAWC,GAAoB,QAAWD,EAAvB,QAA8B,QAAWC,eAsBjFC,GAAgB/vC,EAAGC,GAC1B,MAAO,CAAC6jC,GAAI7jC,GAAKgkC,GAAIjkC,GAAIikC,GAAIhkC,aAWtB+vC,GAAiBhwC,EAAGC,GAC3B,IAAIuE,EAAKs/B,GAAI7jC,GAAI8X,EAAI,EAAI+rB,GAAI9jC,GAAKwE,EAClC,MAAO,CAACA,EAAKy/B,GAAIjkC,GAAK+X,EAAGksB,GAAIhkC,GAAK8X,YAa3Bk4B,GAAsB1J,EAAQC,GACrC,MAAO,CAACxC,GAAII,IAAKf,GAASmD,GAAO,KAAMD,eCtgGE9I,EAAcC,EAAoB/1B,EAAQrU,EAAS4c,GAC1F,MAAM7c,EAAOvB,MAMNof,WAACA,GAAehB,EAAIiB,SAGrB0sB,EAAgC,IAAf3sB,EAAoB4sB,GAAgBC,GAC3DN,EAAahtB,aAAasO,GAAe,IAAI8e,EAAc9e,EAAYpX,KACvE+1B,EAAmBjtB,aAAasO,GAAe,IAAI8e,EAAc9e,EAAYpX,KAE7EtU,EAAK0d,OAAS,SAAUitB,GACpB,MAAOC,cAACA,EAAarQ,OAAEA,GAAWoQ,EAE9BC,GACA5qC,EAAKirC,aAAa1Q,IAI1Bv6B,EAAKgd,OAAM,KAEPhd,EAAKorC,aAELhB,EAAaptB,SACbqtB,EAAmBrtB,UAIvB,IAAI6/B,EACJ78C,EAAKirC,aAAe,SAAU1Q,GAC1B,MAAMuiB,EAAMviB,EAAO95B,OAAS,IACtBmuC,EAAatiB,GAJH,IAIsBxR,KAAKnO,GAAMA,EAAImwC,IAC/C/hC,aFwXZ,IAAIpO,EAAIsiC,GACJriC,EAAIsiC,GACJt9B,EAASu9B,GACT37B,EAAK,IACLC,EAAK,IACL5K,EAAI,GACJ6b,EAAI,EACJzb,EAAQ,EAAJJ,EACJvI,EAAKkT,EAAS,EAAJvK,GAAUyb,EACpBC,EAAKlR,EAAS,EAAJxK,GAAUyb,EACpB6oB,EAAYZ,GAAS,aAEhBoQ,EAAQC,GACf,IAAIC,EAAU,IAAItrB,aAAarxB,EAAIqkB,GAC/Bu4B,EAAU,IAAIvrB,aAAarxB,EAAIqkB,GAC/Bw4B,EAAQz5C,KAAK0f,IAAI,GAAIsB,GAEzBs4B,EAAK39C,SAAQ,SAAS+N,EAAG5H,EAAGiM,GAC1B,IAAI2vB,GAAMz0B,EAAES,EAAG5H,EAAGiM,GAAQxI,GAAKk0C,EAC3B9b,GAAMz0B,EAAEQ,EAAG5H,EAAGiM,GAAQxI,GAAKk0C,EAC3BC,GAAMxrC,EAAOxE,EAAG5H,EAAGiM,GACvB,GAAI2vB,GAAM,GAAKA,EAAK9gC,GAAK+gC,GAAM,GAAKA,EAAK1c,EAAG,CAC1C,IAAIzV,EAAKxL,KAAKuC,MAAMm7B,GAChBjyB,EAAKzL,KAAKuC,MAAMo7B,GAChBoN,EAAKrN,EAAKlyB,EAAK,GACfw/B,EAAKrN,EAAKlyB,EAAK,GACnB8tC,EAAQ/tC,EAAKC,EAAK7O,KAAO,EAAImuC,IAAO,EAAIC,GAAM0O,EAC9CH,EAAQ/tC,EAAK,EAAIC,EAAK7O,IAAMmuC,GAAM,EAAIC,GAAM0O,EAC5CH,EAAQ/tC,EAAK,GAAKC,EAAK,GAAK7O,IAAMmuC,EAAKC,EAAK0O,EAC5CH,EAAQ/tC,GAAMC,EAAK,GAAK7O,KAAO,EAAImuC,GAAMC,EAAK0O,MAKlDvO,GAAM,CAACntC,MAAOpB,EAAGqB,OAAQgjB,EAAGlT,KAAMwrC,GAAU,CAACv7C,MAAOpB,EAAGqB,OAAQgjB,EAAGlT,KAAMyrC,GAAUr0C,GAAK6b,GACvFsqB,GAAM,CAACttC,MAAOpB,EAAGqB,OAAQgjB,EAAGlT,KAAMyrC,GAAU,CAACx7C,MAAOpB,EAAGqB,OAAQgjB,EAAGlT,KAAMwrC,GAAUp0C,GAAK6b,GACvFmqB,GAAM,CAACntC,MAAOpB,EAAGqB,OAAQgjB,EAAGlT,KAAMwrC,GAAU,CAACv7C,MAAOpB,EAAGqB,OAAQgjB,EAAGlT,KAAMyrC,GAAUr0C,GAAK6b,GACvFsqB,GAAM,CAACttC,MAAOpB,EAAGqB,OAAQgjB,EAAGlT,KAAMyrC,GAAU,CAACx7C,MAAOpB,EAAGqB,OAAQgjB,EAAGlT,KAAMwrC,GAAUp0C,GAAK6b,GACvFmqB,GAAM,CAACntC,MAAOpB,EAAGqB,OAAQgjB,EAAGlT,KAAMwrC,GAAU,CAACv7C,MAAOpB,EAAGqB,OAAQgjB,EAAGlT,KAAMyrC,GAAUr0C,GAAK6b,GACvFsqB,GAAM,CAACttC,MAAOpB,EAAGqB,OAAQgjB,EAAGlT,KAAMyrC,GAAU,CAACx7C,MAAOpB,EAAGqB,OAAQgjB,EAAGlT,KAAMwrC,GAAUp0C,GAAK6b,GAEvF,IAAIgpB,EAAKH,EAAU0P,GAGnB,IAAKjpC,MAAMiU,QAAQylB,GAAK,CACtB,IAAIjlC,WA1WG4jC,EAAQC,GACnB,IAAI71B,EACJ,QAAgBnN,IAAZgjC,EACF,IAAK,MAAMxtC,KAASutC,EACL,MAATvtC,IACI2X,EAAM3X,QAAkBwK,IAARmN,GAAqB3X,GAASA,KACpD2X,EAAM3X,OAGL,CACL,IAAImjC,GAAQ,EACZ,IAAK,IAAInjC,KAASutC,EACiC,OAA5CvtC,EAAQwtC,EAAQxtC,IAASmjC,EAAOoK,MAC7B51B,EAAM3X,QAAkBwK,IAARmN,GAAqB3X,GAASA,KACpD2X,EAAM3X,GAIZ,OAAO2X,EAwVQ4mC,CAAIJ,GACfvP,EAAKzB,GAAS,EAAGxjC,EAAMilC,IACvBA,EAAKrC,GAAM,EAAG3nC,KAAKuC,MAAMwC,EAAOilC,GAAMA,EAAIA,IACvCiG,QAGL,OAAOrG,KACFsB,WAAWlB,GACXh8B,KAAK,CAACpR,EAAGqkB,GAFP2oB,CAGJ2P,GACEniC,IAAIpO,YAGFA,EAAU4kC,GAGjB,OAFAA,EAASxyC,OAAS4E,KAAK0f,IAAI,GAAG,EAAKsB,GACnC4sB,EAAS9C,YAAYnvC,QAAQi+C,GACtBhM,WAGAgM,EAAiB9O,GACxBA,EAAYnvC,QAAQk+C,YAGbA,EAAc/O,GACrBA,EAAYnvC,QAAQm+C,YAIbA,EAAehP,GACtBA,EAAY,GAAKA,EAAY,GAAK9qC,KAAK0f,IAAI,EAAGsB,GAAKzb,EACnDulC,EAAY,GAAKA,EAAY,GAAK9qC,KAAK0f,IAAI,EAAGsB,GAAKzb,WAG5Cw0C,IAIP,OAFAn9C,EAAKkT,EAAS,GADdvK,EAAQ,EAAJJ,IACgB6b,EACpBC,EAAKlR,EAAS,EAAJxK,GAAUyb,EACbq4B,EAsCT,OAnCAA,EAAQpwC,EAAI,SAASuzB,GACnB,OAAO92B,UAAU3I,QAAUkM,EAAiB,mBAANuzB,EAAmBA,EAAIyM,IAAUzM,GAAI6c,GAAWpwC,GAGxFowC,EAAQnwC,EAAI,SAASszB,GACnB,OAAO92B,UAAU3I,QAAUmM,EAAiB,mBAANszB,EAAmBA,EAAIyM,IAAUzM,GAAI6c,GAAWnwC,GAGxFmwC,EAAQnrC,OAAS,SAASsuB,GACxB,OAAO92B,UAAU3I,QAAUmR,EAAsB,mBAANsuB,EAAmBA,EAAIyM,IAAUzM,GAAI6c,GAAWnrC,GAG7FmrC,EAAQrrC,KAAO,SAASwuB,GACtB,IAAK92B,UAAU3I,OAAQ,MAAO,CAAC+S,EAAIC,GACnC,IAAI4lB,GAAM6G,EAAE,GAAIyO,GAAMzO,EAAE,GACxB,KAAM7G,GAAM,GAAKsV,GAAM,GAAI,MAAM,IAAI5oC,MAAM,gBAC3C,OAAOyN,EAAK6lB,EAAI5lB,EAAKk7B,EAAI8O,KAG3BV,EAAQW,SAAW,SAASxd,GAC1B,IAAK92B,UAAU3I,OAAQ,OAAO,GAAKikB,EACnC,MAAOwb,GAAKA,IAAM,GAAI,MAAM,IAAIn6B,MAAM,qBACtC,OAAO2e,EAAIhhB,KAAKuC,MAAMvC,KAAK0Y,IAAI8jB,GAAKx8B,KAAK8oC,KAAMiR,KAGjDV,EAAQnO,WAAa,SAAS1O,GAC5B,OAAO92B,UAAU3I,QAAU8sC,EAAyB,mBAANrN,EAAmBA,EAAIlsB,MAAMiU,QAAQiY,GAAKyM,GAASF,GAAMv4B,KAAKgsB,IAAMyM,GAASzM,GAAI6c,GAAWxP,GAG5IwP,EAAQY,UAAY,SAASzd,GAC3B,IAAK92B,UAAU3I,OAAQ,OAAOiD,KAAKiL,KAAK9F,GAAKA,EAAI,IACjD,MAAOq3B,GAAKA,IAAM,GAAI,MAAM,IAAIn6B,MAAM,qBACtC,OAAO8C,EAAInF,KAAKC,OAAOD,KAAKiL,KAAK,EAAIuxB,EAAIA,EAAI,GAAK,GAAK,GAAIud,KAGtDV,EEhfUA,GACNpwC,GAAGS,GAAMA,EAAET,IACXC,GAAGQ,GAAMA,EAAER,IACX+wC,UAAU,IACV/O,WAAWA,GAChBiO,EAAc9hC,EAAGwf,IAGrBv6B,EAAKorC,WAAU,KACX,MAAOppC,IAACA,GAAQsS,EACVspC,WD8jECC,EAAYh7C,GACzB,IACIi7C,EACAC,EAFA9D,EAAc,aAIT1sC,EAAKgM,GAKZ,OAJIA,IACyB,mBAAhB0gC,GAA4B8D,EAAc9D,aAAaA,EAAY3yC,MAAM7I,KAAM2K,YAC1F2pC,GAAUx5B,EAAQukC,EAAiBC,KAE9BA,EAAcnK,SAwCvB,OArCArmC,EAAK+gC,KAAO,SAAS/0B,GAEnB,OADAw5B,GAAUx5B,EAAQukC,EAAiBpG,KAC5BA,GAAa9D,UAGtBrmC,EAAKywC,QAAU,SAASzkC,GAEtB,OADAw5B,GAAUx5B,EAAQukC,EAAiBpD,KAC5BA,GAAe9G,UAGxBrmC,EAAK+3B,OAAS,SAAS/rB,GAErB,OADAw5B,GAAUx5B,EAAQukC,EAAiB1F,KAC5BA,GAAexE,UAGxBrmC,EAAK0wC,SAAW,SAAS1kC,GAEvB,OADAw5B,GAAUx5B,EAAQukC,EAAiB3E,KAC5BA,GAAiBvF,UAG1BrmC,EAAK2wC,WAAa,SAAShe,GACzB,OAAO92B,UAAU3I,QAAUq9C,EAAwB,MAAL5d,GAAa2d,EAAa,KAAMtG,KAAasG,EAAa3d,GAAGqR,OAAQhkC,GAAQswC,GAG7HtwC,EAAK1K,QAAU,SAASq9B,GACtB,OAAK92B,UAAU3I,QACfs9C,EAAqB,MAAL7d,GAAar9B,EAAU,KAAM,IAAIi4C,IAAc,IAAIhB,GAAYj3C,EAAUq9B,GAC9D,mBAAhB+Z,GAA4B8D,EAAc9D,YAAYA,GAC1D1sC,GAHuB1K,GAMhC0K,EAAK0sC,YAAc,SAAS/Z,GAC1B,OAAK92B,UAAU3I,QACfw5C,EAA2B,mBAAN/Z,EAAmBA,GAAK6d,EAAc9D,aAAa/Z,IAAKA,GACtE3yB,GAFuB0sC,GAKzB1sC,EAAK2wC,WAAWL,GAAYh7C,QAAQA,GChnE1Bs7C,GACNt7C,QAAQb,GAEbA,EAAIiK,OAEJjK,EAAI2F,UAAY,GAChB3F,EAAImF,YAAc,OAClB,MACM6nB,EAAK6tB,EAAYp8C,OACvB,IAAK,IAAI+E,EAAI,EAAGA,EAAIwpB,EAAIxpB,IAAK,CACzB,MAAM44C,EAAK,IAAO,GAAD54C,EACjBxD,EAAIuF,UAAS,QAAW62C,KAAMA,KAAMA,QACpCp8C,EAAIsL,YACJswC,EAAGf,EAAYr3C,IAEfxD,EAAIsO,OAERtO,EAAIoK,uBCtDsBkI,EAAQ+pC,EAAMp+C,EAASq+C,EAAgBC,EAAmB1hC,GACxF,MAAM7c,EAAOvB,KAEb+/C,GAAQtqC,KAAKlU,EAAMsU,EAAQrU,EAAS4c,GAIpC,MAAMwtB,EAAqB,IAAIoU,EAAmB5hC,EAAK5c,GACjDmqC,EAAe,IAAIxB,GAAa/rB,GAChC6hC,EAAe,IAAIC,GAAarqC,EAAQuI,EAAK5c,GAenD,IAAI2+C,EACAC,EACAC,EAfJ9+C,EAAK++C,4BAA+BzhC,IAChC+sB,EAAmBptB,aAAa,IAAI+hC,GAAe1hC,EAAOtd,EAAKorB,MAAO9W,KAG1EtU,EAAKi/C,kBAAqBvzB,IACtBgzB,EAAanzB,YAAY,IAAI2zB,GAASxzB,EAAY1rB,EAAKorB,MAAO9W,IAC9D81B,EAAa7e,YAAY,IAAI2zB,GAASxzB,EAAY1rB,EAAKorB,MAAO9W,KAGlErU,EAAQC,IAAI,CAAC,cAsBb,MAAMi/C,EAAan/C,EAAK8wB,MACxB9wB,EAAK8wB,MAAK,KACNquB,IACAtiC,EAAIuiC,eAAeC,YAAYC,kBAjB/BV,EAAa/hC,EAAI0iC,IAAOb,EAAetU,EAEvCyU,EAAoBhiC,EAAI0iC,IAAOhB,EAAoBD,EAEnD,MACMkB,EAAgD,IAA5B3iC,EAAIiB,SAASD,WACjC4hC,GACAC,GAENZ,EAAY,IADyBU,EACNZ,EAAWvU,EAAoB/1B,EAAQrU,EAAS4c,GAS/E8iC,GACAf,EAAUzgC,WACVksB,EAAmBlsB,YAGvBne,EAAK+wB,KAAI,KACLlU,EAAIuiC,eAAeC,YAAYO,QAGnC5/C,EAAK0d,OAAM,KAKPkhC,EAAUlhC,SACV2sB,EAAmB3sB,SACnB,MAAOG,WAACA,GAAehB,EAAIiB,SACrB6sB,EAAYkU,EACbnhC,OAAOkhC,EAAWvU,EAAoBpqC,EAAS4d,GACpDihC,EAAUphC,OAAOitB,GACjB1qC,EAAQS,QAER,MAAOkqC,cAACA,GAAkBD,EACtBC,IACAt2B,EAAO5T,QACPV,EAAKgd,WAIbhd,EAAKgd,OAAM,KACP8hC,EAAU9hC,UAEdhd,EAAKqe,iBAAgB,KACjBugC,EAAUvgC,mBACVgsB,EAAmBhsB,kCCjGvB,MAAMre,EAAOvB,KAEPohD,EAAW,GACjB,IAAIC,EAAS,EAEb9/C,EAAK+/C,IAAM,SAAUl5C,GACjBg5C,EAAS5gD,KAAK4H,GACd,MAAMkE,EAAK+0C,EAEX,OADAA,GAAU,EACH/0C,GAEX/K,EAAKggD,IAAG,IAASF,EACjB9/C,EAAKigD,IAAOl1C,GAAO80C,EAAS90C,eCnBWT,EAASs1C,GAChD,MAGMM,EAAwBzxB,IAC1B,IAAKnkB,EAAQy5B,SAAStV,EAAMC,WAJbyxB,EAIkC71C,KAH3C61C,EAAKC,aAAeD,EAAKE,cAAgBF,EAAKG,iBAAiB7/C,SAGV,CAEvCm/C,KAEHW,IARN,IAAIJ,GAYbI,EAAmB,KACrB1+C,SAAS2+C,oBAAoB,YAAaN,GAC1Cr+C,SAAS2+C,oBAAoB,aAAcN,IAG/Cr+C,SAASiD,iBAAiB,YAAao7C,GACvCr+C,SAASiD,iBAAiB,aAAco7C,eCjBTr5C,EAAQyN,GACvC,MAAMmsC,EAAM5+C,SAASC,cAAc,gBAK1B4b,IACD7W,EAAO8F,EAAmB,GAAf2H,EAAO5S,OAClB++C,EAAIl9C,MAAM+O,MAAWgC,EAAO5S,MAAQmF,EAAO8F,EAA5B,KACf8zC,EAAIl9C,MAAM8O,KAAO,UAEjBouC,EAAIl9C,MAAM8O,KAAI,GAAMxL,EAAO8F,MAC3B8zC,EAAIl9C,MAAM+O,MAAQ,SAEtBmuC,EAAIl9C,MAAMiD,IAAG,GAAMK,EAAO+F,MAX9B6zC,EAAI/rC,UAAY,aAChB+rC,EAAIl9C,MAAMm9C,SAAW,WAYrBhjC,IAGA+iC,EAAIl9C,MAAMo9C,OAAS,kBACnBF,EAAIl9C,MAAMq9C,QAAU,MACpBH,EAAIl9C,MAAMs9C,WAAa,QAEvB,IAAIC,GAAS,YAoBOL,GARR,KAEPK,IACDL,EAAOv8B,UACV,MAI6Bu8B,IAAAA,EACjC/iC,OAAAA,SAZyB3U,IAClB+3C,EAA6B/3C,gBCjCIlC,EAAQyN,EAAQuI,GAGrD,MAAMkkC,EAAOC,GAAWn6C,EAAQyN,IACzBmsC,IAACA,GAAQM,EAEhBN,EAAI9rC,UAAY,iBAIhB,MAAMhO,EAAQ,GAEdA,EAAM4W,OAAS,IAAI0jC,GACf,WACA,SACA,YACCC,GAAQr6C,EAAOs6C,KAAKD,EAAM,EAAI,IACb,IAAlBr6C,EAAO0W,QAEXkjC,EAAIh+C,YAAYkE,EAAM4W,OAAO6jC,KACG,IAA5BvkC,EAAIiB,SAASD,YACThX,EAAOmU,OAAOzZ,IACdoF,EAAMkuB,GAAK,IAAIosB,GACX,QACA,QACA,WACCC,GAAQr6C,EAAOw6C,MAAMH,IACtBr6C,EAAOmU,OAAOzZ,GAElBk/C,EAAIh+C,YAAYkE,EAAMkuB,GAAGusB,MAEzBv6C,EAAOmU,OAAOY,iBACdjV,EAAM26C,gBAAkB,IAAIL,GACxB,SACA,kBACA,qBACCC,GAAQr6C,EAAO06C,mBAAmBL,IACnCr6C,EAAOmU,OAAOY,eACd,CAAC,OAAQ,aAEb6kC,EAAIh+C,YAAYkE,EAAM26C,gBAAgBF,OAEnCv6C,EAAOyV,OAAO/a,IACrBoF,EAAMmuB,GAAK,IAAImsB,GACX,QACA,QACA,WACCC,GAAQr6C,EAAO26C,MAAMN,IACtBr6C,EAAOyV,OAAO/a,GAElBk/C,EAAIh+C,YAAYkE,EAAMmuB,GAAGssB,WAEL93C,IAApBzC,EAAO46C,WACP96C,EAAM4B,MAAQ,IAAI04C,GACd,QACA,QACA,WACCC,GAAQr6C,EAAO46C,SAASP,IACzBr6C,EAAO0B,OAEXk4C,EAAIh+C,YAAYkE,EAAM4B,MAAM64C,MAEhCz6C,EAAM2X,WAAa,IAAI2iC,GACnB,WACA,cACA,iBACCC,GAAQrkC,EAAI6kC,2BAA2BR,IACxCrkC,EAAIyB,YAERmiC,EAAIh+C,YAAYkE,EAAM2X,WAAW8iC,KAIjC9sC,EAAOpS,SAASO,YAAYg+C,YAGvBQ,GAAKv2C,EAAM2L,EAAMnE,EAAMyvC,EAAUC,EAAcC,GACpD,MAAM7hD,EAAOvB,KAIb,GAFAuB,EAAKohD,IAAMv/C,SAASC,cAAc,OAErB,WAAT4I,EAAmB,CACnB1K,EAAK+mC,MAAQllC,SAASC,cAAc,UACpC,IAAK,IAAI0D,EAAI,EAAGA,EAAIq8C,EAAQphD,OAAQ+E,IAAK,CACrC,MAAMs8C,EAASjgD,SAASC,cAAc,UACtCggD,EAAOhjD,MAAQ+iD,EAAQr8C,GACvBs8C,EAAOntC,UAAYktC,EAAQr8C,GAC3BxF,EAAK+mC,MAAMtkC,YAAYq/C,GAE3B9hD,EAAK+mC,MAAMjoC,MAAQ8iD,EACnB5hD,EAAK+mC,MAAMjiC,iBAAiB,SAAO,IAAQ68C,EAAS3hD,EAAK+mC,MAAMjoC,cAE/DkB,EAAK+mC,MAAQllC,SAASC,cAAc,SACpC9B,EAAK+mC,MAAMr8B,KAAOA,EAClB1K,EAAK+mC,MAAMh8B,GAAKsL,EAChBrW,EAAK+mC,MAAM1wB,KAAOA,EACL,aAAT3L,GACIk3C,IACA5hD,EAAK+mC,MAAMgb,SAAU,GAEzB/hD,EAAK+mC,MAAMjiC,iBAAiB,UAAQ,IAAQ68C,EAAS3hD,EAAK+mC,MAAMgb,YAChD,UAATr3C,GACP1K,EAAK+mC,MAAMnZ,IAAM,EACjB5tB,EAAK+mC,MAAMtwB,IAAM,IACjBzW,EAAK+mC,MAAMjoC,MAAQ8iD,EACnB5hD,EAAK+mC,MAAMuE,KAAO,EAClBtrC,EAAK+mC,MAAMjiC,iBAAiB,SAAO,IAAQ68C,EAAS3hD,EAAK+mC,MAAMjoC,UAC/C,UAAT4L,IACP1K,EAAK+mC,MAAMjoC,MAAQ8iD,EACnB5hD,EAAK+mC,MAAMjiC,iBAAiB,SAAO,IAAQ68C,EAAS3hD,EAAK+mC,MAAMjoC,UAGvEkB,EAAKqX,MAAQxV,SAASC,cAAc,SACpC9B,EAAKqX,MAAM2qC,IAAM3rC,EACjBrW,EAAKqX,MAAM1C,UAAYzC,EACvBlS,EAAKqX,MAAM9T,MAAM,gBAAkB,MACnCvD,EAAKohD,IAAI3+C,YAAYzC,EAAKqX,OAC1BrX,EAAKohD,IAAI3+C,YAAYzC,EAAK+mC,mBCtG1BzqB,EACAtB,EACA1G,EACA2tC,EACAjjD,EACAiB,EACAiiD,EACAC,EACAtlC,GAEA,MAAM7c,EAAOvB,KAEbuB,EAAKgb,OAAS,GACdhb,EAAKsc,OAAS,GAId,MAAMvR,EAAKk3C,EAAelC,IAAI//C,GAK9BA,EAAKoiD,YAAW,KACZ,MAAMC,EAAU,CAAE11C,EAAG2P,EAAO3P,EAAGC,EAAG0P,EAAO1P,GAEnCnN,EAAW,CACb0iD,EAAeG,kBAAkB/kC,OAAOpe,QAAQ4L,EAAI,EAAG,GACvDo3C,EAAeG,kBAAkBD,QAAQljD,QAAQ4L,EAAIs3C,EAASA,GAC9DF,EAAeG,kBAAkBC,QAAQpjD,QAAQ4L,EAAIiQ,EAAOrO,EAAGqO,EAAOrO,GACtEw1C,EAAeG,kBAAkBE,QAAQrjD,QAAQ4L,EAAIuR,EAAO/a,EAAG+a,EAAO/a,GACtE4gD,EAAeG,kBAAkBG,QAAQtjD,QAAQ4L,EAAIiQ,EAAOzZ,EAAGyZ,EAAOzZ,GACtE4gD,EAAeG,kBAAkBI,qBAAqBvjD,QAClD4L,EACAiQ,EAAOY,eACPZ,EAAOY,iBAKXsmC,EACAljD,EAAU2jD,aAAaljD,GAEvBT,EAAU4jD,WAAWnjD,IAI7BO,EAAK6iD,UAAY,GACjB7iD,EAAK6iD,UAAUtlC,OAAU5Y,IACrB3E,EAAKud,OAAS5Y,EACd1E,EAAQC,IAAI,CAAC,gBAEjBF,EAAKmhD,KAAQx8C,IACT,MAAMm+C,EAAMX,EAAeG,kBAAkB/kC,OAAOwlC,gBAAgBh4C,GACpEo3C,EAAeG,kBAAkB/kC,OAAO1D,GAAG9O,EAAIpG,EAAGm+C,IAGtD9iD,EAAK6iD,UAAUR,QAAWlnC,IACtBnb,EAAKsc,OAAO3P,EAAIwO,EAAExO,EAClB3M,EAAKsc,OAAO1P,EAAIuO,EAAEvO,EACc,IAA5BiQ,EAAIiB,SAASD,aACb7d,EAAK2M,EAAIwO,EAAExO,EACX3M,EAAK4M,EAAIuO,EAAEvO,GAEf3M,EAAQC,IAAI,CAAC,gBAEjBF,EAAK6iD,UAAUN,QAAWpnC,IACtBnb,EAAKgb,OAAOrO,EAAIwO,EACgB,IAA5B0B,EAAIiB,SAASD,aACb7d,EAAK2M,EAAIwO,EACTnb,EAAK4M,EAAI,KAEb3M,EAAQC,IAAI,CAAC,gBAEjBF,EAAKiwB,MAAS9U,IACV,GAAgC,IAA5B0B,EAAIiB,SAASD,WAAkB,CAC/B,MAAMilC,EAAMX,EAAeG,kBAAkBC,QAAQQ,gBAAgBh4C,GACrEo3C,EAAeG,kBAAkBC,QAAQ1oC,GAAG9O,EAAIoQ,EAAExO,EAAGm2C,OAClD,CACH,MAAMA,EAAMX,EAAeG,kBAAkBD,QAAQU,gBAAgBh4C,GACrEo3C,EAAeG,kBAAkBD,QAAQxoC,GAAG9O,EAAIoQ,EAAG2nC,KAOf9iD,EAAAme,SAAA,KAEZ,MAAxBL,SAAKD,WAAmB7d,EAAA6iD,UAAAN,QAAAviD,EAAAgb,OAAArO,GAAE3M,EAAE6iD,UAAaR,QAAA,CAAE11C,EAAG3M,EAAKsc,OAAO3P,EAAGC,EAAA5M,EAAAsc,OAAA1P,OAKjEi2C,UAAWL,QAASQ,IACpBhjD,EAAAsc,OAAY/a,EAACyhD,IAAO9iD,IAAA,CAAC,aAGrBshD,MAASwB,IACT,MAAAF,EAAAX,EAAeG,kBAA6BE,QAAQO,gBAAKh4C,GAC5Do3C,EAAAG,kBAAAE,QAAA3oC,GAAA9O,EAAAi4C,EAAAF,MAGGD,UAAWJ,QAASO,IACpBhjD,EAAAgb,OAAYzZ,EAACyhD,IAAO9iD,IAAA,CAAC,aAGrBmhD,MAAS2B,IACT,MAAAF,EAAAX,EAAeG,kBAA6BG,QAAQM,gBAAKh4C,GAC5Do3C,EAAAG,kBAAAG,QAAA5oC,GAAA9O,EAAAi4C,EAAAF,IAIkD9iD,EAAA6iD,UAAAH,qBAAAO,IAC/CjjD,EAAAgb,OAAYY,eAACqnC,IAAgB/iD,IAAA,CAAC,sBAG9BqhD,mBAAY0B,IACZ,MAAAH,EAAAX,EAAeG,kBAAkBI,qBAA4BK,gBAAoBh4C,GACpFo3C,EAAAG,kBAAAI,qBAAA7oC,GAAA9O,EAAAk4C,EAAAH,IAID9iD,EAA+BoiD,gBAK3Bc,MAAA,KACHC,GAAAnjD,EAAAsU,EAAAuI,IAKJ7c,EAAAuI,MAAA,wBC5IsC05C,EAAgBjjD,EAAWokD,GAC9D,MAAMpjD,EAAOvB,cAQJ4kD,EAAqBh5C,EAAKi5C,EAAWC,GAC1CvjD,EAAKsiD,kBAAkBj4C,GAAOrL,EAAUwkD,iBAAiB,CACrDrxC,OAAM,CAAGpH,EAAIpG,KACT3E,EAAKyjD,gBAAgB14C,EAAK,GACZk3C,EAAehC,IAAIl1C,GAC3B83C,UAAUx4C,GAAK1F,IAEzB0R,KAAI,UAAeitC,IACnBI,MAAO,SAAEH,KAVjBvjD,EAAKsiD,kBAAoB,GAazBe,EAAqB,SAAU,UAAU,GACzCA,EAAqB,UAAW,iBAAiB,GACjDA,EAAqB,UAAW,aAAa,GAC7CA,EAAqB,UAAW,iBAAiB,GACjDA,EAAqB,UAAW,iBAAiB,GACjDA,EAAqB,uBAAwB,0BAA0B,GAMvErjD,EAAK2jD,sBAAwB3kD,EAAU+a,UAAU,CAC7C5H,OAAS6tC,GAAQoD,EAAcQ,sBAAsB5D,GACrDhmC,aAAc,EACd3D,KAAI,0BACJqtC,MAAO,CAAEG,eAAe,KAE5B7jD,EAAKyjD,gBAAmBzD,IACpBhhD,EAAU2jD,aAAa,CAAC3iD,EAAK2jD,sBAAsBxkD,QAAQ6gD,kBC1C7B1rC,EAAQ7S,EAAQxB,EAASjB,EAAW8kD,EAAMjnC,GAC5E,MAAM7c,EAAOvB,eCA+BgD,EAAQ2hD,GACpD,MAAMW,EAAiBliD,SAASC,cAAc,UAE9CiiD,EAAepvC,UAAY,YAC3BovC,EAAervC,UAAY,UAE3BqvC,EAAenvC,QAAO,KAClBwuC,EAAcY,mBAGlBviD,EAAOiB,WAAW,WAAYqhD,GDR9BE,CAAwBxiD,EAAQzB,GAEhC,MAAMiiD,EAAiB,IAAIiC,GACrB/B,EAAiB,IAAIgC,GAAelC,EAAgBjjD,EAAWgB,GAErEA,EAAKgkD,gBAAe,KAChB,MAAMhE,EAAMiC,EAAejC,MAAQ,EACnCmC,EAAesB,gBAAgBzD,IAEnChgD,EAAK4jD,sBAAyB5D,SACnBiC,EAAejC,MAAQA,GAC1BhgD,EAAKokD,eAAe,CAAEz3C,EAAG,GAAIC,EAAG,GAAIrL,EAAG,KAAO,CAAEoL,EAAG,GAAIpL,EAAG,IAAKqa,eAAgB,aAAc,IAIrG5b,EAAKokD,eAAc,CAAI9nC,EAAQtB,EAAQknC,KAEnC,MAAMx2B,EAAa,IAAI24B,GAAW/nC,EAAQtB,EAAQ1G,EAAQ2tC,EAAgBjjD,EAAWiB,EAASiiD,EAAQC,EAAgBtlC,GAEtHinC,EAAKQ,IAAIrF,kBAAkBvzB,GAC3Bo4B,EAAKS,OAAOtF,kBAAkBvzB,GAE9B,MAAMs0B,EAAMiC,EAAejC,MAC3BmC,EAAesB,gBAAgBzD,ITg1FvC5D,GAAcxF,OAAS,SAASjqC,EAAGC,GAEjC,IADA,IACgB4oC,EADZvhB,EAAIrnB,EAAG4nB,EAAKP,EAAIA,EAAGooB,EAAK7nB,EAAKA,EAAKA,EAC7BhvB,EAAI,EAAmBA,EAZjB,KAesB62C,GAAZ7nB,GAAvBP,GAAKuhB,GAFAvhB,GAAK8nB,GAAKC,GAAKxnB,EAAK6nB,GAAMJ,GAAKC,GAAK1nB,IAAO5nB,IAC1CmvC,IAAK,mBAASvnB,EAAK6nB,GAAM,qBAAS,QAAS7nB,KACjBP,GAAaO,EAAKA,IAC9C4b,GAAIoF,GAAS1F,OAJ+BtqC,GAMlD,MAAO,CACL22C,GAAIxvC,GAAKovC,IAAK,mBAASvnB,EAAK6nB,GAAM,qBAAS,QAAS7nB,IAAOic,GAAIxc,GAC/Did,GAAKN,GAAI3c,GAAKkoB,MAclBG,GAAY1F,OAAS2E,GAAgBlL,IAgGrCkM,GAAiB3F,OAAS,SAASjqC,EAAGC,GACpC,IAAqB4oC,EAAjBrC,EAAMvmC,EAAGpH,EAAI,KACd,CACD,IAAIg3C,EAAOrJ,EAAMA,EAAKsJ,EAAOD,EAAOA,EACpCrJ,GAAOqC,GAASrC,GAAO,SAAWqJ,GAAQ,QAAWC,GAAoB,QAAWD,EAAvB,QAA8B,QAAWC,KAAU7vC,IAC3G,SAAW4vC,GAAQ,QAAeC,GAAwB,QAAeD,EAA/B,QAAsC,QAAW,GAAKC,WAC9FrM,GAAIoF,GAAS3F,MAAarqC,EAAI,GACvC,MAAO,CACLmH,GAAK,OAAU6vC,EAAOrJ,EAAMA,IAAoBqJ,GAAoBA,EAAOA,EAAOA,GAAQ,QAAW,QAAWA,GAAxD,SAApB,UACpCrJ,IAaJuJ,GAAgB9F,OAAS2E,GAAgBrK,IAazCyL,GAAiB/F,OAAS2E,IAAgB,SAASroB,GACjD,OAAO,EAAImd,GAAKnd,MAalB0pB,GAAsBhG,OAAS,SAASjqC,EAAGC,GACzC,MAAO,EAAEA,EAAG,EAAIyjC,GAAKK,GAAI/jC,IAAMqjC,KWvhGjC,MAAMwU,GAAI9gD,KAAKC,eAEC8gD,GAAOp1B,GACnB,MAAM4E,EAAI5E,EAAG5uB,OACPikD,EAAO1wC,MAAM,GAAG1D,OACtB,GAAqC,QAAjC+e,EAAGpb,MAAM,EAAG,GAAG0wC,cAAyB,CACxC,MAAMv3C,EAAIiiB,EAAG3pB,QAAQ,IAAK,IAAIsB,MAAM,KACpC09C,EAAK,GAAKz9C,SAASmG,EAAE,GAAG6G,MAA6B,MAAvB7G,EAAE,GAAGu3C,cAAwB,EAAI,GAAI,IACnED,EAAK,GAAKz9C,SAASmG,EAAE,GAAI,IACzBs3C,EAAK,GAAKz9C,SAASmG,EAAE,GAAI,IACzBs3C,EAAK,GAAKt3C,EAAE,GAAKya,WAAWza,EAAE,KAAM,MACjC,CACH,IAAIA,EACOA,EAAP6mB,EAAI,EAAOhtB,SAAS29C,OAAOv1B,EAAG,IAAMA,EAAG,GAAKA,EAAG,GAAKA,EAAG,GAAKA,EAAG,GAAKA,EAAG,IAAM4E,EAAI,EAAI2wB,OAAOv1B,EAAG,IAAMA,EAAG,GAAK,IAAK,IAC7GpoB,SAASooB,EAAGpb,MAAM,GAAI,IAC/BywC,EAAK,GAAMt3C,GAAK,GAAM,IACtBs3C,EAAK,GAAMt3C,GAAK,EAAK,IACrBs3C,EAAK,GAAS,IAAJt3C,EACVs3C,EAAK,GAAW,IAANzwB,GAAiB,IAANA,EAAUuwB,IAAKp3C,GAAK,GAAM,KAAO,IAAO,KAAS,KAAQ,EAElF,OAAOs3C,cCFPpoC,EACAtB,EACA6pC,EACAC,EACAv8C,EACA+L,EACAywC,EACA/lD,EACAiB,EACAiiD,EACA8C,EACAnoC,GAEA,MAAM7c,EAAOvB,KAEbuB,EAAKgb,OAAS,GACdhb,EAAKsc,OAAS,GAEd,MAAMvR,EAAKg6C,EAAmBhF,IAAI//C,GAKlCA,EAAKoiD,YAAW,KACZ,MAAMC,EAAU,CAAE11C,EAAG2P,EAAO3P,EAAGC,EAAG0P,EAAO1P,GAEnCnN,EAAW,CACbulD,EAAmB1C,kBAAkB/kC,OAAOpe,QAAQ4L,EAAI,EAAG,GAC3Di6C,EAAmB1C,kBAAkBD,QAAQljD,QAAQ4L,EAAIs3C,EAASA,GAClE2C,EAAmB1C,kBAAkBC,QAAQpjD,QAAQ4L,EAAIiQ,EAAOrO,EAAGqO,EAAOrO,GAC1Eq4C,EAAmB1C,kBAAkB/5C,MAAMpJ,QAAQ4L,EAAIxC,EAAOA,IAI9D25C,EACAljD,EAAU2jD,aAAaljD,GAEvBT,EAAU4jD,WAAWnjD,IAI7BO,EAAK6iD,UAAY,GAEjB7iD,EAAK6iD,UAAUtlC,OAAU5Y,IACrB3E,EAAKud,OAAS5Y,EACd1E,EAAQC,IAAI,CAAC,gBAEjBF,EAAKmhD,KAAQx8C,IACT,MAAMm+C,EAAMkC,EAAmB1C,kBAAkB/kC,OAAOwlC,gBAAgBh4C,GACxEi6C,EAAmB1C,kBAAkB/kC,OAAO1D,GAAG9O,EAAIpG,EAAGm+C,IAG1D9iD,EAAK6iD,UAAUR,QAAWlnC,IACtBnb,EAAKsc,OAAO3P,EAAIwO,EAAExO,EAClB3M,EAAKsc,OAAO1P,EAAIuO,EAAEvO,EACc,IAA5BiQ,EAAIiB,SAASD,aACb7d,EAAK2M,EAAIwO,EAAExO,EACX3M,EAAK4M,EAAIuO,EAAEvO,GAEf3M,EAAQC,IAAI,CAAC,gBAEjBF,EAAK6iD,UAAUN,QAAWpnC,IACtBnb,EAAKgb,OAAOrO,EAAIwO,EACgB,IAA5B0B,EAAIiB,SAASD,aACb7d,EAAK2M,EAAIwO,EACTnb,EAAK4M,EAAI,KAEb3M,EAAQC,IAAI,CAAC,gBAEjBF,EAAKiwB,MAAS9U,IACV,GAAgC,IAA5B0B,EAAIiB,SAASD,WAAkB,CAC/B,MAAMilC,EAAMkC,EAAmB1C,kBAAkBC,QAAQQ,gBAAgBh4C,GACzEi6C,EAAmB1C,kBAAkBC,QAAQ1oC,GAAG9O,EAAIoQ,EAAExO,EAAGm2C,OACtD,CACH,MAAMA,EAAMkC,EAAmB1C,kBAAkBD,QAAQU,gBAAgBh4C,GACzEi6C,EAAmB1C,kBAAkBD,QAAQxoC,GAAG9O,EAAIoQ,EAAG2nC,KAOnB9iD,EAAAme,SAAA,KAEZ,MAAxBL,SAAKD,WAAmB7d,EAAA6iD,UAAAN,QAAAviD,EAAAgb,OAAArO,GAAE3M,EAAE6iD,UAAaR,QAAA,CAAE11C,EAAG3M,EAAKsc,OAAO3P,EAAGC,EAAA5M,EAAAsc,OAAA1P,OAKjEi2C,UAAUt6C,MAAG08C,IACbjlD,EAAKuI,MAAA08C,EACLjlD,EAAAklD,UAAaT,GAAAQ,KAAO/kD,IAAA,CAAC,aAGrBuhD,SAAY98C,IACZ,MAAAm+C,EAAAkC,EAAmB1C,kBAA6B/5C,MAAKw6C,gBAAGh4C,GAC3Di6C,EAAA1C,kBAAA/5C,MAAAsR,GAAA9O,EAAApG,EAAAm+C,IAID9iD,EAAgBoiD,gBAGZc,MAAA,KACHC,GAAAnjD,EAAAsU,EAAAuI,IAGD7c,EAAK6kD,QAAUA,EAClB7kD,EAAA8kD,QAAAA,cCvH0CC,EAAoB/lD,EAAW6d,GACtE,MAAM7c,EAAOvB,KAEP0mD,EAAS,sBAMN9B,EAAqBh5C,EAAKi5C,EAAWC,GAC1CvjD,EAAKsiD,kBAAkBj4C,GAAOrL,EAAUwkD,iBAAiB,CACrDrxC,OAAM,CAAGpH,EAAIpG,KACT3E,EAAKolD,oBAAoBr6C,EAAK,GACZg6C,EAAmB9E,IAAIl1C,GAC/B83C,UAAUx4C,GAAK1F,IAE7B0R,KAAI,GAAK8uC,KAAU7B,IACnBI,MAAO,SAAEH,KAVjBvjD,EAAKsiD,kBAAoB,GAczBe,EAAqB,SAAU,UAAU,GACzCA,EAAqB,UAAW,iBAAiB,GACjDA,EAAqB,UAAW,aAAa,GAC7CA,EAAqB,QAAS,SAAS,GAOvCrjD,EAAKqlD,0BAA4BrmD,EAAU+a,UAAU,CACjD5H,OAAS6tC,IACLnjC,EAAIyoC,0BAA0BtF,IAElChmC,aAAc,EACd3D,KAAI,GAAK8uC,qBACTzB,MAAO,CAAEG,eAAe,KAE5B7jD,EAAKolD,oBAAuBpF,IACxBhhD,EAAU2jD,aAAa,CAAC3iD,EAAKqlD,0BAA0BlmD,QAAQ6gD,kBC3CxBv+C,EAAQob,GACnD,MAEM0oC,EAAqB1jD,SAASC,cAAc,UAElDyjD,EAAmB7wC,UAAY,UAC/B6wC,EAAmB5wC,UAAY,gBAE/B4wC,EAAmB3wC,QAAO,KACtBiI,EAAI2oC,uBAGR/jD,EAAOiB,WAAW,eAAgB6iD,GAXrB9mD,KAaR6gD,KAAI,KACLiG,EAAmBnwC,QAAS,GAdnB3W,KAgBRmhD,KAAI,KACL2F,EAAmBnwC,QAAS,eClBCd,EAAQ7S,EAAQxB,EAASjB,EAAW8kD,EAAMjnC,GAC3E,MAAM7c,EAAOvB,KACbuB,EAAKylD,UAAY,IAAIC,GAAuBjkD,EAAQzB,GACpD,MAAM+kD,EAAqB,IAAIb,GACzBc,EAAqB,IAAIW,GAAmBZ,EAAoB/lD,EAAWgB,GAEjFA,EAAKwlD,oBAAmB,KAEpB,MAAMxF,EAAM+E,EAAmB/E,MAAQ,EACvCgF,EAAmBI,oBAAoBpF,IAE3ChgD,EAAKslD,0BAA6BtF,SACvB+E,EAAmB/E,MAAQA,GAAK,CACnC,MAAMz3C,EAAQklB,GAAiB,UAC/BztB,EAAK4lD,aAAa,CAAEj5C,EAAG,GAAIC,EAAG,IAAM,CAAED,EAAG,IAAMpE,GAAO,KAI9DvI,EAAK4lD,aAAY,CAAItpC,EAAQtB,EAAQ5a,EAAG8hD,KAEpC,MAAM2D,EAAY,IAAIC,GAAUxpC,EAAQtB,EAAQ,GAAI,GAAI5a,EAAGkU,EAAQywC,EAAoB/lD,EAAWiB,EAASiiD,EAAQ8C,EAAoBnoC,GACvIinC,EAAKQ,IAAIyB,gBAAgBF,GAEzB,MAAM7F,EAAM+E,EAAmB/E,MAC/BgF,EAAmBI,oBAAoBpF,gBCd3C1jC,EACAtB,EACA1G,EACA0xC,EACAhnD,EACAiB,EACAiiD,EACA+D,EACAppC,GAEA,MAAM7c,EAAOvB,KAEbuB,EAAKsc,OAAS,GACdtc,EAAKgb,OAAS,GAEd,MAAMjQ,EAAKi7C,EAAqBjG,IAAI//C,GAKpCA,EAAKoiD,YAAW,KACZ,MAAMC,EAAU,CAAE11C,EAAG2P,EAAO3P,EAAGC,EAAG0P,EAAO1P,GAEnCnN,EAAW,CACbwmD,EAAqB3D,kBAAkB/kC,OAAOpe,QAAQ4L,EAAI,EAAG,GAC7Dk7C,EAAqB3D,kBAAkBD,QAAQljD,QAAQ4L,EAAIs3C,EAASA,GACpE4D,EAAqB3D,kBAAkBC,QAAQpjD,QAAQ4L,EAAIiQ,EAAOrO,EAAGqO,EAAOrO,GAC5Es5C,EAAqB3D,kBAAkBE,QAAQrjD,QAAQ4L,EAAIuR,EAAO/a,EAAG+a,EAAO/a,GAC5E0kD,EAAqB3D,kBAAkBG,QAAQtjD,QAAQ4L,EAAIiQ,EAAOzZ,EAAGyZ,EAAOzZ,GAC5E0kD,EAAqB3D,kBAAkBI,qBAAqBvjD,QACxD4L,EACAiQ,EAAOY,eACPZ,EAAOY,iBAKXsmC,EACAljD,EAAU2jD,aAAaljD,GAEvBT,EAAU4jD,WAAWnjD,IAI7BO,EAAK6iD,UAAY,GAEjB7iD,EAAK6iD,UAAUtlC,OAAU5Y,IACrB3E,EAAKud,OAAS5Y,EACd1E,EAAQC,IAAI,CAAC,gBAEjBF,EAAKmhD,KAAQx8C,IACT,MAAMm+C,EAAMmD,EAAqB3D,kBAAkB/kC,OAAOwlC,gBAAgBh4C,GAC1Ek7C,EAAqB3D,kBAAkB/kC,OAAO1D,GAAG9O,EAAIpG,EAAGm+C,IAG5D9iD,EAAK6iD,UAAUR,QAAWlnC,IACtBnb,EAAKsc,OAAO3P,EAAIwO,EAAExO,EAClB3M,EAAKsc,OAAO1P,EAAIuO,EAAEvO,EACc,IAA5BiQ,EAAIiB,SAASD,aACb7d,EAAK2M,EAAIwO,EAAExO,EACX3M,EAAK4M,EAAIuO,EAAEvO,GAEf3M,EAAQC,IAAI,CAAC,gBAEjBF,EAAK6iD,UAAUN,QAAWpnC,IACtBnb,EAAKgb,OAAOrO,EAAIwO,EACgB,IAA5B0B,EAAIiB,SAASD,aACb7d,EAAK2M,EAAIwO,EACTnb,EAAK4M,EAAI,KAEb3M,EAAQC,IAAI,CAAC,gBAEjBF,EAAKiwB,MAAS9U,IACV,GAAgC,IAA5B0B,EAAIiB,SAASD,WAAkB,CAC/B,MAAMilC,EAAMmD,EAAqB3D,kBAAkBC,QAAQQ,gBAAgBh4C,GAC3Ek7C,EAAqB3D,kBAAkBC,QAAQ1oC,GAAG9O,EAAIoQ,EAAExO,EAAGm2C,OACxD,CACH,MAAMA,EAAMmD,EAAqB3D,kBAAkBD,QAAQU,gBAAgBh4C,GAC3Ek7C,EAAqB3D,kBAAkBD,QAAQxoC,GAAG9O,EAAIoQ,EAAG2nC,KAOrB9iD,EAAAme,SAAA,KAEZ,MAAxBL,SAAKD,WAAmB7d,EAAA6iD,UAAAN,QAAAviD,EAAAgb,OAAArO,GAAE3M,EAAE6iD,UAAaR,QAAA,CAAE11C,EAAG3M,EAAKsc,OAAO3P,EAAGC,EAAA5M,EAAAsc,OAAA1P,OAKjEi2C,UAAWL,QAASQ,IACpBhjD,EAAAsc,OAAY/a,EAACyhD,IAAO9iD,IAAA,CAAC,aAGrBshD,MAASwB,IACT,MAAAF,EAAAmD,EAAqB3D,kBAA6BE,QAAQO,gBAAKh4C,GAClEk7C,EAAA3D,kBAAAE,QAAA3oC,GAAA9O,EAAAi4C,EAAAF,MAGGD,UAAWJ,QAASO,IACpBhjD,EAAAgb,OAAYzZ,EAACyhD,IAAO9iD,IAAA,CAAC,aAGrBmhD,MAAS2B,IACT,MAAAF,EAAAmD,EAAqB3D,kBAA6BG,QAAQM,gBAAKh4C,GAClEk7C,EAAA3D,kBAAAG,QAAA5oC,GAAA9O,EAAAi4C,EAAAF,IAIkD9iD,EAAA6iD,UAAAH,qBAAAO,IAC/CjjD,EAAAgb,OAAYY,eAACqnC,IAAgB/iD,IAAA,CAAC,sBAG9BqhD,mBAAY0B,IACZ,MAAAH,EAAAmD,EAAqB3D,kBAAkBI,qBAA4BK,gBAAoBh4C,GAC1Fk7C,EAAA3D,kBAAAI,qBAAA7oC,GAAA9O,EAAAk4C,EAAAH,IAGD9iD,EAAgBoiD,gBAGZc,MAAA,KACHC,GAAAnjD,EAAAsU,EAAAuI,IAKJ7c,EAAAuI,MAAA,mBCxI4Cy9C,EAAsBhnD,EAAW6d,GAC1E,MAAM7c,EAAOvB,KAEP0mD,EAAS,wBAMN9B,EAAqBh5C,EAAKi5C,EAAWC,GAC1CvjD,EAAKsiD,kBAAkBj4C,GAAOrL,EAAUwkD,iBAAiB,CACrDrxC,OAAM,CAAGpH,EAAIpG,KACT3E,EAAKkmD,sBAAsBn7C,EAAK,GACZi7C,EAAqB/F,IAAIl1C,GACjC83C,UAAUx4C,GAAK1F,IAE/B0R,KAAI,GAAK8uC,KAAU7B,IACnBI,MAAO,SAAEH,KAVjBvjD,EAAKsiD,kBAAoB,GAczBe,EAAqB,SAAU,UAAU,GACzCA,EAAqB,UAAW,iBAAiB,GACjDA,EAAqB,UAAW,aAAa,GAC7CA,EAAqB,UAAW,iBAAiB,GACjDA,EAAqB,UAAW,iBAAiB,GACjDA,EAAqB,uBAAwB,0BAA0B,GAMvErjD,EAAKmmD,4BAA8BnnD,EAAU+a,UAAU,CACnD5H,OAAS6tC,IACLnjC,EAAIupC,4BAA4BpG,IAEpChmC,aAAc,EACd3D,KAAI,GAAK8uC,qBACTzB,MAAO,CAAEG,eAAe,KAE5B7jD,EAAKkmD,sBAAyBlG,IAC1BhhD,EAAU2jD,aAAa,CAAC3iD,EAAKmmD,4BAA4BhnD,QAAQ6gD,kBC5CxBv+C,EAAQob,GACrD,MACMwpC,EAAiCxkD,SAASC,cAAc,UAE9DukD,EAA+B3xC,UAAY,UAC3C2xC,EAA+B1xC,UAAY,6BAE3C0xC,EAA+BzxC,QAAO,KAClCiI,EAAIypC,mCAGR7kD,EAAOiB,WAAW,2BAA4B2jD,GAVjC5nD,KAYR6gD,KAAI,KACL+G,EAA+BjxC,QAAS,GAb/B3W,KAeRmhD,KAAI,KACLyG,EAA+BjxC,QAAS,eClBTd,EAAQ7S,EAAQxB,EAASjB,EAAW8kD,EAAMjnC,GAC7E,MAAM7c,EAAOvB,KAEbuB,EAAKq/C,YAAc,IAAIkH,GAAyB9kD,EAAQzB,GACxD,MAAMgmD,EAAuB,IAAI9B,GAC3B+B,EAAuB,IAAIO,GAAqBR,EAAsBhnD,EAAWgB,GAEvFA,EAAKsmD,gCAA+B,KAChC,MAAMtG,EAAMgG,EAAqBhG,MAAQ,EACzCiG,EAAqBC,sBAAsBlG,IAE/ChgD,EAAKomD,4BAA+BpG,SACzBgG,EAAqBhG,MAAQA,GAChChgD,EAAKymD,yBAAyB,CAAE95C,EAAG,GAAIC,EAAG,GAAIrL,EAAG,KAAO,CAAEoL,EAAG,GAAIpL,EAAG,IAAKqa,eAAgB,aAAc,IAI/G5b,EAAKymD,yBAAwB,CAAInqC,EAAQtB,EAAQknC,KAE7C,MAAMj3B,EAAc,IAAIy7B,GAAYpqC,EAAQtB,EAAQ1G,EAAQ0xC,EAAsBhnD,EAAWiB,EAASiiD,EAAQ+D,EAAsBppC,GACpIinC,EAAKS,OAAOxF,4BAA4B9zB,GAExC,MAAM+0B,EAAMgG,EAAqBhG,MACjCiG,EAAqBC,sBAAsBlG,gBC3BXS,GACpC,MAEMkG,EAAW9kD,SAASC,cAAc,OACxC2+C,EAAImG,OAAOD,GAHEloD,KAKRif,OAAM,CAAImpC,EAAMt+C,EAAOu+C,KAGxB,MAAMC,EAAY3mD,GAAC,sBAA2BA,qBAE1CymD,EAAKG,QACLL,EAASrxC,UAAYuxC,EAAKG,QAAQlsC,KAAG,CAAE1a,EAAGoF,IAAMuhD,EAASD,EAASthD,IAAMpF,IAAGi7C,KAAK,UACzEwL,EAAKI,iBACZN,EAASrxC,UAAYuxC,EAAKI,eAAensC,IAAIsR,IAAatR,KAAG,CAAE1a,EAAGoF,IAAMuhD,EAASD,EAASthD,IAAMpF,IAAGi7C,KAAK,wBCR/EhuC,EAAGm7B,GACpC,MAAMloC,EAAI+M,EAAE5M,OAENymD,EAAO,CAAC,EAAG,EAAG,GACpB,IAAIC,EAAO,EACX,IAAK,IAAI3hD,EAAI,EAAGA,EAAIlF,EAAGkF,IAAK,CACxB,IAAK,IAAIpF,EAAI,EAAGA,EAAI,EAAGA,IACnB8mD,EAAK9mD,IAAMiN,EAAE7H,GAAKgjC,EAAOhjC,GAAGpF,IAAM,EAEtC+mD,GAAQ95C,EAAE7H,GAGd,OADc0hD,EAAKpsC,KAAKnO,GAAMjJ,KAAKC,MAAMD,KAAKiL,KAAKhC,EAAIw6C,eAI3CC,GAAYhnD,GACxB,MAAM,OAAQA,EAAE,MAAMA,EAAE,MAAMA,EAAE,kBCnBFkU,EAAQwvC,EAAMjnC,GAC5C,MAAM7c,EAAOvB,cA0DJ4oD,IACLxqC,EAAIyqC,UAAUnG,KAAK,GAvDvBnhD,EAAKgb,OAAS,GACdhb,EAAKsc,OAAS,GAEdtc,EAAK6iD,UAAY,GACjB7iD,EAAK6iD,UAAUtlC,OAAU5Y,IACrB3E,EAAKud,OAAS5Y,GAElB3E,EAAKmhD,KAAQx8C,IACT3E,EAAK6iD,UAAUtlC,OAAO5Y,IAG1B3E,EAAK6iD,UAAUR,QAAWlnC,IACtBnb,EAAKsc,OAAO3P,EAAIwO,EAAExO,EAClB3M,EAAKsc,OAAO1P,EAAIuO,EAAEvO,EACc,IAA5BiQ,EAAIiB,SAASD,aACb7d,EAAK2M,EAAIwO,EAAExO,EACX3M,EAAK4M,EAAIuO,EAAEvO,IAGnB5M,EAAK6iD,UAAUN,QAAWpnC,IACtBnb,EAAKgb,OAAOrO,EAAIwO,EACgB,IAA5B0B,EAAIiB,SAASD,aACb7d,EAAK2M,EAAIwO,EACTnb,EAAK4M,EAAI,MAGjB5M,EAAKiwB,MAAS9U,IACsB,IAA5B0B,EAAIiB,SAASD,WACb7d,EAAK6iD,UAAUN,QAAQpnC,EAAExO,GAEzB3M,EAAK6iD,UAAUR,QAAQlnC,GAE3B0B,EAAI0qC,YAGRvnD,EAAKme,SAAQ,KACuB,IAA5BtB,EAAIiB,SAASD,WACb7d,EAAK6iD,UAAUN,QAAQviD,EAAKgb,OAAOrO,GAEnC3M,EAAK6iD,UAAUR,QAAQ,CAAE11C,EAAG3M,EAAKsc,OAAO3P,EAAGC,EAAG5M,EAAKsc,OAAO1P,KAMlE5M,EAAK6iD,UAAUN,QAAQ,GACvBviD,EAAK6iD,UAAUR,QAAQ,CAAE11C,EAAG,EAAGC,EAAG,IAGlC5M,EAAKa,MAASsa,IACV0B,EAAIyqC,UAAUnG,KAAK,GACnBtkC,EAAIyqC,UAAUr3B,MAAM9U,GACpBqsC,GAAmBlzC,EAAO9R,KAAM6kD,IAQpCrnD,EAAKuI,MAAQ,OACb,MAAM2oB,EAAS,IAAIC,GAAcnxB,EAAM,EAAGsU,GAC1CtU,EAAKkxB,OAASA,EAEd4yB,EAAKQ,IAAIl5B,MAAMmD,gBAAgBvuB,EAAMA,EAAKkxB,QAC1C4yB,EAAKS,OAAOn5B,MAAMmD,gBAAgBvuB,EAAMA,EAAKkxB,QAI7C,IAAIu2B,EAAU,GAEdznD,EAAK0d,OAAM,CAAImpC,EAAMa,KAEjB,QAAap+C,IAATu9C,EAAoB,OAAO,KAE/B,MAAMc,EAAUD,EAAiBE,gBAC3Bd,EAAWa,EAAQ7sC,KAAK+sC,GAAQA,EAAIt/C,QACpCu/C,EAAeH,EAAQ7sC,KAAK+sC,GAAQA,EAAI3C,YAC9CllD,EAAK8mD,SAAWA,EAEhB,MAAOG,eAACA,GAAmBJ,EAO3B,OANA7mD,EAAKuI,MAAQ6+C,GAAYW,GAAad,EAAgBa,IAElDL,EAAQhH,KACRgH,EAAQ/pC,OAAOmpC,EAAM7mD,EAAKuI,MAAOvI,EAAK8mD,UAGnCD,GAGX7mD,EAAKkjD,MAAK,KACN,MAAM2D,EAAOhqC,EAAI0qC,WACJ,OAATV,IAEAY,EAAQhH,KAAKgH,EAAQhH,IAAIv8B,SAC7BujC,WCtGoC5gD,EAAQyN,GAGhD,MAAMysC,EAAOC,GAAWn6C,EAAQyN,IACzBmsC,IAACA,EAAGuH,OAAEA,GAAWjH,EAExBN,EAAI9rC,UAAY,OAChB8rC,EAAIl9C,MAAM,aAAe,QAEzB,MAAMkR,EAAS5S,SAASC,cAAc,UAEtC2S,EAAOlR,MAAM,aAAe,OAC5BkR,EAAOlR,MAAM0kD,MAAQ,QACrBxzC,EAAOlR,MAAM7C,MAAQ,QAErB+T,EAAOG,QAAO,KACVszC,KAEJ,IAAIpH,GAAS,WACJoH,IACLpH,GAAUA,EACVkH,EAAOlH,GAEPrsC,EAAOa,UAAawrC,EAAU,YAAc,YAEhDoH,IAEA,MAAMC,EAAUtmD,SAASC,cAAc,UAEvCqmD,EAAQ5kD,MAAM0kD,MAAQ,QACtBE,EAAQ5kD,MAAM,aAAe,OAC7B4kD,EAAQ5kD,MAAM,aAAe,OAC7B4kD,EAAQ7yC,UAAY,WACpB6yC,EAAQvzC,QAAO,KACX6rC,EAAIv8B,SACJrd,EAAOs6C,KAAK,IAEhBV,EAAIh+C,YAAY0lD,GAChB1H,EAAIh+C,YAAYgS,GAEhB,MAAM2zC,EAAkB,IAAIC,GAAgB5H,GAU5C,OAPAnsC,EAAOpS,SAASO,YAAYg+C,GAOrB,KAAEA,kBALOoG,EAAMt+C,EAAOu+C,GACzB/F,EAAKrjC,SACL0qC,EAAgB1qC,OAAOmpC,EAAMt+C,EAAOu+C,KDuD1BwB,CAAoBtoD,EAAMsU,GACpCmzC,EAAQ/pC,OAAOmpC,EAAM7mD,EAAKuI,MAAOvI,EAAK8mD,YAG1C9mD,EAAKqe,iBAAgB,MAEbre,EAAKud,QAAUV,EAAIyB,aACnB4S,EAAOlU,sBEtGiBc,GAChC,MAEMyqC,EAAa,CAAEC,IAAK,GAFb/pD,KAIRgqD,eAAiB,SAAUC,EAAWhB,EAAkBznD,GACzD,GAAIA,EAAQO,YAAa,MAAO,CAAEmN,MAAO,cAIzC,MAAMg6C,EAAUD,EAAiBE,gBAC3Be,EAAcD,EAAUj9B,iBAE9B,GAA2B,IAAvBk9B,EAAYloD,OAAc,MAAO,CAAEkN,MAAO,aAC9C,GAAuB,IAAnBg6C,EAAQlnD,OAAc,MAAO,CAAEkN,MAAO,iBAI1C,OAFwBmQ,EAAS8qC,YAAYD,EAAahB,EAASY,IAf1D9pD,KAoBRoqD,WAAU,CAAIvB,EAAWI,IACb5pC,EAASgrC,UAAUxB,EAAWI,eCpBZ5pC,GACnC,MAAM9d,EAAOvB,KAEP8pD,EAAa,CAAEC,IAAK,IAI1B,IAAIjuB,EAAS,GAEbv6B,EAAK0d,OAAS,SAAU0sB,EAAcC,EAAoBpqC,EAAS4d,IACnC,IAAxB5d,EAAQO,aACRR,EAAK+oD,WAIT,OADkB/oD,EAAKgpD,OAAO5e,EAAcC,EAAoBxsB,IAIpE7d,EAAK+oD,SAAW,WACZxuB,EAAS,IAGbv6B,EAAKgpD,OAAS,SAAU5e,EAAcC,EAAoBxsB,GAGtD,GAA6C,IAAzCusB,EAAa3e,iBAAiBhrB,OAAc,MAAO,CAAEmqC,eAAe,GACxE,GAA8D,IAA1DP,EAAmB7sB,4BAA4B/c,OAC/C,MAAO,CAAEmqC,eAAe,GAG5B,GAAIrQ,EAAO95B,OAzBG,IAyBiB,MAAO,CAAEmqC,eAAe,GAKvD,MAGOqe,MAACA,GAAUnrC,EAASorC,aAErBre,EAAY72B,MALP,GAICi1C,GAEZ,IAAI7qB,EAAI,EAER,MAAMuqB,EAAcve,EAAa3e,iBAEjC,IAAK,IAAIjmB,EAAI,EAAGA,EAVL,GAUaA,IAAK,CAEzB,MAAMslC,EAAKhtB,EAASorC,aAAaC,oBAC3BxB,EAAU,GAChB,IAAK,IAAIjjC,EAAI,EAAGA,EAAIomB,EAAIpmB,IAAK,CAEzB,MAAM+hB,EAAQ4D,EAAmBnsB,QAAQ5C,cAGtB,IAAfuC,EACA8pC,EAAQ1oD,KAAK,CAAE+b,OAAQyrB,IAEvBkhB,EAAQ1oD,KAAK,CAAEqd,OAAQmqB,IAK/B,MAAM2iB,EAAkBtrC,EAAS8qC,YAAYD,EAAahB,EAASY,GAEnE,GAAkD,iBAA9CzqC,EAASorC,aAAaG,oBAAwC,CAC9D,MAAOC,OAACA,GAAWF,EAGbG,EAA2B,IAAf1rC,EAAoByrC,EAAOtuC,OAASsuC,EAAOhtC,OAC7Die,EAAOt7B,KAAKsqD,GACZ1e,EAAUrlC,GAAK+jD,MACZ,CACH,MAAOC,WAACA,GAAeJ,EAEjBK,EAAa,GACnB,IAAK,IAAI/kC,EAAI,EAAGA,EAAIijC,EAAQlnD,OAAQikB,IAAK,CACrC,MAAMmjC,EAAMF,EAAQjjC,GACdglC,EAAYF,EAAW9kC,GAC7B,IAAK,IAAIC,EAAI,EAAGA,EAAI+kC,EAAW/kC,IAAK,CAChC,IAAI4kC,EAGAA,EAFM,IAAN5kC,EAE2B,IAAf9G,EAAoBgqC,EAAI7sC,OAAS6sC,EAAIvrC,OAC3B,IAAfuB,EAEI,CACPlR,EAAGk7C,EAAI7sC,OAAOrO,GAAKjJ,KAAKwC,SAAW,IAAOujD,GAInC,CACP98C,EAAGk7C,EAAIvrC,OAAO3P,GAAKjJ,KAAKwC,SAAW,IAAOujD,EAC1C78C,EAAGi7C,EAAIvrC,OAAO1P,GAAKlJ,KAAKwC,SAAW,IAAOujD,GAIlDlvB,EAAOt7B,KAAKsqD,GACZ1e,EAAUzM,GAAKmrB,EACfnrB,GAAK,KAKrB,MAAO,CAAEwM,eAAe,YAAMC,SAAWtQ,gBCrGbzc,GAChC,MAAM9d,EAAOvB,KAEP8pD,EAAa,CAAEC,IAAK,IAE1BxoD,EAAKyoD,eAAc,CAAI/J,EAAcgJ,EAAkBznD,KACnD,GAAIA,EAAQO,YAAa,MAAO,CAAEmN,MAAO,cAEzC,MAAMg6C,EAAUD,EAAiBE,gBAIjC,OAF2B5nD,EAAK2pD,aAAajL,EAAciJ,IAK/D3nD,EAAK2pD,aAAY,CAAIjL,EAAciJ,KAC/B,GAA2C,IAAvCjJ,EAAa/yB,eAAelrB,OAAc,MAAO,CAAEkN,MAAO,aAC9D,GAAuB,IAAnBg6C,EAAQlnD,OAAc,MAAO,CAAEkN,MAAO,iBAE1C,MAAMi8C,WAkBgBlL,EAAciJ,GACpC,MAAOkC,mBAACA,GAAuBnL,EAO/B,OALqBmL,EAAmB/uC,KACnCgvC,GAAQA,EAAIhvC,KACRivC,GAAgBjsC,EAASksC,UAAUD,EAAapC,EAASY,OAvB7C0B,CAAiBvL,EAAciJ,GAE9CuC,EAgCN,SAA8BN,EAAcjC,GAE5C,MAAMwC,EAAAxC,EAAgBlnD,OAChB2pD,WAIUR,EAAAO,GAEhB,MAAIE,EAAA,WAEmC/gD,IAAnCsgD,EAAW,GAAA,GAAA3C,eAAsC,CAEpD,MAAAqD,WAiB2BV,EAAQO,WAIjBn2C,MAAAm2C,GAAA75C,KAAC,KACHjR,SAASyqD,GAAMA,EAAAzqD,SAChBgrD,IAEP,MAAApD,eAAAA,GAAAoD,sCAIT,MAAMnf,EAAA,EAAAqf,EAAiBrvC,QAAO,CAAAC,EAAG/a,IAAG+a,EAAM/a,WACrBmqD,EAAAzvC,KAAAtO,GAAAA,EAAA0+B,IA9BpBsf,CAAAZ,EAAAO,GACGE,EAAApD,eAAmBqD,UAE0BhhD,IAA7CsgD,EAAa,GAAA,GAAAa,uBAA4C,CAE5D,MAAAC,WA8B4Bd,EAAAO,GAI7B,MAAAQ,EAAa32C,MACRm2C,WAEO92B,EAAK,EAAEA,EAAA82B,EAAA92B,IAAAs3B,EAACt3B,GAAArf,MAAAm2C,GAAuB75C,KAAI,KAC9BjR,SAASyqD,GAAMA,EAAAzqD,SAChBgrD,IAIP,MAAAI,uBAAAA,GAAAJ,gEAIT,MAAMO,EAAA,GAAAD,EAAA,GAAsB,GAAGA,EAAW,GAAE,uCA/C3CE,CAAAjB,EAAAO,GACGE,EAAAI,uBAAmBC,UAEyBphD,IAA5CsgD,EAAa,GAAA,GAAAkB,sBAA2C,CAExD,MAAMC,WAgDuBnB,GAEjC,IAAAoB,EACgB,KAEG,KACP3rD,SAAAyqD,GAAAA,EAAwBzqD,SAAGgrD,IAE3B,MAAAS,sBAA+BA,EAAqBG,cAAAA,GAAAZ,EACvDW,EAAAA,EAAA1rC,OAAAwrC,sBAKT,MAAMI,EAAStB,EAAcnpD,OAC7B0qD,EAAAvB,EAA2B,GAAAnpD,wBAC3BuqD,EAAQA,EAAAlwC,KAAAtO,GAAAA,EAAA4+C,IAEJ,CACHN,sBAAAE,EACJC,cAAAI,GApEaC,CAAkC1B,GAC3CS,EAAAS,sBAAAC,EAAAD,sBACDT,EAAOY,cAAKF,EAAAE,qBAGPZ,EAzBEkB,CAAgB3B,EAAAO,UAC1BrsC,EAAAorC,aAAAzpC,IAAAkoC,EAAAyC,GApC4BoB,CAAuB5B,EAAcjC,GAExD8D,EAoIN,SAAqB7B,EAAAjC,GAMrB,OALHiC,EAAA9uC,KAAAgvC,GAAAA,EAAAhvC,KAAAuvC,GAAAvsC,EAAAorC,aAAAzpC,IAAAkoC,EAAA0C,OArI0BqB,CAAoB9B,EAAcjC,GAEnDgE,EA4IoC,SACN/B,EAAcjC,EAAKjJ,GAG1D,MAAAkN,WAO4BhC,EAAAjC,EAAAjJ,GACzB,MAAgEhX,OAAAA,GAAAgX,EAAA/W,eACnC3Y,GAAAA,GAAA0vB,EACoByL,EAAAxC,EAAAlnD,OA8BjD,OAxBwB6rB,GAAkC0C,GAAAlU,KAAAgtB,UAC3B+jB,EAAAnkB,EAAAI,GACvBuiB,EAAQ,GAEZ,QAAC/gD,IAAAsgD,EAAA,GAAA,GAAA3C,eAAA,CAGG,MAAkCqD,WAmBdV,EAAEiC,EAAA1B,SAE1BI,EAAUv2C,MAAOm2C,GAAU75C,KAAG,GAGlC,IAAC,IAAAkiB,EAAA,EAAAA,EAAAq5B,EAAAprD,OAAA+xB,IAAA,CACD,MAAUoV,EAAIC,EAAG8B,GAAOkiB,EAAAr5B,8BACxB,IAAM,IAAA9N,EAAA,EAAAA,EAAiBylC,EAAOzlC,IAAM6lC,EAAS7lC,IAAIuiC,EAAAviC,GAAAilB,EACjD,MAAMuB,EAAC,EAAAqf,EAAcrvC,QAAA,CAAAC,EAAA/a,IAAA+a,EAAA/a,IAKrB,OAFKmqD,EAAAzvC,KAA8BtO,GAACA,EAAA0+B,IA9BM4gB,CAAAlC,EAAAiC,EAAA1B,GAClCE,EAAMpD,eAAOqD,EAEjB,QAAChhD,IAAAsgD,EAAA,GAAA,GAAAa,uBAAA,CAEG,MAAsCC,WA+BRd,EAAAiC,EAAA1B,SAElCQ,EAAO32C,MAAAm2C,OACP,IAAKzlC,EAAI,EAACA,EAAMylC,EAAIzlC,IAASimC,EACpBjmC,GAAK1Q,MAAMm2C,GAAI75C,KAAU,GAItC,IAAC,IAAAkiB,EAAA,EAAAA,EAAAq5B,EAAAprD,OAAA+xB,IAAA,CACD,MAAWoV,EAAIC,EAAI8B,GAAAkiB,EAASr5B,sCAC5B,IAAM,IAAAhtB,EAAA,EAAAA,EAAA2kD,EAAyB3kD,IAAA,IAAQ,IAAKkf,EAAG,EAAKA,EAAIylC,EAAYzlC,IAAGimC,EAAKnlD,GAAAkf,IAAA+lC,EAAAjlD,GAAAkf,GAAAilB,8BAM5E,OAJHghB,EAAA7vC,KAAAgvC,GAAAA,EAAAhvC,KAAAtO,GAAAA,EAAAo+C,MA3CiDmB,CAAAnC,EAAAiC,EAAA1B,GACtCE,EAAMI,uBAAOC,UAE2BphD,IAAxCsgD,EAAM,GAAA,GAAakB,sBAAqB,CAE5C,MAAOC,WA6CEnB,EAAAiC,OAETb,EAAsB,GACtBK,EAAW,GACdW,EAAA,EACD,IAAA,IAAMx5B,EAAM,EAAGA,EAAIq5B,EAAAprD,OAAK+xB,IAAA,CAEnB,MAAK,CAAG,CAACmX,GAAMkiB,EAAIr5B,GACpBw5B,GAASriB,QAETsiB,EAAO,EAAAD,MACP,IAAAv5B,EAAM,EAAAA,EAAAo5B,EAAAprD,OAAAgyB,IAA4B,mBAElCu5B,GAAAriB,EAEA,MAAAmhB,sBAA+BA,EAAqBG,cAAAA,GAAArB,EAAAhiB,GAAAC,GACvDqkB,EAAApB,EAAAhwC,KAAAnO,GAAAA,EAAAg9B,EAAAsiB,IAEGjB,EAAuBA,EAAwB1rC,OAAA4sC,GAC/Cb,EAAeA,EAAc/rC,OAAA2rC,GAEpC,MAAA,CAEmDH,sBAAAE,gBAC7BK,GArEHc,CAAAvC,EAAAiC,GACfxB,EAAAS,sBAAAC,EAAAD,sBACMT,EAAAY,cAAeF,EAAAE,qBAGjBZ,KAtCR+B,CAAAxC,EAAAjC,EAAAjJ,GAIG,OAFKkN,EAAqC9wC,KAAAuvC,GAASvsC,EAAYorC,aAAGzpC,IAAAkoC,EAAA0C,KAlJxCgC,CAAuBzC,EAAcjC,EAASjJ,GAClE8K,WAyPOmC,EAAahE,oBAEtB6B,EAASx1C,MAASs4C,GAAah8C,KAAA,MACH,mBAAxB44C,aAAkBG,oBAAM,CAC3BsC,EAAA7wC,KAAAsuC,GAAAA,EAAAmD,UAIiBltD,SAAOktD,IAGpB/C,EAAA+C,IAAA,UAIZZ,EAAAtsD,SAAA+pD,IAEI,IAAA,IAAU5jD,EAAI,EAAAA,EAAA8mD,EAAW9mD,IAAgBgkD,EAAMhkD,IAAA4jD,EAAAI,WAAAhkD,MAEhD,OAAOgkD,EA5QYgD,CAAeb,EAAmBhE,GAQrD,MAN2B,kBACvBuC,iBACAuB,oBACAE,aACAnC,IAwQXxpD,EAAA6oD,WAAA,CAAAvB,EAAAI,iCC/SkC+E,GAC/B,MAEMhZ,WAkBSgZ,GAEf,MAAMnsD,EAAImsD,EAAShsD,OACbgzC,EAAQ,IAAIz/B,MAAM1T,GACxB,IAAK,IAAIkF,EAAI,EAAGA,EAAIlF,EAAGkF,IAAK,CACxBiuC,EAAMjuC,GAAK,GACX,IAAK,IAAIkf,EAAI,EAAGA,EAAIpkB,EAAGokB,IAAK,CAExB,GAAIlf,IAAMkf,EAAG,SAEb,MAAM6d,EAAKkqB,EAASjnD,GACdknD,EAAKD,EAAS/nC,GAEpB+uB,EAAMjuC,GAAGvG,KAAK0tD,GAAgBpqB,EAAImqB,KAI1C,OAAOjZ,EAnCOmZ,CAAUH,GAFXhuD,KAMRouD,QAAU,SAAiBC,GAG5B,MAAMxsD,EAAImzC,EAAMhzC,OACV6tC,EAAOt6B,MAAM1T,GACnB,IAAK,IAAIkF,EAAI,EAAGA,EAAIlF,EAAGkF,IAAK,CACxB,MAAMunD,EAAUtZ,EAAMjuC,GAEtB8oC,EAAK9oC,GAAKwnD,GAAUF,EAAWC,GAEnC,OAAOze,YAoDCqe,GAAgBpqB,EAAImqB,GAQhC,MAAMl5C,EAAKk5C,EAAG//C,EAAI41B,EAAG51B,EACf8G,EAAKi5C,EAAG9/C,EAAI21B,EAAG31B,EAkBrB,MAAO,GANG,CAAED,EAAG6G,EAAI5G,EAAG6G,KATK,IAAf8uB,EAAG51B,EAAI+/C,EAAG//C,GAUP6G,EATY,IAAf+uB,EAAG31B,EAAI8/C,EAAG9/C,GASG6G,YAQpBu5C,GAAU97B,EAAQ67B,GAOvB,IAAIziB,EAAM,EACV,MAAMz7B,EAAKqiB,EAAOvkB,EACZmC,EAAKoiB,EAAOtkB,GACXrL,EAACA,GAAM2vB,EACRroB,EAAI,GAAMtH,EAEhB,IAAK,IAAIoL,EAAIkC,EAAKhG,EAAG8D,EAAIkC,EAAKhG,EAAG8D,GAPtB,EAO+B,CAMtC,MAAMsgD,EAAQpkD,GAAK,GAAK8D,EAAIkC,IAAO,EACnC,IAAIq+C,EAEAA,EADAD,EAAQ,EACDvpD,KAAKiL,KAAKs+C,GAEV,EAEX,IAAIE,EAAOr+C,EAAKo+C,EACZE,EAAMt+C,EAAKo+C,EASf,IAAK,IAAI1nD,EAAI,EAAGA,EAAIunD,EAAQtsD,OAAQ+E,IAAK,CACrC,MAAM0oC,EAAO6e,EAAQvnD,GACf6yB,EAAK6V,EAAKmf,EAAEzgD,EACZwrB,EAAK8V,EAAKmf,EAAE1gD,GACX5D,EAACA,GAAMmlC,EACd,GAAW,IAAP7V,EACID,EAAKzrB,EAAI5D,IAGTqkD,EAAM3kC,EAAAA,OAGP,CACH,MAAMzZ,GAAMjG,EAAIqvB,EAAKzrB,GAAK0rB,EACtBA,EAAK,EACL+0B,EAAM1pD,KAAK+S,IAAI22C,EAAKp+C,GAEpBm+C,EAAOzpD,KAAKkqB,IAAIu/B,EAAMn+C,IAMlC,MAAMyE,EAAK05C,EAAOC,EAClB,GAAI35C,EAAK,EAAG,CAER62B,GAxDG,EAuDU72B,GAIrB,OAAO62B,cClKwBmiB,GAC/B,MAEMa,EAmB6B,SAChBb,GACnB,MAAMnsD,EAAImsD,EAAShsD,OACb8sD,EAAUjhC,GAAMhsB,GAAGssB,MAAI,CAAEzf,EAAGpE,IAAM0jD,EAASt/C,GAAGR,EAAI8/C,EAAS1jD,GAAG4D,IAC9D6gD,EAAY,IAAIx5C,MAAM1T,EAAI,GAChC,IAAK,IAAIkF,EAAI,EAAGA,EAAIlF,EAAI,EAAGkF,IACvBgoD,EAAUhoD,GAA6D,IAAvDinD,EAASc,EAAQ/nD,IAAImH,EAAI8/C,EAASc,EAAQ/nD,EAAI,IAAImH,GAEtE,MAAM2gD,EAAY,IAAIt5C,MAAM1T,GAC5B,IAAK,IAAIkzB,EAAI,EAAGA,EAAIlzB,EAAGkzB,IAAK,CACxB,MAAMi6B,EAAe,IAANj6B,GAAY/K,EAAAA,EAAW+kC,EAAUh6B,EAAI,GAC9Ck6B,EAASl6B,IAAMlzB,EAAI,EAAKmoB,EAAAA,EAAW+kC,EAAUh6B,GACnD85B,EAAUC,EAAQ/5B,IAAM,OAAEi6B,QAAOC,GAGrC,OAAOJ,EAlCWK,CAAclB,GAFnBhuD,KAIRouD,QAAU,SAAiBC,GAC5B,MAAMxsD,EAAImsD,EAAShsD,OACb6tC,EAAOt6B,MAAM1T,GAEnB,GAAiC,aAA7BwsD,EAAUlxC,eACV,IAAK,IAAIpW,EAAI,EAAGA,EAAIlF,EAAGkF,IACnB8oC,EAAK9oC,GAAKooD,GAAYd,EAAWQ,EAAU9nD,SAG/C,IAAK,IAAI6S,EAAI,EAAGA,EAAI/X,EAAG+X,IACnBi2B,EAAKj2B,GAAKw1C,GAASf,EAAWQ,EAAUj1C,IAGhD,OAAOi2B,YAsBCuf,GAASC,EAAOC,GAC5B,MAAON,MAACA,EAAKC,MAAEA,GAAUK,GAClBphD,EAACA,EAACpL,EAAEA,GAAMusD,EACXjlD,EAAI,GAAMtH,EACVysD,EAASrhD,EAAI9D,EACbolD,EAASthD,EAAI9D,EACbqlD,EAASxqD,KAAK+S,IAAIg3C,EAAOO,GACzBG,EAASzqD,KAAKkqB,IAAI8/B,EAAOO,GAE/B,OADYvqD,KAAK+S,IAAI,EAAG03C,EAASD,YAIrBN,GAAYE,EAAOC,GAC/B,MAAON,MAACA,EAAKC,MAAEA,GAAUK,GAClBphD,EAACA,EAACpL,EAAEA,GAAMusD,EACXv7C,EAAS5F,EACTi9B,EAAQroC,EAAImC,KAAKiL,KAAK,EAAIjL,KAAKsJ,IAIrC,OAFYzL,EAAI0rB,GAAQygC,EAAOn7C,EAAQq3B,GAASroC,EAAI0rB,GAAQwgC,EAAOl7C,EAAQq3B,eCxDrC6iB,EAAUK,EAAWjvC,GAC3D,MAAMuwC,EAAK3B,EAAShsD,OACd4tD,EAAS,IAAIr6C,MAAMo6C,GAAK99C,KAAK,GAC7Bg+C,EAAqB,IAAfzwC,EAAoB0wC,GAAMC,GAGhCC,EAAOhC,EAAS3xC,KAAK1a,GAAMkuD,EAAGluD,EAAG0sD,MAChCl/B,EAAKnX,YjDsFOtJ,GACnB,IAAIygB,EAAMzgB,EAAE,GACRsJ,EAAMtJ,EAAE,GACZ,IAAK,IAAI3H,EAAI,EAAGA,EAAI2H,EAAE1M,OAAQ+E,IAAK,CAC/B,MAAM4H,EAAID,EAAE3H,GACR4H,EAAIwgB,IACJA,EAAMxgB,GAENA,EAAIqJ,IACJA,EAAMrJ,GAGd,MAAO,CAACwgB,EAAKnX,GiDlGMi4C,CAAOD,GAG1B,IAAK,IAAIjpD,EAAI,EAAGA,EAAI4oD,EAAI5oD,IAAK,CACzB,MAAM4H,EAAIqhD,EAAKjpD,GACf,GAAI4H,GAAKwgB,EACLygC,EAAM7oD,GALG,OAMN,GAAI4H,GAAKqJ,EAGZ43C,EAAM7oD,GARG,MASN,CACH,MAAMmpD,GAAQvhD,EAAIwgB,IAAQnX,EAAMmX,GAEhCygC,EAAM7oD,GAZG,EAYU,GAA4B,EAAImpD,IAI3D,MADa,CAAE1H,eAAgBoH,YAG1BE,GAAIphD,EAAGpE,GACZ,OAAOrF,KAAK+L,IAAItC,EAAER,EAAI5D,EAAE4D,YAEnB6hD,GAAIrhD,EAAGpE,GACZ,OAAOrF,KAAKiL,MAAMxB,EAAER,EAAI5D,EAAE4D,IAAM,GAAKQ,EAAEP,EAAI7D,EAAE6D,IAAM,eChCT6/C,EAAUlE,GACvC9pD,KAERouD,QAAU,SAAiBC,GAE5B,MAAM8B,WA6BI9B,EAAWvE,GACzB,MACMsG,EADuC,aAA7B/B,EAAUlxC,eACC,EAAI,GACxBjP,EAACA,EAACC,EAAEA,EAACrL,EAAEA,GAAMurD,EAEdprD,EAAQH,EAAIstD,GACXrG,IAACA,GAAQD,EACVuG,EAASprD,KAAKC,MAAMjC,EAAQ8mD,GAG5BuG,EAASziC,GAAMwiC,GACfE,EAAS1iC,GAAMwiC,GACfG,EAAcF,EAAOj0C,KAAKtV,IAAOA,EAAI,IAAOgjD,EAAc,GAAR9mD,EAAciL,IAChEuiD,EAAcF,EAAOl0C,KAAKtV,IAAOA,EAAI,IAAOgjD,EAAc,GAAR9mD,EAAckL,IAEhE2oB,EAAKw5B,EAAOtuD,OACZ+0B,EAAKw5B,EAAOvuD,OACZ0uD,EAAa55B,EAAKC,EAClB45B,EAAQp7C,MAAMm7C,GACdE,EAAQr7C,MAAMm7C,GACdv9C,EAASoC,MAAMm7C,GACrB,IAAI92C,EAAI,EACR,IAAK,IAAIie,EAAK,EAAGA,EAAK04B,EAAOvuD,OAAQ61B,IACjC,IAAK,IAAID,EAAK,EAAGA,EAAK04B,EAAOtuD,OAAQ41B,IAAM,CACvC,MAAMuR,EAAKqnB,EAAY54B,GACjBwR,EAAKqnB,EAAY54B,GACvB84B,EAAM/2C,GAAKuvB,EACXynB,EAAMh3C,GAAKwvB,EACXj2B,EAAOyG,GAAKi3C,GAAWxC,EAAWllB,EAAIC,GACtCxvB,GAAK,EAOb,MAHa,CACT1L,EAAGyiD,EAAOxiD,EAAGyiD,SAAOz9C,KAAQ2jB,KAAIC,GA/DnB+5B,CAASzC,EAAWvE,GAE3BjoD,EAAImsD,EAAShsD,OACb6tC,EAAOt6B,MAAM1T,GAAGgQ,KAAK,GAC3B,IAAIm3B,EAAY,EAGhB,MAAM0nB,EAAaP,EAAKjiD,EAAElM,OACpB+uD,EAAUx7C,MAAMm7C,GACtB,IAAK,IAAI3pD,EAAI,EAAGA,EAAI2pD,EAAY3pD,IAAK,CACjC,MAAMoM,EAASg9C,EAAKh9C,OAAOpM,GAErB47B,EAAKwtB,EAAKjiD,EAAEnH,GACZ67B,EAAKutB,EAAKhiD,EAAEpH,GAEZqhD,EAAO4I,GAAkBhD,EADb,CAAE9/C,EAAGy0B,EAAIx0B,EAAGy0B,GACsB,GACpDmuB,EAAQhqD,GAAKqhD,EACb,MAAOI,eAACA,GAAmBJ,EAC3Bpf,GAAa71B,EACb,IAAK,IAAI8S,EAAI,EAAGA,EAAIpkB,EAAGokB,IACnB4pB,EAAK5pB,IAAMuiC,EAAeviC,GAAK9S,EAGvC,MAAO,MACHg9C,UAAMY,OAASlhB,YAAM7G,aA4CxB6nB,GAAWxC,EAAWllB,EAAIC,GAG/B,MAAM6nB,EAAuC,aAA7B5C,EAAUlxC,gBAEnBjP,EAACA,EAACC,EAAEA,EAACrL,EAAEA,GAAMurD,EACpB,IAAK4C,EAAS,CAIV,OAHY9nB,EAAKj7B,IAAM,GAAKk7B,EAAKj7B,IAAM,GAC3B,GAAMrL,IAAM,EAGb,EAEJ,EAMX,MAAMqoC,EAAQroC,EAAImC,KAAKiL,KAAK,EAAIjL,KAAKsJ,IAGrC,OADezL,EAAIsrB,GAAQ+a,EAAIj7B,EAAGi9B,GAAS/c,GAAQgb,EAAIj7B,EAAGg9B,eC9FhB6iB,GAC7BhuD,KAERouD,QAAU,SAAiBC,GAE5B,MAAM8B,WA2BI9B,GACd,MACM+B,EADuC,aAA7B/B,EAAUlxC,eACC,EAAI,GACxBjP,EAACA,EAACpL,EAAEA,GAAMurD,EACXgC,EAASprD,KAAKC,MAAMpC,EAAIstD,GAExBO,EADQ9iC,GAAMwiC,GACAh0C,KAAKtV,GAAMA,EAAI,GAAe,GAATspD,EAAeniD,IAExD,MADa,CAAEA,EAAGyiD,GAlCDO,CAAS7C,GAEhBxsD,EAAImsD,EAAShsD,OACb6tC,EAAOt6B,MAAM1T,GAAGgQ,KAAK,GAC3B,IAAIm3B,EAAY,EAGhB,MAAM0nB,EAAaP,EAAKjiD,EAAElM,OACpB+uD,EAAUx7C,MAAMm7C,GACtB,IAAK,IAAI3pD,EAAI,EAAGA,EAAI2pD,EAAY3pD,IAAK,CACjC,MAAM47B,EAAKwtB,EAAKjiD,EAAEnH,GAEZqhD,EAAO4I,GAAkBhD,EADb,CAAE9/C,EAAGy0B,GAC6B,GACpDouB,EAAQhqD,GAAKqhD,EACb,MAAOI,eAACA,GAAmBJ,EACrBj1C,EAASg+C,GAAW9C,EAAW1rB,GACrCqG,GAAa71B,EACb,IAAK,IAAI8S,EAAI,EAAGA,EAAIpkB,EAAGokB,IACnB4pB,EAAK5pB,IAAMuiC,EAAeviC,GAAK9S,EAGvC,MAAO,MACHg9C,UAAMY,OAASlhB,YAAM7G,aAgBxBmoB,GAAW9C,EAAW1rB,GAE3B,KAD6C,aAA7B0rB,EAAUlxC,gBAEtB,OAAO,EAEX,MAAOjP,EAACA,EAACpL,EAAEA,GAAMurD,EAGjB,OADevrD,EAAIsrB,GAAQuU,EAAIz0B,EADjBpL,EAAImC,KAAKiL,KAAK,EAAIjL,KAAKsJ,iBCnDLutB,EAAQs1B,GAGxC,MAAMvvD,EAAIi6B,EAAO95B,OACXqvD,EAAM,GACNC,EAAM,GACZ,IAAIC,EAAO,EACPC,EAAO,EAEP9iD,EAAIotB,EAAOj6B,EAAI,GACf4vD,EAAOC,GAAQN,EAAO1iD,GAC1B,IAAK,IAAI3H,EAAI,EAAGA,EAAIlF,EAAGkF,IAAK,CACxB,MAAMuD,EAAIwxB,EAAO/0B,GACX4qD,EAAOD,GAAQN,EAAO9mD,GAC5B,GAAKmnD,IAASE,IAAWF,GAAQE,EAAO,CACpC,MAEMzrC,EAAI0rC,GAAKljD,EAAGpE,EAFPunD,GAAST,EAAO1iD,GAChBmjD,GAAST,EAAO9mD,IAE3B+mD,EAAIE,GAAQrrC,EACZorC,EAAIE,GAAQtrC,EACZqrC,GAAQ,EACRC,GAAQ,EAERG,GACAL,EAAIE,GAAQlnD,EACZknD,GAAQ,IAERH,EAAIE,GAAQjnD,EACZinD,GAAQ,GAEZ7iD,EAAIpE,EACJmnD,EAAOE,EAGX,MAAO,CAAEG,SAAUT,EAAKU,SAAUT,YAG7BO,GAAST,EAAOppB,GAIrB,OAFkBopB,EAAM,GAAKppB,EAAM,GAAKopB,EAAM,GAAKppB,EAAM,GAAKopB,EAAM,IAChDnsD,KAAKiL,KAAKkhD,EAAM,IAAM,EAAIA,EAAM,IAAM,YAIrDM,GAAQN,EAAOppB,GAEpB,OADkBopB,EAAM,GAAKppB,EAAM,GAAKopB,EAAM,GAAKppB,EAAM,GAAKopB,EAAM,GACjD,WAGdQ,GAAKljD,EAAGpE,EAAG0nD,EAAIC,GAEpB,IAAIrjD,GAAKqjD,GADCD,EAAKC,GAEXrjD,EAAI,IAAGA,EAAI,GACXA,EAAI,IAAGA,EAAI,GAKf,MAJU,CACNA,EAAIF,EAAE,IAAM,EAAIE,GAAKtE,EAAE,GACvBsE,EAAIF,EAAE,IAAM,EAAIE,GAAKtE,EAAE,gBClDiB+jD,EAAWL,GAUjC,MAACkE,EA2EvB,SAA6B7D,SACzBjkD,EAAMikD,EAAQvrD,EAAK,GACnBoL,EAAMA,GAAQmgD,GACdlgD,EAAMA,GAAMkgD,EACZxsD,EAAM,IACN4wB,EAAQld,MAAK1T,WAAAkF,EAAE,EAAAA,EAAAlF,EAAAkF,IAAA,OAAImpD,EAAAnpD,GAAAlF,EAAA,GAACwM,EAAA,EAAApJ,KAAAsJ,GAAA2hD,EACvBzvB,EAAAvyB,EAAA9D,EAAAnF,KAAA4L,IAAAxC,GACMqyB,EAAMvyB,EAAA/D,EAAAnF,KAAAkM,IAAA9C,GAChBokB,EAAA1rB,GAAA,CAEQ05B,EACEC,UACSjO,EAvFO0/B,CAAA9D,GAEvB,IAAA+D,EAAU,CACNF,GAA8B,MAACrwD,EAAAmsD,EAAAhsD,OAEnC,IAAKqwD,EAAY,CAET98C,MAAM1T,GAAEgQ,KAAG,QAEX,IAAA9K,EAAM,EAAAA,EAAQlF,EAAG,EAAKkF,IAAG,IAAI,IAAAkf,EAAAlf,EAAA,EAAAkf,EAAApkB,EAAAokB,IAAA,CAC7B,MAAMqsC,EAAAF,EAAApwD,OAGDuwD,EAAYh9C,MAAa,EAAN+8C,GACpBE,EAAgBj9C,MAAO,EAAA+8C,OAEvB9nD,EAAA,MAEA,IAAA0b,EAAM,EAAIA,EAAGosC,EAAApsC,IAAA,CAEb,MAEMusC,EAAMC,GAF2DN,EAAAlsC,GACdysC,GAAA3E,EAAAjnD,GAAAinD,EAAA/nC,KAKrDorC,EAAAoB,EAAaX,cACbjnD,IAAAwmD,GAAkBA,EAAMrvD,OAAA,IAExBuwD,EAAM/nD,GAAA6mD,EACTmB,EAAAhoD,GAAAglB,GAAA6iC,EAAAnsC,IACDssC,EAAiBhoD,GAAAyb,IAAQ,EACrBzb,GAAG,SAGH8mD,EAAAmB,EAAaV,cACblnD,IAAAymD,GAAkBA,EAAMtvD,OAAA,IAExBuwD,EAAM/nD,GAAA8mD,EACTkB,EAAAhoD,GAAAglB,GAAA6iC,EAAAnsC,IACJssC,EAAAhoD,GAAAzD,IAAA,EACOyD,GAAC,GAGT+nD,EAAArwD,OAAasI,GAChBgoD,EAAAtwD,OAAAsI,GAEL4nD,EAAWG,EACXF,EAAgBG,EAEhB,MAAKF,EAAKF,EAAMpwD,OACZumD,EAAShzC,MAAI+8C,GACbM,EAAYr9C,MAAI+8C,OAChB,IAAK14C,EAAK,EAAGA,EAAI04C,EAAI14C,IACjB,CAEJ2uC,EAAS3uC,GAAKrE,MAAG1T,KACP+X,GAAOrE,MAAG1T,OAChB,IAAAokB,EAAQ,EAACA,EAAGpkB,EAAIokB,IAAG2sC,EAAAh5C,GAAAqM,GAAA,OACnB,IAAA2O,EAAA,EAAWA,EAAG/yB,EAAG+yB,IAAM,CAC1B,MAAAi+B,EAAAhxD,EAAAwwD,EAAAz4C,GAAAgb,GACJ2zB,EAAA3uC,GAAAgb,GAAAi+B,EACOD,EAAAh5C,GAAAi5C,EAAA,GAAAryD,KAAAo0B,WAA6Bw9B,MAAAA,EACxC7J,QAAAA,EAKEqK,WAAAA,YAmBsBD,GAAA7uB,EAAAmqB,GACxB,MAAAW,EAAAA,EAAAtkD,EAAAA,GAAA4jD,GAAApqB,EAAAmqB,kCCtGmDD,GACnChuD,KAERouD,QAAU,SAAiBC,EAAWl7C,GAGvC,IAAKi/C,MAACA,EAAK7J,QAAEA,EAAOqK,WAAEA,GAAeE,GAAwBzE,EAAWL,GAIxE,MAAMsE,EAAKF,EAAMpwD,OACjB,IAAI6tC,EAAOt6B,MAAM+8C,GACbtpB,EAAY,EAChB,IAAK,IAAIjiC,EAAI,EAAGA,EAAIurD,EAAIvrD,IAAK,CAEzB,MAAMgsD,GAAW56B,GAAYi6B,EAAMrrD,IAAMoM,EACzC08B,EAAK9oC,GAAKgsD,EACV/pB,GAAa+pB,EAIjB,MAAMlrB,EAAM,KAKZ,OAJA0gB,EAAUA,EAAQ1tC,QAAM,CAAE4mB,EAAG16B,IAAM9B,KAAK+L,IAAI6+B,EAAK9oC,IAAM8gC,IACvD+qB,EAAaA,EAAW/3C,QAAM,CAAE4mB,EAAG16B,IAAM9B,KAAK+L,IAAI6+B,EAAK9oC,IAAM8gC,IAC7DuqB,EAAQA,EAAMv3C,QAAM,CAAE4mB,EAAG16B,IAAM9B,KAAK+L,IAAI6+B,EAAK9oC,IAAM8gC,IACnDgI,EAAOA,EAAKh1B,QAAQnM,GAAMzJ,KAAK+L,IAAItC,GAAKm5B,IACjC,SACH0gB,aAASqK,OAAY/iB,YAAM7G,EAAWgqB,UAAW,OAAEZ,UAAO7J,iBC5BrByF,GAiB7C,MAAKnsD,EAAImsD,EAAAhsD,OACJ8sD,EAAYjhC,GACchsB,GAAAssB,MAAA,CAAAzf,EAAApE,IAAA0jD,EAAAt/C,GAAAR,EAAA8/C,EAAA1jD,GAAA4D,IAEvB+kD,EAAM,GAAKpxD,GAAOA,EAAE,GACpBqxD,EAAc39C,MAAG09C,GACjBE,EAAgB59C,MAAQ09C,OACxBzoD,EAAA,UAAoBzD,EAAE,EAAAA,EAAAlF,EAAA,EAAAkF,IAAA,IAAA,IAAAkf,EAAAlf,EAAA,EAAAkf,EAAApkB,EAAAokB,IAAA,OAAIge,EAAA6qB,EAAA/nD,GAACqsD,EAAAtE,EAAA7oC,GACrBotC,KAAArF,EAAA/pB,KAAA+pB,EAAAoF,iBACTF,EAAA1oD,GAAA6oD,EAGgBF,EAAA3oD,GAAA,CACfy5B,kBAIN,MAAgCqvB,EAAAzlC,GAAAolC,GAAA9kC,MAAA,CAAAzf,EAAApE,IAAA4oD,EAAAxkD,GAAAwkD,EAAA5oD,KAE3BykD,EAAYuE,EAAOj3C,KACpBtV,GAAAmsD,EAAgBnsD,KAKdwsD,EAAWD,EAAYj3C,KAAAtV,GAAAosD,EAAApsD,KAGzBwhD,EAAWhzC,MAAM1T,OACjB,IAAA+X,EAAQ,EAAEA,EAAM/X,EAAA+X,IAAA2uC,EAAAuG,EAAAl1C,IAAAA,EAAA,QAEhB45C,EAAUj+C,MAAQ09C,EAAA,GACtBO,EAAC,GAAAhkC,GAAA+4B,GAED,IAAA,IAAMxzB,EAAA,EAAUA,EAAGk+B,EAAMl+B,IAAK,CACzB,MAAKkP,EAAImvB,GAAMG,EAAax+B,GAC7BwzB,EAAAtkB,IAAY,EACZskB,EAAS6K,IAAO,EAGhBI,EAAQz+B,EAAG,GAAQvF,GAAE+4B,WAERhzC,MAAO09C,EAAA,WAChBj9B,EAAA,EAAAA,EAAYi9B,EAAK,EAAGj9B,IAAG,CAC3B48B,EAAC58B,GAAAzgB,MAAA1T,GACJ,IAAA,IAAAokB,EAAA,EAAAA,EAAApkB,EAAAokB,IAAA2sC,EAAA58B,GAAA/P,GAAA,GAEe,MAAAwtC,EAAAD,EAAAx9B,GAChB,IAAM,IAAApB,EAAA,EAAAA,EAAkB/yB,EAAA+yB,IAAA,CACxB,MAAAi+B,EAAgBY,EAAO7+B,GACvBg+B,EAAgB58B,GAAK68B,EAAQ,GAAAryD,KAAAo0B,YACgBpF,GAAUu/B,UAAC2E,EAAC9tB,SAAA5b,EAAAA,GAC5D0pC,EAAAlzD,KAAAwpB,EAAAA,GAEQ,CACL0pC,gBAAqBA,EACxBnL,QAAAiL,4BCzEoDxF,GACjD,MAEO0F,gBAACA,EAAenL,QAAEA,EAAOqK,WAAEA,GAAee,GAAyB3F,GAF7DhuD,KAIRouD,QAAU,SAAiBC,EAAWl7C,GAGvC,MAAMygD,EAAKF,EAAgB1xD,OAAS,EAC9B6tC,EAAOt6B,MAAMq+C,GACnB,IAAI5qB,EAAY,EAChB,IAAK,IAAIjiC,EAAI,EAAGA,EAAI6sD,EAAI7sD,IAAK,CAEzB,MAEMgsD,EAAUc,GAFFH,EAAgB3sD,GAChB2sD,EAAgB3sD,EAAI,GACQsnD,GAAal7C,EACvD08B,EAAK9oC,GAAKgsD,EACV/pB,GAAa+pB,EAEjB,MAAO,SACHxK,aAASqK,OAAY/iB,YAAM7G,EAAWgqB,UAAW,SAAEzK,kBAASmL,cAK/DG,GAAY7E,EAAOC,EAAOZ,GAC/B,MAAiC,aAA7BA,EAAUlxC,eACHgyC,GAAYd,EAAW,OAAEW,QAAOC,IAEpCG,GAASf,EAAW,OAAEW,QAAOC,aClB/B6E,GAAIplD,EAAGpE,GACZ,OAAQoE,EAAER,EAAI5D,EAAE4D,IAAM,WAEjB6lD,GAAIrlD,EAAGpE,GACZ,OAAQoE,EAAER,EAAI5D,EAAE4D,IAAM,GAAKQ,EAAEP,EAAI7D,EAAE6D,IAAM,cCbD6/C,EAAUK,EAAWjvC,GAC7D,MAAMywC,EAAqB,IAAfzwC,EAAoB40C,GAAMC,GAChCC,EAAQlG,EAAS3xC,KAAK1a,GAAMkuD,EAAGluD,EAAG0sD,KAClCxsD,EAAImsD,EAAShsD,OACbmyD,EAAetmC,GAAMhsB,GAAGssB,MAAI,CAAEzf,EAAGpE,IAAM4pD,EAAMxlD,GAAKwlD,EAAM5pD,KAGxDi+C,EAAW,IAAIhzC,MAAM1T,GAAIgQ,KAAK,GAC9BuiD,EAAe,IAAI7+C,MAAM1T,GAAIgQ,KAAK,GACxC,IAAK,IAAI9K,EAAI,EAAGA,EAAIlF,EAAGkF,IACnBwhD,EAAQ4L,EAAaptD,IAAMA,EAAI,EAC/BqtD,EAAYD,EAAaptD,IAAMlF,EAAIkF,EAAI,EAG3C,MAAMstD,EAAW,IAAI9+C,MAAM1T,GAC3B,IAAK,IAAI+X,EAAI,EAAGA,EAAI/X,EAAG+X,IAAK,CACxBy6C,EAASz6C,GAAM,IAAIrE,MAAM1T,GAAIgQ,KAAK,GAClC,IAAK,IAAIoU,EAAI,EAAGA,EAAIpkB,EAAGokB,IACfsiC,EAAQ3uC,KAAO2uC,EAAQtiC,KAC3BouC,EAASz6C,GAAGqM,GAAMsiC,EAAQ3uC,GAAK2uC,EAAQtiC,GAAM,GAAI,GAIzD,MAAO,cACHkuC,UAAc5L,cAAS6L,WAAaC,EAAU7L,eAAgB4L,YAG7DJ,GAAItlD,EAAGpE,GACZ,OAAQoE,EAAER,EAAI5D,EAAE4D,IAAM,WAEjB+lD,GAAIvlD,EAAGpE,GACZ,OAAQoE,EAAER,EAAI5D,EAAE4D,IAAM,GAAKQ,EAAEP,EAAI7D,EAAE6D,IAAM,cClCS6/C,GAClD,MAKMnsD,EAAImsD,EAAShsD,OAEb+sD,EAAYx5C,MAAM1T,EAAI,GACtByyD,EAAW/+C,MAAM1T,EAAI,GAC3B,IAAK,IAAIkzB,EAAI,EAAGA,EAAIlzB,EAAI,EAAGkzB,IAAK,CAC5Bg6B,EAAUh6B,GAAKxf,MAAM1T,EAAIkzB,EAAI,GAC7Bu/B,EAASv/B,GAAKxf,MAAM1T,EAAIkzB,EAAI,GAC5B,IAAK,IAAI9O,EAAI8O,EAAI,EAAG9O,EAAIpkB,EAAGokB,IAAK,CAC5B,MAAM2R,EAAKo2B,EAASj5B,GAAG7mB,EACjBqmD,EAAKvG,EAAS/nC,GAAG/X,EACjBmlD,EAAW,IAAOz7B,EAAK28B,GAC7BxF,EAAUh6B,GAAG9O,GAAKotC,EAClBiB,EAASv/B,GAAG9O,GAAM2R,EAAK28B,GAjBlBv0D,KAqBRouD,QAAU,SAAiBC,EAAWl7C,GAGvC,MAAM61B,WAwBcqlB,EAAWl7C,GACnC,MAAM67C,GAAShlC,EAAAA,EACTilC,EAAQjlC,EAAAA,EACd,OAAOwqC,GAAYxF,EAAOC,EAAOZ,GAAal7C,EA3BxBshD,CAAmBpG,EAAWl7C,GAE1C08B,EAAOt6B,MAAM1T,GAAGgQ,KAAK,GAC3B,IAAK,IAAI9K,EAAI,EAAGA,EAAIlF,EAAGkF,IACnB8oC,EAAK9oC,GAAKwO,MAAM1T,GAAGgQ,KAAK,GAG5B,IAAK,IAAI+H,EAAI,EAAGA,EAAI/X,EAAI,EAAG+X,IACvB,IAAK,IAAIqM,EAAIrM,EAAI,EAAGqM,EAAIpkB,EAAGokB,IAAK,CAE5B,MAEMyuC,EAAcF,IAFLxqC,EAAAA,EACD+kC,EAAUn1C,GAAGqM,GACmBooC,GAAal7C,EACrDwhD,EAASL,EAAS16C,GAAGqM,GAAMyuC,EAAc1rB,EAAY0rB,EACrDE,EAAQ5rB,EAAY2rB,EAE1B9kB,EAAKj2B,GAAGqM,GAAK0uC,EACb9kB,EAAK5pB,GAAGrM,GAAKg7C,EAGrB,MAAO,MAAE/kB,YAAM7G,aAUdwrB,GAAYxF,EAAOC,EAAOZ,GAC/B,MAAiC,aAA7BA,EAAUlxC,eACHgyC,GAAYd,EAAW,OAAEW,QAAOC,IAEpCG,GAASf,EAAW,OAAEW,QAAOC,gBC3DajB,GACpChuD,KAERouD,QAAU,SAAiBC,EAAWl7C,GAGvC,MAAM61B,WAyDcqlB,EAAWl7C,GACnC,OAAOA,EAASlO,KAAKsJ,IAAM8/C,EAAUvrD,EAAI,IAAM,EA1DzB+xD,CAAmBxG,EAAWl7C,GAE1CtR,EAAImsD,EAAShsD,OAEb6tC,EAAOt6B,MAAM1T,GAAGgQ,KAAK,GAC3B,IAAK,IAAI9K,EAAI,EAAGA,EAAIlF,EAAGkF,IACnB8oC,EAAK9oC,GAAKwO,MAAM1T,GAAGgQ,KAAK,GAG5B,IAAK,IAAI+H,EAAI,EAAGA,EAAI/X,EAAI,EAAG+X,IACvB,IAAK,IAAIqM,EAAIrM,EAAI,EAAGqM,EAAIpkB,EAAGokB,IAAK,CAG5B,MAKM0uC,EAAQG,GAHDC,GAFCC,GAAQhH,EAASp0C,GAAIo0C,EAAS/nC,IAEfooC,GAGAA,EAAWl7C,EAAQ61B,GAC1C4rB,EAAQ5rB,EAAY2rB,EAE1B9kB,EAAKj2B,GAAGqM,GAAK0uC,EACb9kB,EAAK5pB,GAAGrM,GAAKg7C,EAGrB,MAAO,MAAE/kB,YAAM7G,aAGdgsB,GAAQlxB,EAAImqB,GACjB,MAAOW,EAACA,EAACtkD,EAAEA,GAAM4jD,GAAgBpqB,EAAImqB,GACrC,MAAO,CAACW,EAAE1gD,EAAG0gD,EAAEzgD,GAAI7D,YAEdyqD,GAAS3D,EAAO/C,GAIrB,OAFkB+C,EAAM,GAAK/C,EAAUngD,EAAIkjD,EAAM,GAAK/C,EAAUlgD,EAAIijD,EAAM,IACtDnsD,KAAKiL,KAAKkhD,EAAM,IAAM,EAAIA,EAAM,IAAM,YAGrD0D,GAAS9E,EAAM3B,EAAWl7C,EAAQ61B,GAKvC,MAAM5+B,EAAIikD,EAAUvrD,EAAI,EACxB,GAAIktD,EAAO5lD,EAAG,OAAO,EACrB,GAAI4lD,GAAQ5lD,EAAG,OAAO4+B,EAGtB,MAAMr6B,EAAIqhD,EAAO5lD,EAOjB,OAHaA,GAAK,GAHDnF,KAAK8L,KAAKpC,GAAKA,EAAI1J,KAAKiL,KAAK,EAAIvB,GAAK,IAK3BwE,QCrDf8hD,GAAM,WAAe,CAAqCC,cCArClH,EAAUmH,EAAY/1C,GACxD,MAAMg2C,EAAyB,IAAfh2C,EACV,IAAIi2C,GAA+BrH,GACnC,IAAIsH,GAAgCtH,GAGpCnsD,EAAImsD,EAAShsD,OACnB,IAAI4tD,EAAS,IAAIr6C,MAAM1T,GAAIgQ,KAAK,GAChCsjD,EAAWv0D,SAASytD,IAChB,MAAMxe,EAAOulB,EAAOhH,QAAQC,GACtBl7C,OAAgCtI,IAArBwjD,EAAUl7C,OAAwB,EAAIk7C,EAAUl7C,OACjEy8C,EAAQA,EAAMvzC,KAAG,CAAEhc,EAAOmjC,IAAUnjC,EAAQwvC,EAAKrM,GAASrwB,OAE9D,MAAM24B,EAAQ8jB,EAAMnzC,QAAM,CAAEC,EAAG/a,IAAM+a,EAAI/a,IAGzC,MADc,gBADSiuD,EAAMvzC,KAAKnO,GAAMA,EAAI49B,MDb5CypB,sBJN0CvH,EAAUK,EAAWjvC,GAC/D,MAAMywC,EAAqB,IAAfzwC,EAAoB00C,GAAMC,GAEhChtD,EAAImoB,GADI8+B,EAAS3xC,KAAK1a,GAAMkuD,EAAGluD,EAAG0sD,MAElCxsD,EAAImsD,EAAShsD,OACb4tD,EAAS,IAAIr6C,MAAM1T,GAAIgQ,KAAK,GAGlC,OAFA+9C,EAAM7oD,GAAK,EACE,CAAEyhD,eAAgBoH,WIDL,CAAiCsF,cEE7BlH,EAAUmH,EAAY/1C,EAAY0qC,GAChE,MAAMsL,EAAyB,IAAfh2C,EACV,IAAIo2C,GAAsBxH,GAC1B,IAAIyH,GAAsBzH,EAAUlE,GAGpCjoD,EAAImsD,EAAShsD,OACnB,IAAI4tD,EAAS,IAAIr6C,MAAM1T,GAAIgQ,KAAK,GAC5Bi6B,EAAQ,EACZ,MAAM4pB,EAAW,GACjB,IAAK,IAAI3uD,EAAI,EAAGA,EAAIouD,EAAWnzD,OAAQ+E,IAAK,CACxC,MAAMsnD,EAAY8G,EAAWpuD,IACtBopD,KACHA,EAAIY,QAAEA,EAAOlhB,KAAEA,EAAI7G,UAAEA,GACrBosB,EAAOhH,QAAQC,GAEbsH,EAAgB,MAAExF,UAAMY,YAAS1C,GACvCqH,EAASl1D,KAAKm1D,GAEd,MAAMxiD,OAAgCtI,IAArBwjD,EAAUl7C,OAAwB,EAAIk7C,EAAUl7C,OACjEy8C,EAAQA,EAAMvzC,KAAG,CAAEhc,EAAOmjC,IAAUnjC,EAAQwvC,EAAKrM,GAASrwB,IAC1D24B,GAAS9C,EAMb,MAHc,gBADS4mB,EAAMvzC,KAAKnO,GAAMA,EAAI49B,aAExB4pB,IF1BpBH,aAAUvE,YAAoB,CAAmCkE,cGFjClH,EAAUmH,EAAY/1C,GACtD,MAAMg2C,EAAyB,IAAfh2C,EACV,IAAIw2C,GAA6B5H,GACjC,IAAI6H,GAA4B7H,GAEhCnsD,EAAImsD,EAAShsD,OAGnB,IAAI8zD,EAAU,GACVC,EAAa,GACbvJ,EAAgB,GACpB,MAAMwJ,EAAmBzgD,MAAM1T,GAAGgQ,KAAK,GACvC,IAAIokD,EAAe,EACnB,MAAMC,EAAW,GAGjBf,EAAWv0D,SAASytD,IAChB,MAAMl7C,OAAgCtI,IAArBwjD,EAAUl7C,OAAwB,EAAIk7C,EAAUl7C,QAE1Do1C,QACHA,EAAOqK,WAAEA,EAAU/iB,KAAEA,EAAI7G,UAAEA,EAASgqB,UAAEA,GACtCoC,EAAOhH,QAAQC,EAAWl7C,GAE9B2iD,EAAUA,EAAQj1C,OAAOgvB,GACzBkmB,EAAaA,EAAWl1C,OAAO0nC,GAC/BiE,EAAgBA,EAAc3rC,OAAO+xC,GACrCqD,GAAgBjtB,EAChBktB,EAAS11D,KAAKwyD,GAEd,IAAK,IAAIjsD,EAAI,EAAGA,EAAI6rD,EAAW5wD,OAAQ+E,IAAK,CACxC,MAAMovD,EAAMvD,EAAW7rD,GAAG,GAC1B,IAAK,IAAIkf,EAAI,EAAGA,EAAIkwC,EAAIn0D,OAAQikB,IAAK,CACjC,MAAM2d,EAAKuyB,EAAIlwC,GACf+vC,EAAiBpyB,IAAOiM,EAAK9oC,QAIzC,MAAMslD,EAAwByJ,EAAQz5C,KAAKnO,GAAMA,EAAI+nD,IAC/CzN,EAAiBwN,EAAiB35C,KAAKnO,GAAMA,EAAI+nD,IAKvD,MAHc,CACV1N,QAASwN,gBAAYvJ,wBAAeH,iBAAuB7D,WAAgB0N,IHtC/EX,aAAWa,aAAqB,CAAmClB,cIHlClH,EAAUmH,EAAY/1C,GACvD,MAAMg2C,EAAyB,IAAfh2C,EACV,IAAIi3C,GAA8BrI,GAClC,IAAIsI,GAA6BtI,GAGvC,IAAIiI,EAAe,EAInB,MAAMp0D,EAAImsD,EAAShsD,OACb8zD,EAAUvgD,MAAM1T,GAAGgQ,KAAK,GAC9B,IAAK,IAAIkjB,EAAI,EAAGA,EAAIlzB,EAAGkzB,IACnB+gC,EAAQ/gC,GAAKxf,MAAM1T,GAAGgQ,KAAK,GAE/BsjD,EAAWv0D,SAASytD,IAChB,MAAMl7C,OAAgCtI,IAArBwjD,EAAUl7C,OAAwB,EAAIk7C,EAAUl7C,QAC1D08B,KAACA,EAAI7G,UAAEA,GAAcosB,EAAOhH,QAAQC,EAAWl7C,GAEtD,IAAK,IAAIpM,EAAI,EAAGA,EAAIlF,EAAGkF,IACnB,IAAK,IAAIkf,EAAI,EAAGA,EAAIpkB,EAAGokB,IACnB6vC,EAAQ/uD,GAAGkf,IAAM4pB,EAAK9oC,GAAGkf,GAGjCgwC,GAAgBjtB,KAEpB,MAAMgjB,EAAyB8J,EAAQz5C,KAAKnO,GAAMA,EAAEmO,KAAK3N,GAAMA,EAAIunD,MAG7DM,EAAYhhD,MAAM1T,GAAGgQ,KAAK,GAChC,IAAK,IAAI+H,EAAI,EAAGA,EAAI/X,EAAI,EAAG+X,IACvB,IAAK,IAAIgb,EAAIhb,EAAI,EAAGgb,EAAI/yB,EAAG+yB,IAAK,CAC5B,MAAM4hC,EAAKxK,EAAuBpyC,GAAGgb,GAC/B6hC,EAAKzK,EAAuBp3B,GAAGhb,GACjC48C,EAAKC,EACLF,EAAU38C,IAAM,EACT48C,EAAKC,IACZF,EAAU3hC,IAAM,GAO5B,MADc,wBAAEo3B,iBADOuK,EAAUl6C,KAAKnO,GAAMA,GAAKrM,EAAI,OJtCxD0zD,aAAAa,wBKPG,oBCA8BxK,GAI9B,MAD4B,SAFZv8B,GAASu8B,EAAMpD,wCCJEoD,GACjC,MAAMvf,EAAKuf,EAAMpD,eAAexmD,OAGhC,MAD4B,SADZiD,KAAKuC,MAAMvC,KAAKwC,SAAW4kC,6BCKRuf,EAAO8K,GAC1C,MAAOlM,MAACA,EAAK1b,UAAEA,GAAc4nB,EAE7B,IAAIC,EAAc/K,EAAMpD,eAAensC,KAClCK,GAAQA,EAAIoyB,EAAa,EAAIpyB,IAG9Bk6C,EAAsBD,EAAYt6C,KACjCK,GAAc,IAANA,EAAW,EAAI,IAGxBm6C,EAAmBD,EAAoBn6C,QAAM,CAC5CC,EAAG/a,IAAM+a,EAAI/a,IAgBlB,GAZyB,IAArBk1D,IACAF,EAAcnnC,GAAiBo8B,EAAMpD,gBACrCoO,EAAsBD,EAAYt6C,KAC7BK,GAAc,IAANA,EAAW,EAAI,IAE5Bm6C,EAAmBD,EAAoBn6C,QAAM,CACxCC,EAAG/a,IAAM+a,EAAI/a,KAMlBk1D,EAAmBrM,GAA8B,IAArBqM,EAAwB,CAGpD,MAAMC,EAAoB,IAAIH,GAAaxoC,MAAI,CAC1Czf,EAAGpE,IAAMA,EAAIoE,IAEZqoD,EAAgBD,EAAkBtM,EAAQ,GAQhD,MAD4B,YANdoB,EAAMpD,eAGKnsC,KACpBK,GAAQA,GAAKq6C,EAAiB,EAAI,KAO3C,MAAMC,EAAiBzhD,MAAMi1C,GAAO34C,OAAOwK,KAAG,CACzColB,EAAG16B,IAAM9B,KAAKiL,KAAMnJ,GAAMA,EAAI,MAU7BkwD,EAAYN,EAAYt6C,KACzBK,GAAa,IAANA,EAAUnH,MAAMi1C,GAAO34C,KAAKmY,EAAAA,GAAYgtC,EAAe36C,KAAK1N,GAAMA,EAAI+N,MAChFuuB,OAMIpK,EAAM81B,EAAYt6C,KAAG,CACtBK,EAAG3V,IAAMwO,MAAMi1C,GAAO34C,KAAK9K,KAC9BkkC,OAEIisB,EAAQrpC,GAAMgT,EAAI7+B,QAAQmsB,MAAI,CAC/Bzf,EAAGpE,IAAM2sD,EAAUvoD,GAAKuoD,EAAU3sD,KAGjCygD,EAAax1C,MAAMohD,EAAY30D,QAAQ6P,KAAK,GAClD,IAAK,IAAI+H,EAAI,EAAGA,EAAI4wC,EAAO5wC,IAAK,CAG5BmxC,EADalqB,EADDq2B,EAAMt9C,MAEE,EAMxB,MAD4B,YAAEmxC,mBCzFJa,GAC1B,MAAM5zC,EAAM/S,KAAK+S,OAAO4zC,EAAMpD,gBAI9B,MADgB,SAFAoD,EAAMpD,eAAet+C,QAAQ8N,kBCYrB4zC,EAAO8K,GAC/B,MAAOlO,eAACA,EAAc6D,sBAAEA,EAAqBG,cAAEA,GAAkBZ,GAC1DpB,MAACA,GAAUkM,EAEZrqB,EAAKmc,EAAexmD,OACpBm1D,EAAK9K,EAAsBrqD,OAEjC,GAAIwoD,GAASne,EAAI,CAIb,MAD4B,YADT92B,MAAM82B,GAAIx6B,KAAK,IAMtC,MAAMulD,EAAQ,GAAK5M,EAAQ,GAG3B,IAAI6M,GAAW,EAEXjtD,EAAI,EAER,MAAMktD,EAAU,GAEhB,IAAI1H,EAAQpgC,GAAiBg5B,GAE7B,MAAM+O,EAAUhiD,MAAM82B,GAAIx6B,MAAK,GAC/B,IAAI2lD,EAAa3pC,GAAMwe,GAEvB,MAAMorB,EAAaliD,MAAM4hD,GAAItlD,KAAK,GAE5BsB,EAASoC,MAAM4hD,GAAItlD,KAAK,GAExB6lD,EAAYniD,MAAM4hD,GAAItlD,MAAK,SAEzBwlD,GAAYjtD,EAAIiiC,GAAI,CACxB,GAAU,IAANjiC,EAAS,CAETwlD,EAAQr6C,MAAM82B,GAAIx6B,KAAK,GACvB,IAAK,IAAI9K,EAAI,EAAGA,EAAIylD,EAAcxqD,OAAQ+E,IAAK,CAC3C,GAAI2wD,EAAU3wD,GAAI,SAClB,MAAMg5B,EAAK03B,EAAW1wD,GAChB4wD,EAASnL,EAAczlD,GAAGg5B,GAEhC,IAAK,IAAI9Z,EAAI,EAAGA,EAAI0xC,EAAO31D,OAAQikB,IAAK,CAEpC2pC,EADc+H,EAAO1xC,KACLomC,EAAsBtlD,GAAKoM,EAAOpM,IAG1D6oD,EAAQA,EAAM/0C,QAAM,CAAE4mB,EAAG16B,IAAMwwD,EAAQxwD,KACvCywD,EAAa3pC,GAAMwe,GAAIxxB,QAAQ9T,GAAMwwD,EAAQxwD,KAIjD,MAAM6wD,EAAWvoC,GAASugC,GACpB9B,EAAU0J,EAAWI,GACrBC,EAAiBjI,EAAMgI,GAE7B,IACIE,EADAC,EAAW,EAEf,GAHcF,GAAkBT,EAK5BU,EAAahK,EAGbiK,EAAW,EAAIX,EAAQS,EAGvBP,EAAQ92D,KAAKstD,GACbuJ,EAAWC,EAAQt1D,SAAWwoD,MAC3B,CAIHsN,EADeN,EADCtoC,GAAS0gC,IAM7B2H,EAAQO,IAAc,EACtB,IAAK,IAAI/wD,EAAI,EAAGA,EAAIylD,EAAcxqD,OAAQ+E,IAAK,CAC3C,GAAI2wD,EAAU3wD,GAAI,SAClB,MAAMg5B,EAAK03B,EAAW1wD,GAEtB,GADeylD,EAAczlD,GAAGg5B,GACrBj+B,SAASg2D,GAAa,CACZ,IAAbC,IACA5kD,EAAOpM,IAAMgxD,GAKjB,IAAIC,GAAeN,EAAU3wD,QACtBixD,GAAa,CAChBP,EAAW1wD,IAAM,EACjB,MAAMkxD,EAAMR,EAAW1wD,GAGvB,GAAIkxD,IAAQ5rB,EAAI,CACZqrB,EAAU3wD,IAAK,EACf,MAGJ,MAAMmxD,EAAU1L,EAAczlD,GAAGkxD,GAGjC,IAAK,IAAIhyC,EAAI,EAAGA,EAAIiyC,EAAQl2D,OAAQikB,IAAK,CACrC,MAAMmjC,EAAM8O,EAAQjyC,GACpB+xC,EAAcA,IAAgBT,EAAQnO,MAOtDh/C,GAAK,EAKJitD,GAEDpoD,QAAQkpD,KAAK,sDAGjB,MAAMpN,EAAax1C,MAAM82B,GAAIx6B,KAAK,GAClC,IAAK,IAAI9K,EAAI,EAAGA,EAAIuwD,EAAQt1D,OAAQ+E,IAAK,CAErCgkD,EADgBuM,EAAQvwD,KACD,EAG3B,MAD4B,YAAEgkD,IL1IjCqN,iBMD+BxM,GAC5B,MAAOI,uBAACA,GAA2BJ,EAC7B/pD,EAAImqD,EAAuBhqD,OAG3Bq2D,EAAS9iD,MAAM1T,GAAGgQ,KAAK,GACvBymD,EAAK,GAAMz2D,GAAKA,EAAI,GACpB02D,EAAahjD,MAAM1T,GACnB22D,EAAQjjD,MAAM+iD,GACpB,IAAI9tD,EAAI,EACR,IAAK,IAAIzD,EAAI,EAAGA,EAAIlF,EAAI,EAAGkF,IACvB,IAAK,IAAIkf,EAAIlf,EAAI,EAAGkf,EAAIpkB,EAAGokB,IAAK,CAC5B,MAAMwyC,EAASzM,EAAuBjlD,GAAGkf,GAAK+lC,EAAuB/lC,GAAGlf,GACxEwxD,EAAW/tD,GAAKvF,KAAK+L,IAAIynD,GAGzB,MAAMC,EAAQD,EAAS,EACvBJ,EAAOtxD,IAAO2xD,EAAS,EAAI,EAC3BL,EAAOpyC,IAAQyyC,EAAa,EAAJ,EACxBF,EAAMhuD,GAAMkuD,EAAS3xD,EAAIkf,EACzBzb,GAAK,EAMb,MAAMmuD,EAAU9qC,GAAMyqC,GAAInqC,MAAI,CAAEzf,EAAGpE,IAAMiuD,EAAW7pD,GAAK6pD,EAAWjuD,KAGpE,IAAIwjD,EAAUuK,EAAOr7C,WAAW9O,GAAY,IAANA,IAClC0qD,EAAQ,QACO,IAAZ9K,GAAgB,CAKnBuK,EAFmBG,EADJG,EAAQC,MAGD,EAEtB9K,EAAUuK,EAAOr7C,WAAW9O,GAAY,IAANA,IAClC0qD,GAAS,EAIb,MAD4B,SAAE9K,2BCxCGlO,GACjC,MAAMr+C,EAAOvB,KAEbuB,EAAKipD,MAAQ,EAEbjpD,EAAKyf,IAAG,CAAIkoC,EAAS0C,KAOjB,GAAiC,eAA7BrqD,EAAKqpD,qBAAqE,gBAA7BrpD,EAAKqpD,oBAAuC,CACzF,MAAM8L,EAAwB,CAAElM,MAAOjpD,EAAKipD,MAAO1b,UAAW,IAExD+pB,GAAsBC,EADLC,GAAgBx3D,EAAKu3D,iBACDlN,EAAO8K,IAC3C3L,WAACA,GAAe8N,EAEvB,MADwB,YAAE9N,UAAY7B,QAAS0C,GAGnD,MAAMiN,EAAsBE,GAAgBx3D,EAAKu3D,gBAAgBlN,IAC1DkC,QAACA,GAAY+K,EAGpB,MADwB,SAAE/K,SADX5E,EAAQ4E,SACoBlC,IAO/CrqD,EAAKy3D,mBAAqB,CACtB,CACIphD,KAAM,kBAAmBvX,MAAO,iBAAkB4L,KAAM,aAAcgtD,WAAY,aAEtF,CACIrhD,KAAM,YAAavX,MAAO,YAAa4L,KAAM,eAAgBgtD,WAAY,aAE7E,CACIrhD,KAAM,gBAAiBvX,MAAO,eAAgB4L,KAAM,eAAgBgtD,WAAY,aAEpF,CACIrhD,KAAM,QAASvX,MAAO,QAAS4L,KAAM,eAAgBgtD,WAAY,SAErE,CACIrhD,KAAM,MAAOvX,MAAO,MAAO4L,KAAM,cAAegtD,WAAY,WAEhE,CACIrhD,KAAM,UAAWvX,MAAO,UAAW4L,KAAM,eAAgBgtD,WAAY,aAK7E13D,EAAKqpD,kBAAiB,IAASrpD,EAAK23D,iCAAiC33D,EAAKu3D,gBAAgB7sD,KAC1F1K,EAAK23D,iCAAmC,GACxC33D,EAAKy3D,mBAAmBp4D,SACnBsN,IAAQ3M,EAAK23D,iCAAiChrD,EAAE7N,OAAS6N,KAW1D3M,EAAK43D,kBAAqB94D,IAC1BkB,EAAIu3D,eAA6Bz4D,IAC7B44D,WAAc13D,EAAA23D,iCAAA74D,GAAA44D,iBACdG,EAAK73D,EAAAqpD,oBACE,eAAVwO,GACG73D,EAAKipD,MAAQ,EACbjpD,EAAKmpD,oBAAsB,IACvB,gBAAA0O,GACJ73D,EAAKipD,MAAQ,EACbjpD,EAAKmpD,oBAAsB,KAElCnpD,EAAAipD,MAAA,EAEsDjpD,EAAAmpD,oBAAA,MAO/CyO,kBAAsB,eACtBr9C,YAAava,EAAC,CACdqX,MAAO,mBACPmC,KAAM,yBAAmBxZ,EAAA43D,kBAAAvuD,QAACrJ,EAAAy3D,mBAC7B/9C,OAAA,CAER,gCChGgC2kC,GAC7B,MAAMr+C,EAAOvB,KAEbuB,EAAKkpD,aAAe,IAAI4O,GAAazZ,GACrCr+C,EAAK6d,WAAa,EAElB7d,EAAK+3D,cAAiB3qD,IAAQpN,EAAK6d,WAAazQ,GAKhD,MAAM4qD,EAAarP,GACS,IAApB3oD,EAAK6d,WACE8qC,EAAY7tC,KAAKm9C,GAAQA,EAAGj9C,SAEhC2tC,EAAY7tC,KAAKm9C,GAAQA,EAAG37C,SAIjC47C,EAAWvQ,GACW,IAApB3nD,EAAK6d,WACE8pC,EAAQ7sC,KAAK+sC,GAASA,EAAI7sC,SAE9B2sC,EAAQ7sC,KAAK+sC,GAASA,EAAIvrC,SAKrCtc,EAAK4oD,YAAc,SAAUD,EAAahB,EAASY,GAC/C,MAAM8B,EAAQrqD,EAAKgqD,UAAUrB,EAAahB,EAASY,GAEnD,OADwBvoD,EAAKkpD,aAAazpC,IAAIkoC,EAAS0C,IAM3DrqD,EAAKgqD,UAAS,CAAIrB,EAAahB,EAASY,KACpC,MAAMqL,EAAaoE,EAAUrP,GACvB8D,EAAWyL,EAAQvQ,IAClBgM,KAACA,GAASwE,GAAYn4D,EAAKkpD,aAAawO,YAE/C,OADc/D,EAAKlH,EAAUmH,EAAY5zD,EAAK6d,WAAY0qC,IAI9DvoD,EAAK8oD,UAAS,CAAIxB,EAAWI,EAAkBa,KAC3C,MAAMI,EAAc,CAACrB,GACfK,EAAUD,EAAiBE,gBAC3BkF,EAAYkL,EAAUrP,GAAa,GACnCyP,EAAUF,EAAQvQ,IACjBqM,aAACA,GAAiBmE,GAAYn4D,EAAKkpD,aAAawO,YAEvD,OADa1D,EAAaoE,EAAStL,EAAW9sD,EAAK6d,WAAY0qC,gBCzD9B1C,EAAWvxC,GAChD,MAAMtU,EAAOvB,KAEPysB,EAAS,IAAIC,GAAc06B,EAAWA,EAAUhB,QAASgB,EAAUf,QAASxwC,GAClFtU,EAAKkrB,OAASA,EAEdlrB,EAAKq4D,SAAW,EAChBr4D,EAAKs4D,YAAc,SAAUD,GACzBr4D,EAAKq4D,SAAWA,GAGpBr4D,EAAKu4D,QAAWC,IACZx4D,EAAKw4D,KAAOA,GAGhBx4D,EAAKqe,iBAAmB,WACpB6M,EAAOlO,SAEP,MAAOrQ,EAACA,EAACC,EAAEA,EAAC2Q,OAAEA,GAAWsoC,EAEV,IAAXtoC,IAEJyO,GAAiBI,GAAYpsB,EAAKq4D,UAAW1rD,EAAGC,EAAe,GAAXse,EAAO1pB,EAAU,EAAG,GAAI,EAAG,OAAQ,EAAG8S,EAAOlS,WAE/EkH,IAAdtJ,EAAKw4D,MACLxsC,GAAiBhsB,EAAKw4D,KAAM7rD,EAAGC,EAAe,GAAXse,EAAO1pB,EAAU,GAAK,EAAG,GAAI,EAAG,OAAQ,EAAG8S,EAAOlS,oBCf5DyjD,EAAWz6B,EAAO9W,GACnD,MAAMtU,EAAOvB,KACbuB,EAAK6lD,UAAYA,EAEjB7lD,EAAKmd,QAAU,IAAIs7C,GAAiB5S,EAAWvxC,GAE/C8W,EAAME,gBAAgBu6B,EAAW7lD,EAAKmd,QAAQ+N,oBCVTrO,GACrC,MAAM7c,EAAOvB,KAEPi6D,EAAU,GAIhB14D,EAAKid,aAAe,SAAU07C,GAC1BD,EAAQz5D,KAAK05D,IAEjB34D,EAAK44D,iBAAgB,IAASF,EAAQp/C,QAAQq/C,GAAWA,EAAO9S,UAAUtoC,SAE1Evd,EAAK4nD,cAAa,IACI5nD,EAAK44D,mBACN99C,KAAK69C,GAAWA,EAAO9S,YAE5C7lD,EAAK64D,iBAAgB,IAASH,EAAQ59C,KAAK69C,GAAWA,EAAO9S,YAI7D7lD,EAAK84D,sBAAyBC,IACF/4D,EAAK44D,mBACbv5D,SAAO,CAAEs5D,EAAQ12B,KAC7B,MAAMo2B,EAAWU,EAAU92B,GAC3B02B,EAAOx7C,QAAQm7C,YAAYD,OAGnCr4D,EAAKg5D,iBAAoBC,IACGj5D,EAAK44D,mBACbv5D,SAAO,CAAEs5D,EAAQ12B,KAC7B,MAAMi3B,EAAMD,EAAgBh3B,GAC5B02B,EAAOx7C,QAAQo7C,QAAQW,OAG/Bl5D,EAAKme,SAAQ,KACTu6C,EAAQr5D,SAASs5D,GAAWA,EAAO9S,UAAU1nC,cAKjDne,EAAKqe,iBAAgB,KACbxB,EAAIyB,WACJte,EAAKue,sBAELve,EAAKwe,4BAGbxe,EAAKwe,yBAAwB,KACDxe,EAAK44D,mBACbv5D,SAASs5D,GAAWA,EAAOx7C,QAAQkB,sBAEvDre,EAAKue,oBAAmB,KACpBm6C,EAAQr5D,SAASs5D,GAAWA,EAAOx7C,QAAQkB,sBAE/Cre,EAAKm5D,iBAAgB,IAAST,EAAQj4D,mBC3DR24D,EAAoB1R,EAAkB7qC,GACpE,MAAO4uC,eACHA,EAAcE,kBACdA,GACAyN,EAEEzR,EAAUD,EAAiBE,gBAE3ByR,WAYW5N,EAAgB9D,GAEjC,MAAMb,EAAWa,EAAQ7sC,KAAK+sC,GAAQA,EAAI3C,YAU1C,OATqBuG,EAAe3wC,KAC/BgvC,GAAQA,EAAIhvC,KACRsuC,IACG,MAAOnC,eAACA,GAAmBmC,EAAgBiB,MAE3C,OADctC,GAAad,EAAgBH,QAnBlCwS,CAAY7N,EAAgB9D,GAC3C4R,WA0BiB5N,EAAmBhE,EAAS9qC,GAEnD,IAAI08C,EACJ,GAAsD,iBAAlD18C,EAAIiB,SAASorC,aAAaG,oBAC1BkQ,EAAwB5N,EAAkB7wC,KACrCsuC,GAAoBA,EAAgBE,OAAO/gD,YAE7C,CACH,MAAMu+C,EAAWa,EAAQ7sC,KAAK+sC,GAAQA,EAAI3C,YAC1CqU,EAAwB5N,EAAkB7wC,KACrCsuC,IACG,MAAOI,WAACA,GAAeJ,EACjB9e,EAAMkf,EAAWtuC,QAAM,CAAEC,EAAG/a,IAAM+a,EAAI/a,IAG5C,OADcgnD,GAAYW,GADRyB,EAAW1uC,KAAKnO,GAAMA,EAAI29B,IACMwc,OAK9D,OAAOyS,EA7CuBC,CAAkB7N,EAAmBhE,EAAS9qC,GACtE48C,WA2DU9N,EAAAhE,UACfgE,EAAA7wC,KAAAsuC,IACD,MAAOnC,eAAqBA,GAAAmC,EAAAiB,qBAC/B1C,EAAA7sC,KAAA+sC,GAAAA,EAAA3C,iBA9DiCwU,CAAkB/N,EAAmBhE,GAOnE,MALW,cACP0R,wBACAI,wBACAF,eCV2BhkC,EAAIC,EAAIlhB,GACvC,MAAMtU,EAAOvB,KAUDmD,EAAUC,SAAAC,cAAe,UACrCF,EAAMF,MAAS6zB,EAEf3zB,EAAmBD,OAAA6zB,EACnB,MAAKmkC,EAAU/3D,EAAMK,WAAA,MACjB23D,EAAQD,EAAME,gBAAYtkC,EAAAC,UAIbC,UACLhkB,KAAUA,GAAUmoD,MACpB,IAAIjtD,EAAG,EAAIA,EAAG4oB,EAAE5oB,IAAK,IAAI,IAAKC,EAAG,EAAGA,EAAA4oB,EAAA5oB,IAAA,CACpC,MAAM/D,EAAI4sB,EAAC9oB,GAAKC,GAAA,GAAQ,GAClB9D,EAAI2sB,EAAC9oB,GAAKC,GAAA,GAAQ,GACxB6E,EAAoB,GAAd9E,EAAIC,EAAI2oB,GAAU,GAAQ,IAAH1sB,EAChC4I,EAAA,GAAA9E,EAAAC,EAAA2oB,GAAA,GAAA,KAAA1sB,EAAAC,GAGL2I,EAAoB,GAAb9E,EAAAC,EAAA2oB,GAAa,GAAe,IAAHzsB,EACnC2I,EAAA,GAAA9E,EAAAC,EAAA2oB,GAAA,GAAA,IAGGokC,EAAOG,aAAMF,EAAI,EAAS,iBAIPpxB,UACX/2B,KAAUA,GAAQmoD,MAClB,IAAIhtD,EAAG,EAAIA,EAAG4oB,EAAE5oB,IAAK,IAAI,IAAKD,EAAA,EAAAA,EAAA4oB,EAAA5oB,IAAA,CAC9B,MAAMpE,EAAQigC,EAAO77B,GAAGC,IACjB/D,EAAGC,EAACC,GAAKR,EAChBkJ,EAAoB,GAAd9E,EAAIC,EAAI2oB,GAAU,GAAK1sB,EAChC4I,EAAA,GAAA9E,EAAAC,EAAA2oB,GAAA,GAAAzsB,EAGL2I,EAAoB,GAAb9E,EAAAC,EAAA2oB,GAAa,GAAYxsB,EACnC0I,EAAA,GAAA9E,EAAAC,EAAA2oB,GAAA,GAAA,IAGGokC,EAAOG,aAAMF,EAAU,EAAA,MAEvB58C,OAAK,CAAA+8C,EAAAC,KACL,MAAK13D,KAASA,GAAUgS,EACxBhS,EAAK2J,OACR3J,EAAA23D,uBAAA,EACoB33D,EAAAiR,UAAA3R,EAAA,EAAA,EAAAm4D,EAAAC,GACiC13D,EAAA8J,uBCvD1BsyC,EAAcgJ,EAAkBpzC,EAAQuI,GACpE,MAAM7c,EAAOvB,KAGbuB,EAAKk6D,WAAa,IAAIC,GAAWzb,EAAanpB,GAAImpB,EAAalpB,GAAIlhB,GAInEtU,EAAK0d,OAAU07C,IACX,MAAMgB,EAAKC,GAAUjB,EAAoB1R,EAAkB7qC,IACpDw8C,aAACA,EAAYI,sBAAEA,EAAqBF,sBAAEA,GAA0Ba,EACvEp6D,EAAKy5D,sBAAwBA,EAC7Bz5D,EAAKs6D,aAAef,EACpBv5D,EAAKk6D,WAAWK,WAAWlB,IAK/B,MAAMlxB,EAAc,IACdC,EAAe,IAIrBpoC,EAAKgd,OAAM,KACPhd,EAAKw6D,oBACLx6D,EAAKy6D,mBACLz6D,EAAK06D,qBACL16D,EAAK26D,uBAGT36D,EAAKy6D,iBAAgB,KACjBz6D,EAAKk6D,WAAWl9C,OAAOmrB,EAAaC,GACpCsW,EAAa/W,cAAcO,cAAcC,EAAaC,IAG1DpoC,EAAK06D,mBAAkB,KACnB,MAAOnyB,oBAACA,GAAwBmW,EAAa/W,cAC7CY,EAAoB,IAAK,EAAGJ,EAAaC,EAAcpoC,EAAKs6D,eAGhEt6D,EAAK26D,oBAAmB,KACpB,MAAOpyB,oBAACA,GAAwBmW,EAAa/W,cAC7CY,EAAoB,IAAK,EAAGJ,EAAaC,EAAcpoC,EAAKy5D,wBAIhEz5D,EAAKw6D,kBAAiB,KAClB9b,EAAamL,mBAAmBxqD,SAASyqD,IACrCA,EAAIzqD,SAAS0iC,IACTA,EAAK1iC,SAASu7D,IACV,GAAgC,IAA5B/9C,EAAIiB,SAASD,WAAkB,CAC/B,MAAOlR,EAACA,GAAMiuD,EAAW5/C,QAClBpO,EAACA,GAAMguD,EAAWt+C,OAGzBu+C,EAAYluD,EAFAC,EAAI,IAAO,OAGpB,CACH,MAAOD,EAACA,EAACC,EAAEA,GAAMguD,EAAWt+C,OAC5Bu+C,EAAYluD,EAAGC,cAUnC,MAAMhL,EAASC,SAASC,cAAc,UAChC63D,EAAS/3D,EAAOK,WAAW,eAWxB44D,EAAYluD,EAAGC,GACpB,MAAO5K,IAACA,GAAQsS,EAEhBtS,EAAIuR,UAAU3R,EAAQ+K,EAAI,EAAGC,EAAI,EAAG,GAAI,IAXxChL,EAAOF,MAAQ,GACfE,EAAOD,OAAS,GAChBg4D,EAAOrsD,YACPqsD,EAAOpyD,UAAY,OACnBoyD,EAAOvpD,IAAI,EAAG,EAAG,EAAG,EAAG,EAAI1M,KAAKsJ,IAChC2sD,EAAOrpD,mBC1EgBouC,EAAcgJ,EAAkBpzC,EAAQuI,GACnE,MAAM7c,EAAOvB,KAEPq8D,EAAU,IAAIC,GAAQrc,EAAcgJ,EAAkBpzC,EAAQuI,GACpE,IAAIm+C,GAAe,EAEnB,MAAOn9C,WAACA,GAAehB,EAAIiB,SACrB0sB,EAAgC,IAAf3sB,EAAoB4sB,GAAgBC,GAC3DgU,EAAathC,aAAasO,GAAe,IAAI8e,EAAc9e,EAAYpX,KAEvEtU,EAAK8wB,MAAK,KACNxc,EAAOjQ,YAEXrE,EAAK+wB,KAAI,KACLzc,EAAO/P,WAEP,MAAM02D,EAAgBjnD,MAAM0zC,EAAiByR,oBAAoB7oD,UAAKhH,GACtEo+C,EAAiBsR,iBAAiBiC,IAGtCj7D,EAAK0d,OAAS,SAAU07C,GACpB,MAAOzrD,MAACA,GAAUyrD,EAClB,QAAc9vD,IAAVqE,EAEA,YADAqtD,GAAe,GAGnBA,GAAe,EAEfF,EAAQp9C,OAAO07C,GAEf,MAAOlP,iBAACA,EAAgBV,WAAEA,GAAe4P,EACzC1R,EAAiBsR,iBAAiBxP,GAClC9B,EAAiBoR,sBAAsB5O,EAAiBG,MAAMpD,iBAGlEjnD,EAAKgd,OAAS,WACNg+C,IAEJF,EAAQ99C,SAER0hC,EAAa1hC,uBCtDiBosC,GAClC,MAAOI,WAACA,GAAeJ,GAChBiB,MAACA,GAAUjB,GACXnC,eAACA,GAAmBoD,EAC3B,QAAmB/gD,IAAfkgD,EAA0B,CAC1B,MAAM1e,EAAKuf,EAAMpD,eAAexmD,OAC1B+3D,EAAOxkD,MAAM82B,GAAIx6B,KAAK,GAG5B,OAFAkoD,EAAKpP,EAAgBmD,SAAW,EAEzB,gBAAEtF,EAAgBuC,WAAYgP,GAEzC,MAAO,gBAAEvR,aAAgBuC,eCQKoR,EAAYlT,EAAkBpzC,GAG5D,IAAI2xB,EACA0hB,EAHSlpD,KAIRif,OAAS,WACViqC,EAAUD,EAAiBE,gBAC3B,MAAMrtB,EAASotB,EAAQ7sC,KAAKnW,GAAM,CAACA,EAAEgI,EAAGhI,EAAEiI,KACpCyzB,EAAW2E,GAASZ,KAAK7J,GAC/B0L,EAAU5F,EAAS4F,QAAQ,CAAC,EAAG,EAAG3xB,EAAO5S,MAAO4S,EAAO3S,UAR9ClD,KAWRue,OAAS,WACV,MAAOhb,IAACA,GAAQsS,GACT3H,EAACA,EAACqO,OAAEA,GAAW4/C,GACfr5D,EAACA,EAACqa,eAAEA,GAAmBZ,EACxBxZ,EAAI,IAEVQ,EAAIiK,OAOJjK,EAAIsL,YACJ69B,IAEAnpC,EAAIoR,OAEJ,MAAM9S,EAAIqnD,EAAQlnD,OAClB,IAAK,IAAI4X,EAAI,EAAGA,EAAI/X,EAAG+X,IACnBrW,EAAIsL,YACJ24B,EAAQ9D,WAAW9pB,EAAGrW,GACtBA,EAAIuF,UAAYogD,EAAQtvC,GAAG9P,MAC3BvG,EAAIsO,OACJtO,EAAIqO,kBASC86B,IACkB,aAAnBvvB,aAOJ,MAAMguB,EAAQroC,EAAImC,KAAKiL,KAAK,EAAIjL,KAAKsJ,IAC/B68B,EAAMroC,EACNiF,EAAS,IAEfzE,EAAI6L,OAAO,EAAGpH,GACd,MAAMqjC,EAAK,GACX,IAAK,IAAItkC,EAAI,EAAGA,GAAK8O,EAAO5S,MAAO8D,GAAK,EAAG,CACvC,MAAM04B,EAAK,KAAQ14B,EAAImH,GAAKi9B,IAAU,EAChCh9B,EAAInG,EAASojC,EAAMnmC,KAAKspB,KAAKkR,GACnC4L,EAAG7qC,KAAK2N,GACR5K,EAAI+L,OAAOvI,EAAGoH,GAGlB5K,EAAI+L,OAAOuG,EAAO5S,MAAO+E,GACzBzE,EAAI+L,OAAO,EAAGtH,GApBVsjC,GAwBJ/nC,EAAIuO,KAAK5D,EAAQ,GAAJpL,EAAS,IAAeA,EAAGC,GAhC5CQ,EAAIsL,YACJ69B,IACAnpC,EAAIqO,SAEJrO,EAAIoK,uBC5CsBwuD,EAAYlT,EAAkBpzC,GAG5D,IAAI2xB,EACA0hB,EAHSlpD,KAIRif,OAAS,WACViqC,EAAUD,EAAiBE,gBAC3B,MAAMrtB,EAASotB,EAAQ7sC,KAAKnW,GAAM,CAACA,EAAEgI,EAAGhI,EAAEiI,KACpCyzB,EAAW2E,GAASZ,KAAK7J,GAC/B0L,EAAU5F,EAAS4F,QAAQ,CAAC,EAAG,EAAG3xB,EAAO5S,MAAO4S,EAAO3S,UAR9ClD,KAWRue,OAAS,WACV,MAAOhb,IAACA,GAAQsS,EAEhBtS,EAAIiK,OAMJjK,EAAIsL,YACJtL,EAAIoO,IAAIwqD,EAAWjuD,EAAGiuD,EAAWhuD,EAAyB,GAAtBguD,EAAWt+C,OAAO/a,EAAS,EAAG,EAAImC,KAAKsJ,IAE3EhL,EAAIoR,OAEJ,MAAM9S,EAAIqnD,EAAQlnD,OAClB,IAAK,IAAI+E,EAAI,EAAGA,EAAIlF,EAAGkF,IACnBxD,EAAIsL,YACJ24B,EAAQ9D,WAAW38B,EAAGxD,GACtBA,EAAIuF,UAAYogD,EAAQniD,GAAG+C,MAC3BvG,EAAIsO,OACJtO,EAAIqO,SAGRrO,EAAIsL,YACJtL,EAAIoO,IAAIwqD,EAAWjuD,EAAGiuD,EAAWhuD,EAAyB,GAAtBguD,EAAWt+C,OAAO/a,EAAS,EAAG,EAAImC,KAAKsJ,IAC3EhL,EAAIqO,SAEJrO,EAAIoK,uBC3C0Bg+B,EAAcsd,EAAkBpzC,EAAQuI,GAC1E,MAAM7c,EAAOvB,MAGNof,WAACA,GAAehB,EAAIiB,SACrBo9C,EAA0B,IAAfr9C,EAAoBs9C,GAAYC,GAEjDhxB,EAAahtB,aADUsO,GAAe,IAAIwvC,EAAQxvC,EAAYg8B,EAAkBpzC,KAGhFtU,EAAK8wB,MAAK,OACV9wB,EAAK+wB,KAAI,KAEL,MAAMkqC,EAAgBjnD,MAAM0zC,EAAiByR,oBAAoB7oD,UAAKhH,GACtEo+C,EAAiBsR,iBAAiBiC,IAGtCj7D,EAAK0d,OAAS,SAAU0rC,GACpB,MAAOz7C,MAACA,GAAUy7C,EAClB,QAAc9/C,IAAVqE,EAAqB,OAEzB,MAAOs5C,eAACA,EAAcuC,WAAEA,GAAe6R,GAAcjS,GACrD1B,EAAiBsR,iBAAiBxP,GAClC9B,EAAiBoR,sBAAsB7R,GACvC7c,EAAave,iBAGjB7rB,EAAKgd,OAAS,WACVotB,EAAaptB,sBC7BoB49C,EAAYlT,EAAkBpzC,GAGnE,IAAIqzC,EACAnf,EACA8kB,EAJS7uD,KAKRif,OAAS,SAAUi3C,GAGpB,IAAI3N,EACAmL,EACJ,QAAiB7oD,IAAbqrD,EAAwB,CACxBhN,EAAUD,EAAiBE,gBAC3B,MACM7sC,EAAKq3C,GADMzK,EAAQ7sC,KAAK+sC,GAAQA,EAAI7sC,UAE1CgsC,EAAUjsC,EAAGisC,QACbmL,EAAkBp3C,EAAGo3C,qBAErBnL,EAAU2N,EAAS3N,QACnBmL,EAAkBwC,EAASxC,gBAG/BxK,EAAUD,EAAiBE,gBAC3B,MAAMtnD,EAAIqnD,EAAQlnD,OACZ66D,EAAY3T,EAAQ7sC,KAAK+sC,GAAQA,EAAI3C,YAErCmN,EAAKF,EAAgB1xD,OAAS,EACpC6sD,EAAYt5C,MAAMq+C,GAClB7pB,EAASx0B,MAAMq+C,GACf,IAAK,IAAI7sD,EAAI,EAAGA,EAAI6sD,EAAI7sD,IAAK,CACzB8nD,EAAU9nD,GAAK,CAAC2sD,EAAgB3sD,GAAI2sD,EAAgB3sD,EAAI,IACxD,MAAMqtD,EAAc7L,EAAQxhD,GAAGsV,KAAKjS,GAAMvI,EAAIuI,IAC9C2/B,EAAOhjC,GAAK4hD,GAAYW,GAAa8K,EAAayI,MA/B7C78D,KAmCRue,OAAS,WACV,MAAOhb,IAACA,GAAQsS,GACT3H,EAACA,EAACqO,OAAEA,GAAW4/C,GACfr5D,EAACA,EAACqa,eAAEA,GAAmBZ,EACxBxZ,EAAI,IAEVQ,EAAIiK,OAOJjK,EAAIsL,YACJ69B,IAEAnpC,EAAIoR,OAEJ,MAAM9S,EAAIgtD,EAAU7sD,OACpB,IAAK,IAAI4X,EAAI,EAAGA,EAAI/X,EAAG+X,IACnBkjD,GAAejO,EAAUj1C,GAAImwB,EAAOnwB,GAAIrW,EAAKsS,YASxC62B,IACkB,aAAnBvvB,aAOJ,MAAMguB,EAAQroC,EAAImC,KAAKiL,KAAK,EAAIjL,KAAKsJ,IAC/B68B,EAAMroC,EACNiF,EAAS,IAEfzE,EAAI6L,OAAO,EAAGpH,GACd,MAAMqjC,EAAK,GACX,IAAK,IAAItkC,EAAI,EAAGA,GAAK8O,EAAO5S,MAAO8D,GAAK,EAAG,CACvC,MAAM04B,EAAK,KAAQ14B,EAAImH,GAAKi9B,IAAU,EAChCh9B,EAAInG,EAASojC,EAAMnmC,KAAKspB,KAAKkR,GACnC4L,EAAG7qC,KAAK2N,GACR5K,EAAI+L,OAAOvI,EAAGoH,GAGlB5K,EAAI+L,OAAOuG,EAAO5S,MAAO+E,GACzBzE,EAAI+L,OAAO,EAAGtH,GApBVsjC,GAwBJ/nC,EAAIuO,KAAK5D,EAAQ,GAAJpL,EAAS,IAAeA,EAAGC,GAhC5CQ,EAAIsL,YACJ69B,IACAnpC,EAAIqO,SAEJrO,EAAIoK,oBAiCHmvD,GAAexN,EAAUxlD,EAAOvG,EAAKsS,GAC1C,MAAM3H,EAAIjJ,KAAK+S,IAAI,EAAGs3C,EAAS,IAEzBxsD,EADKmC,KAAKkqB,IAAItZ,EAAO5S,MAAOqsD,EAAS,IAC5BphD,EAETnL,EAAI8S,EAAO3S,OAEjBK,EAAIsL,YACJtL,EAAIuO,KAAK5D,EAJC,EAIKpL,EAAGC,GAClBQ,EAAIuF,UAAYgB,EAChBvG,EAAIsO,OACJtO,EAAIqO,qBC3GiCuqD,EAAYlT,EAAkBpzC,GAGnE,IAAIqzC,EACAnf,EACAqoB,EAJSpyD,KAKRif,OAAS,SAAUi3C,GAGpB,IAAI3N,EACJ,QAAiB19C,IAAbqrD,EAAwB,CACxBhN,EAAUD,EAAiBE,gBAC3B,MAAM6E,EAAW9E,EAAQ7sC,KAAK+sC,GAAQA,EAAIvrC,SAEpCvB,EAAKw2C,GADOqJ,EAAWt+C,OACiBmwC,GAC9CzF,EAAUjsC,EAAGisC,QACb6J,EAAQ91C,EAAG81C,WAEX7J,EAAU2N,EAAS3N,QACnB6J,EAAQ8D,EAAS9D,MAGrBlJ,EAAUD,EAAiBE,gBAE3B,MAAMtnD,EAAIqnD,EAAQlnD,OACZswD,EAAKF,EAAMpwD,OACjB+nC,EAASx0B,MAAM+8C,GACf,MAAMuK,EAAY3T,EAAQ7sC,KAAK+sC,GAAQA,EAAI3C,YAC3C,IAAK,IAAI1/C,EAAI,EAAGA,EAAIurD,EAAIvrD,IAAK,CACzB,MAAMqtD,EAAc7L,EAAQxhD,GAAGsV,KAAKjS,GAAMvI,EAAIuI,IAC9C2/B,EAAOhjC,GAAK4hD,GAAYW,GAAa8K,EAAayI,MA7B7C78D,KAiCRue,OAAS,WACV,MAAOhb,IAACA,GAAQsS,EAEhBtS,EAAIiK,OAEJ,MAAM8kD,EAAKF,EAAMpwD,OACjB,IAAK,IAAI+E,EAAI,EAAGA,EAAIurD,EAAIvrD,IACpBxD,EAAIsL,YACJkuD,GAASx5D,EAAK6uD,EAAMrrD,IACpBxD,EAAIuF,UAAYihC,EAAOhjC,GACvBxD,EAAImF,YAAcqhC,EAAOhjC,GACzBxD,EAAIsO,OACJtO,EAAIqO,SAIRrO,EAAImF,YAAc,OAClBnF,EAAIsL,YACJtL,EAAIoO,IAAIwqD,EAAWjuD,EAAGiuD,EAAWhuD,EAAyB,GAAtBguD,EAAWt+C,OAAO/a,EAAS,EAAG,EAAImC,KAAKsJ,IAC3EhL,EAAIqO,SAEJrO,EAAIoK,oBAIHovD,GAASx5D,EAAK+/B,GACnB,MAAM0Z,EAAK1Z,EAAKthC,OACVg7D,EAAQ15B,EAAK0Z,EAAK,GACxBz5C,EAAI6L,OAAO4tD,EAAM,GAAIA,EAAM,IAC3B,IAAK,IAAIj2D,EAAI,EAAGA,EAAIi2C,EAAIj2C,IAAK,CACzB,MAAMk2D,EAAQ35B,EAAKv8B,GACnBxD,EAAI+L,OAAO2tD,EAAM,GAAIA,EAAM,iBC/DUtxB,EAAcsd,EAAkBpzC,EAAQuI,GACjF,MAAM7c,EAAOvB,MAGNof,WAACA,GAAehB,EAAIiB,SACrB69C,EAAiC,IAAf99C,EAAoB+9C,GAAmBC,GAE/DzxB,EAAahtB,aADUsO,GAAe,IAAIiwC,EAAejwC,EAAYg8B,EAAkBpzC,KAGvFtU,EAAK8wB,MAAK,OACV9wB,EAAK+wB,KAAI,KAEL,MAAMkqC,EAAgBjnD,MAAM0zC,EAAiByR,oBAAoB7oD,UAAKhH,GACtEo+C,EAAiBsR,iBAAiBiC,IAGtCj7D,EAAK0d,OAAS,SAAU0rC,GACpB,MAAOz7C,MAACA,GAAUy7C,EAClB,QAAc9/C,IAAVqE,EAAqB,OAEzB,MAAOs5C,eAACA,EAAcuC,WAAEA,GAAe6R,GAAcjS,GACrD1B,EAAiBsR,iBAAiBxP,GAClC9B,EAAiBoR,sBAAsB7R,GACvC,MAAO0N,SAACA,GAAavL,EAAgBiB,MACrCjgB,EAAave,cAAc8oC,IAG/B30D,EAAKgd,OAAS,WACVotB,EAAaptB,sBChCU0qC,EAAkBpzC,GAC7C,MAAMtU,EAAOvB,KAKb,IAAI01D,EACAxM,WAsCKmU,EAAU95D,EAAK+5D,EAAMC,GAC1B,MAAOpN,KAACA,EAAIY,QAAEA,EAAO1C,UAAEA,GAAcqH,GAC9BxnD,EAACA,EAACpL,EAAEA,EAACqa,eAAEA,GAAmBkxC,EAC3BmP,EAAQtU,EAAQlnD,OAEhBivD,EAA8B,aAAnB9zC,EACXwzC,EAAQR,EAAKjiD,EACbi9B,EAAQroC,EAAImC,KAAKiL,KAAK,EAAIjL,KAAKsJ,IAC/B68B,EAlDA,IAkDUoyB,EACVx1D,EAAS8L,IAAmBwpD,EAAOlyB,EAGnCx3B,EAAO3O,KAAK+S,KAAI,EAAI24C,EAAM,IAChCptD,EAAI6L,OAAOwE,EAAM5L,GACjB,MAAMy1D,EAAK9M,EAAM3uD,OACjB,IAAK,IAAI+E,EAAI,EAAGA,EAAI02D,EAAI12D,GAAK,EAAG,CAC5B,MAAM22D,EAAK/M,EAAM5pD,GACjB,GAAI22D,GAAK,EAAI,SACb,GAAIA,EAAK7nD,EAAO5S,MAAQ,EAAG,SAC3B,MAAM06D,EAAYJ,EAAe,EAAIxM,EAAQhqD,GAAGyhD,eAAe8U,GAEzDnvD,EAAInG,EAASojC,GADA6lB,EAAWhsD,KAAKspB,KAAI,KAASmvC,EAAKxvD,GAAKi9B,IAAU,GAAK,GACpCwyB,EACrCp6D,EAAI+L,OAAOouD,EAAIvvD,GAGnB,MAAM0F,EAAQ5O,KAAKkqB,IAAItZ,EAAO5S,MAAQ,EAAG0tD,EAAM8M,EAAK,IACpDl6D,EAAI+L,OAAOuE,EAAO7L,GAElBzE,EAAI+L,OAAOsE,EAAM5L,GAjErBzG,EAAK0d,OAAU2+C,IACXlI,EAAWkI,EACX1U,EAAUD,EAAiBE,iBAG/B5nD,EAAK+rB,iBAAmB,WACpB,MAAO/pB,IAACA,GAAQsS,EAChBtS,EAAIiK,OACJjK,EAAIqJ,YAAc,GAGlB,MAAM4wD,EAAQtU,EAAQlnD,OACtB,IAAK,IAAI+E,EAAI,EAAGA,EAAIy2D,EAAOz2D,IACvBxD,EAAImF,YAAc,UAElBnF,EAAIsL,YACJwuD,EAAU95D,EAAKwD,GAAG,GAClBxD,EAAIqO,SAERrO,EAAIoK,WAERpM,EAAKgd,OAAS,WACV,MAAOhb,IAACA,GAAQsS,EAChBtS,EAAIiK,OACJjK,EAAIqJ,YAAc,GAClB,MAAM4wD,EAAQtU,EAAQlnD,OACtB,IAAK,IAAI+E,EAAI,EAAGA,EAAIy2D,EAAOz2D,IAEvBxD,EAAIuF,UAAYogD,EAAQniD,GAAG+C,MAC3BvG,EAAImF,YAAcigD,GAAYW,GAAa,CAAC,GAAK,IAAM,CAACJ,EAAQniD,GAAG+C,MAAO,aAC1EvG,EAAIsL,YACJwuD,EAAU95D,EAAKwD,GAAG,GAClBxD,EAAIsO,OACJtO,EAAIqO,SAERrO,EAAIoK,uBCzCmBs7C,EAAkBpzC,GAG7C,IAAI6/C,EACAxM,EACA2U,EACJ,MAAMC,EAAW,GALJ99D,KAQRif,OAAU2+C,IACXlI,EAAWkI,EACX1U,EAAUD,EAAiBE,gBAE3B,MAAOgH,KAACA,EAAIY,QAAEA,EAAO1C,UAAEA,GAAcqH,EAE/B8H,EAAQtU,EAAQlnD,OAChB+7D,EAAU94D,KAAKuC,OAAOg2D,EAAQ,GAAK,GAAK,EAC9C3nD,EAAO9Q,cAAcg5D,GAAW,EAAI,GAAKloD,EAAO3S,QAEhD,MAAM+tD,EAAuC,aAA7B5C,EAAUlxC,2BAOtB,MAAO2Z,GAACA,EAAEC,GAAEA,EAAE5jB,OAAEA,GAAWg9C,EAC3B2N,EAAS57D,OAAO,GAChB,IAAK,IAAI6E,EAAI,EAAGA,EAAImiD,EAAQlnD,OAAQ+E,IAAK,CACrC,MAAM5D,EAASC,SAASC,cAAc,UACtCF,EAAOF,MAAQ6zB,EACf3zB,EAAOD,OAAS6zB,EAChB,MAAMmkC,EAAS/3D,EAAOK,WAAW,MAC3B23D,EAAYD,EAAOE,gBAAgBtkC,EAAIC,IAEtC/jB,KAACA,GAASmoD,GAEV1U,UAACA,GAAcyC,EAAQniD,IACvBqD,EAAGC,EAAGC,GAAKm8C,EAElB,IAAIxgC,EAAI,EACR,IAAK,IAAIyZ,EAAK,EAAGA,EAAK3I,EAAI2I,IACtB,IAAK,IAAID,EAAK,EAAGA,EAAK3I,EAAI2I,IAAM,CAC5B,MACM/wB,EADUqiD,EAAQ9qC,GAAGuiC,eAAezhD,IACpBkqD,EAAW99C,EAAO8S,GAAK,GAAK,IAElDjT,EAAsB,GAAhBysB,EAAKC,EAAK5I,GAAU,GAAK1sB,EAC/B4I,EAAsB,GAAhBysB,EAAKC,EAAK5I,GAAU,GAAKzsB,EAC/B2I,EAAsB,GAAhBysB,EAAKC,EAAK5I,GAAU,GAAKxsB,EAC/B0I,EAAsB,GAAhBysB,EAAKC,EAAK5I,GAAU,GAAKpoB,EAC/BuX,GAAK,EAGb63C,EAASt9D,KAAK2C,GACd+3D,EAAOG,aAAaF,EAAW,EAAG,IAjC1C6C,cAuCI,MAAOlnC,GAACA,EAAEC,GAAEA,EAAE5jB,OAAEA,GAAWg9C,EACrB9H,EAAWa,EAAQ7sC,KAAK+sC,GAAQA,EAAI3C,YAEpCtjD,EAASC,SAASC,cAAc,UACtCF,EAAOF,MAAQ6zB,EACf3zB,EAAOD,OAAS6zB,EAChB,MAAMmkC,EAAS/3D,EAAOK,WAAW,MAC3B23D,EAAYD,EAAOE,gBAAgBtkC,EAAIC,IAEtC/jB,KAACA,GAASmoD,EAEjB,IAAIl1C,EAAI,EACR,IAAK,IAAIyZ,EAAK,EAAGA,EAAK3I,EAAI2I,IACtB,IAAK,IAAID,EAAK,EAAGA,EAAK3I,EAAI2I,IAAM,CAC5B,MAAO+oB,eAACA,GAAmBuI,EAAQ9qC,IAC5B7b,EAAGC,EAAGC,GAAKg/C,GAAad,EAAgBH,GAEzC35C,EAAkC,KAA5BuiD,EAAW99C,EAAO8S,GAAK,GAEnCjT,EAAsB,GAAhBysB,EAAKC,EAAK5I,GAAU,GAAK1sB,EAC/B4I,EAAsB,GAAhBysB,EAAKC,EAAK5I,GAAU,GAAKzsB,EAC/B2I,EAAsB,GAAhBysB,EAAKC,EAAK5I,GAAU,GAAKxsB,EAC/B0I,EAAsB,GAAhBysB,EAAKC,EAAK5I,GAAU,GAAKpoB,EAC/BuX,GAAK,EAGb43C,EAAe16D,EACf+3D,EAAOG,aAAaF,EAAW,EAAG,GAjEtC8C,IArBSj+D,KA0FRue,OAAS,WACV,MAAOhb,IAACA,EAAGM,KAAEA,GAASgS,GAEf3H,EAACA,EAACC,EAAEA,EAACrL,EAAEA,GAAM4yD,EAASrH,sBAoDzB9qD,EAAIiK,OAIJjK,EAAIsL,YACJtL,EAAIoO,IAAIzD,EAAGC,EAAO,GAAJrL,EAAS,EAAG,EAAImC,KAAKsJ,IACnChL,EAAIoR,OAIJ,MAAM5G,EAAI,CACNjL,EAAG,EAAGC,EAAG,EAAGmL,EAAG,EAAGC,EAAG,GAEnBhL,EAAS06D,EACft6D,EAAIi4D,uBAAwB,EAC5B,MAAM0C,EAAK,CACPhwD,EAAGA,EAAQ,GAAJpL,EAAUiL,EAAEG,EACnBC,EAAGA,EAAQ,GAAJrL,EAAUiL,EAAEI,EACnBrL,EAAGA,EAAIiL,EAAEjL,EACTC,EAAGD,EAAIiL,EAAEhL,GAEbQ,EAAIuR,UAAU3R,EAAQ+6D,EAAGhwD,EAAGgwD,EAAG/vD,EAAG+vD,EAAGp7D,EAAGo7D,EAAGn7D,GAG3CQ,EAAIsL,YACJtL,EAAIoO,IAAIzD,EAAGC,EAAO,GAAJrL,EAAS,EAAG,EAAImC,KAAKsJ,IACnChL,EAAIqO,SAEJrO,EAAIoK,UA9ERwwD,cAMI,MAAMX,EAAQtU,EAAQlnD,OACtB,IAAK,IAAI+E,EAAI,EAAGA,EAAIy2D,EAAOz2D,IAAK,CAG5BlD,EAAK2J,OAEL,MAAMO,EAAI,CACNjL,EAAG,EAAI,EAAGC,EAAG,EAAI,EAAGmL,EAAInH,EAAI,EAAK,IAAKoH,EAAuB,IAApBlJ,KAAKuC,MAAMT,EAAI,IAItDqO,EAAK,CACPlH,EAAGA,EAAIH,EAAEjL,EAAIiL,EAAEG,EACfC,EAAGA,EAAIJ,EAAEhL,EAAIgL,EAAEI,EACf/D,EAAGtH,EAAIiL,EAAEjL,EAAI,IAIjBe,EAAKgL,YACLhL,EAAK8N,IAAIyD,EAAGlH,EAAGkH,EAAGjH,EAAGiH,EAAGhL,EAAG,EAAG,EAAInF,KAAKsJ,IACvC1K,EAAK8Q,OAEL9Q,EAAKgL,YACLhL,EAAKiO,KAAK/D,EAAEG,EAAGH,EAAEI,EAAG,IAAK,KACzBtK,EAAK8Q,OAEL,MAAMxR,EAAS26D,EAAS/2D,GAClBq3D,EAAK,CACPlwD,EAAGA,EAAIH,EAAEjL,EAAIA,EAAIiL,EAAEjL,EAAI,GAAMiL,EAAEG,EAC/BC,EAAGA,EAAIJ,EAAEjL,EAAIA,EAAIiL,EAAEjL,EAAI,GAAMiL,EAAEI,EAC/BrL,EAAGA,EAAIiL,EAAEjL,EACTC,EAAGD,EAAIiL,EAAEhL,GAEbc,EAAKiR,UAAU3R,EAAQi7D,EAAGlwD,EAAGkwD,EAAGjwD,EAAGiwD,EAAGt7D,EAAGs7D,EAAGr7D,GAG5Cc,EAAKgL,YACLhL,EAAK8N,IAAIyD,EAAGlH,EAAGkH,EAAGjH,EAAGiH,EAAGhL,EAAG,EAAG,EAAInF,KAAKsJ,IACvC1K,EAAK+N,SACL/N,EAAK8J,WA3Cb0wD,gBChG2B1yB,EAAcsd,EAAkBpzC,EAAQuI,GACvE,MAAM7c,EAAOvB,MAGNof,WAACA,GAAehB,EAAIiB,SACrBi/C,EAAuB,IAAfl/C,EAAoBm/C,GAASC,GAE3C7yB,EAAahtB,aADM,IAAS,IAAI2/C,EAAKrV,EAAkBpzC,KAGvDtU,EAAK8wB,MAAQ,WACU,IAAfjT,GACAvJ,EAAOjQ,YAGfrE,EAAK+wB,KAAO,WACRzc,EAAO/P,WAEP,MAAM02D,EAAgBjnD,MAAM0zC,EAAiByR,oBAAoB7oD,UAAKhH,GACtEo+C,EAAiBsR,iBAAiBiC,IAGtCj7D,EAAK0d,OAAS,SAAU0rC,GACpB,MAAOz7C,MAACA,GAAUy7C,EAClB,QAAc9/C,IAAVqE,EAAqB,OAEzB,MAAOs5C,eAACA,EAAcuC,WAAEA,GAAe6R,GAAcjS,GACrD1B,EAAiBsR,iBAAiBxP,GAClC9B,EAAiBoR,sBAAsB7R,GAEvC,MAAOkN,SAACA,GAAa/K,EAAgBiB,MACrCjgB,EAAave,cAAcsoC,IAE/Bn0D,EAAKgd,OAAS,WACsB,IAA5BH,EAAIiB,SAASD,YACbusB,EAAare,mBAGjBqe,EAAaptB,sBCrBU1I,EAAQ+pC,EAAMp+C,EAASi9D,EAAaC,EAAatgD,GAC5E,MAAM7c,EAAOvB,KAEb+/C,GAAQtqC,KAAKlU,EAAMsU,EAAQrU,EAAS4c,GAIpC,MAAM6qC,EAAmB,IAAI0V,GAAiBvgD,GACxCutB,EAAe,IAAIxB,GAAa/rB,GAChC6hC,EAAe,IAAIC,GAAarqC,EAAQuI,EAAK5c,GAenD,IAAI2+C,EACAC,EACAwe,WACK1d,IACLf,EAAa/hC,EAAI0iC,IAAOb,EAAetU,EAEvCyU,EAAoBhiC,EAAI0iC,IAAO4d,EAAcD,EAE7C,MAAOxF,WAACA,GAAe76C,EAAIiB,SAASorC,aAE9BoU,EAA2B,UAAf5F,EAA0B6F,GADC,YAAf7F,GAA2C,aAAfA,EAA6B8F,GAAuBC,GAExGC,GAAsB,IAAZ7gD,EAAI0iC,IAAgBoe,GAASL,EAC7CD,EAAS,IAAIK,EAAO9e,EAAW8I,EAAkBpzC,EAAQuI,GAzB7D7c,EAAK+lD,gBAAmBF,IACpB6B,EAAiBzqC,aAAa,IAAI2gD,GAAa/X,EAAW7lD,EAAKorB,MAAO9W,KAG1EtU,EAAKi/C,kBAAqBvzB,IACtBgzB,EAAanzB,YAAY,IAAI2zB,GAASxzB,EAAY1rB,EAAKorB,MAAO9W,IAC9D81B,EAAa7e,YAAY,IAAI2zB,GAASxzB,EAAY1rB,EAAKorB,MAAO9W,KAGlErU,EAAQC,IAAI,CAAC,cAkBby/C,IAIA,MAAMR,EAAan/C,EAAK8wB,MACxB9wB,EAAK8wB,MAAK,KACNquB,IACAQ,IAEA9iC,EAAIghD,aAAapY,UAAUnG,OAC3B+d,EAAOvsC,QACP8tB,EAAUzgC,WACVupC,EAAiBvpC,WACjBtB,EAAIyqC,UAAUnpC,YAGlBne,EAAK+wB,KAAI,KACLssC,EAAOtsC,OACPlU,EAAIghD,aAAapY,UAAU7F,OAC3B/iC,EAAIyqC,UAAUnG,KAAK,IAGvBnhD,EAAK0d,OAAM,KACP,GAAIzd,EAAQO,YAAa,OAEzBo+C,EAAUlhC,SACV,MAAM0rC,EAAkBvK,EACnB4J,eAAe7J,EAAW8I,EAAkBznD,GACjDo9D,EAAO3/C,OAAO0rC,GACdppD,EAAKgxB,cACL/wB,EAAQS,QAER4T,EAAO5T,QACP4T,EAAOtQ,YACPhE,EAAKgd,UAGThd,EAAKgxB,YAAW,KACZ,MAAM61B,EAAOhI,EAAiBgK,WAAWhsC,EAAIyqC,UAAWI,GAExD,OADA7qC,EAAIyqC,UAAU5pC,OAAOmpC,EAAMa,GACpBb,GAGX7mD,EAAKgd,OAAM,KACPqgD,EAAOrgD,UAEXhd,EAAKqe,iBAAgB,KACjBugC,EAAUvgC,mBACVqpC,EAAiBrpC,mBACjBxB,EAAIyqC,UAAUjpC,gCCzGoBP,EAAUq/C,GAChD,MAAMn9D,EAAOvB,KAMb,IAAI87B,EAAS,GAEbv6B,EAAK0d,OAAS,SAAU0sB,EAAcsd,EAAkBznD,EAAS4d,IACjC,IAAxB5d,EAAQO,aACRR,EAAK+oD,WAIT,OADkB/oD,EAAKgpD,OAAO5e,EAAcsd,EAAkB7pC,IAIlE7d,EAAK+oD,SAAW,WACZxuB,EAAS,IAGbv6B,EAAKgpD,OAAS,SAAU5e,EAAc0zB,EAAkBjgD,GAGpD,GAA6C,IAAzCusB,EAAa3e,iBAAiBhrB,OAAc,MAAO,CAAEmqC,eAAe,GACxE,GAA4D,IAAxDkzB,EAAiBtgD,4BAA4B/c,OAC7C,MAAO,CAAEmqC,eAAe,GAG5B,GAAIrQ,EAAO95B,OAzBG,IAyBiB,MAAO,CAAEmqC,eAAe,GAKvD,MAGOqe,MAACA,GAAUnrC,EAASorC,cACpBl6B,GAACA,GAAOob,EAETS,EAAY72B,MANP,EAKCi1C,EAAaj6B,GAEzB,IAAIoP,EAAI,EAER,IAAK,IAAI54B,EAAI,EAAGA,EATL,EASaA,IAAK,CAEzB,MAAMslC,EAAKhtB,EAASorC,aAAaC,oBAC3BxB,EAAU,GAChB,IAAK,IAAIjjC,EAAI,EAAGA,EAAIomB,EAAIpmB,IAAK,CAEzB,MAAM+hB,EAAQq3B,EAAiB5/C,QAAQ5C,cAGpB,IAAfuC,EACA8pC,EAAQ1oD,KAAK,CAAE+b,OAAQyrB,IAEvBkhB,EAAQ1oD,KAAK,CAAEqd,OAAQmqB,IAK/B,MAAM2iB,EAAkB+T,EAAYxT,aAAavf,EAAcud,IAExDgE,kBAACA,GAAsBvC,EACxB2U,EAAapS,EAAkBlrD,OAG/BgpD,EAAa,GAEnB,GAAkD,iBAA9C3rC,EAASorC,aAAaG,oBAAwC,CAC9D,IAAIxgD,EAAI,EACR,IAAK,IAAII,EAAI,EAAGA,EAAI80D,EAAY90D,IAAK,CACjC,MAAOqgD,OAACA,GAAWqC,EAAkB1iD,GAGrC,IAAIsgD,EAGAA,EAFM,IAAN1gD,EAE2B,IAAfgV,EAAoByrC,EAAOtuC,OAASsuC,EAAOhtC,OACjC,IAAfuB,EAEI,CACPlR,EAAG28C,EAAOtuC,OAAOrO,GAAKjJ,KAAKwC,SAAW,IAAOujD,GAItC,CACP98C,EAAG28C,EAAOhtC,OAAO3P,GAAKjJ,KAAKwC,SAAW,IAAOujD,EAC7C78C,EAAG08C,EAAOhtC,OAAO1P,GAAKlJ,KAAKwC,SAAW,IAAOujD,GAIrDlvB,EAAOt7B,KAAKsqD,GACZ1e,EAAUzM,GAAKmrB,EACfnrB,GAAK,EACLv1B,GAAK,OAEN,CACH,IAAIA,EAAI,EACR,IAAK,IAAII,EAAI,EAAGA,EAAI80D,EAAY90D,IAAK,CACjC,MAAOugD,WAACA,GAAemC,EAAkB1iD,GAEzC,IAAK,IAAIyb,EAAI,EAAGA,EAAIijC,EAAQlnD,OAAQikB,IAAK,CACrC,MAAMmjC,EAAMF,EAAQjjC,GACdglC,EAAYF,EAAW9kC,GAC7B,IAAK,IAAIC,EAAI,EAAGA,EAAI+kC,EAAW/kC,IAAK,CAChC,IAAI4kC,EAGAA,EAFM,IAAN1gD,EAE2B,IAAfgV,EAAoBgqC,EAAI7sC,OAAS6sC,EAAIvrC,OAC3B,IAAfuB,EAEI,CACPlR,EAAGk7C,EAAI7sC,OAAOrO,GAAKjJ,KAAKwC,SAAW,IAAOujD,GAInC,CACP98C,EAAGk7C,EAAIvrC,OAAO3P,GAAKjJ,KAAKwC,SAAW,IAAOujD,EAC1C78C,EAAGi7C,EAAIvrC,OAAO1P,GAAKlJ,KAAKwC,SAAW,IAAOujD,GAIlDlvB,EAAOt7B,KAAKsqD,GACZ1e,EAAUzM,GAAKmrB,EACfnrB,GAAK,EACLv1B,GAAK,MAMzB,MAAO,CAAE+hC,eAAe,YAAMC,SAAWtQ,gBClH7CjmB,EACA+pC,EACAp+C,EACAjB,EACAyC,GAEA,MAAMzB,EAAOvB,KAIPqf,EAAW,IAAIkgD,GAAS3f,GACxB6e,EAAc,IAAIe,GAAYngD,GAC9BwgC,EAAiB,IAAI4f,GAAepgD,GACpCq/C,EAAc,IAAIgB,GAAYrgD,GAC9BygC,EAAoB,IAAI6f,GAAkBtgD,EAAUq/C,GAE1Dn9D,EAAK8d,SAAWA,EAIhB,MAAMgmC,EAAO,CACTQ,IAAK,IAAI+Z,GAAO/pD,EAAQ+pC,EAAMp+C,EAASi9D,EAAaC,EAAan9D,GAEjEukD,OAAQ,IAAI+Z,GAAUhqD,EAAQ+pC,EAAMp+C,EAASq+C,EAAgBC,EAAmBv+C,GAChFu+D,KAAM,IAAI/f,GAAQlqC,EAAQrU,EAASD,IAEvCA,EAAK8jD,KAAOA,EAIZ9jD,EAAKojD,cAAgB,IAAIob,GAAclqD,EAAQ7S,EAAQxB,EAASjB,EAAW8kD,EAAM9jD,GACjFA,EAAK69D,aAAe,IAAIY,GAAanqD,EAAQ7S,EAAQxB,EAASjB,EAAW8kD,EAAM9jD,GAC/EA,EAAKo/C,eAAiB,IAAIsf,GAAepqD,EAAQ7S,EAAQxB,EAASjB,EAAW8kD,EAAM9jD,GAEnFA,EAAKsnD,UAAY,IAAIqX,GAAUrqD,EAAQwvC,EAAM9jD,GAC7CA,EAAKunD,SAAQ,IAASzD,EAAK9jD,EAAKsM,OAAO0kB,cAIvChxB,EAAK69D,aAAajY,aAAa,CAAEj5C,EAAG,GAAIC,EAAG,KAAO,CAAED,EAAG,IAAM,WAAW,GACxE3M,EAAK69D,aAAajY,aAAa,CAAEj5C,EAAG,IAAKC,EAAG,IAAM,CAAED,EAAG,KAAO,WAAW,GACzE3M,EAAK69D,aAAajY,aAAa,CAAEj5C,EAAG,IAAWC,EAAG,KAAY,CAAED,EAAG,KAAO,WAAW,GACrF3M,EAAKo/C,eAAeqH,yBAAyB,CAAE95C,EAAG,IAAKC,EAAG,IAAKrL,EAAG,KAAO,CAAEoL,EAAG,IAAKpL,EAAG,IAAKqa,eAAgB,aAAc,GACzH5b,EAAKojD,cAAcgB,eAAe,CAAEz3C,EAAG,GAAIC,EAAG,IAAKrL,EAAG,KAAO,CAAEoL,EAAG,GAAIpL,EAAG,IAAKqa,eAAgB,aAAc,GAC5G5b,EAAKojD,cAAcgB,eAAe,CAAEz3C,EAAG,IAAKC,EAAG,IAAKrL,EAAG,KAAO,CAAEoL,EAAG,IAAKpL,EAAG,IAAKqa,eAAgB,aAAc,GAI9G5b,EAAKsM,MAAQ,MACbtM,EAAK4+D,IAAM,MACX5+D,EAAKu/C,KAAM,EACXv/C,EAAK8d,SAASi6C,cAAc,GAE5B93D,EAAQC,IAAI,CAAC,MAAO,aAAc,QAElCF,EAAK0d,OAAM,KAEHzd,EAAQI,MAAM,CAAC,MAAO,aAAc,MAAO,qBAE3CgB,OAAOoE,KAAKq+C,GAAMzkD,SAASqlB,GAAMo/B,EAAKp/B,GAAGqM,SAEzC/wB,EAAKsM,MAcQ,QAAbtM,EAAK4+D,IACE,MAEJ,SAfH9a,EAAK9jD,EAAKsM,OAAOwkB,SAIrBgzB,EAAK9jD,EAAKsM,OAAOoR,UAarB1d,EAAKqe,iBAAgB,KAAWylC,EAAK9jD,EAAKsM,OAAO+R,oBACjDre,EAAKgd,OAAM,KAAW8mC,EAAK9jD,EAAKsM,OAAO0Q,UAEvChd,EAAK0hD,2BAA8Bv0C,IAC/BnN,EAAKse,WAAanR,EAClBlN,EAAQC,IAAI,CAAC,yBClHuBuB,GACxC,MAAM4V,EAAQxV,SAASC,cAAc,OACrCuV,EAAMtV,aAAa,QAAS,uBAC5BsV,EAAM1C,UAAY,gBAClBlT,EAAOiB,WAAW,mBAAoB2U,GDmHtCwnD,CAAoBp9D,GAUpB48C,EAAK9jC,YACDva,EACA,CACIqX,MAAO,OACPmC,KAAM,MACNC,QAAU0B,IAAQnb,EAAK4+D,IAAMzjD,GAC7B9R,QAVQ,CACZ,CAAEgN,KAAM,eAAgBvX,MAAO,OAC/B,CAAEuX,KAAM,mBAAoBvX,MAAO,WAS/B4a,OAAQ,CAAC,SAQjB2kC,EAAK9jC,YACDva,EACA,CACIqX,MAAO,OACPmC,KAAM,MACNC,QAAU0B,IAAQnb,EAAKu/C,IAAMpkC,GAC7B9R,QAVQ,CACZ,CAAEgN,KAAM,KAAMvX,OAAO,GACrB,CAAEuX,KAAM,MAAOvX,OAAO,IASlB4a,OAAQ,CAAC,SAQjB2kC,EAAK9jC,YACDva,EAAK8d,SACL,CACIzG,MAAO,cACPmC,KAAM,aACNC,QAAU0B,IAAQnb,EAAK8d,SAASi6C,cAAc58C,IAC9C9R,QAVc,CAClB,CAAEgN,KAAM,KAAMvX,MAAO,GACrB,CAAEuX,KAAM,KAAMvX,MAAO,IASjB4a,OAAQ,CAAC,4BE7JUi8C,GAC3B,MAEMmJ,EAAa,GACbC,EAAY,GAHLtgE,KAqBViE,WAAA,CAAA2T,EAAA+qC,KAECuU,EAAMp1D,SAAS8V,GAASyoD,EAAazoD,GAAM+qC,EACtC2d,EAAU9/D,KAAImiD,IAxBV3iD,KA+BLugE,cAAO,KACX,MAAC7yD,EAAAtK,SAAAC,cAAA,cACD6zD,EAAMt2D,SAAOgX,IAChB,MAAA+qC,EAAA0d,EAAAzoD,QACJ/M,IAAA83C,GAAAj1C,EAAA1J,YAAA2+C,wDC3CoCpiD,GACjC,MAAMgB,EAAOvB,KAGPwgE,EAAU,eAe+B15D,UAAO8Q,KAAAA,EAAAlE,OAAAA,EAAAuxC,MAAAA,GAAAn+C,SAClD,MAAMpG,EAAWL,IAAK,QAChBA,MAASA,QAAE4kD,UAelB,CAECvkD,QAAOA,EAIP0a,GApBO/a,GAAME,EAAAkgE,GAAA//D,EAAAL,MA0BbkB,EAAAwjD,iBAAaj+C,IAChB,MAAA8Q,KAAAA,EAAAlE,OAAAA,EAAAuxC,MAAAA,GAAAn+C,EAKE05D,EAAA5oD,GAAAlE,EAEC,MAAMhT,EAAE,CAAA4L,EAAIjM,EAAIkb,KAAO,CACjB3D,KAAMA,EACNtL,GAAKA,EAGPjM,MAAOA,EAEd4kD,MAAAA,EACJ1pC,aAAAA,wIClEoChb,GACjC,MAAMgB,EAAOvB,KAGP2X,EAAS,GAET+oD,EAAe,GA8BjBn/D,EAAK+Z,UAAOxU,IACZ,MAAI8Q,KAAUA,EAAA2D,aAAmBA,EAC7B0pC,MAAAA,GAAiBn+C,OAEV+D,IAAXo6C,GAAiBA,EAAAG,gBAAAsb,EAAA9oD,IAAA,GAEjBD,EAAMC,GAAA2D,GAqBNha,EAAIwjD,iBAAYj+C,IAChB,MAAM8Q,KAAKA,EAASqtC,MAChBA,GAAen+C,OACX+D,OAAAo6C,EAAAG,gBAAAsb,EAAA9oD,IAAA,KACJA,GAAA,GAMJ,OALyBtL,GAAAqL,EACjBC,GAAAtL,cAMgC5L,IACxC,MAACkX,KAAAA,EAAAtL,GAAAA,EAAAjM,MAAAA,GAAAK,OAEMmK,IAAPyB,EAAkBqL,EAAAC,GAAAtL,GAAAjM,EACrBsX,EAAAC,GAAAvX,KAGGsgE,SAA8CjgE,IAC9C,MAAKkX,KAAAA,EAAAtL,GAAmBA,EAAA24C,MAAiBA,GAAAvkD,EAIzC,IAAC6a,OAC6C1Q,IAAAyB,EAAAiP,EAAA5D,EAAAC,IAE9C2D,EAAmB5D,EAAMC,GAAAtL,QAC0CzB,IAAA0Q,IAAAA,EAAA7a,EAAA6a,qBAKnD,CAIZ3D,KAAoEA,EACpEtL,GAAAA,EACAjM,MAAIkb,QAE2C0pC,qBACX9jD,yBAClBA,EAAe,UAC5By/D,mBAAAz/D,EAAA,6BAEa,CAAAA,EAAU0/D,YACN75D,KAAI7F,sBACtB2/D,OAAyBj2D,IAAf61D,EAAQ9oD,GACtB,GAAC,QAAAipD,GAAAC,EAAA,OACJ,GAAA,SAAAD,IAAAC,EAAA,OAGA,MAAAC,EAAoB5/D,EAAcyW,GACU,GAAAmpD,aAAAxrD,MAAAwrD,EAAAngE,SAAA,CAAAP,EAAAiM,KAEzC,MAAU5L,EAAQ,CACrBkX,KAAAA,EACJtL,GAAAA,EAEajM,MAASA,GAC1BE,EAAAygE,QAAAtgE,4JC7H+BH,GAC5B,MAAMgB,EAAOvB,KAGPihE,EAAU,GAChB,IAAIC,GAAO,EAEX3/D,EAAK4/D,aAAY,KACbF,EAAQ/+D,OAAO,EAAG++D,EAAQj/D,QAC1Bk/D,GAAO,GAkBP3/D,EAAAT,OAAUJ,IAEV,MAAyB0gE,EAAA7gE,EAAAogE,SAAAjgE,cACT,EAAOugE,EAAAj/D,QAAAk/D,EAAA,MAAeF,QAAAtgE,GACtCugE,EAAQzgE,KAAC,CACZ,CAKEE,QAAAA,EAEuB0gE,YAAAA,KAItBF,GAAM,KAOFjgE,eAAkBD,MAAuBkB,OAAAg/D,EAAA,EAAAD,EAAAj/D,QAAAk/D,EAAA,UAETG,EAAA,KAChCzgE,SAAUF,IAGW,MAAA0gE,EAAA7gE,EAAAogE,SAAAjgE,GAErB2gE,EAAK7gE,KAAA,CACZE,QAAAA,EAEmF0gE,YAAAA,IAE5C7gE,EAAaygE,QAAAtgE,MAKjDugE,EAAMzgE,KAAO6gE,GACbH,GAAK,+BAE8B,MAGnCI,KAAO,KACP,IAAI,IAAAJ,EAAY,OAChB,MAAIK,EAAAN,EAAiBC,GACrBK,EAAI3gE,SAAS4gE,IACbjhE,EAAMygE,QAAcQ,EAAOJ,mBAEiC,QAGxDA,YAAaA,GAAoBG,EAAE,GACvC,QAAC12D,IAAAu2D,EAAAnc,MAAA,OACJ,IAAA,IAAAmc,EAAAnc,MAAAH,QAAA,OAEG,IAAe,IAAdoc,EAAc,OACKD,EAAOC,GAAM,GAEpBE,YAAexpD,OAACwpD,EAAAxpD,OAGzB2I,aAAiCkhD,uBAtBF,QA0BnCC,KAAI,KACJ,GAAIR,IAAQD,EAAMj/D,OAAY,EAAA,OAC9B,MAAI2/D,EAASV,EAAQC,EAAM,GAC3BS,EAAK/gE,SAAS4gE,GAAGjhE,EAAYygE,QAAOQ,EAAA9gE,cAEwB,QAGxDA,QAAaA,GAAWihE,EAAK,GACjC,QAAC92D,IAAAnK,EAAAukD,MAAA,OACJ,IAAA,IAAAvkD,EAAAukD,MAAAH,QAAA,OACJ,GAAAoc,IAAAD,EAAAj/D,OAAA,EAAA,6EArC0C,kBC7BT4/D,GAC9B,MAAMrgE,EAAOvB,KAEP6hE,EAAe,IAAIC,GAAavgE,GAChCwgE,EAAe,IAAIC,GAAazgE,GAChC0/D,EAAU,IAAIgB,GAAQ1gE,GAC5BqgE,EAAathE,aAAaiB,KAgCtB+Z,UAAOxU,IACPi7D,EAAazmD,UAAAxU,GAMd,OALF+6D,EAAAvmD,UAAAxU,IAoBGvF,EAAAwjD,iBAAaj+C,IAChB,MAAAqU,EAAA0mD,EAAA9c,iBAAAj+C,GAGG,OADAqU,EAACmpC,gBAAwByd,EAAMhd,iBAAAj+C,GACWqU,GAY1C5Z,EAAiCy/D,QAAAtgE,IACjCqhE,EAAaf,QAAAtgE,GAChBmhE,EAAAb,QAAAtgE,MAIGigE,SAAYoB,EAACpB,SACjBp/D,EAACH,eAAA2gE,EAAA3gE,eAEDG,EAAKD,iBAAiBygE,EAAMzgE,iBAC5BC,EAAK2gE,UAAAH,EAAyBG,UAC9B3gE,EAAK4gE,WAAchhE,IAEfygE,EAAa1gE,oBAAWC,EAAYI,yPC1HAyB,EAAQzC,GAChD,MAAMyV,EAAS5S,SAASC,cAAc,UAEtC2S,EAAOC,UAAY,UAEnBD,EAAOE,UAAY,sBAEnB,MAAMzC,EAAOrQ,SAASC,cAAc,YAEpC2S,EAAOG,QAAO,KACV,MAAMwB,EAASpX,EAAU2hE,gBrGoBIE,EqGnB7B3uD,EAAKpT,OrGmBwB+hE,EqGnBKzqD,ErGoB/BoW,KAAKE,UAAUC,GAAak0C,GAAM,KAAM,QqGjB/C,MAAMt+D,EAAWV,SAASC,cAAc,OAElCs/C,EAAMv/C,SAASC,cAAc,OACnCs/C,EAAI3+C,YAAYgS,GAChB2sC,EAAI3+C,YAAYF,GAChB6+C,EAAI3+C,YAAYyP,GAEhBzQ,EAAOiB,WAAW,mBAAoB0+C,eCvBE3/C,EAAQzC,EAAW8hE,GAC3D,MAAMrsD,EAAS5S,SAASC,cAAc,UACtC2S,EAAOC,UAAY,UACnBD,EAAOE,UAAY,YAEnB,MAAMwzC,EAAUtmD,SAASC,cAAc,UACvCqmD,EAAQzzC,UAAY,UACpByzC,EAAQxzC,UAAY,yBAEpB,MAAMzC,EAAOrQ,SAASC,cAAc,qBAU3Bi/D,IACL,MAAM3qD,EAASpX,EAAU2hE,YACnBK,EAASx0C,KAAKE,UAAUtW,GACxB6qD,EAAUxrD,mBAAmBurD,GAE7BE,EADS,IAAIC,gBAAgB,CAAEh0D,EAAG8zD,IAClBG,WAItB,MADU,cAIV,MAAMC,EAAKx/D,SAASy/D,SAASvvD,KAAK/K,MAAM,KAClCu6D,EAAKF,EAAGptD,MAAM,EAAGotD,EAAG5gE,OAAS,GAEnC,OADe8gE,EAAGlmB,KAAK,KAREmmB,MAEWV,KAAcI,IAhBtDzsD,EAAOG,QAAO,KACV,MAAM6sD,EAAOV,IACb7uD,EAAKpT,MAAQ2iE,GAEjBtZ,EAAQvzC,QAAO,KACX,MAAM6sD,EAAOV,IACbW,UAAUC,UAAUC,UAAUH,IAoBlC,MAAMl/D,EAAWV,SAASC,cAAc,OAElCs/C,EAAMv/C,SAASC,cAAc,OACnCs/C,EAAI3+C,YAAYgS,GAChB2sC,EAAI3+C,YAAY0lD,GAChB/G,EAAI3+C,YAAYF,GAChB6+C,EAAI3+C,YAAYyP,GAEhBzQ,EAAOiB,WAAW,mBAAoB0+C,eClCVhrC,EAAQiqD,EAAcS,GAElD,MAAM7gE,EAAU,IAAI4hE,EAEdpgE,EAAS,IAAIqgE,GAAO,CACtB,OACA,mBACA,OACA,OACA,WACA,eACA,2BACA,aACA,OACA,mBACA,mBACA,iBACA,aAGE9iE,EAAY,IAAI+iE,GAAU1B,GAE1BhiB,EAAO,IAAI2jB,EAAK/hE,EAASwB,EAAQzC,aCjCXyC,EAAQzC,GACpC,MAAMijE,EAAapgE,SAASC,cAAc,UACpCogE,EAAargE,SAASC,cAAc,UAE1CmgE,EAAWvtD,UAAY,UACvBwtD,EAAWxtD,UAAY,UAEvButD,EAAWttD,UAAY,OACvButD,EAAWvtD,UAAY,OAEvBstD,EAAWrtD,QAAU5V,EAAU+gE,KAC/BmC,EAAWttD,QAAU5V,EAAUmhE,KAE/B1+D,EAAOiB,WAAW,OAAQu/D,GAC1BxgE,EAAOiB,WAAW,OAAQw/D,GDqB1BC,CAAQ1gE,EAAQzC,GAEhBojE,GAAoB3gE,EAAQzC,EAAW8hE,GAEvCuB,GAAoB5gE,EAAQzC,YEvCUyC,EAAQzC,GAC9C,MAAMyV,EAAS5S,SAASC,cAAc,UAEtC2S,EAAOC,UAAY,UAEnBD,EAAOE,UAAY,mBAEnB,MAAMzC,EAAOrQ,SAASC,cAAc,YAEpC2S,EAAOG,QAAO,KACV,GAAmB,KAAf1C,EAAKpT,MAAc,OACvB,MAAMsX,EAASoW,KAAKC,MAAMva,EAAKpT,OAC/BE,EAAU4hE,WAAWxqD,IAGzB,MAAM7T,EAAWV,SAASC,cAAc,OAElCs/C,EAAMv/C,SAASC,cAAc,OACnCs/C,EAAI3+C,YAAYgS,GAChB2sC,EAAI3+C,YAAYF,GAChB6+C,EAAI3+C,YAAYyP,GAEhBzQ,EAAOiB,WAAW,iBAAkB0+C,GFmBpCkhB,CAAkB7gE,EAAQzC,GAE1B,MAAMsV,EAAS,IAAIiuD,EAAO,IAAK,IAAK9gE,GAEpC+gE,EAAaluD,cA6BTA,EAAO5T,QACP4T,EAAOtQ,YACPsQ,EAAOvQ,kBACP8Y,EAAIG,SACJH,EAAIwB,qBAjCmB5c,GAE3B,MAAMob,EAAM,IAAI4lD,GAAInuD,EAAQ+pC,EAAMp+C,EAASjB,EAAWyC,GAEtDzC,EAAU4hE,WAAWxqD,GACrBpX,EAAU4gE,eAEV,MAAMxe,EAAM3/C,EAAOu9D,gBAInB,OAFA57D,OAAOs/D,gCAIEC,IAOL9lD,EAAIa,SAIJpJ,EAAOvQ,kBACP8Y,EAAIwB,mBATJjb,OAAOs/D,sBAAsBC,MAL1BvhB,gBGxDP,MAAO8f,OAACA,GAAW99D,OAAOk+D,SACpBsB,EAAS,IAAIzB,gBAAgBD,GAC7B2B,EAAMD,EAAOE,IAAI,KAEjB1sD,EAASysD,WAKOD,GACtB,MAAM3B,EAAU2B,EAAO3iB,IAAI,KACrB+gB,EAAS+B,mBAAmB9B,GAElC,OADez0C,KAAKC,MAAMu0C,GARLgC,CAAiBJ,GAAU,GAEhD,MAAO,KAAEC,SAAKzsD,GCJEpC,MAAMowB,KAAKviC,SAASohE,uBAAuB,YACnD5jE,SAASqvB,IACb,MACMw0C,OADsC55D,IAA1BolB,EAAOgB,QAAQtZ,OACEoW,KAAKC,MAAMiC,EAAOgB,QAAQtZ,QAAU,GACjE+sD,EAAKC,KACLhtD,EAAU+sD,EAAGN,IAAOM,EAAG/sD,OAAS8sD,EAGhCpC,OAD8Cx3D,IAA9BolB,EAAOgB,QAAQ2zC,WACF30C,EAAOgB,QAAQ2zC,WAAa,GAGzDjiB,EAAMkiB,GAAQltD,EADC,IAAImtD,EACiBzC,GAC3BpyC,EAAOljB,WACf/I,YAAY2+C,MCfPptC,MAAMowB,KAAKviC,SAASohE,uBAAuB,mBACnD5jE,SAASqvB,IACb,MAMM0yB,WCJwBhrC,EAAQ0qD,GAC1C,MAAMT,EAAe,IAAIkD,EAEnBC,EAAU3hE,SAASC,cAAc,UACvC0hE,EAAQ9uD,UAAY,UACpB8uD,EAAQ7uD,UAAY,SACpB6uD,EAAQjgE,MAAM,kBAAoB,SAClCigE,EAAQjgE,MAAM,aAAe,OAC7BigE,EAAQjgE,MAAMyS,OAAS,MAUvBwtD,EAAQ5uD,QATI,KACkB,WAAtB4uD,EAAQ7uD,WACR6uD,EAAQ7uD,UAAY,WACpB0rD,EAAaxhE,WAAU,KAEvB2kE,EAAQ7uD,UAAY,SACpB0rD,EAAaxhE,WAAU,KAK/B,MAAM4kE,EAAOH,GAAQltD,EAAQiqD,EAAcS,GACrC4C,EAAOJ,GAAQltD,EAAQiqD,EAAcS,GAC3C2C,EAAKlgE,MAAMe,QAAU,eACrBo/D,EAAKngE,MAAMe,QAAU,eAErBm/D,EAAKlgE,MAAM,kBAAoB,MAC/BmgE,EAAKngE,MAAM,kBAAoB,MAE/B,MAAM69C,EAAMv/C,SAASC,cAAc,OAInC,OAHAs/C,EAAI3+C,YAAYghE,GAChBriB,EAAI3+C,YAAY+gE,GAChBpiB,EAAI3+C,YAAYihE,GACTtiB,ED5BSuiB,MANgCr6D,IAA1BolB,EAAOgB,QAAQtZ,OACJoW,KAAKC,MAAMiC,EAAOgB,QAAQtZ,QAAU,QAEb9M,IAA9BolB,EAAOgB,QAAQ2zC,WACF30C,EAAOgB,QAAQ2zC,WAAa,IAGhD30C,EAAOljB,WACf/I,YAAY2+C","sources":["src/command/ComMessenger.js","src/ui/Changes.js","src/ui/EventHandlers.js","src/ui/Screen.js","src/lib/snowpack/build/snowpack/pkg/@mithrandirii/canvas2svg.js","src/ui/addSVGOutput.js","src/menu/Button.js","src/menu/ButtonGroup.js","src/menu/MenuItem.js","src/menu/Menu.js","src/election/CandidateDistributionSampler1D.js","src/election/CandidateDistributionSampler2D.js","src/candidateDns/CandidateDnSimList.js","src/lib/snowpack/build/snowpack/pkg/@tweenjs/tweenjs.js","src/vizEntities/SquareGraphic.js","src/vizEntities/CandidateDnGraphic.js","src/candidateDns/CandidateDnSim.js","src/voters/VoterSimList.js","src/utilities/graphicsUtilities.js","src/utilities/jsHelpers.js","src/sim/DraggableManager.js","src/sim/states/SimBase.js","src/vizEntities/CircleGraphic.js","src/vizEntities/VoterGraphic.js","src/voters/VoterSim.js","src/lib/snowpack/build/snowpack/pkg/simplex-noise.js","src/voters/geoNoise.js","src/lib/snowpack/build/snowpack/pkg/d3-polygon.js","src/lib/snowpack/build/snowpack/pkg/d3-delaunay.js","src/voters/lloydVoronoi.js","src/lib/polygonClip.js","src/voters/geoCensus.js","src/voters/DistrictMaker.js","src/voters/VoterGeoList.js","src/viz/VoterRender1D.js","src/viz/VoterRender2D.js","src/viz/VizSampleDensity1D.js","src/lib/snowpack/build/snowpack/pkg/common/range-94fca231.js","src/lib/snowpack/build/snowpack/pkg/d3-contour.js","src/lib/snowpack/build/snowpack/pkg/d3-geo.js","src/viz/VizSampleDensity2D.js","src/sim/states/SimSample.js","src/sim/Registrar.js","src/tooltips/hideOnClickOutside.js","src/tooltips/tooltipBox.js","src/tooltips/tooltipForEntity.js","src/voters/VoterShape.js","src/voters/VoterCommander.js","src/voters/VoterShapeAdd.js","src/sim/VoterShapeAddMakeButton.js","src/lib/colorBlendScript.js","src/candidates/Candidate.js","src/candidates/CandidateCommander.js","src/sim/CandidateAddMakeButton.js","src/candidates/CandidateAdd.js","src/candidateDns/CandidateDn.js","src/candidateDns/CandidateDnCommander.js","src/sim/CandidateDnAddMakeButton.js","src/candidateDns/CandidateDnAdd.js","src/tooltips/TooltipVoteText.js","src/viz/colorBlender.js","src/voters/VoterTest.js","src/tooltips/tooltipForTestVoter.js","src/election/ElectionOne.js","src/election/ElectionSample.js","src/election/ElectionGeo.js","src/castVotes/CastPluralitySummer2DQuadrature.js","src/castVotes/CastPluralitySummer1DIntervals.js","src/castVotes/castScoreTestVote.js","src/castVotes/CastScoreSummer2DGrid.js","src/castVotes/CastScoreSummer1DGrid.js","src/castVotes/splitConvex.js","src/castVotes/castRankingFindPolygons.js","src/castVotes/CastRankingSummer2DPolygons.js","src/castVotes/castRankingFindIntervals.js","src/castVotes/CastRankingSummer1DIntervals.js","src/castVotes/castPluralityTestVote.js","src/castVotes/castRankingTestVote.js","src/castVotes/CastPairwiseSummer1DIntervals.js","src/castVotes/CastPairwiseSummer2DPolygons.js","src/castVotes/voteCasters.js","src/castVotes/castPlurality.js","src/castVotes/castScore.js","src/castVotes/castRanking.js","src/castVotes/castPairwise.js","src/electionMethods/electionMethods.js","src/electionMethods/plurality.js","src/electionMethods/randomWinner.js","src/electionMethods/huntingtonHill.js","src/electionMethods/score.js","src/electionMethods/stv.js","src/electionMethods/minimax.js","src/election/SocialChoice.js","src/election/Election.js","src/vizEntities/CandidateGraphic.js","src/candidates/CandidateSim.js","src/candidates/CandidateSimList.js","src/viz/geoColors.js","src/viz/NoiseImage.js","src/viz/GeoMaps.js","src/viz/VizGeo.js","src/viz/addAllocation.js","src/viz/Voronoi1D.js","src/viz/Voronoi2D.js","src/viz/VizOneVoronoi.js","src/viz/VoronoiRanking1D.js","src/viz/VoronoiRanking2D.js","src/viz/VizOneVoronoiRanking.js","src/viz/Grid1D.js","src/viz/Grid2D.js","src/viz/VizOneGrid.js","src/sim/states/SimOne.js","src/election/ElectionSampleGeo.js","src/sim/Sim.js","src/sim/addSimControlsLabel.js","src/ui/Layout.js","src/command/CommandStore.js","src/command/ConfigKeeper.js","src/command/History.js","src/command/Commander.js","src/command/addSaveConfigToText.js","src/command/addSaveConfigToLink.js","src/ui/sandbox.js","src/command/addUndo.js","src/command/loadConfigText.js","src/command/checkURL.js","src/ui/addSingleSandboxes.js","src/ui/addDoubleSandboxes.js","src/ui/doubleSandbox.js"],"sourcesContent":["/** @module */\r\n\r\n/** Connect two sandboxes by passing messages between their commanders.\r\n * This is kind of like a mediator pattern, but also maybe an observer pattern. */\r\nexport default class ComMessenger {\r\n    /** Make sure broadcasted commands don't trigger broadcasts */\r\n\r\n    // All variables are intended to be private.\r\n\r\n    constructor() {\r\n        this.linked = true\r\n        this.commanders = []\r\n        this.protect = false\r\n    }\r\n\r\n    setLinked(value) {\r\n        this.linked = value\r\n    }\r\n\r\n    addCommander(commander) {\r\n        this.commanders.push(commander)\r\n    }\r\n\r\n    broadcastDo(command, originCommander) {\r\n        if (this.linked && this.protect === false) {\r\n            this.protect = true\r\n            this.commanders.forEach((com) => com.passDo(command))\r\n            this.protect = false\r\n        } else {\r\n            originCommander.passDo(command)\r\n        }\r\n    }\r\n\r\n    broadcastDoCommands(commands, originCommander) {\r\n        if (this.linked && this.protect === false) {\r\n            this.protect = true\r\n            this.commanders.forEach(\r\n                (com) => com.passDoCommands(commands),\r\n            )\r\n            this.protect = false\r\n        } else {\r\n            originCommander.passDoCommands(commands)\r\n        }\r\n    }\r\n\r\n    broadcastLoadConfig(newConfig, originCommander) {\r\n        if (this.linked && this.protect === false) {\r\n            this.protect = true\r\n            this.commanders.forEach(\r\n                (com) => com.passLoadConfig(newConfig),\r\n            )\r\n            this.protect = false\r\n        } else {\r\n            originCommander.passLoadConfig(newConfig)\r\n        }\r\n    }\r\n\r\n    broadCastLoadCommands(commands, originCommander) {\r\n        if (this.linked && this.protect === false) {\r\n            this.protect = true\r\n            this.commanders.forEach(\r\n                (com) => com.passLoadCommands(commands),\r\n            )\r\n            this.protect = false\r\n        } else {\r\n            originCommander.passLoadCommands(commands)\r\n        }\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * keep track of changes that occur to a simulation's configuration.\r\n * @constructor\r\n */\r\nexport default function Changes() {\r\n    const self = this\r\n\r\n    const changes = ['init']\r\n\r\n    self.add = (changeList) => {\r\n        changeList.forEach(\r\n            (c) => changes.push(c),\r\n        )\r\n    }\r\n    self.check = (changeList) => {\r\n        let n = 0\r\n        changeList.forEach(\r\n            (c) => { n += changes.includes(c) ? 1 : 0 },\r\n        )\r\n        return n > 0\r\n    }\r\n    self.checkNone = () => (changes.length === 0)\r\n    self.clear = () => {\r\n        changes.splice(0, changes.length)\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Set event handlers for a screen.foreground.\r\n * We want to set the handlers once for the canvas,\r\n * and use this class to change the functions that the handlers call.\r\n * Then allow sims to set the functions called by the handlers.\r\n * @constructor\r\n */\r\nexport default function EventHandlers() {\r\n    const self = this\r\n\r\n    // Event Handlers - well, at least they handle the event handlers//\r\n    self.handlers = {\r\n        start: () => {},\r\n        move: () => {},\r\n        end: () => {},\r\n        touchmove: () => {},\r\n        touchstart: () => {},\r\n        touchend: () => {},\r\n    }\r\n\r\n    // overwrite event handlers\r\n    self.set = (eHandlers) => {\r\n        Object.assign(self.handlers, eHandlers)\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport EventHandlers from './EventHandlers.js'\r\n\r\n/**\r\n * Set up a screen to view some objects.\r\n * A detail here is that we have browser pixels and device pixels.\r\n * Broswer pixels feel about the same size on any device (visual arc length).\r\n * Device pixels can be much smaller for high-dpi devices.\r\n * @param {Number} w - width in browser pixels of the canvas.\r\n * @param {Number} h - height in browser pixels of the canvas.\r\n * @param {Layout} layout\r\n * @constructor\r\n */\r\nexport default function Screen(w, h, layout) {\r\n    const self = this\r\n\r\n    self.width = w // measured in browser pixels\r\n    self.height = h\r\n\r\n    // canvas\r\n    self.canvas = document.createElement('canvas')\r\n    self.canvas.setAttribute('class', 'background')\r\n    self.ctx = self.canvas.getContext('2d')\r\n\r\n    // tooltips\r\n    self.tooltips = document.createElement('div')\r\n    self.tooltips.setAttribute('class', 'tooltips')\r\n\r\n    // foreground\r\n    self.foreground = document.createElement('canvas')\r\n    self.foreground.setAttribute('class', 'foreground')\r\n    self.fctx = self.foreground.getContext('2d')\r\n\r\n    // maps\r\n    self.maps = document.createElement('canvas')\r\n    self.maps.setAttribute('class', 'maps')\r\n    self.mctx = self.maps.getContext('2d')\r\n\r\n    const clearDiv = document.createElement('div')\r\n\r\n    // wrap\r\n    self.wrap = document.createElement('div')\r\n    self.wrap.setAttribute('class', 'screenWrap')\r\n    self.wrap.appendChild(clearDiv)\r\n    self.wrap.appendChild(self.canvas)\r\n    self.wrap.appendChild(self.tooltips)\r\n    self.wrap.appendChild(self.foreground)\r\n\r\n    layout.newElement('screenWrap', self.wrap)\r\n    layout.newElement('maps', self.maps)\r\n\r\n    self.noBuffers = false\r\n\r\n    // use scaling for high DPI devices instead of multiplying every time inside draw calls\r\n    // https://www.html5rocks.com/en/tutorials/canvas/hidpi/\r\n    self.pixelRatio = getPixelRatio(self.ctx)\r\n\r\n    self.canvas.width = w * self.pixelRatio // measured in device pixels\r\n    self.canvas.height = h * self.pixelRatio\r\n\r\n    self.canvas.style.width = `${w}px`\r\n    self.canvas.style.height = `${h}px`\r\n\r\n    self.wrap.style.width = `${w}px`\r\n    self.wrap.style.height = `${h}px`\r\n\r\n    self.tooltips.style.width = `${w}px`\r\n    self.tooltips.style.height = `${h}px`\r\n\r\n    self.foreground.width = w * self.pixelRatio // measured in device pixels\r\n    self.foreground.height = h * self.pixelRatio\r\n\r\n    self.foreground.style.width = `${w}px`\r\n    self.foreground.style.height = `${h}px`\r\n\r\n    self.maps.width = w * self.pixelRatio // measured in device pixels\r\n    self.maps.style.width = `${w}px`\r\n    self.setMapsHeight = (height) => {\r\n        const h3 = Math.round(height)\r\n        self.maps.heightBrowser = h3\r\n        self.maps.height = h3 * self.pixelRatio // measured in device pixels\r\n        self.maps.style.height = `${h3}px` // measured in browser pixels\r\n        self.mctx.scale(self.pixelRatio, self.pixelRatio)\r\n    }\r\n    self.setMapsHeight((1 / 3) * h)\r\n\r\n    self.ctx.scale(self.pixelRatio, self.pixelRatio)\r\n    self.fctx.scale(self.pixelRatio, self.pixelRatio)\r\n\r\n    self.clear = function () {\r\n        self.ctx.clearRect(0, 0, self.canvas.width, self.canvas.height)\r\n    }\r\n    self.clearForeground = function () {\r\n        self.fctx.clearRect(0, 0, self.foreground.width, self.foreground.height)\r\n    }\r\n    self.clearMaps = function () {\r\n        self.mctx.clearRect(0, 0, self.maps.width, self.maps.height)\r\n    }\r\n    self.setCtx = function (c) {\r\n        self.ctx = c\r\n    }\r\n    self.setFCtx = function (c) {\r\n        self.fctx = c\r\n    }\r\n    self.setMCtx = function (c) {\r\n        self.mctx = c\r\n    }\r\n    self.setNoBuffers = function (noBuffers) {\r\n        self.noBuffers = noBuffers\r\n    }\r\n    self.showMaps = () => {\r\n        self.maps.style.display = 'block'\r\n    }\r\n    self.hideMaps = () => {\r\n        self.maps.style.display = 'none'\r\n    }\r\n    self.hideMaps()\r\n\r\n    self.eventHandlers = new EventHandlers()\r\n    const { handlers } = self.eventHandlers\r\n\r\n    self.wrap.onmousedown = (e) => handlers.start(e)\r\n    self.wrap.onmousemove = (e) => handlers.move(e)\r\n    self.wrap.onmouseup = (e) => handlers.end(e)\r\n    self.wrap.addEventListener('touchmove', (e) => handlers.touchmove(e))\r\n    self.wrap.addEventListener('touchstart', (e) => handlers.touchstart(e))\r\n    self.wrap.addEventListener('touchend', (e) => handlers.touchend(e))\r\n\r\n    // mouse up outside of canvas\r\n    const current = document.onmouseup\r\n    document.onmouseup = (e) => {\r\n        if (current) current(e)\r\n        self.wrap.onmouseup(e)\r\n    }\r\n}\r\n\r\nfunction getPixelRatio(context) {\r\n    const backingStore = context.backingStorePixelRatio\r\n          || context.webkitBackingStorePixelRatio\r\n          || context.mozBackingStorePixelRatio\r\n          || context.msBackingStorePixelRatio\r\n          || context.oBackingStorePixelRatio\r\n          || context.backingStorePixelRatio || 1\r\n\r\n    return (window.devicePixelRatio || 1) / backingStore\r\n}\r\n","/*!!\r\n *  Canvas 2 Svg v1.0.21\r\n *  A low level canvas to SVG converter. Uses a mock canvas context to build an SVG document.\r\n *\r\n *  Licensed under the MIT license:\r\n *  http://www.opensource.org/licenses/mit-license.php\r\n *\r\n *  Author:\r\n *  Kerry Liu\r\n *\r\n *  Copyright (c) 2014 Gliffy Inc.\r\n */\r\n\r\n    var STYLES, ctx, CanvasGradient, CanvasPattern, namedEntities;\r\n\r\n    //helper function to format a string\r\n    function format(str, args) {\r\n        var keys = Object.keys(args), i;\r\n        for (i=0; i<keys.length; i++) {\r\n            str = str.replace(new RegExp(\"\\\\{\" + keys[i] + \"\\\\}\", \"gi\"), args[keys[i]]);\r\n        }\r\n        return str;\r\n    }\r\n\r\n    //helper function that generates a random string\r\n    function randomString(holder) {\r\n        var chars, randomstring, i;\r\n        if (!holder) {\r\n            throw new Error(\"cannot create a random attribute name for an undefined object\");\r\n        }\r\n        chars = \"ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz\";\r\n        randomstring = \"\";\r\n        do {\r\n            randomstring = \"\";\r\n            for (i = 0; i < 12; i++) {\r\n                randomstring += chars[Math.floor(Math.random() * chars.length)];\r\n            }\r\n        } while (holder[randomstring]);\r\n        return randomstring;\r\n    }\r\n\r\n    //helper function to map named to numbered entities\r\n    function createNamedToNumberedLookup(items, radix) {\r\n        var i, entity, lookup = {}, base10;\r\n        items = items.split(',');\r\n        radix = radix || 10;\r\n        // Map from named to numbered entities.\r\n        for (i = 0; i < items.length; i += 2) {\r\n            entity = '&' + items[i + 1] + ';';\r\n            base10 = parseInt(items[i], radix);\r\n            lookup[entity] = '&#'+base10+';';\r\n        }\r\n        //FF and IE need to create a regex from hex values ie &nbsp; == \\xa0\r\n        lookup[\"\\\\xa0\"] = '&#160;';\r\n        return lookup;\r\n    }\r\n\r\n    //helper function to map canvas-textAlign to svg-textAnchor\r\n    function getTextAnchor(textAlign) {\r\n        //TODO: support rtl languages\r\n        var mapping = {\"left\":\"start\", \"right\":\"end\", \"center\":\"middle\", \"start\":\"start\", \"end\":\"end\"};\r\n        return mapping[textAlign] || mapping.start;\r\n    }\r\n\r\n    //helper function to map canvas-textBaseline to svg-dominantBaseline\r\n    function getDominantBaseline(textBaseline) {\r\n        //INFO: not supported in all browsers\r\n        var mapping = {\"alphabetic\": \"alphabetic\", \"hanging\": \"hanging\", \"top\":\"text-before-edge\", \"bottom\":\"text-after-edge\", \"middle\":\"central\"};\r\n        return mapping[textBaseline] || mapping.alphabetic;\r\n    }\r\n\r\n    // Unpack entities lookup where the numbers are in radix 32 to reduce the size\r\n    // entity mapping courtesy of tinymce\r\n    namedEntities = createNamedToNumberedLookup(\r\n        '50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,' +\r\n            '5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,' +\r\n            '5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,' +\r\n            '5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,' +\r\n            '68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,' +\r\n            '6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,' +\r\n            '6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,' +\r\n            '75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,' +\r\n            '7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,' +\r\n            '7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,' +\r\n            'sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,' +\r\n            'st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,' +\r\n            't9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,' +\r\n            'tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,' +\r\n            'u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,' +\r\n            '81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,' +\r\n            '8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,' +\r\n            '8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,' +\r\n            '8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,' +\r\n            '8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,' +\r\n            'nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,' +\r\n            'rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,' +\r\n            'Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,' +\r\n            '80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,' +\r\n            '811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro', 32);\r\n\r\n\r\n    //Some basic mappings for attributes and default values.\r\n    STYLES = {\r\n        \"strokeStyle\":{\r\n            svgAttr : \"stroke\", //corresponding svg attribute\r\n            canvas : \"#000000\", //canvas default\r\n            svg : \"none\",       //svg default\r\n            apply : \"stroke\"    //apply on stroke() or fill()\r\n        },\r\n        \"fillStyle\":{\r\n            svgAttr : \"fill\",\r\n            canvas : \"#000000\",\r\n            svg : null, //svg default is black, but we need to special case this to handle canvas stroke without fill\r\n            apply : \"fill\"\r\n        },\r\n        \"lineCap\":{\r\n            svgAttr : \"stroke-linecap\",\r\n            canvas : \"butt\",\r\n            svg : \"butt\",\r\n            apply : \"stroke\"\r\n        },\r\n        \"lineJoin\":{\r\n            svgAttr : \"stroke-linejoin\",\r\n            canvas : \"miter\",\r\n            svg : \"miter\",\r\n            apply : \"stroke\"\r\n        },\r\n        \"miterLimit\":{\r\n            svgAttr : \"stroke-miterlimit\",\r\n            canvas : 10,\r\n            svg : 4,\r\n            apply : \"stroke\"\r\n        },\r\n        \"lineWidth\":{\r\n            svgAttr : \"stroke-width\",\r\n            canvas : 1,\r\n            svg : 1,\r\n            apply : \"stroke\"\r\n        },\r\n        \"globalAlpha\": {\r\n            svgAttr : \"opacity\",\r\n            canvas : 1,\r\n            svg : 1,\r\n            apply :  \"fill stroke\"\r\n        },\r\n        \"font\":{\r\n            //font converts to multiple svg attributes, there is custom logic for this\r\n            canvas : \"10px sans-serif\"\r\n        },\r\n        \"shadowColor\":{\r\n            canvas : \"#000000\"\r\n        },\r\n        \"shadowOffsetX\":{\r\n            canvas : 0\r\n        },\r\n        \"shadowOffsetY\":{\r\n            canvas : 0\r\n        },\r\n        \"shadowBlur\":{\r\n            canvas : 0\r\n        },\r\n        \"textAlign\":{\r\n            canvas : \"start\"\r\n        },\r\n        \"textBaseline\":{\r\n            canvas : \"alphabetic\"\r\n        },\r\n        \"lineDash\" : {\r\n            svgAttr : \"stroke-dasharray\",\r\n            canvas : [],\r\n            svg : null,\r\n            apply : \"stroke\"\r\n        }\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param gradientNode - reference to the gradient\r\n     * @constructor\r\n     */\r\n    CanvasGradient = function (gradientNode, ctx) {\r\n        this.__root = gradientNode;\r\n        this.__ctx = ctx;\r\n    };\r\n\r\n    /**\r\n     * Adds a color stop to the gradient root\r\n     */\r\n    CanvasGradient.prototype.addColorStop = function (offset, color) {\r\n        var stop = this.__ctx.__createElement(\"stop\"), regex, matches;\r\n        stop.setAttribute(\"offset\", offset);\r\n        if (color.indexOf(\"rgba\") !== -1) {\r\n            //separate alpha value, since webkit can't handle it\r\n            regex = /rgba\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d?\\.?\\d*)\\s*\\)/gi;\r\n            matches = regex.exec(color);\r\n            stop.setAttribute(\"stop-color\", format(\"rgb({r},{g},{b})\", {r:matches[1], g:matches[2], b:matches[3]}));\r\n            stop.setAttribute(\"stop-opacity\", matches[4]);\r\n        } else {\r\n            stop.setAttribute(\"stop-color\", color);\r\n        }\r\n        this.__root.appendChild(stop);\r\n    };\r\n\r\n    CanvasPattern = function (pattern, ctx) {\r\n        this.__root = pattern;\r\n        this.__ctx = ctx;\r\n    };\r\n\r\n    /**\r\n     * The mock canvas context\r\n     * @param o - options include:\r\n     * ctx - existing Context2D to wrap around\r\n     * width - width of your canvas (defaults to 500)\r\n     * height - height of your canvas (defaults to 500)\r\n     * enableMirroring - enables canvas mirroring (get image data) (defaults to false)\r\n     * document - the document object (defaults to the current document)\r\n     */\r\n    ctx = function (o) {\r\n        var defaultOptions = { width:500, height:500, enableMirroring : false}, options;\r\n\r\n        //keep support for this way of calling C2S: new C2S(width,height)\r\n        if (arguments.length > 1) {\r\n            options = defaultOptions;\r\n            options.width = arguments[0];\r\n            options.height = arguments[1];\r\n        } else if ( !o ) {\r\n            options = defaultOptions;\r\n        } else {\r\n            options = o;\r\n        }\r\n\r\n        if (!(this instanceof ctx)) {\r\n            //did someone call this without new?\r\n            return new ctx(options);\r\n        }\r\n\r\n        //setup options\r\n        this.width = options.width || defaultOptions.width;\r\n        this.height = options.height || defaultOptions.height;\r\n        this.enableMirroring = options.enableMirroring !== undefined ? options.enableMirroring : defaultOptions.enableMirroring;\r\n\r\n        this.canvas = this;   ///point back to this instance!\r\n        this.__document = options.document || document;\r\n\r\n        // allow passing in an existing context to wrap around\r\n        // if a context is passed in, we know a canvas already exist\r\n        if (options.ctx) {\r\n            this.__ctx = options.ctx;\r\n        } else {\r\n            this.__canvas = this.__document.createElement(\"canvas\");\r\n            this.__ctx = this.__canvas.getContext(\"2d\");\r\n        }\r\n\r\n        this.__setDefaultStyles();\r\n        this.__stack = [this.__getStyleState()];\r\n        this.__groupStack = [];\r\n\r\n        //the root svg element\r\n        this.__root = this.__document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\r\n        this.__root.setAttribute(\"version\", 1.1);\r\n        this.__root.setAttribute(\"xmlns\", \"http://www.w3.org/2000/svg\");\r\n        this.__root.setAttributeNS(\"http://www.w3.org/2000/xmlns/\", \"xmlns:xlink\", \"http://www.w3.org/1999/xlink\");\r\n        this.__root.setAttribute(\"width\", this.width);\r\n        this.__root.setAttribute(\"height\", this.height);\r\n\r\n        //make sure we don't generate the same ids in defs\r\n        this.__ids = {};\r\n\r\n        //defs tag\r\n        this.__defs = this.__document.createElementNS(\"http://www.w3.org/2000/svg\", \"defs\");\r\n        this.__root.appendChild(this.__defs);\r\n\r\n        //also add a group child. the svg element can't use the transform attribute\r\n        this.__currentElement = this.__document.createElementNS(\"http://www.w3.org/2000/svg\", \"g\");\r\n        this.__root.appendChild(this.__currentElement);\r\n    };\r\n\r\n\r\n    /**\r\n     * Creates the specified svg element\r\n     * @private\r\n     */\r\n    ctx.prototype.__createElement = function (elementName, properties, resetFill) {\r\n        if (typeof properties === \"undefined\") {\r\n            properties = {};\r\n        }\r\n\r\n        var element = this.__document.createElementNS(\"http://www.w3.org/2000/svg\", elementName),\r\n            keys = Object.keys(properties), i, key;\r\n        if (resetFill) {\r\n            //if fill or stroke is not specified, the svg element should not display. By default SVG's fill is black.\r\n            element.setAttribute(\"fill\", \"none\");\r\n            element.setAttribute(\"stroke\", \"none\");\r\n        }\r\n        for (i=0; i<keys.length; i++) {\r\n            key = keys[i];\r\n            element.setAttribute(key, properties[key]);\r\n        }\r\n        return element;\r\n    };\r\n\r\n    /**\r\n     * Applies default canvas styles to the context\r\n     * @private\r\n     */\r\n    ctx.prototype.__setDefaultStyles = function () {\r\n        //default 2d canvas context properties see:http://www.w3.org/TR/2dcontext/\r\n        var keys = Object.keys(STYLES), i, key;\r\n        for (i=0; i<keys.length; i++) {\r\n            key = keys[i];\r\n            this[key] = STYLES[key].canvas;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Applies styles on restore\r\n     * @param styleState\r\n     * @private\r\n     */\r\n    ctx.prototype.__applyStyleState = function (styleState) {\r\n        var keys = Object.keys(styleState), i, key;\r\n        for (i=0; i<keys.length; i++) {\r\n            key = keys[i];\r\n            this[key] = styleState[key];\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Gets the current style state\r\n     * @return {Object}\r\n     * @private\r\n     */\r\n    ctx.prototype.__getStyleState = function () {\r\n        var i, styleState = {}, keys = Object.keys(STYLES), key;\r\n        for (i=0; i<keys.length; i++) {\r\n            key = keys[i];\r\n            styleState[key] = this[key];\r\n        }\r\n        return styleState;\r\n    };\r\n\r\n    /**\r\n     * Apples the current styles to the current SVG element. On \"ctx.fill\" or \"ctx.stroke\"\r\n     * @param type\r\n     * @private\r\n     */\r\n    ctx.prototype.__applyStyleToCurrentElement = function (type) {\r\n    \tvar currentElement = this.__currentElement;\r\n    \tvar currentStyleGroup = this.__currentElementsToStyle;\r\n    \tif (currentStyleGroup) {\r\n    \t\tcurrentElement.setAttribute(type, \"\");\r\n    \t\tcurrentElement = currentStyleGroup.element;\r\n    \t\tcurrentStyleGroup.children.forEach(function (node) {\r\n    \t\t\tnode.setAttribute(type, \"\");\r\n    \t\t});\r\n    \t}\r\n\r\n        var keys = Object.keys(STYLES), i, style, value, id, regex, matches;\r\n        for (i = 0; i < keys.length; i++) {\r\n            style = STYLES[keys[i]];\r\n            value = this[keys[i]];\r\n            if (style.apply) {\r\n                //is this a gradient or pattern?\r\n                if (value instanceof CanvasPattern) {\r\n                    //pattern\r\n                    if (value.__ctx) {\r\n                        //copy over defs\r\n                        while(value.__ctx.__defs.childNodes.length) {\r\n                            id = value.__ctx.__defs.childNodes[0].getAttribute(\"id\");\r\n                            this.__ids[id] = id;\r\n                            this.__defs.appendChild(value.__ctx.__defs.childNodes[0]);\r\n                        }\r\n                    }\r\n                    currentElement.setAttribute(style.apply, format(\"url(#{id})\", {id:value.__root.getAttribute(\"id\")}));\r\n                }\r\n                else if (value instanceof CanvasGradient) {\r\n                    //gradient\r\n                    currentElement.setAttribute(style.apply, format(\"url(#{id})\", {id:value.__root.getAttribute(\"id\")}));\r\n                } else if (style.apply.indexOf(type)!==-1 && style.svg !== value) {\r\n                    if ((style.svgAttr === \"stroke\" || style.svgAttr === \"fill\") && value.indexOf(\"rgba\") !== -1) {\r\n                        //separate alpha value, since illustrator can't handle it\r\n                        regex = /rgba\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d?\\.?\\d*)\\s*\\)/gi;\r\n                        matches = regex.exec(value);\r\n                        currentElement.setAttribute(style.svgAttr, format(\"rgb({r},{g},{b})\", {r:matches[1], g:matches[2], b:matches[3]}));\r\n                        //should take globalAlpha here\r\n                        var opacity = matches[4];\r\n                        var globalAlpha = this.globalAlpha;\r\n                        if (globalAlpha != null) {\r\n                            opacity *= globalAlpha;\r\n                        }\r\n                        currentElement.setAttribute(style.svgAttr+\"-opacity\", opacity);\r\n                    } else {\r\n                        var attr = style.svgAttr;\r\n                        if (keys[i] === 'globalAlpha') {\r\n                            attr = type+'-'+style.svgAttr;\r\n                            if (currentElement.getAttribute(attr)) {\r\n                                 //fill-opacity or stroke-opacity has already been set by stroke or fill.\r\n                                continue;\r\n                            }\r\n                        }\r\n                        //otherwise only update attribute if right type, and not svg default\r\n                        currentElement.setAttribute(attr, value);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Will return the closest group or svg node. May return the current element.\r\n     * @private\r\n     */\r\n    ctx.prototype.__closestGroupOrSvg = function (node) {\r\n        node = node || this.__currentElement;\r\n        if (node.nodeName === \"g\" || node.nodeName === \"svg\") {\r\n            return node;\r\n        } else {\r\n            return this.__closestGroupOrSvg(node.parentNode);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Returns the serialized value of the svg so far\r\n     * @param fixNamedEntities - Standalone SVG doesn't support named entities, which document.createTextNode encodes.\r\n     *                           If true, we attempt to find all named entities and encode it as a numeric entity.\r\n     * @return serialized svg\r\n     */\r\n    ctx.prototype.getSerializedSvg = function (fixNamedEntities) {\r\n        var serialized = new XMLSerializer().serializeToString(this.__root),\r\n            keys, i, key, value, regexp, xmlns;\r\n\r\n        //IE search for a duplicate xmnls because they didn't implement setAttributeNS correctly\r\n        xmlns = /xmlns=\"http:\\/\\/www\\.w3\\.org\\/2000\\/svg\".+xmlns=\"http:\\/\\/www\\.w3\\.org\\/2000\\/svg/gi;\r\n        if (xmlns.test(serialized)) {\r\n            serialized = serialized.replace('xmlns=\"http://www.w3.org/2000/svg','xmlns:xlink=\"http://www.w3.org/1999/xlink');\r\n        }\r\n\r\n        if (fixNamedEntities) {\r\n            keys = Object.keys(namedEntities);\r\n            //loop over each named entity and replace with the proper equivalent.\r\n            for (i=0; i<keys.length; i++) {\r\n                key = keys[i];\r\n                value = namedEntities[key];\r\n                regexp = new RegExp(key, \"gi\");\r\n                if (regexp.test(serialized)) {\r\n                    serialized = serialized.replace(regexp, value);\r\n                }\r\n            }\r\n        }\r\n\r\n        return serialized;\r\n    };\r\n\r\n\r\n    /**\r\n     * Returns the root svg\r\n     * @return\r\n     */\r\n    ctx.prototype.getSvg = function () {\r\n        return this.__root;\r\n    };\r\n    /**\r\n     * Will generate a group tag.\r\n     */\r\n    ctx.prototype.save = function () {\r\n        var group = this.__createElement(\"g\");\r\n        var parent = this.__closestGroupOrSvg();\r\n        this.__groupStack.push(parent);\r\n        parent.appendChild(group);\r\n        this.__currentElement = group;\r\n        this.__stack.push(this.__getStyleState());\r\n    };\r\n    /**\r\n     * Sets current element to parent, or just root if already root\r\n     */\r\n    ctx.prototype.restore = function () {\r\n        this.__currentElement = this.__groupStack.pop();\r\n        this.__currentElementsToStyle = null;\r\n        //Clearing canvas will make the poped group invalid, currentElement is set to the root group node.\r\n        if (!this.__currentElement) {\r\n            this.__currentElement = this.__root.childNodes[1];\r\n        }\r\n        var state = this.__stack.pop();\r\n        this.__applyStyleState(state);\r\n    };\r\n\r\n    /**\r\n     * Helper method to add transform\r\n     * @private\r\n     */\r\n    ctx.prototype.__addTransform = function (t) {\r\n        //if the current element has siblings, add another group\r\n        var parent = this.__closestGroupOrSvg();\r\n        if (parent.childNodes.length > 0) {\r\n        \tif (this.__currentElement.nodeName === \"path\") {\r\n        \t\tif (!this.__currentElementsToStyle) this.__currentElementsToStyle = {element: parent, children: []};\r\n        \t\tthis.__currentElementsToStyle.children.push(this.__currentElement);\r\n        \t\tthis.__applyCurrentDefaultPath();\r\n        \t}\r\n\r\n            var group = this.__createElement(\"g\");\r\n            parent.appendChild(group);\r\n            this.__currentElement = group;\r\n        }\r\n\r\n        var transform = this.__currentElement.getAttribute(\"transform\");\r\n        if (transform) {\r\n            transform += \" \";\r\n        } else {\r\n            transform = \"\";\r\n        }\r\n        transform += t;\r\n        this.__currentElement.setAttribute(\"transform\", transform);\r\n    };\r\n\r\n    /**\r\n     *  scales the current element\r\n     */\r\n    ctx.prototype.scale = function (x, y) {\r\n        if (y === undefined) {\r\n            y = x;\r\n        }\r\n        this.__addTransform(format(\"scale({x},{y})\", {x:x, y:y}));\r\n    };\r\n\r\n    /**\r\n     * rotates the current element\r\n     */\r\n    ctx.prototype.rotate = function (angle) {\r\n        var degrees = (angle * 180 / Math.PI);\r\n        this.__addTransform(format(\"rotate({angle},{cx},{cy})\", {angle:degrees, cx:0, cy:0}));\r\n    };\r\n\r\n    /**\r\n     * translates the current element\r\n     */\r\n    ctx.prototype.translate = function (x, y) {\r\n        this.__addTransform(format(\"translate({x},{y})\", {x:x,y:y}));\r\n    };\r\n\r\n    /**\r\n     * applies a transform to the current element\r\n     */\r\n    ctx.prototype.transform = function (a, b, c, d, e, f) {\r\n        this.__addTransform(format(\"matrix({a},{b},{c},{d},{e},{f})\", {a:a, b:b, c:c, d:d, e:e, f:f}));\r\n    };\r\n\r\n    /**\r\n     * Create a new Path Element\r\n     */\r\n    ctx.prototype.beginPath = function () {\r\n        var path, parent;\r\n\r\n        // Note that there is only one current default path, it is not part of the drawing state.\r\n        // See also: https://html.spec.whatwg.org/multipage/scripting.html#current-default-path\r\n        this.__currentDefaultPath = \"\";\r\n        this.__currentPosition = {};\r\n\r\n        path = this.__createElement(\"path\", {}, true);\r\n        parent = this.__closestGroupOrSvg();\r\n        parent.appendChild(path);\r\n        this.__currentElement = path;\r\n    };\r\n\r\n    /**\r\n     * Helper function to apply currentDefaultPath to current path element\r\n     * @private\r\n     */\r\n    ctx.prototype.__applyCurrentDefaultPath = function () {\r\n    \tvar currentElement = this.__currentElement;\r\n        if (currentElement.nodeName === \"path\") {\r\n\t\t\tcurrentElement.setAttribute(\"d\", this.__currentDefaultPath);\r\n        } else {\r\n\t\t\tconsole.error(\"Attempted to apply path command to node\", currentElement.nodeName);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Helper function to add path command\r\n     * @private\r\n     */\r\n    ctx.prototype.__addPathCommand = function (command) {\r\n        this.__currentDefaultPath += \" \";\r\n        this.__currentDefaultPath += command;\r\n    };\r\n\r\n    /**\r\n     * Adds the move command to the current path element,\r\n     * if the currentPathElement is not empty create a new path element\r\n     */\r\n    ctx.prototype.moveTo = function (x,y) {\r\n        if (this.__currentElement.nodeName !== \"path\") {\r\n            this.beginPath();\r\n        }\r\n\r\n        // creates a new subpath with the given point\r\n        this.__currentPosition = {x: x, y: y};\r\n        this.__addPathCommand(format(\"M {x} {y}\", {x:x, y:y}));\r\n    };\r\n\r\n    /**\r\n     * Closes the current path\r\n     */\r\n    ctx.prototype.closePath = function () {\r\n        if (this.__currentDefaultPath) {\r\n            this.__addPathCommand(\"Z\");\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Adds a line to command\r\n     */\r\n    ctx.prototype.lineTo = function (x, y) {\r\n        this.__currentPosition = {x: x, y: y};\r\n        if (this.__currentDefaultPath.indexOf('M') > -1) {\r\n            this.__addPathCommand(format(\"L {x} {y}\", {x:x, y:y}));\r\n        } else {\r\n            this.__addPathCommand(format(\"M {x} {y}\", {x:x, y:y}));\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Add a bezier command\r\n     */\r\n    ctx.prototype.bezierCurveTo = function (cp1x, cp1y, cp2x, cp2y, x, y) {\r\n        this.__currentPosition = {x: x, y: y};\r\n        this.__addPathCommand(format(\"C {cp1x} {cp1y} {cp2x} {cp2y} {x} {y}\",\r\n            {cp1x:cp1x, cp1y:cp1y, cp2x:cp2x, cp2y:cp2y, x:x, y:y}));\r\n    };\r\n\r\n    /**\r\n     * Adds a quadratic curve to command\r\n     */\r\n    ctx.prototype.quadraticCurveTo = function (cpx, cpy, x, y) {\r\n        this.__currentPosition = {x: x, y: y};\r\n        this.__addPathCommand(format(\"Q {cpx} {cpy} {x} {y}\", {cpx:cpx, cpy:cpy, x:x, y:y}));\r\n    };\r\n\r\n\r\n    /**\r\n     * Return a new normalized vector of given vector\r\n     */\r\n    var normalize = function (vector) {\r\n        var len = Math.sqrt(vector[0] * vector[0] + vector[1] * vector[1]);\r\n        return [vector[0] / len, vector[1] / len];\r\n    };\r\n\r\n    /**\r\n     * Adds the arcTo to the current path\r\n     *\r\n     * @see http://www.w3.org/TR/2015/WD-2dcontext-20150514/#dom-context-2d-arcto\r\n     */\r\n    ctx.prototype.arcTo = function (x1, y1, x2, y2, radius) {\r\n        // Let the point (x0, y0) be the last point in the subpath.\r\n        var x0 = this.__currentPosition && this.__currentPosition.x;\r\n        var y0 = this.__currentPosition && this.__currentPosition.y;\r\n\r\n        // First ensure there is a subpath for (x1, y1).\r\n        if (typeof x0 == \"undefined\" || typeof y0 == \"undefined\") {\r\n            return;\r\n        }\r\n\r\n        // Negative values for radius must cause the implementation to throw an IndexSizeError exception.\r\n        if (radius < 0) {\r\n            throw new Error(\"IndexSizeError: The radius provided (\" + radius + \") is negative.\");\r\n        }\r\n\r\n        // If the point (x0, y0) is equal to the point (x1, y1),\r\n        // or if the point (x1, y1) is equal to the point (x2, y2),\r\n        // or if the radius radius is zero,\r\n        // then the method must add the point (x1, y1) to the subpath,\r\n        // and connect that point to the previous point (x0, y0) by a straight line.\r\n        if (((x0 === x1) && (y0 === y1))\r\n            || ((x1 === x2) && (y1 === y2))\r\n            || (radius === 0)) {\r\n            this.lineTo(x1, y1);\r\n            return;\r\n        }\r\n\r\n        // Otherwise, if the points (x0, y0), (x1, y1), and (x2, y2) all lie on a single straight line,\r\n        // then the method must add the point (x1, y1) to the subpath,\r\n        // and connect that point to the previous point (x0, y0) by a straight line.\r\n        var unit_vec_p1_p0 = normalize([x0 - x1, y0 - y1]);\r\n        var unit_vec_p1_p2 = normalize([x2 - x1, y2 - y1]);\r\n        if (unit_vec_p1_p0[0] * unit_vec_p1_p2[1] === unit_vec_p1_p0[1] * unit_vec_p1_p2[0]) {\r\n            this.lineTo(x1, y1);\r\n            return;\r\n        }\r\n\r\n        // Otherwise, let The Arc be the shortest arc given by circumference of the circle that has radius radius,\r\n        // and that has one point tangent to the half-infinite line that crosses the point (x0, y0) and ends at the point (x1, y1),\r\n        // and that has a different point tangent to the half-infinite line that ends at the point (x1, y1), and crosses the point (x2, y2).\r\n        // The points at which this circle touches these two lines are called the start and end tangent points respectively.\r\n\r\n        // note that both vectors are unit vectors, so the length is 1\r\n        var cos = (unit_vec_p1_p0[0] * unit_vec_p1_p2[0] + unit_vec_p1_p0[1] * unit_vec_p1_p2[1]);\r\n        var theta = Math.acos(Math.abs(cos));\r\n\r\n        // Calculate origin\r\n        var unit_vec_p1_origin = normalize([\r\n            unit_vec_p1_p0[0] + unit_vec_p1_p2[0],\r\n            unit_vec_p1_p0[1] + unit_vec_p1_p2[1]\r\n        ]);\r\n        var len_p1_origin = radius / Math.sin(theta / 2);\r\n        var x = x1 + len_p1_origin * unit_vec_p1_origin[0];\r\n        var y = y1 + len_p1_origin * unit_vec_p1_origin[1];\r\n\r\n        // Calculate start angle and end angle\r\n        // rotate 90deg clockwise (note that y axis points to its down)\r\n        var unit_vec_origin_start_tangent = [\r\n            -unit_vec_p1_p0[1],\r\n            unit_vec_p1_p0[0]\r\n        ];\r\n        // rotate 90deg counter clockwise (note that y axis points to its down)\r\n        var unit_vec_origin_end_tangent = [\r\n            unit_vec_p1_p2[1],\r\n            -unit_vec_p1_p2[0]\r\n        ];\r\n        var getAngle = function (vector) {\r\n            // get angle (clockwise) between vector and (1, 0)\r\n            var x = vector[0];\r\n            var y = vector[1];\r\n            if (y >= 0) { // note that y axis points to its down\r\n                return Math.acos(x);\r\n            } else {\r\n                return -Math.acos(x);\r\n            }\r\n        };\r\n        var startAngle = getAngle(unit_vec_origin_start_tangent);\r\n        var endAngle = getAngle(unit_vec_origin_end_tangent);\r\n\r\n        // Connect the point (x0, y0) to the start tangent point by a straight line\r\n        this.lineTo(x + unit_vec_origin_start_tangent[0] * radius,\r\n                    y + unit_vec_origin_start_tangent[1] * radius);\r\n\r\n        // Connect the start tangent point to the end tangent point by arc\r\n        // and adding the end tangent point to the subpath.\r\n        this.arc(x, y, radius, startAngle, endAngle);\r\n    };\r\n\r\n    /**\r\n     * Sets the stroke property on the current element\r\n     */\r\n    ctx.prototype.stroke = function () {\r\n        if (this.__currentElement.nodeName === \"path\") {\r\n            this.__currentElement.setAttribute(\"paint-order\", \"fill stroke markers\");\r\n        }\r\n        this.__applyCurrentDefaultPath();\r\n        this.__applyStyleToCurrentElement(\"stroke\");\r\n    };\r\n\r\n    /**\r\n     * Sets fill properties on the current element\r\n     */\r\n    ctx.prototype.fill = function () {\r\n        if (this.__currentElement.nodeName === \"path\") {\r\n            this.__currentElement.setAttribute(\"paint-order\", \"stroke fill markers\");\r\n        }\r\n        this.__applyCurrentDefaultPath();\r\n        this.__applyStyleToCurrentElement(\"fill\");\r\n    };\r\n\r\n    /**\r\n     *  Adds a rectangle to the path.\r\n     */\r\n    ctx.prototype.rect = function (x, y, width, height) {\r\n        if (this.__currentElement.nodeName !== \"path\") {\r\n            this.beginPath();\r\n        }\r\n        this.moveTo(x, y);\r\n        this.lineTo(x+width, y);\r\n        this.lineTo(x+width, y+height);\r\n        this.lineTo(x, y+height);\r\n        this.lineTo(x, y);\r\n        this.closePath();\r\n    };\r\n\r\n\r\n    /**\r\n     * adds a rectangle element\r\n     */\r\n    ctx.prototype.fillRect = function (x, y, width, height) {\r\n        var rect, parent;\r\n        rect = this.__createElement(\"rect\", {\r\n            x : x,\r\n            y : y,\r\n            width : width,\r\n            height : height\r\n        }, true);\r\n        parent = this.__closestGroupOrSvg();\r\n        parent.appendChild(rect);\r\n        this.__currentElement = rect;\r\n        this.__applyStyleToCurrentElement(\"fill\");\r\n    };\r\n\r\n    /**\r\n     * Draws a rectangle with no fill\r\n     * @param x\r\n     * @param y\r\n     * @param width\r\n     * @param height\r\n     */\r\n    ctx.prototype.strokeRect = function (x, y, width, height) {\r\n        var rect, parent;\r\n        rect = this.__createElement(\"rect\", {\r\n            x : x,\r\n            y : y,\r\n            width : width,\r\n            height : height\r\n        }, true);\r\n        parent = this.__closestGroupOrSvg();\r\n        parent.appendChild(rect);\r\n        this.__currentElement = rect;\r\n        this.__applyStyleToCurrentElement(\"stroke\");\r\n    };\r\n\r\n\r\n    /**\r\n     * Clear entire canvas:\r\n     * 1. save current transforms\r\n     * 2. remove all the childNodes of the root g element\r\n     */\r\n    ctx.prototype.__clearCanvas = function () {\r\n        var current = this.__closestGroupOrSvg(),\r\n            transform = current.getAttribute(\"transform\");\r\n        var rootGroup = this.__root.childNodes[1];\r\n        var childNodes = rootGroup.childNodes;\r\n        for (var i = childNodes.length - 1; i >= 0; i--) {\r\n            if (childNodes[i]) {\r\n                rootGroup.removeChild(childNodes[i]);\r\n            }\r\n        }\r\n        this.__currentElement = rootGroup;\r\n        //reset __groupStack as all the child group nodes are all removed.\r\n        this.__groupStack = [];\r\n        if (transform) {\r\n            this.__addTransform(transform);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * \"Clears\" a canvas by just drawing a white rectangle in the current group.\r\n     */\r\n    ctx.prototype.clearRect = function (x, y, width, height) {\r\n        //clear entire canvas\r\n        if (x === 0 && y === 0 && width === this.width && height === this.height) {\r\n            this.__clearCanvas();\r\n            return;\r\n        }\r\n        var rect, parent = this.__closestGroupOrSvg();\r\n        rect = this.__createElement(\"rect\", {\r\n            x : x,\r\n            y : y,\r\n            width : width,\r\n            height : height,\r\n            fill : \"#FFFFFF\"\r\n        }, true);\r\n        parent.appendChild(rect);\r\n    };\r\n\r\n    /**\r\n     * Adds a linear gradient to a defs tag.\r\n     * Returns a canvas gradient object that has a reference to it's parent def\r\n     */\r\n    ctx.prototype.createLinearGradient = function (x1, y1, x2, y2) {\r\n        var grad = this.__createElement(\"linearGradient\", {\r\n            id : randomString(this.__ids),\r\n            x1 : x1+\"px\",\r\n            x2 : x2+\"px\",\r\n            y1 : y1+\"px\",\r\n            y2 : y2+\"px\",\r\n            \"gradientUnits\" : \"userSpaceOnUse\"\r\n        }, false);\r\n        this.__defs.appendChild(grad);\r\n        return new CanvasGradient(grad, this);\r\n    };\r\n\r\n    /**\r\n     * Adds a radial gradient to a defs tag.\r\n     * Returns a canvas gradient object that has a reference to it's parent def\r\n     */\r\n    ctx.prototype.createRadialGradient = function (x0, y0, r0, x1, y1, r1) {\r\n        var grad = this.__createElement(\"radialGradient\", {\r\n            id : randomString(this.__ids),\r\n            cx : x1+\"px\",\r\n            cy : y1+\"px\",\r\n            r  : r1+\"px\",\r\n            fx : x0+\"px\",\r\n            fy : y0+\"px\",\r\n            \"gradientUnits\" : \"userSpaceOnUse\"\r\n        }, false);\r\n        this.__defs.appendChild(grad);\r\n        return new CanvasGradient(grad, this);\r\n\r\n    };\r\n\r\n    /**\r\n     * Parses the font string and returns svg mapping\r\n     * @private\r\n     */\r\n    ctx.prototype.__parseFont = function () {\r\n        var regex = /^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))(?:\\s*\\/\\s*(normal|[.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])))?\\s*([-,\\'\\\"\\sa-z0-9]+?)\\s*$/i;\r\n        var fontPart = regex.exec( this.font );\r\n        var data = {\r\n            style : fontPart[1] || 'normal',\r\n            size : fontPart[4] || '10px',\r\n            family : fontPart[6] || 'sans-serif',\r\n            weight: fontPart[3] || 'normal',\r\n            decoration : fontPart[2] || 'normal',\r\n            href : null\r\n        };\r\n\r\n        //canvas doesn't support underline natively, but we can pass this attribute\r\n        if (this.__fontUnderline === \"underline\") {\r\n            data.decoration = \"underline\";\r\n        }\r\n\r\n        //canvas also doesn't support linking, but we can pass this as well\r\n        if (this.__fontHref) {\r\n            data.href = this.__fontHref;\r\n        }\r\n\r\n        return data;\r\n    };\r\n\r\n    /**\r\n     * Helper to link text fragments\r\n     * @param font\r\n     * @param element\r\n     * @return {*}\r\n     * @private\r\n     */\r\n    ctx.prototype.__wrapTextLink = function (font, element) {\r\n        if (font.href) {\r\n            var a = this.__createElement(\"a\");\r\n            a.setAttributeNS(\"http://www.w3.org/1999/xlink\", \"xlink:href\", font.href);\r\n            a.appendChild(element);\r\n            return a;\r\n        }\r\n        return element;\r\n    };\r\n\r\n    /**\r\n     * Fills or strokes text\r\n     * @param text\r\n     * @param x\r\n     * @param y\r\n     * @param action - stroke or fill\r\n     * @private\r\n     */\r\n    ctx.prototype.__applyText = function (text, x, y, action) {\r\n        var font = this.__parseFont(),\r\n            parent = this.__closestGroupOrSvg(),\r\n            textElement = this.__createElement(\"text\", {\r\n                \"font-family\" : font.family,\r\n                \"font-size\" : font.size,\r\n                \"font-style\" : font.style,\r\n                \"font-weight\" : font.weight,\r\n                \"text-decoration\" : font.decoration,\r\n                \"x\" : x,\r\n                \"y\" : y,\r\n                \"text-anchor\": getTextAnchor(this.textAlign),\r\n                \"dominant-baseline\": getDominantBaseline(this.textBaseline)\r\n            }, true);\r\n\r\n        textElement.appendChild(this.__document.createTextNode(text));\r\n        this.__currentElement = textElement;\r\n        this.__applyStyleToCurrentElement(action);\r\n        parent.appendChild(this.__wrapTextLink(font,textElement));\r\n    };\r\n\r\n    /**\r\n     * Creates a text element\r\n     * @param text\r\n     * @param x\r\n     * @param y\r\n     */\r\n    ctx.prototype.fillText = function (text, x, y) {\r\n        this.__applyText(text, x, y, \"fill\");\r\n    };\r\n\r\n    /**\r\n     * Strokes text\r\n     * @param text\r\n     * @param x\r\n     * @param y\r\n     */\r\n    ctx.prototype.strokeText = function (text, x, y) {\r\n        this.__applyText(text, x, y, \"stroke\");\r\n    };\r\n\r\n    /**\r\n     * No need to implement this for svg.\r\n     * @param text\r\n     * @return {TextMetrics}\r\n     */\r\n    ctx.prototype.measureText = function (text) {\r\n        this.__ctx.font = this.font;\r\n        return this.__ctx.measureText(text);\r\n    };\r\n\r\n    /**\r\n     *  Arc command!\r\n     */\r\n    ctx.prototype.arc = function (x, y, radius, startAngle, endAngle, counterClockwise) {\r\n        // in canvas no circle is drawn if no angle is provided.\r\n        if (startAngle === endAngle) {\r\n            return;\r\n        }\r\n        startAngle = startAngle % (2*Math.PI);\r\n        endAngle = endAngle % (2*Math.PI);\r\n        if (startAngle === endAngle) {\r\n            //circle time! subtract some of the angle so svg is happy (svg elliptical arc can't draw a full circle)\r\n            endAngle = ((endAngle + (2*Math.PI)) - 0.001 * (counterClockwise ? -1 : 1)) % (2*Math.PI);\r\n        }\r\n        var endX = x+radius*Math.cos(endAngle),\r\n            endY = y+radius*Math.sin(endAngle),\r\n            startX = x+radius*Math.cos(startAngle),\r\n            startY = y+radius*Math.sin(startAngle),\r\n            sweepFlag = counterClockwise ? 0 : 1,\r\n            largeArcFlag = 0,\r\n            diff = endAngle - startAngle;\r\n\r\n        // https://github.com/gliffy/canvas2svg/issues/4\r\n        if (diff < 0) {\r\n            diff += 2*Math.PI;\r\n        }\r\n\r\n        if (counterClockwise) {\r\n            largeArcFlag = diff > Math.PI ? 0 : 1;\r\n        } else {\r\n            largeArcFlag = diff > Math.PI ? 1 : 0;\r\n        }\r\n\r\n        this.lineTo(startX, startY);\r\n        this.__addPathCommand(format(\"A {rx} {ry} {xAxisRotation} {largeArcFlag} {sweepFlag} {endX} {endY}\",\r\n            {rx:radius, ry:radius, xAxisRotation:0, largeArcFlag:largeArcFlag, sweepFlag:sweepFlag, endX:endX, endY:endY}));\r\n\r\n        this.__currentPosition = {x: endX, y: endY};\r\n    };\r\n\r\n    /**\r\n     * Generates a ClipPath from the clip command.\r\n     */\r\n    ctx.prototype.clip = function () {\r\n        var group = this.__closestGroupOrSvg(),\r\n            clipPath = this.__createElement(\"clipPath\"),\r\n            id =  randomString(this.__ids),\r\n            newGroup = this.__createElement(\"g\");\r\n\r\n        this.__applyCurrentDefaultPath();\r\n        group.removeChild(this.__currentElement);\r\n        clipPath.setAttribute(\"id\", id);\r\n        clipPath.appendChild(this.__currentElement);\r\n\r\n        this.__defs.appendChild(clipPath);\r\n\r\n        //set the clip path to this group\r\n        group.setAttribute(\"clip-path\", format(\"url(#{id})\", {id:id}));\r\n\r\n        //clip paths can be scaled and transformed, we need to add another wrapper group to avoid later transformations\r\n        // to this path\r\n        group.appendChild(newGroup);\r\n\r\n        this.__currentElement = newGroup;\r\n\r\n    };\r\n\r\n    /**\r\n     * Draws a canvas, image or mock context to this canvas.\r\n     * Note that all svg dom manipulation uses node.childNodes rather than node.children for IE support.\r\n     * http://www.whatwg.org/specs/web-apps/current-work/multipage/the-canvas-element.html#dom-context-2d-drawimage\r\n     */\r\n    ctx.prototype.drawImage = function () {\r\n        //convert arguments to a real array\r\n        var args = Array.prototype.slice.call(arguments),\r\n            image=args[0],\r\n            dx, dy, dw, dh, sx=0, sy=0, sw, sh, parent, svg, defs, group,\r\n            svgImage, canvas, context, id;\r\n\r\n        if (args.length === 3) {\r\n            dx = args[1];\r\n            dy = args[2];\r\n            sw = image.width;\r\n            sh = image.height;\r\n            dw = sw;\r\n            dh = sh;\r\n        } else if (args.length === 5) {\r\n            dx = args[1];\r\n            dy = args[2];\r\n            dw = args[3];\r\n            dh = args[4];\r\n            sw = image.width;\r\n            sh = image.height;\r\n        } else if (args.length === 9) {\r\n            sx = args[1];\r\n            sy = args[2];\r\n            sw = args[3];\r\n            sh = args[4];\r\n            dx = args[5];\r\n            dy = args[6];\r\n            dw = args[7];\r\n            dh = args[8];\r\n        } else {\r\n            throw new Error(\"Inavlid number of arguments passed to drawImage: \" + arguments.length);\r\n        }\r\n\r\n        parent = this.__closestGroupOrSvg();\r\n        this.__currentElement;\r\n        var translateDirective = \"translate(\" + dx + \", \" + dy + \")\";\r\n        if (image instanceof ctx) {\r\n            //canvas2svg mock canvas context. In the future we may want to clone nodes instead.\r\n            //also I'm currently ignoring dw, dh, sw, sh, sx, sy for a mock context.\r\n            svg = image.getSvg().cloneNode(true);\r\n            if (svg.childNodes && svg.childNodes.length > 1) {\r\n                defs = svg.childNodes[0];\r\n                while(defs.childNodes.length) {\r\n                    id = defs.childNodes[0].getAttribute(\"id\");\r\n                    this.__ids[id] = id;\r\n                    this.__defs.appendChild(defs.childNodes[0]);\r\n                }\r\n                group = svg.childNodes[1];\r\n                if (group) {\r\n                    //save original transform\r\n                    var originTransform = group.getAttribute(\"transform\");\r\n                    var transformDirective;\r\n                    if (originTransform) {\r\n                        transformDirective = originTransform+\" \"+translateDirective;\r\n                    } else {\r\n                        transformDirective = translateDirective;\r\n                    }\r\n                    group.setAttribute(\"transform\", transformDirective);\r\n                    parent.appendChild(group);\r\n                }\r\n            }\r\n        } else if (image.nodeName === \"IMG\") {\r\n            svgImage = this.__createElement(\"image\");\r\n            svgImage.setAttribute(\"width\", dw);\r\n            svgImage.setAttribute(\"height\", dh);\r\n            svgImage.setAttribute(\"preserveAspectRatio\", \"none\");\r\n\r\n            if (sx || sy || sw !== image.width || sh !== image.height) {\r\n                //crop the image using a temporary canvas\r\n                canvas = this.__document.createElement(\"canvas\");\r\n                canvas.width = dw;\r\n                canvas.height = dh;\r\n                context = canvas.getContext(\"2d\");\r\n                context.drawImage(image, sx, sy, sw, sh, 0, 0, dw, dh);\r\n                image = canvas;\r\n            }\r\n            svgImage.setAttribute(\"transform\", translateDirective);\r\n            svgImage.setAttributeNS(\"http://www.w3.org/1999/xlink\", \"xlink:href\",\r\n                image.nodeName === \"CANVAS\" ? image.toDataURL() : image.getAttribute(\"src\"));\r\n            parent.appendChild(svgImage);\r\n        } else if (image.nodeName === \"CANVAS\") {\r\n            svgImage = this.__createElement(\"image\");\r\n            svgImage.setAttribute(\"width\", dw);\r\n            svgImage.setAttribute(\"height\", dh);\r\n            svgImage.setAttribute(\"preserveAspectRatio\", \"none\");\r\n\r\n            // draw canvas onto temporary canvas so that smoothing can be handled\r\n            canvas = this.__document.createElement(\"canvas\");\r\n            canvas.width = dw;\r\n            canvas.height = dh;\r\n            context = canvas.getContext(\"2d\");\r\n            context.imageSmoothingEnabled = false;\r\n            context.mozImageSmoothingEnabled = false;\r\n            context.oImageSmoothingEnabled = false;\r\n            context.webkitImageSmoothingEnabled = false;\r\n            context.drawImage(image, sx, sy, sw, sh, 0, 0, dw, dh);\r\n            image = canvas;\r\n\r\n            svgImage.setAttribute(\"transform\", translateDirective);\r\n            svgImage.setAttributeNS(\"http://www.w3.org/1999/xlink\", \"xlink:href\", image.toDataURL());\r\n            parent.appendChild(svgImage);\r\n        }\r\n    };\r\n\r\n    ctx.prototype.drawImageSvg = function () {\r\n        //convert arguments to a real array\r\n        var args = Array.prototype.slice.call(arguments),\r\n            image=args[0],\r\n            dx, dy, dw, dh, sw, sh, parent, defs, group,\r\n            id;\r\n\r\n        if (args.length === 3) {\r\n            dx = args[1];\r\n            dy = args[2];\r\n            sw = image.width;\r\n            sh = image.height;\r\n            dw = sw;\r\n            dh = sh;\r\n        } else if (args.length === 5) {\r\n            dx = args[1];\r\n            dy = args[2];\r\n            dw = args[3];\r\n            dh = args[4];\r\n            sw = image.width;\r\n            sh = image.height;\r\n        } else if (args.length === 9) {\r\n            args[1];\r\n            args[2];\r\n            sw = args[3];\r\n            sh = args[4];\r\n            dx = args[5];\r\n            dy = args[6];\r\n            dw = args[7];\r\n            dh = args[8];\r\n        } else {\r\n            throw new Error(\"Inavlid number of arguments passed to drawImage: \" + arguments.length);\r\n        }\r\n\r\n        parent = this.__closestGroupOrSvg();\r\n        this.__currentElement;\r\n        var translateDirective = \"translate(\" + dx + \", \" + dy + \")\";\r\n        if (image instanceof SVGSVGElement) {\r\n            if (image.childNodes && image.childNodes.length > 1) {\r\n                var orgWidth = parseFloat(image.getAttribute(\"width\"));\r\n                var orgHeight = parseFloat(image.getAttribute(\"height\"));\r\n                image.setAttribute(\"width\", dw);\r\n                image.setAttribute(\"height\", dh);\r\n                var scaleW = dw / orgWidth;\r\n                var scaleH = dh / orgHeight;\r\n                defs = image.childNodes[0];\r\n                while(defs.childNodes.length) {\r\n                    id = defs.childNodes[0].getAttribute(\"id\");\r\n                    this.__ids[id] = id;\r\n                    this.__defs.appendChild(defs.childNodes[0]);\r\n                }\r\n                group = image.childNodes[1];\r\n                if (group) {\r\n                    //save original transform\r\n                    var originTransform = group.getAttribute(\"transform\");\r\n                    var transformDirective;\r\n                    if (originTransform) {\r\n                        transformDirective = originTransform+\" \"+translateDirective;\r\n                    } else {\r\n                        transformDirective = translateDirective;\r\n                    }\r\n                    group.setAttribute(\"transform\", transformDirective + \" scale(\" + scaleW + \", \" + scaleH +\")\");\r\n                    parent.appendChild(group);\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Generates a pattern tag\r\n     */\r\n    ctx.prototype.createPattern = function (image, repetition) {\r\n        var pattern = this.__document.createElementNS(\"http://www.w3.org/2000/svg\", \"pattern\"), id = randomString(this.__ids),\r\n            img;\r\n        pattern.setAttribute(\"id\", id);\r\n        pattern.setAttribute(\"width\", image.width);\r\n        pattern.setAttribute(\"height\", image.height);\r\n        if (image.nodeName === \"CANVAS\" || image.nodeName === \"IMG\") {\r\n            img = this.__document.createElementNS(\"http://www.w3.org/2000/svg\", \"image\");\r\n            img.setAttribute(\"width\", image.width);\r\n            img.setAttribute(\"height\", image.height);\r\n            img.setAttributeNS(\"http://www.w3.org/1999/xlink\", \"xlink:href\",\r\n                image.nodeName === \"CANVAS\" ? image.toDataURL() : image.getAttribute(\"src\"));\r\n            pattern.appendChild(img);\r\n            this.__defs.appendChild(pattern);\r\n        } else if (image instanceof ctx) {\r\n            pattern.appendChild(image.__root.childNodes[1]);\r\n            this.__defs.appendChild(pattern);\r\n        }\r\n        return new CanvasPattern(pattern, this);\r\n    };\r\n\r\n    ctx.prototype.setLineDash = function (dashArray) {\r\n        if (dashArray && dashArray.length > 0) {\r\n            this.lineDash = dashArray.join(\",\");\r\n        } else {\r\n            this.lineDash = null;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Not yet implemented\r\n     */\r\n    ctx.prototype.drawFocusRing = function () {};\r\n    ctx.prototype.createImageData = function () {};\r\n    ctx.prototype.getImageData = function () {};\r\n    ctx.prototype.putImageData = function () {};\r\n    ctx.prototype.globalCompositeOperation = function () {};\r\n    ctx.prototype.setTransform = function () {};\r\n\r\n    var ctx$1 = ctx;\r\n\r\nexport default ctx$1;\r\n","/** @module */\r\n\r\nimport C2S from '../lib/snowpack/build/snowpack/pkg/@mithrandirii/canvas2svg.js'\r\n/**\r\n * add a button so that we can generate an SVG of what is being rendered\r\n * @param {Object} screen the screen where the drawing context is.\r\n * We will temporarily change the drawing context.\r\n * @param {Object} draw the drawing function that renders drawings to the context.\r\n * @param {Layout} layout\r\n */\r\nexport default function addSVGOutput(screen, draw, layout) {\r\n    const w = screen.width\r\n    const h = screen.height\r\n\r\n    const svgUIDiv = document.createElement('div')\r\n    layout.newElement('svgUIDiv', svgUIDiv)\r\n\r\n    // svg output button\r\n    const button = document.createElement('button')\r\n    button.className = 'button2'\r\n    button.innerText = 'Make SVG'\r\n    button.onclick = makeSVG\r\n    svgUIDiv.appendChild(button)\r\n\r\n    // svg download link\r\n    const downloadLink = document.createElement('a')\r\n    downloadLink.innerText = 'Download SVG'\r\n    downloadLink.download = 'vote.svg'\r\n    downloadLink.hidden = true\r\n    downloadLink.style.margin = '4px'\r\n    svgUIDiv.appendChild(downloadLink)\r\n\r\n    // svg download link for maps\r\n    const mDownloadLink = document.createElement('a')\r\n    mDownloadLink.innerText = 'Download Map SVG'\r\n    mDownloadLink.download = 'vote_map.svg'\r\n    mDownloadLink.hidden = true\r\n    mDownloadLink.style.margin = '4px'\r\n    svgUIDiv.appendChild(mDownloadLink)\r\n\r\n    // svg hide button\r\n    const svgHideButton = document.createElement('button')\r\n    svgHideButton.className = 'button2'\r\n    svgHideButton.innerText = 'Hide SVG'\r\n    svgHideButton.hidden = true\r\n    svgHideButton.onclick = hideSVG\r\n    svgUIDiv.appendChild(svgHideButton)\r\n\r\n    // hidden svg output div\r\n    const svgDiv = document.createElement('div')\r\n    svgDiv.setAttribute('class', 'svgDiv')\r\n    svgDiv.style.width = `${w}px`\r\n    svgDiv.style.height = `${h}px`\r\n    svgDiv.hidden = true\r\n    svgUIDiv.appendChild(svgDiv)\r\n\r\n    // hidden svg output div for maps\r\n    const mSvgDiv = document.createElement('div')\r\n    mSvgDiv.setAttribute('class', 'mSvgDiv')\r\n    mSvgDiv.style.width = `${w}px`\r\n    mSvgDiv.style.height = `${Math.round(h / 3)}px`\r\n    mSvgDiv.hidden = true\r\n    svgUIDiv.appendChild(mSvgDiv)\r\n\r\n    const svgCtx = new C2S(w, h)\r\n    const svgMCtx = new C2S(w, Math.round(h / 3))\r\n\r\n    function setHeightMCtx(height) {\r\n        mSvgDiv.style.height = `${Math.round(height)}px`\r\n        mSvgDiv.height = height\r\n        // eslint-disable-next-line no-underscore-dangle\r\n        svgMCtx.__root.setAttribute('height', height)\r\n    }\r\n\r\n    function makeSVG() {\r\n        // temporarily swap drawing context, render SVG,\r\n        // then output SVG to div and to a download link\r\n\r\n        // set\r\n        const old = screen.ctx\r\n        const oldF = screen.fctx\r\n        screen.setCtx(svgCtx)\r\n        screen.setFCtx(svgCtx)\r\n        screen.setNoBuffers(true)\r\n\r\n        const oldM = screen.mctx\r\n        screen.setMCtx(svgMCtx)\r\n\r\n        // update\r\n        const { heightBrowser } = screen.maps\r\n        setHeightMCtx(heightBrowser)\r\n\r\n        // draw\r\n        draw()\r\n        outputSVG()\r\n        outputMSVG()\r\n\r\n        // unset\r\n        screen.setCtx(old)\r\n        screen.setFCtx(oldF)\r\n        screen.setNoBuffers(false)\r\n\r\n        screen.setMCtx(oldM)\r\n    }\r\n\r\n    function outputSVG() {\r\n        svgHideButton.hidden = false\r\n\r\n        const svg = svgCtx.getSerializedSvg(true)\r\n        svgDiv.innerHTML = svg\r\n        svgDiv.hidden = false\r\n        downloadLink.hidden = false\r\n        const url = `data:image/svg+xml;charset=utf-8,${encodeURIComponent(svg)}`\r\n        downloadLink.href = url\r\n    }\r\n    function outputMSVG() {\r\n        const mSvg = svgMCtx.getSerializedSvg(true)\r\n        mSvgDiv.innerHTML = mSvg\r\n        mSvgDiv.hidden = false\r\n        mDownloadLink.hidden = false\r\n        const mUrl = `data:image/svg+xml;charset=utf-8,${encodeURIComponent(mSvg)}`\r\n        mDownloadLink.href = mUrl\r\n    }\r\n\r\n    function hideSVG() {\r\n        svgHideButton.hidden = true\r\n\r\n        svgDiv.hidden = true\r\n        downloadLink.hidden = true\r\n\r\n        mSvgDiv.hidden = true\r\n        mDownloadLink.hidden = true\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Class for a single button.\r\n * @param {*} buttonConfig\r\n * @param {*} onChoose\r\n * @constructor\r\n */\r\nexport default function Button(buttonConfig, onChoose) {\r\n    const self = this\r\n\r\n    self.config = buttonConfig\r\n    self.name = buttonConfig.name\r\n    self.nameIsHTML = buttonConfig.nameIsHTML || false\r\n    self.dom = document.createElement('div')\r\n    self.dom.setAttribute('class', 'button button2')\r\n\r\n    // overwrite margins.  The old way was not working.\r\n    let fixMargin = buttonConfig.margin\r\n    fixMargin = fixMargin || 0\r\n    fixMargin = Math.max(fixMargin, 4)\r\n    self.dom.style.marginRight = `${fixMargin}px`\r\n\r\n    // Click!\r\n    self.draw = function () {\r\n        if (self.nameIsHTML) {\r\n            self.dom.innerHTML = self.name\r\n        } else {\r\n            self.dom.innerText = self.name\r\n        }\r\n    }\r\n    self.draw()\r\n    self.dom.setAttribute('title', buttonConfig.realname || '')\r\n    self.onClick = function () {\r\n        onChoose(self, buttonConfig)\r\n    }\r\n    self.dom.onclick = self.onClick\r\n    // Turn on or off!\r\n    self.turnOff = function () {\r\n        self.isOn = false\r\n        self.config.isOn = false\r\n        self.dom.setAttribute('on', 'no')\r\n    }\r\n    self.turnOn = function () {\r\n        self.isOn = true\r\n        self.config.isOn = true\r\n        self.dom.setAttribute('on', 'yes')\r\n    }\r\n    self.turnOff()\r\n}\r\n","/** @module */\r\n\r\nimport Button from './Button.js'\r\n\r\n/**\r\n * Create a group of buttons.\r\n * @param {*} config\r\n * @constructor\r\n */\r\nexport default function ButtonGroup(config) {\r\n    const self = this\r\n    self.config = config\r\n\r\n    // check if there is a function to make the data\r\n    // this function can be used later to update the buttons\r\n    if (config.data === undefined) {\r\n        config.data = []\r\n        if (config.makeData === undefined) {\r\n            config.makeData = () => []\r\n        }\r\n        self.makeData = config.makeData\r\n        self.buttonConfigs = self.makeData()\r\n        self.doMakeData = true\r\n    }\r\n    self.buttonConfigs = config.data\r\n\r\n    self.labelName = config.label\r\n    self.labelIsHTML = config.labelIsHTML || false\r\n\r\n    self.onChoose = config.onChoose\r\n    self.isCheckbox = config.isCheckbox || false\r\n    self.isCheckboxBool = config.isCheckboxBool || false\r\n    self.justButton = config.justButton || false\r\n    self.buttonHidden = config.buttonHidden || {}\r\n\r\n    // DOM!\r\n    self.dom = document.createElement('div')\r\n    self.dom.setAttribute('class', 'button-group')\r\n\r\n    self.buttonDOMByValue = []\r\n\r\n    self.init = function () {\r\n        if (self.doMakeData) self.buttonConfigs = self.makeData()\r\n\r\n        // clear\r\n        self.dom.innerHTML = ''\r\n        self.buttons = []\r\n        self.buttonsByName = {}\r\n\r\n        // Label!\r\n        self.labelDOM = document.createElement('div')\r\n        self.labelDOM.setAttribute('class', 'button-group-label')\r\n        self.draw()\r\n        self.labelDOM.classList.toggle('seeit')\r\n        self.labelDOM.onclick = () => {\r\n            self.labelDOM.classList.toggle('seeit')\r\n        }\r\n        self.dom.appendChild(self.labelDOM)\r\n\r\n        // Create & place buttons!\r\n        for (let i = 0; i < self.buttonConfigs.length; i++) {\r\n            const conf = self.buttonConfigs[i]\r\n            const button = new Button(conf, self.onToggle)\r\n            self.buttonsByName[conf.name] = button\r\n            button.dom.style.width = `${config.width}px` // whatever\r\n            if (conf.width) button.dom.style.width = `${conf.width}px` // whatever\r\n            self.buttons.push(button)\r\n            self.dom.appendChild(button.dom)\r\n            self.buttonDOMByValue[conf.value] = button.dom\r\n        }\r\n\r\n        // And then select the one that says \"selected\"! Fake a click.\r\n        for (let i = 0; i < self.buttons.length; i++) {\r\n            const button = self.buttons[i]\r\n            if (button.config.selected) {\r\n                button.turnOn()\r\n                break\r\n            }\r\n        }\r\n        self.draw()\r\n    }\r\n    self.updateNames = function () {\r\n        const data2 = self.makeData()\r\n        for (let i = 0; i < self.buttonConfigs.length; i++) {\r\n            self.buttonConfigs[i].name = data2[i].name\r\n            self.buttons[i].name = self.buttonConfigs[i].name\r\n        }\r\n    }\r\n    self.redraw = function () {\r\n        self.updateNames()\r\n        self.draw()\r\n    }\r\n    self.draw = function () {\r\n        if (self.labelIsHTML) {\r\n            self.labelDOM.innerHTML = self.labelName\r\n        } else {\r\n            self.labelDOM.innerText = self.labelName\r\n        }\r\n        for (const button of self.buttons) {\r\n            button.draw()\r\n        }\r\n    }\r\n\r\n    self.configureHidden = function () {\r\n        for (const [buttonName, hidden] of Object.entries(self.buttonHidden)) {\r\n            self.buttonsByName[buttonName].dom.hidden = hidden\r\n        }\r\n    }\r\n\r\n    // Toggle buttons\r\n    self.onToggle = function (button, buttonData) {\r\n        if (self.isCheckbox || self.isCheckboxBool) {\r\n            if (button.isOn) {\r\n                button.turnOff()\r\n            } else {\r\n                button.turnOn()\r\n            }\r\n        } else { // justButton means it doesn't get selected\r\n            // Turn all off\r\n            for (let i = 0; i < self.buttons.length; i++) self.buttons[i].turnOff()\r\n            button.turnOn() // except one\r\n            if (self.justButton) {\r\n                // turn on for a little while, then off\r\n                setTimeout(() => button.turnOff(), 800)\r\n            }\r\n        }\r\n        // And send the data up\r\n        self.onChoose(buttonData)\r\n    }\r\n\r\n    // Highlight based on data...\r\n    self.highlight = function (propName, propValue) {\r\n        // if we haven't set up the buttons yet, then don't do anything yet\r\n        if (self.buttons.length === 0) return\r\n\r\n        // Turn all off\r\n        for (let i = 0; i < self.buttons.length; i++) self.buttons[i].turnOff()\r\n\r\n        if (self.isCheckbox) {\r\n            for (const ibu in self.buttons) {\r\n                const bu = self.buttons[ibu]\r\n                if (propValue.includes(bu.config[propName])) { // the propValue is an array of values\r\n                    bu.turnOn()\r\n                }\r\n            }\r\n        } else if (self.isCheckboxBool) {\r\n            for (const ibu in self.buttons) {\r\n                const bu = self.buttons[ibu]\r\n                const buttonName = bu.config[propName]\r\n                // if (Object.keys(propValue).includes(buttonName)) { // the propValue is an array of values\r\n                if (buttonName in propValue) {\r\n                    if (propValue[buttonName]) {\r\n                        bu.turnOn()\r\n                    }\r\n                }\r\n            }\r\n        } else {\r\n            // Find the one...\r\n            const theButton = self.buttons.filter((button) => {\r\n                const { config } = button\r\n                return (config[propName] === propValue)\r\n            })[0]\r\n            if (theButton !== undefined) {\r\n                theButton.turnOn()\r\n            }\r\n        }\r\n    }\r\n\r\n    self.init()\r\n}\r\n","/** @module */\r\n\r\nimport ButtonGroup from './ButtonGroup.js'\r\n\r\n/**\r\n * Make a selection that determines a single property's value.\r\n * Defer handling dependent calculations to the next update step,\r\n * where we will look at a dependency tree to determine what else needs updating.\r\n * Functionality here is called from button presses.\r\n * Functionality here is also called from a command pattern (commander).\r\n * @param {Object.<string>} object\r\n * @param {(String|Number|Boolean)} object.prop - The property being selected in the menu.\r\n * @param {String} prop - Name of prop\r\n * @param {MenuItem~setProp} setProp - The action that is performed as part of onclick.\r\n * @param {String} label - The prompt presented to the user.\r\n * @param {Object[]} options - the list of options that the UI presents to the user.\r\n * @param {(String|Number|Boolean)} options[].value - Value to pass to setProp\r\n * @param {String[]} change - list of changes made when pressing a button.\r\n * @param {Changes} changes\r\n * @param {Commander} commander - Follows command pattern.\r\n * @constructor\r\n */\r\n// eslint-disable-next-line max-len\r\nexport default function MenuItem(object, prop, setProp, label, options, change, changes, commander) {\r\n    const self = this\r\n    self.list = options\r\n    self.onChoose = function (data) {\r\n        self.sender.go(data.value)\r\n    }\r\n    self.action = (value) => {\r\n        self.set(value)\r\n        self.select()\r\n    }\r\n    self.sender = commander.addSender({\r\n        name: prop,\r\n        action: self.action,\r\n        currentValue: object[prop],\r\n    })\r\n    self.set = function (value) {\r\n        // LOAD INPUT\r\n\r\n        setProp(value)\r\n        // CONFIGURE\r\n        self.configure()\r\n        // UPDATE\r\n        changes.add(change)\r\n    }\r\n    self.choose = new ButtonGroup({\r\n        label,\r\n        width: buttonWidth(3),\r\n        data: self.list,\r\n        onChoose: self.onChoose,\r\n    })\r\n    self.configure = function () {\r\n    }\r\n    self.select = function () {\r\n        self.choose.highlight('value', object[prop])\r\n    }\r\n}\r\n\r\nfunction buttonWidth(numButtons) {\r\n    const padding = 4\r\n    const border = 1\r\n    const margin = 4\r\n    const between = (padding + border + margin) * 2\r\n    const end = padding + border\r\n    const width = 302\r\n    const usableSpace = width - between * (numButtons - 1) - 2 * end\r\n    const buttonWidth1 = usableSpace / numButtons\r\n    return buttonWidth1\r\n}\r\n","/** @module */\r\n\r\nimport MenuItem from './MenuItem.js'\r\n\r\n/**\r\n * Make a menu.\r\n * @param {Changes} changes\r\n * @param {Layout} layout\r\n * @param {Commander} commander - Follows command pattern.\r\n * @constructor\r\n */\r\nexport default function Menu(changes, layout, commander) {\r\n    const self = this\r\n    self.divMenu = document.createElement('div')\r\n    layout.newElement('menu', self.divMenu)\r\n    self.addMenuItem = function (object, choice) {\r\n        const {\r\n            prop, setProp, label, options, change,\r\n        } = choice\r\n\r\n        // eslint-disable-next-line max-len\r\n        const menuItem = new MenuItem(object, prop, setProp, label, options, change, changes, commander)\r\n        menuItem.select()\r\n\r\n        self.divMenu.appendChild(menuItem.choose.dom)\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Use this to sample a random candidate from a collection of distributions of candidates.\r\n * Sample a point multiple times after the constructor call.\r\n * @param {CandidateDn[]} candidateDistributions\r\n * @constructor\r\n */\r\nexport default function CandidateDistributionSampler1D(candidateDistributions) {\r\n    const self = this\r\n    // cumulative distribution function\r\n    const cdf = getCDF(candidateDistributions)\r\n    self.samplePoint = function () {\r\n        return samplePoint1(candidateDistributions, cdf)\r\n    }\r\n}\r\n\r\nfunction samplePoint1(candidateDistributions, cdf) {\r\n    // pick a voter distribution\r\n    const iDist = randomDistribution(cdf)\r\n    const cd = candidateDistributions[iDist]\r\n    // sample circle\r\n    const isGaussian = cd.shape1.densityProfile === 'gaussian'\r\n    const sample = (isGaussian) ? sampleGaussian : randomInsideInterval\r\n    const point = sample(cd.shape1.x, cd.shape1.w * 0.5)\r\n    return point\r\n}\r\n\r\nfunction randomDistribution(cdf) {\r\n    // sample from distribution\r\n    // pick a random number from 0 to 1\r\n    const random1 = Math.random()\r\n    const selectDistribution = cdf.findIndex((x) => x >= random1)\r\n    return selectDistribution\r\n}\r\n\r\nfunction getCDF(candidateDistributions) {\r\n    // find the size of the voter distributions\r\n    const proportion = candidateDistributions.map((cd) => cd.shape1.w)\r\n\r\n    const sumProportion = proportion.reduce((p, c) => p + c)\r\n\r\n    // probability mass function\r\n    const pmf = proportion.map((p) => p / sumProportion)\r\n\r\n    // https://stackoverflow.com/a/20477613\r\n    // [5, 10, 3, 2];\r\n    // [5, 15, 18, 20]\r\n    // cumulative distribution function\r\n    const cdf = []\r\n    pmf.reduce((p, c, i) => {\r\n        const a = p + c\r\n        cdf[i] = a\r\n        return a\r\n    }, 0)\r\n\r\n    return cdf\r\n}\r\n\r\nfunction randomInsideInterval(X, R) {\r\n    const x = (Math.random() * 2 - 1) * R + X\r\n    return { x }\r\n}\r\n\r\nfunction sampleGaussian(X, R) {\r\n    // https://en.wikipedia.org/wiki/Box%E2%80%93Muller_transform\r\n\r\n    const u1 = Math.random()\r\n    const u2 = Math.random()\r\n\r\n    const sigma = (2 * R) / Math.sqrt(2 * Math.PI)\r\n    const mag = sigma * Math.sqrt(-2 * Math.log(u1))\r\n    const x = mag * Math.cos(2 * Math.PI * u2) + X\r\n    // const x2 = mag * Math.sin(2 * Math.PI * u2) + X\r\n    return { x }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Use this to sample a random candidate from a collection of distributions of candidates.\r\n * Sample a point multiple times after the constructor call.\r\n * @param {CandidateDn[]} candidateDistributions\r\n * @constructor\r\n */\r\nexport default function CandidateDistributionSampler2D(candidateDistributions) {\r\n    const self = this\r\n    // cumulative distribution function\r\n    const cdf = getCDF(candidateDistributions)\r\n    self.samplePoint = function () {\r\n        return samplePoint1(candidateDistributions, cdf)\r\n    }\r\n}\r\n\r\nfunction samplePoint1(candidateDistributions, cdf) {\r\n    // pick a voter distribution\r\n    const iDist = randomDistribution(cdf)\r\n    const cd = candidateDistributions[iDist]\r\n    // sample circle\r\n    const point = randomInsideCircle(cd.shape2.x, cd.shape2.y, cd.shape2.w * 0.5)\r\n    return point\r\n}\r\n\r\nfunction randomDistribution(cdf) {\r\n    // sample from distribution\r\n    // pick a random number from 0 to 1\r\n    const random1 = Math.random()\r\n    const selectDistribution = cdf.findIndex((x) => x >= random1)\r\n    return selectDistribution\r\n}\r\n\r\nfunction getCDF(candidateDistributions) {\r\n    // find the size of the voter distributions\r\n    const areasProportion = candidateDistributions.map((cd) => cd.shape2.w ** 2)\r\n\r\n    const sumAreasProportion = areasProportion.reduce((p, c) => p + c)\r\n\r\n    // probability mass function\r\n    const pmf = areasProportion.map((p) => p / sumAreasProportion)\r\n\r\n    // https://stackoverflow.com/a/20477613\r\n    // [5, 10, 3, 2];\r\n    // [5, 15, 18, 20]\r\n    // cumulative distribution function\r\n    const cdf = []\r\n    pmf.reduce((p, c, i) => {\r\n        const a = p + c\r\n        cdf[i] = a\r\n        return a\r\n    }, 0)\r\n\r\n    return cdf\r\n}\r\n\r\nfunction randomInsideCircle(X, Y, R) {\r\n    // https://stackoverflow.com/a/50746409\r\n    const r = R * Math.sqrt(Math.random())\r\n    const theta = Math.random() * 2 * Math.PI\r\n\r\n    // convert to cartesian\r\n\r\n    const x = X + r * Math.cos(theta)\r\n    const y = Y + r * Math.sin(theta)\r\n    return { x, y }\r\n}\r\n","/** @module */\r\n\r\nimport CandidateDistributionSampler1D from '../election/CandidateDistributionSampler1D.js'\r\nimport CandidateDistributionSampler2D from '../election/CandidateDistributionSampler2D.js'\r\n\r\n/**\r\n * A simple list of candidateDnSim instances.\r\n * It really just passes along function calls to each member of the list.\r\n * It also checks if that member exists. Alternatively, it was deleted.\r\n * @constructor\r\n */\r\nexport default function CandidateDnSimList(sim, changes) {\r\n    const self = this\r\n\r\n    const simCanDns = []\r\n    self.rendererMaker = () => ({ render: () => {} })\r\n\r\n    // Data Setters and Getters //\r\n\r\n    self.newCandidate = function (simCanDn) {\r\n        simCanDns.push(simCanDn)\r\n        simCanDn.graphic.setRenderer(self.rendererMaker)\r\n    }\r\n\r\n    // get sim entities that exist\r\n    self.getSimCandidateDistributions = () => {\r\n        const a = simCanDns.filter((simCanDn) => simCanDn.canDn.exists)\r\n        return a\r\n    }\r\n\r\n    // get the underlying entities of the above\r\n    self.getCandidateDistributions = () => {\r\n        const simCanDnsEx = self.getSimCandidateDistributions()\r\n        return simCanDnsEx.map((simCanDn) => simCanDn.canDn)\r\n    }\r\n    self.getCandidateDistributionsAll = () => simCanDns.map((simCanDn) => simCanDn.canDn)\r\n\r\n    // Update //\r\n\r\n    self.update = () => {\r\n        if (changes.checkNone()) return\r\n\r\n        self.startSampler()\r\n    }\r\n\r\n    self.startSampler = () => {\r\n        const canDnsList = self.getCandidateDistributions()\r\n        if (canDnsList.length === 0) return\r\n        const { dimensions } = sim.election\r\n        const CDnSampler = (dimensions === 1)\r\n            ? CandidateDistributionSampler1D\r\n            : CandidateDistributionSampler2D\r\n        self.sampler = new CDnSampler(canDnsList)\r\n    }\r\n    self.updateXY = () => {\r\n        simCanDns.forEach((simCanDn) => simCanDn.canDn.updateXY())\r\n    }\r\n\r\n    // Render //\r\n\r\n    self.render = () => {\r\n        simCanDns.forEach((simCanDn) => {\r\n            if (simCanDn.canDn.exists) simCanDn.graphic.renderer.render()\r\n        })\r\n    }\r\n\r\n    self.setRenderer = (rendererMaker) => {\r\n        self.rendererMaker = rendererMaker\r\n        simCanDns.forEach((simCanDn) => simCanDn.graphic.setRenderer(rendererMaker))\r\n    }\r\n    self.renderForeground = () => {\r\n        if (sim.showGhosts) {\r\n            self.renderForegroundAll()\r\n        } else {\r\n            self.renderForegroundExisting()\r\n        }\r\n    }\r\n    self.renderForegroundExisting = () => {\r\n        simCanDns.forEach((simCanDn) => {\r\n            if (simCanDn.canDn.exists) simCanDn.graphic.renderForeground()\r\n        })\r\n    }\r\n    self.renderForegroundAll = () => {\r\n        simCanDns.forEach((simCanDn) => simCanDn.graphic.renderForeground())\r\n    }\r\n}\r\n","/* SNOWPACK PROCESS POLYFILL (based on https://github.com/calvinmetcalf/node-process-es6) */\r\nfunction defaultSetTimout() {\r\n    throw new Error('setTimeout has not been defined');\r\n}\r\nfunction defaultClearTimeout () {\r\n    throw new Error('clearTimeout has not been defined');\r\n}\r\nvar cachedSetTimeout = defaultSetTimout;\r\nvar cachedClearTimeout = defaultClearTimeout;\r\nvar globalContext;\r\nif (typeof window !== 'undefined') {\r\n    globalContext = window;\r\n} else if (typeof self !== 'undefined') {\r\n    globalContext = self;\r\n} else {\r\n    globalContext = {};\r\n}\r\nif (typeof globalContext.setTimeout === 'function') {\r\n    cachedSetTimeout = setTimeout;\r\n}\r\nif (typeof globalContext.clearTimeout === 'function') {\r\n    cachedClearTimeout = clearTimeout;\r\n}\r\n\r\nfunction runTimeout(fun) {\r\n    if (cachedSetTimeout === setTimeout) {\r\n        //normal enviroments in sane situations\r\n        return setTimeout(fun, 0);\r\n    }\r\n    // if setTimeout wasn't available but was latter defined\r\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\r\n        cachedSetTimeout = setTimeout;\r\n        return setTimeout(fun, 0);\r\n    }\r\n    try {\r\n        // when when somebody has screwed with setTimeout but no I.E. maddness\r\n        return cachedSetTimeout(fun, 0);\r\n    } catch(e){\r\n        try {\r\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\r\n            return cachedSetTimeout.call(null, fun, 0);\r\n        } catch(e){\r\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\r\n            return cachedSetTimeout.call(this, fun, 0);\r\n        }\r\n    }\r\n\r\n\r\n}\r\nfunction runClearTimeout(marker) {\r\n    if (cachedClearTimeout === clearTimeout) {\r\n        //normal enviroments in sane situations\r\n        return clearTimeout(marker);\r\n    }\r\n    // if clearTimeout wasn't available but was latter defined\r\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\r\n        cachedClearTimeout = clearTimeout;\r\n        return clearTimeout(marker);\r\n    }\r\n    try {\r\n        // when when somebody has screwed with setTimeout but no I.E. maddness\r\n        return cachedClearTimeout(marker);\r\n    } catch (e){\r\n        try {\r\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\r\n            return cachedClearTimeout.call(null, marker);\r\n        } catch (e){\r\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\r\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\r\n            return cachedClearTimeout.call(this, marker);\r\n        }\r\n    }\r\n\r\n\r\n\r\n}\r\nvar queue = [];\r\nvar draining = false;\r\nvar currentQueue;\r\nvar queueIndex = -1;\r\n\r\nfunction cleanUpNextTick() {\r\n    if (!draining || !currentQueue) {\r\n        return;\r\n    }\r\n    draining = false;\r\n    if (currentQueue.length) {\r\n        queue = currentQueue.concat(queue);\r\n    } else {\r\n        queueIndex = -1;\r\n    }\r\n    if (queue.length) {\r\n        drainQueue();\r\n    }\r\n}\r\n\r\nfunction drainQueue() {\r\n    if (draining) {\r\n        return;\r\n    }\r\n    var timeout = runTimeout(cleanUpNextTick);\r\n    draining = true;\r\n\r\n    var len = queue.length;\r\n    while(len) {\r\n        currentQueue = queue;\r\n        queue = [];\r\n        while (++queueIndex < len) {\r\n            if (currentQueue) {\r\n                currentQueue[queueIndex].run();\r\n            }\r\n        }\r\n        queueIndex = -1;\r\n        len = queue.length;\r\n    }\r\n    currentQueue = null;\r\n    draining = false;\r\n    runClearTimeout(timeout);\r\n}\r\nfunction nextTick(fun) {\r\n    var args = new Array(arguments.length - 1);\r\n    if (arguments.length > 1) {\r\n        for (var i = 1; i < arguments.length; i++) {\r\n            args[i - 1] = arguments[i];\r\n        }\r\n    }\r\n    queue.push(new Item(fun, args));\r\n    if (queue.length === 1 && !draining) {\r\n        runTimeout(drainQueue);\r\n    }\r\n}\r\n// v8 likes predictible objects\r\nfunction Item(fun, array) {\r\n    this.fun = fun;\r\n    this.array = array;\r\n}\r\nItem.prototype.run = function () {\r\n    this.fun.apply(null, this.array);\r\n};\r\nvar title = 'browser';\r\nvar platform = 'browser';\r\nvar browser = true;\r\nvar argv = [];\r\nvar version = ''; // empty string to avoid regexp issues\r\nvar versions = {};\r\nvar release = {};\r\nvar config = {};\r\n\r\nfunction noop() {}\r\n\r\nvar on = noop;\r\nvar addListener = noop;\r\nvar once = noop;\r\nvar off = noop;\r\nvar removeListener = noop;\r\nvar removeAllListeners = noop;\r\nvar emit = noop;\r\n\r\nfunction binding(name) {\r\n    throw new Error('process.binding is not supported');\r\n}\r\n\r\nfunction cwd () { return '/' }\r\nfunction chdir (dir) {\r\n    throw new Error('process.chdir is not supported');\r\n}function umask() { return 0; }\r\n\r\n// from https://github.com/kumavis/browser-process-hrtime/blob/master/index.js\r\nvar performance = globalContext.performance || {};\r\nvar performanceNow =\r\n  performance.now        ||\r\n  performance.mozNow     ||\r\n  performance.msNow      ||\r\n  performance.oNow       ||\r\n  performance.webkitNow  ||\r\n  function(){ return (new Date()).getTime() };\r\n\r\n// generate timestamp or delta\r\n// see http://nodejs.org/api/process.html#process_process_hrtime\r\nfunction hrtime(previousTimestamp){\r\n  var clocktime = performanceNow.call(performance)*1e-3;\r\n  var seconds = Math.floor(clocktime);\r\n  var nanoseconds = Math.floor((clocktime%1)*1e9);\r\n  if (previousTimestamp) {\r\n    seconds = seconds - previousTimestamp[0];\r\n    nanoseconds = nanoseconds - previousTimestamp[1];\r\n    if (nanoseconds<0) {\r\n      seconds--;\r\n      nanoseconds += 1e9;\r\n    }\r\n  }\r\n  return [seconds,nanoseconds]\r\n}\r\n\r\nvar startTime = new Date();\r\nfunction uptime() {\r\n  var currentTime = new Date();\r\n  var dif = currentTime - startTime;\r\n  return dif / 1000;\r\n}\r\n\r\nvar process = {\r\n  nextTick: nextTick,\r\n  title: title,\r\n  browser: browser,\r\n  env: {\"NODE_ENV\":\"production\"},\r\n  argv: argv,\r\n  version: version,\r\n  versions: versions,\r\n  on: on,\r\n  addListener: addListener,\r\n  once: once,\r\n  off: off,\r\n  removeListener: removeListener,\r\n  removeAllListeners: removeAllListeners,\r\n  emit: emit,\r\n  binding: binding,\r\n  cwd: cwd,\r\n  chdir: chdir,\r\n  umask: umask,\r\n  hrtime: hrtime,\r\n  platform: platform,\r\n  release: release,\r\n  config: config,\r\n  uptime: uptime\r\n};\r\n\r\n/**\r\n * The Ease class provides a collection of easing functions for use with tween.js.\r\n */\r\nvar Easing = {\r\n    Linear: {\r\n        None: function (amount) {\r\n            return amount;\r\n        },\r\n    },\r\n    Quadratic: {\r\n        In: function (amount) {\r\n            return amount * amount;\r\n        },\r\n        Out: function (amount) {\r\n            return amount * (2 - amount);\r\n        },\r\n        InOut: function (amount) {\r\n            if ((amount *= 2) < 1) {\r\n                return 0.5 * amount * amount;\r\n            }\r\n            return -0.5 * (--amount * (amount - 2) - 1);\r\n        },\r\n    },\r\n    Cubic: {\r\n        In: function (amount) {\r\n            return amount * amount * amount;\r\n        },\r\n        Out: function (amount) {\r\n            return --amount * amount * amount + 1;\r\n        },\r\n        InOut: function (amount) {\r\n            if ((amount *= 2) < 1) {\r\n                return 0.5 * amount * amount * amount;\r\n            }\r\n            return 0.5 * ((amount -= 2) * amount * amount + 2);\r\n        },\r\n    },\r\n    Quartic: {\r\n        In: function (amount) {\r\n            return amount * amount * amount * amount;\r\n        },\r\n        Out: function (amount) {\r\n            return 1 - --amount * amount * amount * amount;\r\n        },\r\n        InOut: function (amount) {\r\n            if ((amount *= 2) < 1) {\r\n                return 0.5 * amount * amount * amount * amount;\r\n            }\r\n            return -0.5 * ((amount -= 2) * amount * amount * amount - 2);\r\n        },\r\n    },\r\n    Quintic: {\r\n        In: function (amount) {\r\n            return amount * amount * amount * amount * amount;\r\n        },\r\n        Out: function (amount) {\r\n            return --amount * amount * amount * amount * amount + 1;\r\n        },\r\n        InOut: function (amount) {\r\n            if ((amount *= 2) < 1) {\r\n                return 0.5 * amount * amount * amount * amount * amount;\r\n            }\r\n            return 0.5 * ((amount -= 2) * amount * amount * amount * amount + 2);\r\n        },\r\n    },\r\n    Sinusoidal: {\r\n        In: function (amount) {\r\n            return 1 - Math.cos((amount * Math.PI) / 2);\r\n        },\r\n        Out: function (amount) {\r\n            return Math.sin((amount * Math.PI) / 2);\r\n        },\r\n        InOut: function (amount) {\r\n            return 0.5 * (1 - Math.cos(Math.PI * amount));\r\n        },\r\n    },\r\n    Exponential: {\r\n        In: function (amount) {\r\n            return amount === 0 ? 0 : Math.pow(1024, amount - 1);\r\n        },\r\n        Out: function (amount) {\r\n            return amount === 1 ? 1 : 1 - Math.pow(2, -10 * amount);\r\n        },\r\n        InOut: function (amount) {\r\n            if (amount === 0) {\r\n                return 0;\r\n            }\r\n            if (amount === 1) {\r\n                return 1;\r\n            }\r\n            if ((amount *= 2) < 1) {\r\n                return 0.5 * Math.pow(1024, amount - 1);\r\n            }\r\n            return 0.5 * (-Math.pow(2, -10 * (amount - 1)) + 2);\r\n        },\r\n    },\r\n    Circular: {\r\n        In: function (amount) {\r\n            return 1 - Math.sqrt(1 - amount * amount);\r\n        },\r\n        Out: function (amount) {\r\n            return Math.sqrt(1 - --amount * amount);\r\n        },\r\n        InOut: function (amount) {\r\n            if ((amount *= 2) < 1) {\r\n                return -0.5 * (Math.sqrt(1 - amount * amount) - 1);\r\n            }\r\n            return 0.5 * (Math.sqrt(1 - (amount -= 2) * amount) + 1);\r\n        },\r\n    },\r\n    Elastic: {\r\n        In: function (amount) {\r\n            if (amount === 0) {\r\n                return 0;\r\n            }\r\n            if (amount === 1) {\r\n                return 1;\r\n            }\r\n            return -Math.pow(2, 10 * (amount - 1)) * Math.sin((amount - 1.1) * 5 * Math.PI);\r\n        },\r\n        Out: function (amount) {\r\n            if (amount === 0) {\r\n                return 0;\r\n            }\r\n            if (amount === 1) {\r\n                return 1;\r\n            }\r\n            return Math.pow(2, -10 * amount) * Math.sin((amount - 0.1) * 5 * Math.PI) + 1;\r\n        },\r\n        InOut: function (amount) {\r\n            if (amount === 0) {\r\n                return 0;\r\n            }\r\n            if (amount === 1) {\r\n                return 1;\r\n            }\r\n            amount *= 2;\r\n            if (amount < 1) {\r\n                return -0.5 * Math.pow(2, 10 * (amount - 1)) * Math.sin((amount - 1.1) * 5 * Math.PI);\r\n            }\r\n            return 0.5 * Math.pow(2, -10 * (amount - 1)) * Math.sin((amount - 1.1) * 5 * Math.PI) + 1;\r\n        },\r\n    },\r\n    Back: {\r\n        In: function (amount) {\r\n            var s = 1.70158;\r\n            return amount * amount * ((s + 1) * amount - s);\r\n        },\r\n        Out: function (amount) {\r\n            var s = 1.70158;\r\n            return --amount * amount * ((s + 1) * amount + s) + 1;\r\n        },\r\n        InOut: function (amount) {\r\n            var s = 1.70158 * 1.525;\r\n            if ((amount *= 2) < 1) {\r\n                return 0.5 * (amount * amount * ((s + 1) * amount - s));\r\n            }\r\n            return 0.5 * ((amount -= 2) * amount * ((s + 1) * amount + s) + 2);\r\n        },\r\n    },\r\n    Bounce: {\r\n        In: function (amount) {\r\n            return 1 - Easing.Bounce.Out(1 - amount);\r\n        },\r\n        Out: function (amount) {\r\n            if (amount < 1 / 2.75) {\r\n                return 7.5625 * amount * amount;\r\n            }\r\n            else if (amount < 2 / 2.75) {\r\n                return 7.5625 * (amount -= 1.5 / 2.75) * amount + 0.75;\r\n            }\r\n            else if (amount < 2.5 / 2.75) {\r\n                return 7.5625 * (amount -= 2.25 / 2.75) * amount + 0.9375;\r\n            }\r\n            else {\r\n                return 7.5625 * (amount -= 2.625 / 2.75) * amount + 0.984375;\r\n            }\r\n        },\r\n        InOut: function (amount) {\r\n            if (amount < 0.5) {\r\n                return Easing.Bounce.In(amount * 2) * 0.5;\r\n            }\r\n            return Easing.Bounce.Out(amount * 2 - 1) * 0.5 + 0.5;\r\n        },\r\n    },\r\n};\r\n\r\nvar now;\r\n// Include a performance.now polyfill.\r\n// In node.js, use process.hrtime.\r\n// eslint-disable-next-line\r\n// @ts-ignore\r\nif (typeof self === 'undefined' && typeof process !== 'undefined' && process.hrtime) {\r\n    now = function () {\r\n        // eslint-disable-next-line\r\n        // @ts-ignore\r\n        var time = process.hrtime();\r\n        // Convert [seconds, nanoseconds] to milliseconds.\r\n        return time[0] * 1000 + time[1] / 1000000;\r\n    };\r\n}\r\n// In a browser, use self.performance.now if it is available.\r\nelse if (typeof self !== 'undefined' && self.performance !== undefined && self.performance.now !== undefined) {\r\n    // This must be bound, because directly assigning this function\r\n    // leads to an invocation exception in Chrome.\r\n    now = self.performance.now.bind(self.performance);\r\n}\r\n// Use Date.now if it is available.\r\nelse if (Date.now !== undefined) {\r\n    now = Date.now;\r\n}\r\n// Otherwise, use 'new Date().getTime()'.\r\nelse {\r\n    now = function () {\r\n        return new Date().getTime();\r\n    };\r\n}\r\nvar now$1 = now;\r\n\r\n/**\r\n * Controlling groups of tweens\r\n *\r\n * Using the TWEEN singleton to manage your tweens can cause issues in large apps with many components.\r\n * In these cases, you may want to create your own smaller groups of tween\r\n */\r\nvar Group = /** @class */ (function () {\r\n    function Group() {\r\n        this._tweens = {};\r\n        this._tweensAddedDuringUpdate = {};\r\n    }\r\n    Group.prototype.getAll = function () {\r\n        var _this = this;\r\n        return Object.keys(this._tweens).map(function (tweenId) {\r\n            return _this._tweens[tweenId];\r\n        });\r\n    };\r\n    Group.prototype.removeAll = function () {\r\n        this._tweens = {};\r\n    };\r\n    Group.prototype.add = function (tween) {\r\n        this._tweens[tween.getId()] = tween;\r\n        this._tweensAddedDuringUpdate[tween.getId()] = tween;\r\n    };\r\n    Group.prototype.remove = function (tween) {\r\n        delete this._tweens[tween.getId()];\r\n        delete this._tweensAddedDuringUpdate[tween.getId()];\r\n    };\r\n    Group.prototype.update = function (time, preserve) {\r\n        if (time === void 0) { time = now$1(); }\r\n        if (preserve === void 0) { preserve = false; }\r\n        var tweenIds = Object.keys(this._tweens);\r\n        if (tweenIds.length === 0) {\r\n            return false;\r\n        }\r\n        // Tweens are updated in \"batches\". If you add a new tween during an\r\n        // update, then the new tween will be updated in the next batch.\r\n        // If you remove a tween during an update, it may or may not be updated.\r\n        // However, if the removed tween was added during the current batch,\r\n        // then it will not be updated.\r\n        while (tweenIds.length > 0) {\r\n            this._tweensAddedDuringUpdate = {};\r\n            for (var i = 0; i < tweenIds.length; i++) {\r\n                var tween = this._tweens[tweenIds[i]];\r\n                var autoStart = !preserve;\r\n                if (tween && tween.update(time, autoStart) === false && !preserve) {\r\n                    delete this._tweens[tweenIds[i]];\r\n                }\r\n            }\r\n            tweenIds = Object.keys(this._tweensAddedDuringUpdate);\r\n        }\r\n        return true;\r\n    };\r\n    return Group;\r\n}());\r\n\r\n/**\r\n *\r\n */\r\nvar Interpolation = {\r\n    Linear: function (v, k) {\r\n        var m = v.length - 1;\r\n        var f = m * k;\r\n        var i = Math.floor(f);\r\n        var fn = Interpolation.Utils.Linear;\r\n        if (k < 0) {\r\n            return fn(v[0], v[1], f);\r\n        }\r\n        if (k > 1) {\r\n            return fn(v[m], v[m - 1], m - f);\r\n        }\r\n        return fn(v[i], v[i + 1 > m ? m : i + 1], f - i);\r\n    },\r\n    Bezier: function (v, k) {\r\n        var b = 0;\r\n        var n = v.length - 1;\r\n        var pw = Math.pow;\r\n        var bn = Interpolation.Utils.Bernstein;\r\n        for (var i = 0; i <= n; i++) {\r\n            b += pw(1 - k, n - i) * pw(k, i) * v[i] * bn(n, i);\r\n        }\r\n        return b;\r\n    },\r\n    CatmullRom: function (v, k) {\r\n        var m = v.length - 1;\r\n        var f = m * k;\r\n        var i = Math.floor(f);\r\n        var fn = Interpolation.Utils.CatmullRom;\r\n        if (v[0] === v[m]) {\r\n            if (k < 0) {\r\n                i = Math.floor((f = m * (1 + k)));\r\n            }\r\n            return fn(v[(i - 1 + m) % m], v[i], v[(i + 1) % m], v[(i + 2) % m], f - i);\r\n        }\r\n        else {\r\n            if (k < 0) {\r\n                return v[0] - (fn(v[0], v[0], v[1], v[1], -f) - v[0]);\r\n            }\r\n            if (k > 1) {\r\n                return v[m] - (fn(v[m], v[m], v[m - 1], v[m - 1], f - m) - v[m]);\r\n            }\r\n            return fn(v[i ? i - 1 : 0], v[i], v[m < i + 1 ? m : i + 1], v[m < i + 2 ? m : i + 2], f - i);\r\n        }\r\n    },\r\n    Utils: {\r\n        Linear: function (p0, p1, t) {\r\n            return (p1 - p0) * t + p0;\r\n        },\r\n        Bernstein: function (n, i) {\r\n            var fc = Interpolation.Utils.Factorial;\r\n            return fc(n) / fc(i) / fc(n - i);\r\n        },\r\n        Factorial: (function () {\r\n            var a = [1];\r\n            return function (n) {\r\n                var s = 1;\r\n                if (a[n]) {\r\n                    return a[n];\r\n                }\r\n                for (var i = n; i > 1; i--) {\r\n                    s *= i;\r\n                }\r\n                a[n] = s;\r\n                return s;\r\n            };\r\n        })(),\r\n        CatmullRom: function (p0, p1, p2, p3, t) {\r\n            var v0 = (p2 - p0) * 0.5;\r\n            var v1 = (p3 - p1) * 0.5;\r\n            var t2 = t * t;\r\n            var t3 = t * t2;\r\n            return (2 * p1 - 2 * p2 + v0 + v1) * t3 + (-3 * p1 + 3 * p2 - 2 * v0 - v1) * t2 + v0 * t + p1;\r\n        },\r\n    },\r\n};\r\n\r\n/**\r\n * Utils\r\n */\r\nvar Sequence = /** @class */ (function () {\r\n    function Sequence() {\r\n    }\r\n    Sequence.nextId = function () {\r\n        return Sequence._nextId++;\r\n    };\r\n    Sequence._nextId = 0;\r\n    return Sequence;\r\n}());\r\n\r\nvar mainGroup = new Group();\r\n\r\n/**\r\n * Tween.js - Licensed under the MIT license\r\n * https://github.com/tweenjs/tween.js\r\n * ----------------------------------------------\r\n *\r\n * See https://github.com/tweenjs/tween.js/graphs/contributors for the full list of contributors.\r\n * Thank you all, you're awesome!\r\n */\r\nvar Tween = /** @class */ (function () {\r\n    function Tween(_object, _group) {\r\n        if (_group === void 0) { _group = mainGroup; }\r\n        this._object = _object;\r\n        this._group = _group;\r\n        this._isPaused = false;\r\n        this._pauseStart = 0;\r\n        this._valuesStart = {};\r\n        this._valuesEnd = {};\r\n        this._valuesStartRepeat = {};\r\n        this._duration = 1000;\r\n        this._initialRepeat = 0;\r\n        this._repeat = 0;\r\n        this._yoyo = false;\r\n        this._isPlaying = false;\r\n        this._reversed = false;\r\n        this._delayTime = 0;\r\n        this._startTime = 0;\r\n        this._easingFunction = Easing.Linear.None;\r\n        this._interpolationFunction = Interpolation.Linear;\r\n        this._chainedTweens = [];\r\n        this._onStartCallbackFired = false;\r\n        this._id = Sequence.nextId();\r\n        this._isChainStopped = false;\r\n        this._goToEnd = false;\r\n    }\r\n    Tween.prototype.getId = function () {\r\n        return this._id;\r\n    };\r\n    Tween.prototype.isPlaying = function () {\r\n        return this._isPlaying;\r\n    };\r\n    Tween.prototype.isPaused = function () {\r\n        return this._isPaused;\r\n    };\r\n    Tween.prototype.to = function (properties, duration) {\r\n        // TODO? restore this, then update the 07_dynamic_to example to set fox\r\n        // tween's to on each update. That way the behavior is opt-in (there's\r\n        // currently no opt-out).\r\n        // for (const prop in properties) this._valuesEnd[prop] = properties[prop]\r\n        this._valuesEnd = Object.create(properties);\r\n        if (duration !== undefined) {\r\n            this._duration = duration;\r\n        }\r\n        return this;\r\n    };\r\n    Tween.prototype.duration = function (d) {\r\n        this._duration = d;\r\n        return this;\r\n    };\r\n    Tween.prototype.start = function (time) {\r\n        if (this._isPlaying) {\r\n            return this;\r\n        }\r\n        // eslint-disable-next-line\r\n        this._group && this._group.add(this);\r\n        this._repeat = this._initialRepeat;\r\n        if (this._reversed) {\r\n            // If we were reversed (f.e. using the yoyo feature) then we need to\r\n            // flip the tween direction back to forward.\r\n            this._reversed = false;\r\n            for (var property in this._valuesStartRepeat) {\r\n                this._swapEndStartRepeatValues(property);\r\n                this._valuesStart[property] = this._valuesStartRepeat[property];\r\n            }\r\n        }\r\n        this._isPlaying = true;\r\n        this._isPaused = false;\r\n        this._onStartCallbackFired = false;\r\n        this._isChainStopped = false;\r\n        this._startTime = time !== undefined ? (typeof time === 'string' ? now$1() + parseFloat(time) : time) : now$1();\r\n        this._startTime += this._delayTime;\r\n        this._setupProperties(this._object, this._valuesStart, this._valuesEnd, this._valuesStartRepeat);\r\n        return this;\r\n    };\r\n    Tween.prototype._setupProperties = function (_object, _valuesStart, _valuesEnd, _valuesStartRepeat) {\r\n        for (var property in _valuesEnd) {\r\n            var startValue = _object[property];\r\n            var startValueIsArray = Array.isArray(startValue);\r\n            var propType = startValueIsArray ? 'array' : typeof startValue;\r\n            var isInterpolationList = !startValueIsArray && Array.isArray(_valuesEnd[property]);\r\n            // If `to()` specifies a property that doesn't exist in the source object,\r\n            // we should not set that property in the object\r\n            if (propType === 'undefined' || propType === 'function') {\r\n                continue;\r\n            }\r\n            // Check if an Array was provided as property value\r\n            if (isInterpolationList) {\r\n                var endValues = _valuesEnd[property];\r\n                if (endValues.length === 0) {\r\n                    continue;\r\n                }\r\n                // handle an array of relative values\r\n                endValues = endValues.map(this._handleRelativeValue.bind(this, startValue));\r\n                // Create a local copy of the Array with the start value at the front\r\n                _valuesEnd[property] = [startValue].concat(endValues);\r\n            }\r\n            // handle the deepness of the values\r\n            if ((propType === 'object' || startValueIsArray) && startValue && !isInterpolationList) {\r\n                _valuesStart[property] = startValueIsArray ? [] : {};\r\n                // eslint-disable-next-line\r\n                for (var prop in startValue) {\r\n                    // eslint-disable-next-line\r\n                    // @ts-ignore FIXME?\r\n                    _valuesStart[property][prop] = startValue[prop];\r\n                }\r\n                _valuesStartRepeat[property] = startValueIsArray ? [] : {}; // TODO? repeat nested values? And yoyo? And array values?\r\n                // eslint-disable-next-line\r\n                // @ts-ignore FIXME?\r\n                this._setupProperties(startValue, _valuesStart[property], _valuesEnd[property], _valuesStartRepeat[property]);\r\n            }\r\n            else {\r\n                // Save the starting value, but only once.\r\n                if (typeof _valuesStart[property] === 'undefined') {\r\n                    _valuesStart[property] = startValue;\r\n                }\r\n                if (!startValueIsArray) {\r\n                    // eslint-disable-next-line\r\n                    // @ts-ignore FIXME?\r\n                    _valuesStart[property] *= 1.0; // Ensures we're using numbers, not strings\r\n                }\r\n                if (isInterpolationList) {\r\n                    // eslint-disable-next-line\r\n                    // @ts-ignore FIXME?\r\n                    _valuesStartRepeat[property] = _valuesEnd[property].slice().reverse();\r\n                }\r\n                else {\r\n                    _valuesStartRepeat[property] = _valuesStart[property] || 0;\r\n                }\r\n            }\r\n        }\r\n    };\r\n    Tween.prototype.stop = function () {\r\n        if (!this._isChainStopped) {\r\n            this._isChainStopped = true;\r\n            this.stopChainedTweens();\r\n        }\r\n        if (!this._isPlaying) {\r\n            return this;\r\n        }\r\n        // eslint-disable-next-line\r\n        this._group && this._group.remove(this);\r\n        this._isPlaying = false;\r\n        this._isPaused = false;\r\n        if (this._onStopCallback) {\r\n            this._onStopCallback(this._object);\r\n        }\r\n        return this;\r\n    };\r\n    Tween.prototype.end = function () {\r\n        this._goToEnd = true;\r\n        this.update(Infinity);\r\n        return this;\r\n    };\r\n    Tween.prototype.pause = function (time) {\r\n        if (time === void 0) { time = now$1(); }\r\n        if (this._isPaused || !this._isPlaying) {\r\n            return this;\r\n        }\r\n        this._isPaused = true;\r\n        this._pauseStart = time;\r\n        // eslint-disable-next-line\r\n        this._group && this._group.remove(this);\r\n        return this;\r\n    };\r\n    Tween.prototype.resume = function (time) {\r\n        if (time === void 0) { time = now$1(); }\r\n        if (!this._isPaused || !this._isPlaying) {\r\n            return this;\r\n        }\r\n        this._isPaused = false;\r\n        this._startTime += time - this._pauseStart;\r\n        this._pauseStart = 0;\r\n        // eslint-disable-next-line\r\n        this._group && this._group.add(this);\r\n        return this;\r\n    };\r\n    Tween.prototype.stopChainedTweens = function () {\r\n        for (var i = 0, numChainedTweens = this._chainedTweens.length; i < numChainedTweens; i++) {\r\n            this._chainedTweens[i].stop();\r\n        }\r\n        return this;\r\n    };\r\n    Tween.prototype.group = function (group) {\r\n        this._group = group;\r\n        return this;\r\n    };\r\n    Tween.prototype.delay = function (amount) {\r\n        this._delayTime = amount;\r\n        return this;\r\n    };\r\n    Tween.prototype.repeat = function (times) {\r\n        this._initialRepeat = times;\r\n        this._repeat = times;\r\n        return this;\r\n    };\r\n    Tween.prototype.repeatDelay = function (amount) {\r\n        this._repeatDelayTime = amount;\r\n        return this;\r\n    };\r\n    Tween.prototype.yoyo = function (yoyo) {\r\n        this._yoyo = yoyo;\r\n        return this;\r\n    };\r\n    Tween.prototype.easing = function (easingFunction) {\r\n        this._easingFunction = easingFunction;\r\n        return this;\r\n    };\r\n    Tween.prototype.interpolation = function (interpolationFunction) {\r\n        this._interpolationFunction = interpolationFunction;\r\n        return this;\r\n    };\r\n    Tween.prototype.chain = function () {\r\n        var tweens = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            tweens[_i] = arguments[_i];\r\n        }\r\n        this._chainedTweens = tweens;\r\n        return this;\r\n    };\r\n    Tween.prototype.onStart = function (callback) {\r\n        this._onStartCallback = callback;\r\n        return this;\r\n    };\r\n    Tween.prototype.onUpdate = function (callback) {\r\n        this._onUpdateCallback = callback;\r\n        return this;\r\n    };\r\n    Tween.prototype.onRepeat = function (callback) {\r\n        this._onRepeatCallback = callback;\r\n        return this;\r\n    };\r\n    Tween.prototype.onComplete = function (callback) {\r\n        this._onCompleteCallback = callback;\r\n        return this;\r\n    };\r\n    Tween.prototype.onStop = function (callback) {\r\n        this._onStopCallback = callback;\r\n        return this;\r\n    };\r\n    /**\r\n     * @returns true if the tween is still playing after the update, false\r\n     * otherwise (calling update on a paused tween still returns true because\r\n     * it is still playing, just paused).\r\n     */\r\n    Tween.prototype.update = function (time, autoStart) {\r\n        if (time === void 0) { time = now$1(); }\r\n        if (autoStart === void 0) { autoStart = true; }\r\n        if (this._isPaused)\r\n            return true;\r\n        var property;\r\n        var elapsed;\r\n        var endTime = this._startTime + this._duration;\r\n        if (!this._goToEnd && !this._isPlaying) {\r\n            if (time > endTime)\r\n                return false;\r\n            if (autoStart)\r\n                this.start(time);\r\n        }\r\n        this._goToEnd = false;\r\n        if (time < this._startTime) {\r\n            return true;\r\n        }\r\n        if (this._onStartCallbackFired === false) {\r\n            if (this._onStartCallback) {\r\n                this._onStartCallback(this._object);\r\n            }\r\n            this._onStartCallbackFired = true;\r\n        }\r\n        elapsed = (time - this._startTime) / this._duration;\r\n        elapsed = this._duration === 0 || elapsed > 1 ? 1 : elapsed;\r\n        var value = this._easingFunction(elapsed);\r\n        // properties transformations\r\n        this._updateProperties(this._object, this._valuesStart, this._valuesEnd, value);\r\n        if (this._onUpdateCallback) {\r\n            this._onUpdateCallback(this._object, elapsed);\r\n        }\r\n        if (elapsed === 1) {\r\n            if (this._repeat > 0) {\r\n                if (isFinite(this._repeat)) {\r\n                    this._repeat--;\r\n                }\r\n                // Reassign starting values, restart by making startTime = now\r\n                for (property in this._valuesStartRepeat) {\r\n                    if (!this._yoyo && typeof this._valuesEnd[property] === 'string') {\r\n                        this._valuesStartRepeat[property] =\r\n                            // eslint-disable-next-line\r\n                            // @ts-ignore FIXME?\r\n                            this._valuesStartRepeat[property] + parseFloat(this._valuesEnd[property]);\r\n                    }\r\n                    if (this._yoyo) {\r\n                        this._swapEndStartRepeatValues(property);\r\n                    }\r\n                    this._valuesStart[property] = this._valuesStartRepeat[property];\r\n                }\r\n                if (this._yoyo) {\r\n                    this._reversed = !this._reversed;\r\n                }\r\n                if (this._repeatDelayTime !== undefined) {\r\n                    this._startTime = time + this._repeatDelayTime;\r\n                }\r\n                else {\r\n                    this._startTime = time + this._delayTime;\r\n                }\r\n                if (this._onRepeatCallback) {\r\n                    this._onRepeatCallback(this._object);\r\n                }\r\n                return true;\r\n            }\r\n            else {\r\n                if (this._onCompleteCallback) {\r\n                    this._onCompleteCallback(this._object);\r\n                }\r\n                for (var i = 0, numChainedTweens = this._chainedTweens.length; i < numChainedTweens; i++) {\r\n                    // Make the chained tweens start exactly at the time they should,\r\n                    // even if the `update()` method was called way past the duration of the tween\r\n                    this._chainedTweens[i].start(this._startTime + this._duration);\r\n                }\r\n                this._isPlaying = false;\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    };\r\n    Tween.prototype._updateProperties = function (_object, _valuesStart, _valuesEnd, value) {\r\n        for (var property in _valuesEnd) {\r\n            // Don't update properties that do not exist in the source object\r\n            if (_valuesStart[property] === undefined) {\r\n                continue;\r\n            }\r\n            var start = _valuesStart[property] || 0;\r\n            var end = _valuesEnd[property];\r\n            var startIsArray = Array.isArray(_object[property]);\r\n            var endIsArray = Array.isArray(end);\r\n            var isInterpolationList = !startIsArray && endIsArray;\r\n            if (isInterpolationList) {\r\n                _object[property] = this._interpolationFunction(end, value);\r\n            }\r\n            else if (typeof end === 'object' && end) {\r\n                // eslint-disable-next-line\r\n                // @ts-ignore FIXME?\r\n                this._updateProperties(_object[property], start, end, value);\r\n            }\r\n            else {\r\n                // Parses relative end values with start as base (e.g.: +10, -3)\r\n                end = this._handleRelativeValue(start, end);\r\n                // Protect against non numeric properties.\r\n                if (typeof end === 'number') {\r\n                    // eslint-disable-next-line\r\n                    // @ts-ignore FIXME?\r\n                    _object[property] = start + (end - start) * value;\r\n                }\r\n            }\r\n        }\r\n    };\r\n    Tween.prototype._handleRelativeValue = function (start, end) {\r\n        if (typeof end !== 'string') {\r\n            return end;\r\n        }\r\n        if (end.charAt(0) === '+' || end.charAt(0) === '-') {\r\n            return start + parseFloat(end);\r\n        }\r\n        else {\r\n            return parseFloat(end);\r\n        }\r\n    };\r\n    Tween.prototype._swapEndStartRepeatValues = function (property) {\r\n        var tmp = this._valuesStartRepeat[property];\r\n        var endValue = this._valuesEnd[property];\r\n        if (typeof endValue === 'string') {\r\n            this._valuesStartRepeat[property] = this._valuesStartRepeat[property] + parseFloat(endValue);\r\n        }\r\n        else {\r\n            this._valuesStartRepeat[property] = this._valuesEnd[property];\r\n        }\r\n        this._valuesEnd[property] = tmp;\r\n    };\r\n    return Tween;\r\n}());\r\n\r\nvar VERSION = '18.6.4';\r\n\r\n/**\r\n * Tween.js - Licensed under the MIT license\r\n * https://github.com/tweenjs/tween.js\r\n * ----------------------------------------------\r\n *\r\n * See https://github.com/tweenjs/tween.js/graphs/contributors for the full list of contributors.\r\n * Thank you all, you're awesome!\r\n */\r\nvar nextId = Sequence.nextId;\r\n/**\r\n * Controlling groups of tweens\r\n *\r\n * Using the TWEEN singleton to manage your tweens can cause issues in large apps with many components.\r\n * In these cases, you may want to create your own smaller groups of tweens.\r\n */\r\nvar TWEEN = mainGroup;\r\n// This is the best way to export things in a way that's compatible with both ES\r\n// Modules and CommonJS, without build hacks, and so as not to break the\r\n// existing API.\r\n// https://github.com/rollup/rollup/issues/1961#issuecomment-423037881\r\nvar getAll = TWEEN.getAll.bind(TWEEN);\r\nvar removeAll = TWEEN.removeAll.bind(TWEEN);\r\nvar add = TWEEN.add.bind(TWEEN);\r\nvar remove = TWEEN.remove.bind(TWEEN);\r\nvar update = TWEEN.update.bind(TWEEN);\r\nvar exports = {\r\n    Easing: Easing,\r\n    Group: Group,\r\n    Interpolation: Interpolation,\r\n    now: now$1,\r\n    Sequence: Sequence,\r\n    nextId: nextId,\r\n    Tween: Tween,\r\n    VERSION: VERSION,\r\n    getAll: getAll,\r\n    removeAll: removeAll,\r\n    add: add,\r\n    remove: remove,\r\n    update: update,\r\n};\r\n\r\nexport default exports;\r\nexport { Easing, Group, Interpolation, Sequence, Tween, VERSION, add, getAll, nextId, now$1 as now, remove, removeAll, update };\r\n","/** @module */\r\n\r\nimport { Tween } from '../lib/snowpack/build/snowpack/pkg/@tweenjs/tweenjs.js'\r\n/**\r\n * Square is a graphic.\r\n * It displays itself on a parent object.\r\n * Its parent object stores its x and y.\r\n * It shows a square at the parent object xy coordinates.\r\n * It animates the square when picking up and dropping.\r\n * @param {Object} parent\r\n * @param {Number} parent.x\r\n * @param {Number} parent.y\r\n * @param {Number} w - width of square to draw.\r\n * @param {Number} h - height of square to draw.\r\n * @param {Screen} screen\r\n * @constructor\r\n */\r\nexport default function SquareGraphic(parent, w, h, screen) {\r\n    const self = this\r\n    self.w = w // display width, because we're going to make animations with it\r\n    self.h = h\r\n    self.trueW = w // true width, because we want to return to this width after animating.\r\n    self.trueH = h\r\n\r\n    self.pickUp = function () {\r\n        self.tweenSq = new Tween(self)\r\n        self.tweenSq.to({ w: self.trueW + 10, h: self.trueH + 10 }, 100)\r\n        self.tweenSq.start()\r\n    }\r\n    self.drop = function () {\r\n        self.tweenSq = new Tween(self)\r\n        self.tweenSq.to({ w: self.trueW, h: self.trueH }, 100)\r\n        self.tweenSq.start()\r\n    }\r\n\r\n    // Graphics component\r\n    self.render = function () {\r\n        const { fctx } = screen\r\n\r\n        fctx.save()\r\n\r\n        if (self.tweenSq) {\r\n            self.tweenSq.update()\r\n        }\r\n\r\n        if (parent.exists === 0) { fctx.globalAlpha = 0.2 }\r\n\r\n        fctx.beginPath()\r\n        fctx.fillStyle = parent.color\r\n        fctx.rect(\r\n            (parent.x - 0.5 * self.w) - 0.5,\r\n            (parent.y - 0.5 * self.h) - 0.5,\r\n            self.w + 1,\r\n            self.h + 1,\r\n        )\r\n        fctx.fill()\r\n        fctx.stroke()\r\n\r\n        fctx.restore()\r\n    }\r\n}\r\n","import SquareGraphic from './SquareGraphic.js'\r\n\r\nexport default function CandidateDnGraphic(candidateDn, screen) {\r\n    const self = this\r\n\r\n    const square = new SquareGraphic(candidateDn, 21, 21, screen) // square is for rendering\r\n    self.square = square\r\n\r\n    self.renderForeground = () => {\r\n        square.render()\r\n    }\r\n    self.setRenderer = (rendererMaker) => {\r\n        self.renderer = rendererMaker(candidateDn)\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport CandidateDnGraphic from '../vizEntities/CandidateDnGraphic.js'\r\n\r\n/**\r\n * CandidateSim has functionality for a canDn that is specific to a simulation.\r\n * CandidateSim has a canDn component.\r\n * The canDn component is a CandidateDn, for now.\r\n\r\n * @param {CandidateDn} canDn - a canDn component that CandidateSim builds upon.\r\n * @param {DraggableManager} dragm\r\n * @constructor\r\n */\r\nexport default function CandidateDnSim(canDn, dragm, screen) {\r\n    const self = this\r\n    self.canDn = canDn\r\n\r\n    self.graphic = new CandidateDnGraphic(canDn, screen)\r\n\r\n    dragm.newSquareHandle(canDn, self.graphic.square)\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Made a super class, VoterSimList.\r\n * VoterGeoList inherits from VoterSimList.\r\n * There is no VoterOne because there isn't any additional functionality that VoterOne would need.\r\n * VoterSimList is different from voterRegistrar\r\n * because it is a list of VoterSim objects rather than VoterShape objects.\r\n * @constructor\r\n */\r\nexport default function VoterSimList(sim) {\r\n    const self = this\r\n\r\n    const list = []\r\n    self.list = list\r\n    self.rendererMaker = () => ({ render: () => {} })\r\n\r\n    self.newVoterSim = function (voterSim) {\r\n        list.push(voterSim)\r\n        voterSim.graphic.setRenderer(self.rendererMaker)\r\n    }\r\n\r\n    self.getVoterShapes = () => list.filter((v) => v.voterShape.exists).map((v) => v.voterShape)\r\n    self.getVoterSims = () => list.filter((v) => v.voterShape.exists)\r\n\r\n    self.update = () => { } // strategy pattern. There is a similar function for VoterGeoList\r\n    self.updateXY = () => {\r\n        list.forEach((v) => v.voterShape.updateXY())\r\n    }\r\n    self.updateVoters = () => { } // strategy pattern. There is a similar function for VoterGeoList\r\n\r\n    self.render = () => {\r\n        list.forEach((v) => { if (v.voterShape.exists) v.graphic.renderer.render() })\r\n    }\r\n\r\n    self.setRenderer = (rendererMaker) => {\r\n        self.rendererMaker = rendererMaker\r\n        list.forEach((v) => v.graphic.setRenderer(rendererMaker))\r\n    }\r\n    self.updateGraphic = (data) => {\r\n        const voterSimsExisting = self.getVoterSims()\r\n        if (data === undefined) {\r\n            voterSimsExisting.forEach((v) => v.graphic.renderer.update())\r\n        } else {\r\n            voterSimsExisting.forEach((v, i) => v.graphic.renderer.update(data[i]))\r\n        }\r\n    }\r\n\r\n    self.renderForeground = () => {\r\n        if (sim.showGhosts) {\r\n            self.renderForegroundAll()\r\n        } else {\r\n            self.renderForegroundExisting()\r\n        }\r\n    }\r\n    self.renderForegroundExisting = () => {\r\n        list.forEach((v) => { if (v.voterShape.exists) v.graphic.renderForeground() })\r\n    }\r\n    self.renderForegroundAll = () => {\r\n        list.forEach((v) => { v.graphic.renderForeground() })\r\n    }\r\n    self.renderBackground = () => {\r\n        list.forEach((v) => { if (v.voterShape.exists) v.graphic.renderer.renderBackground() })\r\n    }\r\n}\r\n","/**\r\n * Graphics Utilities\r\n * Just a few helpful functions that are self-contained and don't need much context.\r\n * @module */\r\n\r\nexport function drawStrokedColor(text, x, y, textsize, lw, color, alpha, ctx, textAlign) {\r\n    ctx.save()\r\n    ctx.globalAlpha = alpha\r\n    ctx.textAlign = textAlign || 'center'\r\n    ctx.font = `${textsize}px Sans-serif`\r\n    ctx.lineWidth = lw\r\n    ctx.fillStyle = color\r\n    ctx.fillText(text, x, y)\r\n    ctx.restore()\r\n}\r\n\r\nexport function textPercent(f) {\r\n    const a = (100 * f).toFixed(0)\r\n    return a\r\n}\r\n","/**\r\n * Javascript Utilities\r\n * Just a few helpful functions that are self-contained and don't need much context.\r\n * @module */\r\n\r\n/**\r\n * List the indices of an array of length n.\r\n * @param {Number} n - length of array\r\n * @returns {Number[]} - A number array from 0 to n-1.\r\n */\r\nexport function range(n) {\r\n    return [...Array(n).keys()]\r\n}\r\n\r\n/**\r\n * Try to deepcopy an object.\r\n * @param {Object} a - an object to copy.\r\n * @returns {Object} A copy of a.\r\n */\r\nexport function jcopy(a) {\r\n    return JSON.parse(JSON.stringify(a))\r\n}\r\n\r\n/** https://stackoverflow.com/a/35810961 */\r\nfunction sortObjByKey(value) {\r\n    // eslint-disable-next-line no-nested-ternary\r\n    return (typeof value === 'object')\r\n        ? (Array.isArray(value)\r\n            ? value.map(sortObjByKey)\r\n            : Object.keys(value).sort().reduce((o, key) => {\r\n                const v = value[key]\r\n                // eslint-disable-next-line no-param-reassign\r\n                o[key] = sortObjByKey(v)\r\n                return o\r\n            }, {})\r\n        )\r\n        : value\r\n}\r\n\r\nexport function orderedJsonStringify(obj) {\r\n    return JSON.stringify(sortObjByKey(obj), null, '\\t')\r\n}\r\n\r\nexport function normPDF(x, mean, sd) {\r\n    const coef = 1 / (sd * Math.sqrt(2 * Math.PI))\r\n    return coef * Math.exp(-0.5 * ((x - mean) / sd) ** 2)\r\n}\r\n\r\nexport function normCDF(x, mean, sd) {\r\n    if (x === Infinity) {\r\n        return 1\r\n    } if (x === -Infinity) {\r\n        return 0\r\n    }\r\n    return 0.5 * erf((x - mean) / (sd * Math.sqrt(2))) + 0.5\r\n}\r\n\r\nfunction erf(x) {\r\n    const ERF_A = 0.147\r\n    const x2 = x ** 2\r\n    const down = 1 + ERF_A * x2\r\n    const up = 4 / Math.PI + ERF_A * x2\r\n    const ratio = -(up / down) * x2\r\n    const expofun = Math.exp(ratio)\r\n    const radical = Math.sqrt(1 - expofun)\r\n    const z = radical * Math.sign(x)\r\n    return z\r\n}\r\n\r\n/** https://stackoverflow.com/a/47355187 */\r\nexport function standardizeColor(str) {\r\n    const canvas = document.createElement('canvas')\r\n    const ctx = canvas.getContext('2d')\r\n    ctx.fillStyle = str\r\n    const sColor = ctx.fillStyle\r\n    canvas.remove()\r\n    return sColor\r\n}\r\n\r\nexport function minIndex(a) {\r\n    let min = Infinity\r\n    let iClosest = null\r\n    for (let i = 0; i < a.length; i++) {\r\n        const d = a[i]\r\n        if (d < min) {\r\n            min = d\r\n            iClosest = i\r\n        }\r\n    }\r\n    return iClosest\r\n}\r\nexport function maxIndex(a) {\r\n    let max = -Infinity\r\n    let iMax = null\r\n    for (let i = 0; i < a.length; i++) {\r\n        const d = a[i]\r\n        if (d > max) {\r\n            max = d\r\n            iMax = i\r\n        }\r\n    }\r\n    return iMax\r\n}\r\n\r\nexport function minMax(a) {\r\n    let min = a[0]\r\n    let max = a[0]\r\n    for (let i = 0; i < a.length; i++) {\r\n        const d = a[i]\r\n        if (d < min) {\r\n            min = d\r\n        }\r\n        if (d > max) {\r\n            max = d\r\n        }\r\n    }\r\n    return [min, max]\r\n}\r\n\r\n/** https://stackoverflow.com/a/24719569 */\r\nexport function clamp(value, min, max) {\r\n    if (value < min) return min\r\n    if (value > max) return max\r\n    return value\r\n}\r\n\r\nexport function copyArrayShallow(a) {\r\n    const n = a.length\r\n    const b = Array(n)\r\n    for (let i = 0; i < n; i++) {\r\n        b[i] = a[i]\r\n    }\r\n    return b\r\n}\r\n\r\nexport function copyArrayShallow2(a) {\r\n    const n = a.length\r\n    const b = Array(n)\r\n    for (let i = 0; i < n; i++) {\r\n        const m = a[i].length\r\n        b[i] = Array(m)\r\n        for (let k = 0; k < m; k++) {\r\n            b[i][k] = a[i][k]\r\n        }\r\n    }\r\n    return b\r\n}\r\n\r\nexport function copyObjectShallow(a) {\r\n    const b = { ...a }\r\n    return b\r\n}\r\n","/** @module */\r\n\r\nimport { clamp, copyObjectShallow, minIndex } from '../utilities/jsHelpers.js'\r\n\r\n/**\r\n * Draggable Manager gives draggable behavior to objects on a canvas.\r\n * If anything changes, an item is added to the \"changes\" array.\r\n * Calling screen.setEventHandlers(dragm.eventHandlers) sets the eventhandlers on the screen.\r\n * @param {Screen} screen\r\n * @param {Changes} changes\r\n * @constructor\r\n */\r\nexport default function DraggableManager(screen, changes, sim) {\r\n    const self = this\r\n\r\n    // private variables\r\n    let drag = {}\r\n    const draggables = []\r\n\r\n    const grabCanvas = screen.tooltips\r\n\r\n    // add draggable objects\r\n    self.newSquareHandle = function (o, g) {\r\n        // set properties here so that we don't set properties on the actual object\r\n        const p = { isSquare: true }\r\n        draggables.push({ o, g, p })\r\n    }\r\n    self.newCircleHandle = function (o, g) { // object, graphic\r\n        const p = { isCircle: true }\r\n        draggables.push({ o, g, p })\r\n    }\r\n\r\n    // Mouse Listeners\r\n    // As a sidenote, it is interesting that we don't need to call model.update here\r\n    // because we are using a game loop that will call model.update.\r\n    const start = function (event) {\r\n        // don't interact with stuff underneath a tooltip\r\n        if (event.target.closest('.tooltipBox') !== null) {\r\n            return\r\n        }\r\n\r\n        const mouse = getMouse(event)\r\n        const extra = (event.isTouch) ? 10 : 0\r\n        const nd = draggables.length\r\n        // We are in the hitboxes of these draggables.\r\n        const hitList = []\r\n        for (let i = 0; i < nd; i++) {\r\n            const d = draggables[i]\r\n            if ((d.o.exists || sim.showGhosts) && hitTest(d, mouse, extra)) {\r\n                hitList.push(i)\r\n            }\r\n        }\r\n        if (hitList.length > 0) {\r\n            const distances2 = hitList.map((i) => {\r\n                const d = draggables[i]\r\n                const offX = d.o.x - mouse.x\r\n                const offY = d.o.y - mouse.y\r\n                return offX ** 2 + offY ** 2\r\n            })\r\n            // pick up\r\n            const iHitListClosest = minIndex(distances2)\r\n            const iDraggableClosest = hitList[iHitListClosest]\r\n\r\n            const d = draggables[iDraggableClosest]\r\n            drag.iDragging = iDraggableClosest\r\n            drag.isDragging = true\r\n            drag.offX = d.o.x - mouse.x\r\n            drag.offY = d.o.y - mouse.y\r\n            d.g.pickUp()\r\n            grabCanvas.dataset.cursor = 'grabbing' // CSS data attribute\r\n        }\r\n        startClickDetect(mouse)\r\n    }\r\n\r\n    const move = function (event) {\r\n        const mouse = getMouse(event)\r\n        if (drag.isDragging) { // because the mouse is moving\r\n            if (event.isTouch) {\r\n                event.preventDefault()\r\n                event.stopPropagation()\r\n            }\r\n            const dragging = draggables[drag.iDragging]\r\n\r\n            const w = screen.width\r\n            const h = screen.height\r\n            dragging.o.setXY({\r\n                x: clamp(mouse.x + drag.offX, 0, w),\r\n                y: clamp(mouse.y + drag.offY, 0, h),\r\n            })\r\n            changes.add(['draggables'])\r\n        } else {\r\n            // see if we're hovering over something grabbable\r\n            // because we want the user to see if they can grab something\r\n            const nd = draggables.length\r\n            for (let i = 0; i < nd; i++) {\r\n                const d = draggables[i]\r\n                if ((sim.showGhosts || d.o.exists) && hitTest(d, mouse, 0)) {\r\n                    grabCanvas.dataset.cursor = 'grab'\r\n                    return\r\n                }\r\n            }\r\n            grabCanvas.dataset.cursor = '' // nothing to grab\r\n        }\r\n        moveClickDetect(mouse)\r\n    }\r\n\r\n    const end = function () {\r\n        endClickDetect()\r\n        if (drag.iDragging !== undefined) {\r\n            const dragging = draggables[drag.iDragging]\r\n            dragging.g.drop()\r\n        }\r\n        drag = {}\r\n    }\r\n\r\n    // Touch Listeners\r\n    const touchmove = (e) => {\r\n        const pass = passTouch(e)\r\n        move(pass)\r\n    }\r\n    const touchstart = (e) => {\r\n        const pass = passTouch(e)\r\n        start(pass)\r\n    }\r\n    const touchend = (e) => {\r\n        const pass = passTouch(e)\r\n        move(pass)\r\n        end(pass)\r\n\r\n        // prevent mousedown from firing unless we're on a tooltip\r\n        if (e.target.closest('.tooltipBox') === null) {\r\n            e.preventDefault()\r\n        }\r\n    }\r\n\r\n    self.eventHandlers = {\r\n        start, move, end, touchmove, touchstart, touchend,\r\n    }\r\n\r\n    /**\r\n     * Make a touch event look like a mouse event, with a flag.\r\n     * @param {Event} e - The event from the DOM\r\n     * @returns {Event} - The same event it received, plus some added properties.\r\n     */\r\n    function passTouch(e) {\r\n        e.isTouch = true\r\n        return e\r\n    }\r\n\r\n    /** Fix position relative to parent\r\n     *  https://stackoverflow.com/questions/2614461/javascript-get-mouse-position-relative-to-parent-element\r\n     */\r\n    function getMouse(e) {\r\n        const rect = screen.canvas.getBoundingClientRect()\r\n        const c = (e.isTouch) ? e.changedTouches[0] : e\r\n        const x = c.clientX - rect.left\r\n        const y = c.clientY - rect.top\r\n        const mouse = { x, y }\r\n        return mouse\r\n    }\r\n\r\n    /**\r\n     * Check whether m, e.g. a mouse, hits d, a draggable object.\r\n     * @param {Object} d - An entry in the draggables array.\r\n     * @param {Object} m - An object with properties x and y, e.g. a mouse.\r\n     * @param {Number} extra - Extra slack to catch touches outside of the hitbox.\r\n     * @returns {Boolean} - Whether m hits d.\r\n     */\r\n    function hitTest(d, m, extra) {\r\n        // Only drag an object if we're near it.\r\n        const x = d.o.x - m.x\r\n        const y = d.o.y - m.y\r\n        if (d.p.isCircle) {\r\n            const { r } = d.g\r\n            const hit = x * x + y * y < (r + extra) * (r + extra)\r\n            return hit\r\n        } if (d.p.isSquare) {\r\n            const { w, h } = d.g\r\n            const hit = Math.abs(x) < 0.5 * w + extra && Math.abs(y) < 0.5 * h + extra\r\n            return hit\r\n        }\r\n        return false\r\n    }\r\n\r\n    // click detection //\r\n\r\n    let couldBeClick\r\n    let startPos\r\n    function startClickDetect(mouse) {\r\n        couldBeClick = true\r\n        startPos = copyObjectShallow(mouse)\r\n    }\r\n    function moveClickDetect(mouse) {\r\n        if (couldBeClick) {\r\n            const xDist = Math.abs(startPos.x - mouse.x)\r\n            const yDist = Math.abs(startPos.y - mouse.y)\r\n            if (xDist > 5) couldBeClick = false\r\n            if (yDist > 5) couldBeClick = false\r\n        }\r\n    }\r\n    function endClickDetect() {\r\n        if (couldBeClick) {\r\n            couldBeClick = false\r\n            if (drag.isDragging) { // because the mouse is moving\r\n                const dragging = draggables[drag.iDragging]\r\n                dragging.o.click()\r\n            } else {\r\n                // We are not dragging anything, and we clicked,\r\n                // and we're inside the screen because this could be a click,\r\n                // so let's do the click action for blank space.\r\n                clickEmpty(startPos)\r\n            }\r\n        }\r\n    }\r\n\r\n    // Test Point\r\n\r\n    function clickEmpty(p) {\r\n        sim.voterTest.start(p)\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport { drawStrokedColor } from '../../utilities/graphicsUtilities.js'\r\nimport DraggableManager from '../DraggableManager.js'\r\n\r\n/**\r\n * The super class for each sim. Provides some basic required functionality.\r\n * @param {Screen} screen\r\n * @param {Changes} changes\r\n * @constructor\r\n */\r\nexport default function SimBase(screen, changes, sim) {\r\n    const self = this\r\n    self.dragm = new DraggableManager(screen, changes, sim)\r\n    self.enter = () => {\r\n        screen.eventHandlers.set(self.dragm.eventHandlers)\r\n    }\r\n    self.exit = () => {}\r\n    self.update = () => {\r\n        if (changes.checkNone()) return\r\n        screen.clear()\r\n        const [x, y] = [150, 150]\r\n        drawStrokedColor('Not Yet Implemented', x, y, 20, 2, '#222', 1, screen.ctx)\r\n    }\r\n    self.render = () => { }\r\n    self.renderForeground = () => { }\r\n    self.testVoteSim = () => {}\r\n}\r\n","/** @module */\r\n\r\nimport { Tween } from '../lib/snowpack/build/snowpack/pkg/@tweenjs/tweenjs.js'\r\n\r\n/**\r\n */\r\n\r\n/**\r\n * Shows a circle at the parent object xy coordinates.\r\n * Animates the circle when picking up and dropping.\r\n * @param {(Candidate|CandidateDn|VoterShape)} parent\r\n *  - something with x and y attributes.\r\n * @param {Number} r - radius of graphic\r\n * @param {String} color - color code\r\n * @param {Screen} screen - something with .ctx to draw to.\r\n * @constructor\r\n */\r\nexport default function CircleGraphic(parent, r, screen) {\r\n    const self = this\r\n\r\n    self.r = r\r\n    self.trueR = r\r\n\r\n    self.pickUp = function () {\r\n        self.tween = new Tween(self)\r\n        self.tween.to({ r: self.trueR * 2 }, 100)\r\n        self.tween.start()\r\n    }\r\n    self.drop = function () {\r\n        self.tween = new Tween(self)\r\n        self.tween.to({ r: self.trueR }, 100)\r\n        self.tween.start()\r\n    }\r\n\r\n    // Graphics component\r\n    self.render = function () {\r\n        const { fctx } = screen\r\n        const { color } = parent\r\n\r\n        fctx.save()\r\n\r\n        if (self.tween) {\r\n            self.tween.update()\r\n        }\r\n\r\n        // handle\r\n\r\n        if (parent.exists === 0) {\r\n            fctx.globalAlpha = 0.2\r\n        }\r\n        fctx.beginPath()\r\n        fctx.fillStyle = color\r\n        fctx.arc(parent.x, parent.y, self.r, 0, 2 * Math.PI)\r\n        fctx.fill()\r\n        fctx.stroke()\r\n\r\n        fctx.restore()\r\n    }\r\n}\r\n","import CircleGraphic from './CircleGraphic.js'\r\n\r\nexport default function VoterGraphic(voterShape, screen) {\r\n    const self = this\r\n\r\n    const circle = new CircleGraphic(voterShape, 13, screen)\r\n    self.circle = circle\r\n\r\n    self.renderForeground = () => {\r\n        // handle\r\n        circle.render()\r\n    }\r\n\r\n    self.setRenderer = (rendererMaker) => {\r\n        self.renderer = rendererMaker(voterShape)\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport VoterGraphic from '../vizEntities/VoterGraphic.js'\r\n\r\n/**\r\n * Super class\r\n * A VoterSim has functionality for a voter that is specific to a simulation.\r\n * Each VoterSim has a voter component.\r\n * The voter component is a VoterShape, for now.\r\n * This voter component is common to all simulations.\r\n * An example of a VoterSim is a VoterGeoBasis.\r\n * This is an inheritance structure.\r\n * @param {VoterShape} voterShape - a voter component that VoterSim builds upon.\r\n * @param {DraggableManager} dragm\r\n * @constructor\r\n */\r\nexport default function VoterSim(voterShape, dragm, screen) {\r\n    const self = this\r\n    self.voterShape = voterShape\r\n\r\n    self.graphic = new VoterGraphic(voterShape, screen)\r\n\r\n    dragm.newCircleHandle(voterShape, self.graphic.circle)\r\n}\r\n","/*\r\n * A fast javascript implementation of simplex noise by Jonas Wagner\r\n\r\nBased on a speed-improved simplex noise algorithm for 2D, 3D and 4D in Java.\r\nWhich is based on example code by Stefan Gustavson (stegu@itn.liu.se).\r\nWith Optimisations by Peter Eastman (peastman@drizzle.stanford.edu).\r\nBetter rank ordering method by Stefan Gustavson in 2012.\r\n\r\n Copyright (c) 2021 Jonas Wagner\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights\r\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n copies of the Software, and to permit persons to whom the Software is\r\n furnished to do so, subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in all\r\n copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n SOFTWARE.\r\n */\r\nconst F2 = 0.5 * (Math.sqrt(3.0) - 1.0);\r\nconst G2 = (3.0 - Math.sqrt(3.0)) / 6.0;\r\nconst F3 = 1.0 / 3.0;\r\nconst G3 = 1.0 / 6.0;\r\nconst F4 = (Math.sqrt(5.0) - 1.0) / 4.0;\r\nconst G4 = (5.0 - Math.sqrt(5.0)) / 20.0;\r\nconst grad3 = new Float32Array([1, 1, 0,\r\n    -1, 1, 0,\r\n    1, -1, 0,\r\n    -1, -1, 0,\r\n    1, 0, 1,\r\n    -1, 0, 1,\r\n    1, 0, -1,\r\n    -1, 0, -1,\r\n    0, 1, 1,\r\n    0, -1, 1,\r\n    0, 1, -1,\r\n    0, -1, -1]);\r\nconst grad4 = new Float32Array([0, 1, 1, 1, 0, 1, 1, -1, 0, 1, -1, 1, 0, 1, -1, -1,\r\n    0, -1, 1, 1, 0, -1, 1, -1, 0, -1, -1, 1, 0, -1, -1, -1,\r\n    1, 0, 1, 1, 1, 0, 1, -1, 1, 0, -1, 1, 1, 0, -1, -1,\r\n    -1, 0, 1, 1, -1, 0, 1, -1, -1, 0, -1, 1, -1, 0, -1, -1,\r\n    1, 1, 0, 1, 1, 1, 0, -1, 1, -1, 0, 1, 1, -1, 0, -1,\r\n    -1, 1, 0, 1, -1, 1, 0, -1, -1, -1, 0, 1, -1, -1, 0, -1,\r\n    1, 1, 1, 0, 1, 1, -1, 0, 1, -1, 1, 0, 1, -1, -1, 0,\r\n    -1, 1, 1, 0, -1, 1, -1, 0, -1, -1, 1, 0, -1, -1, -1, 0]);\r\n/** Deterministic simplex noise generator suitable for 2D, 3D and 4D spaces. */\r\nclass SimplexNoise {\r\n    /**\r\n     * Creates a new `SimplexNoise` instance.\r\n     * This involves some setup. You can save a few cpu cycles by reusing the same instance.\r\n     * @param randomOrSeed A random number generator or a seed (string|number).\r\n     * Defaults to Math.random (random irreproducible initialization).\r\n     */\r\n    constructor(randomOrSeed = Math.random) {\r\n        const random = typeof randomOrSeed == 'function' ? randomOrSeed : alea(randomOrSeed);\r\n        this.p = buildPermutationTable(random);\r\n        this.perm = new Uint8Array(512);\r\n        this.permMod12 = new Uint8Array(512);\r\n        for (let i = 0; i < 512; i++) {\r\n            this.perm[i] = this.p[i & 255];\r\n            this.permMod12[i] = this.perm[i] % 12;\r\n        }\r\n    }\r\n    /**\r\n     * Samples the noise field in 2 dimensions\r\n     * @param x\r\n     * @param y\r\n     * @returns a number in the interval [-1, 1]\r\n     */\r\n    noise2D(x, y) {\r\n        const permMod12 = this.permMod12;\r\n        const perm = this.perm;\r\n        let n0 = 0; // Noise contributions from the three corners\r\n        let n1 = 0;\r\n        let n2 = 0;\r\n        // Skew the input space to determine which simplex cell we're in\r\n        const s = (x + y) * F2; // Hairy factor for 2D\r\n        const i = Math.floor(x + s);\r\n        const j = Math.floor(y + s);\r\n        const t = (i + j) * G2;\r\n        const X0 = i - t; // Unskew the cell origin back to (x,y) space\r\n        const Y0 = j - t;\r\n        const x0 = x - X0; // The x,y distances from the cell origin\r\n        const y0 = y - Y0;\r\n        // For the 2D case, the simplex shape is an equilateral triangle.\r\n        // Determine which simplex we are in.\r\n        let i1, j1; // Offsets for second (middle) corner of simplex in (i,j) coords\r\n        if (x0 > y0) {\r\n            i1 = 1;\r\n            j1 = 0;\r\n        } // lower triangle, XY order: (0,0)->(1,0)->(1,1)\r\n        else {\r\n            i1 = 0;\r\n            j1 = 1;\r\n        } // upper triangle, YX order: (0,0)->(0,1)->(1,1)\r\n        // A step of (1,0) in (i,j) means a step of (1-c,-c) in (x,y), and\r\n        // a step of (0,1) in (i,j) means a step of (-c,1-c) in (x,y), where\r\n        // c = (3-sqrt(3))/6\r\n        const x1 = x0 - i1 + G2; // Offsets for middle corner in (x,y) unskewed coords\r\n        const y1 = y0 - j1 + G2;\r\n        const x2 = x0 - 1.0 + 2.0 * G2; // Offsets for last corner in (x,y) unskewed coords\r\n        const y2 = y0 - 1.0 + 2.0 * G2;\r\n        // Work out the hashed gradient indices of the three simplex corners\r\n        const ii = i & 255;\r\n        const jj = j & 255;\r\n        // Calculate the contribution from the three corners\r\n        let t0 = 0.5 - x0 * x0 - y0 * y0;\r\n        if (t0 >= 0) {\r\n            const gi0 = permMod12[ii + perm[jj]] * 3;\r\n            t0 *= t0;\r\n            n0 = t0 * t0 * (grad3[gi0] * x0 + grad3[gi0 + 1] * y0); // (x,y) of grad3 used for 2D gradient\r\n        }\r\n        let t1 = 0.5 - x1 * x1 - y1 * y1;\r\n        if (t1 >= 0) {\r\n            const gi1 = permMod12[ii + i1 + perm[jj + j1]] * 3;\r\n            t1 *= t1;\r\n            n1 = t1 * t1 * (grad3[gi1] * x1 + grad3[gi1 + 1] * y1);\r\n        }\r\n        let t2 = 0.5 - x2 * x2 - y2 * y2;\r\n        if (t2 >= 0) {\r\n            const gi2 = permMod12[ii + 1 + perm[jj + 1]] * 3;\r\n            t2 *= t2;\r\n            n2 = t2 * t2 * (grad3[gi2] * x2 + grad3[gi2 + 1] * y2);\r\n        }\r\n        // Add contributions from each corner to get the final noise value.\r\n        // The result is scaled to return values in the interval [-1,1].\r\n        return 70.0 * (n0 + n1 + n2);\r\n    }\r\n    /**\r\n     * Samples the noise field in 3 dimensions\r\n     * @param x\r\n     * @param y\r\n     * @param z\r\n     * @returns a number in the interval [-1, 1]\r\n     */\r\n    noise3D(x, y, z) {\r\n        const permMod12 = this.permMod12;\r\n        const perm = this.perm;\r\n        let n0, n1, n2, n3; // Noise contributions from the four corners\r\n        // Skew the input space to determine which simplex cell we're in\r\n        const s = (x + y + z) * F3; // Very nice and simple skew factor for 3D\r\n        const i = Math.floor(x + s);\r\n        const j = Math.floor(y + s);\r\n        const k = Math.floor(z + s);\r\n        const t = (i + j + k) * G3;\r\n        const X0 = i - t; // Unskew the cell origin back to (x,y,z) space\r\n        const Y0 = j - t;\r\n        const Z0 = k - t;\r\n        const x0 = x - X0; // The x,y,z distances from the cell origin\r\n        const y0 = y - Y0;\r\n        const z0 = z - Z0;\r\n        // For the 3D case, the simplex shape is a slightly irregular tetrahedron.\r\n        // Determine which simplex we are in.\r\n        let i1, j1, k1; // Offsets for second corner of simplex in (i,j,k) coords\r\n        let i2, j2, k2; // Offsets for third corner of simplex in (i,j,k) coords\r\n        if (x0 >= y0) {\r\n            if (y0 >= z0) {\r\n                i1 = 1;\r\n                j1 = 0;\r\n                k1 = 0;\r\n                i2 = 1;\r\n                j2 = 1;\r\n                k2 = 0;\r\n            } // X Y Z order\r\n            else if (x0 >= z0) {\r\n                i1 = 1;\r\n                j1 = 0;\r\n                k1 = 0;\r\n                i2 = 1;\r\n                j2 = 0;\r\n                k2 = 1;\r\n            } // X Z Y order\r\n            else {\r\n                i1 = 0;\r\n                j1 = 0;\r\n                k1 = 1;\r\n                i2 = 1;\r\n                j2 = 0;\r\n                k2 = 1;\r\n            } // Z X Y order\r\n        }\r\n        else { // x0<y0\r\n            if (y0 < z0) {\r\n                i1 = 0;\r\n                j1 = 0;\r\n                k1 = 1;\r\n                i2 = 0;\r\n                j2 = 1;\r\n                k2 = 1;\r\n            } // Z Y X order\r\n            else if (x0 < z0) {\r\n                i1 = 0;\r\n                j1 = 1;\r\n                k1 = 0;\r\n                i2 = 0;\r\n                j2 = 1;\r\n                k2 = 1;\r\n            } // Y Z X order\r\n            else {\r\n                i1 = 0;\r\n                j1 = 1;\r\n                k1 = 0;\r\n                i2 = 1;\r\n                j2 = 1;\r\n                k2 = 0;\r\n            } // Y X Z order\r\n        }\r\n        // A step of (1,0,0) in (i,j,k) means a step of (1-c,-c,-c) in (x,y,z),\r\n        // a step of (0,1,0) in (i,j,k) means a step of (-c,1-c,-c) in (x,y,z), and\r\n        // a step of (0,0,1) in (i,j,k) means a step of (-c,-c,1-c) in (x,y,z), where\r\n        // c = 1/6.\r\n        const x1 = x0 - i1 + G3; // Offsets for second corner in (x,y,z) coords\r\n        const y1 = y0 - j1 + G3;\r\n        const z1 = z0 - k1 + G3;\r\n        const x2 = x0 - i2 + 2.0 * G3; // Offsets for third corner in (x,y,z) coords\r\n        const y2 = y0 - j2 + 2.0 * G3;\r\n        const z2 = z0 - k2 + 2.0 * G3;\r\n        const x3 = x0 - 1.0 + 3.0 * G3; // Offsets for last corner in (x,y,z) coords\r\n        const y3 = y0 - 1.0 + 3.0 * G3;\r\n        const z3 = z0 - 1.0 + 3.0 * G3;\r\n        // Work out the hashed gradient indices of the four simplex corners\r\n        const ii = i & 255;\r\n        const jj = j & 255;\r\n        const kk = k & 255;\r\n        // Calculate the contribution from the four corners\r\n        let t0 = 0.6 - x0 * x0 - y0 * y0 - z0 * z0;\r\n        if (t0 < 0)\r\n            n0 = 0.0;\r\n        else {\r\n            const gi0 = permMod12[ii + perm[jj + perm[kk]]] * 3;\r\n            t0 *= t0;\r\n            n0 = t0 * t0 * (grad3[gi0] * x0 + grad3[gi0 + 1] * y0 + grad3[gi0 + 2] * z0);\r\n        }\r\n        let t1 = 0.6 - x1 * x1 - y1 * y1 - z1 * z1;\r\n        if (t1 < 0)\r\n            n1 = 0.0;\r\n        else {\r\n            const gi1 = permMod12[ii + i1 + perm[jj + j1 + perm[kk + k1]]] * 3;\r\n            t1 *= t1;\r\n            n1 = t1 * t1 * (grad3[gi1] * x1 + grad3[gi1 + 1] * y1 + grad3[gi1 + 2] * z1);\r\n        }\r\n        let t2 = 0.6 - x2 * x2 - y2 * y2 - z2 * z2;\r\n        if (t2 < 0)\r\n            n2 = 0.0;\r\n        else {\r\n            const gi2 = permMod12[ii + i2 + perm[jj + j2 + perm[kk + k2]]] * 3;\r\n            t2 *= t2;\r\n            n2 = t2 * t2 * (grad3[gi2] * x2 + grad3[gi2 + 1] * y2 + grad3[gi2 + 2] * z2);\r\n        }\r\n        let t3 = 0.6 - x3 * x3 - y3 * y3 - z3 * z3;\r\n        if (t3 < 0)\r\n            n3 = 0.0;\r\n        else {\r\n            const gi3 = permMod12[ii + 1 + perm[jj + 1 + perm[kk + 1]]] * 3;\r\n            t3 *= t3;\r\n            n3 = t3 * t3 * (grad3[gi3] * x3 + grad3[gi3 + 1] * y3 + grad3[gi3 + 2] * z3);\r\n        }\r\n        // Add contributions from each corner to get the final noise value.\r\n        // The result is scaled to stay just inside [-1,1]\r\n        return 32.0 * (n0 + n1 + n2 + n3);\r\n    }\r\n    /**\r\n     * Samples the noise field in 4 dimensions\r\n     * @param x\r\n     * @param y\r\n     * @param z\r\n     * @returns a number in the interval [-1, 1]\r\n     */\r\n    noise4D(x, y, z, w) {\r\n        const perm = this.perm;\r\n        let n0, n1, n2, n3, n4; // Noise contributions from the five corners\r\n        // Skew the (x,y,z,w) space to determine which cell of 24 simplices we're in\r\n        const s = (x + y + z + w) * F4; // Factor for 4D skewing\r\n        const i = Math.floor(x + s);\r\n        const j = Math.floor(y + s);\r\n        const k = Math.floor(z + s);\r\n        const l = Math.floor(w + s);\r\n        const t = (i + j + k + l) * G4; // Factor for 4D unskewing\r\n        const X0 = i - t; // Unskew the cell origin back to (x,y,z,w) space\r\n        const Y0 = j - t;\r\n        const Z0 = k - t;\r\n        const W0 = l - t;\r\n        const x0 = x - X0; // The x,y,z,w distances from the cell origin\r\n        const y0 = y - Y0;\r\n        const z0 = z - Z0;\r\n        const w0 = w - W0;\r\n        // For the 4D case, the simplex is a 4D shape I won't even try to describe.\r\n        // To find out which of the 24 possible simplices we're in, we need to\r\n        // determine the magnitude ordering of x0, y0, z0 and w0.\r\n        // Six pair-wise comparisons are performed between each possible pair\r\n        // of the four coordinates, and the results are used to rank the numbers.\r\n        let rankx = 0;\r\n        let ranky = 0;\r\n        let rankz = 0;\r\n        let rankw = 0;\r\n        if (x0 > y0)\r\n            rankx++;\r\n        else\r\n            ranky++;\r\n        if (x0 > z0)\r\n            rankx++;\r\n        else\r\n            rankz++;\r\n        if (x0 > w0)\r\n            rankx++;\r\n        else\r\n            rankw++;\r\n        if (y0 > z0)\r\n            ranky++;\r\n        else\r\n            rankz++;\r\n        if (y0 > w0)\r\n            ranky++;\r\n        else\r\n            rankw++;\r\n        if (z0 > w0)\r\n            rankz++;\r\n        else\r\n            rankw++;\r\n        // simplex[c] is a 4-vector with the numbers 0, 1, 2 and 3 in some order.\r\n        // Many values of c will never occur, since e.g. x>y>z>w makes x<z, y<w and x<w\r\n        // impossible. Only the 24 indices which have non-zero entries make any sense.\r\n        // We use a thresholding to set the coordinates in turn from the largest magnitude.\r\n        // Rank 3 denotes the largest coordinate.\r\n        // Rank 2 denotes the second largest coordinate.\r\n        // Rank 1 denotes the second smallest coordinate.\r\n        // The integer offsets for the second simplex corner\r\n        const i1 = rankx >= 3 ? 1 : 0;\r\n        const j1 = ranky >= 3 ? 1 : 0;\r\n        const k1 = rankz >= 3 ? 1 : 0;\r\n        const l1 = rankw >= 3 ? 1 : 0;\r\n        // The integer offsets for the third simplex corner\r\n        const i2 = rankx >= 2 ? 1 : 0;\r\n        const j2 = ranky >= 2 ? 1 : 0;\r\n        const k2 = rankz >= 2 ? 1 : 0;\r\n        const l2 = rankw >= 2 ? 1 : 0;\r\n        // The integer offsets for the fourth simplex corner\r\n        const i3 = rankx >= 1 ? 1 : 0;\r\n        const j3 = ranky >= 1 ? 1 : 0;\r\n        const k3 = rankz >= 1 ? 1 : 0;\r\n        const l3 = rankw >= 1 ? 1 : 0;\r\n        // The fifth corner has all coordinate offsets = 1, so no need to compute that.\r\n        const x1 = x0 - i1 + G4; // Offsets for second corner in (x,y,z,w) coords\r\n        const y1 = y0 - j1 + G4;\r\n        const z1 = z0 - k1 + G4;\r\n        const w1 = w0 - l1 + G4;\r\n        const x2 = x0 - i2 + 2.0 * G4; // Offsets for third corner in (x,y,z,w) coords\r\n        const y2 = y0 - j2 + 2.0 * G4;\r\n        const z2 = z0 - k2 + 2.0 * G4;\r\n        const w2 = w0 - l2 + 2.0 * G4;\r\n        const x3 = x0 - i3 + 3.0 * G4; // Offsets for fourth corner in (x,y,z,w) coords\r\n        const y3 = y0 - j3 + 3.0 * G4;\r\n        const z3 = z0 - k3 + 3.0 * G4;\r\n        const w3 = w0 - l3 + 3.0 * G4;\r\n        const x4 = x0 - 1.0 + 4.0 * G4; // Offsets for last corner in (x,y,z,w) coords\r\n        const y4 = y0 - 1.0 + 4.0 * G4;\r\n        const z4 = z0 - 1.0 + 4.0 * G4;\r\n        const w4 = w0 - 1.0 + 4.0 * G4;\r\n        // Work out the hashed gradient indices of the five simplex corners\r\n        const ii = i & 255;\r\n        const jj = j & 255;\r\n        const kk = k & 255;\r\n        const ll = l & 255;\r\n        // Calculate the contribution from the five corners\r\n        let t0 = 0.6 - x0 * x0 - y0 * y0 - z0 * z0 - w0 * w0;\r\n        if (t0 < 0)\r\n            n0 = 0.0;\r\n        else {\r\n            const gi0 = (perm[ii + perm[jj + perm[kk + perm[ll]]]] % 32) * 4;\r\n            t0 *= t0;\r\n            n0 = t0 * t0 * (grad4[gi0] * x0 + grad4[gi0 + 1] * y0 + grad4[gi0 + 2] * z0 + grad4[gi0 + 3] * w0);\r\n        }\r\n        let t1 = 0.6 - x1 * x1 - y1 * y1 - z1 * z1 - w1 * w1;\r\n        if (t1 < 0)\r\n            n1 = 0.0;\r\n        else {\r\n            const gi1 = (perm[ii + i1 + perm[jj + j1 + perm[kk + k1 + perm[ll + l1]]]] % 32) * 4;\r\n            t1 *= t1;\r\n            n1 = t1 * t1 * (grad4[gi1] * x1 + grad4[gi1 + 1] * y1 + grad4[gi1 + 2] * z1 + grad4[gi1 + 3] * w1);\r\n        }\r\n        let t2 = 0.6 - x2 * x2 - y2 * y2 - z2 * z2 - w2 * w2;\r\n        if (t2 < 0)\r\n            n2 = 0.0;\r\n        else {\r\n            const gi2 = (perm[ii + i2 + perm[jj + j2 + perm[kk + k2 + perm[ll + l2]]]] % 32) * 4;\r\n            t2 *= t2;\r\n            n2 = t2 * t2 * (grad4[gi2] * x2 + grad4[gi2 + 1] * y2 + grad4[gi2 + 2] * z2 + grad4[gi2 + 3] * w2);\r\n        }\r\n        let t3 = 0.6 - x3 * x3 - y3 * y3 - z3 * z3 - w3 * w3;\r\n        if (t3 < 0)\r\n            n3 = 0.0;\r\n        else {\r\n            const gi3 = (perm[ii + i3 + perm[jj + j3 + perm[kk + k3 + perm[ll + l3]]]] % 32) * 4;\r\n            t3 *= t3;\r\n            n3 = t3 * t3 * (grad4[gi3] * x3 + grad4[gi3 + 1] * y3 + grad4[gi3 + 2] * z3 + grad4[gi3 + 3] * w3);\r\n        }\r\n        let t4 = 0.6 - x4 * x4 - y4 * y4 - z4 * z4 - w4 * w4;\r\n        if (t4 < 0)\r\n            n4 = 0.0;\r\n        else {\r\n            const gi4 = (perm[ii + 1 + perm[jj + 1 + perm[kk + 1 + perm[ll + 1]]]] % 32) * 4;\r\n            t4 *= t4;\r\n            n4 = t4 * t4 * (grad4[gi4] * x4 + grad4[gi4 + 1] * y4 + grad4[gi4 + 2] * z4 + grad4[gi4 + 3] * w4);\r\n        }\r\n        // Sum up and scale the result to cover the range [-1,1]\r\n        return 27.0 * (n0 + n1 + n2 + n3 + n4);\r\n    }\r\n}\r\n/**\r\n * Builds a random permutation table.\r\n * This is exported only for (internal) testing purposes.\r\n * Do not rely on this export.\r\n * @private\r\n */\r\nfunction buildPermutationTable(random) {\r\n    const p = new Uint8Array(256);\r\n    for (let i = 0; i < 256; i++) {\r\n        p[i] = i;\r\n    }\r\n    for (let i = 0; i < 255; i++) {\r\n        const r = i + ~~(random() * (256 - i));\r\n        const aux = p[i];\r\n        p[i] = p[r];\r\n        p[r] = aux;\r\n    }\r\n    return p;\r\n}\r\n/*\r\nThe ALEA PRNG and masher code used by simplex-noise.js\r\nis based on code by Johannes Baage, modified by Jonas Wagner.\r\nSee alea.md for the full license.\r\n*/\r\nfunction alea(seed) {\r\n    let s0 = 0;\r\n    let s1 = 0;\r\n    let s2 = 0;\r\n    let c = 1;\r\n    const mash = masher();\r\n    s0 = mash(' ');\r\n    s1 = mash(' ');\r\n    s2 = mash(' ');\r\n    s0 -= mash(seed);\r\n    if (s0 < 0) {\r\n        s0 += 1;\r\n    }\r\n    s1 -= mash(seed);\r\n    if (s1 < 0) {\r\n        s1 += 1;\r\n    }\r\n    s2 -= mash(seed);\r\n    if (s2 < 0) {\r\n        s2 += 1;\r\n    }\r\n    return function () {\r\n        const t = 2091639 * s0 + c * 2.3283064365386963e-10; // 2^-32\r\n        s0 = s1;\r\n        s1 = s2;\r\n        return s2 = t - (c = t | 0);\r\n    };\r\n}\r\nfunction masher() {\r\n    let n = 0xefc8249d;\r\n    return function (data) {\r\n        data = data.toString();\r\n        for (let i = 0; i < data.length; i++) {\r\n            n += data.charCodeAt(i);\r\n            let h = 0.02519603282416938 * n;\r\n            n = h >>> 0;\r\n            h -= n;\r\n            h *= n;\r\n            n = h >>> 0;\r\n            h -= n;\r\n            n += h * 0x100000000; // 2^32\r\n        }\r\n        return (n >>> 0) * 2.3283064365386963e-10; // 2^-32\r\n    };\r\n}\r\n\r\nexport default SimplexNoise;\r\nexport { SimplexNoise, buildPermutationTable };\r\n","/** @module */\r\n\r\n// import SimplexNoise from 'https://cdn.skypack.dev/simplex-noise@3.0.1'\r\nimport { SimplexNoise } from '../lib/snowpack/build/snowpack/pkg/simplex-noise.js'\r\n// https://runkit-packages.com/14.x.x/1644541101130/simplex-noise/#simplex-noisejs\r\n// https://npm.runkit.com/simplex-noise\r\n// https://www.npmjs.com/package/simplex-noise\r\n\r\n/**\r\n * Generate a noisy 2D map with two noise sources per pixel.\r\n * @param {Number} nx - Number of x pixels\r\n * @param {Number} ny - Number of y pixels\r\n * @constructor\r\n */\r\nexport default function GeoNoise(nx, ny) {\r\n    const self = this\r\n    // Simplex Noise Parameters\r\n    self.sn = []\r\n    const noiseWidth = 0.5\r\n    const noiseHeight = 0.5\r\n\r\n    // Geographic Noise Parameters - amplitude of noise\r\n    const xAmp = 100\r\n    const yAmp = 100\r\n\r\n    /** Generate simplex noise. */\r\n    self.genNoise = () => {\r\n        self.sn = makeGeoNoise(nx, ny, noiseWidth, noiseHeight, xAmp, yAmp)\r\n    }\r\n}\r\n\r\n/**\r\n * Generate a noisy 2D map with two noise sources per pixel.\r\n * @param {Number} nx - Number of x pixels\r\n * @param {Number} ny - Number of y pixels\r\n * @param {Number} noiseWidth -  A characteristic size of blobs, in pixels\r\n * @param {Number} noiseHeight - A characteristic size of blobs, in pixels\r\n * @returns {Number[][][]} - Noise in pixel displacement, indexed by row, col, dimension\r\n */\r\nexport function makeGeoNoise(nx, ny, noiseWidth, noiseHeight, xAmp, yAmp) {\r\n    const simplexX = new SimplexNoise('s')\r\n    const simplexY = new SimplexNoise('seed')\r\n    const map = zeros(nx, ny)\r\n    let sumX = 0\r\n    let sumY = 0\r\n    range(nx).forEach((ix) => {\r\n        range(ny).forEach((iy) => {\r\n            // fractional coordinate divided by period of waves\r\n            const x = (ix / nx) * (1 / noiseWidth)\r\n            const y = (iy / ny) * (1 / noiseHeight)\r\n            const noiseX = simplexX.noise2D(x, y)\r\n            const noiseY = simplexY.noise2D(x, y)\r\n            map[ix][iy][0] = (noiseX - 0.5)\r\n            map[ix][iy][1] = (noiseY - 0.5)\r\n            sumX += noiseX\r\n            sumY += noiseY\r\n        })\r\n    })\r\n    // normalize\r\n    const meanX = sumX / (nx * ny) - 0.5\r\n    const meanY = sumY / (nx * ny) - 0.5\r\n    map.forEach((a) => { // array\r\n        a.forEach((p) => { // pair\r\n            // eslint-disable-next-line no-param-reassign\r\n            p[0] = (p[0] - meanX) * xAmp\r\n            // eslint-disable-next-line no-param-reassign\r\n            p[1] = (p[1] - meanY) * yAmp\r\n        })\r\n    })\r\n    return map\r\n}\r\n\r\nfunction zeros(nx, ny) {\r\n    const empty = Array(nx).fill().map(() => Array(ny).fill().map(() => Array(2).fill(0)))\r\n    return empty\r\n}\r\n\r\nfunction range(n) {\r\n    return [...Array(n).keys()]\r\n}\r\n","function area(polygon) {\r\n  var i = -1,\r\n      n = polygon.length,\r\n      a,\r\n      b = polygon[n - 1],\r\n      area = 0;\r\n\r\n  while (++i < n) {\r\n    a = b;\r\n    b = polygon[i];\r\n    area += a[1] * b[0] - a[0] * b[1];\r\n  }\r\n\r\n  return area / 2;\r\n}\r\n\r\nfunction centroid(polygon) {\r\n  var i = -1,\r\n      n = polygon.length,\r\n      x = 0,\r\n      y = 0,\r\n      a,\r\n      b = polygon[n - 1],\r\n      c,\r\n      k = 0;\r\n\r\n  while (++i < n) {\r\n    a = b;\r\n    b = polygon[i];\r\n    k += c = a[0] * b[1] - b[0] * a[1];\r\n    x += (a[0] + b[0]) * c;\r\n    y += (a[1] + b[1]) * c;\r\n  }\r\n\r\n  return k *= 3, [x / k, y / k];\r\n}\r\n\r\n// Returns the 2D cross product of AB and AC vectors, i.e., the z-component of\r\n// the 3D cross product in a quadrant I Cartesian coordinate system (+x is\r\n// right, +y is up). Returns a positive value if ABC is counter-clockwise,\r\n// negative if clockwise, and zero if the points are collinear.\r\nfunction cross(a, b, c) {\r\n  return (b[0] - a[0]) * (c[1] - a[1]) - (b[1] - a[1]) * (c[0] - a[0]);\r\n}\r\n\r\nfunction lexicographicOrder(a, b) {\r\n  return a[0] - b[0] || a[1] - b[1];\r\n}\r\n\r\n// Computes the upper convex hull per the monotone chain algorithm.\r\n// Assumes points.length >= 3, is sorted by x, unique in y.\r\n// Returns an array of indices into points in left-to-right order.\r\nfunction computeUpperHullIndexes(points) {\r\n  const n = points.length,\r\n      indexes = [0, 1];\r\n  let size = 2, i;\r\n\r\n  for (i = 2; i < n; ++i) {\r\n    while (size > 1 && cross(points[indexes[size - 2]], points[indexes[size - 1]], points[i]) <= 0) --size;\r\n    indexes[size++] = i;\r\n  }\r\n\r\n  return indexes.slice(0, size); // remove popped points\r\n}\r\n\r\nfunction hull(points) {\r\n  if ((n = points.length) < 3) return null;\r\n\r\n  var i,\r\n      n,\r\n      sortedPoints = new Array(n),\r\n      flippedPoints = new Array(n);\r\n\r\n  for (i = 0; i < n; ++i) sortedPoints[i] = [+points[i][0], +points[i][1], i];\r\n  sortedPoints.sort(lexicographicOrder);\r\n  for (i = 0; i < n; ++i) flippedPoints[i] = [sortedPoints[i][0], -sortedPoints[i][1]];\r\n\r\n  var upperIndexes = computeUpperHullIndexes(sortedPoints),\r\n      lowerIndexes = computeUpperHullIndexes(flippedPoints);\r\n\r\n  // Construct the hull polygon, removing possible duplicate endpoints.\r\n  var skipLeft = lowerIndexes[0] === upperIndexes[0],\r\n      skipRight = lowerIndexes[lowerIndexes.length - 1] === upperIndexes[upperIndexes.length - 1],\r\n      hull = [];\r\n\r\n  // Add upper hull in right-to-l order.\r\n  // Then add lower hull in left-to-right order.\r\n  for (i = upperIndexes.length - 1; i >= 0; --i) hull.push(points[sortedPoints[upperIndexes[i]][2]]);\r\n  for (i = +skipLeft; i < lowerIndexes.length - skipRight; ++i) hull.push(points[sortedPoints[lowerIndexes[i]][2]]);\r\n\r\n  return hull;\r\n}\r\n\r\nfunction contains(polygon, point) {\r\n  var n = polygon.length,\r\n      p = polygon[n - 1],\r\n      x = point[0], y = point[1],\r\n      x0 = p[0], y0 = p[1],\r\n      x1, y1,\r\n      inside = false;\r\n\r\n  for (var i = 0; i < n; ++i) {\r\n    p = polygon[i], x1 = p[0], y1 = p[1];\r\n    if (((y1 > y) !== (y0 > y)) && (x < (x0 - x1) * (y - y1) / (y0 - y1) + x1)) inside = !inside;\r\n    x0 = x1, y0 = y1;\r\n  }\r\n\r\n  return inside;\r\n}\r\n\r\nfunction length(polygon) {\r\n  var i = -1,\r\n      n = polygon.length,\r\n      b = polygon[n - 1],\r\n      xa,\r\n      ya,\r\n      xb = b[0],\r\n      yb = b[1],\r\n      perimeter = 0;\r\n\r\n  while (++i < n) {\r\n    xa = xb;\r\n    ya = yb;\r\n    b = polygon[i];\r\n    xb = b[0];\r\n    yb = b[1];\r\n    xa -= xb;\r\n    ya -= yb;\r\n    perimeter += Math.hypot(xa, ya);\r\n  }\r\n\r\n  return perimeter;\r\n}\r\n\r\nexport { area as polygonArea, centroid as polygonCentroid, contains as polygonContains, hull as polygonHull, length as polygonLength };\r\n","const epsilon = 1.1102230246251565e-16;\r\nconst splitter = 134217729;\r\nconst resulterrbound = (3 + 8 * epsilon) * epsilon;\r\n\r\n// fast_expansion_sum_zeroelim routine from oritinal code\r\nfunction sum(elen, e, flen, f, h) {\r\n    let Q, Qnew, hh, bvirt;\r\n    let enow = e[0];\r\n    let fnow = f[0];\r\n    let eindex = 0;\r\n    let findex = 0;\r\n    if ((fnow > enow) === (fnow > -enow)) {\r\n        Q = enow;\r\n        enow = e[++eindex];\r\n    } else {\r\n        Q = fnow;\r\n        fnow = f[++findex];\r\n    }\r\n    let hindex = 0;\r\n    if (eindex < elen && findex < flen) {\r\n        if ((fnow > enow) === (fnow > -enow)) {\r\n            Qnew = enow + Q;\r\n            hh = Q - (Qnew - enow);\r\n            enow = e[++eindex];\r\n        } else {\r\n            Qnew = fnow + Q;\r\n            hh = Q - (Qnew - fnow);\r\n            fnow = f[++findex];\r\n        }\r\n        Q = Qnew;\r\n        if (hh !== 0) {\r\n            h[hindex++] = hh;\r\n        }\r\n        while (eindex < elen && findex < flen) {\r\n            if ((fnow > enow) === (fnow > -enow)) {\r\n                Qnew = Q + enow;\r\n                bvirt = Qnew - Q;\r\n                hh = Q - (Qnew - bvirt) + (enow - bvirt);\r\n                enow = e[++eindex];\r\n            } else {\r\n                Qnew = Q + fnow;\r\n                bvirt = Qnew - Q;\r\n                hh = Q - (Qnew - bvirt) + (fnow - bvirt);\r\n                fnow = f[++findex];\r\n            }\r\n            Q = Qnew;\r\n            if (hh !== 0) {\r\n                h[hindex++] = hh;\r\n            }\r\n        }\r\n    }\r\n    while (eindex < elen) {\r\n        Qnew = Q + enow;\r\n        bvirt = Qnew - Q;\r\n        hh = Q - (Qnew - bvirt) + (enow - bvirt);\r\n        enow = e[++eindex];\r\n        Q = Qnew;\r\n        if (hh !== 0) {\r\n            h[hindex++] = hh;\r\n        }\r\n    }\r\n    while (findex < flen) {\r\n        Qnew = Q + fnow;\r\n        bvirt = Qnew - Q;\r\n        hh = Q - (Qnew - bvirt) + (fnow - bvirt);\r\n        fnow = f[++findex];\r\n        Q = Qnew;\r\n        if (hh !== 0) {\r\n            h[hindex++] = hh;\r\n        }\r\n    }\r\n    if (Q !== 0 || hindex === 0) {\r\n        h[hindex++] = Q;\r\n    }\r\n    return hindex;\r\n}\r\n\r\nfunction estimate(elen, e) {\r\n    let Q = e[0];\r\n    for (let i = 1; i < elen; i++) Q += e[i];\r\n    return Q;\r\n}\r\n\r\nfunction vec(n) {\r\n    return new Float64Array(n);\r\n}\r\n\r\nconst ccwerrboundA = (3 + 16 * epsilon) * epsilon;\r\nconst ccwerrboundB = (2 + 12 * epsilon) * epsilon;\r\nconst ccwerrboundC = (9 + 64 * epsilon) * epsilon * epsilon;\r\n\r\nconst B = vec(4);\r\nconst C1 = vec(8);\r\nconst C2 = vec(12);\r\nconst D = vec(16);\r\nconst u = vec(4);\r\n\r\nfunction orient2dadapt(ax, ay, bx, by, cx, cy, detsum) {\r\n    let acxtail, acytail, bcxtail, bcytail;\r\n    let bvirt, c, ahi, alo, bhi, blo, _i, _j, _0, s1, s0, t1, t0, u3;\r\n\r\n    const acx = ax - cx;\r\n    const bcx = bx - cx;\r\n    const acy = ay - cy;\r\n    const bcy = by - cy;\r\n\r\n    s1 = acx * bcy;\r\n    c = splitter * acx;\r\n    ahi = c - (c - acx);\r\n    alo = acx - ahi;\r\n    c = splitter * bcy;\r\n    bhi = c - (c - bcy);\r\n    blo = bcy - bhi;\r\n    s0 = alo * blo - (s1 - ahi * bhi - alo * bhi - ahi * blo);\r\n    t1 = acy * bcx;\r\n    c = splitter * acy;\r\n    ahi = c - (c - acy);\r\n    alo = acy - ahi;\r\n    c = splitter * bcx;\r\n    bhi = c - (c - bcx);\r\n    blo = bcx - bhi;\r\n    t0 = alo * blo - (t1 - ahi * bhi - alo * bhi - ahi * blo);\r\n    _i = s0 - t0;\r\n    bvirt = s0 - _i;\r\n    B[0] = s0 - (_i + bvirt) + (bvirt - t0);\r\n    _j = s1 + _i;\r\n    bvirt = _j - s1;\r\n    _0 = s1 - (_j - bvirt) + (_i - bvirt);\r\n    _i = _0 - t1;\r\n    bvirt = _0 - _i;\r\n    B[1] = _0 - (_i + bvirt) + (bvirt - t1);\r\n    u3 = _j + _i;\r\n    bvirt = u3 - _j;\r\n    B[2] = _j - (u3 - bvirt) + (_i - bvirt);\r\n    B[3] = u3;\r\n\r\n    let det = estimate(4, B);\r\n    let errbound = ccwerrboundB * detsum;\r\n    if (det >= errbound || -det >= errbound) {\r\n        return det;\r\n    }\r\n\r\n    bvirt = ax - acx;\r\n    acxtail = ax - (acx + bvirt) + (bvirt - cx);\r\n    bvirt = bx - bcx;\r\n    bcxtail = bx - (bcx + bvirt) + (bvirt - cx);\r\n    bvirt = ay - acy;\r\n    acytail = ay - (acy + bvirt) + (bvirt - cy);\r\n    bvirt = by - bcy;\r\n    bcytail = by - (bcy + bvirt) + (bvirt - cy);\r\n\r\n    if (acxtail === 0 && acytail === 0 && bcxtail === 0 && bcytail === 0) {\r\n        return det;\r\n    }\r\n\r\n    errbound = ccwerrboundC * detsum + resulterrbound * Math.abs(det);\r\n    det += (acx * bcytail + bcy * acxtail) - (acy * bcxtail + bcx * acytail);\r\n    if (det >= errbound || -det >= errbound) return det;\r\n\r\n    s1 = acxtail * bcy;\r\n    c = splitter * acxtail;\r\n    ahi = c - (c - acxtail);\r\n    alo = acxtail - ahi;\r\n    c = splitter * bcy;\r\n    bhi = c - (c - bcy);\r\n    blo = bcy - bhi;\r\n    s0 = alo * blo - (s1 - ahi * bhi - alo * bhi - ahi * blo);\r\n    t1 = acytail * bcx;\r\n    c = splitter * acytail;\r\n    ahi = c - (c - acytail);\r\n    alo = acytail - ahi;\r\n    c = splitter * bcx;\r\n    bhi = c - (c - bcx);\r\n    blo = bcx - bhi;\r\n    t0 = alo * blo - (t1 - ahi * bhi - alo * bhi - ahi * blo);\r\n    _i = s0 - t0;\r\n    bvirt = s0 - _i;\r\n    u[0] = s0 - (_i + bvirt) + (bvirt - t0);\r\n    _j = s1 + _i;\r\n    bvirt = _j - s1;\r\n    _0 = s1 - (_j - bvirt) + (_i - bvirt);\r\n    _i = _0 - t1;\r\n    bvirt = _0 - _i;\r\n    u[1] = _0 - (_i + bvirt) + (bvirt - t1);\r\n    u3 = _j + _i;\r\n    bvirt = u3 - _j;\r\n    u[2] = _j - (u3 - bvirt) + (_i - bvirt);\r\n    u[3] = u3;\r\n    const C1len = sum(4, B, 4, u, C1);\r\n\r\n    s1 = acx * bcytail;\r\n    c = splitter * acx;\r\n    ahi = c - (c - acx);\r\n    alo = acx - ahi;\r\n    c = splitter * bcytail;\r\n    bhi = c - (c - bcytail);\r\n    blo = bcytail - bhi;\r\n    s0 = alo * blo - (s1 - ahi * bhi - alo * bhi - ahi * blo);\r\n    t1 = acy * bcxtail;\r\n    c = splitter * acy;\r\n    ahi = c - (c - acy);\r\n    alo = acy - ahi;\r\n    c = splitter * bcxtail;\r\n    bhi = c - (c - bcxtail);\r\n    blo = bcxtail - bhi;\r\n    t0 = alo * blo - (t1 - ahi * bhi - alo * bhi - ahi * blo);\r\n    _i = s0 - t0;\r\n    bvirt = s0 - _i;\r\n    u[0] = s0 - (_i + bvirt) + (bvirt - t0);\r\n    _j = s1 + _i;\r\n    bvirt = _j - s1;\r\n    _0 = s1 - (_j - bvirt) + (_i - bvirt);\r\n    _i = _0 - t1;\r\n    bvirt = _0 - _i;\r\n    u[1] = _0 - (_i + bvirt) + (bvirt - t1);\r\n    u3 = _j + _i;\r\n    bvirt = u3 - _j;\r\n    u[2] = _j - (u3 - bvirt) + (_i - bvirt);\r\n    u[3] = u3;\r\n    const C2len = sum(C1len, C1, 4, u, C2);\r\n\r\n    s1 = acxtail * bcytail;\r\n    c = splitter * acxtail;\r\n    ahi = c - (c - acxtail);\r\n    alo = acxtail - ahi;\r\n    c = splitter * bcytail;\r\n    bhi = c - (c - bcytail);\r\n    blo = bcytail - bhi;\r\n    s0 = alo * blo - (s1 - ahi * bhi - alo * bhi - ahi * blo);\r\n    t1 = acytail * bcxtail;\r\n    c = splitter * acytail;\r\n    ahi = c - (c - acytail);\r\n    alo = acytail - ahi;\r\n    c = splitter * bcxtail;\r\n    bhi = c - (c - bcxtail);\r\n    blo = bcxtail - bhi;\r\n    t0 = alo * blo - (t1 - ahi * bhi - alo * bhi - ahi * blo);\r\n    _i = s0 - t0;\r\n    bvirt = s0 - _i;\r\n    u[0] = s0 - (_i + bvirt) + (bvirt - t0);\r\n    _j = s1 + _i;\r\n    bvirt = _j - s1;\r\n    _0 = s1 - (_j - bvirt) + (_i - bvirt);\r\n    _i = _0 - t1;\r\n    bvirt = _0 - _i;\r\n    u[1] = _0 - (_i + bvirt) + (bvirt - t1);\r\n    u3 = _j + _i;\r\n    bvirt = u3 - _j;\r\n    u[2] = _j - (u3 - bvirt) + (_i - bvirt);\r\n    u[3] = u3;\r\n    const Dlen = sum(C2len, C2, 4, u, D);\r\n\r\n    return D[Dlen - 1];\r\n}\r\n\r\nfunction orient2d(ax, ay, bx, by, cx, cy) {\r\n    const detleft = (ay - cy) * (bx - cx);\r\n    const detright = (ax - cx) * (by - cy);\r\n    const det = detleft - detright;\r\n\r\n    if (detleft === 0 || detright === 0 || (detleft > 0) !== (detright > 0)) return det;\r\n\r\n    const detsum = Math.abs(detleft + detright);\r\n    if (Math.abs(det) >= ccwerrboundA * detsum) return det;\r\n\r\n    return -orient2dadapt(ax, ay, bx, by, cx, cy, detsum);\r\n}\r\n\r\nconst EPSILON = Math.pow(2, -52);\r\nconst EDGE_STACK = new Uint32Array(512);\r\n\r\nclass Delaunator {\r\n\r\n    static from(points, getX = defaultGetX, getY = defaultGetY) {\r\n        const n = points.length;\r\n        const coords = new Float64Array(n * 2);\r\n\r\n        for (let i = 0; i < n; i++) {\r\n            const p = points[i];\r\n            coords[2 * i] = getX(p);\r\n            coords[2 * i + 1] = getY(p);\r\n        }\r\n\r\n        return new Delaunator(coords);\r\n    }\r\n\r\n    constructor(coords) {\r\n        const n = coords.length >> 1;\r\n        if (n > 0 && typeof coords[0] !== 'number') throw new Error('Expected coords to contain numbers.');\r\n\r\n        this.coords = coords;\r\n\r\n        // arrays that will store the triangulation graph\r\n        const maxTriangles = Math.max(2 * n - 5, 0);\r\n        this._triangles = new Uint32Array(maxTriangles * 3);\r\n        this._halfedges = new Int32Array(maxTriangles * 3);\r\n\r\n        // temporary arrays for tracking the edges of the advancing convex hull\r\n        this._hashSize = Math.ceil(Math.sqrt(n));\r\n        this._hullPrev = new Uint32Array(n); // edge to prev edge\r\n        this._hullNext = new Uint32Array(n); // edge to next edge\r\n        this._hullTri = new Uint32Array(n); // edge to adjacent triangle\r\n        this._hullHash = new Int32Array(this._hashSize).fill(-1); // angular edge hash\r\n\r\n        // temporary arrays for sorting points\r\n        this._ids = new Uint32Array(n);\r\n        this._dists = new Float64Array(n);\r\n\r\n        this.update();\r\n    }\r\n\r\n    update() {\r\n        const {coords, _hullPrev: hullPrev, _hullNext: hullNext, _hullTri: hullTri, _hullHash: hullHash} =  this;\r\n        const n = coords.length >> 1;\r\n\r\n        // populate an array of point indices; calculate input data bbox\r\n        let minX = Infinity;\r\n        let minY = Infinity;\r\n        let maxX = -Infinity;\r\n        let maxY = -Infinity;\r\n\r\n        for (let i = 0; i < n; i++) {\r\n            const x = coords[2 * i];\r\n            const y = coords[2 * i + 1];\r\n            if (x < minX) minX = x;\r\n            if (y < minY) minY = y;\r\n            if (x > maxX) maxX = x;\r\n            if (y > maxY) maxY = y;\r\n            this._ids[i] = i;\r\n        }\r\n        const cx = (minX + maxX) / 2;\r\n        const cy = (minY + maxY) / 2;\r\n\r\n        let minDist = Infinity;\r\n        let i0, i1, i2;\r\n\r\n        // pick a seed point close to the center\r\n        for (let i = 0; i < n; i++) {\r\n            const d = dist(cx, cy, coords[2 * i], coords[2 * i + 1]);\r\n            if (d < minDist) {\r\n                i0 = i;\r\n                minDist = d;\r\n            }\r\n        }\r\n        const i0x = coords[2 * i0];\r\n        const i0y = coords[2 * i0 + 1];\r\n\r\n        minDist = Infinity;\r\n\r\n        // find the point closest to the seed\r\n        for (let i = 0; i < n; i++) {\r\n            if (i === i0) continue;\r\n            const d = dist(i0x, i0y, coords[2 * i], coords[2 * i + 1]);\r\n            if (d < minDist && d > 0) {\r\n                i1 = i;\r\n                minDist = d;\r\n            }\r\n        }\r\n        let i1x = coords[2 * i1];\r\n        let i1y = coords[2 * i1 + 1];\r\n\r\n        let minRadius = Infinity;\r\n\r\n        // find the third point which forms the smallest circumcircle with the first two\r\n        for (let i = 0; i < n; i++) {\r\n            if (i === i0 || i === i1) continue;\r\n            const r = circumradius(i0x, i0y, i1x, i1y, coords[2 * i], coords[2 * i + 1]);\r\n            if (r < minRadius) {\r\n                i2 = i;\r\n                minRadius = r;\r\n            }\r\n        }\r\n        let i2x = coords[2 * i2];\r\n        let i2y = coords[2 * i2 + 1];\r\n\r\n        if (minRadius === Infinity) {\r\n            // order collinear points by dx (or dy if all x are identical)\r\n            // and return the list as a hull\r\n            for (let i = 0; i < n; i++) {\r\n                this._dists[i] = (coords[2 * i] - coords[0]) || (coords[2 * i + 1] - coords[1]);\r\n            }\r\n            quicksort(this._ids, this._dists, 0, n - 1);\r\n            const hull = new Uint32Array(n);\r\n            let j = 0;\r\n            for (let i = 0, d0 = -Infinity; i < n; i++) {\r\n                const id = this._ids[i];\r\n                if (this._dists[id] > d0) {\r\n                    hull[j++] = id;\r\n                    d0 = this._dists[id];\r\n                }\r\n            }\r\n            this.hull = hull.subarray(0, j);\r\n            this.triangles = new Uint32Array(0);\r\n            this.halfedges = new Uint32Array(0);\r\n            return;\r\n        }\r\n\r\n        // swap the order of the seed points for counter-clockwise orientation\r\n        if (orient2d(i0x, i0y, i1x, i1y, i2x, i2y) < 0) {\r\n            const i = i1;\r\n            const x = i1x;\r\n            const y = i1y;\r\n            i1 = i2;\r\n            i1x = i2x;\r\n            i1y = i2y;\r\n            i2 = i;\r\n            i2x = x;\r\n            i2y = y;\r\n        }\r\n\r\n        const center = circumcenter(i0x, i0y, i1x, i1y, i2x, i2y);\r\n        this._cx = center.x;\r\n        this._cy = center.y;\r\n\r\n        for (let i = 0; i < n; i++) {\r\n            this._dists[i] = dist(coords[2 * i], coords[2 * i + 1], center.x, center.y);\r\n        }\r\n\r\n        // sort the points by distance from the seed triangle circumcenter\r\n        quicksort(this._ids, this._dists, 0, n - 1);\r\n\r\n        // set up the seed triangle as the starting hull\r\n        this._hullStart = i0;\r\n        let hullSize = 3;\r\n\r\n        hullNext[i0] = hullPrev[i2] = i1;\r\n        hullNext[i1] = hullPrev[i0] = i2;\r\n        hullNext[i2] = hullPrev[i1] = i0;\r\n\r\n        hullTri[i0] = 0;\r\n        hullTri[i1] = 1;\r\n        hullTri[i2] = 2;\r\n\r\n        hullHash.fill(-1);\r\n        hullHash[this._hashKey(i0x, i0y)] = i0;\r\n        hullHash[this._hashKey(i1x, i1y)] = i1;\r\n        hullHash[this._hashKey(i2x, i2y)] = i2;\r\n\r\n        this.trianglesLen = 0;\r\n        this._addTriangle(i0, i1, i2, -1, -1, -1);\r\n\r\n        for (let k = 0, xp, yp; k < this._ids.length; k++) {\r\n            const i = this._ids[k];\r\n            const x = coords[2 * i];\r\n            const y = coords[2 * i + 1];\r\n\r\n            // skip near-duplicate points\r\n            if (k > 0 && Math.abs(x - xp) <= EPSILON && Math.abs(y - yp) <= EPSILON) continue;\r\n            xp = x;\r\n            yp = y;\r\n\r\n            // skip seed triangle points\r\n            if (i === i0 || i === i1 || i === i2) continue;\r\n\r\n            // find a visible edge on the convex hull using edge hash\r\n            let start = 0;\r\n            for (let j = 0, key = this._hashKey(x, y); j < this._hashSize; j++) {\r\n                start = hullHash[(key + j) % this._hashSize];\r\n                if (start !== -1 && start !== hullNext[start]) break;\r\n            }\r\n\r\n            start = hullPrev[start];\r\n            let e = start, q;\r\n            while (q = hullNext[e], orient2d(x, y, coords[2 * e], coords[2 * e + 1], coords[2 * q], coords[2 * q + 1]) >= 0) {\r\n                e = q;\r\n                if (e === start) {\r\n                    e = -1;\r\n                    break;\r\n                }\r\n            }\r\n            if (e === -1) continue; // likely a near-duplicate point; skip it\r\n\r\n            // add the first triangle from the point\r\n            let t = this._addTriangle(e, i, hullNext[e], -1, -1, hullTri[e]);\r\n\r\n            // recursively flip triangles from the point until they satisfy the Delaunay condition\r\n            hullTri[i] = this._legalize(t + 2);\r\n            hullTri[e] = t; // keep track of boundary triangles on the hull\r\n            hullSize++;\r\n\r\n            // walk forward through the hull, adding more triangles and flipping recursively\r\n            let n = hullNext[e];\r\n            while (q = hullNext[n], orient2d(x, y, coords[2 * n], coords[2 * n + 1], coords[2 * q], coords[2 * q + 1]) < 0) {\r\n                t = this._addTriangle(n, i, q, hullTri[i], -1, hullTri[n]);\r\n                hullTri[i] = this._legalize(t + 2);\r\n                hullNext[n] = n; // mark as removed\r\n                hullSize--;\r\n                n = q;\r\n            }\r\n\r\n            // walk backward from the other side, adding more triangles and flipping\r\n            if (e === start) {\r\n                while (q = hullPrev[e], orient2d(x, y, coords[2 * q], coords[2 * q + 1], coords[2 * e], coords[2 * e + 1]) < 0) {\r\n                    t = this._addTriangle(q, i, e, -1, hullTri[e], hullTri[q]);\r\n                    this._legalize(t + 2);\r\n                    hullTri[q] = t;\r\n                    hullNext[e] = e; // mark as removed\r\n                    hullSize--;\r\n                    e = q;\r\n                }\r\n            }\r\n\r\n            // update the hull indices\r\n            this._hullStart = hullPrev[i] = e;\r\n            hullNext[e] = hullPrev[n] = i;\r\n            hullNext[i] = n;\r\n\r\n            // save the two new edges in the hash table\r\n            hullHash[this._hashKey(x, y)] = i;\r\n            hullHash[this._hashKey(coords[2 * e], coords[2 * e + 1])] = e;\r\n        }\r\n\r\n        this.hull = new Uint32Array(hullSize);\r\n        for (let i = 0, e = this._hullStart; i < hullSize; i++) {\r\n            this.hull[i] = e;\r\n            e = hullNext[e];\r\n        }\r\n\r\n        // trim typed triangle mesh arrays\r\n        this.triangles = this._triangles.subarray(0, this.trianglesLen);\r\n        this.halfedges = this._halfedges.subarray(0, this.trianglesLen);\r\n    }\r\n\r\n    _hashKey(x, y) {\r\n        return Math.floor(pseudoAngle(x - this._cx, y - this._cy) * this._hashSize) % this._hashSize;\r\n    }\r\n\r\n    _legalize(a) {\r\n        const {_triangles: triangles, _halfedges: halfedges, coords} = this;\r\n\r\n        let i = 0;\r\n        let ar = 0;\r\n\r\n        // recursion eliminated with a fixed-size stack\r\n        while (true) {\r\n            const b = halfedges[a];\r\n\r\n            /* if the pair of triangles doesn't satisfy the Delaunay condition\r\n             * (p1 is inside the circumcircle of [p0, pl, pr]), flip them,\r\n             * then do the same check/flip recursively for the new pair of triangles\r\n             *\r\n             *           pl                    pl\r\n             *          /||\\                  /  \\\r\n             *       al/ || \\bl            al/    \\a\r\n             *        /  ||  \\              /      \\\r\n             *       /  a||b  \\    flip    /___ar___\\\r\n             *     p0\\   ||   /p1   =>   p0\\---bl---/p1\r\n             *        \\  ||  /              \\      /\r\n             *       ar\\ || /br             b\\    /br\r\n             *          \\||/                  \\  /\r\n             *           pr                    pr\r\n             */\r\n            const a0 = a - a % 3;\r\n            ar = a0 + (a + 2) % 3;\r\n\r\n            if (b === -1) { // convex hull edge\r\n                if (i === 0) break;\r\n                a = EDGE_STACK[--i];\r\n                continue;\r\n            }\r\n\r\n            const b0 = b - b % 3;\r\n            const al = a0 + (a + 1) % 3;\r\n            const bl = b0 + (b + 2) % 3;\r\n\r\n            const p0 = triangles[ar];\r\n            const pr = triangles[a];\r\n            const pl = triangles[al];\r\n            const p1 = triangles[bl];\r\n\r\n            const illegal = inCircle(\r\n                coords[2 * p0], coords[2 * p0 + 1],\r\n                coords[2 * pr], coords[2 * pr + 1],\r\n                coords[2 * pl], coords[2 * pl + 1],\r\n                coords[2 * p1], coords[2 * p1 + 1]);\r\n\r\n            if (illegal) {\r\n                triangles[a] = p1;\r\n                triangles[b] = p0;\r\n\r\n                const hbl = halfedges[bl];\r\n\r\n                // edge swapped on the other side of the hull (rare); fix the halfedge reference\r\n                if (hbl === -1) {\r\n                    let e = this._hullStart;\r\n                    do {\r\n                        if (this._hullTri[e] === bl) {\r\n                            this._hullTri[e] = a;\r\n                            break;\r\n                        }\r\n                        e = this._hullPrev[e];\r\n                    } while (e !== this._hullStart);\r\n                }\r\n                this._link(a, hbl);\r\n                this._link(b, halfedges[ar]);\r\n                this._link(ar, bl);\r\n\r\n                const br = b0 + (b + 1) % 3;\r\n\r\n                // don't worry about hitting the cap: it can only happen on extremely degenerate input\r\n                if (i < EDGE_STACK.length) {\r\n                    EDGE_STACK[i++] = br;\r\n                }\r\n            } else {\r\n                if (i === 0) break;\r\n                a = EDGE_STACK[--i];\r\n            }\r\n        }\r\n\r\n        return ar;\r\n    }\r\n\r\n    _link(a, b) {\r\n        this._halfedges[a] = b;\r\n        if (b !== -1) this._halfedges[b] = a;\r\n    }\r\n\r\n    // add a new triangle given vertex indices and adjacent half-edge ids\r\n    _addTriangle(i0, i1, i2, a, b, c) {\r\n        const t = this.trianglesLen;\r\n\r\n        this._triangles[t] = i0;\r\n        this._triangles[t + 1] = i1;\r\n        this._triangles[t + 2] = i2;\r\n\r\n        this._link(t, a);\r\n        this._link(t + 1, b);\r\n        this._link(t + 2, c);\r\n\r\n        this.trianglesLen += 3;\r\n\r\n        return t;\r\n    }\r\n}\r\n\r\n// monotonically increases with real angle, but doesn't need expensive trigonometry\r\nfunction pseudoAngle(dx, dy) {\r\n    const p = dx / (Math.abs(dx) + Math.abs(dy));\r\n    return (dy > 0 ? 3 - p : 1 + p) / 4; // [0..1]\r\n}\r\n\r\nfunction dist(ax, ay, bx, by) {\r\n    const dx = ax - bx;\r\n    const dy = ay - by;\r\n    return dx * dx + dy * dy;\r\n}\r\n\r\nfunction inCircle(ax, ay, bx, by, cx, cy, px, py) {\r\n    const dx = ax - px;\r\n    const dy = ay - py;\r\n    const ex = bx - px;\r\n    const ey = by - py;\r\n    const fx = cx - px;\r\n    const fy = cy - py;\r\n\r\n    const ap = dx * dx + dy * dy;\r\n    const bp = ex * ex + ey * ey;\r\n    const cp = fx * fx + fy * fy;\r\n\r\n    return dx * (ey * cp - bp * fy) -\r\n           dy * (ex * cp - bp * fx) +\r\n           ap * (ex * fy - ey * fx) < 0;\r\n}\r\n\r\nfunction circumradius(ax, ay, bx, by, cx, cy) {\r\n    const dx = bx - ax;\r\n    const dy = by - ay;\r\n    const ex = cx - ax;\r\n    const ey = cy - ay;\r\n\r\n    const bl = dx * dx + dy * dy;\r\n    const cl = ex * ex + ey * ey;\r\n    const d = 0.5 / (dx * ey - dy * ex);\r\n\r\n    const x = (ey * bl - dy * cl) * d;\r\n    const y = (dx * cl - ex * bl) * d;\r\n\r\n    return x * x + y * y;\r\n}\r\n\r\nfunction circumcenter(ax, ay, bx, by, cx, cy) {\r\n    const dx = bx - ax;\r\n    const dy = by - ay;\r\n    const ex = cx - ax;\r\n    const ey = cy - ay;\r\n\r\n    const bl = dx * dx + dy * dy;\r\n    const cl = ex * ex + ey * ey;\r\n    const d = 0.5 / (dx * ey - dy * ex);\r\n\r\n    const x = ax + (ey * bl - dy * cl) * d;\r\n    const y = ay + (dx * cl - ex * bl) * d;\r\n\r\n    return {x, y};\r\n}\r\n\r\nfunction quicksort(ids, dists, left, right) {\r\n    if (right - left <= 20) {\r\n        for (let i = left + 1; i <= right; i++) {\r\n            const temp = ids[i];\r\n            const tempDist = dists[temp];\r\n            let j = i - 1;\r\n            while (j >= left && dists[ids[j]] > tempDist) ids[j + 1] = ids[j--];\r\n            ids[j + 1] = temp;\r\n        }\r\n    } else {\r\n        const median = (left + right) >> 1;\r\n        let i = left + 1;\r\n        let j = right;\r\n        swap(ids, median, i);\r\n        if (dists[ids[left]] > dists[ids[right]]) swap(ids, left, right);\r\n        if (dists[ids[i]] > dists[ids[right]]) swap(ids, i, right);\r\n        if (dists[ids[left]] > dists[ids[i]]) swap(ids, left, i);\r\n\r\n        const temp = ids[i];\r\n        const tempDist = dists[temp];\r\n        while (true) {\r\n            do i++; while (dists[ids[i]] < tempDist);\r\n            do j--; while (dists[ids[j]] > tempDist);\r\n            if (j < i) break;\r\n            swap(ids, i, j);\r\n        }\r\n        ids[left + 1] = ids[j];\r\n        ids[j] = temp;\r\n\r\n        if (right - i + 1 >= j - left) {\r\n            quicksort(ids, dists, i, right);\r\n            quicksort(ids, dists, left, j - 1);\r\n        } else {\r\n            quicksort(ids, dists, left, j - 1);\r\n            quicksort(ids, dists, i, right);\r\n        }\r\n    }\r\n}\r\n\r\nfunction swap(arr, i, j) {\r\n    const tmp = arr[i];\r\n    arr[i] = arr[j];\r\n    arr[j] = tmp;\r\n}\r\n\r\nfunction defaultGetX(p) {\r\n    return p[0];\r\n}\r\nfunction defaultGetY(p) {\r\n    return p[1];\r\n}\r\n\r\nconst epsilon$1 = 1e-6;\r\n\r\nclass Path {\r\n  constructor() {\r\n    this._x0 = this._y0 = // start of current subpath\r\n    this._x1 = this._y1 = null; // end of current subpath\r\n    this._ = \"\";\r\n  }\r\n  moveTo(x, y) {\r\n    this._ += `M${this._x0 = this._x1 = +x},${this._y0 = this._y1 = +y}`;\r\n  }\r\n  closePath() {\r\n    if (this._x1 !== null) {\r\n      this._x1 = this._x0, this._y1 = this._y0;\r\n      this._ += \"Z\";\r\n    }\r\n  }\r\n  lineTo(x, y) {\r\n    this._ += `L${this._x1 = +x},${this._y1 = +y}`;\r\n  }\r\n  arc(x, y, r) {\r\n    x = +x, y = +y, r = +r;\r\n    const x0 = x + r;\r\n    const y0 = y;\r\n    if (r < 0) throw new Error(\"negative radius\");\r\n    if (this._x1 === null) this._ += `M${x0},${y0}`;\r\n    else if (Math.abs(this._x1 - x0) > epsilon$1 || Math.abs(this._y1 - y0) > epsilon$1) this._ += \"L\" + x0 + \",\" + y0;\r\n    if (!r) return;\r\n    this._ += `A${r},${r},0,1,1,${x - r},${y}A${r},${r},0,1,1,${this._x1 = x0},${this._y1 = y0}`;\r\n  }\r\n  rect(x, y, w, h) {\r\n    this._ += `M${this._x0 = this._x1 = +x},${this._y0 = this._y1 = +y}h${+w}v${+h}h${-w}Z`;\r\n  }\r\n  value() {\r\n    return this._ || null;\r\n  }\r\n}\r\n\r\nclass Polygon {\r\n  constructor() {\r\n    this._ = [];\r\n  }\r\n  moveTo(x, y) {\r\n    this._.push([x, y]);\r\n  }\r\n  closePath() {\r\n    this._.push(this._[0].slice());\r\n  }\r\n  lineTo(x, y) {\r\n    this._.push([x, y]);\r\n  }\r\n  value() {\r\n    return this._.length ? this._ : null;\r\n  }\r\n}\r\n\r\nclass Voronoi {\r\n  constructor(delaunay, [xmin, ymin, xmax, ymax] = [0, 0, 960, 500]) {\r\n    if (!((xmax = +xmax) >= (xmin = +xmin)) || !((ymax = +ymax) >= (ymin = +ymin))) throw new Error(\"invalid bounds\");\r\n    this.delaunay = delaunay;\r\n    this._circumcenters = new Float64Array(delaunay.points.length * 2);\r\n    this.vectors = new Float64Array(delaunay.points.length * 2);\r\n    this.xmax = xmax, this.xmin = xmin;\r\n    this.ymax = ymax, this.ymin = ymin;\r\n    this._init();\r\n  }\r\n  update() {\r\n    this.delaunay.update();\r\n    this._init();\r\n    return this;\r\n  }\r\n  _init() {\r\n    const {delaunay: {points, hull, triangles}, vectors} = this;\r\n\r\n    // Compute circumcenters.\r\n    const circumcenters = this.circumcenters = this._circumcenters.subarray(0, triangles.length / 3 * 2);\r\n    for (let i = 0, j = 0, n = triangles.length, x, y; i < n; i += 3, j += 2) {\r\n      const t1 = triangles[i] * 2;\r\n      const t2 = triangles[i + 1] * 2;\r\n      const t3 = triangles[i + 2] * 2;\r\n      const x1 = points[t1];\r\n      const y1 = points[t1 + 1];\r\n      const x2 = points[t2];\r\n      const y2 = points[t2 + 1];\r\n      const x3 = points[t3];\r\n      const y3 = points[t3 + 1];\r\n\r\n      const dx = x2 - x1;\r\n      const dy = y2 - y1;\r\n      const ex = x3 - x1;\r\n      const ey = y3 - y1;\r\n      const ab = (dx * ey - dy * ex) * 2;\r\n\r\n      if (Math.abs(ab) < 1e-9) {\r\n        // degenerate case (collinear diagram)\r\n        // almost equal points (degenerate triangle)\r\n        // the circumcenter is at the infinity, in a\r\n        // direction that is:\r\n        // 1. orthogonal to the halfedge.\r\n        let a = 1e9;\r\n        // 2. points away from the center; since the list of triangles starts\r\n        // in the center, the first point of the first triangle\r\n        // will be our reference\r\n        const r = triangles[0] * 2;\r\n        a *= Math.sign((points[r] - x1) * ey - (points[r + 1] - y1) * ex);\r\n        x = (x1 + x3) / 2 - a * ey;\r\n        y = (y1 + y3) / 2 + a * ex;\r\n      } else {\r\n        const d = 1 / ab;\r\n        const bl = dx * dx + dy * dy;\r\n        const cl = ex * ex + ey * ey;\r\n        x = x1 + (ey * bl - dy * cl) * d;\r\n        y = y1 + (dx * cl - ex * bl) * d;\r\n      }\r\n      circumcenters[j] = x;\r\n      circumcenters[j + 1] = y;\r\n    }\r\n\r\n    // Compute exterior cell rays.\r\n    let h = hull[hull.length - 1];\r\n    let p0, p1 = h * 4;\r\n    let x0, x1 = points[2 * h];\r\n    let y0, y1 = points[2 * h + 1];\r\n    vectors.fill(0);\r\n    for (let i = 0; i < hull.length; ++i) {\r\n      h = hull[i];\r\n      p0 = p1, x0 = x1, y0 = y1;\r\n      p1 = h * 4, x1 = points[2 * h], y1 = points[2 * h + 1];\r\n      vectors[p0 + 2] = vectors[p1] = y0 - y1;\r\n      vectors[p0 + 3] = vectors[p1 + 1] = x1 - x0;\r\n    }\r\n  }\r\n  render(context) {\r\n    const buffer = context == null ? context = new Path : undefined;\r\n    const {delaunay: {halfedges, inedges, hull}, circumcenters, vectors} = this;\r\n    if (hull.length <= 1) return null;\r\n    for (let i = 0, n = halfedges.length; i < n; ++i) {\r\n      const j = halfedges[i];\r\n      if (j < i) continue;\r\n      const ti = Math.floor(i / 3) * 2;\r\n      const tj = Math.floor(j / 3) * 2;\r\n      const xi = circumcenters[ti];\r\n      const yi = circumcenters[ti + 1];\r\n      const xj = circumcenters[tj];\r\n      const yj = circumcenters[tj + 1];\r\n      this._renderSegment(xi, yi, xj, yj, context);\r\n    }\r\n    let h0, h1 = hull[hull.length - 1];\r\n    for (let i = 0; i < hull.length; ++i) {\r\n      h0 = h1, h1 = hull[i];\r\n      const t = Math.floor(inedges[h1] / 3) * 2;\r\n      const x = circumcenters[t];\r\n      const y = circumcenters[t + 1];\r\n      const v = h0 * 4;\r\n      const p = this._project(x, y, vectors[v + 2], vectors[v + 3]);\r\n      if (p) this._renderSegment(x, y, p[0], p[1], context);\r\n    }\r\n    return buffer && buffer.value();\r\n  }\r\n  renderBounds(context) {\r\n    const buffer = context == null ? context = new Path : undefined;\r\n    context.rect(this.xmin, this.ymin, this.xmax - this.xmin, this.ymax - this.ymin);\r\n    return buffer && buffer.value();\r\n  }\r\n  renderCell(i, context) {\r\n    const buffer = context == null ? context = new Path : undefined;\r\n    const points = this._clip(i);\r\n    if (points === null || !points.length) return;\r\n    context.moveTo(points[0], points[1]);\r\n    let n = points.length;\r\n    while (points[0] === points[n-2] && points[1] === points[n-1] && n > 1) n -= 2;\r\n    for (let i = 2; i < n; i += 2) {\r\n      if (points[i] !== points[i-2] || points[i+1] !== points[i-1])\r\n        context.lineTo(points[i], points[i + 1]);\r\n    }\r\n    context.closePath();\r\n    return buffer && buffer.value();\r\n  }\r\n  *cellPolygons() {\r\n    const {delaunay: {points}} = this;\r\n    for (let i = 0, n = points.length / 2; i < n; ++i) {\r\n      const cell = this.cellPolygon(i);\r\n      if (cell) cell.index = i, yield cell;\r\n    }\r\n  }\r\n  cellPolygon(i) {\r\n    const polygon = new Polygon;\r\n    this.renderCell(i, polygon);\r\n    return polygon.value();\r\n  }\r\n  _renderSegment(x0, y0, x1, y1, context) {\r\n    let S;\r\n    const c0 = this._regioncode(x0, y0);\r\n    const c1 = this._regioncode(x1, y1);\r\n    if (c0 === 0 && c1 === 0) {\r\n      context.moveTo(x0, y0);\r\n      context.lineTo(x1, y1);\r\n    } else if (S = this._clipSegment(x0, y0, x1, y1, c0, c1)) {\r\n      context.moveTo(S[0], S[1]);\r\n      context.lineTo(S[2], S[3]);\r\n    }\r\n  }\r\n  contains(i, x, y) {\r\n    if ((x = +x, x !== x) || (y = +y, y !== y)) return false;\r\n    return this.delaunay._step(i, x, y) === i;\r\n  }\r\n  *neighbors(i) {\r\n    const ci = this._clip(i);\r\n    if (ci) for (const j of this.delaunay.neighbors(i)) {\r\n      const cj = this._clip(j);\r\n      // find the common edge\r\n      if (cj) loop: for (let ai = 0, li = ci.length; ai < li; ai += 2) {\r\n        for (let aj = 0, lj = cj.length; aj < lj; aj += 2) {\r\n          if (ci[ai] == cj[aj]\r\n          && ci[ai + 1] == cj[aj + 1]\r\n          && ci[(ai + 2) % li] == cj[(aj + lj - 2) % lj]\r\n          && ci[(ai + 3) % li] == cj[(aj + lj - 1) % lj]\r\n          ) {\r\n            yield j;\r\n            break loop;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  _cell(i) {\r\n    const {circumcenters, delaunay: {inedges, halfedges, triangles}} = this;\r\n    const e0 = inedges[i];\r\n    if (e0 === -1) return null; // coincident point\r\n    const points = [];\r\n    let e = e0;\r\n    do {\r\n      const t = Math.floor(e / 3);\r\n      points.push(circumcenters[t * 2], circumcenters[t * 2 + 1]);\r\n      e = e % 3 === 2 ? e - 2 : e + 1;\r\n      if (triangles[e] !== i) break; // bad triangulation\r\n      e = halfedges[e];\r\n    } while (e !== e0 && e !== -1);\r\n    return points;\r\n  }\r\n  _clip(i) {\r\n    // degenerate case (1 valid point: return the box)\r\n    if (i === 0 && this.delaunay.hull.length === 1) {\r\n      return [this.xmax, this.ymin, this.xmax, this.ymax, this.xmin, this.ymax, this.xmin, this.ymin];\r\n    }\r\n    const points = this._cell(i);\r\n    if (points === null) return null;\r\n    const {vectors: V} = this;\r\n    const v = i * 4;\r\n    return V[v] || V[v + 1]\r\n        ? this._clipInfinite(i, points, V[v], V[v + 1], V[v + 2], V[v + 3])\r\n        : this._clipFinite(i, points);\r\n  }\r\n  _clipFinite(i, points) {\r\n    const n = points.length;\r\n    let P = null;\r\n    let x0, y0, x1 = points[n - 2], y1 = points[n - 1];\r\n    let c0, c1 = this._regioncode(x1, y1);\r\n    let e0, e1 = 0;\r\n    for (let j = 0; j < n; j += 2) {\r\n      x0 = x1, y0 = y1, x1 = points[j], y1 = points[j + 1];\r\n      c0 = c1, c1 = this._regioncode(x1, y1);\r\n      if (c0 === 0 && c1 === 0) {\r\n        e0 = e1, e1 = 0;\r\n        if (P) P.push(x1, y1);\r\n        else P = [x1, y1];\r\n      } else {\r\n        let S, sx0, sy0, sx1, sy1;\r\n        if (c0 === 0) {\r\n          if ((S = this._clipSegment(x0, y0, x1, y1, c0, c1)) === null) continue;\r\n          [sx0, sy0, sx1, sy1] = S;\r\n        } else {\r\n          if ((S = this._clipSegment(x1, y1, x0, y0, c1, c0)) === null) continue;\r\n          [sx1, sy1, sx0, sy0] = S;\r\n          e0 = e1, e1 = this._edgecode(sx0, sy0);\r\n          if (e0 && e1) this._edge(i, e0, e1, P, P.length);\r\n          if (P) P.push(sx0, sy0);\r\n          else P = [sx0, sy0];\r\n        }\r\n        e0 = e1, e1 = this._edgecode(sx1, sy1);\r\n        if (e0 && e1) this._edge(i, e0, e1, P, P.length);\r\n        if (P) P.push(sx1, sy1);\r\n        else P = [sx1, sy1];\r\n      }\r\n    }\r\n    if (P) {\r\n      e0 = e1, e1 = this._edgecode(P[0], P[1]);\r\n      if (e0 && e1) this._edge(i, e0, e1, P, P.length);\r\n    } else if (this.contains(i, (this.xmin + this.xmax) / 2, (this.ymin + this.ymax) / 2)) {\r\n      return [this.xmax, this.ymin, this.xmax, this.ymax, this.xmin, this.ymax, this.xmin, this.ymin];\r\n    }\r\n    return P;\r\n  }\r\n  _clipSegment(x0, y0, x1, y1, c0, c1) {\r\n    while (true) {\r\n      if (c0 === 0 && c1 === 0) return [x0, y0, x1, y1];\r\n      if (c0 & c1) return null;\r\n      let x, y, c = c0 || c1;\r\n      if (c & 0b1000) x = x0 + (x1 - x0) * (this.ymax - y0) / (y1 - y0), y = this.ymax;\r\n      else if (c & 0b0100) x = x0 + (x1 - x0) * (this.ymin - y0) / (y1 - y0), y = this.ymin;\r\n      else if (c & 0b0010) y = y0 + (y1 - y0) * (this.xmax - x0) / (x1 - x0), x = this.xmax;\r\n      else y = y0 + (y1 - y0) * (this.xmin - x0) / (x1 - x0), x = this.xmin;\r\n      if (c0) x0 = x, y0 = y, c0 = this._regioncode(x0, y0);\r\n      else x1 = x, y1 = y, c1 = this._regioncode(x1, y1);\r\n    }\r\n  }\r\n  _clipInfinite(i, points, vx0, vy0, vxn, vyn) {\r\n    let P = Array.from(points), p;\r\n    if (p = this._project(P[0], P[1], vx0, vy0)) P.unshift(p[0], p[1]);\r\n    if (p = this._project(P[P.length - 2], P[P.length - 1], vxn, vyn)) P.push(p[0], p[1]);\r\n    if (P = this._clipFinite(i, P)) {\r\n      for (let j = 0, n = P.length, c0, c1 = this._edgecode(P[n - 2], P[n - 1]); j < n; j += 2) {\r\n        c0 = c1, c1 = this._edgecode(P[j], P[j + 1]);\r\n        if (c0 && c1) j = this._edge(i, c0, c1, P, j), n = P.length;\r\n      }\r\n    } else if (this.contains(i, (this.xmin + this.xmax) / 2, (this.ymin + this.ymax) / 2)) {\r\n      P = [this.xmin, this.ymin, this.xmax, this.ymin, this.xmax, this.ymax, this.xmin, this.ymax];\r\n    }\r\n    return P;\r\n  }\r\n  _edge(i, e0, e1, P, j) {\r\n    while (e0 !== e1) {\r\n      let x, y;\r\n      switch (e0) {\r\n        case 0b0101: e0 = 0b0100; continue; // top-left\r\n        case 0b0100: e0 = 0b0110, x = this.xmax, y = this.ymin; break; // top\r\n        case 0b0110: e0 = 0b0010; continue; // top-right\r\n        case 0b0010: e0 = 0b1010, x = this.xmax, y = this.ymax; break; // right\r\n        case 0b1010: e0 = 0b1000; continue; // bottom-right\r\n        case 0b1000: e0 = 0b1001, x = this.xmin, y = this.ymax; break; // bottom\r\n        case 0b1001: e0 = 0b0001; continue; // bottom-left\r\n        case 0b0001: e0 = 0b0101, x = this.xmin, y = this.ymin; break; // left\r\n      }\r\n      // Note: this implicitly checks for out of bounds: if P[j] or P[j+1] are\r\n      // undefined, the conditional statement will be executed.\r\n      if ((P[j] !== x || P[j + 1] !== y) && this.contains(i, x, y)) {\r\n        P.splice(j, 0, x, y), j += 2;\r\n      }\r\n    }\r\n    if (P.length > 4) {\r\n      for (let i = 0; i < P.length; i+= 2) {\r\n        const j = (i + 2) % P.length, k = (i + 4) % P.length;\r\n        if (P[i] === P[j] && P[j] === P[k]\r\n        || P[i + 1] === P[j + 1] && P[j + 1] === P[k + 1])\r\n          P.splice(j, 2), i -= 2;\r\n      }\r\n    }\r\n    return j;\r\n  }\r\n  _project(x0, y0, vx, vy) {\r\n    let t = Infinity, c, x, y;\r\n    if (vy < 0) { // top\r\n      if (y0 <= this.ymin) return null;\r\n      if ((c = (this.ymin - y0) / vy) < t) y = this.ymin, x = x0 + (t = c) * vx;\r\n    } else if (vy > 0) { // bottom\r\n      if (y0 >= this.ymax) return null;\r\n      if ((c = (this.ymax - y0) / vy) < t) y = this.ymax, x = x0 + (t = c) * vx;\r\n    }\r\n    if (vx > 0) { // right\r\n      if (x0 >= this.xmax) return null;\r\n      if ((c = (this.xmax - x0) / vx) < t) x = this.xmax, y = y0 + (t = c) * vy;\r\n    } else if (vx < 0) { // left\r\n      if (x0 <= this.xmin) return null;\r\n      if ((c = (this.xmin - x0) / vx) < t) x = this.xmin, y = y0 + (t = c) * vy;\r\n    }\r\n    return [x, y];\r\n  }\r\n  _edgecode(x, y) {\r\n    return (x === this.xmin ? 0b0001\r\n        : x === this.xmax ? 0b0010 : 0b0000)\r\n        | (y === this.ymin ? 0b0100\r\n        : y === this.ymax ? 0b1000 : 0b0000);\r\n  }\r\n  _regioncode(x, y) {\r\n    return (x < this.xmin ? 0b0001\r\n        : x > this.xmax ? 0b0010 : 0b0000)\r\n        | (y < this.ymin ? 0b0100\r\n        : y > this.ymax ? 0b1000 : 0b0000);\r\n  }\r\n}\r\n\r\nconst tau = 2 * Math.PI, pow = Math.pow;\r\n\r\nfunction pointX(p) {\r\n  return p[0];\r\n}\r\n\r\nfunction pointY(p) {\r\n  return p[1];\r\n}\r\n\r\n// A triangulation is collinear if all its triangles have a non-null area\r\nfunction collinear(d) {\r\n  const {triangles, coords} = d;\r\n  for (let i = 0; i < triangles.length; i += 3) {\r\n    const a = 2 * triangles[i],\r\n          b = 2 * triangles[i + 1],\r\n          c = 2 * triangles[i + 2],\r\n          cross = (coords[c] - coords[a]) * (coords[b + 1] - coords[a + 1])\r\n                - (coords[b] - coords[a]) * (coords[c + 1] - coords[a + 1]);\r\n    if (cross > 1e-10) return false;\r\n  }\r\n  return true;\r\n}\r\n\r\nfunction jitter(x, y, r) {\r\n  return [x + Math.sin(x + y) * r, y + Math.cos(x - y) * r];\r\n}\r\n\r\nclass Delaunay {\r\n  static from(points, fx = pointX, fy = pointY, that) {\r\n    return new Delaunay(\"length\" in points\r\n        ? flatArray(points, fx, fy, that)\r\n        : Float64Array.from(flatIterable(points, fx, fy, that)));\r\n  }\r\n  constructor(points) {\r\n    this._delaunator = new Delaunator(points);\r\n    this.inedges = new Int32Array(points.length / 2);\r\n    this._hullIndex = new Int32Array(points.length / 2);\r\n    this.points = this._delaunator.coords;\r\n    this._init();\r\n  }\r\n  update() {\r\n    this._delaunator.update();\r\n    this._init();\r\n    return this;\r\n  }\r\n  _init() {\r\n    const d = this._delaunator, points = this.points;\r\n\r\n    // check for collinear\r\n    if (d.hull && d.hull.length > 2 && collinear(d)) {\r\n      this.collinear = Int32Array.from({length: points.length/2}, (_,i) => i)\r\n        .sort((i, j) => points[2 * i] - points[2 * j] || points[2 * i + 1] - points[2 * j + 1]); // for exact neighbors\r\n      const e = this.collinear[0], f = this.collinear[this.collinear.length - 1],\r\n        bounds = [ points[2 * e], points[2 * e + 1], points[2 * f], points[2 * f + 1] ],\r\n        r = 1e-8 * Math.hypot(bounds[3] - bounds[1], bounds[2] - bounds[0]);\r\n      for (let i = 0, n = points.length / 2; i < n; ++i) {\r\n        const p = jitter(points[2 * i], points[2 * i + 1], r);\r\n        points[2 * i] = p[0];\r\n        points[2 * i + 1] = p[1];\r\n      }\r\n      this._delaunator = new Delaunator(points);\r\n    } else {\r\n      delete this.collinear;\r\n    }\r\n\r\n    const halfedges = this.halfedges = this._delaunator.halfedges;\r\n    const hull = this.hull = this._delaunator.hull;\r\n    const triangles = this.triangles = this._delaunator.triangles;\r\n    const inedges = this.inedges.fill(-1);\r\n    const hullIndex = this._hullIndex.fill(-1);\r\n\r\n    // Compute an index from each point to an (arbitrary) incoming halfedge\r\n    // Used to give the first neighbor of each point; for this reason,\r\n    // on the hull we give priority to exterior halfedges\r\n    for (let e = 0, n = halfedges.length; e < n; ++e) {\r\n      const p = triangles[e % 3 === 2 ? e - 2 : e + 1];\r\n      if (halfedges[e] === -1 || inedges[p] === -1) inedges[p] = e;\r\n    }\r\n    for (let i = 0, n = hull.length; i < n; ++i) {\r\n      hullIndex[hull[i]] = i;\r\n    }\r\n\r\n    // degenerate case: 1 or 2 (distinct) points\r\n    if (hull.length <= 2 && hull.length > 0) {\r\n      this.triangles = new Int32Array(3).fill(-1);\r\n      this.halfedges = new Int32Array(3).fill(-1);\r\n      this.triangles[0] = hull[0];\r\n      inedges[hull[0]] = 1;\r\n      if (hull.length === 2) {\r\n        inedges[hull[1]] = 0;\r\n        this.triangles[1] = hull[1];\r\n        this.triangles[2] = hull[1];\r\n      }\r\n    }\r\n  }\r\n  voronoi(bounds) {\r\n    return new Voronoi(this, bounds);\r\n  }\r\n  *neighbors(i) {\r\n    const {inedges, hull, _hullIndex, halfedges, triangles, collinear} = this;\r\n\r\n    // degenerate case with several collinear points\r\n    if (collinear) {\r\n      const l = collinear.indexOf(i);\r\n      if (l > 0) yield collinear[l - 1];\r\n      if (l < collinear.length - 1) yield collinear[l + 1];\r\n      return;\r\n    }\r\n\r\n    const e0 = inedges[i];\r\n    if (e0 === -1) return; // coincident point\r\n    let e = e0, p0 = -1;\r\n    do {\r\n      yield p0 = triangles[e];\r\n      e = e % 3 === 2 ? e - 2 : e + 1;\r\n      if (triangles[e] !== i) return; // bad triangulation\r\n      e = halfedges[e];\r\n      if (e === -1) {\r\n        const p = hull[(_hullIndex[i] + 1) % hull.length];\r\n        if (p !== p0) yield p;\r\n        return;\r\n      }\r\n    } while (e !== e0);\r\n  }\r\n  find(x, y, i = 0) {\r\n    if ((x = +x, x !== x) || (y = +y, y !== y)) return -1;\r\n    const i0 = i;\r\n    let c;\r\n    while ((c = this._step(i, x, y)) >= 0 && c !== i && c !== i0) i = c;\r\n    return c;\r\n  }\r\n  _step(i, x, y) {\r\n    const {inedges, hull, _hullIndex, halfedges, triangles, points} = this;\r\n    if (inedges[i] === -1 || !points.length) return (i + 1) % (points.length >> 1);\r\n    let c = i;\r\n    let dc = pow(x - points[i * 2], 2) + pow(y - points[i * 2 + 1], 2);\r\n    const e0 = inedges[i];\r\n    let e = e0;\r\n    do {\r\n      let t = triangles[e];\r\n      const dt = pow(x - points[t * 2], 2) + pow(y - points[t * 2 + 1], 2);\r\n      if (dt < dc) dc = dt, c = t;\r\n      e = e % 3 === 2 ? e - 2 : e + 1;\r\n      if (triangles[e] !== i) break; // bad triangulation\r\n      e = halfedges[e];\r\n      if (e === -1) {\r\n        e = hull[(_hullIndex[i] + 1) % hull.length];\r\n        if (e !== t) {\r\n          if (pow(x - points[e * 2], 2) + pow(y - points[e * 2 + 1], 2) < dc) return e;\r\n        }\r\n        break;\r\n      }\r\n    } while (e !== e0);\r\n    return c;\r\n  }\r\n  render(context) {\r\n    const buffer = context == null ? context = new Path : undefined;\r\n    const {points, halfedges, triangles} = this;\r\n    for (let i = 0, n = halfedges.length; i < n; ++i) {\r\n      const j = halfedges[i];\r\n      if (j < i) continue;\r\n      const ti = triangles[i] * 2;\r\n      const tj = triangles[j] * 2;\r\n      context.moveTo(points[ti], points[ti + 1]);\r\n      context.lineTo(points[tj], points[tj + 1]);\r\n    }\r\n    this.renderHull(context);\r\n    return buffer && buffer.value();\r\n  }\r\n  renderPoints(context, r) {\r\n    if (r === undefined && (!context || typeof context.moveTo !== \"function\")) r = context, context = null;\r\n    r = r == undefined ? 2 : +r;\r\n    const buffer = context == null ? context = new Path : undefined;\r\n    const {points} = this;\r\n    for (let i = 0, n = points.length; i < n; i += 2) {\r\n      const x = points[i], y = points[i + 1];\r\n      context.moveTo(x + r, y);\r\n      context.arc(x, y, r, 0, tau);\r\n    }\r\n    return buffer && buffer.value();\r\n  }\r\n  renderHull(context) {\r\n    const buffer = context == null ? context = new Path : undefined;\r\n    const {hull, points} = this;\r\n    const h = hull[0] * 2, n = hull.length;\r\n    context.moveTo(points[h], points[h + 1]);\r\n    for (let i = 1; i < n; ++i) {\r\n      const h = 2 * hull[i];\r\n      context.lineTo(points[h], points[h + 1]);\r\n    }\r\n    context.closePath();\r\n    return buffer && buffer.value();\r\n  }\r\n  hullPolygon() {\r\n    const polygon = new Polygon;\r\n    this.renderHull(polygon);\r\n    return polygon.value();\r\n  }\r\n  renderTriangle(i, context) {\r\n    const buffer = context == null ? context = new Path : undefined;\r\n    const {points, triangles} = this;\r\n    const t0 = triangles[i *= 3] * 2;\r\n    const t1 = triangles[i + 1] * 2;\r\n    const t2 = triangles[i + 2] * 2;\r\n    context.moveTo(points[t0], points[t0 + 1]);\r\n    context.lineTo(points[t1], points[t1 + 1]);\r\n    context.lineTo(points[t2], points[t2 + 1]);\r\n    context.closePath();\r\n    return buffer && buffer.value();\r\n  }\r\n  *trianglePolygons() {\r\n    const {triangles} = this;\r\n    for (let i = 0, n = triangles.length / 3; i < n; ++i) {\r\n      yield this.trianglePolygon(i);\r\n    }\r\n  }\r\n  trianglePolygon(i) {\r\n    const polygon = new Polygon;\r\n    this.renderTriangle(i, polygon);\r\n    return polygon.value();\r\n  }\r\n}\r\n\r\nfunction flatArray(points, fx, fy, that) {\r\n  const n = points.length;\r\n  const array = new Float64Array(n * 2);\r\n  for (let i = 0; i < n; ++i) {\r\n    const p = points[i];\r\n    array[i * 2] = fx.call(that, p, i, points);\r\n    array[i * 2 + 1] = fy.call(that, p, i, points);\r\n  }\r\n  return array;\r\n}\r\n\r\nfunction* flatIterable(points, fx, fy, that) {\r\n  let i = 0;\r\n  for (const p of points) {\r\n    yield fx.call(that, p, i, points);\r\n    yield fy.call(that, p, i, points);\r\n    ++i;\r\n  }\r\n}\r\n\r\nexport { Delaunay, Voronoi };\r\n","/** @module */\r\n\r\n// import { polygonCentroid } from 'https://cdn.skypack.dev/d3-polygon@3'\r\nimport { polygonCentroid } from '../lib/snowpack/build/snowpack/pkg/d3-polygon.js'\r\n// import * as d3 from 'https://cdn.skypack.dev/d3@7'\r\nimport { Delaunay } from '../lib/snowpack/build/snowpack/pkg/d3-delaunay.js'\r\n/**\r\n * Calculate a voronoi diagram with some degree of equal capacity between voronoi cells.\r\n * Uses Lloyd's method.\r\n * @param {Number} w - number of discrete points wide of space to divide\r\n * @param {Number} h - number of points high\r\n * @param {Number} n - number of voronoi cells\r\n * @param {Number} tolFraction - fractional tolerance for relaxation. Maybe .01 is good.\r\n * @returns Centroids (list of points) and voronoi d3 object\r\n */\r\nexport default function lloydVoronoi(w, h, n, tolFraction) {\r\n    let centroids = randomPoints(w, h, n)\r\n    let converged = false\r\n    let voronoi\r\n    let polygons\r\n    const tol = tolFraction * Math.min(w, h)\r\n    for (let i = 0; i < 1000; i++) {\r\n        [centroids, converged, voronoi, polygons] = relax(centroids, w, h, tol)\r\n        if (converged) return centroids\r\n    }\r\n    return [centroids, voronoi, polygons]\r\n}\r\n\r\n// https://bl.ocks.org/veltman/3d1fb70e6993d4eb2eff7112c9e7bcf4\r\n\r\nfunction randomPoints(w, h, n) {\r\n    return Array(n).fill().map(() => [Math.random() * w, Math.random() * h])\r\n}\r\n\r\nfunction relax(points, w, h, tol) {\r\n    const delaunay = Delaunay.from(points)\r\n    const voronoi = delaunay.voronoi([0, 0, w, h])\r\n    const polygons = range(points.length).map((i) => voronoi.cellPolygon(i))\r\n    const centroids = polygons.map(polygonCentroid)\r\n    const converged = points.every((point, i) => distance2(point, centroids[i]) < tol)\r\n    return [centroids, converged, voronoi, polygons]\r\n}\r\n\r\n// function relax3(points, w, h) {\r\n//     const polygons = voronoi(points).polygons()\r\n//     polygons.map(d3.polygonCentroid)\r\n//     const converged = points.every((point, i) => distance2(point, centroids[i]) < 1)\r\n//     return { centroids, converged }\r\n// }\r\n\r\n// cellPolygons.prototype.map = function* (mapper, thisArg) {\r\n//     for (const val of this) {\r\n//         yield mapper.call(thisArg, val)\r\n//     }\r\n// }\r\n\r\nfunction distance2(x, y) {\r\n    return x ** 2 + y ** 2\r\n}\r\n\r\nfunction range(n) {\r\n    return [...Array(n).keys()]\r\n}\r\n","/**\r\n * Clips a polygon with another polygon to return a polygon.\r\n * Polygons must be counter-clockwise.\r\n * https://observablehq.com/@d3/polygonclip@1237\r\n * @param {Number[][]} clip - polygon\r\n * @param {Number[][]} subject - polygon, gets mutated\r\n * @returns {Number[][]} - polygon\r\n */\r\nexport default function polygonClip(clip, subject0) {\r\n    const closed = polygonClosed(subject0)\r\n    const n = clip.length - polygonClosed(clip)\r\n    const subject = subject0.slice() // copy before mutate\r\n    for (let i = 0, a = clip[n - 1], b, c, d; i < n; ++i) {\r\n        const input = subject.slice()\r\n        const m = input.length - closed\r\n        subject.length = 0\r\n        b = clip[i]\r\n        c = input[m - 1]\r\n        for (let j = 0; j < m; ++j) {\r\n            d = input[j]\r\n            if (lineOrient(d, a, b)) {\r\n                if (!lineOrient(c, a, b)) {\r\n                    subject.push(lineIntersect(c, d, a, b))\r\n                }\r\n                subject.push(d)\r\n            } else if (lineOrient(c, a, b)) {\r\n                subject.push(lineIntersect(c, d, a, b))\r\n            }\r\n            c = d\r\n        }\r\n        if (closed) subject.push(subject[0])\r\n        a = b\r\n    }\r\n    return subject.length ? subject : null\r\n}\r\nfunction lineOrient([px, py], [ax, ay], [bx, by]) {\r\n    return (bx - ax) * (py - ay) < (by - ay) * (px - ax)\r\n}\r\nfunction lineIntersect([ax, ay], [bx, by], [cx, cy], [dx, dy]) {\r\n    const bax = bx - ax; const bay = by - ay; const dcx = dx - cx; const\r\n        dcy = dy - cy\r\n    const k = (bax * (cy - ay) - bay * (cx - ax)) / (bay * dcx - bax * dcy)\r\n    return [cx + k * dcx, cy + k * dcy]\r\n}\r\nfunction polygonClosed(points) {\r\n    const [ax, ay] = points[0]; const\r\n        [bx, by] = points[points.length - 1]\r\n    return ax === bx && ay === by\r\n}\r\nexport function polygonConvex(points) {\r\n    const n = points.length\r\n    const [rx, ry] = points[n - 2]\r\n    let [qx, qy] = points[n - 1]\r\n    let vx = rx - qx; let\r\n        vy = ry - qy\r\n    for (let i = 0; i < n; ++i) {\r\n        const [px, py] = points[i]\r\n        const wx = qx - px; const\r\n            wy = qy - py\r\n        if (wx * vy < wy * vx) return false\r\n        if (wx || wy) {\r\n            vx = wx\r\n            vy = wy\r\n        }\r\n        qx = px\r\n        qy = py\r\n    }\r\n    return true\r\n}\r\n\r\nexport function testClip() {\r\n    const subject = [\r\n        [79, 200], [266, 100],\r\n        [452, 200],\r\n        [359, 450],\r\n        [172, 420]]\r\n    const clip = [[210, 90], [110, 400], [420, 400], [490, 250]]\r\n\r\n    return polygonClip(clip, subject)\r\n}\r\n","/** @module */\r\n\r\n// import _ from 'https://cdn.skypack.dev/lodash@4.17.21'\r\nimport { polygonArea } from '../lib/snowpack/build/snowpack/pkg/d3-polygon.js'\r\nimport polygonClip from '../lib/polygonClip.js'\r\nimport { range, jcopy } from '../utilities/jsHelpers.js'\r\n\r\n/**\r\n * What fraction of each tract lives in each district?\r\n * Return an array indexed by district.\r\n * Each element contains an array of pairs.\r\n * The first of the pair is a tract's pair of coordinates.\r\n * The second of the pair is the fraction of the tract within that district.\r\n * @param {DistrictMaker} districtMaker\r\n * @returns {Number[][][]} - an array of districts,\r\n * each with a list of census tract properties [x,y,overlap]\r\n */\r\nexport default function geoCensus(districtMaker) {\r\n    const {\r\n        nd, nx, ny, polygons,\r\n    } = districtMaker\r\n\r\n    const census = Array(nd).fill().map(() => [])\r\n\r\n    for (let gx = 0; gx < nx; gx++) { // x-coordinate of tract\r\n        for (let gy = 0; gy < ny; gy++) { // y-coordinate of tract\r\n            const subject = makeSquare(gx, gy)\r\n            range(nd).forEach((iDistrict) => {\r\n                const poly = polygons[iDistrict]\r\n                const clip = jcopy(poly).reverse()\r\n                const overlap = polygonClip(clip, subject)\r\n\r\n                // store data more sparsely because it is more efficient\r\n                // loop through all districts\r\n                if (overlap !== null) {\r\n                    census[iDistrict].push([gx, gy, polygonArea(overlap)])\r\n                }\r\n            })\r\n        }\r\n    }\r\n\r\n    return census\r\n}\r\n\r\nfunction makeSquare(x, y) {\r\n    // the points are in counterclockwise order\r\n    // assuming a coordinate system where y points down and x points right.\r\n    // top left\r\n    // bottom left\r\n    // bottom right\r\n    // top right\r\n    const subject = [\r\n        [x, y],\r\n        [x, y + 1],\r\n        [x + 1, y + 1],\r\n        [x + 1, y],\r\n    ]\r\n    return subject\r\n}\r\n","/** @module */\r\n\r\nimport { polygonArea } from '../lib/snowpack/build/snowpack/pkg/d3-polygon.js'\r\nimport lloydVoronoi from './lloydVoronoi.js'\r\nimport { drawStrokedColor } from '../utilities/graphicsUtilities.js'\r\nimport geoCensus from './geoCensus.js'\r\n/**\r\n * Makes and draws district boundaries.\r\n * Right now, just for a uniform square geography.\r\n * @param {Screen} screen\r\n * @constructor\r\n */\r\nexport default function DistrictMaker(screen) {\r\n    const self = this\r\n\r\n    /**\r\n     * Define district lines and count demographics.\r\n     * @param {Number} nx - number of voter cells in x\r\n     * @param {Number} ny - number of voter cells in y\r\n     * @param {Number} nd - number of districts.\r\n     */\r\n    self.make = (nx, ny, nd) => {\r\n        [self.centroids, self.voronoi, self.polygons] = lloydVoronoi(nx, ny, nd, 0.01)\r\n        self.nx = nx\r\n        self.ny = ny\r\n        self.nd = nd\r\n        self.polygonAreas = self.polygons.map(polygonArea).map((x) => -x)\r\n        self.totalArea = nx * ny\r\n\r\n        self.census = geoCensus(self)\r\n    }\r\n\r\n    /**\r\n     * Draw Voronoi cell boundaries.\r\n     * @param {Number} geoMapWidth - width of image\r\n     * @param {Number} geoMapHeight - height of image\r\n     */\r\n    self.renderVoronoi = (geoMapWidth, geoMapHeight) => {\r\n        self.renderVoronoiGeneral(0, 0, geoMapWidth, geoMapHeight, null, renderAreaText)\r\n    }\r\n\r\n    self.renderVoronoiColors = (x, y, geoMapWidth, geoMapHeight, colors) => {\r\n        self.renderVoronoiGeneral(x, y, geoMapWidth, geoMapHeight, colors, undefined)\r\n    }\r\n    /**\r\n     * Draw a Voronoi Diagram\r\n     * @param {Number} x - translate image\r\n     * @param {Number} y - translate image\r\n     * @param {Number} geoMapWidth - width of image\r\n     * @param {Number} geoMapHeight - height of image\r\n     * @param {string[]} colors - an option, say \"null\" if do not want colors\r\n     * @param {Function} textFunction - an option, defaults to undefined\r\n     */\r\n    self.renderVoronoiGeneral = (x, y, geoMapWidth, geoMapHeight, colors, textFunction) => {\r\n        const { mctx } = screen\r\n        const {\r\n            voronoi, nx, ny, nd,\r\n        } = self\r\n        mctx.save()\r\n        const scaleX = geoMapWidth / nx\r\n        const scaleY = geoMapHeight / ny\r\n        mctx.translate(x, y)\r\n        mctx.scale(scaleX, scaleY)\r\n        for (let i = 0; i < nd; i++) {\r\n            mctx.beginPath()\r\n            mctx.strokeStyle = '#333'\r\n            mctx.lineWidth = 1 / scaleX\r\n            voronoi.renderCell(i, mctx)\r\n            if (colors !== null) { // option\r\n                mctx.fillStyle = colors[i]\r\n                mctx.fill()\r\n            }\r\n            mctx.stroke()\r\n            if (textFunction !== undefined) textFunction(i) // option\r\n        }\r\n        mctx.restore()\r\n    }\r\n\r\n    function renderAreaText(i) {\r\n        const { mctx } = screen\r\n        const c = self.centroids[i]\r\n        const textHeight = 1\r\n        // const area = textPercent(self.polygonAreas[i] / (self.nx * self.ny))\r\n        const area = self.polygonAreas[i].toFixed(0)\r\n        drawStrokedColor(area, c[0], c[1] + textHeight * 0.5 - 0.2, textHeight, 0.2, '#222', 1, mctx)\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport GeoNoise from './geoNoise.js'\r\nimport DistrictMaker from './DistrictMaker.js'\r\nimport { copyObjectShallow, range } from '../utilities/jsHelpers.js'\r\nimport VoterSimList from './VoterSimList.js'\r\n\r\n/**\r\n * VoterGeoList inherits from VoterSimList.\r\n * @param {Screen} screen\r\n * @constructor\r\n */\r\nexport default function VoterGeoList(screen, sim, changes) {\r\n    const self = this\r\n\r\n    // VoterGeoList inherits from VoterSimList\r\n    // because we need to make a list instances of voterGeoBasis,\r\n    // and voterGeoBasis has a component called voter.\r\n    VoterSimList.call(self, sim)\r\n\r\n    /** Number of districts */\r\n    self.nd = 20\r\n\r\n    /** Number of census tracts in x and y */\r\n    self.nx = 20\r\n    self.ny = 20\r\n\r\n    // Code that handles drawing districts of equal number of voters.\r\n    self.districtMaker = new DistrictMaker(screen)\r\n\r\n    // Code that handles making geographic noise.\r\n    self.geoNoise = new GeoNoise(self.nx, self.ny)\r\n    self.geoNoise.genNoise()\r\n\r\n    // Manage VoterBasisSet //\r\n\r\n    /** This voter basis is repeated at every census tract on the geo map.\r\n     *  It is altered by translating it in policy space.\r\n     *  */\r\n\r\n    // Update call from sim //\r\n\r\n    self.update = () => {\r\n        if (changes.checkNone()) return\r\n        if (changes.check(['districts', 'geo', 'viz', 'dimensions'])) {\r\n            self.updateDistricts()\r\n        }\r\n        self.updateVoters() // todo: maybe make this only trigger when voters change\r\n    }\r\n\r\n    // Update VoterGroup Sets //\r\n\r\n    let voterSims = []\r\n\r\n    /** Make districts and update voter sets */\r\n    self.updateDistricts = () => {\r\n        self.districtMaker.make(self.nx, self.ny, self.nd)\r\n    }\r\n    self.updateVoters = () => {\r\n        voterSims = self.getVoterSims()\r\n        self.updateFullSet()\r\n        self.updateVotersByDistrict()\r\n        self.updateVotersByTract()\r\n    }\r\n\r\n    // We want to copy a set of voter basis objects for each census tract.\r\n    // Then we add a little noise to represent differences due to geography.\r\n\r\n    self.updateFullSet = () => {\r\n        const { sn } = self.geoNoise\r\n        self.allVoterGroups = voterSims.map(\r\n            (vb) => sn.map(\r\n                (rowNoise) => rowNoise.map(\r\n                    (cellNoise) => {\r\n                        const [xNoise, yNoise] = cellNoise\r\n                        const shape1 = copyObjectShallow(vb.voterShape.shape1)\r\n                        const shape2 = copyObjectShallow(vb.voterShape.shape2)\r\n                        shape1.x += xNoise\r\n                        shape2.x += xNoise\r\n                        shape2.y += yNoise\r\n                        return { shape2, shape1 }\r\n                    },\r\n                ).flat(),\r\n            ).flat(),\r\n        ).flat()\r\n    }\r\n\r\n    self.updateVotersByDistrict = () => {\r\n        const { census } = self.districtMaker\r\n        const { sn } = self.geoNoise\r\n        self.voterGroupsByDistrict = range(self.nd).map(\r\n            (iDistrict) => voterSims.map(\r\n                (vb) => census[iDistrict].map((g) => {\r\n                    const [gx, gy, gf] = g\r\n                    const [xNoise, yNoise] = sn[gx][gy]\r\n                    const shape1 = copyObjectShallow(vb.voterShape.shape1)\r\n                    const shape2 = copyObjectShallow(vb.voterShape.shape2)\r\n                    shape1.x += xNoise\r\n                    shape2.x += xNoise\r\n                    shape2.y += yNoise\r\n                    return { shape2, shape1, weight: gf }\r\n                }).flat(),\r\n            ).flat(),\r\n        )\r\n    }\r\n\r\n    self.updateVotersByTract = () => {\r\n        const { sn } = self.geoNoise\r\n        self.voterGroupsByTract = sn.map(\r\n            (rowNoise) => rowNoise.map(\r\n                (cellNoise) => voterSims.map(\r\n                    (vb) => {\r\n                        const [xNoise, yNoise] = cellNoise\r\n                        const shape1 = copyObjectShallow(vb.voterShape.shape1)\r\n                        const shape2 = copyObjectShallow(vb.voterShape.shape2)\r\n                        shape1.x += xNoise\r\n                        shape2.x += xNoise\r\n                        shape2.y += yNoise\r\n                        return { shape2, shape1 }\r\n                    },\r\n                ).flat(),\r\n            ),\r\n        )\r\n    }\r\n}\r\n","/** @module */\r\n/**\r\n * Graphics Component for voterShapes in 1D\r\n * @param {VoterShape} voterShape\r\n * @param {Screen} screen\r\n */\r\nexport default function VoterRender1D(voterShape, screen) {\r\n    const self = this\r\n\r\n    self.render = function () {\r\n        const { ctx } = screen\r\n        const { x, shape1 } = voterShape\r\n        const { w, densityProfile } = shape1\r\n        const h = 100\r\n        const middle = 150\r\n\r\n        ctx.save()\r\n\r\n        ctx.beginPath()\r\n        doPath()\r\n        ctx.stroke()\r\n\r\n        ctx.restore()\r\n        function doPath() {\r\n            if (densityProfile === 'gaussian') {\r\n                gaussianPath()\r\n            } else {\r\n                rectanglePath()\r\n            }\r\n        }\r\n\r\n        function gaussianPath() {\r\n            const sigma = w / Math.sqrt(2 * Math.PI) // w = sigma * sqrt(2*pi)\r\n            const amp = h\r\n            const bottom = middle + h * 0.5\r\n            // start bottom left\r\n            ctx.moveTo(0, bottom)\r\n            const pa = []\r\n            for (let i = 0; i <= screen.width; i += 1) {\r\n                const xp = 0.5 * ((i - x) / sigma) ** 2\r\n                const y = bottom - amp * Math.exp(-xp)\r\n                pa.push(y)\r\n                ctx.lineTo(i, y)\r\n            }\r\n            // end bottom right\r\n            ctx.lineTo(screen.width, bottom)\r\n            ctx.lineTo(0, bottom)\r\n            // ctx.closePath()\r\n        }\r\n        function rectanglePath() {\r\n            ctx.rect(x - w * 0.5, middle - h * 0.5, w, h)\r\n        }\r\n    }\r\n\r\n    self.renderAt = () => { self.render() }\r\n}\r\n","/** @module */\r\n/**\r\n * Graphics Component for voterShapes in 2D\r\n * @param {VoterShape} voterShape\r\n * @param {Screen} screen\r\n */\r\nexport default function VoterRender2D(voterShape, screen) {\r\n    const self = this\r\n\r\n    self.render = function () {\r\n        const { ctx } = screen\r\n        const { x, y, shape2 } = voterShape\r\n        // circle\r\n        ctx.beginPath()\r\n        // ctx.fillStyle = \"#eee\"\r\n        ctx.arc(x, y, shape2.w * 0.5, 0, 2 * Math.PI)\r\n        // ctx.fill()\r\n        ctx.stroke()\r\n    }\r\n    self.renderAt = function (newX, newY) {\r\n        const { ctx } = screen\r\n        const { w } = voterShape.shape2\r\n        // circle\r\n        ctx.beginPath()\r\n        // ctx.fillStyle = \"#eee\"\r\n        ctx.arc(newX, newY, w * 0.5, 0, 2 * Math.PI)\r\n        // ctx.fill()\r\n        ctx.stroke()\r\n    }\r\n    self.renderCenterAt2 = function (newX, newY) {\r\n        const { ctx } = screen\r\n        // circle\r\n        ctx.beginPath()\r\n        ctx.fillStyle = '#555'\r\n        ctx.arc(newX, newY, 1, 0, 2 * Math.PI)\r\n        ctx.fill()\r\n        // ctx.stroke()\r\n    }\r\n}\r\n","/** @module */\r\n\r\n// import GeoMaps from './GeoMaps.js'\r\nimport VoterRender1D from './VoterRender1D.js'\r\nimport VoterRender2D from './VoterRender2D.js'\r\n\r\n/**\r\n * Show Voters\r\n * @param {VoterSimList} voterSimList\r\n * @param {screen} screen - draw to the screen\r\n * @constructor\r\n */\r\nexport default function VizSampleDensity1D(voterSimList, candidateDnSimList, screen, changes, sim) {\r\n    const self = this\r\n\r\n    // adjustable visual parameters\r\n    const kw = 20\r\n\r\n    // const geoMaps = new GeoMaps(voterSimList, candidateDnSimList, screen, sim)\r\n\r\n    // sum and total density\r\n    const { width } = screen\r\n    const sum = Array(width).fill(0)\r\n    let total = 0\r\n\r\n    const { dimensions } = sim.election\r\n\r\n    // voter renderer factory //\r\n    const VoterRenderer = (dimensions === 1) ? VoterRender1D : VoterRender2D\r\n    voterSimList.setRenderer((voterShape) => new VoterRenderer(voterShape, screen))\r\n    candidateDnSimList.setRenderer((voterShape) => new VoterRenderer(voterShape, screen))\r\n\r\n    self.update = function (addResult) {\r\n        if (changes.checkNone() === false) {\r\n            start()\r\n        }\r\n\r\n        const { pointsChanged, newPoints } = addResult\r\n\r\n        if (pointsChanged) {\r\n            updatePoints(newPoints)\r\n        }\r\n    }\r\n\r\n    function start() {\r\n        sum.fill(0)\r\n        total = 0\r\n    }\r\n\r\n    const kernelsize = 4 / 3\r\n    function updatePoints(newPoints) {\r\n        // add to sum for each point\r\n        const nk = newPoints.length\r\n        for (let k = 0; k < nk; k++) {\r\n            const { x } = newPoints[k]\r\n            for (let i = 0; i < width; i++) {\r\n                sum[i] += kernel(i - x)\r\n            }\r\n            total += kernelsize\r\n        }\r\n    }\r\n\r\n    function kernel(x) {\r\n        if (x > kw || x < -kw) return 0\r\n        return (1 - (x / kw) ** 2) / kw\r\n    }\r\n\r\n    self.render = () => {\r\n        // geoMaps.renderPolicyNoise()\r\n        renderCans()\r\n\r\n        voterSimList.render()\r\n        candidateDnSimList.render()\r\n    }\r\n\r\n    function renderCans() {\r\n        const { ctx } = screen\r\n        ctx.save()\r\n\r\n        ctx.beginPath()\r\n        doPath(ctx)\r\n        ctx.strokeStyle = '#ccc'\r\n        ctx.stroke()\r\n        ctx.fillStyle = '#ccc'\r\n        ctx.fill()\r\n\r\n        ctx.restore()\r\n    }\r\n\r\n    const h = 100\r\n    const middle = 150\r\n    function doPath(ctx) {\r\n        const norm = 1 / total\r\n\r\n        const amp = h * 100\r\n        const bottom = middle + h * 0.5\r\n        // start bottom left\r\n        ctx.moveTo(0, bottom)\r\n        const pa = []\r\n        for (let i = 0; i <= width; i += 1) {\r\n            const y = bottom - amp * sum[i] * norm\r\n            pa.push(y)\r\n            ctx.lineTo(i, y)\r\n        }\r\n        // end bottom right\r\n        ctx.lineTo(screen.width, bottom)\r\n        ctx.lineTo(0, bottom)\r\n    }\r\n}\r\n","function range(start, stop, step) {\r\n  start = +start, stop = +stop, step = (n = arguments.length) < 2 ? (stop = start, start = 0, 1) : n < 3 ? 1 : +step;\r\n\r\n  var i = -1,\r\n      n = Math.max(0, Math.ceil((stop - start) / step)) | 0,\r\n      range = new Array(n);\r\n\r\n  while (++i < n) {\r\n    range[i] = start + i * step;\r\n  }\r\n\r\n  return range;\r\n}\r\n\r\nexport { range as r };\r\n","import { r as range } from './common/range-94fca231.js';\r\n\r\nfunction count(values, valueof) {\r\n  let count = 0;\r\n  if (valueof === undefined) {\r\n    for (let value of values) {\r\n      if (value != null && (value = +value) >= value) {\r\n        ++count;\r\n      }\r\n    }\r\n  } else {\r\n    let index = -1;\r\n    for (let value of values) {\r\n      if ((value = valueof(value, ++index, values)) != null && (value = +value) >= value) {\r\n        ++count;\r\n      }\r\n    }\r\n  }\r\n  return count;\r\n}\r\n\r\nfunction extent(values, valueof) {\r\n  let min;\r\n  let max;\r\n  if (valueof === undefined) {\r\n    for (const value of values) {\r\n      if (value != null) {\r\n        if (min === undefined) {\r\n          if (value >= value) min = max = value;\r\n        } else {\r\n          if (min > value) min = value;\r\n          if (max < value) max = value;\r\n        }\r\n      }\r\n    }\r\n  } else {\r\n    let index = -1;\r\n    for (let value of values) {\r\n      if ((value = valueof(value, ++index, values)) != null) {\r\n        if (min === undefined) {\r\n          if (value >= value) min = max = value;\r\n        } else {\r\n          if (min > value) min = value;\r\n          if (max < value) max = value;\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return [min, max];\r\n}\r\n\r\nvar e10 = Math.sqrt(50),\r\n    e5 = Math.sqrt(10),\r\n    e2 = Math.sqrt(2);\r\n\r\nfunction ticks(start, stop, count) {\r\n  var reverse,\r\n      i = -1,\r\n      n,\r\n      ticks,\r\n      step;\r\n\r\n  stop = +stop, start = +start, count = +count;\r\n  if (start === stop && count > 0) return [start];\r\n  if (reverse = stop < start) n = start, start = stop, stop = n;\r\n  if ((step = tickIncrement(start, stop, count)) === 0 || !isFinite(step)) return [];\r\n\r\n  if (step > 0) {\r\n    let r0 = Math.round(start / step), r1 = Math.round(stop / step);\r\n    if (r0 * step < start) ++r0;\r\n    if (r1 * step > stop) --r1;\r\n    ticks = new Array(n = r1 - r0 + 1);\r\n    while (++i < n) ticks[i] = (r0 + i) * step;\r\n  } else {\r\n    step = -step;\r\n    let r0 = Math.round(start * step), r1 = Math.round(stop * step);\r\n    if (r0 / step < start) ++r0;\r\n    if (r1 / step > stop) --r1;\r\n    ticks = new Array(n = r1 - r0 + 1);\r\n    while (++i < n) ticks[i] = (r0 + i) / step;\r\n  }\r\n\r\n  if (reverse) ticks.reverse();\r\n\r\n  return ticks;\r\n}\r\n\r\nfunction tickIncrement(start, stop, count) {\r\n  var step = (stop - start) / Math.max(0, count),\r\n      power = Math.floor(Math.log(step) / Math.LN10),\r\n      error = step / Math.pow(10, power);\r\n  return power >= 0\r\n      ? (error >= e10 ? 10 : error >= e5 ? 5 : error >= e2 ? 2 : 1) * Math.pow(10, power)\r\n      : -Math.pow(10, -power) / (error >= e10 ? 10 : error >= e5 ? 5 : error >= e2 ? 2 : 1);\r\n}\r\n\r\nfunction tickStep(start, stop, count) {\r\n  var step0 = Math.abs(stop - start) / Math.max(0, count),\r\n      step1 = Math.pow(10, Math.floor(Math.log(step0) / Math.LN10)),\r\n      error = step0 / step1;\r\n  if (error >= e10) step1 *= 10;\r\n  else if (error >= e5) step1 *= 5;\r\n  else if (error >= e2) step1 *= 2;\r\n  return stop < start ? -step1 : step1;\r\n}\r\n\r\nfunction thresholdSturges(values) {\r\n  return Math.ceil(Math.log(count(values)) / Math.LN2) + 1;\r\n}\r\n\r\nfunction max(values, valueof) {\r\n  let max;\r\n  if (valueof === undefined) {\r\n    for (const value of values) {\r\n      if (value != null\r\n          && (max < value || (max === undefined && value >= value))) {\r\n        max = value;\r\n      }\r\n    }\r\n  } else {\r\n    let index = -1;\r\n    for (let value of values) {\r\n      if ((value = valueof(value, ++index, values)) != null\r\n          && (max < value || (max === undefined && value >= value))) {\r\n        max = value;\r\n      }\r\n    }\r\n  }\r\n  return max;\r\n}\r\n\r\nvar array = Array.prototype;\r\n\r\nvar slice = array.slice;\r\n\r\nfunction ascending(a, b) {\r\n  return a - b;\r\n}\r\n\r\nfunction area(ring) {\r\n  var i = 0, n = ring.length, area = ring[n - 1][1] * ring[0][0] - ring[n - 1][0] * ring[0][1];\r\n  while (++i < n) area += ring[i - 1][1] * ring[i][0] - ring[i - 1][0] * ring[i][1];\r\n  return area;\r\n}\r\n\r\nvar constant = x => () => x;\r\n\r\nfunction contains(ring, hole) {\r\n  var i = -1, n = hole.length, c;\r\n  while (++i < n) if (c = ringContains(ring, hole[i])) return c;\r\n  return 0;\r\n}\r\n\r\nfunction ringContains(ring, point) {\r\n  var x = point[0], y = point[1], contains = -1;\r\n  for (var i = 0, n = ring.length, j = n - 1; i < n; j = i++) {\r\n    var pi = ring[i], xi = pi[0], yi = pi[1], pj = ring[j], xj = pj[0], yj = pj[1];\r\n    if (segmentContains(pi, pj, point)) return 0;\r\n    if (((yi > y) !== (yj > y)) && ((x < (xj - xi) * (y - yi) / (yj - yi) + xi))) contains = -contains;\r\n  }\r\n  return contains;\r\n}\r\n\r\nfunction segmentContains(a, b, c) {\r\n  var i; return collinear(a, b, c) && within(a[i = +(a[0] === b[0])], c[i], b[i]);\r\n}\r\n\r\nfunction collinear(a, b, c) {\r\n  return (b[0] - a[0]) * (c[1] - a[1]) === (c[0] - a[0]) * (b[1] - a[1]);\r\n}\r\n\r\nfunction within(p, q, r) {\r\n  return p <= q && q <= r || r <= q && q <= p;\r\n}\r\n\r\nfunction noop() {}\r\n\r\nvar cases = [\r\n  [],\r\n  [[[1.0, 1.5], [0.5, 1.0]]],\r\n  [[[1.5, 1.0], [1.0, 1.5]]],\r\n  [[[1.5, 1.0], [0.5, 1.0]]],\r\n  [[[1.0, 0.5], [1.5, 1.0]]],\r\n  [[[1.0, 1.5], [0.5, 1.0]], [[1.0, 0.5], [1.5, 1.0]]],\r\n  [[[1.0, 0.5], [1.0, 1.5]]],\r\n  [[[1.0, 0.5], [0.5, 1.0]]],\r\n  [[[0.5, 1.0], [1.0, 0.5]]],\r\n  [[[1.0, 1.5], [1.0, 0.5]]],\r\n  [[[0.5, 1.0], [1.0, 0.5]], [[1.5, 1.0], [1.0, 1.5]]],\r\n  [[[1.5, 1.0], [1.0, 0.5]]],\r\n  [[[0.5, 1.0], [1.5, 1.0]]],\r\n  [[[1.0, 1.5], [1.5, 1.0]]],\r\n  [[[0.5, 1.0], [1.0, 1.5]]],\r\n  []\r\n];\r\n\r\nfunction contours() {\r\n  var dx = 1,\r\n      dy = 1,\r\n      threshold = thresholdSturges,\r\n      smooth = smoothLinear;\r\n\r\n  function contours(values) {\r\n    var tz = threshold(values);\r\n\r\n    // Convert number of thresholds into uniform thresholds.\r\n    if (!Array.isArray(tz)) {\r\n      const e = extent(values), ts = tickStep(e[0], e[1], tz);\r\n      tz = ticks(Math.floor(e[0] / ts) * ts, Math.floor(e[1] / ts - 1) * ts, tz);\r\n    } else {\r\n      tz = tz.slice().sort(ascending);\r\n    }\r\n\r\n    return tz.map(value => contour(values, value));\r\n  }\r\n\r\n  // Accumulate, smooth contour rings, assign holes to exterior rings.\r\n  // Based on https://github.com/mbostock/shapefile/blob/v0.6.2/shp/polygon.js\r\n  function contour(values, value) {\r\n    var polygons = [],\r\n        holes = [];\r\n\r\n    isorings(values, value, function(ring) {\r\n      smooth(ring, values, value);\r\n      if (area(ring) > 0) polygons.push([ring]);\r\n      else holes.push(ring);\r\n    });\r\n\r\n    holes.forEach(function(hole) {\r\n      for (var i = 0, n = polygons.length, polygon; i < n; ++i) {\r\n        if (contains((polygon = polygons[i])[0], hole) !== -1) {\r\n          polygon.push(hole);\r\n          return;\r\n        }\r\n      }\r\n    });\r\n\r\n    return {\r\n      type: \"MultiPolygon\",\r\n      value: value,\r\n      coordinates: polygons\r\n    };\r\n  }\r\n\r\n  // Marching squares with isolines stitched into rings.\r\n  // Based on https://github.com/topojson/topojson-client/blob/v3.0.0/src/stitch.js\r\n  function isorings(values, value, callback) {\r\n    var fragmentByStart = new Array,\r\n        fragmentByEnd = new Array,\r\n        x, y, t0, t1, t2, t3;\r\n\r\n    // Special case for the first row (y = -1, t2 = t3 = 0).\r\n    x = y = -1;\r\n    t1 = values[0] >= value;\r\n    cases[t1 << 1].forEach(stitch);\r\n    while (++x < dx - 1) {\r\n      t0 = t1, t1 = values[x + 1] >= value;\r\n      cases[t0 | t1 << 1].forEach(stitch);\r\n    }\r\n    cases[t1 << 0].forEach(stitch);\r\n\r\n    // General case for the intermediate rows.\r\n    while (++y < dy - 1) {\r\n      x = -1;\r\n      t1 = values[y * dx + dx] >= value;\r\n      t2 = values[y * dx] >= value;\r\n      cases[t1 << 1 | t2 << 2].forEach(stitch);\r\n      while (++x < dx - 1) {\r\n        t0 = t1, t1 = values[y * dx + dx + x + 1] >= value;\r\n        t3 = t2, t2 = values[y * dx + x + 1] >= value;\r\n        cases[t0 | t1 << 1 | t2 << 2 | t3 << 3].forEach(stitch);\r\n      }\r\n      cases[t1 | t2 << 3].forEach(stitch);\r\n    }\r\n\r\n    // Special case for the last row (y = dy - 1, t0 = t1 = 0).\r\n    x = -1;\r\n    t2 = values[y * dx] >= value;\r\n    cases[t2 << 2].forEach(stitch);\r\n    while (++x < dx - 1) {\r\n      t3 = t2, t2 = values[y * dx + x + 1] >= value;\r\n      cases[t2 << 2 | t3 << 3].forEach(stitch);\r\n    }\r\n    cases[t2 << 3].forEach(stitch);\r\n\r\n    function stitch(line) {\r\n      var start = [line[0][0] + x, line[0][1] + y],\r\n          end = [line[1][0] + x, line[1][1] + y],\r\n          startIndex = index(start),\r\n          endIndex = index(end),\r\n          f, g;\r\n      if (f = fragmentByEnd[startIndex]) {\r\n        if (g = fragmentByStart[endIndex]) {\r\n          delete fragmentByEnd[f.end];\r\n          delete fragmentByStart[g.start];\r\n          if (f === g) {\r\n            f.ring.push(end);\r\n            callback(f.ring);\r\n          } else {\r\n            fragmentByStart[f.start] = fragmentByEnd[g.end] = {start: f.start, end: g.end, ring: f.ring.concat(g.ring)};\r\n          }\r\n        } else {\r\n          delete fragmentByEnd[f.end];\r\n          f.ring.push(end);\r\n          fragmentByEnd[f.end = endIndex] = f;\r\n        }\r\n      } else if (f = fragmentByStart[endIndex]) {\r\n        if (g = fragmentByEnd[startIndex]) {\r\n          delete fragmentByStart[f.start];\r\n          delete fragmentByEnd[g.end];\r\n          if (f === g) {\r\n            f.ring.push(end);\r\n            callback(f.ring);\r\n          } else {\r\n            fragmentByStart[g.start] = fragmentByEnd[f.end] = {start: g.start, end: f.end, ring: g.ring.concat(f.ring)};\r\n          }\r\n        } else {\r\n          delete fragmentByStart[f.start];\r\n          f.ring.unshift(start);\r\n          fragmentByStart[f.start = startIndex] = f;\r\n        }\r\n      } else {\r\n        fragmentByStart[startIndex] = fragmentByEnd[endIndex] = {start: startIndex, end: endIndex, ring: [start, end]};\r\n      }\r\n    }\r\n  }\r\n\r\n  function index(point) {\r\n    return point[0] * 2 + point[1] * (dx + 1) * 4;\r\n  }\r\n\r\n  function smoothLinear(ring, values, value) {\r\n    ring.forEach(function(point) {\r\n      var x = point[0],\r\n          y = point[1],\r\n          xt = x | 0,\r\n          yt = y | 0,\r\n          v0,\r\n          v1 = values[yt * dx + xt];\r\n      if (x > 0 && x < dx && xt === x) {\r\n        v0 = values[yt * dx + xt - 1];\r\n        point[0] = x + (value - v0) / (v1 - v0) - 0.5;\r\n      }\r\n      if (y > 0 && y < dy && yt === y) {\r\n        v0 = values[(yt - 1) * dx + xt];\r\n        point[1] = y + (value - v0) / (v1 - v0) - 0.5;\r\n      }\r\n    });\r\n  }\r\n\r\n  contours.contour = contour;\r\n\r\n  contours.size = function(_) {\r\n    if (!arguments.length) return [dx, dy];\r\n    var _0 = Math.floor(_[0]), _1 = Math.floor(_[1]);\r\n    if (!(_0 >= 0 && _1 >= 0)) throw new Error(\"invalid size\");\r\n    return dx = _0, dy = _1, contours;\r\n  };\r\n\r\n  contours.thresholds = function(_) {\r\n    return arguments.length ? (threshold = typeof _ === \"function\" ? _ : Array.isArray(_) ? constant(slice.call(_)) : constant(_), contours) : threshold;\r\n  };\r\n\r\n  contours.smooth = function(_) {\r\n    return arguments.length ? (smooth = _ ? smoothLinear : noop, contours) : smooth === smoothLinear;\r\n  };\r\n\r\n  return contours;\r\n}\r\n\r\n// TODO Optimize edge cases.\r\n// TODO Optimize index calculation.\r\n// TODO Optimize arguments.\r\nfunction blurX(source, target, r) {\r\n  var n = source.width,\r\n      m = source.height,\r\n      w = (r << 1) + 1;\r\n  for (var j = 0; j < m; ++j) {\r\n    for (var i = 0, sr = 0; i < n + r; ++i) {\r\n      if (i < n) {\r\n        sr += source.data[i + j * n];\r\n      }\r\n      if (i >= r) {\r\n        if (i >= w) {\r\n          sr -= source.data[i - w + j * n];\r\n        }\r\n        target.data[i - r + j * n] = sr / Math.min(i + 1, n - 1 + w - i, w);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n// TODO Optimize edge cases.\r\n// TODO Optimize index calculation.\r\n// TODO Optimize arguments.\r\nfunction blurY(source, target, r) {\r\n  var n = source.width,\r\n      m = source.height,\r\n      w = (r << 1) + 1;\r\n  for (var i = 0; i < n; ++i) {\r\n    for (var j = 0, sr = 0; j < m + r; ++j) {\r\n      if (j < m) {\r\n        sr += source.data[i + j * n];\r\n      }\r\n      if (j >= r) {\r\n        if (j >= w) {\r\n          sr -= source.data[i + (j - w) * n];\r\n        }\r\n        target.data[i + (j - r) * n] = sr / Math.min(j + 1, m - 1 + w - j, w);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction defaultX(d) {\r\n  return d[0];\r\n}\r\n\r\nfunction defaultY(d) {\r\n  return d[1];\r\n}\r\n\r\nfunction defaultWeight() {\r\n  return 1;\r\n}\r\n\r\nfunction density() {\r\n  var x = defaultX,\r\n      y = defaultY,\r\n      weight = defaultWeight,\r\n      dx = 960,\r\n      dy = 500,\r\n      r = 20, // blur radius\r\n      k = 2, // log2(grid cell size)\r\n      o = r * 3, // grid offset, to pad for blur\r\n      n = (dx + o * 2) >> k, // grid width\r\n      m = (dy + o * 2) >> k, // grid height\r\n      threshold = constant(20);\r\n\r\n  function density(data) {\r\n    var values0 = new Float32Array(n * m),\r\n        values1 = new Float32Array(n * m),\r\n        pow2k = Math.pow(2, -k);\r\n\r\n    data.forEach(function(d, i, data) {\r\n      var xi = (x(d, i, data) + o) * pow2k,\r\n          yi = (y(d, i, data) + o) * pow2k,\r\n          wi = +weight(d, i, data);\r\n      if (xi >= 0 && xi < n && yi >= 0 && yi < m) {\r\n        var x0 = Math.floor(xi),\r\n            y0 = Math.floor(yi),\r\n            xt = xi - x0 - 0.5,\r\n            yt = yi - y0 - 0.5;\r\n        values0[x0 + y0 * n] += (1 - xt) * (1 - yt) * wi;\r\n        values0[x0 + 1 + y0 * n] += xt * (1 - yt) * wi;\r\n        values0[x0 + 1 + (y0 + 1) * n] += xt * yt * wi;\r\n        values0[x0 + (y0 + 1) * n] += (1 - xt) * yt * wi;\r\n      }\r\n    });\r\n\r\n    // TODO Optimize.\r\n    blurX({width: n, height: m, data: values0}, {width: n, height: m, data: values1}, r >> k);\r\n    blurY({width: n, height: m, data: values1}, {width: n, height: m, data: values0}, r >> k);\r\n    blurX({width: n, height: m, data: values0}, {width: n, height: m, data: values1}, r >> k);\r\n    blurY({width: n, height: m, data: values1}, {width: n, height: m, data: values0}, r >> k);\r\n    blurX({width: n, height: m, data: values0}, {width: n, height: m, data: values1}, r >> k);\r\n    blurY({width: n, height: m, data: values1}, {width: n, height: m, data: values0}, r >> k);\r\n\r\n    var tz = threshold(values0);\r\n\r\n    // Convert number of thresholds into uniform thresholds.\r\n    if (!Array.isArray(tz)) {\r\n      var stop = max(values0);\r\n      tz = tickStep(0, stop, tz);\r\n      tz = range(0, Math.floor(stop / tz) * tz, tz);\r\n      tz.shift();\r\n    }\r\n\r\n    return contours()\r\n        .thresholds(tz)\r\n        .size([n, m])\r\n      (values0)\r\n        .map(transform);\r\n  }\r\n\r\n  function transform(geometry) {\r\n    geometry.value *= Math.pow(2, -2 * k); // Density in points per square pixel.\r\n    geometry.coordinates.forEach(transformPolygon);\r\n    return geometry;\r\n  }\r\n\r\n  function transformPolygon(coordinates) {\r\n    coordinates.forEach(transformRing);\r\n  }\r\n\r\n  function transformRing(coordinates) {\r\n    coordinates.forEach(transformPoint);\r\n  }\r\n\r\n  // TODO Optimize.\r\n  function transformPoint(coordinates) {\r\n    coordinates[0] = coordinates[0] * Math.pow(2, k) - o;\r\n    coordinates[1] = coordinates[1] * Math.pow(2, k) - o;\r\n  }\r\n\r\n  function resize() {\r\n    o = r * 3;\r\n    n = (dx + o * 2) >> k;\r\n    m = (dy + o * 2) >> k;\r\n    return density;\r\n  }\r\n\r\n  density.x = function(_) {\r\n    return arguments.length ? (x = typeof _ === \"function\" ? _ : constant(+_), density) : x;\r\n  };\r\n\r\n  density.y = function(_) {\r\n    return arguments.length ? (y = typeof _ === \"function\" ? _ : constant(+_), density) : y;\r\n  };\r\n\r\n  density.weight = function(_) {\r\n    return arguments.length ? (weight = typeof _ === \"function\" ? _ : constant(+_), density) : weight;\r\n  };\r\n\r\n  density.size = function(_) {\r\n    if (!arguments.length) return [dx, dy];\r\n    var _0 = +_[0], _1 = +_[1];\r\n    if (!(_0 >= 0 && _1 >= 0)) throw new Error(\"invalid size\");\r\n    return dx = _0, dy = _1, resize();\r\n  };\r\n\r\n  density.cellSize = function(_) {\r\n    if (!arguments.length) return 1 << k;\r\n    if (!((_ = +_) >= 1)) throw new Error(\"invalid cell size\");\r\n    return k = Math.floor(Math.log(_) / Math.LN2), resize();\r\n  };\r\n\r\n  density.thresholds = function(_) {\r\n    return arguments.length ? (threshold = typeof _ === \"function\" ? _ : Array.isArray(_) ? constant(slice.call(_)) : constant(_), density) : threshold;\r\n  };\r\n\r\n  density.bandwidth = function(_) {\r\n    if (!arguments.length) return Math.sqrt(r * (r + 1));\r\n    if (!((_ = +_) >= 0)) throw new Error(\"invalid bandwidth\");\r\n    return r = Math.round((Math.sqrt(4 * _ * _ + 1) - 1) / 2), resize();\r\n  };\r\n\r\n  return density;\r\n}\r\n\r\nexport { density as contourDensity, contours };\r\n","import { r as range$1 } from './common/range-94fca231.js';\r\n\r\n// https://github.com/python/cpython/blob/a74eea238f5baba15797e2e8b570d153bc8690a7/Modules/mathmodule.c#L1423\r\nclass Adder {\r\n  constructor() {\r\n    this._partials = new Float64Array(32);\r\n    this._n = 0;\r\n  }\r\n  add(x) {\r\n    const p = this._partials;\r\n    let i = 0;\r\n    for (let j = 0; j < this._n && j < 32; j++) {\r\n      const y = p[j],\r\n        hi = x + y,\r\n        lo = Math.abs(x) < Math.abs(y) ? x - (hi - y) : y - (hi - x);\r\n      if (lo) p[i++] = lo;\r\n      x = hi;\r\n    }\r\n    p[i] = x;\r\n    this._n = i + 1;\r\n    return this;\r\n  }\r\n  valueOf() {\r\n    const p = this._partials;\r\n    let n = this._n, x, y, lo, hi = 0;\r\n    if (n > 0) {\r\n      hi = p[--n];\r\n      while (n > 0) {\r\n        x = hi;\r\n        y = p[--n];\r\n        hi = x + y;\r\n        lo = y - (hi - x);\r\n        if (lo) break;\r\n      }\r\n      if (n > 0 && ((lo < 0 && p[n - 1] < 0) || (lo > 0 && p[n - 1] > 0))) {\r\n        y = lo * 2;\r\n        x = hi + y;\r\n        if (y == x - hi) hi = x;\r\n      }\r\n    }\r\n    return hi;\r\n  }\r\n}\r\n\r\nfunction* flatten(arrays) {\r\n  for (const array of arrays) {\r\n    yield* array;\r\n  }\r\n}\r\n\r\nfunction merge(arrays) {\r\n  return Array.from(flatten(arrays));\r\n}\r\n\r\nvar epsilon = 1e-6;\r\nvar epsilon2 = 1e-12;\r\nvar pi = Math.PI;\r\nvar halfPi = pi / 2;\r\nvar quarterPi = pi / 4;\r\nvar tau = pi * 2;\r\n\r\nvar degrees = 180 / pi;\r\nvar radians = pi / 180;\r\n\r\nvar abs = Math.abs;\r\nvar atan = Math.atan;\r\nvar atan2 = Math.atan2;\r\nvar cos = Math.cos;\r\nvar ceil = Math.ceil;\r\nvar exp = Math.exp;\r\nvar hypot = Math.hypot;\r\nvar log = Math.log;\r\nvar pow = Math.pow;\r\nvar sin = Math.sin;\r\nvar sign = Math.sign || function(x) { return x > 0 ? 1 : x < 0 ? -1 : 0; };\r\nvar sqrt = Math.sqrt;\r\nvar tan = Math.tan;\r\n\r\nfunction acos(x) {\r\n  return x > 1 ? 0 : x < -1 ? pi : Math.acos(x);\r\n}\r\n\r\nfunction asin(x) {\r\n  return x > 1 ? halfPi : x < -1 ? -halfPi : Math.asin(x);\r\n}\r\n\r\nfunction haversin(x) {\r\n  return (x = sin(x / 2)) * x;\r\n}\r\n\r\nfunction noop() {}\r\n\r\nfunction streamGeometry(geometry, stream) {\r\n  if (geometry && streamGeometryType.hasOwnProperty(geometry.type)) {\r\n    streamGeometryType[geometry.type](geometry, stream);\r\n  }\r\n}\r\n\r\nvar streamObjectType = {\r\n  Feature: function(object, stream) {\r\n    streamGeometry(object.geometry, stream);\r\n  },\r\n  FeatureCollection: function(object, stream) {\r\n    var features = object.features, i = -1, n = features.length;\r\n    while (++i < n) streamGeometry(features[i].geometry, stream);\r\n  }\r\n};\r\n\r\nvar streamGeometryType = {\r\n  Sphere: function(object, stream) {\r\n    stream.sphere();\r\n  },\r\n  Point: function(object, stream) {\r\n    object = object.coordinates;\r\n    stream.point(object[0], object[1], object[2]);\r\n  },\r\n  MultiPoint: function(object, stream) {\r\n    var coordinates = object.coordinates, i = -1, n = coordinates.length;\r\n    while (++i < n) object = coordinates[i], stream.point(object[0], object[1], object[2]);\r\n  },\r\n  LineString: function(object, stream) {\r\n    streamLine(object.coordinates, stream, 0);\r\n  },\r\n  MultiLineString: function(object, stream) {\r\n    var coordinates = object.coordinates, i = -1, n = coordinates.length;\r\n    while (++i < n) streamLine(coordinates[i], stream, 0);\r\n  },\r\n  Polygon: function(object, stream) {\r\n    streamPolygon(object.coordinates, stream);\r\n  },\r\n  MultiPolygon: function(object, stream) {\r\n    var coordinates = object.coordinates, i = -1, n = coordinates.length;\r\n    while (++i < n) streamPolygon(coordinates[i], stream);\r\n  },\r\n  GeometryCollection: function(object, stream) {\r\n    var geometries = object.geometries, i = -1, n = geometries.length;\r\n    while (++i < n) streamGeometry(geometries[i], stream);\r\n  }\r\n};\r\n\r\nfunction streamLine(coordinates, stream, closed) {\r\n  var i = -1, n = coordinates.length - closed, coordinate;\r\n  stream.lineStart();\r\n  while (++i < n) coordinate = coordinates[i], stream.point(coordinate[0], coordinate[1], coordinate[2]);\r\n  stream.lineEnd();\r\n}\r\n\r\nfunction streamPolygon(coordinates, stream) {\r\n  var i = -1, n = coordinates.length;\r\n  stream.polygonStart();\r\n  while (++i < n) streamLine(coordinates[i], stream, 1);\r\n  stream.polygonEnd();\r\n}\r\n\r\nfunction geoStream(object, stream) {\r\n  if (object && streamObjectType.hasOwnProperty(object.type)) {\r\n    streamObjectType[object.type](object, stream);\r\n  } else {\r\n    streamGeometry(object, stream);\r\n  }\r\n}\r\n\r\nvar areaRingSum = new Adder();\r\n\r\n// hello?\r\n\r\nvar areaSum = new Adder(),\r\n    lambda00,\r\n    phi00,\r\n    lambda0,\r\n    cosPhi0,\r\n    sinPhi0;\r\n\r\nvar areaStream = {\r\n  point: noop,\r\n  lineStart: noop,\r\n  lineEnd: noop,\r\n  polygonStart: function() {\r\n    areaRingSum = new Adder();\r\n    areaStream.lineStart = areaRingStart;\r\n    areaStream.lineEnd = areaRingEnd;\r\n  },\r\n  polygonEnd: function() {\r\n    var areaRing = +areaRingSum;\r\n    areaSum.add(areaRing < 0 ? tau + areaRing : areaRing);\r\n    this.lineStart = this.lineEnd = this.point = noop;\r\n  },\r\n  sphere: function() {\r\n    areaSum.add(tau);\r\n  }\r\n};\r\n\r\nfunction areaRingStart() {\r\n  areaStream.point = areaPointFirst;\r\n}\r\n\r\nfunction areaRingEnd() {\r\n  areaPoint(lambda00, phi00);\r\n}\r\n\r\nfunction areaPointFirst(lambda, phi) {\r\n  areaStream.point = areaPoint;\r\n  lambda00 = lambda, phi00 = phi;\r\n  lambda *= radians, phi *= radians;\r\n  lambda0 = lambda, cosPhi0 = cos(phi = phi / 2 + quarterPi), sinPhi0 = sin(phi);\r\n}\r\n\r\nfunction areaPoint(lambda, phi) {\r\n  lambda *= radians, phi *= radians;\r\n  phi = phi / 2 + quarterPi; // half the angular distance from south pole\r\n\r\n  // Spherical excess E for a spherical triangle with vertices: south pole,\r\n  // previous point, current point.  Uses a formula derived from Cagnolis\r\n  // theorem.  See Todhunter, Spherical Trig. (1871), Sec. 103, Eq. (2).\r\n  var dLambda = lambda - lambda0,\r\n      sdLambda = dLambda >= 0 ? 1 : -1,\r\n      adLambda = sdLambda * dLambda,\r\n      cosPhi = cos(phi),\r\n      sinPhi = sin(phi),\r\n      k = sinPhi0 * sinPhi,\r\n      u = cosPhi0 * cosPhi + k * cos(adLambda),\r\n      v = k * sdLambda * sin(adLambda);\r\n  areaRingSum.add(atan2(v, u));\r\n\r\n  // Advance the previous points.\r\n  lambda0 = lambda, cosPhi0 = cosPhi, sinPhi0 = sinPhi;\r\n}\r\n\r\nfunction area(object) {\r\n  areaSum = new Adder();\r\n  geoStream(object, areaStream);\r\n  return areaSum * 2;\r\n}\r\n\r\nfunction spherical(cartesian) {\r\n  return [atan2(cartesian[1], cartesian[0]), asin(cartesian[2])];\r\n}\r\n\r\nfunction cartesian(spherical) {\r\n  var lambda = spherical[0], phi = spherical[1], cosPhi = cos(phi);\r\n  return [cosPhi * cos(lambda), cosPhi * sin(lambda), sin(phi)];\r\n}\r\n\r\nfunction cartesianDot(a, b) {\r\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2];\r\n}\r\n\r\nfunction cartesianCross(a, b) {\r\n  return [a[1] * b[2] - a[2] * b[1], a[2] * b[0] - a[0] * b[2], a[0] * b[1] - a[1] * b[0]];\r\n}\r\n\r\n// TODO return a\r\nfunction cartesianAddInPlace(a, b) {\r\n  a[0] += b[0], a[1] += b[1], a[2] += b[2];\r\n}\r\n\r\nfunction cartesianScale(vector, k) {\r\n  return [vector[0] * k, vector[1] * k, vector[2] * k];\r\n}\r\n\r\n// TODO return d\r\nfunction cartesianNormalizeInPlace(d) {\r\n  var l = sqrt(d[0] * d[0] + d[1] * d[1] + d[2] * d[2]);\r\n  d[0] /= l, d[1] /= l, d[2] /= l;\r\n}\r\n\r\nvar lambda0$1, phi0, lambda1, phi1, // bounds\r\n    lambda2, // previous lambda-coordinate\r\n    lambda00$1, phi00$1, // first point\r\n    p0, // previous 3D point\r\n    deltaSum,\r\n    ranges,\r\n    range;\r\n\r\nvar boundsStream = {\r\n  point: boundsPoint,\r\n  lineStart: boundsLineStart,\r\n  lineEnd: boundsLineEnd,\r\n  polygonStart: function() {\r\n    boundsStream.point = boundsRingPoint;\r\n    boundsStream.lineStart = boundsRingStart;\r\n    boundsStream.lineEnd = boundsRingEnd;\r\n    deltaSum = new Adder();\r\n    areaStream.polygonStart();\r\n  },\r\n  polygonEnd: function() {\r\n    areaStream.polygonEnd();\r\n    boundsStream.point = boundsPoint;\r\n    boundsStream.lineStart = boundsLineStart;\r\n    boundsStream.lineEnd = boundsLineEnd;\r\n    if (areaRingSum < 0) lambda0$1 = -(lambda1 = 180), phi0 = -(phi1 = 90);\r\n    else if (deltaSum > epsilon) phi1 = 90;\r\n    else if (deltaSum < -epsilon) phi0 = -90;\r\n    range[0] = lambda0$1, range[1] = lambda1;\r\n  },\r\n  sphere: function() {\r\n    lambda0$1 = -(lambda1 = 180), phi0 = -(phi1 = 90);\r\n  }\r\n};\r\n\r\nfunction boundsPoint(lambda, phi) {\r\n  ranges.push(range = [lambda0$1 = lambda, lambda1 = lambda]);\r\n  if (phi < phi0) phi0 = phi;\r\n  if (phi > phi1) phi1 = phi;\r\n}\r\n\r\nfunction linePoint(lambda, phi) {\r\n  var p = cartesian([lambda * radians, phi * radians]);\r\n  if (p0) {\r\n    var normal = cartesianCross(p0, p),\r\n        equatorial = [normal[1], -normal[0], 0],\r\n        inflection = cartesianCross(equatorial, normal);\r\n    cartesianNormalizeInPlace(inflection);\r\n    inflection = spherical(inflection);\r\n    var delta = lambda - lambda2,\r\n        sign = delta > 0 ? 1 : -1,\r\n        lambdai = inflection[0] * degrees * sign,\r\n        phii,\r\n        antimeridian = abs(delta) > 180;\r\n    if (antimeridian ^ (sign * lambda2 < lambdai && lambdai < sign * lambda)) {\r\n      phii = inflection[1] * degrees;\r\n      if (phii > phi1) phi1 = phii;\r\n    } else if (lambdai = (lambdai + 360) % 360 - 180, antimeridian ^ (sign * lambda2 < lambdai && lambdai < sign * lambda)) {\r\n      phii = -inflection[1] * degrees;\r\n      if (phii < phi0) phi0 = phii;\r\n    } else {\r\n      if (phi < phi0) phi0 = phi;\r\n      if (phi > phi1) phi1 = phi;\r\n    }\r\n    if (antimeridian) {\r\n      if (lambda < lambda2) {\r\n        if (angle(lambda0$1, lambda) > angle(lambda0$1, lambda1)) lambda1 = lambda;\r\n      } else {\r\n        if (angle(lambda, lambda1) > angle(lambda0$1, lambda1)) lambda0$1 = lambda;\r\n      }\r\n    } else {\r\n      if (lambda1 >= lambda0$1) {\r\n        if (lambda < lambda0$1) lambda0$1 = lambda;\r\n        if (lambda > lambda1) lambda1 = lambda;\r\n      } else {\r\n        if (lambda > lambda2) {\r\n          if (angle(lambda0$1, lambda) > angle(lambda0$1, lambda1)) lambda1 = lambda;\r\n        } else {\r\n          if (angle(lambda, lambda1) > angle(lambda0$1, lambda1)) lambda0$1 = lambda;\r\n        }\r\n      }\r\n    }\r\n  } else {\r\n    ranges.push(range = [lambda0$1 = lambda, lambda1 = lambda]);\r\n  }\r\n  if (phi < phi0) phi0 = phi;\r\n  if (phi > phi1) phi1 = phi;\r\n  p0 = p, lambda2 = lambda;\r\n}\r\n\r\nfunction boundsLineStart() {\r\n  boundsStream.point = linePoint;\r\n}\r\n\r\nfunction boundsLineEnd() {\r\n  range[0] = lambda0$1, range[1] = lambda1;\r\n  boundsStream.point = boundsPoint;\r\n  p0 = null;\r\n}\r\n\r\nfunction boundsRingPoint(lambda, phi) {\r\n  if (p0) {\r\n    var delta = lambda - lambda2;\r\n    deltaSum.add(abs(delta) > 180 ? delta + (delta > 0 ? 360 : -360) : delta);\r\n  } else {\r\n    lambda00$1 = lambda, phi00$1 = phi;\r\n  }\r\n  areaStream.point(lambda, phi);\r\n  linePoint(lambda, phi);\r\n}\r\n\r\nfunction boundsRingStart() {\r\n  areaStream.lineStart();\r\n}\r\n\r\nfunction boundsRingEnd() {\r\n  boundsRingPoint(lambda00$1, phi00$1);\r\n  areaStream.lineEnd();\r\n  if (abs(deltaSum) > epsilon) lambda0$1 = -(lambda1 = 180);\r\n  range[0] = lambda0$1, range[1] = lambda1;\r\n  p0 = null;\r\n}\r\n\r\n// Finds the left-right distance between two longitudes.\r\n// This is almost the same as (lambda1 - lambda0 + 360) % 360, except that we want\r\n// the distance between 180 to be 360.\r\nfunction angle(lambda0, lambda1) {\r\n  return (lambda1 -= lambda0) < 0 ? lambda1 + 360 : lambda1;\r\n}\r\n\r\nfunction rangeCompare(a, b) {\r\n  return a[0] - b[0];\r\n}\r\n\r\nfunction rangeContains(range, x) {\r\n  return range[0] <= range[1] ? range[0] <= x && x <= range[1] : x < range[0] || range[1] < x;\r\n}\r\n\r\nfunction bounds(feature) {\r\n  var i, n, a, b, merged, deltaMax, delta;\r\n\r\n  phi1 = lambda1 = -(lambda0$1 = phi0 = Infinity);\r\n  ranges = [];\r\n  geoStream(feature, boundsStream);\r\n\r\n  // First, sort ranges by their minimum longitudes.\r\n  if (n = ranges.length) {\r\n    ranges.sort(rangeCompare);\r\n\r\n    // Then, merge any ranges that overlap.\r\n    for (i = 1, a = ranges[0], merged = [a]; i < n; ++i) {\r\n      b = ranges[i];\r\n      if (rangeContains(a, b[0]) || rangeContains(a, b[1])) {\r\n        if (angle(a[0], b[1]) > angle(a[0], a[1])) a[1] = b[1];\r\n        if (angle(b[0], a[1]) > angle(a[0], a[1])) a[0] = b[0];\r\n      } else {\r\n        merged.push(a = b);\r\n      }\r\n    }\r\n\r\n    // Finally, find the largest gap between the merged ranges.\r\n    // The final bounding box will be the inverse of this gap.\r\n    for (deltaMax = -Infinity, n = merged.length - 1, i = 0, a = merged[n]; i <= n; a = b, ++i) {\r\n      b = merged[i];\r\n      if ((delta = angle(a[1], b[0])) > deltaMax) deltaMax = delta, lambda0$1 = b[0], lambda1 = a[1];\r\n    }\r\n  }\r\n\r\n  ranges = range = null;\r\n\r\n  return lambda0$1 === Infinity || phi0 === Infinity\r\n      ? [[NaN, NaN], [NaN, NaN]]\r\n      : [[lambda0$1, phi0], [lambda1, phi1]];\r\n}\r\n\r\nvar W0, W1,\r\n    X0, Y0, Z0,\r\n    X1, Y1, Z1,\r\n    X2, Y2, Z2,\r\n    lambda00$2, phi00$2, // first point\r\n    x0, y0, z0; // previous point\r\n\r\nvar centroidStream = {\r\n  sphere: noop,\r\n  point: centroidPoint,\r\n  lineStart: centroidLineStart,\r\n  lineEnd: centroidLineEnd,\r\n  polygonStart: function() {\r\n    centroidStream.lineStart = centroidRingStart;\r\n    centroidStream.lineEnd = centroidRingEnd;\r\n  },\r\n  polygonEnd: function() {\r\n    centroidStream.lineStart = centroidLineStart;\r\n    centroidStream.lineEnd = centroidLineEnd;\r\n  }\r\n};\r\n\r\n// Arithmetic mean of Cartesian vectors.\r\nfunction centroidPoint(lambda, phi) {\r\n  lambda *= radians, phi *= radians;\r\n  var cosPhi = cos(phi);\r\n  centroidPointCartesian(cosPhi * cos(lambda), cosPhi * sin(lambda), sin(phi));\r\n}\r\n\r\nfunction centroidPointCartesian(x, y, z) {\r\n  ++W0;\r\n  X0 += (x - X0) / W0;\r\n  Y0 += (y - Y0) / W0;\r\n  Z0 += (z - Z0) / W0;\r\n}\r\n\r\nfunction centroidLineStart() {\r\n  centroidStream.point = centroidLinePointFirst;\r\n}\r\n\r\nfunction centroidLinePointFirst(lambda, phi) {\r\n  lambda *= radians, phi *= radians;\r\n  var cosPhi = cos(phi);\r\n  x0 = cosPhi * cos(lambda);\r\n  y0 = cosPhi * sin(lambda);\r\n  z0 = sin(phi);\r\n  centroidStream.point = centroidLinePoint;\r\n  centroidPointCartesian(x0, y0, z0);\r\n}\r\n\r\nfunction centroidLinePoint(lambda, phi) {\r\n  lambda *= radians, phi *= radians;\r\n  var cosPhi = cos(phi),\r\n      x = cosPhi * cos(lambda),\r\n      y = cosPhi * sin(lambda),\r\n      z = sin(phi),\r\n      w = atan2(sqrt((w = y0 * z - z0 * y) * w + (w = z0 * x - x0 * z) * w + (w = x0 * y - y0 * x) * w), x0 * x + y0 * y + z0 * z);\r\n  W1 += w;\r\n  X1 += w * (x0 + (x0 = x));\r\n  Y1 += w * (y0 + (y0 = y));\r\n  Z1 += w * (z0 + (z0 = z));\r\n  centroidPointCartesian(x0, y0, z0);\r\n}\r\n\r\nfunction centroidLineEnd() {\r\n  centroidStream.point = centroidPoint;\r\n}\r\n\r\n// See J. E. Brock, The Inertia Tensor for a Spherical Triangle,\r\n// J. Applied Mechanics 42, 239 (1975).\r\nfunction centroidRingStart() {\r\n  centroidStream.point = centroidRingPointFirst;\r\n}\r\n\r\nfunction centroidRingEnd() {\r\n  centroidRingPoint(lambda00$2, phi00$2);\r\n  centroidStream.point = centroidPoint;\r\n}\r\n\r\nfunction centroidRingPointFirst(lambda, phi) {\r\n  lambda00$2 = lambda, phi00$2 = phi;\r\n  lambda *= radians, phi *= radians;\r\n  centroidStream.point = centroidRingPoint;\r\n  var cosPhi = cos(phi);\r\n  x0 = cosPhi * cos(lambda);\r\n  y0 = cosPhi * sin(lambda);\r\n  z0 = sin(phi);\r\n  centroidPointCartesian(x0, y0, z0);\r\n}\r\n\r\nfunction centroidRingPoint(lambda, phi) {\r\n  lambda *= radians, phi *= radians;\r\n  var cosPhi = cos(phi),\r\n      x = cosPhi * cos(lambda),\r\n      y = cosPhi * sin(lambda),\r\n      z = sin(phi),\r\n      cx = y0 * z - z0 * y,\r\n      cy = z0 * x - x0 * z,\r\n      cz = x0 * y - y0 * x,\r\n      m = hypot(cx, cy, cz),\r\n      w = asin(m), // line weight = angle\r\n      v = m && -w / m; // area weight multiplier\r\n  X2.add(v * cx);\r\n  Y2.add(v * cy);\r\n  Z2.add(v * cz);\r\n  W1 += w;\r\n  X1 += w * (x0 + (x0 = x));\r\n  Y1 += w * (y0 + (y0 = y));\r\n  Z1 += w * (z0 + (z0 = z));\r\n  centroidPointCartesian(x0, y0, z0);\r\n}\r\n\r\nfunction centroid(object) {\r\n  W0 = W1 =\r\n  X0 = Y0 = Z0 =\r\n  X1 = Y1 = Z1 = 0;\r\n  X2 = new Adder();\r\n  Y2 = new Adder();\r\n  Z2 = new Adder();\r\n  geoStream(object, centroidStream);\r\n\r\n  var x = +X2,\r\n      y = +Y2,\r\n      z = +Z2,\r\n      m = hypot(x, y, z);\r\n\r\n  // If the area-weighted ccentroid is undefined, fall back to length-weighted ccentroid.\r\n  if (m < epsilon2) {\r\n    x = X1, y = Y1, z = Z1;\r\n    // If the feature has zero length, fall back to arithmetic mean of point vectors.\r\n    if (W1 < epsilon) x = X0, y = Y0, z = Z0;\r\n    m = hypot(x, y, z);\r\n    // If the feature still has an undefined ccentroid, then return.\r\n    if (m < epsilon2) return [NaN, NaN];\r\n  }\r\n\r\n  return [atan2(y, x) * degrees, asin(z / m) * degrees];\r\n}\r\n\r\nfunction constant(x) {\r\n  return function() {\r\n    return x;\r\n  };\r\n}\r\n\r\nfunction compose(a, b) {\r\n\r\n  function compose(x, y) {\r\n    return x = a(x, y), b(x[0], x[1]);\r\n  }\r\n\r\n  if (a.invert && b.invert) compose.invert = function(x, y) {\r\n    return x = b.invert(x, y), x && a.invert(x[0], x[1]);\r\n  };\r\n\r\n  return compose;\r\n}\r\n\r\nfunction rotationIdentity(lambda, phi) {\r\n  return [abs(lambda) > pi ? lambda + Math.round(-lambda / tau) * tau : lambda, phi];\r\n}\r\n\r\nrotationIdentity.invert = rotationIdentity;\r\n\r\nfunction rotateRadians(deltaLambda, deltaPhi, deltaGamma) {\r\n  return (deltaLambda %= tau) ? (deltaPhi || deltaGamma ? compose(rotationLambda(deltaLambda), rotationPhiGamma(deltaPhi, deltaGamma))\r\n    : rotationLambda(deltaLambda))\r\n    : (deltaPhi || deltaGamma ? rotationPhiGamma(deltaPhi, deltaGamma)\r\n    : rotationIdentity);\r\n}\r\n\r\nfunction forwardRotationLambda(deltaLambda) {\r\n  return function(lambda, phi) {\r\n    return lambda += deltaLambda, [lambda > pi ? lambda - tau : lambda < -pi ? lambda + tau : lambda, phi];\r\n  };\r\n}\r\n\r\nfunction rotationLambda(deltaLambda) {\r\n  var rotation = forwardRotationLambda(deltaLambda);\r\n  rotation.invert = forwardRotationLambda(-deltaLambda);\r\n  return rotation;\r\n}\r\n\r\nfunction rotationPhiGamma(deltaPhi, deltaGamma) {\r\n  var cosDeltaPhi = cos(deltaPhi),\r\n      sinDeltaPhi = sin(deltaPhi),\r\n      cosDeltaGamma = cos(deltaGamma),\r\n      sinDeltaGamma = sin(deltaGamma);\r\n\r\n  function rotation(lambda, phi) {\r\n    var cosPhi = cos(phi),\r\n        x = cos(lambda) * cosPhi,\r\n        y = sin(lambda) * cosPhi,\r\n        z = sin(phi),\r\n        k = z * cosDeltaPhi + x * sinDeltaPhi;\r\n    return [\r\n      atan2(y * cosDeltaGamma - k * sinDeltaGamma, x * cosDeltaPhi - z * sinDeltaPhi),\r\n      asin(k * cosDeltaGamma + y * sinDeltaGamma)\r\n    ];\r\n  }\r\n\r\n  rotation.invert = function(lambda, phi) {\r\n    var cosPhi = cos(phi),\r\n        x = cos(lambda) * cosPhi,\r\n        y = sin(lambda) * cosPhi,\r\n        z = sin(phi),\r\n        k = z * cosDeltaGamma - y * sinDeltaGamma;\r\n    return [\r\n      atan2(y * cosDeltaGamma + z * sinDeltaGamma, x * cosDeltaPhi + k * sinDeltaPhi),\r\n      asin(k * cosDeltaPhi - x * sinDeltaPhi)\r\n    ];\r\n  };\r\n\r\n  return rotation;\r\n}\r\n\r\nfunction rotation(rotate) {\r\n  rotate = rotateRadians(rotate[0] * radians, rotate[1] * radians, rotate.length > 2 ? rotate[2] * radians : 0);\r\n\r\n  function forward(coordinates) {\r\n    coordinates = rotate(coordinates[0] * radians, coordinates[1] * radians);\r\n    return coordinates[0] *= degrees, coordinates[1] *= degrees, coordinates;\r\n  }\r\n\r\n  forward.invert = function(coordinates) {\r\n    coordinates = rotate.invert(coordinates[0] * radians, coordinates[1] * radians);\r\n    return coordinates[0] *= degrees, coordinates[1] *= degrees, coordinates;\r\n  };\r\n\r\n  return forward;\r\n}\r\n\r\n// Generates a circle centered at [0, 0], with a given radius and precision.\r\nfunction circleStream(stream, radius, delta, direction, t0, t1) {\r\n  if (!delta) return;\r\n  var cosRadius = cos(radius),\r\n      sinRadius = sin(radius),\r\n      step = direction * delta;\r\n  if (t0 == null) {\r\n    t0 = radius + direction * tau;\r\n    t1 = radius - step / 2;\r\n  } else {\r\n    t0 = circleRadius(cosRadius, t0);\r\n    t1 = circleRadius(cosRadius, t1);\r\n    if (direction > 0 ? t0 < t1 : t0 > t1) t0 += direction * tau;\r\n  }\r\n  for (var point, t = t0; direction > 0 ? t > t1 : t < t1; t -= step) {\r\n    point = spherical([cosRadius, -sinRadius * cos(t), -sinRadius * sin(t)]);\r\n    stream.point(point[0], point[1]);\r\n  }\r\n}\r\n\r\n// Returns the signed angle of a cartesian point relative to [cosRadius, 0, 0].\r\nfunction circleRadius(cosRadius, point) {\r\n  point = cartesian(point), point[0] -= cosRadius;\r\n  cartesianNormalizeInPlace(point);\r\n  var radius = acos(-point[1]);\r\n  return ((-point[2] < 0 ? -radius : radius) + tau - epsilon) % tau;\r\n}\r\n\r\nfunction circle() {\r\n  var center = constant([0, 0]),\r\n      radius = constant(90),\r\n      precision = constant(6),\r\n      ring,\r\n      rotate,\r\n      stream = {point: point};\r\n\r\n  function point(x, y) {\r\n    ring.push(x = rotate(x, y));\r\n    x[0] *= degrees, x[1] *= degrees;\r\n  }\r\n\r\n  function circle() {\r\n    var c = center.apply(this, arguments),\r\n        r = radius.apply(this, arguments) * radians,\r\n        p = precision.apply(this, arguments) * radians;\r\n    ring = [];\r\n    rotate = rotateRadians(-c[0] * radians, -c[1] * radians, 0).invert;\r\n    circleStream(stream, r, p, 1);\r\n    c = {type: \"Polygon\", coordinates: [ring]};\r\n    ring = rotate = null;\r\n    return c;\r\n  }\r\n\r\n  circle.center = function(_) {\r\n    return arguments.length ? (center = typeof _ === \"function\" ? _ : constant([+_[0], +_[1]]), circle) : center;\r\n  };\r\n\r\n  circle.radius = function(_) {\r\n    return arguments.length ? (radius = typeof _ === \"function\" ? _ : constant(+_), circle) : radius;\r\n  };\r\n\r\n  circle.precision = function(_) {\r\n    return arguments.length ? (precision = typeof _ === \"function\" ? _ : constant(+_), circle) : precision;\r\n  };\r\n\r\n  return circle;\r\n}\r\n\r\nfunction clipBuffer() {\r\n  var lines = [],\r\n      line;\r\n  return {\r\n    point: function(x, y, m) {\r\n      line.push([x, y, m]);\r\n    },\r\n    lineStart: function() {\r\n      lines.push(line = []);\r\n    },\r\n    lineEnd: noop,\r\n    rejoin: function() {\r\n      if (lines.length > 1) lines.push(lines.pop().concat(lines.shift()));\r\n    },\r\n    result: function() {\r\n      var result = lines;\r\n      lines = [];\r\n      line = null;\r\n      return result;\r\n    }\r\n  };\r\n}\r\n\r\nfunction pointEqual(a, b) {\r\n  return abs(a[0] - b[0]) < epsilon && abs(a[1] - b[1]) < epsilon;\r\n}\r\n\r\nfunction Intersection(point, points, other, entry) {\r\n  this.x = point;\r\n  this.z = points;\r\n  this.o = other; // another intersection\r\n  this.e = entry; // is an entry?\r\n  this.v = false; // visited\r\n  this.n = this.p = null; // next & previous\r\n}\r\n\r\n// A generalized polygon clipping algorithm: given a polygon that has been cut\r\n// into its visible line segments, and rejoins the segments by interpolating\r\n// along the clip edge.\r\nfunction clipRejoin(segments, compareIntersection, startInside, interpolate, stream) {\r\n  var subject = [],\r\n      clip = [],\r\n      i,\r\n      n;\r\n\r\n  segments.forEach(function(segment) {\r\n    if ((n = segment.length - 1) <= 0) return;\r\n    var n, p0 = segment[0], p1 = segment[n], x;\r\n\r\n    if (pointEqual(p0, p1)) {\r\n      if (!p0[2] && !p1[2]) {\r\n        stream.lineStart();\r\n        for (i = 0; i < n; ++i) stream.point((p0 = segment[i])[0], p0[1]);\r\n        stream.lineEnd();\r\n        return;\r\n      }\r\n      // handle degenerate cases by moving the point\r\n      p1[0] += 2 * epsilon;\r\n    }\r\n\r\n    subject.push(x = new Intersection(p0, segment, null, true));\r\n    clip.push(x.o = new Intersection(p0, null, x, false));\r\n    subject.push(x = new Intersection(p1, segment, null, false));\r\n    clip.push(x.o = new Intersection(p1, null, x, true));\r\n  });\r\n\r\n  if (!subject.length) return;\r\n\r\n  clip.sort(compareIntersection);\r\n  link(subject);\r\n  link(clip);\r\n\r\n  for (i = 0, n = clip.length; i < n; ++i) {\r\n    clip[i].e = startInside = !startInside;\r\n  }\r\n\r\n  var start = subject[0],\r\n      points,\r\n      point;\r\n\r\n  while (1) {\r\n    // Find first unvisited intersection.\r\n    var current = start,\r\n        isSubject = true;\r\n    while (current.v) if ((current = current.n) === start) return;\r\n    points = current.z;\r\n    stream.lineStart();\r\n    do {\r\n      current.v = current.o.v = true;\r\n      if (current.e) {\r\n        if (isSubject) {\r\n          for (i = 0, n = points.length; i < n; ++i) stream.point((point = points[i])[0], point[1]);\r\n        } else {\r\n          interpolate(current.x, current.n.x, 1, stream);\r\n        }\r\n        current = current.n;\r\n      } else {\r\n        if (isSubject) {\r\n          points = current.p.z;\r\n          for (i = points.length - 1; i >= 0; --i) stream.point((point = points[i])[0], point[1]);\r\n        } else {\r\n          interpolate(current.x, current.p.x, -1, stream);\r\n        }\r\n        current = current.p;\r\n      }\r\n      current = current.o;\r\n      points = current.z;\r\n      isSubject = !isSubject;\r\n    } while (!current.v);\r\n    stream.lineEnd();\r\n  }\r\n}\r\n\r\nfunction link(array) {\r\n  if (!(n = array.length)) return;\r\n  var n,\r\n      i = 0,\r\n      a = array[0],\r\n      b;\r\n  while (++i < n) {\r\n    a.n = b = array[i];\r\n    b.p = a;\r\n    a = b;\r\n  }\r\n  a.n = b = array[0];\r\n  b.p = a;\r\n}\r\n\r\nfunction longitude(point) {\r\n  return abs(point[0]) <= pi ? point[0] : sign(point[0]) * ((abs(point[0]) + pi) % tau - pi);\r\n}\r\n\r\nfunction polygonContains(polygon, point) {\r\n  var lambda = longitude(point),\r\n      phi = point[1],\r\n      sinPhi = sin(phi),\r\n      normal = [sin(lambda), -cos(lambda), 0],\r\n      angle = 0,\r\n      winding = 0;\r\n\r\n  var sum = new Adder();\r\n\r\n  if (sinPhi === 1) phi = halfPi + epsilon;\r\n  else if (sinPhi === -1) phi = -halfPi - epsilon;\r\n\r\n  for (var i = 0, n = polygon.length; i < n; ++i) {\r\n    if (!(m = (ring = polygon[i]).length)) continue;\r\n    var ring,\r\n        m,\r\n        point0 = ring[m - 1],\r\n        lambda0 = longitude(point0),\r\n        phi0 = point0[1] / 2 + quarterPi,\r\n        sinPhi0 = sin(phi0),\r\n        cosPhi0 = cos(phi0);\r\n\r\n    for (var j = 0; j < m; ++j, lambda0 = lambda1, sinPhi0 = sinPhi1, cosPhi0 = cosPhi1, point0 = point1) {\r\n      var point1 = ring[j],\r\n          lambda1 = longitude(point1),\r\n          phi1 = point1[1] / 2 + quarterPi,\r\n          sinPhi1 = sin(phi1),\r\n          cosPhi1 = cos(phi1),\r\n          delta = lambda1 - lambda0,\r\n          sign = delta >= 0 ? 1 : -1,\r\n          absDelta = sign * delta,\r\n          antimeridian = absDelta > pi,\r\n          k = sinPhi0 * sinPhi1;\r\n\r\n      sum.add(atan2(k * sign * sin(absDelta), cosPhi0 * cosPhi1 + k * cos(absDelta)));\r\n      angle += antimeridian ? delta + sign * tau : delta;\r\n\r\n      // Are the longitudes either side of the points meridian (lambda),\r\n      // and are the latitudes smaller than the parallel (phi)?\r\n      if (antimeridian ^ lambda0 >= lambda ^ lambda1 >= lambda) {\r\n        var arc = cartesianCross(cartesian(point0), cartesian(point1));\r\n        cartesianNormalizeInPlace(arc);\r\n        var intersection = cartesianCross(normal, arc);\r\n        cartesianNormalizeInPlace(intersection);\r\n        var phiArc = (antimeridian ^ delta >= 0 ? -1 : 1) * asin(intersection[2]);\r\n        if (phi > phiArc || phi === phiArc && (arc[0] || arc[1])) {\r\n          winding += antimeridian ^ delta >= 0 ? 1 : -1;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  // First, determine whether the South pole is inside or outside:\r\n  //\r\n  // It is inside if:\r\n  // * the polygon winds around it in a clockwise direction.\r\n  // * the polygon does not (cumulatively) wind around it, but has a negative\r\n  //   (counter-clockwise) area.\r\n  //\r\n  // Second, count the (signed) number of times a segment crosses a lambda\r\n  // from the point to the South pole.  If it is zero, then the point is the\r\n  // same side as the South pole.\r\n\r\n  return (angle < -epsilon || angle < epsilon && sum < -epsilon2) ^ (winding & 1);\r\n}\r\n\r\nfunction clip(pointVisible, clipLine, interpolate, start) {\r\n  return function(sink) {\r\n    var line = clipLine(sink),\r\n        ringBuffer = clipBuffer(),\r\n        ringSink = clipLine(ringBuffer),\r\n        polygonStarted = false,\r\n        polygon,\r\n        segments,\r\n        ring;\r\n\r\n    var clip = {\r\n      point: point,\r\n      lineStart: lineStart,\r\n      lineEnd: lineEnd,\r\n      polygonStart: function() {\r\n        clip.point = pointRing;\r\n        clip.lineStart = ringStart;\r\n        clip.lineEnd = ringEnd;\r\n        segments = [];\r\n        polygon = [];\r\n      },\r\n      polygonEnd: function() {\r\n        clip.point = point;\r\n        clip.lineStart = lineStart;\r\n        clip.lineEnd = lineEnd;\r\n        segments = merge(segments);\r\n        var startInside = polygonContains(polygon, start);\r\n        if (segments.length) {\r\n          if (!polygonStarted) sink.polygonStart(), polygonStarted = true;\r\n          clipRejoin(segments, compareIntersection, startInside, interpolate, sink);\r\n        } else if (startInside) {\r\n          if (!polygonStarted) sink.polygonStart(), polygonStarted = true;\r\n          sink.lineStart();\r\n          interpolate(null, null, 1, sink);\r\n          sink.lineEnd();\r\n        }\r\n        if (polygonStarted) sink.polygonEnd(), polygonStarted = false;\r\n        segments = polygon = null;\r\n      },\r\n      sphere: function() {\r\n        sink.polygonStart();\r\n        sink.lineStart();\r\n        interpolate(null, null, 1, sink);\r\n        sink.lineEnd();\r\n        sink.polygonEnd();\r\n      }\r\n    };\r\n\r\n    function point(lambda, phi) {\r\n      if (pointVisible(lambda, phi)) sink.point(lambda, phi);\r\n    }\r\n\r\n    function pointLine(lambda, phi) {\r\n      line.point(lambda, phi);\r\n    }\r\n\r\n    function lineStart() {\r\n      clip.point = pointLine;\r\n      line.lineStart();\r\n    }\r\n\r\n    function lineEnd() {\r\n      clip.point = point;\r\n      line.lineEnd();\r\n    }\r\n\r\n    function pointRing(lambda, phi) {\r\n      ring.push([lambda, phi]);\r\n      ringSink.point(lambda, phi);\r\n    }\r\n\r\n    function ringStart() {\r\n      ringSink.lineStart();\r\n      ring = [];\r\n    }\r\n\r\n    function ringEnd() {\r\n      pointRing(ring[0][0], ring[0][1]);\r\n      ringSink.lineEnd();\r\n\r\n      var clean = ringSink.clean(),\r\n          ringSegments = ringBuffer.result(),\r\n          i, n = ringSegments.length, m,\r\n          segment,\r\n          point;\r\n\r\n      ring.pop();\r\n      polygon.push(ring);\r\n      ring = null;\r\n\r\n      if (!n) return;\r\n\r\n      // No intersections.\r\n      if (clean & 1) {\r\n        segment = ringSegments[0];\r\n        if ((m = segment.length - 1) > 0) {\r\n          if (!polygonStarted) sink.polygonStart(), polygonStarted = true;\r\n          sink.lineStart();\r\n          for (i = 0; i < m; ++i) sink.point((point = segment[i])[0], point[1]);\r\n          sink.lineEnd();\r\n        }\r\n        return;\r\n      }\r\n\r\n      // Rejoin connected segments.\r\n      // TODO reuse ringBuffer.rejoin()?\r\n      if (n > 1 && clean & 2) ringSegments.push(ringSegments.pop().concat(ringSegments.shift()));\r\n\r\n      segments.push(ringSegments.filter(validSegment));\r\n    }\r\n\r\n    return clip;\r\n  };\r\n}\r\n\r\nfunction validSegment(segment) {\r\n  return segment.length > 1;\r\n}\r\n\r\n// Intersections are sorted along the clip edge. For both antimeridian cutting\r\n// and circle clipping, the same comparison is used.\r\nfunction compareIntersection(a, b) {\r\n  return ((a = a.x)[0] < 0 ? a[1] - halfPi - epsilon : halfPi - a[1])\r\n       - ((b = b.x)[0] < 0 ? b[1] - halfPi - epsilon : halfPi - b[1]);\r\n}\r\n\r\nvar clipAntimeridian = clip(\r\n  function() { return true; },\r\n  clipAntimeridianLine,\r\n  clipAntimeridianInterpolate,\r\n  [-pi, -halfPi]\r\n);\r\n\r\n// Takes a line and cuts into visible segments. Return values: 0 - there were\r\n// intersections or the line was empty; 1 - no intersections; 2 - there were\r\n// intersections, and the first and last segments should be rejoined.\r\nfunction clipAntimeridianLine(stream) {\r\n  var lambda0 = NaN,\r\n      phi0 = NaN,\r\n      sign0 = NaN,\r\n      clean; // no intersections\r\n\r\n  return {\r\n    lineStart: function() {\r\n      stream.lineStart();\r\n      clean = 1;\r\n    },\r\n    point: function(lambda1, phi1) {\r\n      var sign1 = lambda1 > 0 ? pi : -pi,\r\n          delta = abs(lambda1 - lambda0);\r\n      if (abs(delta - pi) < epsilon) { // line crosses a pole\r\n        stream.point(lambda0, phi0 = (phi0 + phi1) / 2 > 0 ? halfPi : -halfPi);\r\n        stream.point(sign0, phi0);\r\n        stream.lineEnd();\r\n        stream.lineStart();\r\n        stream.point(sign1, phi0);\r\n        stream.point(lambda1, phi0);\r\n        clean = 0;\r\n      } else if (sign0 !== sign1 && delta >= pi) { // line crosses antimeridian\r\n        if (abs(lambda0 - sign0) < epsilon) lambda0 -= sign0 * epsilon; // handle degeneracies\r\n        if (abs(lambda1 - sign1) < epsilon) lambda1 -= sign1 * epsilon;\r\n        phi0 = clipAntimeridianIntersect(lambda0, phi0, lambda1, phi1);\r\n        stream.point(sign0, phi0);\r\n        stream.lineEnd();\r\n        stream.lineStart();\r\n        stream.point(sign1, phi0);\r\n        clean = 0;\r\n      }\r\n      stream.point(lambda0 = lambda1, phi0 = phi1);\r\n      sign0 = sign1;\r\n    },\r\n    lineEnd: function() {\r\n      stream.lineEnd();\r\n      lambda0 = phi0 = NaN;\r\n    },\r\n    clean: function() {\r\n      return 2 - clean; // if intersections, rejoin first and last segments\r\n    }\r\n  };\r\n}\r\n\r\nfunction clipAntimeridianIntersect(lambda0, phi0, lambda1, phi1) {\r\n  var cosPhi0,\r\n      cosPhi1,\r\n      sinLambda0Lambda1 = sin(lambda0 - lambda1);\r\n  return abs(sinLambda0Lambda1) > epsilon\r\n      ? atan((sin(phi0) * (cosPhi1 = cos(phi1)) * sin(lambda1)\r\n          - sin(phi1) * (cosPhi0 = cos(phi0)) * sin(lambda0))\r\n          / (cosPhi0 * cosPhi1 * sinLambda0Lambda1))\r\n      : (phi0 + phi1) / 2;\r\n}\r\n\r\nfunction clipAntimeridianInterpolate(from, to, direction, stream) {\r\n  var phi;\r\n  if (from == null) {\r\n    phi = direction * halfPi;\r\n    stream.point(-pi, phi);\r\n    stream.point(0, phi);\r\n    stream.point(pi, phi);\r\n    stream.point(pi, 0);\r\n    stream.point(pi, -phi);\r\n    stream.point(0, -phi);\r\n    stream.point(-pi, -phi);\r\n    stream.point(-pi, 0);\r\n    stream.point(-pi, phi);\r\n  } else if (abs(from[0] - to[0]) > epsilon) {\r\n    var lambda = from[0] < to[0] ? pi : -pi;\r\n    phi = direction * lambda / 2;\r\n    stream.point(-lambda, phi);\r\n    stream.point(0, phi);\r\n    stream.point(lambda, phi);\r\n  } else {\r\n    stream.point(to[0], to[1]);\r\n  }\r\n}\r\n\r\nfunction clipCircle(radius) {\r\n  var cr = cos(radius),\r\n      delta = 6 * radians,\r\n      smallRadius = cr > 0,\r\n      notHemisphere = abs(cr) > epsilon; // TODO optimise for this common case\r\n\r\n  function interpolate(from, to, direction, stream) {\r\n    circleStream(stream, radius, delta, direction, from, to);\r\n  }\r\n\r\n  function visible(lambda, phi) {\r\n    return cos(lambda) * cos(phi) > cr;\r\n  }\r\n\r\n  // Takes a line and cuts into visible segments. Return values used for polygon\r\n  // clipping: 0 - there were intersections or the line was empty; 1 - no\r\n  // intersections 2 - there were intersections, and the first and last segments\r\n  // should be rejoined.\r\n  function clipLine(stream) {\r\n    var point0, // previous point\r\n        c0, // code for previous point\r\n        v0, // visibility of previous point\r\n        v00, // visibility of first point\r\n        clean; // no intersections\r\n    return {\r\n      lineStart: function() {\r\n        v00 = v0 = false;\r\n        clean = 1;\r\n      },\r\n      point: function(lambda, phi) {\r\n        var point1 = [lambda, phi],\r\n            point2,\r\n            v = visible(lambda, phi),\r\n            c = smallRadius\r\n              ? v ? 0 : code(lambda, phi)\r\n              : v ? code(lambda + (lambda < 0 ? pi : -pi), phi) : 0;\r\n        if (!point0 && (v00 = v0 = v)) stream.lineStart();\r\n        if (v !== v0) {\r\n          point2 = intersect(point0, point1);\r\n          if (!point2 || pointEqual(point0, point2) || pointEqual(point1, point2))\r\n            point1[2] = 1;\r\n        }\r\n        if (v !== v0) {\r\n          clean = 0;\r\n          if (v) {\r\n            // outside going in\r\n            stream.lineStart();\r\n            point2 = intersect(point1, point0);\r\n            stream.point(point2[0], point2[1]);\r\n          } else {\r\n            // inside going out\r\n            point2 = intersect(point0, point1);\r\n            stream.point(point2[0], point2[1], 2);\r\n            stream.lineEnd();\r\n          }\r\n          point0 = point2;\r\n        } else if (notHemisphere && point0 && smallRadius ^ v) {\r\n          var t;\r\n          // If the codes for two points are different, or are both zero,\r\n          // and there this segment intersects with the small circle.\r\n          if (!(c & c0) && (t = intersect(point1, point0, true))) {\r\n            clean = 0;\r\n            if (smallRadius) {\r\n              stream.lineStart();\r\n              stream.point(t[0][0], t[0][1]);\r\n              stream.point(t[1][0], t[1][1]);\r\n              stream.lineEnd();\r\n            } else {\r\n              stream.point(t[1][0], t[1][1]);\r\n              stream.lineEnd();\r\n              stream.lineStart();\r\n              stream.point(t[0][0], t[0][1], 3);\r\n            }\r\n          }\r\n        }\r\n        if (v && (!point0 || !pointEqual(point0, point1))) {\r\n          stream.point(point1[0], point1[1]);\r\n        }\r\n        point0 = point1, v0 = v, c0 = c;\r\n      },\r\n      lineEnd: function() {\r\n        if (v0) stream.lineEnd();\r\n        point0 = null;\r\n      },\r\n      // Rejoin first and last segments if there were intersections and the first\r\n      // and last points were visible.\r\n      clean: function() {\r\n        return clean | ((v00 && v0) << 1);\r\n      }\r\n    };\r\n  }\r\n\r\n  // Intersects the great circle between a and b with the clip circle.\r\n  function intersect(a, b, two) {\r\n    var pa = cartesian(a),\r\n        pb = cartesian(b);\r\n\r\n    // We have two planes, n1.p = d1 and n2.p = d2.\r\n    // Find intersection line p(t) = c1 n1 + c2 n2 + t (n1  n2).\r\n    var n1 = [1, 0, 0], // normal\r\n        n2 = cartesianCross(pa, pb),\r\n        n2n2 = cartesianDot(n2, n2),\r\n        n1n2 = n2[0], // cartesianDot(n1, n2),\r\n        determinant = n2n2 - n1n2 * n1n2;\r\n\r\n    // Two polar points.\r\n    if (!determinant) return !two && a;\r\n\r\n    var c1 =  cr * n2n2 / determinant,\r\n        c2 = -cr * n1n2 / determinant,\r\n        n1xn2 = cartesianCross(n1, n2),\r\n        A = cartesianScale(n1, c1),\r\n        B = cartesianScale(n2, c2);\r\n    cartesianAddInPlace(A, B);\r\n\r\n    // Solve |p(t)|^2 = 1.\r\n    var u = n1xn2,\r\n        w = cartesianDot(A, u),\r\n        uu = cartesianDot(u, u),\r\n        t2 = w * w - uu * (cartesianDot(A, A) - 1);\r\n\r\n    if (t2 < 0) return;\r\n\r\n    var t = sqrt(t2),\r\n        q = cartesianScale(u, (-w - t) / uu);\r\n    cartesianAddInPlace(q, A);\r\n    q = spherical(q);\r\n\r\n    if (!two) return q;\r\n\r\n    // Two intersection points.\r\n    var lambda0 = a[0],\r\n        lambda1 = b[0],\r\n        phi0 = a[1],\r\n        phi1 = b[1],\r\n        z;\r\n\r\n    if (lambda1 < lambda0) z = lambda0, lambda0 = lambda1, lambda1 = z;\r\n\r\n    var delta = lambda1 - lambda0,\r\n        polar = abs(delta - pi) < epsilon,\r\n        meridian = polar || delta < epsilon;\r\n\r\n    if (!polar && phi1 < phi0) z = phi0, phi0 = phi1, phi1 = z;\r\n\r\n    // Check that the first point is between a and b.\r\n    if (meridian\r\n        ? polar\r\n          ? phi0 + phi1 > 0 ^ q[1] < (abs(q[0] - lambda0) < epsilon ? phi0 : phi1)\r\n          : phi0 <= q[1] && q[1] <= phi1\r\n        : delta > pi ^ (lambda0 <= q[0] && q[0] <= lambda1)) {\r\n      var q1 = cartesianScale(u, (-w + t) / uu);\r\n      cartesianAddInPlace(q1, A);\r\n      return [q, spherical(q1)];\r\n    }\r\n  }\r\n\r\n  // Generates a 4-bit vector representing the location of a point relative to\r\n  // the small circle's bounding box.\r\n  function code(lambda, phi) {\r\n    var r = smallRadius ? radius : pi - radius,\r\n        code = 0;\r\n    if (lambda < -r) code |= 1; // left\r\n    else if (lambda > r) code |= 2; // right\r\n    if (phi < -r) code |= 4; // below\r\n    else if (phi > r) code |= 8; // above\r\n    return code;\r\n  }\r\n\r\n  return clip(visible, clipLine, interpolate, smallRadius ? [0, -radius] : [-pi, radius - pi]);\r\n}\r\n\r\nfunction clipLine(a, b, x0, y0, x1, y1) {\r\n  var ax = a[0],\r\n      ay = a[1],\r\n      bx = b[0],\r\n      by = b[1],\r\n      t0 = 0,\r\n      t1 = 1,\r\n      dx = bx - ax,\r\n      dy = by - ay,\r\n      r;\r\n\r\n  r = x0 - ax;\r\n  if (!dx && r > 0) return;\r\n  r /= dx;\r\n  if (dx < 0) {\r\n    if (r < t0) return;\r\n    if (r < t1) t1 = r;\r\n  } else if (dx > 0) {\r\n    if (r > t1) return;\r\n    if (r > t0) t0 = r;\r\n  }\r\n\r\n  r = x1 - ax;\r\n  if (!dx && r < 0) return;\r\n  r /= dx;\r\n  if (dx < 0) {\r\n    if (r > t1) return;\r\n    if (r > t0) t0 = r;\r\n  } else if (dx > 0) {\r\n    if (r < t0) return;\r\n    if (r < t1) t1 = r;\r\n  }\r\n\r\n  r = y0 - ay;\r\n  if (!dy && r > 0) return;\r\n  r /= dy;\r\n  if (dy < 0) {\r\n    if (r < t0) return;\r\n    if (r < t1) t1 = r;\r\n  } else if (dy > 0) {\r\n    if (r > t1) return;\r\n    if (r > t0) t0 = r;\r\n  }\r\n\r\n  r = y1 - ay;\r\n  if (!dy && r < 0) return;\r\n  r /= dy;\r\n  if (dy < 0) {\r\n    if (r > t1) return;\r\n    if (r > t0) t0 = r;\r\n  } else if (dy > 0) {\r\n    if (r < t0) return;\r\n    if (r < t1) t1 = r;\r\n  }\r\n\r\n  if (t0 > 0) a[0] = ax + t0 * dx, a[1] = ay + t0 * dy;\r\n  if (t1 < 1) b[0] = ax + t1 * dx, b[1] = ay + t1 * dy;\r\n  return true;\r\n}\r\n\r\nvar clipMax = 1e9, clipMin = -clipMax;\r\n\r\n// TODO Use d3-polygons polygonContains here for the ring check?\r\n// TODO Eliminate duplicate buffering in clipBuffer and polygon.push?\r\n\r\nfunction clipRectangle(x0, y0, x1, y1) {\r\n\r\n  function visible(x, y) {\r\n    return x0 <= x && x <= x1 && y0 <= y && y <= y1;\r\n  }\r\n\r\n  function interpolate(from, to, direction, stream) {\r\n    var a = 0, a1 = 0;\r\n    if (from == null\r\n        || (a = corner(from, direction)) !== (a1 = corner(to, direction))\r\n        || comparePoint(from, to) < 0 ^ direction > 0) {\r\n      do stream.point(a === 0 || a === 3 ? x0 : x1, a > 1 ? y1 : y0);\r\n      while ((a = (a + direction + 4) % 4) !== a1);\r\n    } else {\r\n      stream.point(to[0], to[1]);\r\n    }\r\n  }\r\n\r\n  function corner(p, direction) {\r\n    return abs(p[0] - x0) < epsilon ? direction > 0 ? 0 : 3\r\n        : abs(p[0] - x1) < epsilon ? direction > 0 ? 2 : 1\r\n        : abs(p[1] - y0) < epsilon ? direction > 0 ? 1 : 0\r\n        : direction > 0 ? 3 : 2; // abs(p[1] - y1) < epsilon\r\n  }\r\n\r\n  function compareIntersection(a, b) {\r\n    return comparePoint(a.x, b.x);\r\n  }\r\n\r\n  function comparePoint(a, b) {\r\n    var ca = corner(a, 1),\r\n        cb = corner(b, 1);\r\n    return ca !== cb ? ca - cb\r\n        : ca === 0 ? b[1] - a[1]\r\n        : ca === 1 ? a[0] - b[0]\r\n        : ca === 2 ? a[1] - b[1]\r\n        : b[0] - a[0];\r\n  }\r\n\r\n  return function(stream) {\r\n    var activeStream = stream,\r\n        bufferStream = clipBuffer(),\r\n        segments,\r\n        polygon,\r\n        ring,\r\n        x__, y__, v__, // first point\r\n        x_, y_, v_, // previous point\r\n        first,\r\n        clean;\r\n\r\n    var clipStream = {\r\n      point: point,\r\n      lineStart: lineStart,\r\n      lineEnd: lineEnd,\r\n      polygonStart: polygonStart,\r\n      polygonEnd: polygonEnd\r\n    };\r\n\r\n    function point(x, y) {\r\n      if (visible(x, y)) activeStream.point(x, y);\r\n    }\r\n\r\n    function polygonInside() {\r\n      var winding = 0;\r\n\r\n      for (var i = 0, n = polygon.length; i < n; ++i) {\r\n        for (var ring = polygon[i], j = 1, m = ring.length, point = ring[0], a0, a1, b0 = point[0], b1 = point[1]; j < m; ++j) {\r\n          a0 = b0, a1 = b1, point = ring[j], b0 = point[0], b1 = point[1];\r\n          if (a1 <= y1) { if (b1 > y1 && (b0 - a0) * (y1 - a1) > (b1 - a1) * (x0 - a0)) ++winding; }\r\n          else { if (b1 <= y1 && (b0 - a0) * (y1 - a1) < (b1 - a1) * (x0 - a0)) --winding; }\r\n        }\r\n      }\r\n\r\n      return winding;\r\n    }\r\n\r\n    // Buffer geometry within a polygon and then clip it en masse.\r\n    function polygonStart() {\r\n      activeStream = bufferStream, segments = [], polygon = [], clean = true;\r\n    }\r\n\r\n    function polygonEnd() {\r\n      var startInside = polygonInside(),\r\n          cleanInside = clean && startInside,\r\n          visible = (segments = merge(segments)).length;\r\n      if (cleanInside || visible) {\r\n        stream.polygonStart();\r\n        if (cleanInside) {\r\n          stream.lineStart();\r\n          interpolate(null, null, 1, stream);\r\n          stream.lineEnd();\r\n        }\r\n        if (visible) {\r\n          clipRejoin(segments, compareIntersection, startInside, interpolate, stream);\r\n        }\r\n        stream.polygonEnd();\r\n      }\r\n      activeStream = stream, segments = polygon = ring = null;\r\n    }\r\n\r\n    function lineStart() {\r\n      clipStream.point = linePoint;\r\n      if (polygon) polygon.push(ring = []);\r\n      first = true;\r\n      v_ = false;\r\n      x_ = y_ = NaN;\r\n    }\r\n\r\n    // TODO rather than special-case polygons, simply handle them separately.\r\n    // Ideally, coincident intersection points should be jittered to avoid\r\n    // clipping issues.\r\n    function lineEnd() {\r\n      if (segments) {\r\n        linePoint(x__, y__);\r\n        if (v__ && v_) bufferStream.rejoin();\r\n        segments.push(bufferStream.result());\r\n      }\r\n      clipStream.point = point;\r\n      if (v_) activeStream.lineEnd();\r\n    }\r\n\r\n    function linePoint(x, y) {\r\n      var v = visible(x, y);\r\n      if (polygon) ring.push([x, y]);\r\n      if (first) {\r\n        x__ = x, y__ = y, v__ = v;\r\n        first = false;\r\n        if (v) {\r\n          activeStream.lineStart();\r\n          activeStream.point(x, y);\r\n        }\r\n      } else {\r\n        if (v && v_) activeStream.point(x, y);\r\n        else {\r\n          var a = [x_ = Math.max(clipMin, Math.min(clipMax, x_)), y_ = Math.max(clipMin, Math.min(clipMax, y_))],\r\n              b = [x = Math.max(clipMin, Math.min(clipMax, x)), y = Math.max(clipMin, Math.min(clipMax, y))];\r\n          if (clipLine(a, b, x0, y0, x1, y1)) {\r\n            if (!v_) {\r\n              activeStream.lineStart();\r\n              activeStream.point(a[0], a[1]);\r\n            }\r\n            activeStream.point(b[0], b[1]);\r\n            if (!v) activeStream.lineEnd();\r\n            clean = false;\r\n          } else if (v) {\r\n            activeStream.lineStart();\r\n            activeStream.point(x, y);\r\n            clean = false;\r\n          }\r\n        }\r\n      }\r\n      x_ = x, y_ = y, v_ = v;\r\n    }\r\n\r\n    return clipStream;\r\n  };\r\n}\r\n\r\nfunction extent() {\r\n  var x0 = 0,\r\n      y0 = 0,\r\n      x1 = 960,\r\n      y1 = 500,\r\n      cache,\r\n      cacheStream,\r\n      clip;\r\n\r\n  return clip = {\r\n    stream: function(stream) {\r\n      return cache && cacheStream === stream ? cache : cache = clipRectangle(x0, y0, x1, y1)(cacheStream = stream);\r\n    },\r\n    extent: function(_) {\r\n      return arguments.length ? (x0 = +_[0][0], y0 = +_[0][1], x1 = +_[1][0], y1 = +_[1][1], cache = cacheStream = null, clip) : [[x0, y0], [x1, y1]];\r\n    }\r\n  };\r\n}\r\n\r\nvar lengthSum,\r\n    lambda0$2,\r\n    sinPhi0$1,\r\n    cosPhi0$1;\r\n\r\nvar lengthStream = {\r\n  sphere: noop,\r\n  point: noop,\r\n  lineStart: lengthLineStart,\r\n  lineEnd: noop,\r\n  polygonStart: noop,\r\n  polygonEnd: noop\r\n};\r\n\r\nfunction lengthLineStart() {\r\n  lengthStream.point = lengthPointFirst;\r\n  lengthStream.lineEnd = lengthLineEnd;\r\n}\r\n\r\nfunction lengthLineEnd() {\r\n  lengthStream.point = lengthStream.lineEnd = noop;\r\n}\r\n\r\nfunction lengthPointFirst(lambda, phi) {\r\n  lambda *= radians, phi *= radians;\r\n  lambda0$2 = lambda, sinPhi0$1 = sin(phi), cosPhi0$1 = cos(phi);\r\n  lengthStream.point = lengthPoint;\r\n}\r\n\r\nfunction lengthPoint(lambda, phi) {\r\n  lambda *= radians, phi *= radians;\r\n  var sinPhi = sin(phi),\r\n      cosPhi = cos(phi),\r\n      delta = abs(lambda - lambda0$2),\r\n      cosDelta = cos(delta),\r\n      sinDelta = sin(delta),\r\n      x = cosPhi * sinDelta,\r\n      y = cosPhi0$1 * sinPhi - sinPhi0$1 * cosPhi * cosDelta,\r\n      z = sinPhi0$1 * sinPhi + cosPhi0$1 * cosPhi * cosDelta;\r\n  lengthSum.add(atan2(sqrt(x * x + y * y), z));\r\n  lambda0$2 = lambda, sinPhi0$1 = sinPhi, cosPhi0$1 = cosPhi;\r\n}\r\n\r\nfunction length(object) {\r\n  lengthSum = new Adder();\r\n  geoStream(object, lengthStream);\r\n  return +lengthSum;\r\n}\r\n\r\nvar coordinates = [null, null],\r\n    object = {type: \"LineString\", coordinates: coordinates};\r\n\r\nfunction distance(a, b) {\r\n  coordinates[0] = a;\r\n  coordinates[1] = b;\r\n  return length(object);\r\n}\r\n\r\nvar containsObjectType = {\r\n  Feature: function(object, point) {\r\n    return containsGeometry(object.geometry, point);\r\n  },\r\n  FeatureCollection: function(object, point) {\r\n    var features = object.features, i = -1, n = features.length;\r\n    while (++i < n) if (containsGeometry(features[i].geometry, point)) return true;\r\n    return false;\r\n  }\r\n};\r\n\r\nvar containsGeometryType = {\r\n  Sphere: function() {\r\n    return true;\r\n  },\r\n  Point: function(object, point) {\r\n    return containsPoint(object.coordinates, point);\r\n  },\r\n  MultiPoint: function(object, point) {\r\n    var coordinates = object.coordinates, i = -1, n = coordinates.length;\r\n    while (++i < n) if (containsPoint(coordinates[i], point)) return true;\r\n    return false;\r\n  },\r\n  LineString: function(object, point) {\r\n    return containsLine(object.coordinates, point);\r\n  },\r\n  MultiLineString: function(object, point) {\r\n    var coordinates = object.coordinates, i = -1, n = coordinates.length;\r\n    while (++i < n) if (containsLine(coordinates[i], point)) return true;\r\n    return false;\r\n  },\r\n  Polygon: function(object, point) {\r\n    return containsPolygon(object.coordinates, point);\r\n  },\r\n  MultiPolygon: function(object, point) {\r\n    var coordinates = object.coordinates, i = -1, n = coordinates.length;\r\n    while (++i < n) if (containsPolygon(coordinates[i], point)) return true;\r\n    return false;\r\n  },\r\n  GeometryCollection: function(object, point) {\r\n    var geometries = object.geometries, i = -1, n = geometries.length;\r\n    while (++i < n) if (containsGeometry(geometries[i], point)) return true;\r\n    return false;\r\n  }\r\n};\r\n\r\nfunction containsGeometry(geometry, point) {\r\n  return geometry && containsGeometryType.hasOwnProperty(geometry.type)\r\n      ? containsGeometryType[geometry.type](geometry, point)\r\n      : false;\r\n}\r\n\r\nfunction containsPoint(coordinates, point) {\r\n  return distance(coordinates, point) === 0;\r\n}\r\n\r\nfunction containsLine(coordinates, point) {\r\n  var ao, bo, ab;\r\n  for (var i = 0, n = coordinates.length; i < n; i++) {\r\n    bo = distance(coordinates[i], point);\r\n    if (bo === 0) return true;\r\n    if (i > 0) {\r\n      ab = distance(coordinates[i], coordinates[i - 1]);\r\n      if (\r\n        ab > 0 &&\r\n        ao <= ab &&\r\n        bo <= ab &&\r\n        (ao + bo - ab) * (1 - Math.pow((ao - bo) / ab, 2)) < epsilon2 * ab\r\n      )\r\n        return true;\r\n    }\r\n    ao = bo;\r\n  }\r\n  return false;\r\n}\r\n\r\nfunction containsPolygon(coordinates, point) {\r\n  return !!polygonContains(coordinates.map(ringRadians), pointRadians(point));\r\n}\r\n\r\nfunction ringRadians(ring) {\r\n  return ring = ring.map(pointRadians), ring.pop(), ring;\r\n}\r\n\r\nfunction pointRadians(point) {\r\n  return [point[0] * radians, point[1] * radians];\r\n}\r\n\r\nfunction contains(object, point) {\r\n  return (object && containsObjectType.hasOwnProperty(object.type)\r\n      ? containsObjectType[object.type]\r\n      : containsGeometry)(object, point);\r\n}\r\n\r\nfunction graticuleX(y0, y1, dy) {\r\n  var y = range$1(y0, y1 - epsilon, dy).concat(y1);\r\n  return function(x) { return y.map(function(y) { return [x, y]; }); };\r\n}\r\n\r\nfunction graticuleY(x0, x1, dx) {\r\n  var x = range$1(x0, x1 - epsilon, dx).concat(x1);\r\n  return function(y) { return x.map(function(x) { return [x, y]; }); };\r\n}\r\n\r\nfunction graticule() {\r\n  var x1, x0, X1, X0,\r\n      y1, y0, Y1, Y0,\r\n      dx = 10, dy = dx, DX = 90, DY = 360,\r\n      x, y, X, Y,\r\n      precision = 2.5;\r\n\r\n  function graticule() {\r\n    return {type: \"MultiLineString\", coordinates: lines()};\r\n  }\r\n\r\n  function lines() {\r\n    return range$1(ceil(X0 / DX) * DX, X1, DX).map(X)\r\n        .concat(range$1(ceil(Y0 / DY) * DY, Y1, DY).map(Y))\r\n        .concat(range$1(ceil(x0 / dx) * dx, x1, dx).filter(function(x) { return abs(x % DX) > epsilon; }).map(x))\r\n        .concat(range$1(ceil(y0 / dy) * dy, y1, dy).filter(function(y) { return abs(y % DY) > epsilon; }).map(y));\r\n  }\r\n\r\n  graticule.lines = function() {\r\n    return lines().map(function(coordinates) { return {type: \"LineString\", coordinates: coordinates}; });\r\n  };\r\n\r\n  graticule.outline = function() {\r\n    return {\r\n      type: \"Polygon\",\r\n      coordinates: [\r\n        X(X0).concat(\r\n        Y(Y1).slice(1),\r\n        X(X1).reverse().slice(1),\r\n        Y(Y0).reverse().slice(1))\r\n      ]\r\n    };\r\n  };\r\n\r\n  graticule.extent = function(_) {\r\n    if (!arguments.length) return graticule.extentMinor();\r\n    return graticule.extentMajor(_).extentMinor(_);\r\n  };\r\n\r\n  graticule.extentMajor = function(_) {\r\n    if (!arguments.length) return [[X0, Y0], [X1, Y1]];\r\n    X0 = +_[0][0], X1 = +_[1][0];\r\n    Y0 = +_[0][1], Y1 = +_[1][1];\r\n    if (X0 > X1) _ = X0, X0 = X1, X1 = _;\r\n    if (Y0 > Y1) _ = Y0, Y0 = Y1, Y1 = _;\r\n    return graticule.precision(precision);\r\n  };\r\n\r\n  graticule.extentMinor = function(_) {\r\n    if (!arguments.length) return [[x0, y0], [x1, y1]];\r\n    x0 = +_[0][0], x1 = +_[1][0];\r\n    y0 = +_[0][1], y1 = +_[1][1];\r\n    if (x0 > x1) _ = x0, x0 = x1, x1 = _;\r\n    if (y0 > y1) _ = y0, y0 = y1, y1 = _;\r\n    return graticule.precision(precision);\r\n  };\r\n\r\n  graticule.step = function(_) {\r\n    if (!arguments.length) return graticule.stepMinor();\r\n    return graticule.stepMajor(_).stepMinor(_);\r\n  };\r\n\r\n  graticule.stepMajor = function(_) {\r\n    if (!arguments.length) return [DX, DY];\r\n    DX = +_[0], DY = +_[1];\r\n    return graticule;\r\n  };\r\n\r\n  graticule.stepMinor = function(_) {\r\n    if (!arguments.length) return [dx, dy];\r\n    dx = +_[0], dy = +_[1];\r\n    return graticule;\r\n  };\r\n\r\n  graticule.precision = function(_) {\r\n    if (!arguments.length) return precision;\r\n    precision = +_;\r\n    x = graticuleX(y0, y1, 90);\r\n    y = graticuleY(x0, x1, precision);\r\n    X = graticuleX(Y0, Y1, 90);\r\n    Y = graticuleY(X0, X1, precision);\r\n    return graticule;\r\n  };\r\n\r\n  return graticule\r\n      .extentMajor([[-180, -90 + epsilon], [180, 90 - epsilon]])\r\n      .extentMinor([[-180, -80 - epsilon], [180, 80 + epsilon]]);\r\n}\r\n\r\nfunction graticule10() {\r\n  return graticule()();\r\n}\r\n\r\nfunction interpolate(a, b) {\r\n  var x0 = a[0] * radians,\r\n      y0 = a[1] * radians,\r\n      x1 = b[0] * radians,\r\n      y1 = b[1] * radians,\r\n      cy0 = cos(y0),\r\n      sy0 = sin(y0),\r\n      cy1 = cos(y1),\r\n      sy1 = sin(y1),\r\n      kx0 = cy0 * cos(x0),\r\n      ky0 = cy0 * sin(x0),\r\n      kx1 = cy1 * cos(x1),\r\n      ky1 = cy1 * sin(x1),\r\n      d = 2 * asin(sqrt(haversin(y1 - y0) + cy0 * cy1 * haversin(x1 - x0))),\r\n      k = sin(d);\r\n\r\n  var interpolate = d ? function(t) {\r\n    var B = sin(t *= d) / k,\r\n        A = sin(d - t) / k,\r\n        x = A * kx0 + B * kx1,\r\n        y = A * ky0 + B * ky1,\r\n        z = A * sy0 + B * sy1;\r\n    return [\r\n      atan2(y, x) * degrees,\r\n      atan2(z, sqrt(x * x + y * y)) * degrees\r\n    ];\r\n  } : function() {\r\n    return [x0 * degrees, y0 * degrees];\r\n  };\r\n\r\n  interpolate.distance = d;\r\n\r\n  return interpolate;\r\n}\r\n\r\nvar identity = x => x;\r\n\r\nvar areaSum$1 = new Adder(),\r\n    areaRingSum$1 = new Adder(),\r\n    x00,\r\n    y00,\r\n    x0$1,\r\n    y0$1;\r\n\r\nvar areaStream$1 = {\r\n  point: noop,\r\n  lineStart: noop,\r\n  lineEnd: noop,\r\n  polygonStart: function() {\r\n    areaStream$1.lineStart = areaRingStart$1;\r\n    areaStream$1.lineEnd = areaRingEnd$1;\r\n  },\r\n  polygonEnd: function() {\r\n    areaStream$1.lineStart = areaStream$1.lineEnd = areaStream$1.point = noop;\r\n    areaSum$1.add(abs(areaRingSum$1));\r\n    areaRingSum$1 = new Adder();\r\n  },\r\n  result: function() {\r\n    var area = areaSum$1 / 2;\r\n    areaSum$1 = new Adder();\r\n    return area;\r\n  }\r\n};\r\n\r\nfunction areaRingStart$1() {\r\n  areaStream$1.point = areaPointFirst$1;\r\n}\r\n\r\nfunction areaPointFirst$1(x, y) {\r\n  areaStream$1.point = areaPoint$1;\r\n  x00 = x0$1 = x, y00 = y0$1 = y;\r\n}\r\n\r\nfunction areaPoint$1(x, y) {\r\n  areaRingSum$1.add(y0$1 * x - x0$1 * y);\r\n  x0$1 = x, y0$1 = y;\r\n}\r\n\r\nfunction areaRingEnd$1() {\r\n  areaPoint$1(x00, y00);\r\n}\r\n\r\nvar x0$2 = Infinity,\r\n    y0$2 = x0$2,\r\n    x1 = -x0$2,\r\n    y1 = x1;\r\n\r\nvar boundsStream$1 = {\r\n  point: boundsPoint$1,\r\n  lineStart: noop,\r\n  lineEnd: noop,\r\n  polygonStart: noop,\r\n  polygonEnd: noop,\r\n  result: function() {\r\n    var bounds = [[x0$2, y0$2], [x1, y1]];\r\n    x1 = y1 = -(y0$2 = x0$2 = Infinity);\r\n    return bounds;\r\n  }\r\n};\r\n\r\nfunction boundsPoint$1(x, y) {\r\n  if (x < x0$2) x0$2 = x;\r\n  if (x > x1) x1 = x;\r\n  if (y < y0$2) y0$2 = y;\r\n  if (y > y1) y1 = y;\r\n}\r\n\r\n// TODO Enforce positive area for exterior, negative area for interior?\r\n\r\nvar X0$1 = 0,\r\n    Y0$1 = 0,\r\n    Z0$1 = 0,\r\n    X1$1 = 0,\r\n    Y1$1 = 0,\r\n    Z1$1 = 0,\r\n    X2$1 = 0,\r\n    Y2$1 = 0,\r\n    Z2$1 = 0,\r\n    x00$1,\r\n    y00$1,\r\n    x0$3,\r\n    y0$3;\r\n\r\nvar centroidStream$1 = {\r\n  point: centroidPoint$1,\r\n  lineStart: centroidLineStart$1,\r\n  lineEnd: centroidLineEnd$1,\r\n  polygonStart: function() {\r\n    centroidStream$1.lineStart = centroidRingStart$1;\r\n    centroidStream$1.lineEnd = centroidRingEnd$1;\r\n  },\r\n  polygonEnd: function() {\r\n    centroidStream$1.point = centroidPoint$1;\r\n    centroidStream$1.lineStart = centroidLineStart$1;\r\n    centroidStream$1.lineEnd = centroidLineEnd$1;\r\n  },\r\n  result: function() {\r\n    var centroid = Z2$1 ? [X2$1 / Z2$1, Y2$1 / Z2$1]\r\n        : Z1$1 ? [X1$1 / Z1$1, Y1$1 / Z1$1]\r\n        : Z0$1 ? [X0$1 / Z0$1, Y0$1 / Z0$1]\r\n        : [NaN, NaN];\r\n    X0$1 = Y0$1 = Z0$1 =\r\n    X1$1 = Y1$1 = Z1$1 =\r\n    X2$1 = Y2$1 = Z2$1 = 0;\r\n    return centroid;\r\n  }\r\n};\r\n\r\nfunction centroidPoint$1(x, y) {\r\n  X0$1 += x;\r\n  Y0$1 += y;\r\n  ++Z0$1;\r\n}\r\n\r\nfunction centroidLineStart$1() {\r\n  centroidStream$1.point = centroidPointFirstLine;\r\n}\r\n\r\nfunction centroidPointFirstLine(x, y) {\r\n  centroidStream$1.point = centroidPointLine;\r\n  centroidPoint$1(x0$3 = x, y0$3 = y);\r\n}\r\n\r\nfunction centroidPointLine(x, y) {\r\n  var dx = x - x0$3, dy = y - y0$3, z = sqrt(dx * dx + dy * dy);\r\n  X1$1 += z * (x0$3 + x) / 2;\r\n  Y1$1 += z * (y0$3 + y) / 2;\r\n  Z1$1 += z;\r\n  centroidPoint$1(x0$3 = x, y0$3 = y);\r\n}\r\n\r\nfunction centroidLineEnd$1() {\r\n  centroidStream$1.point = centroidPoint$1;\r\n}\r\n\r\nfunction centroidRingStart$1() {\r\n  centroidStream$1.point = centroidPointFirstRing;\r\n}\r\n\r\nfunction centroidRingEnd$1() {\r\n  centroidPointRing(x00$1, y00$1);\r\n}\r\n\r\nfunction centroidPointFirstRing(x, y) {\r\n  centroidStream$1.point = centroidPointRing;\r\n  centroidPoint$1(x00$1 = x0$3 = x, y00$1 = y0$3 = y);\r\n}\r\n\r\nfunction centroidPointRing(x, y) {\r\n  var dx = x - x0$3,\r\n      dy = y - y0$3,\r\n      z = sqrt(dx * dx + dy * dy);\r\n\r\n  X1$1 += z * (x0$3 + x) / 2;\r\n  Y1$1 += z * (y0$3 + y) / 2;\r\n  Z1$1 += z;\r\n\r\n  z = y0$3 * x - x0$3 * y;\r\n  X2$1 += z * (x0$3 + x);\r\n  Y2$1 += z * (y0$3 + y);\r\n  Z2$1 += z * 3;\r\n  centroidPoint$1(x0$3 = x, y0$3 = y);\r\n}\r\n\r\nfunction PathContext(context) {\r\n  this._context = context;\r\n}\r\n\r\nPathContext.prototype = {\r\n  _radius: 4.5,\r\n  pointRadius: function(_) {\r\n    return this._radius = _, this;\r\n  },\r\n  polygonStart: function() {\r\n    this._line = 0;\r\n  },\r\n  polygonEnd: function() {\r\n    this._line = NaN;\r\n  },\r\n  lineStart: function() {\r\n    this._point = 0;\r\n  },\r\n  lineEnd: function() {\r\n    if (this._line === 0) this._context.closePath();\r\n    this._point = NaN;\r\n  },\r\n  point: function(x, y) {\r\n    switch (this._point) {\r\n      case 0: {\r\n        this._context.moveTo(x, y);\r\n        this._point = 1;\r\n        break;\r\n      }\r\n      case 1: {\r\n        this._context.lineTo(x, y);\r\n        break;\r\n      }\r\n      default: {\r\n        this._context.moveTo(x + this._radius, y);\r\n        this._context.arc(x, y, this._radius, 0, tau);\r\n        break;\r\n      }\r\n    }\r\n  },\r\n  result: noop\r\n};\r\n\r\nvar lengthSum$1 = new Adder(),\r\n    lengthRing,\r\n    x00$2,\r\n    y00$2,\r\n    x0$4,\r\n    y0$4;\r\n\r\nvar lengthStream$1 = {\r\n  point: noop,\r\n  lineStart: function() {\r\n    lengthStream$1.point = lengthPointFirst$1;\r\n  },\r\n  lineEnd: function() {\r\n    if (lengthRing) lengthPoint$1(x00$2, y00$2);\r\n    lengthStream$1.point = noop;\r\n  },\r\n  polygonStart: function() {\r\n    lengthRing = true;\r\n  },\r\n  polygonEnd: function() {\r\n    lengthRing = null;\r\n  },\r\n  result: function() {\r\n    var length = +lengthSum$1;\r\n    lengthSum$1 = new Adder();\r\n    return length;\r\n  }\r\n};\r\n\r\nfunction lengthPointFirst$1(x, y) {\r\n  lengthStream$1.point = lengthPoint$1;\r\n  x00$2 = x0$4 = x, y00$2 = y0$4 = y;\r\n}\r\n\r\nfunction lengthPoint$1(x, y) {\r\n  x0$4 -= x, y0$4 -= y;\r\n  lengthSum$1.add(sqrt(x0$4 * x0$4 + y0$4 * y0$4));\r\n  x0$4 = x, y0$4 = y;\r\n}\r\n\r\nfunction PathString() {\r\n  this._string = [];\r\n}\r\n\r\nPathString.prototype = {\r\n  _radius: 4.5,\r\n  _circle: circle$1(4.5),\r\n  pointRadius: function(_) {\r\n    if ((_ = +_) !== this._radius) this._radius = _, this._circle = null;\r\n    return this;\r\n  },\r\n  polygonStart: function() {\r\n    this._line = 0;\r\n  },\r\n  polygonEnd: function() {\r\n    this._line = NaN;\r\n  },\r\n  lineStart: function() {\r\n    this._point = 0;\r\n  },\r\n  lineEnd: function() {\r\n    if (this._line === 0) this._string.push(\"Z\");\r\n    this._point = NaN;\r\n  },\r\n  point: function(x, y) {\r\n    switch (this._point) {\r\n      case 0: {\r\n        this._string.push(\"M\", x, \",\", y);\r\n        this._point = 1;\r\n        break;\r\n      }\r\n      case 1: {\r\n        this._string.push(\"L\", x, \",\", y);\r\n        break;\r\n      }\r\n      default: {\r\n        if (this._circle == null) this._circle = circle$1(this._radius);\r\n        this._string.push(\"M\", x, \",\", y, this._circle);\r\n        break;\r\n      }\r\n    }\r\n  },\r\n  result: function() {\r\n    if (this._string.length) {\r\n      var result = this._string.join(\"\");\r\n      this._string = [];\r\n      return result;\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n};\r\n\r\nfunction circle$1(radius) {\r\n  return \"m0,\" + radius\r\n      + \"a\" + radius + \",\" + radius + \" 0 1,1 0,\" + -2 * radius\r\n      + \"a\" + radius + \",\" + radius + \" 0 1,1 0,\" + 2 * radius\r\n      + \"z\";\r\n}\r\n\r\nfunction index(projection, context) {\r\n  var pointRadius = 4.5,\r\n      projectionStream,\r\n      contextStream;\r\n\r\n  function path(object) {\r\n    if (object) {\r\n      if (typeof pointRadius === \"function\") contextStream.pointRadius(+pointRadius.apply(this, arguments));\r\n      geoStream(object, projectionStream(contextStream));\r\n    }\r\n    return contextStream.result();\r\n  }\r\n\r\n  path.area = function(object) {\r\n    geoStream(object, projectionStream(areaStream$1));\r\n    return areaStream$1.result();\r\n  };\r\n\r\n  path.measure = function(object) {\r\n    geoStream(object, projectionStream(lengthStream$1));\r\n    return lengthStream$1.result();\r\n  };\r\n\r\n  path.bounds = function(object) {\r\n    geoStream(object, projectionStream(boundsStream$1));\r\n    return boundsStream$1.result();\r\n  };\r\n\r\n  path.centroid = function(object) {\r\n    geoStream(object, projectionStream(centroidStream$1));\r\n    return centroidStream$1.result();\r\n  };\r\n\r\n  path.projection = function(_) {\r\n    return arguments.length ? (projectionStream = _ == null ? (projection = null, identity) : (projection = _).stream, path) : projection;\r\n  };\r\n\r\n  path.context = function(_) {\r\n    if (!arguments.length) return context;\r\n    contextStream = _ == null ? (context = null, new PathString) : new PathContext(context = _);\r\n    if (typeof pointRadius !== \"function\") contextStream.pointRadius(pointRadius);\r\n    return path;\r\n  };\r\n\r\n  path.pointRadius = function(_) {\r\n    if (!arguments.length) return pointRadius;\r\n    pointRadius = typeof _ === \"function\" ? _ : (contextStream.pointRadius(+_), +_);\r\n    return path;\r\n  };\r\n\r\n  return path.projection(projection).context(context);\r\n}\r\n\r\nfunction transform(methods) {\r\n  return {\r\n    stream: transformer(methods)\r\n  };\r\n}\r\n\r\nfunction transformer(methods) {\r\n  return function(stream) {\r\n    var s = new TransformStream;\r\n    for (var key in methods) s[key] = methods[key];\r\n    s.stream = stream;\r\n    return s;\r\n  };\r\n}\r\n\r\nfunction TransformStream() {}\r\n\r\nTransformStream.prototype = {\r\n  constructor: TransformStream,\r\n  point: function(x, y) { this.stream.point(x, y); },\r\n  sphere: function() { this.stream.sphere(); },\r\n  lineStart: function() { this.stream.lineStart(); },\r\n  lineEnd: function() { this.stream.lineEnd(); },\r\n  polygonStart: function() { this.stream.polygonStart(); },\r\n  polygonEnd: function() { this.stream.polygonEnd(); }\r\n};\r\n\r\nfunction fit(projection, fitBounds, object) {\r\n  var clip = projection.clipExtent && projection.clipExtent();\r\n  projection.scale(150).translate([0, 0]);\r\n  if (clip != null) projection.clipExtent(null);\r\n  geoStream(object, projection.stream(boundsStream$1));\r\n  fitBounds(boundsStream$1.result());\r\n  if (clip != null) projection.clipExtent(clip);\r\n  return projection;\r\n}\r\n\r\nfunction fitExtent(projection, extent, object) {\r\n  return fit(projection, function(b) {\r\n    var w = extent[1][0] - extent[0][0],\r\n        h = extent[1][1] - extent[0][1],\r\n        k = Math.min(w / (b[1][0] - b[0][0]), h / (b[1][1] - b[0][1])),\r\n        x = +extent[0][0] + (w - k * (b[1][0] + b[0][0])) / 2,\r\n        y = +extent[0][1] + (h - k * (b[1][1] + b[0][1])) / 2;\r\n    projection.scale(150 * k).translate([x, y]);\r\n  }, object);\r\n}\r\n\r\nfunction fitSize(projection, size, object) {\r\n  return fitExtent(projection, [[0, 0], size], object);\r\n}\r\n\r\nfunction fitWidth(projection, width, object) {\r\n  return fit(projection, function(b) {\r\n    var w = +width,\r\n        k = w / (b[1][0] - b[0][0]),\r\n        x = (w - k * (b[1][0] + b[0][0])) / 2,\r\n        y = -k * b[0][1];\r\n    projection.scale(150 * k).translate([x, y]);\r\n  }, object);\r\n}\r\n\r\nfunction fitHeight(projection, height, object) {\r\n  return fit(projection, function(b) {\r\n    var h = +height,\r\n        k = h / (b[1][1] - b[0][1]),\r\n        x = -k * b[0][0],\r\n        y = (h - k * (b[1][1] + b[0][1])) / 2;\r\n    projection.scale(150 * k).translate([x, y]);\r\n  }, object);\r\n}\r\n\r\nvar maxDepth = 16, // maximum depth of subdivision\r\n    cosMinDistance = cos(30 * radians); // cos(minimum angular distance)\r\n\r\nfunction resample(project, delta2) {\r\n  return +delta2 ? resample$1(project, delta2) : resampleNone(project);\r\n}\r\n\r\nfunction resampleNone(project) {\r\n  return transformer({\r\n    point: function(x, y) {\r\n      x = project(x, y);\r\n      this.stream.point(x[0], x[1]);\r\n    }\r\n  });\r\n}\r\n\r\nfunction resample$1(project, delta2) {\r\n\r\n  function resampleLineTo(x0, y0, lambda0, a0, b0, c0, x1, y1, lambda1, a1, b1, c1, depth, stream) {\r\n    var dx = x1 - x0,\r\n        dy = y1 - y0,\r\n        d2 = dx * dx + dy * dy;\r\n    if (d2 > 4 * delta2 && depth--) {\r\n      var a = a0 + a1,\r\n          b = b0 + b1,\r\n          c = c0 + c1,\r\n          m = sqrt(a * a + b * b + c * c),\r\n          phi2 = asin(c /= m),\r\n          lambda2 = abs(abs(c) - 1) < epsilon || abs(lambda0 - lambda1) < epsilon ? (lambda0 + lambda1) / 2 : atan2(b, a),\r\n          p = project(lambda2, phi2),\r\n          x2 = p[0],\r\n          y2 = p[1],\r\n          dx2 = x2 - x0,\r\n          dy2 = y2 - y0,\r\n          dz = dy * dx2 - dx * dy2;\r\n      if (dz * dz / d2 > delta2 // perpendicular projected distance\r\n          || abs((dx * dx2 + dy * dy2) / d2 - 0.5) > 0.3 // midpoint close to an end\r\n          || a0 * a1 + b0 * b1 + c0 * c1 < cosMinDistance) { // angular distance\r\n        resampleLineTo(x0, y0, lambda0, a0, b0, c0, x2, y2, lambda2, a /= m, b /= m, c, depth, stream);\r\n        stream.point(x2, y2);\r\n        resampleLineTo(x2, y2, lambda2, a, b, c, x1, y1, lambda1, a1, b1, c1, depth, stream);\r\n      }\r\n    }\r\n  }\r\n  return function(stream) {\r\n    var lambda00, x00, y00, a00, b00, c00, // first point\r\n        lambda0, x0, y0, a0, b0, c0; // previous point\r\n\r\n    var resampleStream = {\r\n      point: point,\r\n      lineStart: lineStart,\r\n      lineEnd: lineEnd,\r\n      polygonStart: function() { stream.polygonStart(); resampleStream.lineStart = ringStart; },\r\n      polygonEnd: function() { stream.polygonEnd(); resampleStream.lineStart = lineStart; }\r\n    };\r\n\r\n    function point(x, y) {\r\n      x = project(x, y);\r\n      stream.point(x[0], x[1]);\r\n    }\r\n\r\n    function lineStart() {\r\n      x0 = NaN;\r\n      resampleStream.point = linePoint;\r\n      stream.lineStart();\r\n    }\r\n\r\n    function linePoint(lambda, phi) {\r\n      var c = cartesian([lambda, phi]), p = project(lambda, phi);\r\n      resampleLineTo(x0, y0, lambda0, a0, b0, c0, x0 = p[0], y0 = p[1], lambda0 = lambda, a0 = c[0], b0 = c[1], c0 = c[2], maxDepth, stream);\r\n      stream.point(x0, y0);\r\n    }\r\n\r\n    function lineEnd() {\r\n      resampleStream.point = point;\r\n      stream.lineEnd();\r\n    }\r\n\r\n    function ringStart() {\r\n      lineStart();\r\n      resampleStream.point = ringPoint;\r\n      resampleStream.lineEnd = ringEnd;\r\n    }\r\n\r\n    function ringPoint(lambda, phi) {\r\n      linePoint(lambda00 = lambda, phi), x00 = x0, y00 = y0, a00 = a0, b00 = b0, c00 = c0;\r\n      resampleStream.point = linePoint;\r\n    }\r\n\r\n    function ringEnd() {\r\n      resampleLineTo(x0, y0, lambda0, a0, b0, c0, x00, y00, lambda00, a00, b00, c00, maxDepth, stream);\r\n      resampleStream.lineEnd = lineEnd;\r\n      lineEnd();\r\n    }\r\n\r\n    return resampleStream;\r\n  };\r\n}\r\n\r\nvar transformRadians = transformer({\r\n  point: function(x, y) {\r\n    this.stream.point(x * radians, y * radians);\r\n  }\r\n});\r\n\r\nfunction transformRotate(rotate) {\r\n  return transformer({\r\n    point: function(x, y) {\r\n      var r = rotate(x, y);\r\n      return this.stream.point(r[0], r[1]);\r\n    }\r\n  });\r\n}\r\n\r\nfunction scaleTranslate(k, dx, dy, sx, sy) {\r\n  function transform(x, y) {\r\n    x *= sx; y *= sy;\r\n    return [dx + k * x, dy - k * y];\r\n  }\r\n  transform.invert = function(x, y) {\r\n    return [(x - dx) / k * sx, (dy - y) / k * sy];\r\n  };\r\n  return transform;\r\n}\r\n\r\nfunction scaleTranslateRotate(k, dx, dy, sx, sy, alpha) {\r\n  if (!alpha) return scaleTranslate(k, dx, dy, sx, sy);\r\n  var cosAlpha = cos(alpha),\r\n      sinAlpha = sin(alpha),\r\n      a = cosAlpha * k,\r\n      b = sinAlpha * k,\r\n      ai = cosAlpha / k,\r\n      bi = sinAlpha / k,\r\n      ci = (sinAlpha * dy - cosAlpha * dx) / k,\r\n      fi = (sinAlpha * dx + cosAlpha * dy) / k;\r\n  function transform(x, y) {\r\n    x *= sx; y *= sy;\r\n    return [a * x - b * y + dx, dy - b * x - a * y];\r\n  }\r\n  transform.invert = function(x, y) {\r\n    return [sx * (ai * x - bi * y + ci), sy * (fi - bi * x - ai * y)];\r\n  };\r\n  return transform;\r\n}\r\n\r\nfunction projection(project) {\r\n  return projectionMutator(function() { return project; })();\r\n}\r\n\r\nfunction projectionMutator(projectAt) {\r\n  var project,\r\n      k = 150, // scale\r\n      x = 480, y = 250, // translate\r\n      lambda = 0, phi = 0, // center\r\n      deltaLambda = 0, deltaPhi = 0, deltaGamma = 0, rotate, // pre-rotate\r\n      alpha = 0, // post-rotate angle\r\n      sx = 1, // reflectX\r\n      sy = 1, // reflectX\r\n      theta = null, preclip = clipAntimeridian, // pre-clip angle\r\n      x0 = null, y0, x1, y1, postclip = identity, // post-clip extent\r\n      delta2 = 0.5, // precision\r\n      projectResample,\r\n      projectTransform,\r\n      projectRotateTransform,\r\n      cache,\r\n      cacheStream;\r\n\r\n  function projection(point) {\r\n    return projectRotateTransform(point[0] * radians, point[1] * radians);\r\n  }\r\n\r\n  function invert(point) {\r\n    point = projectRotateTransform.invert(point[0], point[1]);\r\n    return point && [point[0] * degrees, point[1] * degrees];\r\n  }\r\n\r\n  projection.stream = function(stream) {\r\n    return cache && cacheStream === stream ? cache : cache = transformRadians(transformRotate(rotate)(preclip(projectResample(postclip(cacheStream = stream)))));\r\n  };\r\n\r\n  projection.preclip = function(_) {\r\n    return arguments.length ? (preclip = _, theta = undefined, reset()) : preclip;\r\n  };\r\n\r\n  projection.postclip = function(_) {\r\n    return arguments.length ? (postclip = _, x0 = y0 = x1 = y1 = null, reset()) : postclip;\r\n  };\r\n\r\n  projection.clipAngle = function(_) {\r\n    return arguments.length ? (preclip = +_ ? clipCircle(theta = _ * radians) : (theta = null, clipAntimeridian), reset()) : theta * degrees;\r\n  };\r\n\r\n  projection.clipExtent = function(_) {\r\n    return arguments.length ? (postclip = _ == null ? (x0 = y0 = x1 = y1 = null, identity) : clipRectangle(x0 = +_[0][0], y0 = +_[0][1], x1 = +_[1][0], y1 = +_[1][1]), reset()) : x0 == null ? null : [[x0, y0], [x1, y1]];\r\n  };\r\n\r\n  projection.scale = function(_) {\r\n    return arguments.length ? (k = +_, recenter()) : k;\r\n  };\r\n\r\n  projection.translate = function(_) {\r\n    return arguments.length ? (x = +_[0], y = +_[1], recenter()) : [x, y];\r\n  };\r\n\r\n  projection.center = function(_) {\r\n    return arguments.length ? (lambda = _[0] % 360 * radians, phi = _[1] % 360 * radians, recenter()) : [lambda * degrees, phi * degrees];\r\n  };\r\n\r\n  projection.rotate = function(_) {\r\n    return arguments.length ? (deltaLambda = _[0] % 360 * radians, deltaPhi = _[1] % 360 * radians, deltaGamma = _.length > 2 ? _[2] % 360 * radians : 0, recenter()) : [deltaLambda * degrees, deltaPhi * degrees, deltaGamma * degrees];\r\n  };\r\n\r\n  projection.angle = function(_) {\r\n    return arguments.length ? (alpha = _ % 360 * radians, recenter()) : alpha * degrees;\r\n  };\r\n\r\n  projection.reflectX = function(_) {\r\n    return arguments.length ? (sx = _ ? -1 : 1, recenter()) : sx < 0;\r\n  };\r\n\r\n  projection.reflectY = function(_) {\r\n    return arguments.length ? (sy = _ ? -1 : 1, recenter()) : sy < 0;\r\n  };\r\n\r\n  projection.precision = function(_) {\r\n    return arguments.length ? (projectResample = resample(projectTransform, delta2 = _ * _), reset()) : sqrt(delta2);\r\n  };\r\n\r\n  projection.fitExtent = function(extent, object) {\r\n    return fitExtent(projection, extent, object);\r\n  };\r\n\r\n  projection.fitSize = function(size, object) {\r\n    return fitSize(projection, size, object);\r\n  };\r\n\r\n  projection.fitWidth = function(width, object) {\r\n    return fitWidth(projection, width, object);\r\n  };\r\n\r\n  projection.fitHeight = function(height, object) {\r\n    return fitHeight(projection, height, object);\r\n  };\r\n\r\n  function recenter() {\r\n    var center = scaleTranslateRotate(k, 0, 0, sx, sy, alpha).apply(null, project(lambda, phi)),\r\n        transform = scaleTranslateRotate(k, x - center[0], y - center[1], sx, sy, alpha);\r\n    rotate = rotateRadians(deltaLambda, deltaPhi, deltaGamma);\r\n    projectTransform = compose(project, transform);\r\n    projectRotateTransform = compose(rotate, projectTransform);\r\n    projectResample = resample(projectTransform, delta2);\r\n    return reset();\r\n  }\r\n\r\n  function reset() {\r\n    cache = cacheStream = null;\r\n    return projection;\r\n  }\r\n\r\n  return function() {\r\n    project = projectAt.apply(this, arguments);\r\n    projection.invert = project.invert && invert;\r\n    return recenter();\r\n  };\r\n}\r\n\r\nfunction conicProjection(projectAt) {\r\n  var phi0 = 0,\r\n      phi1 = pi / 3,\r\n      m = projectionMutator(projectAt),\r\n      p = m(phi0, phi1);\r\n\r\n  p.parallels = function(_) {\r\n    return arguments.length ? m(phi0 = _[0] * radians, phi1 = _[1] * radians) : [phi0 * degrees, phi1 * degrees];\r\n  };\r\n\r\n  return p;\r\n}\r\n\r\nfunction cylindricalEqualAreaRaw(phi0) {\r\n  var cosPhi0 = cos(phi0);\r\n\r\n  function forward(lambda, phi) {\r\n    return [lambda * cosPhi0, sin(phi) / cosPhi0];\r\n  }\r\n\r\n  forward.invert = function(x, y) {\r\n    return [x / cosPhi0, asin(y * cosPhi0)];\r\n  };\r\n\r\n  return forward;\r\n}\r\n\r\nfunction conicEqualAreaRaw(y0, y1) {\r\n  var sy0 = sin(y0), n = (sy0 + sin(y1)) / 2;\r\n\r\n  // Are the parallels symmetrical around the Equator?\r\n  if (abs(n) < epsilon) return cylindricalEqualAreaRaw(y0);\r\n\r\n  var c = 1 + sy0 * (2 * n - sy0), r0 = sqrt(c) / n;\r\n\r\n  function project(x, y) {\r\n    var r = sqrt(c - 2 * n * sin(y)) / n;\r\n    return [r * sin(x *= n), r0 - r * cos(x)];\r\n  }\r\n\r\n  project.invert = function(x, y) {\r\n    var r0y = r0 - y,\r\n        l = atan2(x, abs(r0y)) * sign(r0y);\r\n    if (r0y * n < 0)\r\n      l -= pi * sign(x) * sign(r0y);\r\n    return [l / n, asin((c - (x * x + r0y * r0y) * n * n) / (2 * n))];\r\n  };\r\n\r\n  return project;\r\n}\r\n\r\nfunction conicEqualArea() {\r\n  return conicProjection(conicEqualAreaRaw)\r\n      .scale(155.424)\r\n      .center([0, 33.6442]);\r\n}\r\n\r\nfunction albers() {\r\n  return conicEqualArea()\r\n      .parallels([29.5, 45.5])\r\n      .scale(1070)\r\n      .translate([480, 250])\r\n      .rotate([96, 0])\r\n      .center([-0.6, 38.7]);\r\n}\r\n\r\n// The projections must have mutually exclusive clip regions on the sphere,\r\n// as this will avoid emitting interleaving lines and polygons.\r\nfunction multiplex(streams) {\r\n  var n = streams.length;\r\n  return {\r\n    point: function(x, y) { var i = -1; while (++i < n) streams[i].point(x, y); },\r\n    sphere: function() { var i = -1; while (++i < n) streams[i].sphere(); },\r\n    lineStart: function() { var i = -1; while (++i < n) streams[i].lineStart(); },\r\n    lineEnd: function() { var i = -1; while (++i < n) streams[i].lineEnd(); },\r\n    polygonStart: function() { var i = -1; while (++i < n) streams[i].polygonStart(); },\r\n    polygonEnd: function() { var i = -1; while (++i < n) streams[i].polygonEnd(); }\r\n  };\r\n}\r\n\r\n// A composite projection for the United States, configured by default for\r\n// 960500. The projection also works quite well at 960600 if you change the\r\n// scale to 1285 and adjust the translate accordingly. The set of standard\r\n// parallels for each region comes from USGS, which is published here:\r\n// http://egsc.usgs.gov/isb/pubs/MapProjections/projections.html#albers\r\nfunction albersUsa() {\r\n  var cache,\r\n      cacheStream,\r\n      lower48 = albers(), lower48Point,\r\n      alaska = conicEqualArea().rotate([154, 0]).center([-2, 58.5]).parallels([55, 65]), alaskaPoint, // EPSG:3338\r\n      hawaii = conicEqualArea().rotate([157, 0]).center([-3, 19.9]).parallels([8, 18]), hawaiiPoint, // ESRI:102007\r\n      point, pointStream = {point: function(x, y) { point = [x, y]; }};\r\n\r\n  function albersUsa(coordinates) {\r\n    var x = coordinates[0], y = coordinates[1];\r\n    return point = null,\r\n        (lower48Point.point(x, y), point)\r\n        || (alaskaPoint.point(x, y), point)\r\n        || (hawaiiPoint.point(x, y), point);\r\n  }\r\n\r\n  albersUsa.invert = function(coordinates) {\r\n    var k = lower48.scale(),\r\n        t = lower48.translate(),\r\n        x = (coordinates[0] - t[0]) / k,\r\n        y = (coordinates[1] - t[1]) / k;\r\n    return (y >= 0.120 && y < 0.234 && x >= -0.425 && x < -0.214 ? alaska\r\n        : y >= 0.166 && y < 0.234 && x >= -0.214 && x < -0.115 ? hawaii\r\n        : lower48).invert(coordinates);\r\n  };\r\n\r\n  albersUsa.stream = function(stream) {\r\n    return cache && cacheStream === stream ? cache : cache = multiplex([lower48.stream(cacheStream = stream), alaska.stream(stream), hawaii.stream(stream)]);\r\n  };\r\n\r\n  albersUsa.precision = function(_) {\r\n    if (!arguments.length) return lower48.precision();\r\n    lower48.precision(_), alaska.precision(_), hawaii.precision(_);\r\n    return reset();\r\n  };\r\n\r\n  albersUsa.scale = function(_) {\r\n    if (!arguments.length) return lower48.scale();\r\n    lower48.scale(_), alaska.scale(_ * 0.35), hawaii.scale(_);\r\n    return albersUsa.translate(lower48.translate());\r\n  };\r\n\r\n  albersUsa.translate = function(_) {\r\n    if (!arguments.length) return lower48.translate();\r\n    var k = lower48.scale(), x = +_[0], y = +_[1];\r\n\r\n    lower48Point = lower48\r\n        .translate(_)\r\n        .clipExtent([[x - 0.455 * k, y - 0.238 * k], [x + 0.455 * k, y + 0.238 * k]])\r\n        .stream(pointStream);\r\n\r\n    alaskaPoint = alaska\r\n        .translate([x - 0.307 * k, y + 0.201 * k])\r\n        .clipExtent([[x - 0.425 * k + epsilon, y + 0.120 * k + epsilon], [x - 0.214 * k - epsilon, y + 0.234 * k - epsilon]])\r\n        .stream(pointStream);\r\n\r\n    hawaiiPoint = hawaii\r\n        .translate([x - 0.205 * k, y + 0.212 * k])\r\n        .clipExtent([[x - 0.214 * k + epsilon, y + 0.166 * k + epsilon], [x - 0.115 * k - epsilon, y + 0.234 * k - epsilon]])\r\n        .stream(pointStream);\r\n\r\n    return reset();\r\n  };\r\n\r\n  albersUsa.fitExtent = function(extent, object) {\r\n    return fitExtent(albersUsa, extent, object);\r\n  };\r\n\r\n  albersUsa.fitSize = function(size, object) {\r\n    return fitSize(albersUsa, size, object);\r\n  };\r\n\r\n  albersUsa.fitWidth = function(width, object) {\r\n    return fitWidth(albersUsa, width, object);\r\n  };\r\n\r\n  albersUsa.fitHeight = function(height, object) {\r\n    return fitHeight(albersUsa, height, object);\r\n  };\r\n\r\n  function reset() {\r\n    cache = cacheStream = null;\r\n    return albersUsa;\r\n  }\r\n\r\n  return albersUsa.scale(1070);\r\n}\r\n\r\nfunction azimuthalRaw(scale) {\r\n  return function(x, y) {\r\n    var cx = cos(x),\r\n        cy = cos(y),\r\n        k = scale(cx * cy);\r\n        if (k === Infinity) return [2, 0];\r\n    return [\r\n      k * cy * sin(x),\r\n      k * sin(y)\r\n    ];\r\n  }\r\n}\r\n\r\nfunction azimuthalInvert(angle) {\r\n  return function(x, y) {\r\n    var z = sqrt(x * x + y * y),\r\n        c = angle(z),\r\n        sc = sin(c),\r\n        cc = cos(c);\r\n    return [\r\n      atan2(x * sc, z * cc),\r\n      asin(z && y * sc / z)\r\n    ];\r\n  }\r\n}\r\n\r\nvar azimuthalEqualAreaRaw = azimuthalRaw(function(cxcy) {\r\n  return sqrt(2 / (1 + cxcy));\r\n});\r\n\r\nazimuthalEqualAreaRaw.invert = azimuthalInvert(function(z) {\r\n  return 2 * asin(z / 2);\r\n});\r\n\r\nfunction azimuthalEqualArea() {\r\n  return projection(azimuthalEqualAreaRaw)\r\n      .scale(124.75)\r\n      .clipAngle(180 - 1e-3);\r\n}\r\n\r\nvar azimuthalEquidistantRaw = azimuthalRaw(function(c) {\r\n  return (c = acos(c)) && c / sin(c);\r\n});\r\n\r\nazimuthalEquidistantRaw.invert = azimuthalInvert(function(z) {\r\n  return z;\r\n});\r\n\r\nfunction azimuthalEquidistant() {\r\n  return projection(azimuthalEquidistantRaw)\r\n      .scale(79.4188)\r\n      .clipAngle(180 - 1e-3);\r\n}\r\n\r\nfunction mercatorRaw(lambda, phi) {\r\n  return [lambda, log(tan((halfPi + phi) / 2))];\r\n}\r\n\r\nmercatorRaw.invert = function(x, y) {\r\n  return [x, 2 * atan(exp(y)) - halfPi];\r\n};\r\n\r\nfunction mercator() {\r\n  return mercatorProjection(mercatorRaw)\r\n      .scale(961 / tau);\r\n}\r\n\r\nfunction mercatorProjection(project) {\r\n  var m = projection(project),\r\n      center = m.center,\r\n      scale = m.scale,\r\n      translate = m.translate,\r\n      clipExtent = m.clipExtent,\r\n      x0 = null, y0, x1, y1; // clip extent\r\n\r\n  m.scale = function(_) {\r\n    return arguments.length ? (scale(_), reclip()) : scale();\r\n  };\r\n\r\n  m.translate = function(_) {\r\n    return arguments.length ? (translate(_), reclip()) : translate();\r\n  };\r\n\r\n  m.center = function(_) {\r\n    return arguments.length ? (center(_), reclip()) : center();\r\n  };\r\n\r\n  m.clipExtent = function(_) {\r\n    return arguments.length ? ((_ == null ? x0 = y0 = x1 = y1 = null : (x0 = +_[0][0], y0 = +_[0][1], x1 = +_[1][0], y1 = +_[1][1])), reclip()) : x0 == null ? null : [[x0, y0], [x1, y1]];\r\n  };\r\n\r\n  function reclip() {\r\n    var k = pi * scale(),\r\n        t = m(rotation(m.rotate()).invert([0, 0]));\r\n    return clipExtent(x0 == null\r\n        ? [[t[0] - k, t[1] - k], [t[0] + k, t[1] + k]] : project === mercatorRaw\r\n        ? [[Math.max(t[0] - k, x0), y0], [Math.min(t[0] + k, x1), y1]]\r\n        : [[x0, Math.max(t[1] - k, y0)], [x1, Math.min(t[1] + k, y1)]]);\r\n  }\r\n\r\n  return reclip();\r\n}\r\n\r\nfunction tany(y) {\r\n  return tan((halfPi + y) / 2);\r\n}\r\n\r\nfunction conicConformalRaw(y0, y1) {\r\n  var cy0 = cos(y0),\r\n      n = y0 === y1 ? sin(y0) : log(cy0 / cos(y1)) / log(tany(y1) / tany(y0)),\r\n      f = cy0 * pow(tany(y0), n) / n;\r\n\r\n  if (!n) return mercatorRaw;\r\n\r\n  function project(x, y) {\r\n    if (f > 0) { if (y < -halfPi + epsilon) y = -halfPi + epsilon; }\r\n    else { if (y > halfPi - epsilon) y = halfPi - epsilon; }\r\n    var r = f / pow(tany(y), n);\r\n    return [r * sin(n * x), f - r * cos(n * x)];\r\n  }\r\n\r\n  project.invert = function(x, y) {\r\n    var fy = f - y, r = sign(n) * sqrt(x * x + fy * fy),\r\n      l = atan2(x, abs(fy)) * sign(fy);\r\n    if (fy * n < 0)\r\n      l -= pi * sign(x) * sign(fy);\r\n    return [l / n, 2 * atan(pow(f / r, 1 / n)) - halfPi];\r\n  };\r\n\r\n  return project;\r\n}\r\n\r\nfunction conicConformal() {\r\n  return conicProjection(conicConformalRaw)\r\n      .scale(109.5)\r\n      .parallels([30, 30]);\r\n}\r\n\r\nfunction equirectangularRaw(lambda, phi) {\r\n  return [lambda, phi];\r\n}\r\n\r\nequirectangularRaw.invert = equirectangularRaw;\r\n\r\nfunction equirectangular() {\r\n  return projection(equirectangularRaw)\r\n      .scale(152.63);\r\n}\r\n\r\nfunction conicEquidistantRaw(y0, y1) {\r\n  var cy0 = cos(y0),\r\n      n = y0 === y1 ? sin(y0) : (cy0 - cos(y1)) / (y1 - y0),\r\n      g = cy0 / n + y0;\r\n\r\n  if (abs(n) < epsilon) return equirectangularRaw;\r\n\r\n  function project(x, y) {\r\n    var gy = g - y, nx = n * x;\r\n    return [gy * sin(nx), g - gy * cos(nx)];\r\n  }\r\n\r\n  project.invert = function(x, y) {\r\n    var gy = g - y,\r\n        l = atan2(x, abs(gy)) * sign(gy);\r\n    if (gy * n < 0)\r\n      l -= pi * sign(x) * sign(gy);\r\n    return [l / n, g - sign(n) * sqrt(x * x + gy * gy)];\r\n  };\r\n\r\n  return project;\r\n}\r\n\r\nfunction conicEquidistant() {\r\n  return conicProjection(conicEquidistantRaw)\r\n      .scale(131.154)\r\n      .center([0, 13.9389]);\r\n}\r\n\r\nvar A1 = 1.340264,\r\n    A2 = -0.081106,\r\n    A3 = 0.000893,\r\n    A4 = 0.003796,\r\n    M = sqrt(3) / 2,\r\n    iterations = 12;\r\n\r\nfunction equalEarthRaw(lambda, phi) {\r\n  var l = asin(M * sin(phi)), l2 = l * l, l6 = l2 * l2 * l2;\r\n  return [\r\n    lambda * cos(l) / (M * (A1 + 3 * A2 * l2 + l6 * (7 * A3 + 9 * A4 * l2))),\r\n    l * (A1 + A2 * l2 + l6 * (A3 + A4 * l2))\r\n  ];\r\n}\r\n\r\nequalEarthRaw.invert = function(x, y) {\r\n  var l = y, l2 = l * l, l6 = l2 * l2 * l2;\r\n  for (var i = 0, delta, fy, fpy; i < iterations; ++i) {\r\n    fy = l * (A1 + A2 * l2 + l6 * (A3 + A4 * l2)) - y;\r\n    fpy = A1 + 3 * A2 * l2 + l6 * (7 * A3 + 9 * A4 * l2);\r\n    l -= delta = fy / fpy, l2 = l * l, l6 = l2 * l2 * l2;\r\n    if (abs(delta) < epsilon2) break;\r\n  }\r\n  return [\r\n    M * x * (A1 + 3 * A2 * l2 + l6 * (7 * A3 + 9 * A4 * l2)) / cos(l),\r\n    asin(sin(l) / M)\r\n  ];\r\n};\r\n\r\nfunction equalEarth() {\r\n  return projection(equalEarthRaw)\r\n      .scale(177.158);\r\n}\r\n\r\nfunction gnomonicRaw(x, y) {\r\n  var cy = cos(y), k = cos(x) * cy;\r\n  return [cy * sin(x) / k, sin(y) / k];\r\n}\r\n\r\ngnomonicRaw.invert = azimuthalInvert(atan);\r\n\r\nfunction gnomonic() {\r\n  return projection(gnomonicRaw)\r\n      .scale(144.049)\r\n      .clipAngle(60);\r\n}\r\n\r\nfunction identity$1() {\r\n  var k = 1, tx = 0, ty = 0, sx = 1, sy = 1, // scale, translate and reflect\r\n      alpha = 0, ca, sa, // angle\r\n      x0 = null, y0, x1, y1, // clip extent\r\n      kx = 1, ky = 1,\r\n      transform = transformer({\r\n        point: function(x, y) {\r\n          var p = projection([x, y]);\r\n          this.stream.point(p[0], p[1]);\r\n        }\r\n      }),\r\n      postclip = identity,\r\n      cache,\r\n      cacheStream;\r\n\r\n  function reset() {\r\n    kx = k * sx;\r\n    ky = k * sy;\r\n    cache = cacheStream = null;\r\n    return projection;\r\n  }\r\n\r\n  function projection (p) {\r\n    var x = p[0] * kx, y = p[1] * ky;\r\n    if (alpha) {\r\n      var t = y * ca - x * sa;\r\n      x = x * ca + y * sa;\r\n      y = t;\r\n    }    \r\n    return [x + tx, y + ty];\r\n  }\r\n  projection.invert = function(p) {\r\n    var x = p[0] - tx, y = p[1] - ty;\r\n    if (alpha) {\r\n      var t = y * ca + x * sa;\r\n      x = x * ca - y * sa;\r\n      y = t;\r\n    }\r\n    return [x / kx, y / ky];\r\n  };\r\n  projection.stream = function(stream) {\r\n    return cache && cacheStream === stream ? cache : cache = transform(postclip(cacheStream = stream));\r\n  };\r\n  projection.postclip = function(_) {\r\n    return arguments.length ? (postclip = _, x0 = y0 = x1 = y1 = null, reset()) : postclip;\r\n  };\r\n  projection.clipExtent = function(_) {\r\n    return arguments.length ? (postclip = _ == null ? (x0 = y0 = x1 = y1 = null, identity) : clipRectangle(x0 = +_[0][0], y0 = +_[0][1], x1 = +_[1][0], y1 = +_[1][1]), reset()) : x0 == null ? null : [[x0, y0], [x1, y1]];\r\n  };\r\n  projection.scale = function(_) {\r\n    return arguments.length ? (k = +_, reset()) : k;\r\n  };\r\n  projection.translate = function(_) {\r\n    return arguments.length ? (tx = +_[0], ty = +_[1], reset()) : [tx, ty];\r\n  };\r\n  projection.angle = function(_) {\r\n    return arguments.length ? (alpha = _ % 360 * radians, sa = sin(alpha), ca = cos(alpha), reset()) : alpha * degrees;\r\n  };\r\n  projection.reflectX = function(_) {\r\n    return arguments.length ? (sx = _ ? -1 : 1, reset()) : sx < 0;\r\n  };\r\n  projection.reflectY = function(_) {\r\n    return arguments.length ? (sy = _ ? -1 : 1, reset()) : sy < 0;\r\n  };\r\n  projection.fitExtent = function(extent, object) {\r\n    return fitExtent(projection, extent, object);\r\n  };\r\n  projection.fitSize = function(size, object) {\r\n    return fitSize(projection, size, object);\r\n  };\r\n  projection.fitWidth = function(width, object) {\r\n    return fitWidth(projection, width, object);\r\n  };\r\n  projection.fitHeight = function(height, object) {\r\n    return fitHeight(projection, height, object);\r\n  };\r\n\r\n  return projection;\r\n}\r\n\r\nfunction naturalEarth1Raw(lambda, phi) {\r\n  var phi2 = phi * phi, phi4 = phi2 * phi2;\r\n  return [\r\n    lambda * (0.8707 - 0.131979 * phi2 + phi4 * (-0.013791 + phi4 * (0.003971 * phi2 - 0.001529 * phi4))),\r\n    phi * (1.007226 + phi2 * (0.015085 + phi4 * (-0.044475 + 0.028874 * phi2 - 0.005916 * phi4)))\r\n  ];\r\n}\r\n\r\nnaturalEarth1Raw.invert = function(x, y) {\r\n  var phi = y, i = 25, delta;\r\n  do {\r\n    var phi2 = phi * phi, phi4 = phi2 * phi2;\r\n    phi -= delta = (phi * (1.007226 + phi2 * (0.015085 + phi4 * (-0.044475 + 0.028874 * phi2 - 0.005916 * phi4))) - y) /\r\n        (1.007226 + phi2 * (0.015085 * 3 + phi4 * (-0.044475 * 7 + 0.028874 * 9 * phi2 - 0.005916 * 11 * phi4)));\r\n  } while (abs(delta) > epsilon && --i > 0);\r\n  return [\r\n    x / (0.8707 + (phi2 = phi * phi) * (-0.131979 + phi2 * (-0.013791 + phi2 * phi2 * phi2 * (0.003971 - 0.001529 * phi2)))),\r\n    phi\r\n  ];\r\n};\r\n\r\nfunction naturalEarth1() {\r\n  return projection(naturalEarth1Raw)\r\n      .scale(175.295);\r\n}\r\n\r\nfunction orthographicRaw(x, y) {\r\n  return [cos(y) * sin(x), sin(y)];\r\n}\r\n\r\northographicRaw.invert = azimuthalInvert(asin);\r\n\r\nfunction orthographic() {\r\n  return projection(orthographicRaw)\r\n      .scale(249.5)\r\n      .clipAngle(90 + epsilon);\r\n}\r\n\r\nfunction stereographicRaw(x, y) {\r\n  var cy = cos(y), k = 1 + cos(x) * cy;\r\n  return [cy * sin(x) / k, sin(y) / k];\r\n}\r\n\r\nstereographicRaw.invert = azimuthalInvert(function(z) {\r\n  return 2 * atan(z);\r\n});\r\n\r\nfunction stereographic() {\r\n  return projection(stereographicRaw)\r\n      .scale(250)\r\n      .clipAngle(142);\r\n}\r\n\r\nfunction transverseMercatorRaw(lambda, phi) {\r\n  return [log(tan((halfPi + phi) / 2)), -lambda];\r\n}\r\n\r\ntransverseMercatorRaw.invert = function(x, y) {\r\n  return [-y, 2 * atan(exp(x)) - halfPi];\r\n};\r\n\r\nfunction transverseMercator() {\r\n  var m = mercatorProjection(transverseMercatorRaw),\r\n      center = m.center,\r\n      rotate = m.rotate;\r\n\r\n  m.center = function(_) {\r\n    return arguments.length ? center([-_[1], _[0]]) : (_ = center(), [_[1], -_[0]]);\r\n  };\r\n\r\n  m.rotate = function(_) {\r\n    return arguments.length ? rotate([_[0], _[1], _.length > 2 ? _[2] + 90 : 90]) : (_ = rotate(), [_[0], _[1], _[2] - 90]);\r\n  };\r\n\r\n  return rotate([0, 0, 90])\r\n      .scale(159.155);\r\n}\r\n\r\nexport { albers as geoAlbers, albersUsa as geoAlbersUsa, area as geoArea, azimuthalEqualArea as geoAzimuthalEqualArea, azimuthalEqualAreaRaw as geoAzimuthalEqualAreaRaw, azimuthalEquidistant as geoAzimuthalEquidistant, azimuthalEquidistantRaw as geoAzimuthalEquidistantRaw, bounds as geoBounds, centroid as geoCentroid, circle as geoCircle, clipAntimeridian as geoClipAntimeridian, clipCircle as geoClipCircle, extent as geoClipExtent, clipRectangle as geoClipRectangle, conicConformal as geoConicConformal, conicConformalRaw as geoConicConformalRaw, conicEqualArea as geoConicEqualArea, conicEqualAreaRaw as geoConicEqualAreaRaw, conicEquidistant as geoConicEquidistant, conicEquidistantRaw as geoConicEquidistantRaw, contains as geoContains, distance as geoDistance, equalEarth as geoEqualEarth, equalEarthRaw as geoEqualEarthRaw, equirectangular as geoEquirectangular, equirectangularRaw as geoEquirectangularRaw, gnomonic as geoGnomonic, gnomonicRaw as geoGnomonicRaw, graticule as geoGraticule, graticule10 as geoGraticule10, identity$1 as geoIdentity, interpolate as geoInterpolate, length as geoLength, mercator as geoMercator, mercatorRaw as geoMercatorRaw, naturalEarth1 as geoNaturalEarth1, naturalEarth1Raw as geoNaturalEarth1Raw, orthographic as geoOrthographic, orthographicRaw as geoOrthographicRaw, index as geoPath, projection as geoProjection, projectionMutator as geoProjectionMutator, rotation as geoRotation, stereographic as geoStereographic, stereographicRaw as geoStereographicRaw, geoStream, transform as geoTransform, transverseMercator as geoTransverseMercator, transverseMercatorRaw as geoTransverseMercatorRaw };\r\n","/** @module */\r\n\r\n// import GeoMaps from './GeoMaps.js'\r\nimport { contourDensity } from '../lib/snowpack/build/snowpack/pkg/d3-contour.js'\r\nimport { geoPath } from '../lib/snowpack/build/snowpack/pkg/d3-geo.js'\r\nimport { range } from '../utilities/jsHelpers.js'\r\n\r\nimport VoterRender1D from './VoterRender1D.js'\r\nimport VoterRender2D from './VoterRender2D.js'\r\n\r\n/**\r\n * Show Voters\r\n * @param {VoterSimList} voterSimList\r\n * @param {screen} screen - draw to the screen\r\n * @constructor\r\n */\r\nexport default function VizSampleDensity2D(voterSimList, candidateDnSimList, screen, changes, sim) {\r\n    const self = this\r\n\r\n    // const geoMaps = new GeoMaps(voterSimList, candidateDnSimList, screen, sim)\r\n\r\n    // Candidates //\r\n\r\n    const { dimensions } = sim.election\r\n\r\n    // voter renderer factory //\r\n    const VoterRenderer = (dimensions === 1) ? VoterRender1D : VoterRender2D\r\n    voterSimList.setRenderer((voterShape) => new VoterRenderer(voterShape, screen))\r\n    candidateDnSimList.setRenderer((voterShape) => new VoterRenderer(voterShape, screen))\r\n\r\n    self.update = function (addResult) {\r\n        const { pointsChanged, points } = addResult\r\n\r\n        if (pointsChanged) {\r\n            self.updatePoints(points)\r\n        }\r\n    }\r\n\r\n    self.render = () => {\r\n        // geoMaps.renderPolicyNoise()\r\n        self.renderCans()\r\n\r\n        voterSimList.render()\r\n        candidateDnSimList.render()\r\n    }\r\n\r\n    const nThresholds = 20\r\n    let densityData\r\n    self.updatePoints = function (points) {\r\n        const btw = points.length / 10000\r\n        const thresholds = range(nThresholds).map((x) => x * btw)\r\n        const cd = contourDensity()\r\n            .x((d) => d.x)\r\n            .y((d) => d.y)\r\n            .bandwidth(10)\r\n            .thresholds(thresholds)\r\n        densityData = cd(points)\r\n    }\r\n\r\n    self.renderCans = () => {\r\n        const { ctx } = screen\r\n        const gg = geoPath()\r\n            .context(ctx)\r\n\r\n        ctx.save()\r\n\r\n        ctx.lineWidth = 0.5\r\n        ctx.strokeStyle = '#aaa'\r\n        const alpha = 1\r\n        const nd = densityData.length\r\n        for (let i = 0; i < nd; i++) {\r\n            const co = 255 - i * (200 / nThresholds)\r\n            ctx.fillStyle = `rgba(${co},${co},${co}, ${alpha})`\r\n            ctx.beginPath()\r\n            gg(densityData[i])\r\n            // ctx.stroke()\r\n            ctx.fill()\r\n        }\r\n        ctx.restore()\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport CandidateDnSimList from '../../candidateDns/CandidateDnSimList.js'\r\nimport CandidateDnSim from '../../candidateDns/CandidateDnSim.js'\r\nimport VoterSimList from '../../voters/VoterSimList.js'\r\nimport SimBase from './SimBase.js'\r\nimport VoterSim from '../../voters/VoterSim.js'\r\nimport VoterGeoList from '../../voters/VoterGeoList.js'\r\nimport VizSample from '../../viz/VizSample.js'\r\nimport VizSampleDensity1D from '../../viz/VizSampleDensity1D.js'\r\nimport VizSampleDensity2D from '../../viz/VizSampleDensity2D.js'\r\n\r\n/**\r\n * Simulate many sample elections with\r\n *   candidates in random positions within a distribution, and\r\n *   voters in a distribution that will be summed over.\r\n * @param {Screen} screen\r\n * @param {Menu} menu\r\n * @param {Changes} changes\r\n * @param {ElectionSample} electionSample\r\n * @param {ElectionSampleGeo} electionSampleGeo\r\n * @param {Sim} sim\r\n * @constructor\r\n */\r\nexport default function SimSample(screen, menu, changes, electionSample, electionSampleGeo, sim) {\r\n    const self = this\r\n\r\n    SimBase.call(self, screen, changes, sim)\r\n\r\n    // Entities //\r\n\r\n    const candidateDnSimList = new CandidateDnSimList(sim, changes)\r\n    const voterSimList = new VoterSimList(sim)\r\n    const voterGeoList = new VoterGeoList(screen, sim, changes)\r\n\r\n    self.addSimCandidateDistribution = (canDn) => {\r\n        candidateDnSimList.newCandidate(new CandidateDnSim(canDn, self.dragm, screen))\r\n    }\r\n\r\n    self.addSimVoterCircle = (voterShape) => {\r\n        voterGeoList.newVoterSim(new VoterSim(voterShape, self.dragm, screen))\r\n        voterSimList.newVoterSim(new VoterSim(voterShape, self.dragm, screen))\r\n    }\r\n\r\n    changes.add(['districts'])\r\n\r\n    // Strategies //\r\n\r\n    let voterList\r\n    let electionStrategy\r\n    let vizSample\r\n    function enterStrategy() {\r\n        voterList = (sim.geo) ? voterGeoList : voterSimList\r\n\r\n        electionStrategy = (sim.geo) ? electionSampleGeo : electionSample\r\n\r\n        const doDensity = true // TODO : make into an option, perhaps\r\n        const VizSampleDensity = (sim.election.dimensions === 1)\r\n            ? VizSampleDensity1D\r\n            : VizSampleDensity2D\r\n        const VizSampleStrat = (doDensity) ? VizSampleDensity : VizSample\r\n        vizSample = new VizSampleStrat(voterList, candidateDnSimList, screen, changes, sim)\r\n    }\r\n\r\n    // Main State Machine Functions //\r\n\r\n    const superEnter = self.enter\r\n    self.enter = () => {\r\n        superEnter()\r\n        sim.candidateDnAdd.canDnButton.show()\r\n        enterStrategy()\r\n        voterList.updateXY()\r\n        candidateDnSimList.updateXY()\r\n    }\r\n\r\n    self.exit = () => {\r\n        sim.candidateDnAdd.canDnButton.hide()\r\n    }\r\n\r\n    self.update = () => {\r\n        // Update players. Run an election. Get result. Visualize result.\r\n        // The election handles any changes.\r\n        // The electionResults communicates how to visualize the election.\r\n\r\n        voterList.update()\r\n        candidateDnSimList.update()\r\n        const { dimensions } = sim.election\r\n        const addResult = electionStrategy\r\n            .update(voterList, candidateDnSimList, changes, dimensions)\r\n        vizSample.update(addResult)\r\n        changes.clear()\r\n\r\n        const { pointsChanged } = addResult\r\n        if (pointsChanged) {\r\n            screen.clear()\r\n            self.render()\r\n        }\r\n    }\r\n\r\n    self.render = () => {\r\n        vizSample.render()\r\n    }\r\n    self.renderForeground = () => {\r\n        voterList.renderForeground()\r\n        candidateDnSimList.renderForeground()\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Gives an id to an entity.\r\n * @constructor\r\n */\r\nexport default function Registrar() {\r\n    const self = this\r\n\r\n    const entities = []\r\n    let nextID = 0\r\n\r\n    self.new = function (entity) {\r\n        entities.push(entity)\r\n        const id = nextID\r\n        nextID += 1\r\n        return id\r\n    }\r\n    self.num = () => nextID\r\n    self.get = (id) => entities[id]\r\n}\r\n","export default function hideOnClickOutside(element, hide) {\r\n    const isVisible = (elem) => !!elem\r\n        && !!(elem.offsetWidth || elem.offsetHeight || elem.getClientRects().length)\r\n\r\n    const outsideClickListener = (event) => {\r\n        if (!element.contains(event.target) && isVisible(element)) {\r\n            // or use: event.target.closest(selector) === null\r\n            const success = hide()\r\n            // eslint-disable-next-line no-use-before-define\r\n            if (success) removeClickListener()\r\n        }\r\n    }\r\n\r\n    const removeClickListener = () => {\r\n        document.removeEventListener('mousedown', outsideClickListener)\r\n        document.removeEventListener('touchstart', outsideClickListener)\r\n    }\r\n\r\n    document.addEventListener('mousedown', outsideClickListener)\r\n    document.addEventListener('touchstart', outsideClickListener)\r\n}\r\n","import hideOnClickOutside from './hideOnClickOutside.js'\r\n\r\nexport default function tooltipBox(entity, screen) {\r\n    const box = document.createElement('div')\r\n\r\n    box.className = 'tooltipBox'\r\n    box.style.position = 'absolute'\r\n\r\n    function update() {\r\n        if (entity.x > screen.width * 0.5) {\r\n            box.style.right = `${screen.width - entity.x}px`\r\n            box.style.left = 'unset'\r\n        } else {\r\n            box.style.left = `${entity.x}px`\r\n            box.style.right = 'unset'\r\n        }\r\n        box.style.top = `${entity.y}px`\r\n    }\r\n    update(entity)\r\n    // box.style.width = '10px'\r\n    // box.style.height = '10px'\r\n    box.style.border = '1px solid black'\r\n    box.style.padding = '8px'\r\n    box.style.background = 'white'\r\n\r\n    let pinned = false\r\n    /**\r\n     * Set pinned to true or false, to keep the box persistent.\r\n     * @param {Boolean} b\r\n     */\r\n    const setPin = (b) => {\r\n        pinned = b\r\n    }\r\n\r\n    const hidebox = () => {\r\n        // box.style.display = 'none'\r\n        if (!pinned) {\r\n            box.remove()\r\n            return true\r\n        }\r\n        return false\r\n    }\r\n\r\n    hideOnClickOutside(box, hidebox)\r\n\r\n    return { box, update, setPin }\r\n}\r\n","import tooltipBox from './tooltipBox.js'\r\n\r\nexport default function tooltipForEntity(entity, screen, sim) {\r\n    // make a html box appear\r\n\r\n    const tbox = tooltipBox(entity, screen)\r\n    const { box } = tbox\r\n\r\n    box.innerText = '- Properties -'\r\n\r\n    // Items //\r\n\r\n    const items = {}\r\n\r\n    items.exists = new Item(\r\n        'checkbox',\r\n        'Exists',\r\n        'Exists: ',\r\n        (val) => entity.setE(val ? 1 : 0),\r\n        entity.exists === 1,\r\n    )\r\n    box.appendChild(items.exists.div)\r\n    if (sim.election.dimensions === 1) {\r\n        if (entity.shape1.w) {\r\n            items.w1 = new Item(\r\n                'range',\r\n                'Width',\r\n                'Width: ',\r\n                (val) => entity.setW1(val),\r\n                entity.shape1.w,\r\n            )\r\n            box.appendChild(items.w1.div)\r\n        }\r\n        if (entity.shape1.densityProfile) {\r\n            items.densityProfile1 = new Item(\r\n                'select',\r\n                'Density Profile',\r\n                'Density Profile: ',\r\n                (val) => entity.setDensityProfile1(val),\r\n                entity.shape1.densityProfile,\r\n                ['step', 'gaussian'],\r\n            )\r\n            box.appendChild(items.densityProfile1.div)\r\n        }\r\n    } else if (entity.shape2.w) {\r\n        items.w2 = new Item(\r\n            'range',\r\n            'Width',\r\n            'Width: ',\r\n            (val) => entity.setW2(val),\r\n            entity.shape2.w,\r\n        )\r\n        box.appendChild(items.w2.div)\r\n    }\r\n    if (entity.setColor !== undefined) {\r\n        items.color = new Item(\r\n            'color',\r\n            'Color',\r\n            'Color: ',\r\n            (val) => entity.setColor(val),\r\n            entity.color,\r\n        )\r\n        box.appendChild(items.color.div)\r\n    }\r\n    items.showGhosts = new Item(\r\n        'checkbox',\r\n        'Show Ghosts',\r\n        'Show Ghosts: ',\r\n        (val) => sim.setShowNonExistingEntities(val),\r\n        sim.showGhosts,\r\n    )\r\n    box.appendChild(items.showGhosts.div)\r\n\r\n    // Append //\r\n\r\n    screen.tooltips.appendChild(box)\r\n}\r\n\r\nfunction Item(type, name, text, onChange, defaultValue, choices) {\r\n    const self = this\r\n\r\n    self.div = document.createElement('div')\r\n\r\n    if (type === 'select') {\r\n        self.input = document.createElement('select')\r\n        for (let i = 0; i < choices.length; i++) {\r\n            const option = document.createElement('option')\r\n            option.value = choices[i]\r\n            option.innerText = choices[i]\r\n            self.input.appendChild(option)\r\n        }\r\n        self.input.value = defaultValue\r\n        self.input.addEventListener('input', () => onChange(self.input.value))\r\n    } else {\r\n        self.input = document.createElement('input')\r\n        self.input.type = type\r\n        self.input.id = name\r\n        self.input.name = name\r\n        if (type === 'checkbox') {\r\n            if (defaultValue) {\r\n                self.input.checked = true\r\n            }\r\n            self.input.addEventListener('change', () => onChange(self.input.checked))\r\n        } else if (type === 'range') {\r\n            self.input.min = 1\r\n            self.input.max = 300\r\n            self.input.value = defaultValue\r\n            self.input.step = 1\r\n            self.input.addEventListener('input', () => onChange(self.input.value))\r\n        } else if (type === 'color') {\r\n            self.input.value = defaultValue\r\n            self.input.addEventListener('input', () => onChange(self.input.value))\r\n        }\r\n    }\r\n    self.label = document.createElement('label')\r\n    self.label.for = name\r\n    self.label.innerText = text\r\n    self.label.style['margin-right'] = '4px'\r\n    self.div.appendChild(self.label)\r\n    self.div.appendChild(self.input)\r\n}\r\n","/** @module */\r\n\r\nimport tooltipForEntity from '../tooltips/tooltipForEntity.js'\r\n\r\n/**\r\n * VoterShape class with Handle component to take care of dragging.\r\n * Voronoi2D component takes care of drawing votes.\r\n * @param {Object} shape2\r\n * @param {Object} shape1\r\n * @param {Screen} screen\r\n * @param {Registrar} voterRegistrar\r\n * @param {Commander} commander\r\n * @param {Changes} changes\r\n * @param {Boolean} doLoad - Should we add the voter without adding to the history?\r\n * @constructor\r\n */\r\nexport default function VoterShape(\r\n    shape2,\r\n    shape1,\r\n    screen,\r\n    voterRegistrar,\r\n    commander,\r\n    changes,\r\n    doLoad,\r\n    voterCommander,\r\n    sim,\r\n) {\r\n    const self = this\r\n\r\n    self.shape1 = {}\r\n    self.shape2 = {}\r\n\r\n    // Get assigned an id by the voterRegistrar list manager\r\n\r\n    const id = voterRegistrar.new(self)\r\n\r\n    // Instantiate Variables\r\n\r\n    // use commands to instantiate variables\r\n    self.instantiate = () => {\r\n        const shape2p = { x: shape2.x, y: shape2.y }\r\n\r\n        const commands = [\r\n            voterCommander.setForListSenders.exists.command(id, 1, 0), // set alive flag\r\n            voterCommander.setForListSenders.shape2p.command(id, shape2p, shape2p),\r\n            voterCommander.setForListSenders.shape1x.command(id, shape1.x, shape1.x),\r\n            voterCommander.setForListSenders.shape2w.command(id, shape2.w, shape2.w),\r\n            voterCommander.setForListSenders.shape1w.command(id, shape1.w, shape1.w),\r\n            voterCommander.setForListSenders.shape1densityProfile.command(\r\n                id,\r\n                shape1.densityProfile,\r\n                shape1.densityProfile,\r\n            ),\r\n        ]\r\n        // Either load the commands because we don't want to create an item of history\r\n        // Or do the commands because want to store an item in history, so that we can undo.\r\n        if (doLoad) {\r\n            commander.loadCommands(commands)\r\n        } else {\r\n            commander.doCommands(commands)\r\n        }\r\n    }\r\n\r\n    self.setAction = {}\r\n    self.setAction.exists = (e) => {\r\n        self.exists = e\r\n        changes.add(['draggables'])\r\n    }\r\n    self.setE = (e) => {\r\n        const cur = voterCommander.setForListSenders.exists.getCurrentValue(id)\r\n        voterCommander.setForListSenders.exists.go(id, e, cur)\r\n    }\r\n\r\n    self.setAction.shape2p = (p) => {\r\n        self.shape2.x = p.x\r\n        self.shape2.y = p.y\r\n        if (sim.election.dimensions === 2) {\r\n            self.x = p.x\r\n            self.y = p.y\r\n        }\r\n        changes.add(['draggables'])\r\n    }\r\n    self.setAction.shape1x = (p) => {\r\n        self.shape1.x = p\r\n        if (sim.election.dimensions === 1) {\r\n            self.x = p\r\n            self.y = 250\r\n        }\r\n        changes.add(['draggables'])\r\n    }\r\n    self.setXY = (p) => {\r\n        if (sim.election.dimensions === 1) {\r\n            const cur = voterCommander.setForListSenders.shape1x.getCurrentValue(id)\r\n            voterCommander.setForListSenders.shape1x.go(id, p.x, cur)\r\n        } else {\r\n            const cur = voterCommander.setForListSenders.shape2p.getCurrentValue(id)\r\n            voterCommander.setForListSenders.shape2p.go(id, p, cur)\r\n        }\r\n    }\r\n    /** Do this when entering a state because x and y change.\r\n     *  Maybe x and y should be in the VoterSim instead... just speculating. */\r\n    self.updateXY = () => {\r\n        if (sim.election.dimensions === 1) {\r\n            self.setAction.shape1x(self.shape1.x)\r\n        } else {\r\n            self.setAction.shape2p({ x: self.shape2.x, y: self.shape2.y })\r\n        }\r\n    }\r\n\r\n    self.setAction.shape2w = (newW) => {\r\n        self.shape2.w = newW\r\n        changes.add(['width'])\r\n    }\r\n    self.setW2 = (newW) => {\r\n        const cur = voterCommander.setForListSenders.shape2w.getCurrentValue(id)\r\n        voterCommander.setForListSenders.shape2w.go(id, newW, cur)\r\n    }\r\n\r\n    self.setAction.shape1w = (newW) => {\r\n        self.shape1.w = newW\r\n        changes.add(['width'])\r\n    }\r\n    self.setW1 = (newW) => {\r\n        const cur = voterCommander.setForListSenders.shape1w.getCurrentValue(id)\r\n        voterCommander.setForListSenders.shape1w.go(id, newW, cur)\r\n    }\r\n\r\n    /** Density Profile can be \"gaussian\" or \"step\" */\r\n    self.setAction.shape1densityProfile = (newDensityProfile1) => {\r\n        self.shape1.densityProfile = newDensityProfile1\r\n        changes.add(['densityProfile'])\r\n    }\r\n    self.setDensityProfile1 = (newDensityProfile1) => {\r\n        const cur = voterCommander.setForListSenders.shape1densityProfile.getCurrentValue(id)\r\n        voterCommander.setForListSenders.shape1densityProfile.go(id, newDensityProfile1, cur)\r\n    }\r\n\r\n    self.instantiate()\r\n\r\n    // Done instantiating variables\r\n\r\n    // Click Handler\r\n\r\n    self.click = () => {\r\n        tooltipForEntity(self, screen, sim)\r\n    }\r\n\r\n    // Rendering\r\n\r\n    self.color = '#88888888'\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Register senders with the commander for setting entity values.\r\n * This is here because we need an action that takes an id.\r\n * @param {Registrar} voterRegistrar\r\n * @param {Commander} commander\r\n * @param {VoterShapeAdd} voterShapeAdd\r\n * @constructor\r\n */\r\nexport default function VoterCommander(voterRegistrar, commander, voterShapeAdd) {\r\n    const self = this\r\n\r\n    const prefix = 'voters'\r\n\r\n    // a object with senders that set parameters for lists of entities.\r\n    // Like if you want to set the exists property of the 2nd voter to 1.\r\n    self.setForListSenders = {}\r\n\r\n    function makeSetForListSender(key, configKey, isChain) {\r\n        self.setForListSenders[key] = commander.addSenderForList({\r\n            action: (id, e) => {\r\n                self.setNumberVoters(id + 1)\r\n                const voter = voterRegistrar.get(id)\r\n                voter.setAction[key](e)\r\n            },\r\n            name: `${prefix}-${configKey}`,\r\n            props: { isChain },\r\n        })\r\n    }\r\n    makeSetForListSender('exists', 'exists', false)\r\n    makeSetForListSender('shape2p', 'shape2D-point', true)\r\n    makeSetForListSender('shape1x', 'shape1D-x', true)\r\n    makeSetForListSender('shape2w', 'shape2D-width', true)\r\n    makeSetForListSender('shape1w', 'shape1D-width', true)\r\n    makeSetForListSender('shape1densityProfile', 'shape1D-densityProfile', false)\r\n\r\n    // This is kind of weird because this value is not a good measure of the number of entities.\r\n    // An undo will reduce the number stored with the command name,\r\n    // but not reduce the number of entities.\r\n    // So we disable undo.\r\n    self.setNumberVotersSender = commander.addSender({\r\n        action: (num) => voterShapeAdd.setNumberVotersAction(num),\r\n        currentValue: 0,\r\n        name: `${prefix}-setNumberAtLeast`,\r\n        props: { isFirstAction: true },\r\n    })\r\n    self.setNumberVoters = (num) => {\r\n        commander.loadCommands([self.setNumberVotersSender.command(num)])\r\n    }\r\n}\r\n","import VoterShapeAddMakeButton from '../sim/VoterShapeAddMakeButton.js'\r\nimport Registrar from '../sim/Registrar.js'\r\nimport VoterShape from './VoterShape.js'\r\nimport VoterCommander from './VoterCommander.js'\r\n\r\n/** A component of sim.js that deals with adding voters. */\r\nexport default function VoterShapeAdd(screen, layout, changes, commander, sims, sim) {\r\n    const self = this\r\n\r\n    VoterShapeAddMakeButton(layout, self)\r\n\r\n    const voterRegistrar = new Registrar()\r\n    const voterCommander = new VoterCommander(voterRegistrar, commander, self)\r\n\r\n    self.addVoterPressed = () => {\r\n        const num = voterRegistrar.num() + 1\r\n        voterCommander.setNumberVoters(num)\r\n    }\r\n    self.setNumberVotersAction = (num) => {\r\n        while (voterRegistrar.num() < num) {\r\n            self.addVoterCircle({ x: 50, y: 50, w: 200 }, { x: 50, w: 200, densityProfile: 'gaussian' }, false)\r\n        }\r\n    }\r\n\r\n    self.addVoterCircle = (shape2, shape1, doLoad) => {\r\n        // eslint-disable-next-line max-len\r\n        const voterShape = new VoterShape(shape2, shape1, screen, voterRegistrar, commander, changes, doLoad, voterCommander, sim)\r\n\r\n        sims.one.addSimVoterCircle(voterShape)\r\n        sims.sample.addSimVoterCircle(voterShape)\r\n\r\n        const num = voterRegistrar.num()\r\n        voterCommander.setNumberVoters(num)\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Add buttons to layout for undo and redo, and connect them to commander for functionality.\r\n * @param {Layout} layout\r\n * @param {VoterShapeAdd} voterShapeAdd\r\n */\r\nexport default function VoterShapeAddMakeButton(layout, voterShapeAdd) {\r\n    const addVoterButton = document.createElement('button')\r\n\r\n    addVoterButton.innerText = 'Add Voter'\r\n    addVoterButton.className = 'button2'\r\n\r\n    addVoterButton.onclick = () => {\r\n        voterShapeAdd.addVoterPressed()\r\n    }\r\n\r\n    layout.newElement('addVoter', addVoterButton)\r\n}\r\n","/* eslint-disable no-nested-ternary */\r\n// https://codepen.io/darsain/pen/XpgMGp\r\n\r\nconst r = Math.round\r\n\r\nexport function toRGBA(d1) {\r\n    const l = d1.length\r\n    const rgba = Array(4).fill()\r\n    if (d1.slice(0, 3).toLowerCase() === 'rgb') {\r\n        const d = d1.replace(' ', '').split(',')\r\n        rgba[0] = parseInt(d[0].slice(d[3].toLowerCase() === 'a' ? 5 : 4), 10)\r\n        rgba[1] = parseInt(d[1], 10)\r\n        rgba[2] = parseInt(d[2], 10)\r\n        rgba[3] = d[3] ? parseFloat(d[3]) : -1\r\n    } else {\r\n        let d\r\n        if (l < 6) d = parseInt(String(d1[1]) + d1[1] + d1[2] + d1[2] + d1[3] + d1[3] + (l > 4 ? String(d1[4]) + d1[4] : ''), 16)\r\n        else d = parseInt(d1.slice(1), 16)\r\n        rgba[0] = (d >> 16) & 255\r\n        rgba[1] = (d >> 8) & 255\r\n        rgba[2] = d & 255\r\n        rgba[3] = l === 9 || l === 5 ? r((((d >> 24) & 255) / 255) * 10000) / 10000 : -1\r\n    }\r\n    return rgba\r\n}\r\n\r\nexport function blend(from1, to1, p1 = 0.5) {\r\n    const from = from1.trim()\r\n    const to = to1.trim()\r\n    const b = p1 < 0\r\n    const p = b ? p1 * -1 : p1\r\n    const f = toRGBA(from)\r\n    const t = toRGBA(to)\r\n\r\n    if (to[0] === 'r') {\r\n        return `rgb${to[3] === 'a' ? 'a(' : '('\r\n        }${r(Math.sqrt(t[0] ** 2 * p + f[0] ** 2 * (1 - p)))},${\r\n            r(Math.sqrt(t[1] ** 2 * p + f[1] ** 2 * (1 - p)))},${\r\n            r(Math.sqrt(t[2] ** 2 * p + f[2] ** 2 * (1 - p)))\r\n        }${f[3] < 0 && t[3] < 0 ? '' : `,${\r\n            f[3] > -1 && t[3] > -1\r\n                ? r(Math.sqrt(t[3] ** 2 * p + f[3] ** 2 * (1 - p)) * 10000) / 10000\r\n                : t[3] < 0 ? f[3] : t[3]}`})`\r\n    }\r\n\r\n    return `#${(0x100000000 + ((\r\n        f[3] > -1 && t[3] > -1\r\n            ? r(Math.sqrt((t[3] ** 2 * p + f[3] ** 2 * (1 - p))) * 255)\r\n            : t[3] > -1 ? r(t[3] * 255) : f[3] > -1 ? r(f[3] * 255) : 255\r\n    ) * 0x1000000)\r\n    + (r(Math.sqrt(t[0] ** 2 * p + f[0] ** 2 * (1 - p))) * 0x10000)\r\n        + (r(Math.sqrt(t[1] ** 2 * p + f[1] ** 2 * (1 - p))) * 0x100)\r\n        + r(Math.sqrt(t[2] ** 2 * p + f[2] ** 2 * (1 - p)))\r\n    ).toString(16).slice(f[3] > -1 || t[3] > -1 ? 1 : 3)}`\r\n}\r\n","/** @module */\r\n\r\nimport { toRGBA } from '../lib/colorBlendScript.js'\r\nimport tooltipForEntity from '../tooltips/tooltipForEntity.js'\r\n\r\n/**\r\n * Candidate class on top of handle.\r\n * Candidate adds candidate behavior on top of a draggable handle handle.\r\n * @param {Object} shape2\r\n * @param {Object} shape1\r\n * @param {Number} wHandle\r\n * @param {Number} hHandle\r\n * @param {String} color\r\n * @param {Screen} screen\r\n * @param {Registrar} candidateRegistrar\r\n * @param {Commander} commander\r\n * @param {Changes} changes\r\n * @param {Boolean} doLoad - Should we add the candidateDn without adding to the history?\r\n * @constructor\r\n */\r\nexport default function Candidate(\r\n    shape2,\r\n    shape1,\r\n    wHandle,\r\n    hHandle,\r\n    color,\r\n    screen,\r\n    candidateRegistrar,\r\n    commander,\r\n    changes,\r\n    doLoad,\r\n    candidateCommander,\r\n    sim,\r\n) {\r\n    const self = this\r\n\r\n    self.shape1 = {}\r\n    self.shape2 = {}\r\n\r\n    const id = candidateRegistrar.new(self)\r\n\r\n    // Instantiate Variables\r\n\r\n    // use commands to instantiate variables\r\n    self.instantiate = () => {\r\n        const shape2p = { x: shape2.x, y: shape2.y }\r\n\r\n        const commands = [\r\n            candidateCommander.setForListSenders.exists.command(id, 1, 0), // set alive flag\r\n            candidateCommander.setForListSenders.shape2p.command(id, shape2p, shape2p),\r\n            candidateCommander.setForListSenders.shape1x.command(id, shape1.x, shape1.x),\r\n            candidateCommander.setForListSenders.color.command(id, color, color), // set alive flag\r\n        ]\r\n        // Either load the commands because we don't want to create an item of history\r\n        // Or do the commands because want to store an item in history, so that we can undo.\r\n        if (doLoad) {\r\n            commander.loadCommands(commands)\r\n        } else {\r\n            commander.doCommands(commands)\r\n        }\r\n    }\r\n\r\n    self.setAction = {}\r\n\r\n    self.setAction.exists = (e) => {\r\n        self.exists = e\r\n        changes.add(['draggables'])\r\n    }\r\n    self.setE = (e) => {\r\n        const cur = candidateCommander.setForListSenders.exists.getCurrentValue(id)\r\n        candidateCommander.setForListSenders.exists.go(id, e, cur)\r\n    }\r\n\r\n    self.setAction.shape2p = (p) => {\r\n        self.shape2.x = p.x\r\n        self.shape2.y = p.y\r\n        if (sim.election.dimensions === 2) {\r\n            self.x = p.x\r\n            self.y = p.y\r\n        }\r\n        changes.add(['draggables'])\r\n    }\r\n    self.setAction.shape1x = (p) => {\r\n        self.shape1.x = p\r\n        if (sim.election.dimensions === 1) {\r\n            self.x = p\r\n            self.y = 250\r\n        }\r\n        changes.add(['draggables'])\r\n    }\r\n    self.setXY = (p) => {\r\n        if (sim.election.dimensions === 1) {\r\n            const cur = candidateCommander.setForListSenders.shape1x.getCurrentValue(id)\r\n            candidateCommander.setForListSenders.shape1x.go(id, p.x, cur)\r\n        } else {\r\n            const cur = candidateCommander.setForListSenders.shape2p.getCurrentValue(id)\r\n            candidateCommander.setForListSenders.shape2p.go(id, p, cur)\r\n        }\r\n    }\r\n    /** Do this when entering a state because x and y change.\r\n     *  Maybe x and y should be in the CandidateSim instead... just speculating. */\r\n    self.updateXY = () => {\r\n        if (sim.election.dimensions === 1) {\r\n            self.setAction.shape1x(self.shape1.x)\r\n        } else {\r\n            self.setAction.shape2p({ x: self.shape2.x, y: self.shape2.y })\r\n        }\r\n    }\r\n\r\n    self.setAction.color = (newColor) => {\r\n        self.color = newColor\r\n        self.colorRGBA = toRGBA(newColor)\r\n        changes.add(['color'])\r\n    }\r\n    self.setColor = (e) => {\r\n        const cur = candidateCommander.setForListSenders.color.getCurrentValue(id)\r\n        candidateCommander.setForListSenders.color.go(id, e, cur)\r\n    }\r\n\r\n    self.instantiate()\r\n\r\n    // Click Handler\r\n\r\n    self.click = () => {\r\n        tooltipForEntity(self, screen, sim)\r\n    }\r\n\r\n    self.wHandle = wHandle\r\n    self.hHandle = hHandle\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Register senders with the commander for setting entity values.\r\n * This is here because we need an action that takes an id.\r\n * @param {Registrar} candidateRegistrar\r\n * @param {Commander} commander\r\n * @param {Sim} sim\r\n * @constructor\r\n */\r\nexport default function CandidateCommander(candidateRegistrar, commander, sim) {\r\n    const self = this\r\n\r\n    const prefix = 'candidates'\r\n\r\n    // a object with senders that set parameters for lists of entities.\r\n    // Like if you want to set the exists property of the 2nd candidate to 1.\r\n    self.setForListSenders = {}\r\n\r\n    function makeSetForListSender(key, configKey, isChain) {\r\n        self.setForListSenders[key] = commander.addSenderForList({\r\n            action: (id, e) => {\r\n                self.setNumberCandidates(id + 1)\r\n                const candidate = candidateRegistrar.get(id)\r\n                candidate.setAction[key](e)\r\n            },\r\n            name: `${prefix}-${configKey}`,\r\n            props: { isChain },\r\n        })\r\n    }\r\n\r\n    makeSetForListSender('exists', 'exists', false)\r\n    makeSetForListSender('shape2p', 'shape2D-point', true)\r\n    makeSetForListSender('shape1x', 'shape1D-x', true)\r\n    makeSetForListSender('color', 'color', false)\r\n\r\n    // This is kind of weird because this value is not a good measure of the number of entities.\r\n    // An undo will reduce the number stored with the command name,\r\n    // but not reduce the number of entities.\r\n    // So we disable undo.\r\n    // Well, actually we can just loadCommands in order to avoid undo.\r\n    self.setNumberCandidatesSender = commander.addSender({\r\n        action: (num) => {\r\n            sim.setNumberCandidatesAction(num)\r\n        },\r\n        currentValue: 0,\r\n        name: `${prefix}-setNumberAtLeast`,\r\n        props: { isFirstAction: true },\r\n    })\r\n    self.setNumberCandidates = (num) => {\r\n        commander.loadCommands([self.setNumberCandidatesSender.command(num)])\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Add button to layout for adding a candidate\r\n * @param {Layout} layout\r\n * @param {Sim} sim\r\n */\r\nexport default function CandidateAddMakeButton(layout, sim) {\r\n    const self = this\r\n\r\n    const addCandidateButton = document.createElement('button')\r\n\r\n    addCandidateButton.className = 'button2'\r\n    addCandidateButton.innerText = 'Add Candidate'\r\n\r\n    addCandidateButton.onclick = () => {\r\n        sim.addCandidatePressed()\r\n    }\r\n\r\n    layout.newElement('addCandidate', addCandidateButton)\r\n\r\n    self.show = () => {\r\n        addCandidateButton.hidden = false\r\n    }\r\n    self.hide = () => {\r\n        addCandidateButton.hidden = true\r\n    }\r\n}\r\n","import Candidate from './Candidate.js'\r\nimport CandidateCommander from './CandidateCommander.js'\r\nimport { standardizeColor } from '../utilities/jsHelpers.js'\r\nimport CandidateAddMakeButton from '../sim/CandidateAddMakeButton.js'\r\nimport Registrar from '../sim/Registrar.js'\r\n\r\n/** A component of sim.js that deals with adding candidates. */\r\nexport default function CandidateAdd(screen, layout, changes, commander, sims, sim) {\r\n    const self = this\r\n    self.canButton = new CandidateAddMakeButton(layout, self)\r\n    const candidateRegistrar = new Registrar()\r\n    const candidateCommander = new CandidateCommander(candidateRegistrar, commander, self)\r\n\r\n    self.addCandidatePressed = () => {\r\n        // really, we want to make a command to set numCandidates to at least an amount\r\n        const num = candidateRegistrar.num() + 1\r\n        candidateCommander.setNumberCandidates(num)\r\n    }\r\n    self.setNumberCandidatesAction = (num) => {\r\n        while (candidateRegistrar.num() < num) {\r\n            const color = standardizeColor('yellow')\r\n            self.addCandidate({ x: 50, y: 50 }, { x: 50 }, color, false)\r\n        }\r\n    }\r\n\r\n    self.addCandidate = (shape2, shape1, c, doLoad) => {\r\n        // eslint-disable-next-line no-new, max-len\r\n        const candidate = new Candidate(shape2, shape1, 21, 21, c, screen, candidateRegistrar, commander, changes, doLoad, candidateCommander, sim)\r\n        sims.one.addSimCandidate(candidate)\r\n\r\n        const num = candidateRegistrar.num()\r\n        candidateCommander.setNumberCandidates(num)\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport tooltipForEntity from '../tooltips/tooltipForEntity.js'\r\n\r\n/**\r\n * This represents a spatial distribution of candidates.\r\n * A draggable handle handle provides draggable behavior.\r\n * @param {Object} shape2\r\n * @param {Object} shape1\r\n * @param {Screen} screen\r\n * @param {Registrar} candidateDnRegistrar\r\n * @param {Commander} commander\r\n * @param {Changes} changes\r\n * @param {Boolean} doLoad - Should we add the candidateDn without adding to the history?\r\n * @constructor\r\n */\r\nexport default function CandidateDistribution(\r\n    shape2,\r\n    shape1,\r\n    screen,\r\n    candidateDnRegistrar,\r\n    commander,\r\n    changes,\r\n    doLoad,\r\n    candidateDnCommander,\r\n    sim,\r\n) {\r\n    const self = this\r\n\r\n    self.shape2 = {}\r\n    self.shape1 = {}\r\n\r\n    const id = candidateDnRegistrar.new(self)\r\n\r\n    // Instantiate Variables\r\n\r\n    // use commands to instantiate variables\r\n    self.instantiate = () => {\r\n        const shape2p = { x: shape2.x, y: shape2.y }\r\n\r\n        const commands = [\r\n            candidateDnCommander.setForListSenders.exists.command(id, 1, 0), // set alive flag\r\n            candidateDnCommander.setForListSenders.shape2p.command(id, shape2p, shape2p),\r\n            candidateDnCommander.setForListSenders.shape1x.command(id, shape1.x, shape1.x),\r\n            candidateDnCommander.setForListSenders.shape2w.command(id, shape2.w, shape2.w),\r\n            candidateDnCommander.setForListSenders.shape1w.command(id, shape1.w, shape1.w),\r\n            candidateDnCommander.setForListSenders.shape1densityProfile.command(\r\n                id,\r\n                shape1.densityProfile,\r\n                shape1.densityProfile,\r\n            ),\r\n        ]\r\n        // Either load the commands because we don't want to create an item of history\r\n        // Or do the commands because want to store an item in history, so that we can undo.\r\n        if (doLoad) {\r\n            commander.loadCommands(commands)\r\n        } else {\r\n            commander.doCommands(commands)\r\n        }\r\n    }\r\n\r\n    self.setAction = {}\r\n\r\n    self.setAction.exists = (e) => {\r\n        self.exists = e\r\n        changes.add(['draggables'])\r\n    }\r\n    self.setE = (e) => {\r\n        const cur = candidateDnCommander.setForListSenders.exists.getCurrentValue(id)\r\n        candidateDnCommander.setForListSenders.exists.go(id, e, cur)\r\n    }\r\n\r\n    self.setAction.shape2p = (p) => {\r\n        self.shape2.x = p.x\r\n        self.shape2.y = p.y\r\n        if (sim.election.dimensions === 2) {\r\n            self.x = p.x\r\n            self.y = p.y\r\n        }\r\n        changes.add(['draggables'])\r\n    }\r\n    self.setAction.shape1x = (p) => {\r\n        self.shape1.x = p\r\n        if (sim.election.dimensions === 1) {\r\n            self.x = p\r\n            self.y = 250\r\n        }\r\n        changes.add(['draggables'])\r\n    }\r\n    self.setXY = (p) => {\r\n        if (sim.election.dimensions === 1) {\r\n            const cur = candidateDnCommander.setForListSenders.shape1x.getCurrentValue(id)\r\n            candidateDnCommander.setForListSenders.shape1x.go(id, p.x, cur)\r\n        } else {\r\n            const cur = candidateDnCommander.setForListSenders.shape2p.getCurrentValue(id)\r\n            candidateDnCommander.setForListSenders.shape2p.go(id, p, cur)\r\n        }\r\n    }\r\n    /** Do this when entering a state because x and y change.\r\n     *  Maybe x and y should be in the SimCandidateDn instead... just speculating. */\r\n    self.updateXY = () => {\r\n        if (sim.election.dimensions === 1) {\r\n            self.setAction.shape1x(self.shape1.x)\r\n        } else {\r\n            self.setAction.shape2p({ x: self.shape2.x, y: self.shape2.y })\r\n        }\r\n    }\r\n\r\n    self.setAction.shape2w = (newW) => {\r\n        self.shape2.w = newW\r\n        changes.add(['width'])\r\n    }\r\n    self.setW2 = (newW) => {\r\n        const cur = candidateDnCommander.setForListSenders.shape2w.getCurrentValue(id)\r\n        candidateDnCommander.setForListSenders.shape2w.go(id, newW, cur)\r\n    }\r\n\r\n    self.setAction.shape1w = (newW) => {\r\n        self.shape1.w = newW\r\n        changes.add(['width'])\r\n    }\r\n    self.setW1 = (newW) => {\r\n        const cur = candidateDnCommander.setForListSenders.shape1w.getCurrentValue(id)\r\n        candidateDnCommander.setForListSenders.shape1w.go(id, newW, cur)\r\n    }\r\n\r\n    /** Density Profile can be \"gaussian\" or \"step\" */\r\n    self.setAction.shape1densityProfile = (newDensityProfile1) => {\r\n        self.shape1.densityProfile = newDensityProfile1\r\n        changes.add(['densityProfile'])\r\n    }\r\n    self.setDensityProfile1 = (newDensityProfile1) => {\r\n        const cur = candidateDnCommander.setForListSenders.shape1densityProfile.getCurrentValue(id)\r\n        candidateDnCommander.setForListSenders.shape1densityProfile.go(id, newDensityProfile1, cur)\r\n    }\r\n    self.instantiate()\r\n\r\n    // Click Handler\r\n\r\n    self.click = () => {\r\n        tooltipForEntity(self, screen, sim)\r\n    }\r\n\r\n    // Rendering\r\n\r\n    self.color = '#ccc'\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Register senders with the commander for setting entity values.\r\n * This is here because we need an action that takes an id.\r\n * @param {Registrar} candidateDnRegistrar\r\n * @param {Commander} commander\r\n * @param {Sim} sim\r\n * @constructor\r\n */\r\nexport default function CandidateDnCommander(candidateDnRegistrar, commander, sim) {\r\n    const self = this\r\n\r\n    const prefix = 'candidateDns'\r\n\r\n    // a object with senders that set parameters for lists of entities.\r\n    // Like if you want to set the exists property of the 2nd candidate to 1.\r\n    self.setForListSenders = {}\r\n\r\n    function makeSetForListSender(key, configKey, isChain) {\r\n        self.setForListSenders[key] = commander.addSenderForList({\r\n            action: (id, e) => {\r\n                self.setNumberCandidateDns(id + 1)\r\n                const candidateDn = candidateDnRegistrar.get(id)\r\n                candidateDn.setAction[key](e)\r\n            },\r\n            name: `${prefix}-${configKey}`,\r\n            props: { isChain },\r\n        })\r\n    }\r\n\r\n    makeSetForListSender('exists', 'exists', false)\r\n    makeSetForListSender('shape2p', 'shape2D-point', true)\r\n    makeSetForListSender('shape1x', 'shape1D-x', true)\r\n    makeSetForListSender('shape2w', 'shape2D-width', true)\r\n    makeSetForListSender('shape1w', 'shape1D-width', true)\r\n    makeSetForListSender('shape1densityProfile', 'shape1D-densityProfile', false)\r\n\r\n    // This is kind of weird because this value is not a good measure of the number of entities.\r\n    // An undo will reduce the number stored with the command name,\r\n    // but not reduce the number of entities.\r\n    // So we disable undo.\r\n    self.setNumberCandidateDnsSender = commander.addSender({\r\n        action: (num) => {\r\n            sim.setNumberCandidateDnsAction(num)\r\n        },\r\n        currentValue: 0,\r\n        name: `${prefix}-setNumberAtLeast`,\r\n        props: { isFirstAction: true },\r\n    })\r\n    self.setNumberCandidateDns = (num) => {\r\n        commander.loadCommands([self.setNumberCandidateDnsSender.command(num)])\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Add button to layout for adding a candidate\r\n * @param {Layout} layout\r\n * @param {Commander} commander\r\n */\r\nexport default function CandidateDnAddMakeButton(layout, sim) {\r\n    const self = this\r\n    const addCandidateDistributionButton = document.createElement('button')\r\n\r\n    addCandidateDistributionButton.className = 'button2'\r\n    addCandidateDistributionButton.innerText = 'Add Candidate Distribution'\r\n\r\n    addCandidateDistributionButton.onclick = () => {\r\n        sim.addCandidateDistributionPressed()\r\n    }\r\n\r\n    layout.newElement('addCandidateDistribution', addCandidateDistributionButton)\r\n\r\n    self.show = () => {\r\n        addCandidateDistributionButton.hidden = false\r\n    }\r\n    self.hide = () => {\r\n        addCandidateDistributionButton.hidden = true\r\n    }\r\n}\r\n","import CandidateDn from './CandidateDn.js'\r\nimport CandidateDnCommander from './CandidateDnCommander.js'\r\nimport CandidateDnAddMakeButton from '../sim/CandidateDnAddMakeButton.js'\r\nimport Registrar from '../sim/Registrar.js'\r\n\r\n/** A component of sim.js that deals with adding candidate distributions. */\r\nexport default function CandidateDnAdd(screen, layout, changes, commander, sims, sim) {\r\n    const self = this\r\n\r\n    self.canDnButton = new CandidateDnAddMakeButton(layout, self)\r\n    const candidateDnRegistrar = new Registrar()\r\n    const candidateDnCommander = new CandidateDnCommander(candidateDnRegistrar, commander, self)\r\n\r\n    self.addCandidateDistributionPressed = () => {\r\n        const num = candidateDnRegistrar.num() + 1\r\n        candidateDnCommander.setNumberCandidateDns(num)\r\n    }\r\n    self.setNumberCandidateDnsAction = (num) => {\r\n        while (candidateDnRegistrar.num() < num) {\r\n            self.addCandidateDistribution({ x: 50, y: 50, w: 200 }, { x: 50, w: 200, densityProfile: 'gaussian' }, false)\r\n        }\r\n    }\r\n\r\n    self.addCandidateDistribution = (shape2, shape1, doLoad) => {\r\n        // eslint-disable-next-line no-new, max-len\r\n        const candidateDn = new CandidateDn(shape2, shape1, screen, candidateDnRegistrar, commander, changes, doLoad, candidateDnCommander, sim)\r\n        sims.sample.addSimCandidateDistribution(candidateDn)\r\n\r\n        const num = candidateDnRegistrar.num()\r\n        candidateDnCommander.setNumberCandidateDns(num)\r\n    }\r\n}\r\n","import { textPercent } from '../utilities/graphicsUtilities.js'\r\n\r\nexport default function TooltipVoteText(box) {\r\n    const self = this\r\n\r\n    const voteText = document.createElement('div')\r\n    box.append(voteText)\r\n\r\n    self.update = (vote, color, colorSet) => {\r\n        // box.style.backgroundColor = color\r\n        // const makeSpan = (c) => `<span style=\"background-color:${c};\">&#9638;</span>`\r\n        const makeSpan = (c) => `<span style=\"color:${c};\">&#9632;</span>` // crosshatch: &#9638; square: &#9632; large black square: &#11035;\r\n\r\n        if (vote.ranking) {\r\n            voteText.innerHTML = vote.ranking.map((c, i) => makeSpan(colorSet[i]) + c).join('<br />')\r\n        } else if (vote.tallyFractions) {\r\n            voteText.innerHTML = vote.tallyFractions.map(textPercent).map((c, i) => makeSpan(colorSet[i]) + c).join('<br />')\r\n        }\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Blend colors in given proportions.\r\n * @param {Number[]} f - proportions of colors, as fraction of 1.\r\n * @param {Number[][]} colors - list of lists. rgb colors.\r\n * @returns {String} - Color\r\n */\r\nexport default function colorBlender(f, colors) { // f fractions\r\n    const n = f.length\r\n\r\n    const sum2 = [0, 0, 0]\r\n    let sumF = 0\r\n    for (let i = 0; i < n; i++) {\r\n        for (let c = 0; c < 3; c++) {\r\n            sum2[c] += f[i] * colors[i][c] ** 2\r\n        }\r\n        sumF += f[i]\r\n    }\r\n    const blend = sum2.map((x) => Math.round(Math.sqrt(x / sumF)))\r\n    return blend\r\n}\r\n\r\nexport function rgbToString(c) {\r\n    return `rgb(${c[0]},${c[1]},${c[2]})`\r\n}\r\n","import CircleGraphic from '../vizEntities/CircleGraphic.js'\r\nimport hideOnClickOutside from '../tooltips/hideOnClickOutside.js'\r\nimport tooltipForTestVoter from '../tooltips/tooltipForTestVoter.js'\r\nimport colorBlender, { rgbToString } from '../viz/colorBlender.js'\r\n\r\nexport default function VoterTest(screen, sims, sim) {\r\n    const self = this\r\n\r\n    // Position\r\n\r\n    self.shape1 = {}\r\n    self.shape2 = {}\r\n\r\n    self.setAction = {}\r\n    self.setAction.exists = (e) => {\r\n        self.exists = e\r\n    }\r\n    self.setE = (e) => {\r\n        self.setAction.exists(e)\r\n    }\r\n\r\n    self.setAction.shape2p = (p) => {\r\n        self.shape2.x = p.x\r\n        self.shape2.y = p.y\r\n        if (sim.election.dimensions === 2) {\r\n            self.x = p.x\r\n            self.y = p.y\r\n        }\r\n    }\r\n    self.setAction.shape1x = (p) => {\r\n        self.shape1.x = p\r\n        if (sim.election.dimensions === 1) {\r\n            self.x = p\r\n            self.y = 250\r\n        }\r\n    }\r\n    self.setXY = (p) => {\r\n        if (sim.election.dimensions === 1) {\r\n            self.setAction.shape1x(p.x)\r\n        } else {\r\n            self.setAction.shape2p(p)\r\n        }\r\n        sim.testVote()\r\n    }\r\n    /** Do this when entering a state because x and y change. */\r\n    self.updateXY = () => {\r\n        if (sim.election.dimensions === 1) {\r\n            self.setAction.shape1x(self.shape1.x)\r\n        } else {\r\n            self.setAction.shape2p({ x: self.shape2.x, y: self.shape2.y })\r\n        }\r\n    }\r\n\r\n    // Initialize\r\n\r\n    self.setAction.shape1x(0)\r\n    self.setAction.shape2p({ x: 0, y: 0 })\r\n\r\n    // Start displaying testvoter\r\n    self.start = (p) => {\r\n        sim.voterTest.setE(1)\r\n        sim.voterTest.setXY(p)\r\n        hideOnClickOutside(screen.wrap, removeTestPoint)\r\n    }\r\n    function removeTestPoint() {\r\n        sim.voterTest.setE(0)\r\n    }\r\n\r\n    // Dragging\r\n\r\n    self.color = '#999'\r\n    const circle = new CircleGraphic(self, 9, screen)\r\n    self.circle = circle\r\n\r\n    sims.one.dragm.newCircleHandle(self, self.circle)\r\n    sims.sample.dragm.newCircleHandle(self, self.circle)\r\n\r\n    // Rendering\r\n\r\n    let tooltip = {}\r\n\r\n    self.update = (vote, candidateSimList) => {\r\n        // who would this test point vote for?\r\n        if (vote === undefined) return null\r\n\r\n        const canList = candidateSimList.getCandidates()\r\n        const colorSet = canList.map((can) => can.color)\r\n        const colorSetRGBA = canList.map((can) => can.colorRGBA)\r\n        self.colorSet = colorSet\r\n\r\n        const { tallyFractions } = vote\r\n        self.color = rgbToString(colorBlender(tallyFractions, colorSetRGBA))\r\n\r\n        if (tooltip.box) {\r\n            tooltip.update(vote, self.color, self.colorSet)\r\n        }\r\n\r\n        return vote\r\n    }\r\n\r\n    self.click = () => {\r\n        const vote = sim.testVote()\r\n        if (vote === null) return\r\n\r\n        if (tooltip.box) tooltip.box.remove()\r\n        tooltip = tooltipForTestVoter(self, screen)\r\n        tooltip.update(vote, self.color, self.colorSet)\r\n    }\r\n\r\n    self.renderForeground = () => {\r\n        // handle\r\n        if (self.exists || sim.showGhosts) {\r\n            circle.render()\r\n        }\r\n    }\r\n}\r\n","import tooltipBox from './tooltipBox.js'\r\nimport TooltipVoteText from './TooltipVoteText.js'\r\n\r\nexport default function tooltipForTestVoter(entity, screen) {\r\n    // make a html box appear\r\n\r\n    const tbox = tooltipBox(entity, screen)\r\n    const { box, setPin } = tbox\r\n\r\n    box.innerText = 'Vote'\r\n    box.style['min-width'] = '100px'\r\n\r\n    const button = document.createElement('button')\r\n    // button.className = 'button2'\r\n    button.style['min-width'] = '35px'\r\n    button.style.float = 'right'\r\n    button.style.clear = 'right'\r\n\r\n    button.onclick = () => {\r\n        togglePin()\r\n    }\r\n    let pinned = true\r\n    function togglePin() {\r\n        pinned = !pinned\r\n        setPin(pinned)\r\n        // button.innerText = (pinned) ? 'Pinned' : 'Pin'\r\n        button.innerHTML = (pinned) ? '&#x1F6AB;' : '&#x1F4CC;'\r\n    }\r\n    togglePin()\r\n\r\n    const button2 = document.createElement('button')\r\n    // button2.className = 'button2'\r\n    button2.style.float = 'right'\r\n    button2.style['min-width'] = '35px'\r\n    button2.style['font-size'] = '10px'\r\n    button2.innerHTML = '&#x2573;'\r\n    button2.onclick = () => {\r\n        box.remove()\r\n        entity.setE(0)\r\n    }\r\n    box.appendChild(button2)\r\n    box.appendChild(button)\r\n\r\n    const tooltipVoteText = new TooltipVoteText(box)\r\n\r\n    // box.style['pointer-events'] = 'none'\r\n    screen.tooltips.appendChild(box)\r\n\r\n    function update(vote, color, colorSet) {\r\n        tbox.update()\r\n        tooltipVoteText.update(vote, color, colorSet)\r\n    }\r\n\r\n    return { box, update }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * A simple election.\r\n * Voters are in shaped distributions.\r\n * @param {Screen} screen\r\n * @param {Menu} menu\r\n * @param {Election} election\r\n * @constructor\r\n */\r\nexport default function ElectionOne(election) {\r\n    const self = this\r\n\r\n    const optionCast = { usr: 4 }\r\n\r\n    self.runElectionSim = function (oneVoters, candidateSimList, changes) {\r\n        if (changes.checkNone()) return { error: 'No Changes' }\r\n\r\n        // Voters cast votes for candidates.\r\n        // There is also a separate graphical representation in Voronoi2D.js\r\n        const canList = candidateSimList.getCandidates()\r\n        const voterShapes = oneVoters.getVoterShapes()\r\n\r\n        if (voterShapes.length === 0) return { error: 'No Voters' }\r\n        if (canList.length === 0) return { error: 'No Candidates' }\r\n\r\n        const electionResults = election.runElection(voterShapes, canList, optionCast)\r\n\r\n        return electionResults\r\n    }\r\n\r\n    self.testVoteES = (voterTest, candidateSimList) => {\r\n        const vote = election.testVoteE(voterTest, candidateSimList)\r\n        return vote\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Simulate winners from many sampled elections.\r\n * Candidates are sampled from a distribution.\r\n * Winners are drawn as points.\r\n * The simulation is dynamic. More simulations are performed at each frame.\r\n * @param {Screen} screen\r\n * @param {Menu} menu\r\n * @param {Election} election\r\n * @constructor\r\n */\r\nexport default function ElectionSample(election) {\r\n    const self = this\r\n\r\n    const optionCast = { usr: 16 }\r\n\r\n    const maxPoints = 5000\r\n\r\n    let points = []\r\n\r\n    self.update = function (voterSimList, candidateDnSimList, changes, dimensions) {\r\n        if (changes.checkNone() === false) {\r\n            self.startSim()\r\n        }\r\n\r\n        const addResult = self.addSim(voterSimList, candidateDnSimList, dimensions)\r\n        return addResult\r\n    }\r\n\r\n    self.startSim = function () {\r\n        points = []\r\n    }\r\n\r\n    self.addSim = function (voterSimList, candidateDnSimList, dimensions) {\r\n        // add more points\r\n\r\n        if (voterSimList.getVoterShapes().length === 0) return { pointsChanged: false }\r\n        if (candidateDnSimList.getCandidateDistributions().length === 0) {\r\n            return { pointsChanged: false }\r\n        }\r\n\r\n        if (points.length > maxPoints) return { pointsChanged: false }\r\n        // this limit right now is about graphics rendering.\r\n        // todo: render to a buffer\r\n\r\n        // number of sample elections\r\n        const ns = 20\r\n\r\n        // number of new points\r\n        const { seats } = election.socialChoice\r\n        const nnp = seats * ns\r\n        const newPoints = Array(nnp)\r\n        let q = 0\r\n\r\n        const voterShapes = voterSimList.getVoterShapes()\r\n\r\n        for (let i = 0; i < ns; i++) {\r\n            // choose a number of candidates\r\n            const nk = election.socialChoice.numSampleCandidates\r\n            const canList = []\r\n            for (let k = 0; k < nk; k++) {\r\n                // sample a point from the distribution of candidates\r\n                const point = candidateDnSimList.sampler.samplePoint()\r\n\r\n                // make a candidate\r\n                if (dimensions === 1) {\r\n                    canList.push({ shape1: point })\r\n                } else {\r\n                    canList.push({ shape2: point })\r\n                }\r\n            }\r\n\r\n            // find winner position\r\n            const electionResults = election.runElection(voterShapes, canList, optionCast)\r\n\r\n            if (election.socialChoice.checkElectionType() === 'singleWinner') {\r\n                const { winner } = electionResults\r\n\r\n                // record point\r\n                const winPoint = (dimensions === 1) ? winner.shape1 : winner.shape2\r\n                points.push(winPoint)\r\n                newPoints[i] = winPoint\r\n            } else {\r\n                const { allocation } = electionResults\r\n\r\n                const jitterSize = 10\r\n                for (let k = 0; k < canList.length; k++) {\r\n                    const can = canList[k]\r\n                    const numPoints = allocation[k]\r\n                    for (let m = 0; m < numPoints; m++) {\r\n                        let winPoint\r\n                        if (m === 0) {\r\n                            // record point\r\n                            winPoint = (dimensions === 1) ? can.shape1 : can.shape2\r\n                        } else if (dimensions === 1) {\r\n                            // add jitter\r\n                            winPoint = {\r\n                                x: can.shape1.x + (Math.random() - 0.5) * jitterSize,\r\n                            }\r\n                        } else {\r\n                            // add jitter\r\n                            winPoint = {\r\n                                x: can.shape2.x + (Math.random() - 0.5) * jitterSize,\r\n                                y: can.shape2.y + (Math.random() - 0.5) * jitterSize,\r\n                            }\r\n                        }\r\n                        // record point\r\n                        points.push(winPoint)\r\n                        newPoints[q] = winPoint\r\n                        q += 1\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return { pointsChanged: true, newPoints, points }\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport { range } from '../utilities/jsHelpers.js'\r\n\r\n/**\r\n * An election with many districts.\r\n * Voters are from many groups.\r\n * Voter groups are centered around a point.\r\n * The point is moved by simplex noise to create distinct districts.\r\n * All the voter groups share the same voter basis.\r\n * @param {Menu} menu\r\n * @param {Election} election\r\n * @constructor\r\n */\r\nexport default function ElectionGeo(election) {\r\n    const self = this\r\n\r\n    const optionCast = { usr: 32 }\r\n\r\n    self.runElectionSim = (voterGeoList, candidateSimList, changes) => {\r\n        if (changes.checkNone()) return { error: 'No Changes' }\r\n\r\n        const canList = candidateSimList.getCandidates()\r\n\r\n        const geoElectionResults = self.runElection2(voterGeoList, canList)\r\n\r\n        return geoElectionResults\r\n    }\r\n\r\n    self.runElection2 = (voterGeoList, canList) => {\r\n        if (voterGeoList.getVoterSims().length === 0) return { error: 'no voters' }\r\n        if (canList.length === 0) return { error: 'no candidates' }\r\n\r\n        const votesByTract = castVotesByTract(voterGeoList, canList)\r\n\r\n        const resultsStatewide = countStatewideElection(votesByTract, canList)\r\n\r\n        const resultsByTract = countTractElections(votesByTract, canList)\r\n\r\n        const resultsByDistrict = countDistrictElections(votesByTract, canList, voterGeoList)\r\n        const allocation = sumAllocations(resultsByDistrict, canList)\r\n\r\n        const geoElectionResults = {\r\n            resultsStatewide,\r\n            resultsByTract,\r\n            resultsByDistrict,\r\n            allocation,\r\n        }\r\n        return geoElectionResults\r\n    }\r\n\r\n    function castVotesByTract(voterGeoList, canList) {\r\n        const { voterGroupsByTract } = voterGeoList\r\n\r\n        const votesByTract = voterGroupsByTract.map(\r\n            (row) => row.map(\r\n                (voterGroups) => election.castVotes(voterGroups, canList, optionCast),\r\n            ),\r\n        )\r\n        return votesByTract\r\n    }\r\n\r\n    /** Show tallies over all the districts\r\n     * Find statewide support for candidates (parties).\r\n     */\r\n    function countStatewideElection(votesByTract, canList) {\r\n        const numCans = canList.length\r\n        const allVotes = combineVotes(votesByTract, numCans)\r\n\r\n        const resultsStatewide = election.socialChoice.run(canList, allVotes)\r\n        return resultsStatewide\r\n    }\r\n\r\n    function combineVotes(votesByTract, numCans) {\r\n        const votes = {}\r\n\r\n        if (votesByTract[0][0].tallyFractions !== undefined) {\r\n            // tf - tally fractions\r\n            const tf = statewideTallyFractions(votesByTract, numCans)\r\n            votes.tallyFractions = tf\r\n        }\r\n        if (votesByTract[0][0].pairwiseTallyFractions !== undefined) {\r\n            // pwtf - pairwise tally fractions\r\n            const pwtf = statewidePairwiseTallyFractions(votesByTract, numCans)\r\n            votes.pairwiseTallyFractions = pwtf\r\n        }\r\n        if (votesByTract[0][0].rankingTallyFractions !== undefined) {\r\n            // vrtf - votes ranked tally fractions\r\n            const vrtf = statewideRankingTallyFractions(votesByTract)\r\n            votes.rankingTallyFractions = vrtf.rankingTallyFractions\r\n            votes.cansRankedAll = vrtf.cansRankedAll\r\n        }\r\n        return votes\r\n    }\r\n\r\n    function statewideTallyFractions(votesByTract, numCans) {\r\n        // sum tallyFractions\r\n        const totals = Array(numCans).fill(0)\r\n        votesByTract.forEach(\r\n            (row) => row.forEach(\r\n                (votes) => {\r\n                    const { tallyFractions } = votes\r\n                    for (let k = 0; k < numCans; k++) {\r\n                        totals[k] += tallyFractions[k]\r\n                    }\r\n                },\r\n            ),\r\n        )\r\n        const norm = 1 / totals.reduce((p, c) => p + c)\r\n        const tallyFractions = totals.map((t) => t * norm)\r\n        return tallyFractions\r\n    }\r\n\r\n    function statewidePairwiseTallyFractions(votesByTract, numCans) {\r\n        // sum pairwiseTallyFractions\r\n        const pTotals = Array(numCans)\r\n        for (let k = 0; k < numCans; k++) {\r\n            pTotals[k] = Array(numCans).fill(0)\r\n        }\r\n        votesByTract.forEach(\r\n            (row) => row.forEach(\r\n                (votes) => {\r\n                    const { pairwiseTallyFractions } = votes\r\n                    for (let i = 0; i < numCans; i++) {\r\n                        for (let k = 0; k < numCans; k++) {\r\n                            pTotals[i][k] += pairwiseTallyFractions[i][k]\r\n                        }\r\n                    }\r\n                },\r\n            ),\r\n        )\r\n        const pNorm = 1 / (pTotals[0][1] + pTotals[1][0]) // sum wins and losses\r\n        const pairwiseTallyFractions = pTotals.map((row) => row.map((t) => t * pNorm))\r\n        return pairwiseTallyFractions\r\n    }\r\n\r\n    function statewideRankingTallyFractions(votesByTract) {\r\n        // concatenate rankingTallyFractions\r\n        let rankingTallyFractionsAll = []\r\n        let cansRankedAll2 = []\r\n        votesByTract.forEach(\r\n            (row) => row.forEach(\r\n                (votes) => {\r\n                    const { rankingTallyFractions, cansRankedAll } = votes\r\n                    rankingTallyFractionsAll = rankingTallyFractionsAll\r\n                        .concat(rankingTallyFractions)\r\n                    cansRankedAll2 = cansRankedAll2.concat(cansRankedAll)\r\n                },\r\n            ),\r\n        )\r\n        const numRows = votesByTract.length\r\n        const numCols = votesByTract[0].length\r\n        const rNorm = 1 / (numRows * numCols)\r\n        rankingTallyFractionsAll = rankingTallyFractionsAll.map((t) => t * rNorm)\r\n        return {\r\n            rankingTallyFractions: rankingTallyFractionsAll,\r\n            cansRankedAll: cansRankedAll2,\r\n        }\r\n    }\r\n\r\n    /** Visualize voter demographics according to votes for candidates within a tract.\r\n     * Hold mini-elections within a tract.\r\n     */\r\n    function countTractElections(votesByTract, canList) {\r\n        const resultsByTract = votesByTract.map(\r\n            (row) => row.map(\r\n                (votes) => election.socialChoice.run(canList, votes),\r\n            ),\r\n        )\r\n        return resultsByTract\r\n    }\r\n\r\n    /** Run separate elections in each district. */\r\n    function countDistrictElections(votesByTract, canList, voterGeoList) {\r\n        // Loop through districts.\r\n        // Find who won.\r\n\r\n        const votesByDistrict = combineVotesByDistrict(votesByTract, canList, voterGeoList)\r\n\r\n        const resultsByDistrict = votesByDistrict.map(\r\n            (votes) => election.socialChoice.run(canList, votes),\r\n        )\r\n        return resultsByDistrict\r\n    }\r\n\r\n    function combineVotesByDistrict(votesByTract, canList, voterGeoList) {\r\n        const { census } = voterGeoList.districtMaker\r\n        const { nd } = voterGeoList\r\n        const numCans = canList.length\r\n\r\n        // loop through districts\r\n        // each district has a census with a list of tracts with weights\r\n        // tracts are listed by index\r\n        // This is the same index as the votes list uses.\r\n        const votesByDistrict = range(nd).map((iDistrict) => {\r\n            const cen = census[iDistrict]\r\n\r\n            const votes = {}\r\n\r\n            if (votesByTract[0][0].tallyFractions !== undefined) {\r\n                // tf - tally fractions\r\n                const tf = districtTallyFractions(votesByTract, cen, numCans)\r\n                votes.tallyFractions = tf\r\n            }\r\n\r\n            if (votesByTract[0][0].pairwiseTallyFractions !== undefined) {\r\n                // pwtf - pairwise tally fractions\r\n                const pwtf = districtPairwiseTallyFractions(votesByTract, cen, numCans)\r\n                votes.pairwiseTallyFractions = pwtf\r\n            }\r\n            if (votesByTract[0][0].rankingTallyFractions !== undefined) {\r\n                // vrtf - votes ranked tally fractions\r\n                const vrtf = districtRankingTallyFractions(votesByTract, cen)\r\n                votes.rankingTallyFractions = vrtf.rankingTallyFractions\r\n                votes.cansRankedAll = vrtf.cansRankedAll\r\n            }\r\n            return votes\r\n        })\r\n        return votesByDistrict\r\n    }\r\n\r\n    function districtTallyFractions(votesByTract, cen, numCans) {\r\n        // sum tallyFractions\r\n        const totals = Array(numCans).fill(0)\r\n        for (let j = 0; j < cen.length; j++) {\r\n            const [gx, gy, gf] = cen[j]\r\n            const { tallyFractions } = votesByTract[gx][gy]\r\n            for (let k = 0; k < numCans; k++) {\r\n                totals[k] += tallyFractions[k] * gf\r\n            }\r\n        }\r\n        const norm = 1 / totals.reduce((p, c) => p + c)\r\n        const tallyFractions = totals.map((t) => t * norm)\r\n        return tallyFractions\r\n    }\r\n\r\n    function districtPairwiseTallyFractions(votesByTract, cen, numCans) {\r\n        // sum pairwiseTallyFractions\r\n        const pTotals = Array(numCans)\r\n        for (let k = 0; k < numCans; k++) {\r\n            pTotals[k] = Array(numCans).fill(0)\r\n        }\r\n        for (let j = 0; j < cen.length; j++) {\r\n            const [gx, gy, gf] = cen[j]\r\n            const { pairwiseTallyFractions } = votesByTract[gx][gy]\r\n            for (let i = 0; i < numCans; i++) {\r\n                for (let k = 0; k < numCans; k++) {\r\n                    pTotals[i][k] += pairwiseTallyFractions[i][k] * gf\r\n                }\r\n            }\r\n        }\r\n        const pNorm = 1 / (pTotals[0][1] + pTotals[1][0]) // sum wins and losses\r\n        const pairwiseTallyFractions = pTotals.map((row) => row.map((t) => t * pNorm))\r\n        return pairwiseTallyFractions\r\n    }\r\n\r\n    function districtRankingTallyFractions(votesByTract, cen) {\r\n        // concatenate rankingTallyFractions\r\n        let rankingTallyFractionsAll = []\r\n        let cansRankedAll2 = []\r\n\r\n        let gfSum = 0\r\n        for (let j = 0; j < cen.length; j++) {\r\n            const [, , gf] = cen[j]\r\n            gfSum += gf\r\n        }\r\n        const gfNorm = 1 / gfSum\r\n\r\n        for (let j = 0; j < cen.length; j++) {\r\n            const [gx, gy, gf] = cen[j]\r\n            gfSum += gf\r\n            const { rankingTallyFractions, cansRankedAll } = votesByTract[gx][gy]\r\n            const rankingTallyFractionsNorm = rankingTallyFractions\r\n                .map((x) => x * gf * gfNorm)\r\n            rankingTallyFractionsAll = rankingTallyFractionsAll\r\n                .concat(rankingTallyFractionsNorm)\r\n            cansRankedAll2 = cansRankedAll2.concat(cansRankedAll)\r\n        }\r\n        return {\r\n            rankingTallyFractions: rankingTallyFractionsAll,\r\n            cansRankedAll: cansRankedAll2,\r\n        }\r\n    }\r\n\r\n    // Show wins across all districts for each candidate\r\n    function sumAllocations(resultsByDistrict, canList) {\r\n        // make a histogram of allocation\r\n        const numCandidates = canList.length\r\n        const allocation = Array(numCandidates).fill(0)\r\n        if (election.socialChoice.checkElectionType() === 'singleWinner') {\r\n            const iWinners = resultsByDistrict.map((electionResults) => electionResults.iWinner)\r\n            iWinners.forEach((iWinner) => {\r\n                allocation[iWinner] += 1\r\n            })\r\n        } else {\r\n            resultsByDistrict.forEach(\r\n                (electionResults) => {\r\n                    for (let i = 0; i < numCandidates; i++) {\r\n                        allocation[i] += electionResults.allocation[i]\r\n                    }\r\n                },\r\n            )\r\n        }\r\n        return allocation\r\n    }\r\n\r\n    self.testVoteES = (voterTest, candidateSimList) => {\r\n        const vote = election.testVoteE(voterTest, candidateSimList)\r\n        return vote\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Sum area of voter distributions to tally the votes.\r\n * @param {Object[]} canGeoms\r\n * @constructor\r\n */\r\nexport default function AreaSummer(canGeoms) {\r\n    const self = this\r\n\r\n    const lines = findLines(canGeoms)\r\n\r\n    // todo: figure out if this is really just a function rather than a class.\r\n\r\n    self.sumArea = function sumArea(voterGeom) {\r\n        // draw lines across shape of voterGeom\r\n\r\n        const n = lines.length\r\n        const area = Array(n)\r\n        for (let i = 0; i < n; i++) {\r\n            const lineSet = lines[i]\r\n            // return area for each candidate\r\n            area[i] = sumCircle(voterGeom, lineSet)\r\n        }\r\n        return area\r\n    }\r\n}\r\n\r\nfunction findLines(canGeoms) {\r\n    // find all lines\r\n    const n = canGeoms.length\r\n    const lines = new Array(n) // each candidate has a set of lines for themselves\r\n    for (let i = 0; i < n; i++) {\r\n        lines[i] = []\r\n        for (let k = 0; k < n; k++) {\r\n            // skip sames\r\n            if (i === k) continue\r\n            // find equation for a line\r\n            const c1 = canGeoms[i]\r\n            const c2 = canGeoms[k]\r\n            // lines[i][k] = equidistantLine(c1,c2) // problem when i === k\r\n            lines[i].push(equidistantLine(c1, c2))\r\n        }\r\n    }\r\n\r\n    return lines\r\n}\r\n\r\n/**\r\n * Test for the function equidistantLine, which finds a line equidistant from two points.\r\n * @param {Function} eq - assertion function for equality\r\n * @param {Function} assert - assertion function for true\r\n * @returns {Object[]} an array of test objects, each with a label and a test function.\r\n */\r\nexport function testEquidistantLine(eq, assert) {\r\n    // Takes an assertion function.\r\n    // Returns a test function.\r\n\r\n    return [{\r\n        label: 'Finds line equation equidistant from two points.',\r\n        test: () => {\r\n            const m = equidistantLine({ x: 0, y: 0 }, { x: 1, y: 1 })\r\n            const e = { A: { x: 1, y: 1 }, b: 1 }\r\n            eq(e.A.x / e.b, m.A.x / m.b)\r\n            eq(e.A.y / e.b, m.A.y / m.b)\r\n        },\r\n    }, {\r\n        label: 'The first point satisfies Ac < b. A[0,0] < b. ',\r\n        test: () => {\r\n            const m = equidistantLine({ x: 0, y: 0 }, { x: 1, y: 1 })\r\n            assert(m.b > 0)\r\n        },\r\n    },\r\n    ]\r\n}\r\n\r\nexport function equidistantLine(c1, c2) {\r\n    // Ac < b\r\n    // this is the condition that x counts for a candidate.\r\n\r\n    // line equidistant from two points\r\n    // https://math.stackexchange.com/a/771773\r\n\r\n    // difference between points\r\n    const dx = c2.x - c1.x\r\n    const dy = c2.y - c1.y\r\n\r\n    // midpoint between points\r\n    const mx = (c1.x + c2.x) * 0.5\r\n    const my = (c1.y + c2.y) * 0.5\r\n\r\n    // equation for line\r\n    // (y-my) / (x-mx) = - dx / dy\r\n    // implies y * dy - my * dy = - x * dx + mx * dx\r\n    // implies dx * x + dy * y = mx * dx + my * dy\r\n    // rename to A = [dx;dy]\r\n    //           b = mx * dx + my * dy\r\n    const A = { x: dx, y: dy }\r\n    const b = mx * dx + my * dy\r\n\r\n    // is c1 or c2 closer?\r\n    // c1 is closer is equivalent to Ac < b\r\n\r\n    return { A, b }\r\n}\r\n\r\nfunction sumCircle(circle, lineSet) {\r\n    // integrate inside\r\n    //   Need a direction for \"inside\" for each line.\r\n    //   Then do a 1D consideration of what is inside.\r\n\r\n    // for each x coordinate,\r\n    const dx = 2\r\n    let sum = 0\r\n    const x1 = circle.x\r\n    const y1 = circle.y\r\n    const { w } = circle\r\n    const r = 0.5 * w\r\n    // x only goes from x1-r to x1+r\r\n    for (let x = x1 - r; x < x1 + r; x += dx) {\r\n        // find bounds\r\n\r\n        // find equation for circle\r\n\r\n        // (y - y1)**2 + (x-x1)**2 < r**2\r\n        const diff2 = r ** 2 - (x - x1) ** 2\r\n        let half\r\n        if (diff2 > 0) {\r\n            half = Math.sqrt(diff2)\r\n        } else {\r\n            half = 0\r\n        }\r\n        let high = y1 + half\r\n        let low = y1 - half\r\n\r\n        // for each of the constraints, figure out if it is an upper or lower bound,\r\n        // then adjust the bound.\r\n        // The y coefficient tells us whether this is an upper or lower bound.\r\n        // Imagine infinite +y.\r\n        // If the y coefficient is negative, then Ac < b, and Ac = b is a lower bound.\r\n        // A.x * x + A.y * y = b\r\n        // y = (b - A.x * x) / A.y\r\n        for (let i = 0; i < lineSet.length; i++) {\r\n            const line = lineSet[i]\r\n            const ay = line.A.y\r\n            const ax = line.A.x\r\n            const { b } = line\r\n            if (ay === 0) {\r\n                if (ax * x < b) {\r\n                    // no bounds\r\n                } else {\r\n                    low = Infinity // bounded by x\r\n                }\r\n                // not handling 0,0 case\r\n            } else {\r\n                const y2 = (b - ax * x) / ay\r\n                if (ay < 0) {\r\n                    low = Math.max(low, y2)\r\n                } else {\r\n                    high = Math.min(high, y2)\r\n                }\r\n            }\r\n        }\r\n\r\n        // count area inside lines\r\n        const dy = high - low\r\n        if (dy > 0) {\r\n            const area = dy * dx\r\n            sum += area\r\n        }\r\n    }\r\n    return sum\r\n}\r\n","/** @module */\r\n\r\nimport { range, normCDF } from '../utilities/jsHelpers.js'\r\n\r\n/**\r\n * Sum area of voter distributions to tally the votes.\r\n * @param {Object[]} canGeoms - position of each candidate {x}\r\n * @constructor\r\n */\r\nexport default function LineSummer(canGeoms) {\r\n    const self = this\r\n\r\n    const intervals = findIntervals(canGeoms)\r\n\r\n    self.sumArea = function sumArea(voterGeom) {\r\n        const n = canGeoms.length\r\n        const area = Array(n)\r\n        // return sum for each candidate\r\n        if (voterGeom.densityProfile === 'gaussian') {\r\n            for (let i = 0; i < n; i++) {\r\n                area[i] = sumGaussian(voterGeom, intervals[i])\r\n            }\r\n        } else {\r\n            for (let i = 0; i < n; i++) {\r\n                area[i] = sumBlock(voterGeom, intervals[i])\r\n            }\r\n        }\r\n        return area\r\n    }\r\n}\r\n\r\n/** Find boundary between candidates */\r\nfunction findIntervals(canGeoms) {\r\n    const n = canGeoms.length\r\n    const iSorted = range(n).sort((a, b) => canGeoms[a].x - canGeoms[b].x)\r\n    const midpoints = new Array(n - 1)\r\n    for (let i = 0; i < n - 1; i++) {\r\n        midpoints[i] = (canGeoms[iSorted[i]].x + canGeoms[iSorted[i + 1]].x) * 0.5\r\n    }\r\n    const intervals = new Array(n)\r\n    for (let i = 0; i < n; i++) {\r\n        const lower = (i === 0) ? -Infinity : midpoints[i - 1]\r\n        const upper = (i === n - 1) ? Infinity : midpoints[i]\r\n        intervals[iSorted[i]] = { lower, upper }\r\n    }\r\n\r\n    return intervals\r\n}\r\n\r\nexport function sumBlock(block, interval) {\r\n    const { lower, upper } = interval\r\n    const { x, w } = block\r\n    const r = 0.5 * w\r\n    const lower2 = x - r\r\n    const upper2 = x + r\r\n    const lower3 = Math.max(lower, lower2)\r\n    const upper3 = Math.min(upper, upper2)\r\n    const sum = Math.max(0, upper3 - lower3)\r\n    return sum\r\n}\r\n\r\nexport function sumGaussian(block, interval) {\r\n    const { lower, upper } = interval\r\n    const { x, w } = block\r\n    const center = x\r\n    const sigma = w / Math.sqrt(2 * Math.PI) // w = sigma * sqrt(2*pi)\r\n    // evaluate integral of gaussian on interval\r\n    const sum = w * normCDF(upper, center, sigma) - w * normCDF(lower, center, sigma)\r\n\r\n    return sum\r\n}\r\n","/** @module */\r\n\r\nimport { minMax } from '../utilities/jsHelpers.js'\r\n\r\n/**\r\n * Vote for the closest candidate.\r\n * @param {Objects[]} canGeoms - For 2D, an array of objects: {x,y}.\r\n * For 1D, an array of objects: {x}.\r\n * @param {*} voter\r\n * @param {*} dimensions\r\n */\r\nexport default function castScoreTestVote(canGeoms, voterGeom, dimensions) {\r\n    const lc = canGeoms.length\r\n    const tally = (new Array(lc)).fill(0)\r\n    const df = (dimensions === 1) ? df1 : df2\r\n\r\n    // in the current implementation, all candidates are frontrunners\r\n    const dist = canGeoms.map((c) => df(c, voterGeom))\r\n    const [min, max] = minMax(dist)\r\n    const maxscore = 1\r\n    const minscore = 0\r\n    for (let i = 0; i < lc; i++) {\r\n        const d = dist[i]\r\n        if (d <= min) {\r\n            tally[i] = maxscore\r\n        } else if (d >= max) {\r\n            // in the case that the voter likes the frontrunner candidates equally,\r\n            // he just votes for everyone better\r\n            tally[i] = minscore\r\n        } else { // putting this last avoids max==min giving division by 0\r\n            const frac = (d - min) / (max - min)\r\n            // tally[i] = Math.floor(0.5 + minscore + (maxscore - minscore) * (1 - frac))\r\n            tally[i] = minscore + (maxscore - minscore) * (1 - frac)\r\n        }\r\n    }\r\n    const vote = { tallyFractions: tally }\r\n    return vote\r\n}\r\nfunction df1(a, b) {\r\n    return Math.abs(a.x - b.x)\r\n}\r\nfunction df2(a, b) {\r\n    return Math.sqrt((a.x - b.x) ** 2 + (a.y - b.y) ** 2)\r\n}\r\n","/** @module */\r\n\r\nimport { normPDF, range } from '../utilities/jsHelpers.js'\r\nimport castScoreTestVote from './castScoreTestVote.js'\r\n\r\n/**\r\n * Sum area of voter distributions to tally the votes.\r\n * @param {Object[]} canGeoms\r\n * @constructor\r\n */\r\nexport default function CastScoreSummer2DGrid(canGeoms, optionCast) {\r\n    const self = this\r\n\r\n    self.sumArea = function sumArea(voterGeom) {\r\n        // just find the vote at each grid point and weight according to type\r\n        const grid = makeGrid(voterGeom, optionCast)\r\n\r\n        const n = canGeoms.length\r\n        const area = Array(n).fill(0)\r\n        let totalArea = 0\r\n\r\n        // find vote\r\n        const gridLength = grid.x.length\r\n        const voteSet = Array(gridLength)\r\n        for (let i = 0; i < gridLength; i++) {\r\n            const weight = grid.weight[i]\r\n            // if (weight === 0) continue\r\n            const xi = grid.x[i]\r\n            const yi = grid.y[i]\r\n            const testVoter = { x: xi, y: yi }\r\n            const vote = castScoreTestVote(canGeoms, testVoter, 2)\r\n            voteSet[i] = vote\r\n            const { tallyFractions } = vote\r\n            totalArea += weight\r\n            for (let k = 0; k < n; k++) {\r\n                area[k] += tallyFractions[k] * weight\r\n            }\r\n        }\r\n        return {\r\n            grid, voteSet, area, totalArea,\r\n        }\r\n    }\r\n}\r\n\r\nfunction makeGrid(voterGeom, optionCast) {\r\n    const isGauss = voterGeom.densityProfile === 'gaussian'\r\n    const spread = (isGauss) ? 3 : 1\r\n    const { x, y, w } = voterGeom\r\n\r\n    const width = w * spread\r\n    const { usr } = optionCast // undersampling ratio\r\n    const iWidth = Math.round(width / usr)\r\n\r\n    // TODO: sample from middle of square\r\n    const ixGrid = range(iWidth)\r\n    const iyGrid = range(iWidth)\r\n    const gridXMargin = ixGrid.map((i) => (i + 0.5) * usr - width * 0.5 + x)\r\n    const gridYMargin = iyGrid.map((i) => (i + 0.5) * usr - width * 0.5 + y)\r\n\r\n    const nx = ixGrid.length\r\n    const ny = iyGrid.length\r\n    const gridLength = nx * ny\r\n    const gridX = Array(gridLength)\r\n    const gridY = Array(gridLength)\r\n    const weight = Array(gridLength)\r\n    let i = 0\r\n    for (let iy = 0; iy < iyGrid.length; iy++) {\r\n        for (let ix = 0; ix < ixGrid.length; ix++) {\r\n            const gx = gridXMargin[ix]\r\n            const gy = gridYMargin[iy]\r\n            gridX[i] = gx\r\n            gridY[i] = gy\r\n            weight[i] = findWeight(voterGeom, gx, gy)\r\n            i += 1\r\n        }\r\n    }\r\n\r\n    const grid = {\r\n        x: gridX, y: gridY, weight, nx, ny,\r\n    }\r\n    return grid\r\n}\r\n\r\nfunction findWeight(voterGeom, gx, gy) {\r\n    // need to cut away circle\r\n\r\n    const isGauss = voterGeom.densityProfile === 'gaussian'\r\n\r\n    const { x, y, w } = voterGeom\r\n    if (!isGauss) {\r\n        const d2 = (gx - x) ** 2 + (gy - y) ** 2\r\n        const r2 = (0.5 * w) ** 2\r\n        // TODO: for edges, determine how much of the area of the pixel is within the shape.\r\n        if (d2 < r2) {\r\n            return 1\r\n        }\r\n        return 0\r\n\r\n        // const weight = (d2 < r2) ? 1 : 0\r\n        // return weight\r\n    }\r\n    // w = sigma * sqrt(2*pi)\r\n    const sigma = w / Math.sqrt(2 * Math.PI)\r\n    // TODO: is this pdf multiplication correct? Does sigma need to be modified?\r\n    const weight = w * normPDF(gx, x, sigma) * normPDF(gy, y, sigma)\r\n    return weight\r\n}\r\n","/** @module */\r\n\r\nimport { range, normPDF } from '../utilities/jsHelpers.js'\r\nimport castScoreTestVote from './castScoreTestVote.js'\r\n\r\n/**\r\n * Sum area of voter distributions to tally the votes.\r\n * @param {Object[]} canGeoms - position of each candidate {x}\r\n * @constructor\r\n */\r\nexport default function CastScoreSummer1DGrid(canGeoms) {\r\n    const self = this\r\n\r\n    self.sumArea = function sumArea(voterGeom) {\r\n        // just find the vote at each grid point and weight according to type\r\n        const grid = makeGrid(voterGeom)\r\n\r\n        const n = canGeoms.length\r\n        const area = Array(n).fill(0)\r\n        let totalArea = 0\r\n\r\n        // find vote\r\n        const gridLength = grid.x.length\r\n        const voteSet = Array(gridLength)\r\n        for (let i = 0; i < gridLength; i++) {\r\n            const xi = grid.x[i]\r\n            const testVoter = { x: xi }\r\n            const vote = castScoreTestVote(canGeoms, testVoter, 1)\r\n            voteSet[i] = vote\r\n            const { tallyFractions } = vote\r\n            const weight = findWeight(voterGeom, xi)\r\n            totalArea += weight\r\n            for (let k = 0; k < n; k++) {\r\n                area[k] += tallyFractions[k] * weight\r\n            }\r\n        }\r\n        return {\r\n            grid, voteSet, area, totalArea,\r\n        }\r\n    }\r\n}\r\n\r\nfunction makeGrid(voterGeom) {\r\n    const isGauss = voterGeom.densityProfile === 'gaussian'\r\n    const spread = (isGauss) ? 3 : 1\r\n    const { x, w } = voterGeom\r\n    const iWidth = Math.round(w * spread)\r\n    const iGrid = range(iWidth)\r\n    const gridX = iGrid.map((i) => i + 0.5 - iWidth * 0.5 + x)\r\n    const grid = { x: gridX }\r\n    return grid\r\n}\r\n\r\nfunction findWeight(voterGeom, xi) {\r\n    const isGauss = voterGeom.densityProfile === 'gaussian'\r\n    if (!isGauss) {\r\n        return 1\r\n    }\r\n    const { x, w } = voterGeom\r\n    const sigma = w / Math.sqrt(2 * Math.PI) // w = sigma * sqrt(2*pi)\r\n    const weight = w * normPDF(xi, x, sigma)\r\n    return weight\r\n}\r\n","/** @module */\r\n/**\r\n * Beware, points are references to old points, so make sure to make a copy afterward.\r\n * @param {Number[][]} points\r\n * @param {Number[]} plane\r\n * @returns {{positive:Number[][], negative:Number[][]}} - Object containing properties\r\n * positive and negative, each being a set of points\r\n */\r\nexport default function splitConvex(points, plane) {\r\n    // put all points on either the positive or negative side of the plane.\r\n    // When we cross to the other side, we create a point in the middle and add it to both.\r\n    const n = points.length\r\n    const pos = []\r\n    const neg = []\r\n    let iPos = 0\r\n    let iNeg = 0\r\n\r\n    let a = points[n - 1]\r\n    let aNeg = calcNeg(plane, a)\r\n    for (let i = 0; i < n; i++) {\r\n        const b = points[i]\r\n        const bNeg = calcNeg(plane, b)\r\n        if ((aNeg && !bNeg) || (!aNeg && bNeg)) {\r\n            const da = calcDist(plane, a)\r\n            const db = calcDist(plane, b)\r\n            const m = lerp(a, b, da, db)\r\n            pos[iPos] = m\r\n            neg[iNeg] = m\r\n            iPos += 1\r\n            iNeg += 1\r\n        }\r\n        if (bNeg) {\r\n            neg[iNeg] = b\r\n            iNeg += 1\r\n        } else {\r\n            pos[iPos] = b\r\n            iPos += 1\r\n        }\r\n        a = b\r\n        aNeg = bNeg\r\n    }\r\n\r\n    return { positive: pos, negative: neg }\r\n}\r\n\r\nfunction calcDist(plane, point) {\r\n    // https://en.wikipedia.org/wiki/Distance_from_a_point_to_a_line\r\n    const numerator = plane[0] * point[0] + plane[1] * point[1] + plane[2]\r\n    const denominator = Math.sqrt(plane[0] ** 2 + plane[1] ** 2)\r\n    return numerator / denominator\r\n}\r\n\r\nfunction calcNeg(plane, point) {\r\n    const numerator = plane[0] * point[0] + plane[1] * point[1] + plane[2]\r\n    return numerator < 0\r\n}\r\n\r\nfunction lerp(a, b, da, db) {\r\n    const d = da - db\r\n    let f = -db / d\r\n    if (f < 0) f = 0\r\n    if (f > 1) f = 1\r\n    const n = [\r\n        f * a[0] + (1 - f) * b[0],\r\n        f * a[1] + (1 - f) * b[1],\r\n    ]\r\n    return n\r\n}\r\n","/** @module */\r\n\r\nimport { copyArrayShallow } from '../utilities/jsHelpers.js'\r\nimport { equidistantLine } from './CastPluralitySummer2DQuadrature.js'\r\nimport splitConvex from './splitConvex.js'\r\n\r\n/**\r\n * Make polygons for each group of voters that gives a unique ranking.\r\n * Divide a starting polygon into smaller polygons.\r\n * Use a dividing line for each pair of candidates.\r\n * @param {VoterGroup} voterGeom\r\n * @param {CandidateSimList} canGeoms\r\n * @constructor\r\n */\r\nexport default function castRankingFindPolygons(voterGeom, canGeoms) {\r\n    /* Start with polygons for each voterGeom\r\n    * At each division, increment the borda score for the closer candidate.\r\n    * The resulting borda score is nearly the opposite of the ranking. n-i-1.\r\n    */\r\n    // Just keep dividing up the polygons for each pair.\r\n    // Keep track of the indexes of who won, too.\r\n\r\n    // start with polygons for voterGeom\r\n    const voterPoly = makeCircle(voterGeom)\r\n    let cells = [voterPoly]\r\n\r\n    const n = canGeoms.length\r\n    let bordaScore = [Array(n).fill(0)]\r\n\r\n    for (let i = 0; i < n - 1; i++) {\r\n        for (let k = i + 1; k < n; k++) {\r\n            const cn = cells.length\r\n            // split cells with voronoi, guess how many cells\r\n            const newCells = Array(cn * 2)\r\n            const newBordaScore = Array(cn * 2)\r\n\r\n            let o = 0\r\n            for (let m = 0; m < cn; m++) {\r\n                const subject = cells[m]\r\n\r\n                const plane = eqPlane(canGeoms[i], canGeoms[k])\r\n\r\n                const newC = splitConvex(subject, plane)\r\n\r\n                // sometimes near-zero-area polygons are formed that need to be removed\r\n                // because they also have rankings that don't make sense.\r\n                const pos = newC.positive\r\n                if (pos !== undefined && pos.length > 2) {\r\n                    newCells[o] = pos\r\n\r\n                    newBordaScore[o] = copyArrayShallow(bordaScore[m])\r\n                    newBordaScore[o][k] += 1\r\n\r\n                    o += 1\r\n                }\r\n                const neg = newC.negative\r\n                if (neg !== undefined && neg.length > 2) {\r\n                    newCells[o] = neg\r\n\r\n                    newBordaScore[o] = copyArrayShallow(bordaScore[m])\r\n                    newBordaScore[o][i] += 1\r\n\r\n                    o += 1\r\n                }\r\n            }\r\n            newCells.splice(o)\r\n            newBordaScore.splice(o)\r\n            cells = newCells\r\n            bordaScore = newBordaScore\r\n        }\r\n    }\r\n    const cn = cells.length\r\n    const ranking = Array(cn)\r\n    const cansRanked = Array(cn)\r\n    for (let i = 0; i < cn; i++) {\r\n        ranking[i] = Array(n)\r\n        cansRanked[i] = Array(n)\r\n        for (let k = 0; k < n; k++) {\r\n            cansRanked[i][k] = []\r\n        }\r\n        for (let k = 0; k < n; k++) {\r\n            const rik = n - bordaScore[i][k]\r\n            ranking[i][k] = rik\r\n            cansRanked[i][rik - 1].push(k)\r\n        }\r\n    }\r\n    return { cells, ranking, cansRanked }\r\n}\r\n\r\n/**\r\n * Make an approximate circle.\r\n * @param {Object} voterGeom\r\n */\r\nfunction makeCircle(voterGeom) {\r\n    const r = voterGeom.w / 2\r\n    const { x } = voterGeom\r\n    const { y } = voterGeom\r\n    const n = 100\r\n    const circle = Array(n)\r\n    for (let i = 0; i < n; i++) {\r\n        const frac = i / (n - 1)\r\n        const angle = 2 * Math.PI * frac\r\n        const px = x + r * Math.cos(angle)\r\n        const py = y + r * Math.sin(angle)\r\n        circle[i] = [px, py]\r\n    }\r\n    return circle\r\n}\r\n\r\nfunction eqPlane(c1, c2) {\r\n    const { A, b } = equidistantLine(c1, c2)\r\n    return [A.x, A.y, -b]\r\n}\r\n","/** @module */\r\n\r\nimport { polygonArea } from '../lib/snowpack/build/snowpack/pkg/d3-polygon.js'\r\nimport castRankingFindPolygons from './castRankingFindPolygons.js'\r\n\r\n/**\r\n * Sum area of voter distributions to tally the votes.\r\n * @param {Object[]} canGeoms\r\n * @constructor\r\n */\r\nexport default function CastRankingSummer2DPolygons(canGeoms) {\r\n    const self = this\r\n\r\n    self.sumArea = function sumArea(voterGeom, weight) {\r\n        // draw lines across shape of voterGeom\r\n\r\n        let { cells, ranking, cansRanked } = castRankingFindPolygons(voterGeom, canGeoms)\r\n\r\n        // find area of polygons\r\n\r\n        const cn = cells.length\r\n        let area = Array(cn)\r\n        let totalArea = 0\r\n        for (let i = 0; i < cn; i++) {\r\n            // return area for each ranking\r\n            const theArea = -polygonArea(cells[i]) * weight\r\n            area[i] = theArea\r\n            totalArea += theArea\r\n        }\r\n        // sometimes near-zero-area polygons are formed that need to be removed\r\n        // because they also have rankings that don't make sense.\r\n        const tol = 0.000001\r\n        ranking = ranking.filter((_, i) => Math.abs(area[i]) > tol)\r\n        cansRanked = cansRanked.filter((_, i) => Math.abs(area[i]) > tol)\r\n        cells = cells.filter((_, i) => Math.abs(area[i]) > tol)\r\n        area = area.filter((a) => Math.abs(a) > tol)\r\n        return {\r\n            ranking, cansRanked, area, totalArea, cellDatum: { cells, ranking },\r\n        }\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport { copyArrayShallow, range } from '../utilities/jsHelpers.js'\r\n\r\n/**\r\n * Find the intervals over which voters share a ranking.\r\n * @param {CandidateSimList} canGeoms\r\n * @constructor\r\n */\r\nexport default function castRankingFindIntervals(canGeoms) {\r\n    /*\r\n    * Find and sort midpoints for each pair of voters.\r\n    * Find intervals in which voters have a ranking.\r\n    * Include -Inf and Inf as interval bounds.\r\n    * At each division, increment the borda score for the closer candidate.\r\n    * The resulting borda score is nearly the opposite of the ranking. n-i-1.\r\n    */\r\n\r\n    // compute the midpoints\r\n\r\n    const n = canGeoms.length\r\n    const iSorted = range(n).sort((a, b) => canGeoms[a].x - canGeoms[b].x)\r\n\r\n    const mn = 0.5 * n * (n - 1)\r\n    const uMidpoints = Array(mn)\r\n    const uMidpointPair = Array(mn)\r\n    let o = 0\r\n    for (let i = 0; i < n - 1; i++) {\r\n        for (let k = i + 1; k < n; k++) {\r\n            const ci = iSorted[i]\r\n            const ck = iSorted[k]\r\n            const midpoint = findMidpoint(canGeoms[ci], canGeoms[ck])\r\n            uMidpoints[o] = midpoint\r\n            uMidpointPair[o] = [ci, ck]\r\n            o += 1\r\n        }\r\n    }\r\n\r\n    // sort the midpoints\r\n    const mSorted = range(mn).sort((a, b) => uMidpoints[a] - uMidpoints[b])\r\n    const midpoints = mSorted.map((i) => uMidpoints[i])\r\n    const midpointPair = mSorted.map((i) => uMidpointPair[i])\r\n\r\n    // compute ranking at lower side\r\n    const ranking = Array(n)\r\n    for (let i = 0; i < n; i++) {\r\n        ranking[iSorted[i]] = i + 1\r\n    }\r\n\r\n    // compute all rankings\r\n\r\n    const rankings = Array(mn + 1)\r\n    rankings[0] = copyArrayShallow(ranking)\r\n    for (let i = 0; i < mn; i++) {\r\n        const [ci, ck] = midpointPair[i]\r\n        ranking[ci] += 1\r\n        ranking[ck] -= 1\r\n        rankings[i + 1] = copyArrayShallow(ranking)\r\n    }\r\n\r\n    const cansRanked = Array(mn + 1)\r\n    for (let i = 0; i < mn + 1; i++) {\r\n        cansRanked[i] = Array(n)\r\n        for (let k = 0; k < n; k++) {\r\n            cansRanked[i][k] = []\r\n        }\r\n        const ri = rankings[i]\r\n        for (let k = 0; k < n; k++) {\r\n            const rik = ri[k]\r\n            cansRanked[i][rik - 1].push(k)\r\n        }\r\n    }\r\n\r\n    // Add endpoints\r\n    const intervalBorders = copyArrayShallow(midpoints)\r\n    intervalBorders.unshift(-Infinity)\r\n    intervalBorders.push(Infinity)\r\n    return { intervalBorders, ranking: rankings, cansRanked }\r\n}\r\n\r\nfunction findMidpoint(can1, can2) {\r\n    return (can1.x + can2.x) * 0.5\r\n}\r\n","/** @module */\r\n\r\nimport { sumBlock, sumGaussian } from './CastPluralitySummer1DIntervals.js'\r\nimport castRankingFindIntervals from './castRankingFindIntervals.js'\r\n/**\r\n * Sum density of voter distributions within intervals to tally the votes.\r\n * @param {Object[]} canGeoms\r\n * @constructor\r\n */\r\nexport default function CastRankingSummer1DIntervals(canGeoms) {\r\n    const self = this\r\n\r\n    const { intervalBorders, ranking, cansRanked } = castRankingFindIntervals(canGeoms)\r\n\r\n    self.sumArea = function sumArea(voterGeom, weight) {\r\n        // find area inside each interval\r\n\r\n        const ni = intervalBorders.length - 1\r\n        const area = Array(ni)\r\n        let totalArea = 0\r\n        for (let i = 0; i < ni; i++) {\r\n            // return area for each ranking\r\n            const lower = intervalBorders[i]\r\n            const upper = intervalBorders[i + 1]\r\n            const theArea = sumInterval(lower, upper, voterGeom) * weight\r\n            area[i] = theArea\r\n            totalArea += theArea\r\n        }\r\n        return {\r\n            ranking, cansRanked, area, totalArea, cellDatum: { ranking, intervalBorders },\r\n        }\r\n    }\r\n}\r\n\r\nfunction sumInterval(lower, upper, voterGeom) {\r\n    if (voterGeom.densityProfile === 'gaussian') {\r\n        return sumGaussian(voterGeom, { lower, upper })\r\n    }\r\n    return sumBlock(voterGeom, { lower, upper })\r\n}\r\n","/** @module */\r\nimport { minIndex } from '../utilities/jsHelpers.js'\r\n\r\n/**\r\n * Vote for the closest candidate.\r\n * @param {Objects[]} canGeoms - For 2D, an array of objects: {x,y}.\r\n * For 1D, an array of objects: {x}.\r\n * @param {*} voterGeom\r\n * @param {*} dimensions\r\n */\r\nexport default function castPluralityTestVote(canGeoms, voterGeom, dimensions) {\r\n    const df = (dimensions === 1) ? df1 : df2\r\n    const dist2 = canGeoms.map((c) => df(c, voterGeom))\r\n    const i = minIndex(dist2)\r\n    const n = canGeoms.length\r\n    const tally = (new Array(n)).fill(0)\r\n    tally[i] = 1\r\n    const vote = { tallyFractions: tally }\r\n    return vote\r\n}\r\nfunction df1(a, b) {\r\n    return (a.x - b.x) ** 2\r\n}\r\nfunction df2(a, b) {\r\n    return (a.x - b.x) ** 2 + (a.y - b.y) ** 2\r\n}\r\n","/** @module */\r\nimport { range } from '../utilities/jsHelpers.js'\r\n\r\n/**\r\n * Vote for the closest candidate.\r\n * @param {Objects[]} canGeoms - For 2D, an array of objects: {x,y}.\r\n * For 1D, an array of objects: {x}.\r\n * @param {Object} voterGeom - has properties x and y or just x.\r\n * @param {Number} dimensions\r\n * @returns {Number[]} Rank of each candidate\r\n */\r\nexport default function castRankingTestVote(canGeoms, voterGeom, dimensions) {\r\n    const df = (dimensions === 1) ? df1 : df2\r\n    const dist2 = canGeoms.map((c) => df(c, voterGeom))\r\n    const n = canGeoms.length\r\n    const indexInOrder = range(n).sort((a, b) => dist2[a] - dist2[b])\r\n    // Note that ties are not handled.\r\n\r\n    const ranking = (new Array(n)).fill(0)\r\n    const bordaScores = (new Array(n)).fill(0)\r\n    for (let i = 0; i < n; i++) {\r\n        ranking[indexInOrder[i]] = i + 1\r\n        bordaScores[indexInOrder[i]] = n - i - 1\r\n    }\r\n    // Does i beat k? 1 if yes, -1 if opposite, 0 if tie\r\n    const pairwise = new Array(n)\r\n    for (let i = 0; i < n; i++) {\r\n        pairwise[i] = (new Array(n)).fill(0)\r\n        for (let k = 0; k < n; k++) {\r\n            if (ranking[i] === ranking[k]) continue\r\n            pairwise[i][k] = (ranking[i] < ranking[k]) ? 1 : -1\r\n        }\r\n    }\r\n\r\n    return {\r\n        indexInOrder, ranking, bordaScores, pairwise, tallyFractions: bordaScores,\r\n    }\r\n}\r\nfunction df1(a, b) {\r\n    return (a.x - b.x) ** 2\r\n}\r\nfunction df2(a, b) {\r\n    return (a.x - b.x) ** 2 + (a.y - b.y) ** 2\r\n}\r\n","/** @module */\r\n\r\nimport { sumBlock, sumGaussian } from './CastPluralitySummer1DIntervals.js'\r\n/**\r\n * Sum density of voter distributions along splits.\r\n * @param {Object[]} canGeoms\r\n * @constructor\r\n */\r\nexport default function CastPairwiseSummer1DIntervals(canGeoms) {\r\n    const self = this\r\n\r\n    // compute the midpoints\r\n    // identify which candidate is smaller in x value\r\n\r\n    const n = canGeoms.length\r\n\r\n    const midpoints = Array(n - 1)\r\n    const iSmaller = Array(n - 1)\r\n    for (let i = 0; i < n - 1; i++) {\r\n        midpoints[i] = Array(n - i - 1)\r\n        iSmaller[i] = Array(n - i - 1)\r\n        for (let k = i + 1; k < n; k++) {\r\n            const ix = canGeoms[i].x\r\n            const kx = canGeoms[k].x\r\n            const midpoint = 0.5 * (ix + kx)\r\n            midpoints[i][k] = midpoint\r\n            iSmaller[i][k] = (ix < kx)\r\n        }\r\n    }\r\n\r\n    self.sumArea = function sumArea(voterGeom, weight) {\r\n        // divide voterGeom\r\n\r\n        const totalArea = calcVoterTotalArea(voterGeom, weight)\r\n\r\n        const area = Array(n).fill(0)\r\n        for (let i = 0; i < n; i++) {\r\n            area[i] = Array(n).fill(0)\r\n        }\r\n\r\n        for (let i = 0; i < n - 1; i++) {\r\n            for (let k = i + 1; k < n; k++) {\r\n            // find split plane\r\n                const lower = -Infinity\r\n                const upper = midpoints[i][k]\r\n                const smallerArea = sumInterval(lower, upper, voterGeom) * weight\r\n                const iArea = (iSmaller[i][k]) ? smallerArea : totalArea - smallerArea\r\n                const kArea = totalArea - iArea\r\n\r\n                area[i][k] = iArea\r\n                area[k][i] = kArea\r\n            }\r\n        }\r\n        return { area, totalArea }\r\n    }\r\n}\r\n\r\nfunction calcVoterTotalArea(voterGeom, weight) {\r\n    const lower = -Infinity\r\n    const upper = Infinity\r\n    return sumInterval(lower, upper, voterGeom) * weight\r\n}\r\n\r\nfunction sumInterval(lower, upper, voterGeom) {\r\n    if (voterGeom.densityProfile === 'gaussian') {\r\n        return sumGaussian(voterGeom, { lower, upper })\r\n    }\r\n    return sumBlock(voterGeom, { lower, upper })\r\n}\r\n","/** @module */\r\n\r\nimport { equidistantLine } from './CastPluralitySummer2DQuadrature.js'\r\n/**\r\n * Sum area of voter distributions to tally the votes.\r\n * @param {Object[]} canGeoms\r\n * @constructor\r\n */\r\nexport default function CastPairwiseSummer2DPolygons(canGeoms) {\r\n    const self = this\r\n\r\n    self.sumArea = function sumArea(voterGeom, weight) {\r\n        // draw lines across shape of voterGeom\r\n\r\n        const totalArea = calcVoterTotalArea(voterGeom, weight)\r\n\r\n        const n = canGeoms.length\r\n\r\n        const area = Array(n).fill(0)\r\n        for (let i = 0; i < n; i++) {\r\n            area[i] = Array(n).fill(0)\r\n        }\r\n\r\n        for (let i = 0; i < n - 1; i++) {\r\n            for (let k = i + 1; k < n; k++) {\r\n            // find split plane\r\n\r\n                const plane = eqPlane(canGeoms[i], canGeoms[k])\r\n\r\n                const dist = calcDist(plane, voterGeom)\r\n\r\n                // find area for i and k\r\n                const iArea = calcArea(dist, voterGeom, weight, totalArea)\r\n                const kArea = totalArea - iArea\r\n\r\n                area[i][k] = iArea\r\n                area[k][i] = kArea\r\n            }\r\n        }\r\n        return { area, totalArea }\r\n    }\r\n}\r\nfunction eqPlane(c1, c2) {\r\n    const { A, b } = equidistantLine(c1, c2)\r\n    return [A.x, A.y, -b]\r\n}\r\nfunction calcDist(plane, voterGeom) {\r\n    // https://en.wikipedia.org/wiki/Distance_from_a_point_to_a_line\r\n    const numerator = plane[0] * voterGeom.x + plane[1] * voterGeom.y + plane[2]\r\n    const denominator = Math.sqrt(plane[0] ** 2 + plane[1] ** 2)\r\n    return numerator / denominator\r\n}\r\nfunction calcArea(dist, voterGeom, weight, totalArea) {\r\n    // find the area of the cap of circle,\r\n    // where the area starts at a chord at a distance from the center.\r\n\r\n    // https://en.wikipedia.org/wiki/Circular_segment\r\n    const r = voterGeom.w / 2\r\n    if (dist > r) return 0\r\n    if (dist < -r) return totalArea\r\n\r\n    // const area = r ** 2 * Math.acos(dist / r) - dist * Math.sqrt(r ** 2 - dist ** 2)\r\n    const d = dist / r\r\n    const normArea = Math.acos(d) - d * Math.sqrt(1 - d ** 2)\r\n    // https://www.desmos.com/calculator\r\n    // y=\\arccos(d)-d\\sqrt{1-d^{2}}\r\n    const area = r ** 2 * normArea\r\n\r\n    const weightedArea = area * weight\r\n    return weightedArea\r\n}\r\nfunction calcVoterTotalArea(voterGeom, weight) {\r\n    return weight * Math.PI * (voterGeom.w / 2) ** 2\r\n}\r\n","/** @module */\r\n\r\nimport castPlurality from './castPlurality.js'\r\nimport castScore from './castScore.js'\r\nimport castRanking from './castRanking.js'\r\nimport castPluralityTestVote from './castPluralityTestVote.js'\r\nimport castScoreTestVote from './castScoreTestVote.js'\r\nimport castRankingTestVote from './castRankingTestVote.js'\r\nimport castPairwise from './castPairwise.js'\r\n\r\n/**\r\n * a collection of ways to cast votes\r\n */\r\n\r\nconst voteCasters = {\r\n    plurality: { cast: castPlurality, castTestVote: castPluralityTestVote },\r\n    score: { cast: castScore, castTestVote: castScoreTestVote },\r\n    ranking: { cast: castRanking, castTestVote: castRankingTestVote },\r\n    pairwise: { cast: castPairwise, castTestVote: castRankingTestVote },\r\n}\r\n\r\nexport default voteCasters\r\n","/** @module */\r\n\r\nimport CastPluralitySummer2DQuadrature from './CastPluralitySummer2DQuadrature.js'\r\nimport CastPluralitySummer1DIntervals from './CastPluralitySummer1DIntervals.js'\r\n\r\n/**\r\n * Vote for one.\r\n * Voters cast votes for candidates.\r\n * There is also a separate graphical representation in Voronoi2D.js.\r\n * @param {Objects[]} canGeoms - For 2D, an array of objects: {x,y}.\r\n * For 1D, an array of objects: {x}.\r\n * @param {Objects[]} voterGeoms - For 2D, an array of objects: {x,y,w}.\r\n * For 1D, an array of objects: {x,w,densityProfile}.\r\n * @returns votes, an object\r\n */\r\nexport default function castPlurality(canGeoms, voterGeoms, dimensions) {\r\n    const summer = (dimensions === 1)\r\n        ? new CastPluralitySummer1DIntervals(canGeoms)\r\n        : new CastPluralitySummer2DQuadrature(canGeoms)\r\n\r\n    // get fraction of votes for each candidate so we can summarize results\r\n    const n = canGeoms.length\r\n    let tally = (new Array(n)).fill(0)\r\n    voterGeoms.forEach((voterGeom) => {\r\n        const area = summer.sumArea(voterGeom)\r\n        const weight = ((voterGeom.weight === undefined) ? 1 : voterGeom.weight)\r\n        tally = tally.map((value, index) => value + area[index] * weight)\r\n    })\r\n    const total = tally.reduce((p, c) => p + c)\r\n    const tallyFractions = tally.map((x) => x / total)\r\n    const votes = { tallyFractions }\r\n    return votes\r\n}\r\n","/** @module */\r\n\r\nimport CastScoreSummer2DGrid from './CastScoreSummer2DGrid.js'\r\nimport CastScoreSummer1DGrid from './CastScoreSummer1DGrid.js'\r\n\r\n// The main difference between this and plurality is we need to return a grid from here.\r\n// We also will return a set of votes from that grid.\r\n\r\n/**\r\n * Vote for one.\r\n * Voters cast votes for candidates.\r\n * There is also a separate graphical representation in VoronoiGroup.js.\r\n * @param {Objects[]} canGeoms - For 2D, an array of objects: {x,y}.\r\n * For 1D, an array of objects: {x}.\r\n * @param {Objects[]} voterGeoms - For 2D, an array of objects: {x,y,w}.\r\n * For 1D, an array of objects: {x,w,densityProfile}.\r\n * @returns votes, an object\r\n */\r\nexport default function castScore(canGeoms, voterGeoms, dimensions, optionCast) {\r\n    const summer = (dimensions === 1)\r\n        ? new CastScoreSummer1DGrid(canGeoms)\r\n        : new CastScoreSummer2DGrid(canGeoms, optionCast)\r\n\r\n    // get fraction of votes for each candidate so we can summarize results\r\n    const n = canGeoms.length\r\n    let tally = (new Array(n)).fill(0)\r\n    let total = 0\r\n    const gridData = []\r\n    for (let i = 0; i < voterGeoms.length; i++) {\r\n        const voterGeom = voterGeoms[i]\r\n        const {\r\n            grid, voteSet, area, totalArea,\r\n        } = summer.sumArea(voterGeom)\r\n\r\n        const gridDataEntry = { grid, voteSet, voterGeom }\r\n        gridData.push(gridDataEntry)\r\n\r\n        const weight = ((voterGeom.weight === undefined) ? 1 : voterGeom.weight)\r\n        tally = tally.map((value, index) => value + area[index] * weight)\r\n        total += totalArea\r\n    }\r\n    const tallyFractions = tally.map((x) => x / total)\r\n    const votes = {\r\n        tallyFractions, gridData,\r\n    }\r\n    return votes\r\n}\r\n","/** @module */\r\n\r\nimport CastRankingSummer2DPolygons from './CastRankingSummer2DPolygons.js'\r\nimport CastRankingSummer1DIntervals from './CastRankingSummer1DIntervals.js'\r\n\r\n/**\r\n * Vote for one.\r\n * Voters cast votes for candidates.\r\n * There is also a separate graphical representation in VoronoiRanking2D.js.\r\n * @param {Objects[]} canGeoms - For 2D, an array of objects: {x,y}.\r\n * For 1D, an array of objects: {x}.\r\n * @param {Objects[]} voterGeoms - For 2D, an array of objects: {x,y,w}.\r\n * For 1D, an array of objects: {x,w,densityProfile}.\r\n * @returns votes, an object\r\n */\r\nexport default function castRanking(canGeoms, voterGeoms, dimensions) {\r\n    const summer = (dimensions === 1)\r\n        ? new CastRankingSummer1DIntervals(canGeoms)\r\n        : new CastRankingSummer2DPolygons(canGeoms)\r\n\r\n    const n = canGeoms.length\r\n\r\n    // get fraction of votes for each candidate so we can summarize results\r\n    let areaAll = []\r\n    let rankingAll = []\r\n    let cansRankedAll = []\r\n    const firstPreferences = Array(n).fill(0)\r\n    let totalAreaAll = 0\r\n    const cellData = []\r\n\r\n    // should ideally make a set of polygons for each ranking so that we avoid repeating rankings.\r\n    voterGeoms.forEach((voterGeom) => {\r\n        const weight = ((voterGeom.weight === undefined) ? 1 : voterGeom.weight)\r\n\r\n        const {\r\n            ranking, cansRanked, area, totalArea, cellDatum,\r\n        } = summer.sumArea(voterGeom, weight)\r\n\r\n        areaAll = areaAll.concat(area)\r\n        rankingAll = rankingAll.concat(ranking)\r\n        cansRankedAll = cansRankedAll.concat(cansRanked)\r\n        totalAreaAll += totalArea\r\n        cellData.push(cellDatum)\r\n\r\n        for (let i = 0; i < cansRanked.length; i++) { // tally first preferences\r\n            const cr0 = cansRanked[i][0]\r\n            for (let k = 0; k < cr0.length; k++) {\r\n                const c0 = cr0[k]\r\n                firstPreferences[c0] += area[i]\r\n            }\r\n        }\r\n    })\r\n    const rankingTallyFractions = areaAll.map((x) => x / totalAreaAll)\r\n    const tallyFractions = firstPreferences.map((x) => x / totalAreaAll)\r\n\r\n    const votes = {\r\n        ranking: rankingAll, cansRankedAll, rankingTallyFractions, tallyFractions, cellData,\r\n    }\r\n    return votes\r\n}\r\n","/** @module */\r\n\r\nimport CastPairwiseSummer1DIntervals from './CastPairwiseSummer1DIntervals.js'\r\nimport CastPairwiseSummer2DPolygons from './CastPairwiseSummer2DPolygons.js'\r\n\r\n/**\r\n * Vote for one.\r\n * Voters cast votes for candidates.\r\n * There is also a separate graphical representation in VoronoiRanking2D.js.\r\n * @param {Objects[]} canGeoms - For 2D, an array of objects: {x,y}.\r\n * For 1D, an array of objects: {x}.\r\n * @param {Objects[]} voterGeoms - For 2D, an array of objects: {x,y,w}.\r\n * For 1D, an array of objects: {x,w,densityProfile}.\r\n * @returns votes, an object\r\n */\r\nexport default function castPairwise(canGeoms, voterGeoms, dimensions) {\r\n    const summer = (dimensions === 1)\r\n        ? new CastPairwiseSummer1DIntervals(canGeoms)\r\n        : new CastPairwiseSummer2DPolygons(canGeoms)\r\n\r\n    // get fraction of votes for each candidate so we can summarize results\r\n    let totalAreaAll = 0\r\n\r\n    // should ideally make a set of polygons for each ranking so that we avoid repeating rankings.\r\n\r\n    const n = canGeoms.length\r\n    const areaAll = Array(n).fill(0)\r\n    for (let i = 0; i < n; i++) {\r\n        areaAll[i] = Array(n).fill(0)\r\n    }\r\n    voterGeoms.forEach((voterGeom) => {\r\n        const weight = ((voterGeom.weight === undefined) ? 1 : voterGeom.weight)\r\n        const { area, totalArea } = summer.sumArea(voterGeom, weight)\r\n\r\n        for (let i = 0; i < n; i++) {\r\n            for (let k = 0; k < n; k++) {\r\n                areaAll[i][k] += area[i][k]\r\n            }\r\n        }\r\n        totalAreaAll += totalArea\r\n    })\r\n    const pairwiseTallyFractions = areaAll.map((x) => x.map((a) => a / totalAreaAll))\r\n\r\n    // measure number of wins\r\n    const tallyWins = Array(n).fill(0)\r\n    for (let i = 0; i < n - 1; i++) {\r\n        for (let k = i + 1; k < n; k++) {\r\n            const ik = pairwiseTallyFractions[i][k]\r\n            const ki = pairwiseTallyFractions[k][i]\r\n            if (ik > ki) {\r\n                tallyWins[i] += 1\r\n            } else if (ik < ki) {\r\n                tallyWins[k] += 1\r\n            }\r\n            // nobody gets points for a tie\r\n        }\r\n    }\r\n    const tallyFractions = tallyWins.map((x) => x / (n - 1))\r\n    const votes = { pairwiseTallyFractions, tallyFractions }\r\n    return votes\r\n}\r\n","/** @module */\r\n\r\nimport plurality from './plurality.js'\r\nimport randomWinner from './randomWinner.js'\r\nimport huntingtonHill from './huntingtonHill.js'\r\nimport score from './score.js'\r\nimport stv from './stv.js'\r\nimport minimax from './minimax.js'\r\n\r\n/** a collection of election methods\r\n *  */\r\nconst electionMethods = {\r\n    plurality, randomWinner, huntingtonHill, score, stv, minimax,\r\n}\r\n\r\nexport default electionMethods\r\n","/** @module */\r\n\r\nimport { maxIndex } from '../utilities/jsHelpers.js'\r\n\r\n/**\r\n * the candidate with the highest tally wins\r\n * @param {Object} votes\r\n * @param {Number[]} votes.tallyFractions - A list of fractions of voters\r\n * who chose a candidate, indexed by candidate.\r\n * @returns {Object} socialChoiceResults\r\n * @returns {Number} socialChoiceResults.iWinner - Index of winner. Indexing according to votes[].\r\n */\r\nexport default function plurality(votes) {\r\n    const iWinner = maxIndex(votes.tallyFractions)\r\n\r\n    const socialChoiceResults = { iWinner }\r\n    return socialChoiceResults\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * pick a random candidate as the winner\r\n * @param {Object} votes\r\n * @param {Number} votes.tallyFractions.length - Number of candidates.\r\n * @returns {Object} socialChoiceResults\r\n * @returns {Number} socialChoiceResults.iWinner - Index of winner. Indexing according to votes[].\r\n */\r\nexport default function randomWinner(votes) {\r\n    const nk = votes.tallyFractions.length\r\n    const iWinner = Math.floor(Math.random() * nk)\r\n    const socialChoiceResults = { iWinner }\r\n    return socialChoiceResults\r\n}\r\n","/** @module */\r\n\r\nimport { copyArrayShallow, range } from '../utilities/jsHelpers.js'\r\n\r\n/**\r\n * Run the Huntington-Hill method of apportionment and return an allocation of seats.\r\n * @param {Object} votes\r\n * @param {number[]} votes.tallyFractions - tallies for each party as a fraction of 1.\r\n * @param {Object} electionMethodOptions\r\n * @param {number} electionMethodOptions.seats - The number of seats to fill.\r\n * @param {number} electionMethodOptions.threshold - The minimum fraction of voters\r\n * that a party needs to be eligible for a seat.\r\n * @returns {{allocation:number[]}} - socialChoiceResults, with property allocation.\r\n * Allocation is an array of integers that say how many representatives each party gets.\r\n */\r\n\r\nexport default function huntingtonHill(votes, electionMethodOptions) {\r\n    const { seats, threshold } = electionMethodOptions\r\n\r\n    let populations = votes.tallyFractions.map(\r\n        (p) => ((p < threshold) ? 0 : p),\r\n    )\r\n\r\n    let positivePopulations = populations.map(\r\n        (p) => ((p === 0) ? 0 : 1),\r\n    )\r\n\r\n    let nPositiveParties = positivePopulations.reduce(\r\n        (p, c) => p + c,\r\n    )\r\n\r\n    // make an adjustment\r\n    if (nPositiveParties === 0) {\r\n        populations = copyArrayShallow(votes.tallyFractions)\r\n        positivePopulations = populations.map(\r\n            (p) => ((p === 0) ? 0 : 1),\r\n        )\r\n        nPositiveParties = positivePopulations.reduce(\r\n            (p, c) => p + c,\r\n        )\r\n    }\r\n\r\n    // When there are more parties above the threshold than seats,\r\n    // we have to give each party a seat in order.\r\n    if (nPositiveParties > seats || nPositiveParties === 0) {\r\n        // sort parties by population\r\n        // sort decreasing\r\n        const populationsSorted = [...populations].sort(\r\n            (a, b) => b - a,\r\n        )\r\n        const minPopulation = populationsSorted[seats - 1]\r\n        const pops2 = votes.tallyFractions\r\n\r\n        // todo: consider ties\r\n        const allocation = pops2.map(\r\n            (p) => ((p >= minPopulation) ? 1 : 0),\r\n        )\r\n        const socialChoiceResults = { allocation }\r\n        return socialChoiceResults\r\n    }\r\n\r\n    // make a list of break points / divisors, independent of vote totals\r\n    const divisorPattern = Array(seats).fill().map(\r\n        (_, i) => Math.sqrt((i) * (i + 1)),\r\n    )\r\n\r\n    // Scale the divisor pattern for each party.\r\n    // Call them signposts, like Balinski and Young.\r\n    // Ref: Balinski and Young 1982, pages 60-66, Chapter 7, Overview of Methods.\r\n    // Really, these are the divisors for each party.\r\n    // They are also a ratio of the representatives to the population\r\n    // except that the divisorPattern is used to substitute a slightly different number\r\n    // than the number of respresentatives.\r\n    const signposts = populations.map(\r\n        (p) => (p === 0 ? Array(seats).fill(Infinity) : divisorPattern.map((d) => d / p)),\r\n    ).flat()\r\n\r\n    const doOld = false\r\n    if (doOld) {\r\n        return oldWay(seats, populations, signposts)\r\n    }\r\n    const ids = populations.map(\r\n        (p, i) => Array(seats).fill(i),\r\n    ).flat()\r\n\r\n    const order = range(ids.length).sort(\r\n        (a, b) => signposts[a] - signposts[b],\r\n    )\r\n\r\n    const allocation = Array(populations.length).fill(0)\r\n    for (let i = 0; i < seats; i++) {\r\n        const iId = order[i]\r\n        const iCan = ids[iId]\r\n        allocation[iCan] += 1\r\n    }\r\n\r\n    // Todo: consider if there is a tie.\r\n    // Right now, we give extra seats to all the tied parties if there is a tie.\r\n    const socialChoiceResults = { allocation }\r\n    return socialChoiceResults\r\n}\r\n\r\nfunction oldWay(seats, populations, signposts) {\r\n    // find last signpost to fill all seats\r\n    // sort increasing\r\n    const sortedSignposts = signposts.sort(\r\n        (a, b) => a - b,\r\n    )\r\n\r\n    const tolerance = 0.00000001 // add a little bit of tolerance for machine-accuracy\r\n    // hopefully there will not be any exact ties.\r\n    const lastSignpost = sortedSignposts[seats - 1] + tolerance\r\n\r\n    // In the jargon:\r\n    //   Divide by populations by the divisors to get the quotients.\r\n    // Or, more clearly:\r\n    //   Count how many signposts each party has passed.\r\n\r\n    // lastSignpost = d/p\r\n    // d = p * lastSignpost\r\n    // sqrt(i*(i+1)) = d\r\n    // i=0 is one seat\r\n    // n = i + 1\r\n    // sqrt(n*(n-1)) = d\r\n    // n**2 - n = d**2\r\n    // n = (-b + sqrt(b-4ac) ) / 2a\r\n    // a = 1, b = -1, c = -d**2\r\n    // n = (1 + sqrt(1+4d**2) ) / 2\r\n    const quotients = populations.map(\r\n        (p) => ((p === 0) ? 0 : (1 + Math.sqrt(1 + 4 * (p * lastSignpost) ** 2)) * 0.5),\r\n    )\r\n    const allocation = quotients.map(\r\n        (p) => Math.floor(p),\r\n    )\r\n    const socialChoiceResults = { allocation }\r\n    return socialChoiceResults\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * the candidate with the highest tally wins\r\n * @param {Object} votes\r\n * @param {Number[]} votes.tallyFractions\r\n * @returns {Object} results\r\n * @returns {Number} iWinner - Index of winner. Indexing according to votes[].\r\n */\r\nexport default function score(votes) {\r\n    const max = Math.max(...votes.tallyFractions)\r\n    const iWinner = votes.tallyFractions.indexOf(max)\r\n\r\n    const results = { iWinner }\r\n    return results\r\n}\r\n","/** @module */\r\n\r\nimport {\r\n    copyArrayShallow, maxIndex, minIndex, range,\r\n} from '../utilities/jsHelpers.js'\r\n\r\n/**\r\n * Single Transferable Vote\r\n * @param {Object} votes\r\n * @param {Number[]} votes.tallyFractions - A list of fractions of voters\r\n * who ranked a candidate first, indexed by candidate.\r\n * @param {Number[]} votes.rankingTallyFractions - A list of fractions of voters\r\n * who share the same ranking.\r\n * @param {Number[][][]} votes.cansRankedAll - A list of lists of lists.\r\n * The first index is a group of voters who share the same ranking.\r\n * The second index is the rank number.\r\n * The third index is for a list of candidates at that rank.\r\n * @param {Object} electionMethodOptions\r\n * @param {number} electionMethodOptions.seats - The number of seats to fill.\r\n * @returns {{allocation:number[]}} - A variable \"socialChoiceResults\",\r\n * with the property \"allocation\".\r\n * Allocation is an array of integers that say whether a candidate is elected (1) or not (0).\r\n */\r\nexport default function stv(votes, electionMethodOptions) {\r\n    const { tallyFractions, rankingTallyFractions, cansRankedAll } = votes\r\n    const { seats } = electionMethodOptions\r\n\r\n    const nk = tallyFractions.length\r\n    const nr = rankingTallyFractions.length\r\n\r\n    if (seats >= nk) {\r\n        // more seats than candidates, so elect all candidates\r\n        const allocation = Array(nk).fill(1)\r\n        const socialChoiceResults = { allocation }\r\n        return socialChoiceResults\r\n    }\r\n\r\n    // Candidates must have more votes than quota to be elected, as a fraction of total votes.\r\n    const quota = 1 / (seats + 1)\r\n\r\n    // start round\r\n    let resolved = false\r\n    // round (starts at 0)\r\n    let r = 0\r\n    // Count the number of candidates elected\r\n    const elected = []\r\n    // the current tally of first preferences among candidates still remaining\r\n    let tally = copyArrayShallow(tallyFractions)\r\n    // is the candidate still in the running? Alternatively, they have been eliminated.\r\n    const stillIn = Array(nk).fill(true)\r\n    let canInTally = range(nk)\r\n    // Which rank is currently being added to the tally?\r\n    const activeRank = Array(nr).fill(0)\r\n    // What is the weight of each group of voters?\r\n    const weight = Array(nr).fill(1)\r\n    // has the ballot been exhausted?\r\n    const exhausted = Array(nr).fill(false)\r\n\r\n    while (!resolved && r < nk) {\r\n        if (r !== 0) {\r\n            // tally top preferences\r\n            tally = Array(nk).fill(0)\r\n            for (let i = 0; i < cansRankedAll.length; i++) {\r\n                if (exhausted[i]) continue\r\n                const ar = activeRank[i]\r\n                const canArs = cansRankedAll[i][ar]\r\n                // candidates in the same rank each get full support\r\n                for (let k = 0; k < canArs.length; k++) {\r\n                    const canAr = canArs[k]\r\n                    tally[canAr] += rankingTallyFractions[i] * weight[i]\r\n                }\r\n            }\r\n            tally = tally.filter((_, i) => stillIn[i])\r\n            canInTally = range(nk).filter((i) => stillIn[i]) // candidate corresponding to tally\r\n        }\r\n\r\n        // either eliminate or elect\r\n        const siWinner = maxIndex(tally)\r\n        const iWinner = canInTally[siWinner]\r\n        const votesForWinner = tally[siWinner]\r\n        const elect = votesForWinner >= quota\r\n        let reweight = 1\r\n        let iEliminate\r\n        if (elect) {\r\n            // remove winning candidate\r\n            iEliminate = iWinner\r\n\r\n            // reweight and move activeRank forward\r\n            reweight = 1 - quota / votesForWinner\r\n\r\n            // is the counting done? Did we elect enough candidates?\r\n            elected.push(iWinner)\r\n            resolved = elected.length === seats\r\n        } else {\r\n            // remove losing candidate\r\n            const siLoser = minIndex(tally)\r\n            const iLoser = canInTally[siLoser]\r\n            iEliminate = iLoser\r\n        }\r\n\r\n        // eliminate a candidate and reweight if needed\r\n        stillIn[iEliminate] = false\r\n        for (let i = 0; i < cansRankedAll.length; i++) {\r\n            if (exhausted[i]) continue\r\n            const ar = activeRank[i]\r\n            const canArs = cansRankedAll[i][ar]\r\n            if (canArs.includes(iEliminate)) {\r\n                if (reweight !== 1) {\r\n                    weight[i] *= reweight // reweight if voter selected winner\r\n                }\r\n                // move activeRank forward\r\n                // while the current activeRank is not still in the running\r\n                // and while the ballot is not exhausted\r\n                let moveForward = !exhausted[i]\r\n                while (moveForward) {\r\n                    activeRank[i] += 1\r\n                    const arf = activeRank[i]\r\n\r\n                    // is ballot exhausted? then stop counting this ballot.\r\n                    if (arf === nk) {\r\n                        exhausted[i] = true\r\n                        break\r\n                    }\r\n\r\n                    const canArfs = cansRankedAll[i][arf]\r\n\r\n                    // Only move forward if none of the candidates in this rank are still in.\r\n                    for (let k = 0; k < canArfs.length; k++) {\r\n                        const can = canArfs[k]\r\n                        moveForward = moveForward && !stillIn[can]\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // increment round\r\n        r += 1\r\n    }\r\n\r\n    // sanity check\r\n    // We eliminated all the candidates, r == nk, but didn't get enough winners\r\n    if (!resolved) {\r\n        // eslint-disable-next-line no-console\r\n        console.warn('warning: STV ran over - eliminated all candidates.')\r\n    }\r\n\r\n    const allocation = Array(nk).fill(0)\r\n    for (let i = 0; i < elected.length; i++) {\r\n        const iWinner = elected[i]\r\n        allocation[iWinner] += 1\r\n    }\r\n    const socialChoiceResults = { allocation }\r\n    return socialChoiceResults\r\n}\r\n","/** @module */\r\n\r\nimport { range } from '../utilities/jsHelpers.js'\r\n\r\n/**\r\n * Disregard the weakest pairwise defeat until one candidate is unbeaten.\r\n * @param {Object} votes\r\n * @param {Number[][]} votes.pairwiseTallyFractions - A list of fractions of voters\r\n * who preferred candidate i over k, indexed by [i][k].\r\n * @returns {{iWinner:Number}} iWinner - Index of winner.\r\n * Indexing according to candidates in votes.tallyFractions.\r\n */\r\nexport default function minimax(votes) {\r\n    const { pairwiseTallyFractions } = votes\r\n    const n = pairwiseTallyFractions.length\r\n\r\n    // make a list of number of losses\r\n    const losses = Array(n).fill(0)\r\n    const np = 0.5 * n * (n - 1)\r\n    const lossDegree = Array(n)\r\n    const loser = Array(np)\r\n    let o = 0\r\n    for (let i = 0; i < n - 1; i++) {\r\n        for (let k = i + 1; k < n; k++) {\r\n            const iOverK = pairwiseTallyFractions[i][k] - pairwiseTallyFractions[k][i]\r\n            lossDegree[o] = Math.abs(iOverK)\r\n            // add a loss for each member of the pair\r\n            // ties go to i\r\n            const iLost = iOverK < 0\r\n            losses[i] += (iLost) ? 1 : 0\r\n            losses[k] += (!iLost) ? 1 : 0\r\n            loser[o] = (iLost) ? i : k\r\n            o += 1\r\n        }\r\n    }\r\n    // i lost to k by an amount\r\n\r\n    // sort the losses\r\n    const pSorted = range(np).sort((a, b) => lossDegree[a] - lossDegree[b])\r\n\r\n    // eliminate the smallest loss until one is undefeated\r\n    let iWinner = losses.findIndex((x) => x === 0)\r\n    let iNext = 0 // next pair to eliminate (sorted)\r\n    while (iWinner === -1) {\r\n        // find the index of the next loser whose loss will be eliminated.\r\n        const pLeast = pSorted[iNext]\r\n        const loserLeast = loser[pLeast]\r\n        // reduce the loss tally\r\n        losses[loserLeast] -= 1\r\n        // see if a candidate has no remaining losses.\r\n        iWinner = losses.findIndex((x) => x === 0)\r\n        iNext += 1\r\n    }\r\n\r\n    const socialChoiceResults = { iWinner }\r\n    return socialChoiceResults\r\n}\r\n","/** @module */\r\n\r\nimport electionMethods from '../electionMethods/electionMethods.js'\r\n\r\n/**\r\n * Store settings and functions that deal with the election method.\r\n * The difference between SocialChoice and Election is that\r\n * Election encompasses all concepts of an election such as casting a vote\r\n * or the number of dimensions,\r\n * while SocialChoice just considers the votes and the result of the election method.\r\n * Then SocialChoice returns a summary of how the election went.\r\n * @param {Menu} menu\r\n * @constructor\r\n */\r\nexport default function SocialChoice(menu) {\r\n    const self = this\r\n\r\n    self.seats = 1\r\n\r\n    self.run = (canList, votes) => {\r\n        // why have two different kinds of results?\r\n        // socialChoiceResults, the smaller one,\r\n        //   is in the context of the election method,\r\n        //   which has tallies go in and analysis come out\r\n        // electionResults, the larger one,\r\n        //   is in the context of candidate objects and voter objects.\r\n        if (self.checkElectionType() === 'allocation' || self.checkElectionType() === 'multiWinner') {\r\n            const electionMethodOptions = { seats: self.seats, threshold: 0.1 }\r\n            const electionMethod = electionMethods[self.electionMethod]\r\n            const socialChoiceResults = electionMethod(votes, electionMethodOptions)\r\n            const { allocation } = socialChoiceResults\r\n            const electionResults = { allocation, canList, votes }\r\n            return electionResults\r\n        }\r\n        const socialChoiceResults = electionMethods[self.electionMethod](votes)\r\n        const { iWinner } = socialChoiceResults\r\n        const winner = canList[iWinner]\r\n        const electionResults = { iWinner, winner, votes }\r\n        return electionResults\r\n    }\r\n\r\n    // -- Menu --\r\n\r\n    // a list of election methods\r\n    self.electionMethodList = [\r\n        {\r\n            name: 'Huntington Hill', value: 'huntingtonHill', type: 'allocation', casterName: 'plurality',\r\n        },\r\n        {\r\n            name: 'Plurality', value: 'plurality', type: 'singleWinner', casterName: 'plurality',\r\n        },\r\n        {\r\n            name: 'Random Winner', value: 'randomWinner', type: 'singleWinner', casterName: 'plurality',\r\n        },\r\n        {\r\n            name: 'Score', value: 'score', type: 'singleWinner', casterName: 'score',\r\n        },\r\n        {\r\n            name: 'STV', value: 'stv', type: 'multiWinner', casterName: 'ranking',\r\n        },\r\n        {\r\n            name: 'Minimax', value: 'minimax', type: 'singleWinner', casterName: 'pairwise',\r\n        },\r\n    ]\r\n\r\n    // utilities for looking up this list\r\n    self.checkElectionType = () => self.electionMethodListByFunctionName[self.electionMethod].type\r\n    self.electionMethodListByFunctionName = []\r\n    self.electionMethodList.forEach(\r\n        (x) => { self.electionMethodListByFunctionName[x.value] = x },\r\n    )\r\n\r\n    /**\r\n     * Called in onclick.\r\n     * @param {(String|Number|Boolean)} value\r\n     */\r\n    self.setElectionMethod = (value) => {\r\n        self.electionMethod = value\r\n        self.casterName = self.electionMethodListByFunctionName[value].casterName\r\n\r\n        const electionType = self.checkElectionType()\r\n        if (electionType === 'allocation') {\r\n            self.seats = 5\r\n            self.numSampleCandidates = 10\r\n        } else if (electionType === 'multiWinner') {\r\n            self.seats = 3\r\n            self.numSampleCandidates = 10\r\n        } else {\r\n            self.seats = 1\r\n            self.numSampleCandidates = 5\r\n        }\r\n    }\r\n\r\n    // add a menu item to switch between types of elections\r\n    self.setElectionMethod('plurality')\r\n\r\n    menu.addMenuItem(\r\n        self,\r\n        {\r\n            label: 'Election Method:',\r\n            prop: 'electionMethod',\r\n            setProp: self.setElectionMethod,\r\n            options: self.electionMethodList,\r\n            change: ['electionMethod'],\r\n        },\r\n    )\r\n}\r\n","/** @module */\r\n\r\nimport voteCasters from '../castVotes/voteCasters.js'\r\nimport SocialChoice from './SocialChoice.js'\r\n\r\n/**\r\n * Here we are in the context of a single election with voter objects and candidate objects.\r\n * @param {Menu} menu\r\n * @constructor\r\n */\r\nexport default function Election(menu) {\r\n    const self = this\r\n\r\n    self.socialChoice = new SocialChoice(menu)\r\n    self.dimensions = 1\r\n\r\n    self.setDimensions = (d) => { self.dimensions = d }\r\n\r\n    // Dimensions //\r\n\r\n    /** Get the correct geometry, depending on number of dimensions. */\r\n    const mapVoters = (voterShapes) => {\r\n        if (self.dimensions === 1) {\r\n            return voterShapes.map((vg) => (vg.shape1))\r\n        }\r\n        return voterShapes.map((vg) => (vg.shape2))\r\n    }\r\n\r\n    /** Get the correct geometry, depending on number of dimensions. */\r\n    const mapCans = (canList) => {\r\n        if (self.dimensions === 1) {\r\n            return canList.map((can) => (can.shape1))\r\n        }\r\n        return canList.map((can) => (can.shape2))\r\n    }\r\n\r\n    // Election //\r\n\r\n    self.runElection = function (voterShapes, canList, optionCast) {\r\n        const votes = self.castVotes(voterShapes, canList, optionCast)\r\n        const electionResults = self.socialChoice.run(canList, votes)\r\n        return electionResults\r\n    }\r\n\r\n    // Voters cast votes for candidates.\r\n    // There is also a separate graphical representation in Voronoi2D.js\r\n    self.castVotes = (voterShapes, canList, optionCast) => {\r\n        const voterGeoms = mapVoters(voterShapes)\r\n        const canGeoms = mapCans(canList)\r\n        const { cast } = voteCasters[self.socialChoice.casterName]\r\n        const votes = cast(canGeoms, voterGeoms, self.dimensions, optionCast)\r\n        return votes\r\n    }\r\n\r\n    self.testVoteE = (voterTest, candidateSimList, optionCast) => {\r\n        const voterShapes = [voterTest]\r\n        const canList = candidateSimList.getCandidates()\r\n        const voterGeom = mapVoters(voterShapes)[0]\r\n        const canGeom = mapCans(canList)\r\n        const { castTestVote } = voteCasters[self.socialChoice.casterName]\r\n        const vote = castTestVote(canGeom, voterGeom, self.dimensions, optionCast)\r\n        return vote\r\n    }\r\n}\r\n","import { drawStrokedColor, textPercent } from '../utilities/graphicsUtilities.js'\r\nimport SquareGraphic from './SquareGraphic.js'\r\n\r\nexport default function CandidateGraphic(candidate, screen) {\r\n    const self = this\r\n\r\n    const square = new SquareGraphic(candidate, candidate.wHandle, candidate.hHandle, screen)\r\n    self.square = square\r\n\r\n    self.fraction = 0\r\n    self.setFraction = function (fraction) {\r\n        self.fraction = fraction\r\n    }\r\n\r\n    self.setWins = (wins) => {\r\n        self.wins = wins\r\n    }\r\n\r\n    self.renderForeground = function () {\r\n        square.render()\r\n\r\n        const { x, y, exists } = candidate\r\n        // show minimal graphics when rendering as a ghost.\r\n        if (exists === 0) return\r\n\r\n        drawStrokedColor(textPercent(self.fraction), x, y - square.h * 0.5 - 2, 20, 2, '#222', 1, screen.fctx)\r\n\r\n        if (self.wins !== undefined) {\r\n            drawStrokedColor(self.wins, x, y + square.h * 0.5 + 20 + 2, 20, 2, '#222', 1, screen.fctx)\r\n        }\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport CandidateGraphic from '../vizEntities/CandidateGraphic.js'\r\n\r\n/**\r\n * CandidateSim has functionality for a candidate that is specific to a simulation.\r\n * CandidateSim has a candidate component.\r\n * The candidate component is a Candidate, for now.\r\n\r\n * @param {Candidate} candidate - a candidate component that CandidateSim builds upon.\r\n * @param {DraggableManager} dragm\r\n * @constructor\r\n */\r\nexport default function CandidateSim(candidate, dragm, screen) {\r\n    const self = this\r\n    self.candidate = candidate\r\n\r\n    self.graphic = new CandidateGraphic(candidate, screen)\r\n\r\n    dragm.newSquareHandle(candidate, self.graphic.square)\r\n}\r\n","/** @module */\r\n\r\n/**\r\n *\r\n * A simple list of candidateDnSim instances.\r\n * It really just passes along function calls to each member of the list.\r\n * It also checks if that member exists. Alternatively, it was deleted.\r\n * @constructor\r\n */\r\nexport default function CandidateSimList(sim) {\r\n    const self = this\r\n\r\n    const simCans = []\r\n\r\n    // Data Setters and Getters //\r\n\r\n    self.newCandidate = function (simCan) {\r\n        simCans.push(simCan)\r\n    }\r\n    self.getSimCandidates = () => simCans.filter((simCan) => simCan.candidate.exists)\r\n\r\n    self.getCandidates = () => {\r\n        const simCansEx = self.getSimCandidates()\r\n        return simCansEx.map((simCan) => simCan.candidate)\r\n    }\r\n    self.getCandidatesAll = () => simCans.map((simCan) => simCan.candidate)\r\n\r\n    // Update //\r\n\r\n    self.setCandidateFractions = (fractions) => {\r\n        const simCansExisting = self.getSimCandidates()\r\n        simCansExisting.forEach((simCan, index) => {\r\n            const fraction = fractions[index]\r\n            simCan.graphic.setFraction(fraction)\r\n        })\r\n    }\r\n    self.setCandidateWins = (winsByCandidate) => {\r\n        const simCansExisting = self.getSimCandidates()\r\n        simCansExisting.forEach((simCan, index) => {\r\n            const win = winsByCandidate[index]\r\n            simCan.graphic.setWins(win)\r\n        })\r\n    }\r\n    self.updateXY = () => {\r\n        simCans.forEach((simCan) => simCan.candidate.updateXY())\r\n    }\r\n\r\n    // Render //\r\n\r\n    self.renderForeground = () => {\r\n        if (sim.showGhosts) {\r\n            self.renderForegroundAll()\r\n        } else {\r\n            self.renderForegroundExisting()\r\n        }\r\n    }\r\n    self.renderForegroundExisting = () => {\r\n        const simCansExisting = self.getSimCandidates()\r\n        simCansExisting.forEach((simCan) => simCan.graphic.renderForeground())\r\n    }\r\n    self.renderForegroundAll = () => {\r\n        simCans.forEach((simCan) => simCan.graphic.renderForeground())\r\n    }\r\n    self.numSimCandidates = () => simCans.length\r\n}\r\n","/** @module */\r\n\r\nimport colorBlender, { rgbToString } from './colorBlender.js'\r\n\r\nexport default function geoColors(geoElectionResults, candidateSimList, sim) {\r\n    const {\r\n        resultsByTract,\r\n        resultsByDistrict,\r\n    } = geoElectionResults\r\n\r\n    const canList = candidateSimList.getCandidates()\r\n\r\n    const colorByTract = colorTracts(resultsByTract, canList)\r\n    const colorOfWinsByDistrict = colorDistrictWins(resultsByDistrict, canList, sim)\r\n    const colorOfVoteByDistrict = colorDistrictVote(resultsByDistrict, canList)\r\n\r\n    const gc = {\r\n        colorByTract,\r\n        colorOfVoteByDistrict,\r\n        colorOfWinsByDistrict,\r\n    }\r\n    return gc\r\n}\r\n\r\nfunction colorTracts(resultsByTract, canList) {\r\n    // get color\r\n    const colorSet = canList.map((can) => can.colorRGBA)\r\n    const colorByTract = resultsByTract.map(\r\n        (row) => row.map(\r\n            (electionResults) => {\r\n                const { tallyFractions } = electionResults.votes\r\n                const color = colorBlender(tallyFractions, colorSet)\r\n                return color\r\n            },\r\n        ),\r\n    )\r\n    return colorByTract\r\n}\r\n\r\nfunction colorDistrictWins(resultsByDistrict, canList, sim) {\r\n    // calculate color for win map\r\n    let colorOfWinsByDistrict\r\n    if (sim.election.socialChoice.checkElectionType() === 'singleWinner') {\r\n        colorOfWinsByDistrict = resultsByDistrict.map(\r\n            (electionResults) => electionResults.winner.color,\r\n        )\r\n    } else {\r\n        const colorSet = canList.map((can) => can.colorRGBA)\r\n        colorOfWinsByDistrict = resultsByDistrict.map(\r\n            (electionResults) => {\r\n                const { allocation } = electionResults\r\n                const sum = allocation.reduce((p, c) => p + c)\r\n                const fractions = allocation.map((x) => x / sum)\r\n                const color = rgbToString(colorBlender(fractions, colorSet))\r\n                return color\r\n            },\r\n        )\r\n    }\r\n    return colorOfWinsByDistrict\r\n}\r\n\r\n/**\r\n * Update color for each district, based on votes for each candidate.\r\n * Blend candidate colors in proportion to their votes.\r\n * @param {Object[]} resultsByDistrict - An array of electionResults, indexed by district.\r\n * @param {Candidate[]} canList - An array of Candidate objects.\r\n * @returns {String[]} - List of color strings indexed by district.\r\n */\r\nfunction colorDistrictVote(resultsByDistrict, canList) {\r\n    const colorOfVoteByDistrict = resultsByDistrict.map((electionResults) => {\r\n        const { tallyFractions } = electionResults.votes\r\n        const colorSet = canList.map((can) => can.colorRGBA)\r\n        const color = rgbToString(colorBlender(tallyFractions, colorSet))\r\n        return color\r\n    })\r\n    return colorOfVoteByDistrict\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Draws an image of noise, or anything really.\r\n * @param {Number} nx - Width in pixels\r\n * @param {Number} ny - Height in pixels\r\n * @param {Screen} screen - Draw here.\r\n * @constructor\r\n */\r\nexport default function NoiseImage(nx, ny, screen) {\r\n    const self = this\r\n\r\n    /*\r\n        Makes your pixel manip on an off-screen canvas\r\n        Returns the off-screen canvas\r\n        */\r\n\r\n    const canvas = document.createElement('canvas')\r\n    canvas.width = nx\r\n    canvas.height = ny\r\n    const offCtx = canvas.getContext('2d')\r\n    const imageData = offCtx.createImageData(nx, ny)\r\n\r\n    // not used anymore\r\n    self.load = (sn) => {\r\n        const { data } = imageData\r\n\r\n        for (let x = 0; x < nx; x++) {\r\n            for (let y = 0; y < ny; y++) {\r\n                const r = sn[x][y][0] + 0.5\r\n                const g = sn[x][y][1] + 0.5\r\n                data[(x + y * nx) * 4 + 0] = r * 255\r\n                data[(x + y * nx) * 4 + 1] = (r + g) * 200\r\n                data[(x + y * nx) * 4 + 2] = g * 200\r\n                data[(x + y * nx) * 4 + 3] = 255\r\n            }\r\n        }\r\n\r\n        offCtx.putImageData(imageData, 0, 0)\r\n    }\r\n\r\n    self.loadColors = (colors) => {\r\n        const { data } = imageData\r\n\r\n        for (let y = 0; y < ny; y++) {\r\n            for (let x = 0; x < nx; x++) {\r\n                const color = colors[x][y]\r\n                const [r, g, b] = color\r\n                data[(x + y * nx) * 4 + 0] = r\r\n                data[(x + y * nx) * 4 + 1] = g\r\n                data[(x + y * nx) * 4 + 2] = b\r\n                data[(x + y * nx) * 4 + 3] = 255\r\n            }\r\n        }\r\n\r\n        offCtx.putImageData(imageData, 0, 0)\r\n    }\r\n\r\n    self.render = (renderWidth, renderHeight) => {\r\n        const { mctx } = screen\r\n        mctx.save()\r\n        mctx.imageSmoothingEnabled = false\r\n        mctx.drawImage(canvas, 0, 0, renderWidth, renderHeight)\r\n        mctx.restore()\r\n    }\r\n    // Draw simplex noise\r\n    // https://codepen.io/jwagner/pen/BNmpdm/?editors=0010\r\n    // Scale image\r\n    // https://stackoverflow.com/a/48858621\r\n}\r\n","/** @module */\r\n\r\nimport geoColors from './geoColors.js'\r\nimport NoiseImage from './NoiseImage.js'\r\n\r\n/**\r\n * Show votes\r\n * @param {VoterGeoList} voterGeoList\r\n * @param {Screen} screen\r\n * @constructor\r\n */\r\nexport default function GeoMaps(voterGeoList, candidateSimList, screen, sim) {\r\n    const self = this\r\n\r\n    // Code that handles making images of geographic noise.\r\n    self.noiseImage = new NoiseImage(voterGeoList.nx, voterGeoList.ny, screen)\r\n\r\n    // Update //\r\n\r\n    self.update = (geoElectionResults) => {\r\n        const gc = geoColors(geoElectionResults, candidateSimList, sim)\r\n        const { colorByTract, colorOfVoteByDistrict, colorOfWinsByDistrict } = gc\r\n        self.colorOfVoteByDistrict = colorOfVoteByDistrict\r\n        self.winnerColors = colorOfWinsByDistrict\r\n        self.noiseImage.loadColors(colorByTract)\r\n    }\r\n\r\n    // Display //\r\n\r\n    const geoMapWidth = 100\r\n    const geoMapHeight = 100\r\n\r\n    // screen.setMapsHeight((1 / 3) * screen.height)\r\n    /** Render all maps and  */\r\n    self.render = () => {\r\n        self.renderPolicyNoise()\r\n        self.renderTractVotes()\r\n        self.renderDistrictWins()\r\n        self.renderDistrictVotes()\r\n    }\r\n    // Render census tract votes.\r\n    self.renderTractVotes = () => {\r\n        self.noiseImage.render(geoMapWidth, geoMapHeight)\r\n        voterGeoList.districtMaker.renderVoronoi(geoMapWidth, geoMapHeight)\r\n    }\r\n    // Render district wins.\r\n    self.renderDistrictWins = () => {\r\n        const { renderVoronoiColors } = voterGeoList.districtMaker\r\n        renderVoronoiColors(200, 0, geoMapWidth, geoMapHeight, self.winnerColors)\r\n    }\r\n    // render district votes.\r\n    self.renderDistrictVotes = () => {\r\n        const { renderVoronoiColors } = voterGeoList.districtMaker\r\n        renderVoronoiColors(100, 0, geoMapWidth, geoMapHeight, self.colorOfVoteByDistrict)\r\n    }\r\n\r\n    /** Draw dots to represent the political diversity across census tracts. */\r\n    self.renderPolicyNoise = () => {\r\n        voterGeoList.voterGroupsByTract.forEach((row) => {\r\n            row.forEach((cell) => {\r\n                cell.forEach((voterGroup) => {\r\n                    if (sim.election.dimensions === 1) {\r\n                        const { x } = voterGroup.shape1\r\n                        const { y } = voterGroup.shape2\r\n                        const ym = (y % 100) + 0 // TODO: better visual\r\n                        // const y = Math.random() * 100\r\n                        smallCircle(x, ym)\r\n                    } else {\r\n                        const { x, y } = voterGroup.shape2\r\n                        smallCircle(x, y)\r\n                        // TODO: use .x and .y instead of shape2\r\n                    }\r\n                })\r\n            })\r\n        })\r\n    }\r\n\r\n    /** Draw a small dot */\r\n\r\n    const canvas = document.createElement('canvas')\r\n    const offCtx = canvas.getContext('2d')\r\n    preDrawCircle()\r\n    function preDrawCircle() {\r\n        canvas.width = 10\r\n        canvas.height = 10\r\n        offCtx.beginPath()\r\n        offCtx.fillStyle = '#555'\r\n        offCtx.arc(5, 5, 1, 0, 2 * Math.PI)\r\n        offCtx.fill()\r\n    }\r\n\r\n    function smallCircle(x, y) {\r\n        const { ctx } = screen\r\n\r\n        ctx.drawImage(canvas, x - 5, y - 5, 10, 10)\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport GeoMaps from './GeoMaps.js'\r\nimport VoterRender1D from './VoterRender1D.js'\r\nimport VoterRender2D from './VoterRender2D.js'\r\n\r\n/**\r\n * Show votes\r\n * @param {VoterGeoList} voterGeoList\r\n * @param {CandidateSimList} candidateSimList\r\n * @param {Screen} screen\r\n * @param {Sim} sim\r\n * @constructor\r\n */\r\nexport default function VizGeo(voterGeoList, candidateSimList, screen, sim) {\r\n    const self = this\r\n\r\n    const geoMaps = new GeoMaps(voterGeoList, candidateSimList, screen, sim)\r\n    let flagNoRender = false\r\n\r\n    const { dimensions } = sim.election\r\n    const VoterRenderer = (dimensions === 1) ? VoterRender1D : VoterRender2D\r\n    voterGeoList.setRenderer((voterShape) => new VoterRenderer(voterShape, screen))\r\n\r\n    self.enter = () => {\r\n        screen.showMaps()\r\n    }\r\n    self.exit = () => {\r\n        screen.hideMaps()\r\n        // clean up fractions\r\n        const fillUndefined = Array(candidateSimList.numSimCandidates()).fill(undefined)\r\n        candidateSimList.setCandidateWins(fillUndefined)\r\n    }\r\n\r\n    self.update = function (geoElectionResults) {\r\n        const { error } = geoElectionResults\r\n        if (error !== undefined) {\r\n            flagNoRender = true\r\n            return\r\n        }\r\n        flagNoRender = false\r\n\r\n        geoMaps.update(geoElectionResults)\r\n\r\n        const { resultsStatewide, allocation } = geoElectionResults\r\n        candidateSimList.setCandidateWins(allocation)\r\n        candidateSimList.setCandidateFractions(resultsStatewide.votes.tallyFractions)\r\n    }\r\n\r\n    self.render = function () {\r\n        if (flagNoRender) return\r\n\r\n        geoMaps.render()\r\n\r\n        voterGeoList.render()\r\n    }\r\n}\r\n","export default function addAllocation(electionResults) {\r\n    const { allocation } = electionResults\r\n    const { votes } = electionResults\r\n    const { tallyFractions } = votes\r\n    if (allocation === undefined) {\r\n        const nk = votes.tallyFractions.length\r\n        const wins = Array(nk).fill(0)\r\n        wins[electionResults.iWinner] = 1\r\n\r\n        return { tallyFractions, allocation: wins }\r\n    }\r\n    return { tallyFractions, allocation }\r\n}\r\n","/** @module */\r\n\r\n// d3-voronoi\r\n// d3-select\r\n// d3-range\r\n\r\nimport { Delaunay } from '../lib/snowpack/build/snowpack/pkg/d3-delaunay.js'\r\n// import { Delaunay } from 'd3-delaunay'\r\n// import { Delaunay } from 'https://cdn.skypack.dev/d3-delaunay@6'\r\n// https://github.com/d3/d3-delaunay\r\n\r\n/**\r\n * Draw Voronoi cells to show votes.\r\n * Voronoi1D is called by VizOne.\r\n * @param {VoterGroup} voterGroup\r\n * @param {CandidateSimList} candidateSimList\r\n * @param {Screen} screen\r\n * @constructor\r\n */\r\nexport default function Voronoi1D(voterGroup, candidateSimList, screen) {\r\n    const self = this\r\n\r\n    let voronoi\r\n    let canList\r\n    self.update = function () {\r\n        canList = candidateSimList.getCandidates()\r\n        const points = canList.map((e) => [e.x, e.y])\r\n        const delaunay = Delaunay.from(points)\r\n        voronoi = delaunay.voronoi([0, 0, screen.width, screen.height])\r\n    }\r\n\r\n    self.render = function () {\r\n        const { ctx } = screen\r\n        const { x, shape1 } = voterGroup\r\n        const { w, densityProfile } = shape1\r\n        const h = 100\r\n\r\n        ctx.save()\r\n\r\n        // clip the voronoi diagram\r\n\r\n        // http://jsfiddle.net/jimrhoskins/dDUC3/1/\r\n        // https://dustinpfister.github.io/2019/10/08/canvas-clip/\r\n\r\n        ctx.beginPath()\r\n        doPath()\r\n        // ctx.closePath()\r\n        ctx.clip()\r\n\r\n        const n = canList.length\r\n        for (let i = 0; i < n; i++) {\r\n            ctx.beginPath()\r\n            voronoi.renderCell(i, ctx)\r\n            ctx.fillStyle = canList[i].color\r\n            ctx.fill()\r\n            ctx.stroke()\r\n        }\r\n\r\n        ctx.beginPath()\r\n        doPath()\r\n        ctx.stroke()\r\n\r\n        ctx.restore()\r\n\r\n        function doPath() {\r\n            if (densityProfile === 'gaussian') {\r\n                gaussianPath()\r\n            } else {\r\n                rectanglePath()\r\n            }\r\n        }\r\n        function gaussianPath() {\r\n            const sigma = w / Math.sqrt(2 * Math.PI) // w = sigma * sqrt(2*pi)\r\n            const amp = h\r\n            const bottom = 150 + h * 0.5\r\n            // start bottom left\r\n            ctx.moveTo(0, bottom)\r\n            const pa = []\r\n            for (let i = 0; i <= screen.width; i += 1) {\r\n                const xp = 0.5 * ((i - x) / sigma) ** 2\r\n                const y = bottom - amp * Math.exp(-xp)\r\n                pa.push(y)\r\n                ctx.lineTo(i, y)\r\n            }\r\n            // end bottom right\r\n            ctx.lineTo(screen.width, bottom)\r\n            ctx.lineTo(0, bottom)\r\n            // ctx.closePath()\r\n        }\r\n        function rectanglePath() {\r\n            ctx.rect(x - w * 0.5, 150 - h * 0.5, w, h)\r\n        }\r\n    }\r\n}\r\n","/** @module */\r\n\r\n// d3-voronoi\r\n// d3-select\r\n// d3-range\r\n\r\nimport { Delaunay } from '../lib/snowpack/build/snowpack/pkg/d3-delaunay.js'\r\n// import { Delaunay } from 'd3-delaunay'\r\n// import { Delaunay } from 'https://cdn.skypack.dev/d3-delaunay@6'\r\n// https://github.com/d3/d3-delaunay\r\n\r\n/**\r\n * Draw Voronoi cells to show votes.\r\n * @param {VoterGroup} voterGroup\r\n * @param {CandidateSimList} candidateSimList\r\n * @param {Screen} screen\r\n * @constructor\r\n */\r\nexport default function Voronoi2D(voterGroup, candidateSimList, screen) {\r\n    const self = this\r\n\r\n    let voronoi\r\n    let canList\r\n    self.update = function () {\r\n        canList = candidateSimList.getCandidates()\r\n        const points = canList.map((e) => [e.x, e.y])\r\n        const delaunay = Delaunay.from(points)\r\n        voronoi = delaunay.voronoi([0, 0, screen.width, screen.height])\r\n    }\r\n\r\n    self.render = function () {\r\n        const { ctx } = screen\r\n\r\n        ctx.save()\r\n\r\n        // draw circle clip\r\n\r\n        // http://jsfiddle.net/jimrhoskins/dDUC3/1/\r\n        // https://dustinpfister.github.io/2019/10/08/canvas-clip/\r\n        ctx.beginPath()\r\n        ctx.arc(voterGroup.x, voterGroup.y, voterGroup.shape2.w * 0.5, 0, 2 * Math.PI)\r\n        // ctx.closePath()\r\n        ctx.clip()\r\n\r\n        const n = canList.length\r\n        for (let i = 0; i < n; i++) {\r\n            ctx.beginPath()\r\n            voronoi.renderCell(i, ctx)\r\n            ctx.fillStyle = canList[i].color\r\n            ctx.fill()\r\n            ctx.stroke()\r\n        }\r\n\r\n        ctx.beginPath()\r\n        ctx.arc(voterGroup.x, voterGroup.y, voterGroup.shape2.w * 0.5, 0, 2 * Math.PI)\r\n        ctx.stroke()\r\n\r\n        ctx.restore()\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport addAllocation from './addAllocation.js'\r\nimport Voronoi1D from './Voronoi1D.js'\r\nimport Voronoi2D from './Voronoi2D.js'\r\n\r\n/**\r\n * Show votes\r\n * @param {VoterSimList} voterSimList\r\n * @param {CandidateSimList} candidateSimList\r\n * @param {Screen} screen\r\n * @param {Sim} sim\r\n * @constructor\r\n */\r\nexport default function VizOneVoronoi(voterSimList, candidateSimList, screen, sim) {\r\n    const self = this\r\n\r\n    // renderer factory //\r\n    const { dimensions } = sim.election\r\n    const Voronoi = (dimensions === 1) ? Voronoi1D : Voronoi2D\r\n    const rendererMaker = (voterShape) => new Voronoi(voterShape, candidateSimList, screen)\r\n    voterSimList.setRenderer(rendererMaker)\r\n\r\n    self.enter = () => {}\r\n    self.exit = () => {\r\n        // clean up fractions\r\n        const fillUndefined = Array(candidateSimList.numSimCandidates()).fill(undefined)\r\n        candidateSimList.setCandidateWins(fillUndefined)\r\n    }\r\n\r\n    self.update = function (electionResults) {\r\n        const { error } = electionResults\r\n        if (error !== undefined) return\r\n\r\n        const { tallyFractions, allocation } = addAllocation(electionResults)\r\n        candidateSimList.setCandidateWins(allocation)\r\n        candidateSimList.setCandidateFractions(tallyFractions)\r\n        voterSimList.updateGraphic()\r\n    }\r\n\r\n    self.render = function () {\r\n        voterSimList.render()\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport castRankingFindIntervals from '../castVotes/castRankingFindIntervals.js'\r\nimport colorBlender, { rgbToString } from './colorBlender.js'\r\n\r\n/**\r\n * Draw Voronoi cells to show votes.\r\n * @param {VoterGroup} voterGroup\r\n * @param {CandidateSimList} candidateSimList\r\n * @param {Screen} screen\r\n * @constructor\r\n */\r\nexport default function VoronoiRanking1D(voterGroup, candidateSimList, screen) {\r\n    const self = this\r\n\r\n    let canList\r\n    let colors\r\n    let intervals\r\n    self.update = function (cellData) {\r\n        // calculate colors\r\n\r\n        let ranking\r\n        let intervalBorders\r\n        if (cellData === undefined) {\r\n            canList = candidateSimList.getCandidates()\r\n            const canGeoms = canList.map((can) => can.shape1)\r\n            const cd = castRankingFindIntervals(canGeoms)\r\n            ranking = cd.ranking\r\n            intervalBorders = cd.intervalBorders\r\n        } else {\r\n            ranking = cellData.ranking\r\n            intervalBorders = cellData.intervalBorders\r\n        }\r\n\r\n        canList = candidateSimList.getCandidates()\r\n        const n = canList.length\r\n        const colorList = canList.map((can) => can.colorRGBA)\r\n\r\n        const ni = intervalBorders.length - 1\r\n        intervals = Array(ni)\r\n        colors = Array(ni)\r\n        for (let i = 0; i < ni; i++) {\r\n            intervals[i] = [intervalBorders[i], intervalBorders[i + 1]]\r\n            const bordaScores = ranking[i].map((r) => n - r)\r\n            colors[i] = rgbToString(colorBlender(bordaScores, colorList))\r\n        }\r\n    }\r\n\r\n    self.render = function () {\r\n        const { ctx } = screen\r\n        const { x, shape1 } = voterGroup\r\n        const { w, densityProfile } = shape1\r\n        const h = 100\r\n\r\n        ctx.save()\r\n\r\n        // clip the voronoi diagram\r\n\r\n        // http://jsfiddle.net/jimrhoskins/dDUC3/1/\r\n        // https://dustinpfister.github.io/2019/10/08/canvas-clip/\r\n\r\n        ctx.beginPath()\r\n        doPath()\r\n        // ctx.closePath()\r\n        ctx.clip()\r\n\r\n        const n = intervals.length\r\n        for (let i = 0; i < n; i++) {\r\n            renderInterval(intervals[i], colors[i], ctx, screen)\r\n        }\r\n\r\n        ctx.beginPath()\r\n        doPath()\r\n        ctx.stroke()\r\n\r\n        ctx.restore()\r\n\r\n        function doPath() {\r\n            if (densityProfile === 'gaussian') {\r\n                gaussianPath()\r\n            } else {\r\n                rectanglePath()\r\n            }\r\n        }\r\n        function gaussianPath() {\r\n            const sigma = w / Math.sqrt(2 * Math.PI) // w = sigma * sqrt(2*pi)\r\n            const amp = h\r\n            const bottom = 150 + h * 0.5\r\n            // start bottom left\r\n            ctx.moveTo(0, bottom)\r\n            const pa = []\r\n            for (let i = 0; i <= screen.width; i += 1) {\r\n                const xp = 0.5 * ((i - x) / sigma) ** 2\r\n                const y = bottom - amp * Math.exp(-xp)\r\n                pa.push(y)\r\n                ctx.lineTo(i, y)\r\n            }\r\n            // end bottom right\r\n            ctx.lineTo(screen.width, bottom)\r\n            ctx.lineTo(0, bottom)\r\n            // ctx.closePath()\r\n        }\r\n        function rectanglePath() {\r\n            ctx.rect(x - w * 0.5, 150 - h * 0.5, w, h)\r\n        }\r\n    }\r\n}\r\n\r\nfunction renderInterval(interval, color, ctx, screen) {\r\n    const x = Math.max(0, interval[0])\r\n    const x2 = Math.min(screen.width, interval[1])\r\n    const w = x2 - x\r\n    const y = 0\r\n    const h = screen.height\r\n\r\n    ctx.beginPath()\r\n    ctx.rect(x, y, w, h)\r\n    ctx.fillStyle = color\r\n    ctx.fill()\r\n    ctx.stroke()\r\n}\r\n","/** @module */\r\n\r\nimport castRankingFindPolygons from '../castVotes/castRankingFindPolygons.js'\r\nimport colorBlender, { rgbToString } from './colorBlender.js'\r\n\r\n/**\r\n * Draw Voronoi cells to show votes.\r\n * @param {VoterGroup} voterGroup\r\n * @param {CandidateSimList} candidateSimList\r\n * @param {Screen} screen\r\n * @constructor\r\n */\r\nexport default function VoronoiRanking2D(voterGroup, candidateSimList, screen) {\r\n    const self = this\r\n\r\n    let canList\r\n    let colors\r\n    let cells\r\n    self.update = function (cellData) {\r\n        // calculate colors\r\n\r\n        let ranking\r\n        if (cellData === undefined) {\r\n            canList = candidateSimList.getCandidates()\r\n            const canGeoms = canList.map((can) => can.shape2)\r\n            const voterGeom = voterGroup.shape2\r\n            const cd = castRankingFindPolygons(voterGeom, canGeoms)\r\n            ranking = cd.ranking\r\n            cells = cd.cells\r\n        } else {\r\n            ranking = cellData.ranking\r\n            cells = cellData.cells\r\n        }\r\n\r\n        canList = candidateSimList.getCandidates()\r\n\r\n        const n = canList.length\r\n        const cn = cells.length\r\n        colors = Array(cn)\r\n        const colorList = canList.map((can) => can.colorRGBA)\r\n        for (let i = 0; i < cn; i++) {\r\n            const bordaScores = ranking[i].map((r) => n - r)\r\n            colors[i] = rgbToString(colorBlender(bordaScores, colorList))\r\n        }\r\n    }\r\n\r\n    self.render = function () {\r\n        const { ctx } = screen\r\n\r\n        ctx.save()\r\n\r\n        const cn = cells.length\r\n        for (let i = 0; i < cn; i++) {\r\n            ctx.beginPath()\r\n            cellPath(ctx, cells[i])\r\n            ctx.fillStyle = colors[i]\r\n            ctx.strokeStyle = colors[i]\r\n            ctx.fill()\r\n            ctx.stroke()\r\n        }\r\n\r\n        // border\r\n        ctx.strokeStyle = '#222'\r\n        ctx.beginPath()\r\n        ctx.arc(voterGroup.x, voterGroup.y, voterGroup.shape2.w * 0.5, 0, 2 * Math.PI)\r\n        ctx.stroke()\r\n\r\n        ctx.restore()\r\n    }\r\n}\r\n\r\nfunction cellPath(ctx, cell) {\r\n    const cc = cell.length\r\n    const first = cell[cc - 1]\r\n    ctx.moveTo(first[0], first[1])\r\n    for (let i = 0; i < cc; i++) {\r\n        const coord = cell[i]\r\n        ctx.lineTo(coord[0], coord[1])\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport addAllocation from './addAllocation.js'\r\nimport VoronoiRanking1D from './VoronoiRanking1D.js'\r\nimport VoronoiRanking2D from './VoronoiRanking2D.js'\r\n\r\n/**\r\n * Show votes\r\n * @param {VoterSimList} voterSimList\r\n * @param {CandidateSimList} candidateSimList\r\n * @param {Screen} screen\r\n * @param {Sim} sim\r\n * @constructor\r\n */\r\nexport default function VizOneVoronoiRanking(voterSimList, candidateSimList, screen, sim) {\r\n    const self = this\r\n\r\n    // renderer factory //\r\n    const { dimensions } = sim.election\r\n    const VoronoiRanking = (dimensions === 1) ? VoronoiRanking1D : VoronoiRanking2D\r\n    const rendererMaker = (voterShape) => new VoronoiRanking(voterShape, candidateSimList, screen)\r\n    voterSimList.setRenderer(rendererMaker)\r\n\r\n    self.enter = () => {}\r\n    self.exit = () => {\r\n        // clean up fractions\r\n        const fillUndefined = Array(candidateSimList.numSimCandidates()).fill(undefined)\r\n        candidateSimList.setCandidateWins(fillUndefined)\r\n    }\r\n\r\n    self.update = function (electionResults) {\r\n        const { error } = electionResults\r\n        if (error !== undefined) return\r\n\r\n        const { tallyFractions, allocation } = addAllocation(electionResults)\r\n        candidateSimList.setCandidateWins(allocation)\r\n        candidateSimList.setCandidateFractions(tallyFractions)\r\n        const { cellData } = electionResults.votes\r\n        voterSimList.updateGraphic(cellData)\r\n    }\r\n\r\n    self.render = function () {\r\n        voterSimList.render()\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport colorBlender, { rgbToString } from './colorBlender.js'\r\n\r\n/**\r\n * Draw grid cells to show votes.\r\n * @param {VoterShape} voterGeom\r\n * @param {Screen} screen\r\n * @constructor\r\n */\r\nexport default function Grid1D(candidateSimList, screen) {\r\n    const self = this\r\n\r\n    const h = 200\r\n    const center = 100\r\n\r\n    let gridData\r\n    let canList\r\n    self.update = (gridData0) => {\r\n        gridData = gridData0\r\n        canList = candidateSimList.getCandidates()\r\n    }\r\n\r\n    self.renderBackground = function () {\r\n        const { ctx } = screen\r\n        ctx.save()\r\n        ctx.globalAlpha = 0.7\r\n\r\n        // draw each can separately\r\n        const nCans = canList.length\r\n        for (let i = 0; i < nCans; i++) {\r\n            ctx.strokeStyle = '#dddddd'\r\n            // ctx.strokeStyle = '#333333'\r\n            ctx.beginPath()\r\n            shapePath(ctx, i, true)\r\n            ctx.stroke()\r\n        }\r\n        ctx.restore()\r\n    }\r\n    self.render = function () {\r\n        const { ctx } = screen\r\n        ctx.save()\r\n        ctx.globalAlpha = 0.7\r\n        const nCans = canList.length\r\n        for (let i = 0; i < nCans; i++) {\r\n            // draw image\r\n            ctx.fillStyle = canList[i].color\r\n            ctx.strokeStyle = rgbToString(colorBlender([0.8, 0.2], [canList[i].color, '#000000']))\r\n            ctx.beginPath()\r\n            shapePath(ctx, i, false)\r\n            ctx.fill()\r\n            ctx.stroke()\r\n        }\r\n        ctx.restore()\r\n    }\r\n    function shapePath(ctx, iCan, drawOutline) {\r\n        const { grid, voteSet, voterGeom } = gridData\r\n        const { x, w, densityProfile } = voterGeom\r\n        const nCans = canList.length\r\n\r\n        const isGauss = (densityProfile === 'gaussian')\r\n        const gridX = grid.x\r\n        const sigma = w / Math.sqrt(2 * Math.PI) // w = sigma * sqrt(2*pi)\r\n        const amp = h / nCans\r\n        const bottom = center + h * 0.5 - iCan * amp\r\n        // start bottom left\r\n        // go outside of screen by one pixel\r\n        const left = Math.max(-1, gridX[0])\r\n        ctx.moveTo(left, bottom)\r\n        const gl = gridX.length\r\n        for (let i = 0; i < gl; i += 1) {\r\n            const xg = gridX[i]\r\n            if (xg < -1) continue\r\n            if (xg > screen.width + 1) continue\r\n            const voteMult = (drawOutline) ? 1 : voteSet[i].tallyFractions[iCan]\r\n            const shapeMult = (isGauss) ? Math.exp(-0.5 * ((xg - x) / sigma) ** 2) : 1\r\n            const y = bottom - amp * shapeMult * voteMult\r\n            ctx.lineTo(xg, y)\r\n        }\r\n        // end bottom right\r\n        const right = Math.min(screen.width + 1, gridX[gl - 1])\r\n        ctx.lineTo(right, bottom)\r\n        // close path\r\n        ctx.lineTo(left, bottom)\r\n    }\r\n}\r\n","/** @module */\r\nimport colorBlender from './colorBlender.js'\r\n\r\n/**\r\n * Draw grid cells to show votes.\r\n * Basically, we have a rectangular grid of voter support.\r\n * Even if the voterGeom is a circle.\r\n * Later, when we draw, we make a clip in the shape of the voterGeom,\r\n * and draw the grid inside the clip.\r\n * @param {Screen} screen\r\n * @constructor\r\n */\r\nexport default function Grid2D(candidateSimList, screen) {\r\n    const self = this\r\n\r\n    let gridData\r\n    let canList\r\n    let singleCanvas\r\n    const canvases = []\r\n    // TODO: set up canvases before update?\r\n\r\n    self.update = (gridData0) => {\r\n        gridData = gridData0\r\n        canList = candidateSimList.getCandidates()\r\n\r\n        const { grid, voteSet, voterGeom } = gridData\r\n\r\n        const nCans = canList.length\r\n        const nHeight = Math.floor((nCans - 1) / 3) + 1\r\n        screen.setMapsHeight(nHeight * (1 / 3) * screen.height)\r\n\r\n        const isGauss = voterGeom.densityProfile === 'gaussian'\r\n\r\n        fillDataSeparate()\r\n        fillDataBlend()\r\n\r\n        function fillDataSeparate() {\r\n            // make image data\r\n            const { nx, ny, weight } = grid\r\n            canvases.splice(0)\r\n            for (let i = 0; i < canList.length; i++) {\r\n                const canvas = document.createElement('canvas')\r\n                canvas.width = nx\r\n                canvas.height = ny\r\n                const offCtx = canvas.getContext('2d')\r\n                const imageData = offCtx.createImageData(nx, ny)\r\n\r\n                const { data } = imageData\r\n\r\n                const { colorRGBA } = canList[i]\r\n                const [r, g, b] = colorRGBA\r\n\r\n                let k = 0\r\n                for (let yp = 0; yp < ny; yp++) {\r\n                    for (let xp = 0; xp < nx; xp++) {\r\n                        const support = voteSet[k].tallyFractions[i]\r\n                        const a = support * ((isGauss) ? weight[k] : 1) * 255\r\n\r\n                        data[(xp + yp * nx) * 4 + 0] = r\r\n                        data[(xp + yp * nx) * 4 + 1] = g\r\n                        data[(xp + yp * nx) * 4 + 2] = b\r\n                        data[(xp + yp * nx) * 4 + 3] = a\r\n                        k += 1\r\n                    }\r\n                }\r\n                canvases.push(canvas)\r\n                offCtx.putImageData(imageData, 0, 0)\r\n            }\r\n        }\r\n\r\n        function fillDataBlend() {\r\n        // make image data\r\n            const { nx, ny, weight } = grid\r\n            const colorSet = canList.map((can) => can.colorRGBA)\r\n\r\n            const canvas = document.createElement('canvas')\r\n            canvas.width = nx\r\n            canvas.height = ny\r\n            const offCtx = canvas.getContext('2d')\r\n            const imageData = offCtx.createImageData(nx, ny)\r\n\r\n            const { data } = imageData\r\n\r\n            let k = 0\r\n            for (let yp = 0; yp < ny; yp++) {\r\n                for (let xp = 0; xp < nx; xp++) {\r\n                    const { tallyFractions } = voteSet[k]\r\n                    const [r, g, b] = colorBlender(tallyFractions, colorSet)\r\n\r\n                    const a = ((isGauss) ? weight[k] : 1) * 255\r\n\r\n                    data[(xp + yp * nx) * 4 + 0] = r\r\n                    data[(xp + yp * nx) * 4 + 1] = g\r\n                    data[(xp + yp * nx) * 4 + 2] = b\r\n                    data[(xp + yp * nx) * 4 + 3] = a\r\n                    k += 1\r\n                }\r\n            }\r\n            singleCanvas = canvas\r\n            offCtx.putImageData(imageData, 0, 0)\r\n        }\r\n    }\r\n\r\n    self.render = function () {\r\n        const { ctx, mctx } = screen\r\n\r\n        const { x, y, w } = gridData.voterGeom\r\n\r\n        drawBlend()\r\n\r\n        drawSeparate()\r\n\r\n        function drawSeparate() {\r\n            // draw each can separately\r\n            const nCans = canList.length\r\n            for (let i = 0; i < nCans; i++) {\r\n                // draw image\r\n                // transform is t\r\n                mctx.save()\r\n                // mctx.globalAlpha = 0.7\r\n                const t = {\r\n                    w: 1 / 3, h: 1 / 3, x: (i % 3) * 100, y: Math.floor(i / 3) * 100,\r\n                }\r\n\r\n                // shape\r\n                const sh = {\r\n                    x: x * t.w + t.x,\r\n                    y: y * t.h + t.y,\r\n                    r: w * t.w * 0.5,\r\n                }\r\n\r\n                // clip outline of shape\r\n                mctx.beginPath()\r\n                mctx.arc(sh.x, sh.y, sh.r, 0, 2 * Math.PI)\r\n                mctx.clip()\r\n\r\n                mctx.beginPath()\r\n                mctx.rect(t.x, t.y, 100, 100)\r\n                mctx.clip()\r\n\r\n                const canvas = canvases[i]\r\n                const im = {\r\n                    x: x * t.w - w * t.w * 0.5 + t.x,\r\n                    y: y * t.w - w * t.w * 0.5 + t.y,\r\n                    w: w * t.w,\r\n                    h: w * t.h,\r\n                }\r\n                mctx.drawImage(canvas, im.x, im.y, im.w, im.h)\r\n\r\n                // draw outline of shape\r\n                mctx.beginPath()\r\n                mctx.arc(sh.x, sh.y, sh.r, 0, 2 * Math.PI)\r\n                mctx.stroke()\r\n                mctx.restore()\r\n            }\r\n        }\r\n\r\n        function drawBlend() {\r\n            ctx.save()\r\n            // ctx.globalAlpha = 0.7\r\n\r\n            // clip outline of shape\r\n            ctx.beginPath()\r\n            ctx.arc(x, y, w * 0.5, 0, 2 * Math.PI)\r\n            ctx.clip()\r\n\r\n            // draw image\r\n            // transform is t\r\n            const t = {\r\n                w: 1, h: 1, x: 0, y: 0,\r\n            }\r\n            const canvas = singleCanvas\r\n            ctx.imageSmoothingEnabled = false\r\n            const ov = {\r\n                x: x - w * 0.5 + t.x,\r\n                y: y - w * 0.5 + t.y,\r\n                w: w * t.w,\r\n                h: w * t.h,\r\n            }\r\n            ctx.drawImage(canvas, ov.x, ov.y, ov.w, ov.h)\r\n\r\n            // draw outline of shape\r\n            ctx.beginPath()\r\n            ctx.arc(x, y, w * 0.5, 0, 2 * Math.PI)\r\n            ctx.stroke()\r\n\r\n            ctx.restore()\r\n        }\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport addAllocation from './addAllocation.js'\r\nimport Grid1D from './Grid1D.js'\r\nimport Grid2D from './Grid2D.js'\r\n\r\n/**\r\n * Show votes\r\n * @param {VoterSimList} voterSimList\r\n * @param {CandidateSimList} candidateSimList\r\n * @param {Screen} screen\r\n * @param {Sim} sim\r\n * @constructor\r\n */\r\nexport default function VizOneGrid(voterSimList, candidateSimList, screen, sim) {\r\n    const self = this\r\n\r\n    // renderer factory //\r\n    const { dimensions } = sim.election\r\n    const Grid = (dimensions === 1) ? Grid1D : Grid2D\r\n    const rendererMaker = () => new Grid(candidateSimList, screen)\r\n    voterSimList.setRenderer(rendererMaker)\r\n\r\n    self.enter = function () {\r\n        if (dimensions === 2) {\r\n            screen.showMaps()\r\n        }\r\n    }\r\n    self.exit = function () {\r\n        screen.hideMaps()\r\n        // clean up fractions\r\n        const fillUndefined = Array(candidateSimList.numSimCandidates()).fill(undefined)\r\n        candidateSimList.setCandidateWins(fillUndefined)\r\n    }\r\n\r\n    self.update = function (electionResults) {\r\n        const { error } = electionResults\r\n        if (error !== undefined) return\r\n\r\n        const { tallyFractions, allocation } = addAllocation(electionResults)\r\n        candidateSimList.setCandidateWins(allocation)\r\n        candidateSimList.setCandidateFractions(tallyFractions)\r\n\r\n        const { gridData } = electionResults.votes\r\n        voterSimList.updateGraphic(gridData)\r\n    }\r\n    self.render = function () {\r\n        if (sim.election.dimensions === 1) {\r\n            voterSimList.renderBackground()\r\n        }\r\n\r\n        voterSimList.render()\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport CandidateSim from '../../candidates/CandidateSim.js'\r\nimport CandidateSimList from '../../candidates/CandidateSimList.js'\r\nimport VoterGeoList from '../../voters/VoterGeoList.js'\r\nimport SimBase from './SimBase.js'\r\nimport VoterSim from '../../voters/VoterSim.js'\r\nimport VoterSimList from '../../voters/VoterSimList.js'\r\nimport VizGeo from '../../viz/VizGeo.js'\r\nimport VizOneVoronoi from '../../viz/VizOneVoronoi.js'\r\nimport VizOneVoronoiRanking from '../../viz/VizOneVoronoiRanking.js'\r\nimport VizOneGrid from '../../viz/VizOneGrid.js'\r\n\r\n/**\r\n * Simulate one election with\r\n *   candidates in defined positions, and\r\n *   voters in a distribution that will be summed over.\r\n * Create a geographical map with variations of voter center.\r\n * Plan:\r\n * * SimOne is a subclass of SimBase.\r\n * * VizOne is a subclass of VoterSim.\r\n * * Voronoi1D is called by VizOne.\r\n * @param {Screen} screen\r\n * @param {Menu} menu\r\n * @param {Changes} changes\r\n * @param {ElectionOne} electionOne\r\n * @param {ElectionGeo} electionGeo\r\n * @param {Sim} sim\r\n * @constructor\r\n */\r\nexport default function SimOne(screen, menu, changes, electionOne, electionGeo, sim) {\r\n    const self = this\r\n\r\n    SimBase.call(self, screen, changes, sim)\r\n\r\n    // Entities //\r\n\r\n    const candidateSimList = new CandidateSimList(sim)\r\n    const voterSimList = new VoterSimList(sim)\r\n    const voterGeoList = new VoterGeoList(screen, sim, changes)\r\n\r\n    self.addSimCandidate = (candidate) => {\r\n        candidateSimList.newCandidate(new CandidateSim(candidate, self.dragm, screen))\r\n    }\r\n\r\n    self.addSimVoterCircle = (voterShape) => {\r\n        voterGeoList.newVoterSim(new VoterSim(voterShape, self.dragm, screen))\r\n        voterSimList.newVoterSim(new VoterSim(voterShape, self.dragm, screen))\r\n    }\r\n\r\n    changes.add(['districts'])\r\n\r\n    // Strategies //\r\n\r\n    let voterList\r\n    let electionStrategy\r\n    let vizOne\r\n    function enterStrategy() {\r\n        voterList = (sim.geo) ? voterGeoList : voterSimList\r\n\r\n        electionStrategy = (sim.geo) ? electionGeo : electionOne\r\n\r\n        const { casterName } = sim.election.socialChoice\r\n        const VizOneVoronoiGeneral = (casterName === 'ranking' || casterName === 'pairwise') ? VizOneVoronoiRanking : VizOneVoronoi\r\n        const VizNoGeo = (casterName === 'score') ? VizOneGrid : VizOneVoronoiGeneral\r\n        const VizOne = (sim.geo === true) ? VizGeo : VizNoGeo\r\n        vizOne = new VizOne(voterList, candidateSimList, screen, sim)\r\n    }\r\n    enterStrategy()\r\n\r\n    // Main State Machine Functions //\r\n\r\n    const superEnter = self.enter\r\n    self.enter = () => {\r\n        superEnter()\r\n        enterStrategy()\r\n\r\n        sim.candidateAdd.canButton.show()\r\n        vizOne.enter()\r\n        voterList.updateXY()\r\n        candidateSimList.updateXY()\r\n        sim.voterTest.updateXY()\r\n    }\r\n\r\n    self.exit = () => {\r\n        vizOne.exit()\r\n        sim.candidateAdd.canButton.hide()\r\n        sim.voterTest.setE(0)\r\n    }\r\n\r\n    self.update = () => {\r\n        if (changes.checkNone()) return\r\n\r\n        voterList.update()\r\n        const electionResults = electionStrategy\r\n            .runElectionSim(voterList, candidateSimList, changes)\r\n        vizOne.update(electionResults)\r\n        self.testVoteSim()\r\n        changes.clear()\r\n\r\n        screen.clear()\r\n        screen.clearMaps()\r\n        self.render()\r\n    }\r\n\r\n    self.testVoteSim = () => {\r\n        const vote = electionStrategy.testVoteES(sim.voterTest, candidateSimList)\r\n        sim.voterTest.update(vote, candidateSimList)\r\n        return vote\r\n    }\r\n\r\n    self.render = () => {\r\n        vizOne.render()\r\n    }\r\n    self.renderForeground = () => {\r\n        voterList.renderForeground()\r\n        candidateSimList.renderForeground()\r\n        sim.voterTest.renderForeground()\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Simulate winners from many sampled elections.\r\n * Candidates are sampled from a distribution.\r\n * Winners are drawn as points.\r\n * The simulation is dynamic. More simulations are performed at each frame.\r\n * @param {Screen} screen\r\n * @param {Menu} menu\r\n * @param {Election} election\r\n * @constructor\r\n */\r\nexport default function ElectionSampleGeo(election, electionGeo) {\r\n    const self = this\r\n\r\n    // const optionCast = { usr: 16 }\r\n\r\n    const maxPoints = 5000\r\n\r\n    let points = []\r\n\r\n    self.update = function (voterSimList, candidateSimList, changes, dimensions) {\r\n        if (changes.checkNone() === false) {\r\n            self.startSim()\r\n        }\r\n\r\n        const addResult = self.addSim(voterSimList, candidateSimList, dimensions)\r\n        return addResult\r\n    }\r\n\r\n    self.startSim = function () {\r\n        points = []\r\n    }\r\n\r\n    self.addSim = function (voterSimList, sampleCandidates, dimensions) {\r\n        // add more points\r\n\r\n        if (voterSimList.getVoterShapes().length === 0) return { pointsChanged: false }\r\n        if (sampleCandidates.getCandidateDistributions().length === 0) {\r\n            return { pointsChanged: false }\r\n        }\r\n\r\n        if (points.length > maxPoints) return { pointsChanged: false }\r\n        // this limit right now is about graphics rendering.\r\n        // todo: render to a buffer\r\n\r\n        // number of sample elections\r\n        const ns = 1\r\n\r\n        // number of new points\r\n        const { seats } = election.socialChoice\r\n        const { nd } = voterSimList\r\n        const nnp = seats * ns * nd\r\n        const newPoints = Array(nnp)\r\n        let q = 0\r\n\r\n        for (let i = 0; i < ns; i++) {\r\n            // choose a number of candidates\r\n            const nk = election.socialChoice.numSampleCandidates\r\n            const canList = []\r\n            for (let k = 0; k < nk; k++) {\r\n                // sample a point from the distribution of candidates\r\n                const point = sampleCandidates.sampler.samplePoint()\r\n\r\n                // make a candidate\r\n                if (dimensions === 1) {\r\n                    canList.push({ shape1: point })\r\n                } else {\r\n                    canList.push({ shape2: point })\r\n                }\r\n            }\r\n\r\n            // find winner position\r\n            const electionResults = electionGeo.runElection2(voterSimList, canList)\r\n\r\n            const { resultsByDistrict } = electionResults\r\n            const nDistricts = resultsByDistrict.length\r\n\r\n            // adjustable parameter for visualization\r\n            const jitterSize = 10\r\n\r\n            if (election.socialChoice.checkElectionType() === 'singleWinner') {\r\n                let r = 0\r\n                for (let o = 0; o < nDistricts; o++) {\r\n                    const { winner } = resultsByDistrict[o]\r\n\r\n                    // record point\r\n                    let winPoint\r\n                    if (r === 0) {\r\n                        // record point\r\n                        winPoint = (dimensions === 1) ? winner.shape1 : winner.shape2\r\n                    } else if (dimensions === 1) {\r\n                        // add jitter\r\n                        winPoint = {\r\n                            x: winner.shape1.x + (Math.random() - 0.5) * jitterSize,\r\n                        }\r\n                    } else {\r\n                        // add jitter\r\n                        winPoint = {\r\n                            x: winner.shape2.x + (Math.random() - 0.5) * jitterSize,\r\n                            y: winner.shape2.y + (Math.random() - 0.5) * jitterSize,\r\n                        }\r\n                    }\r\n\r\n                    points.push(winPoint)\r\n                    newPoints[q] = winPoint\r\n                    q += 1\r\n                    r += 1\r\n                }\r\n            } else {\r\n                let r = 0\r\n                for (let o = 0; o < nDistricts; o++) {\r\n                    const { allocation } = resultsByDistrict[o]\r\n\r\n                    for (let k = 0; k < canList.length; k++) {\r\n                        const can = canList[k]\r\n                        const numPoints = allocation[k]\r\n                        for (let m = 0; m < numPoints; m++) {\r\n                            let winPoint\r\n                            if (r === 0) {\r\n                                // record point\r\n                                winPoint = (dimensions === 1) ? can.shape1 : can.shape2\r\n                            } else if (dimensions === 1) {\r\n                                // add jitter\r\n                                winPoint = {\r\n                                    x: can.shape1.x + (Math.random() - 0.5) * jitterSize,\r\n                                }\r\n                            } else {\r\n                                // add jitter\r\n                                winPoint = {\r\n                                    x: can.shape2.x + (Math.random() - 0.5) * jitterSize,\r\n                                    y: can.shape2.y + (Math.random() - 0.5) * jitterSize,\r\n                                }\r\n                            }\r\n                            // record point\r\n                            points.push(winPoint)\r\n                            newPoints[q] = winPoint\r\n                            q += 1\r\n                            r += 1\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return { pointsChanged: true, newPoints, points }\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport SimSample from './states/SimSample.js'\r\nimport VoterShapeAdd from '../voters/VoterShapeAdd.js'\r\nimport CandidateAdd from '../candidates/CandidateAdd.js'\r\nimport CandidateDnAdd from '../candidateDns/CandidateDnAdd.js'\r\nimport addSimControlsLabel from './addSimControlsLabel.js'\r\nimport VoterTest from '../voters/VoterTest.js'\r\nimport ElectionOne from '../election/ElectionOne.js'\r\nimport ElectionSample from '../election/ElectionSample.js'\r\nimport ElectionGeo from '../election/ElectionGeo.js'\r\nimport Election from '../election/Election.js'\r\nimport SimBase from './states/SimBase.js'\r\nimport SimOne from './states/SimOne.js'\r\nimport ElectionSampleGeo from '../election/ElectionSampleGeo.js'\r\n\r\n/**\r\n * Simulation is the main task we're trying to accomplish in this program.\r\n * There are multiple states that the sim can be in.\r\n * Each state simulates something different.\r\n * Each state has initialization, update, and render procedures.\r\n * This is a state machine.\r\n * @param {Screen} screen\r\n * @param {Menu} menu\r\n * @param {Changes} changes\r\n * @param {Commander} commander\r\n *\r\n * @constructor\r\n */\r\nexport default function Sim(\r\n    screen,\r\n    menu,\r\n    changes,\r\n    commander,\r\n    layout,\r\n) {\r\n    const self = this\r\n\r\n    // Components //\r\n\r\n    const election = new Election(menu)\r\n    const electionOne = new ElectionOne(election)\r\n    const electionSample = new ElectionSample(election)\r\n    const electionGeo = new ElectionGeo(election)\r\n    const electionSampleGeo = new ElectionSampleGeo(election, electionGeo)\r\n\r\n    self.election = election\r\n\r\n    // States //\r\n\r\n    const sims = {\r\n        one: new SimOne(screen, menu, changes, electionOne, electionGeo, self),\r\n        // eslint-disable-next-line max-len\r\n        sample: new SimSample(screen, menu, changes, electionSample, electionSampleGeo, self),\r\n        base: new SimBase(screen, changes, self),\r\n    }\r\n    self.sims = sims\r\n\r\n    // Entities //\r\n\r\n    self.voterShapeAdd = new VoterShapeAdd(screen, layout, changes, commander, sims, self)\r\n    self.candidateAdd = new CandidateAdd(screen, layout, changes, commander, sims, self)\r\n    self.candidateDnAdd = new CandidateDnAdd(screen, layout, changes, commander, sims, self)\r\n\r\n    self.voterTest = new VoterTest(screen, sims, self)\r\n    self.testVote = () => sims[self.state].testVoteSim()\r\n\r\n    // Default Entities //\r\n\r\n    self.candidateAdd.addCandidate({ x: 50, y: 100 }, { x: 50 }, '#e05020', true)\r\n    self.candidateAdd.addCandidate({ x: 100, y: 50 }, { x: 100 }, '#50e020', true)\r\n    self.candidateAdd.addCandidate({ x: 300 - 100, y: 300 - 50 }, { x: 200 }, '#2050e0', true)\r\n    self.candidateDnAdd.addCandidateDistribution({ x: 150, y: 150, w: 200 }, { x: 150, w: 200, densityProfile: 'gaussian' }, true)\r\n    self.voterShapeAdd.addVoterCircle({ x: 50, y: 150, w: 200 }, { x: 50, w: 200, densityProfile: 'gaussian' }, true)\r\n    self.voterShapeAdd.addVoterCircle({ x: 250, y: 150, w: 200 }, { x: 250, w: 200, densityProfile: 'gaussian' }, true)\r\n\r\n    // State Machine //\r\n\r\n    self.state = 'one' // default\r\n    self.viz = 'one'\r\n    self.geo = false\r\n    self.election.setDimensions(2)\r\n    // self.typeExit = self.state\r\n    changes.add(['geo', 'dimensions', 'viz'])\r\n\r\n    self.update = () => {\r\n        // state change\r\n        if (changes.check(['geo', 'dimensions', 'viz', 'electionMethod'])) {\r\n            // exit states\r\n            Object.keys(sims).forEach((k) => sims[k].exit())\r\n            // compute state\r\n            self.state = computeState()\r\n            // enter state\r\n            sims[self.state].enter()\r\n        }\r\n\r\n        // state update\r\n        sims[self.state].update()\r\n    }\r\n    function computeState() {\r\n        // right now, we use combinations of these state variables\r\n        // to determine which state to take, as opposed to having\r\n        // nested states.\r\n        // Also, we don't yet have implementations of all the possible\r\n        // combinations of these state variables.\r\n        if (self.viz === 'one') {\r\n            return 'one'\r\n        }\r\n        return 'sample'\r\n    }\r\n    self.renderForeground = () => { sims[self.state].renderForeground() }\r\n    self.render = () => { sims[self.state].render() }\r\n\r\n    self.setShowNonExistingEntities = (a) => {\r\n        self.showGhosts = a\r\n        changes.add(['showGhosts'])\r\n    }\r\n\r\n    // Buttons //\r\n\r\n    addSimControlsLabel(layout)\r\n\r\n    // -- Menu -- //\r\n\r\n    // add a menu item to switch between types of sims\r\n    // a list of simulation types\r\n    const vizList = [\r\n        { name: 'One Election', value: 'one' },\r\n        { name: 'Sample Elections', value: 'sample' },\r\n    ]\r\n    menu.addMenuItem(\r\n        self,\r\n        {\r\n            label: 'Viz:',\r\n            prop: 'viz',\r\n            setProp: (p) => { self.viz = p },\r\n            options: vizList,\r\n            change: ['viz'],\r\n        },\r\n    )\r\n\r\n    const geoList = [\r\n        { name: 'On', value: true },\r\n        { name: 'Off', value: false },\r\n    ]\r\n    menu.addMenuItem(\r\n        self,\r\n        {\r\n            label: 'Geo:',\r\n            prop: 'geo',\r\n            setProp: (p) => { self.geo = p },\r\n            options: geoList,\r\n            change: ['geo'],\r\n        },\r\n    )\r\n\r\n    const dimensionList = [\r\n        { name: '1D', value: 1 },\r\n        { name: '2D', value: 2 },\r\n    ]\r\n    menu.addMenuItem(\r\n        self.election,\r\n        {\r\n            label: 'Dimensions:',\r\n            prop: 'dimensions',\r\n            setProp: (p) => { self.election.setDimensions(p) },\r\n            options: dimensionList,\r\n            change: ['dimensions'],\r\n        },\r\n    )\r\n}\r\n","/** Add a label for the sim controls */\r\nexport default function addSimControlsLabel(layout) {\r\n    const label = document.createElement('div')\r\n    label.setAttribute('class', 'button-group-label2')\r\n    label.innerText = 'Sim Controls:'\r\n    layout.newElement('simControlsLabel', label)\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Layout keeps an internal ordered list of div names.\r\n * It creates a parent div to fill with these divs.\r\n * New divs are added according to the order of the names.\r\n * If the new div isn't in the list, then it is added at the end of the parent div.\r\n * @param {String[]} - Names in an ordered list for the layout.\r\n * @constructor\r\n */\r\nexport default function Layout(order) {\r\n    const self = this\r\n\r\n    const divsByName = {}\r\n    const extraDivs = []\r\n\r\n    /**\r\n     * Adds a new div with a name that should be in Layout's internal ordered list.\r\n     * @param {String} name\r\n     * @param {HTMLElement} div\r\n     */\r\n    self.newElement = (name, div) => {\r\n        if (order.includes(name)) {\r\n            divsByName[name] = div\r\n        } else {\r\n            extraDivs.push(div)\r\n        }\r\n    }\r\n\r\n    /**\r\n     * When we're done adding new divs, we return a parent div.\r\n     * @returns The parent div containing all other divs in order.\r\n     */\r\n    self.makeComponent = () => {\r\n        const parent = document.createElement('div')\r\n        order.forEach((name) => {\r\n            const div = divsByName[name]\r\n            if (div !== undefined) {\r\n                parent.appendChild(div)\r\n            }\r\n        })\r\n        extraDivs.forEach((div) => {\r\n            parent.appendChild(div)\r\n        })\r\n        return parent\r\n    }\r\n}\r\n","/**\r\n * Keep a\r\n * @param {Commander} commander  */\r\nexport default function CommandStore(commander) {\r\n    const self = this\r\n\r\n    // A list of actions we can execute (for sender)\r\n    const actions = []\r\n\r\n    /**\r\n     * A menu item or other object can add an action that it wants to execute with a value.\r\n     * The action can be performed by calling commander.do(command),\r\n     * where command has a name and value.\r\n     * @param {String} name - The name of the action.\r\n     * @param {Function} action - The action function itself, which is called with a value.\r\n     */\r\n    self.addSender = (args) => {\r\n        const {\r\n            name, action, props,\r\n        } = args\r\n\r\n        actions[name] = action\r\n        const command = (value) => ({ name, value, props })\r\n        const go = (value) => commander.do(command(value))\r\n        const sender = { command, go }\r\n        return sender\r\n    }\r\n\r\n    /**\r\n     * Make a sender with a command and a way to do the command.\r\n     * This type of sender deals with lists.\r\n     *\r\n     * Say we want to change a value for the nth candidate.\r\n     * And say the nth candidate doesn't exist.\r\n     * Then we have to use an action which acts on the list of candidates,\r\n     * rather than the candidate itself.\r\n     *\r\n     * @param {Object} args\r\n     * @returns {Object} - methods command(id,value) and go(id,value)\r\n     */\r\n    self.addSenderForList = (args) => {\r\n        const {\r\n            name, action, props,\r\n        } = args\r\n\r\n        actions[name] = action\r\n        const command = (id, value, currentValue) => ({\r\n            name, id, value, props, currentValue,\r\n        })\r\n        const go = (id, value, currentValue) => commander.do(command(id, value, currentValue))\r\n        const sender = { command, go }\r\n        return sender\r\n    }\r\n\r\n    /**\r\n     * Actually execute the action.\r\n     * @param {Object} command -\r\n     */\r\n    self.execute = (command) => {\r\n        const { name, id, value } = command\r\n        const action = actions[name]\r\n        if (id !== undefined) {\r\n            action(id, value)\r\n        } else {\r\n            action(value)\r\n        }\r\n    }\r\n}\r\n","/** Handle the Config */\r\nexport default function ConfigKeeper(commander) {\r\n    const self = this\r\n\r\n    // The list of all mementos\r\n    const config = {}\r\n\r\n    const firstActions = []\r\n\r\n    /**\r\n     * A menu item or other object can add an action that it wants to execute with a value.\r\n     * The action can be performed by calling commander.do(command),\r\n     * where command has a name and value.\r\n     * @param {String} name - The name of the action.\r\n     * @param {Function} action - The action function itself, which is called with a value.\r\n     */\r\n    self.addSender = (args) => {\r\n        const { name, currentValue, props } = args\r\n        if (props !== undefined && props.isFirstAction) {\r\n            firstActions[name] = true\r\n        }\r\n        config[name] = currentValue\r\n    }\r\n\r\n    /**\r\n     * Make a sender with a command and a way to do the command.\r\n     * This type of sender deals with lists.\r\n     *\r\n     * Say we want to change a value for the nth candidate.\r\n     * And say the nth candidate doesn't exist.\r\n     * Then we have to use an action which acts on the list of candidates,\r\n     * rather than the candidate itself.\r\n     *\r\n     * @param {Object} args\r\n     * @returns {Function} - a method to get the current value at an id.\r\n     */\r\n    self.addSenderForList = (args) => {\r\n        const { name, props } = args\r\n        if (props !== undefined && props.isFirstAction) {\r\n            firstActions[name] = true\r\n        }\r\n        config[name] = []\r\n\r\n        const getCurrentValue = (id) => config[name][id]\r\n        return getCurrentValue\r\n    }\r\n\r\n    /**\r\n     * Update the config when executing a command.\r\n     * @param {Object} command -\r\n     */\r\n    self.execute = (command) => {\r\n        const { name, id, value } = command\r\n        if (id !== undefined) {\r\n            config[name][id] = value\r\n        } else {\r\n            config[name] = value\r\n        }\r\n    }\r\n\r\n    self.makeUndo = (command) => {\r\n        const { name, id, props } = command // command is {name, value, props}\r\n\r\n        // Store the current value so we can undo the command.\r\n        let currentValue\r\n        if (id === undefined) {\r\n            currentValue = config[name]\r\n        } else {\r\n            currentValue = config[name][id]\r\n            if (currentValue === undefined) {\r\n                currentValue = command.currentValue\r\n            }\r\n        }\r\n\r\n        // Store how to undo the command.\r\n        const undoCommand = {\r\n            name, id, value: currentValue, props,\r\n        }\r\n\r\n        return undoCommand\r\n    }\r\n\r\n    self.passLoadConfig = (newConfig) => {\r\n        // newConfig is a list of commands to execute.\r\n        self.loadConfigPriority(newConfig, 'high')\r\n        self.loadConfigPriority(newConfig, 'low')\r\n    }\r\n\r\n    self.loadConfigPriority = (newConfig, priority) => {\r\n        // newConfig is a list of commands to execute.\r\n        const names = Object.keys(newConfig)\r\n        names.forEach((name) => {\r\n            // Decide whether to process commands, based on their priority.\r\n            const isHigh = firstActions[name] !== undefined\r\n            if (priority === 'low' && isHigh) {\r\n                return\r\n            }\r\n            if (priority === 'high' && !isHigh) {\r\n                return\r\n            }\r\n\r\n            // if we have a list, then create commands for each item in the list\r\n            const valueArray = newConfig[name]\r\n            if (valueArray instanceof Array) {\r\n                valueArray.forEach((value, id) => {\r\n                    // const subValue = newConfig[name][id]\r\n                    const command = { name, id, value }\r\n                    commander.execute(command)\r\n                })\r\n            } else {\r\n                const value = valueArray\r\n                const command = { name, value }\r\n                commander.execute(command)\r\n            }\r\n        })\r\n    }\r\n\r\n    self.passLoadCommands = (commands) => {\r\n        // execute commands without adding to history\r\n        commands.forEach((command) => {\r\n            commander.execute(command)\r\n        })\r\n    }\r\n\r\n    self.getConfig = () => structuredClone(config)\r\n}\r\n","export default function History(commander) {\r\n    const self = this\r\n\r\n    // Keep commands and undos in history\r\n    const history = []\r\n    let head = -1 // Head is where we are in history, where our head is at.\r\n\r\n    self.clearHistory = () => {\r\n        history.splice(0, history.length)\r\n        head = -1\r\n    }\r\n\r\n    /**\r\n     * We want to do a command. We need to keep track of what we do so we can undo it.\r\n     * @param {Object} command\r\n     * @param {String} command.name\r\n     * @param {(String|Number|Boolean)} command.value\r\n     * @param {Object} command.props - a catchall for easier coding\r\n     */\r\n    self.passDo = (command) => {\r\n        const undoCommand = commander.makeUndo(command)\r\n\r\n        // remove future redos\r\n        // example: head:-1 means history will be cleared splice(0,length)\r\n        history.splice(head + 1, history.length - (head + 1))\r\n\r\n        // Actually preform the command.\r\n        commander.execute(command)\r\n\r\n        // Add command to history\r\n        history.push([{ command, undoCommand }])\r\n        head += 1\r\n    }\r\n\r\n    /**\r\n     * Do a set of commands together, so they have one history item.\r\n     * @param {Object[]} commands - a list of command objects\r\n     */\r\n    self.passDoCommands = (commands) => {\r\n        // remove future redos\r\n        // example: head:-1 means history will be cleared splice(0,length)\r\n        history.splice(head + 1, history.length - (head + 1))\r\n\r\n        const historyItem = []\r\n        commands.forEach((command) => {\r\n        // todo: make into one undo item\r\n\r\n            const undoCommand = commander.makeUndo(command)\r\n\r\n            // Store in one history item\r\n            historyItem.push({ command, undoCommand })\r\n\r\n            // Actually preform the command.\r\n            commander.execute(command)\r\n        })\r\n\r\n        // Add command to history\r\n        history.push(historyItem)\r\n        head += 1\r\n    }\r\n\r\n    // control the duration of the setXY undos with a timeout. Here's a default timeout.\r\n    const chainDuration = 30\r\n    let chainTimer = setTimeout(() => null, chainDuration)\r\n\r\n    self.undo = () => {\r\n        if (head === -1) return // There is no history\r\n\r\n        const last = history[head]\r\n        last.forEach((pair) => { commander.execute(pair.undoCommand) })\r\n\r\n        head -= 1 // Now we're in the past.\r\n\r\n        // If we're in a setXY chain, then continue with another undo after a pause.\r\n        const { undoCommand } = last[0]\r\n        if (undoCommand.props === undefined) return\r\n        if (undoCommand.props.isChain !== true) return\r\n        if (head === -1) return\r\n        const penUltimate = history[head][0]\r\n        if (penUltimate.undoCommand.name === undoCommand.name) {\r\n            // todo: make this only work for repeated setXY commands\r\n            // set timer and callback\r\n            clearTimeout(chainTimer)\r\n            chainTimer = setTimeout(self.undo, chainDuration)\r\n        }\r\n    }\r\n\r\n    self.redo = () => {\r\n        if (head === history.length - 1) return // Nothing to do\r\n\r\n        const next = history[head + 1]\r\n        next.forEach((pair) => commander.execute(pair.command))\r\n\r\n        head += 1 // Now we're in the future.\r\n\r\n        // If we're in a setXY chain, then continue with another redo after a pause.\r\n        const { command } = next[0]\r\n        if (command.props === undefined) return\r\n        if (command.props.isChain !== true) return\r\n        if (head === history.length - 1) return\r\n        const nextnext = history[head + 1][0]\r\n        if (nextnext.command.name === command.name) {\r\n            // todo: make this only work for repeated setXY commands\r\n            // set timer and callback\r\n            clearTimeout(chainTimer)\r\n            chainTimer = setTimeout(self.redo, chainDuration)\r\n        }\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport CommandStore from './CommandStore.js'\r\nimport ConfigKeeper from './ConfigKeeper.js'\r\nimport History from './History.js'\r\n\r\n/**\r\n * Both the command pattern and the memento pattern are used here.\r\n * Commands are performed to make changes to the mementos.\r\n *\r\n * Memento Pattern:\r\n *  Caretaker: ConfigKeeper class. It keeps config as a list of mementos.\r\n *  Originator: sender returned by CommandStore.addSender, used by menuItem, Candidate, Voter, etc\r\n *  Mementos: Config is a list of mementos. It's not a strict pattern.\r\n *  Also, the way we are storing commands is like storing mementos of a commands (not strictly).\r\n *\r\n * Command Pattern:\r\n * * Client: a CandidateCommander, VoterCommander, MenuItem, etc\r\n * * Command: Here, a command is a memento of a way to make a command.\r\n *     CommandStore stores lists of ways to make commands.\r\n *     mostly with a name and an action.\r\n *     Also, History stores a list of commands.\r\n *  Sender: A sender is returned by CommandStore.addSender.\r\n *  Receiver: a property of a Candidate, Voter, MenuItem, etc.\r\n *  For example, Candidate.setXY calls CandidateCommander.setXYSenderForList.go(id, value),\r\n *    which then calls Candidate.setXYAction to set Candidate.x and Candidate.y\r\n *\r\n * This isn't exactly either pattern.\r\n * Instead of commands with execute functions,\r\n * we use CommandStore, a class that stores lists of ways to make commands, given parameters.\r\n * Instead of mementos, the lists of ways to make commands act as mementos.\r\n *\r\n * Initially, the three component classes here were part of one larger class,\r\n * but hopefully it is easier to read code that is shorter and sticks to one context.\r\n * This class is similar to the mediator in the mediator pattern.\r\n *\r\n * References:\r\n * * [Command Pattern on refactoring.guru](https://refactoring.guru/design-patterns/command)\r\n * * [Memento Pattern on refactoring.guru](https://refactoring.guru/design-patterns/memento)\r\n * * [Mediator Pattern on refactoring.guru](https://refactoring.guru/design-patterns/mediator)\r\n * @constructor\r\n */\r\nexport default function Commander(comMessenger) {\r\n    const self = this\r\n\r\n    const commandStore = new CommandStore(self)\r\n    const configKeeper = new ConfigKeeper(self)\r\n    const history = new History(self)\r\n    comMessenger.addCommander(self)\r\n\r\n    /**\r\n     * A menu item or other object can add an action that it wants to execute with a value.\r\n     * The action can be performed by calling commander.do(command),\r\n     * where command has a name and value.\r\n     * @param {Object} args - argument catchall\r\n     * @param {String} args.name - The name of the action.\r\n     * @param {Function} args.action - The action function itself, which is called with a value.\r\n     */\r\n\r\n    // make a sender with a command and a way to do the command\r\n    self.addSender = (args) => {\r\n        configKeeper.addSender(args)\r\n        const sender = commandStore.addSender(args)\r\n        return sender\r\n    }\r\n\r\n    /** Say we want to change a value for the nth candidate.\r\n     * And say the nth candidate doesn't exist.\r\n     * Then we have to use an action which acts on the list of candidates,\r\n     * rather than the candidate itself.\r\n     */\r\n\r\n    /**\r\n     * Make a sender with a command and a way to do the command.\r\n     * This type of sender deals with lists.\r\n     * @param {Object} args\r\n     * @returns {Object} - methods command(id,value) and go(id,value)\r\n     */\r\n    self.addSenderForList = (args) => {\r\n        const sender = commandStore.addSenderForList(args)\r\n        sender.getCurrentValue = configKeeper.addSenderForList(args)\r\n        return sender\r\n    }\r\n\r\n    /**\r\n     * Actually execute the action.\r\n     * @param {Object} command -\r\n     */\r\n    self.execute = (command) => {\r\n        configKeeper.execute(command)\r\n        commandStore.execute(command)\r\n    }\r\n\r\n    // ConfigKeeper functions\r\n\r\n    self.makeUndo = configKeeper.makeUndo\r\n    self.passLoadConfig = configKeeper.passLoadConfig\r\n    self.passLoadCommands = configKeeper.passLoadCommands\r\n    self.getConfig = configKeeper.getConfig\r\n\r\n    self.loadConfig = (newConfig) => {\r\n        // the broadcast will call passLoadConfig\r\n        comMessenger.broadcastLoadConfig(newConfig, self)\r\n    }\r\n\r\n    self.loadCommands = (commands) => {\r\n        // the broadcast will call passLoadComands\r\n        comMessenger.broadCastLoadCommands(commands, self)\r\n    }\r\n\r\n    // History functions\r\n\r\n    /**\r\n     * Put a commandMessenger in the middle,\r\n     * between the command being asked for and the command being done.\r\n     * @param {Object} command - a command to do. See passDo.\r\n     */\r\n    self.do = (command) => {\r\n        // the broadcast will call passDo\r\n        comMessenger.broadcastDo(command, self)\r\n    }\r\n\r\n    self.doCommands = (commands) => {\r\n        // the broadcast will call passDoCommands\r\n        comMessenger.broadcastDoCommands(commands, self)\r\n    }\r\n\r\n    self.passDo = history.passDo\r\n    self.passDoCommands = history.passDoCommands\r\n    self.undo = history.undo\r\n    self.redo = history.redo\r\n    self.clearHistory = history.clearHistory\r\n}\r\n","/** @module */\r\n\r\nimport { orderedJsonStringify } from '../utilities/jsHelpers.js'\r\n\r\n/**\r\n * Add buttons for saving the configuration to a textbox.\r\n * @param {Layout} layout\r\n * @param {Commander} commander\r\n */\r\nexport default function addSaveConfigToText(layout, commander) {\r\n    const button = document.createElement('button')\r\n\r\n    button.className = 'button2'\r\n\r\n    button.innerText = 'Save Config To Text'\r\n\r\n    const text = document.createElement('textarea')\r\n\r\n    button.onclick = () => {\r\n        const config = commander.getConfig()\r\n        text.value = orderedJsonStringify(config)\r\n    }\r\n\r\n    const clearDiv = document.createElement('div')\r\n\r\n    const div = document.createElement('div')\r\n    div.appendChild(button)\r\n    div.appendChild(clearDiv)\r\n    div.appendChild(text)\r\n\r\n    layout.newElement('saveConfigToText', div)\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Add buttons for saving the configuration to a link.\r\n * @param {Layout} layout\r\n * @param {Commander} commander\r\n */\r\nexport default function addSaveConfigToLink(layout, commander, sandboxURL) {\r\n    const button = document.createElement('button')\r\n    button.className = 'button2'\r\n    button.innerText = 'Save Link'\r\n\r\n    const button2 = document.createElement('button')\r\n    button2.className = 'button2'\r\n    button2.innerText = 'Copy Link to Clipboard'\r\n\r\n    const text = document.createElement('textarea')\r\n\r\n    button.onclick = () => {\r\n        const link = getLink()\r\n        text.value = link\r\n    }\r\n    button2.onclick = () => {\r\n        const link = getLink()\r\n        navigator.clipboard.writeText(link)\r\n    }\r\n    function getLink() {\r\n        const config = commander.getConfig()\r\n        const string = JSON.stringify(config)\r\n        const encoded = encodeURIComponent(string)\r\n        const params = new URLSearchParams({ a: encoded })\r\n        const search = params.toString()\r\n        const currentUrlFolder = getFolder()\r\n\r\n        const link = `${currentUrlFolder}/${sandboxURL}?${search}`\r\n        return link\r\n    }\r\n    function getFolder() {\r\n        const sp = document.location.href.split('/')\r\n        const sl = sp.slice(0, sp.length - 1)\r\n        const folder = sl.join('/')\r\n        return folder\r\n    }\r\n\r\n    const clearDiv = document.createElement('div')\r\n\r\n    const div = document.createElement('div')\r\n    div.appendChild(button)\r\n    div.appendChild(button2)\r\n    div.appendChild(clearDiv)\r\n    div.appendChild(text)\r\n\r\n    layout.newElement('saveConfigToLink', div)\r\n}\r\n","/** @module */\r\n\r\nimport Changes from './Changes.js'\r\nimport Screen from './Screen.js'\r\nimport addSVGOutput from './addSVGOutput.js'\r\nimport Menu from '../menu/Menu.js'\r\nimport Sim from '../sim/Sim.js'\r\nimport Layout from './Layout.js'\r\nimport Commander from '../command/Commander.js'\r\nimport addUndo from '../command/addUndo.js'\r\nimport addSaveConfigToText from '../command/addSaveConfigToText.js'\r\nimport addLoadConfigText from '../command/loadConfigText.js'\r\nimport addSaveConfigToLink from '../command/addSaveConfigToLink.js'\r\n\r\n/**\r\n * Set up a user interface to run a simulation.\r\n * @param {Object} config - An object containing commands. A command is a {name,value} pair.\r\n */\r\nexport default function sandbox(config, comMessenger, sandboxURL) {\r\n    // manage dependent calculations because we only want to do calculations if we need to\r\n    const changes = new Changes()\r\n\r\n    const layout = new Layout([\r\n        'menu',\r\n        'simControlsLabel',\r\n        'undo',\r\n        'redo',\r\n        'addVoter',\r\n        'addCandidate',\r\n        'addCandidateDistribution',\r\n        'screenWrap',\r\n        'maps',\r\n        'saveConfigToLink',\r\n        'saveConfigToText',\r\n        'loadConfigText',\r\n        'svgUIDiv',\r\n    ])\r\n\r\n    const commander = new Commander(comMessenger)\r\n\r\n    const menu = new Menu(changes, layout, commander)\r\n\r\n    addUndo(layout, commander)\r\n\r\n    addSaveConfigToLink(layout, commander, sandboxURL)\r\n\r\n    addSaveConfigToText(layout, commander)\r\n\r\n    addLoadConfigText(layout, commander)\r\n\r\n    const screen = new Screen(300, 300, layout)\r\n\r\n    addSVGOutput(screen, draw, layout)\r\n\r\n    const sim = new Sim(screen, menu, changes, commander, layout)\r\n\r\n    commander.loadConfig(config)\r\n    commander.clearHistory()\r\n\r\n    const div = layout.makeComponent()\r\n\r\n    window.requestAnimationFrame(gameLoop)\r\n\r\n    return div\r\n\r\n    function gameLoop() {\r\n        update()\r\n        drawForeground()\r\n        window.requestAnimationFrame(gameLoop)\r\n    }\r\n\r\n    function update() {\r\n        sim.update()\r\n    }\r\n\r\n    function drawForeground() {\r\n        screen.clearForeground()\r\n        sim.renderForeground()\r\n    }\r\n\r\n    function draw() {\r\n        screen.clear()\r\n        screen.clearMaps()\r\n        screen.clearForeground()\r\n        sim.render()\r\n        sim.renderForeground()\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Add buttons to layout for undo and redo, and connect them to commander for functionality.\r\n * @param {Layout} layout\r\n * @param {Commander} commander\r\n */\r\nexport default function addUndo(layout, commander) {\r\n    const undoButton = document.createElement('button')\r\n    const redoButton = document.createElement('button')\r\n\r\n    undoButton.className = 'button2'\r\n    redoButton.className = 'button2'\r\n\r\n    undoButton.innerText = 'Undo'\r\n    redoButton.innerText = 'Redo'\r\n\r\n    undoButton.onclick = commander.undo\r\n    redoButton.onclick = commander.redo\r\n\r\n    layout.newElement('undo', undoButton)\r\n    layout.newElement('redo', redoButton)\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Add buttons to layout for undo and redo, and connect them to commander for functionality.\r\n * @param {Layout} layout\r\n * @param {Commander} commander\r\n */\r\nexport default function addLoadConfigText(layout, commander) {\r\n    const button = document.createElement('button')\r\n\r\n    button.className = 'button2'\r\n\r\n    button.innerText = 'Load Config Text'\r\n\r\n    const text = document.createElement('textarea')\r\n\r\n    button.onclick = () => {\r\n        if (text.value === '') return\r\n        const config = JSON.parse(text.value)\r\n        commander.loadConfig(config)\r\n    }\r\n\r\n    const clearDiv = document.createElement('div')\r\n\r\n    const div = document.createElement('div')\r\n    div.appendChild(button)\r\n    div.appendChild(clearDiv)\r\n    div.appendChild(text)\r\n\r\n    layout.newElement('loadConfigText', div)\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Check if the URL is giving a configuration.\r\n * @returns {Object} - Property yes means we have a config to use from the URL.\r\n */\r\nexport default function checkURL() {\r\n    const { search } = window.location\r\n    const params = new URLSearchParams(search)\r\n    const yes = params.has('a')\r\n\r\n    const config = yes ? configFromParams(params) : {}\r\n\r\n    return { yes, config }\r\n}\r\n\r\nfunction configFromParams(params) {\r\n    const encoded = params.get('a')\r\n    const string = decodeURIComponent(encoded)\r\n    const config = JSON.parse(string)\r\n    return config\r\n}\r\n","/** @module */\r\n\r\nimport checkURL from '../command/checkURL.js'\r\nimport ComMessenger from '../command/ComMessenger.js'\r\nimport sandbox from './sandbox.js'\r\n\r\n/** Find all the divs of class \"sandbox\".\r\n * Add the sandbox as a neighbor under the same parent. */\r\nexport default function addSingleSandboxes() {\r\n    const targets = Array.from(document.getElementsByClassName('sandbox'))\r\n    targets.forEach((target) => {\r\n        const hasConfig = target.dataset.config !== undefined\r\n        const targetConfig = (hasConfig) ? JSON.parse(target.dataset.config) : {}\r\n        const cu = checkURL()\r\n        const config = (cu.yes) ? cu.config : targetConfig\r\n\r\n        const hasSandboxURL = target.dataset.sandboxurl !== undefined\r\n        const sandboxURL = hasSandboxURL ? target.dataset.sandboxurl : ''\r\n\r\n        const comMessenger = new ComMessenger()\r\n        const div = sandbox(config, comMessenger, sandboxURL)\r\n        const parent = target.parentNode\r\n        parent.appendChild(div)\r\n    })\r\n}\r\n","/** @module */\r\n\r\nimport doubleSandbox from './doubleSandbox.js'\r\n\r\n/** Find all the divs of class \"double_sandbox\".\r\n * Add the double_sandbox as a neighbor under the same parent. */\r\nexport default function addDoubleSandboxes() {\r\n    const targets = Array.from(document.getElementsByClassName('double_sandbox'))\r\n    targets.forEach((target) => {\r\n        const hasConfig = target.dataset.config !== undefined\r\n        const config = (hasConfig) ? JSON.parse(target.dataset.config) : {}\r\n\r\n        const hasSandboxURL = target.dataset.sandboxurl !== undefined\r\n        const sandboxURL = hasSandboxURL ? target.dataset.sandboxurl : ''\r\n\r\n        const div = doubleSandbox(config, sandboxURL)\r\n        const parent = target.parentNode\r\n        parent.appendChild(div)\r\n    })\r\n}\r\n","/** @module */\r\n\r\nimport ComMessenger from '../command/ComMessenger.js'\r\nimport sandbox from './sandbox.js'\r\n\r\n/**\r\n * Makes Two sandboxes and links their commands together.\r\n * @param {Object} config - To pass to commander to set the initial configuration of the sim.\r\n * @param {String} sandboxURL - String to add to the current url directory to get to the sandbox.\r\n * @returns {HTMLElement} - div containing the two sandboxes.\r\n */\r\nexport default function doubleSandbox(config, sandboxURL) {\r\n    const comMessenger = new ComMessenger()\r\n\r\n    const divLink = document.createElement('button')\r\n    divLink.className = 'button2'\r\n    divLink.innerText = 'linked'\r\n    divLink.style['vertical-align'] = 'middle'\r\n    divLink.style['min-width'] = '70px'\r\n    divLink.style.margin = '5px'\r\n    const toggle = () => {\r\n        if (divLink.innerText === 'linked') {\r\n            divLink.innerText = 'unlinked'\r\n            comMessenger.setLinked(false)\r\n        } else {\r\n            divLink.innerText = 'linked'\r\n            comMessenger.setLinked(true)\r\n        }\r\n    }\r\n    divLink.onclick = toggle\r\n\r\n    const div1 = sandbox(config, comMessenger, sandboxURL)\r\n    const div2 = sandbox(config, comMessenger, sandboxURL)\r\n    div1.style.display = 'inline-block'\r\n    div2.style.display = 'inline-block'\r\n\r\n    div1.style['vertical-align'] = 'top'\r\n    div2.style['vertical-align'] = 'top'\r\n\r\n    const div = document.createElement('div')\r\n    div.appendChild(div1)\r\n    div.appendChild(divLink)\r\n    div.appendChild(div2)\r\n    return div\r\n}\r\n"],"names":["this","linked","commanders","protect","setLinked","value","addCommander","commander","push","broadcastDo","command","originCommander","forEach","com","passDo","broadcastDoCommands","commands","passDoCommands","broadcastLoadConfig","newConfig","passLoadConfig","broadCastLoadCommands","passLoadCommands","self","changes","add","changeList","c","check","n","includes","checkNone","length","clear","splice","handlers","start","move","end","touchmove","touchstart","touchend","set","eHandlers","Object","assign","w","h","layout","width","height","canvas","document","createElement","setAttribute","ctx","getContext","tooltips","foreground","fctx","maps","mctx","clearDiv","wrap","appendChild","newElement","noBuffers","pixelRatio","context","backingStore","backingStorePixelRatio","webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio","window","devicePixelRatio","$705ca8a2f34171f8$var$getPixelRatio","style","setMapsHeight","h3","Math","round","heightBrowser","scale","clearRect","clearForeground","clearMaps","setCtx","setFCtx","setMCtx","setNoBuffers","showMaps","display","hideMaps","eventHandlers","$506b705d01454b72$export$2e2bcd8739ae039","onmousedown","e","onmousemove","onmouseup","addEventListener","current","$71a639b9e6c25c65$var$STYLES","$71a639b9e6c25c65$var$ctx","$71a639b9e6c25c65$var$CanvasGradient","$71a639b9e6c25c65$var$CanvasPattern","$71a639b9e6c25c65$var$namedEntities","$71a639b9e6c25c65$var$format","str","args","i","keys","replace","RegExp","$71a639b9e6c25c65$var$randomString","holder","randomstring","Error","chars","floor","random","$71a639b9e6c25c65$var$getDominantBaseline","textBaseline","mapping","alphabetic","hanging","top","bottom","middle","items","radix","entity","base10","lookup","split","parseInt","$71a639b9e6c25c65$var$createNamedToNumberedLookup","strokeStyle","svgAttr","svg","apply","fillStyle","lineCap","lineJoin","miterLimit","lineWidth","shadowColor","shadowOffsetX","shadowOffsetY","textAlign","lineDash","gradientNode","__root","__ctx","prototype","addColorStop","offset","color","matches","stop","__createElement","indexOf","exec","r","g","b","pattern","o","defaultOptions","enableMirroring","arguments","options","undefined","__document","__canvas","__setDefaultStyles","__stack","__getStyleState","__groupStack","createElementNS","setAttributeNS","__ids","__defs","__currentElement","elementName","properties","resetFill","key","element","__applyStyleState","styleState","__applyStyleToCurrentElement","type","__currentElementsToStyle","currentStyleGroup","children","node","id","childNodes","getAttribute","currentElement","attr","opacity","globalAlpha","__closestGroupOrSvg","nodeName","parentNode","getSerializedSvg","fixNamedEntities","regexp","serialized","XMLSerializer","serializeToString","test","getSvg","save","group","parent","restore","pop","state","__addTransform","t","__applyCurrentDefaultPath","transform","x","y","rotate","angle","degrees","PI","cx","translate","a","d","f","beginPath","path","__currentDefaultPath","__currentPosition","console","error","__addPathCommand","moveTo","closePath","lineTo","bezierCurveTo","cp1x","cp1y","cp2x","cp2y","quadraticCurveTo","cpx","cpy","$71a639b9e6c25c65$var$normalize","vector","len","sqrt","arcTo","x1","y1","x2","y2","radius","x0","y0","unit_vec_p1_p0","unit_vec_p1_p2","cos","theta","acos","abs","unit_vec_p1_origin","len_p1_origin","sin","x3","y3","unit_vec_origin_start_tangent","unit_vec_origin_end_tangent","getAngle","startAngle","endAngle","arc","stroke","fill","rect","fillRect","strokeRect","__clearCanvas","rootGroup","removeChild","createLinearGradient","grad","gradientUnits","createRadialGradient","r0","r1","cy","fx","fy","__parseFont","fontPart","font","data","size","family","weight","decoration","__fontHref","href","__wrapTextLink","__applyText","text","action","textElement","left","right","center","createTextNode","fillText","strokeText","measureText","counterClockwise","endX","endY","startX","startY","sweepFlag","largeArcFlag","diff","clip","clipPath","newGroup","drawImage","dx","dy","dw","dh","sw","sh","defs","svgImage","Array","slice","call","image","sx","sy","screen","draw","svgUIDiv","button","className","innerText","onclick","old","oldF","svgCtx","oldM","svgMCtx","mSvgDiv","svgHideButton","hidden","svgDiv","innerHTML","downloadLink","url","encodeURIComponent","outputSVG","mSvg","mDownloadLink","mUrl","outputMSVG","download","margin","$71a639b9e6c25c65$export$2e2bcd8739ae039","buttonConfig","onChoose","config","name","nameIsHTML","dom","fixMargin","max","marginRight","realname","onClick","turnOff","isOn","turnOn","config1","makeData","buttonConfigs","doMakeData","labelName","label","labelIsHTML","isCheckbox","isCheckboxBool","justButton","buttonHidden","buttonDOMByValue","init","buttons","buttonsByName","labelDOM","classList","toggle","conf","$d019958dda7398e8$export$2e2bcd8739ae039","onToggle","i1","selected","updateNames","data2","redraw","configureHidden","buttonName","entries","buttonData","setTimeout","highlight","propName","propValue","ibu","bu","ibu1","theButton","filter","object","prop","setProp","change","list","sender","go","select","addSender","currentValue","configure","choose","$4088c71a26df2b7b$export$2e2bcd8739ae039","$ced2438c3869b330$var$buttonWidth","numButtons","divMenu","addMenuItem","choice","menuItem","$ced2438c3869b330$export$2e2bcd8739ae039","candidateDistributions","cdf","proportion","map","cd","shape1","sumProportion","reduce","p","pmf","$0973293d85aa3bf4$var$getCDF","samplePoint","iDist","random1","findIndex","$0973293d85aa3bf4$var$randomDistribution","isGaussian","densityProfile","$0973293d85aa3bf4$var$sampleGaussian","$0973293d85aa3bf4$var$randomInsideInterval","$0973293d85aa3bf4$var$samplePoint1","X","R","u1","u2","log","areasProportion","shape2","sumAreasProportion","$26e74920c0ce0e2a$var$getCDF","$26e74920c0ce0e2a$var$randomDistribution","Y","$26e74920c0ce0e2a$var$randomInsideCircle","$26e74920c0ce0e2a$var$samplePoint1","sim","simCanDns","rendererMaker","render","newCandidate","simCanDn","graphic","setRenderer","getSimCandidateDistributions","canDn","exists","getCandidateDistributions","getCandidateDistributionsAll","update","startSampler","canDnsList","dimensions","election","CDnSampler","$0973293d85aa3bf4$export$2e2bcd8739ae039","$26e74920c0ce0e2a$export$2e2bcd8739ae039","sampler","updateXY","renderer","renderForeground","showGhosts","renderForegroundAll","renderForegroundExisting","$6bae94082fec84ac$var$defaultSetTimout","$6bae94082fec84ac$var$defaultClearTimeout","$6bae94082fec84ac$var$globalContext","$6bae94082fec84ac$var$cachedSetTimeout","$6bae94082fec84ac$var$cachedClearTimeout","$6bae94082fec84ac$var$runTimeout","fun","clearTimeout","$6bae94082fec84ac$var$currentQueue","$6bae94082fec84ac$var$queue","$6bae94082fec84ac$var$draining","$6bae94082fec84ac$var$queueIndex","$6bae94082fec84ac$var$cleanUpNextTick","concat","$6bae94082fec84ac$var$drainQueue","timeout","run","marker","$6bae94082fec84ac$var$runClearTimeout","$6bae94082fec84ac$var$Item","array","$6bae94082fec84ac$var$noop","$6bae94082fec84ac$var$on","$6bae94082fec84ac$var$addListener","$6bae94082fec84ac$var$once","$6bae94082fec84ac$var$off","$6bae94082fec84ac$var$removeListener","$6bae94082fec84ac$var$removeAllListeners","$6bae94082fec84ac$var$emit","$6bae94082fec84ac$var$performance","performance","$6bae94082fec84ac$var$performanceNow","now","mozNow","msNow","oNow","webkitNow","Date","getTime","$6bae94082fec84ac$var$startTime","$6bae94082fec84ac$var$process","nextTick","title","browser","env","NODE_ENV","argv","version","versions","on","addListener","once","off","removeListener","removeAllListeners","emit","binding","cwd","chdir","dir","umask","hrtime","previousTimestamp","clocktime","seconds","nanoseconds","platform","release","uptime","$6bae94082fec84ac$export$cea96571ebbff9dd","None","amount","In","Out","InOut","pow","s","Bounce","time","bind","$6bae94082fec84ac$export$eb2fcfdbd7ba97d4","_tweens","_tweensAddedDuringUpdate","getAll","_this","tweenId","removeAll","tween","getId","remove","preserve","$6bae94082fec84ac$export$461939dd4422153","tweenIds","autoStart","$6bae94082fec84ac$export$b0cc4f9860136880","Linear","v","k","m","fn","Utils","pw","bn","Bernstein","CatmullRom","p0","p1","fc","Factorial","p2","p3","v0","v1","t2","$6bae94082fec84ac$export$edde1bcb1b2b310e","nextId","_nextId","$6bae94082fec84ac$export$208a41d6b4e37b97","_object","_group","$6bae94082fec84ac$var$mainGroup","_isPaused","_pauseStart","_valuesStart","_valuesEnd","_valuesStartRepeat","_duration","_initialRepeat","_repeat","_yoyo","_isPlaying","_reversed","_delayTime","_startTime","_easingFunction","_interpolationFunction","_chainedTweens","_onStartCallbackFired","_id","_isChainStopped","_goToEnd","isPlaying","isPaused","to","duration","create","property","_swapEndStartRepeatValues","parseFloat","_setupProperties","startValue","startValueIsArray","isArray","propType","isInterpolationList","endValues","_handleRelativeValue","reverse","stopChainedTweens","_onStopCallback","Infinity","pause","resume","numChainedTweens","delay","repeat","times","repeatDelay","_repeatDelayTime","yoyo","easing","easingFunction","interpolation","interpolationFunction","chain","tweens","_i","onStart","callback","_onStartCallback","onUpdate","_onUpdateCallback","onRepeat","_onRepeatCallback","onComplete","_onCompleteCallback","onStop","endTime","elapsed","_updateProperties","startIsArray","endIsArray","charAt","tmp","endValue","trueW","trueH","pickUp","tweenSq","drop","candidateDn","square","$d61ebe615d81979b$export$2e2bcd8739ae039","dragm","$29f573909a151f77$export$2e2bcd8739ae039","newSquareHandle","newVoterSim","voterSim","getVoterShapes","voterShape","getVoterSims","updateVoters","updateGraphic","voterSimsExisting","renderBackground","$11eb5e0ad93fc4ca$export$a2f18a0619b13ed4","textsize","lw","alpha","$11eb5e0ad93fc4ca$export$120cfc2a1d7ff906","toFixed","$51d4c6038662af31$export$d02631cccf789723","$51d4c6038662af31$export$88483c833f74f910","JSON","parse","stringify","$51d4c6038662af31$var$sortObjByKey","sort","$51d4c6038662af31$export$f6e9b6133dd229d9","mean","sd","exp","$51d4c6038662af31$export$e94e7ee3b047a94d","ERF_A","down","ratio","expofun","radical","sign","$51d4c6038662af31$var$erf","$51d4c6038662af31$export$7f57f51729968d3b","sColor","$51d4c6038662af31$export$e410eba367ce792b","min","iClosest","$51d4c6038662af31$export$6e0413888cd9bad3","iMax","$51d4c6038662af31$export$7d15b64cf5a3a4c4","$51d4c6038662af31$export$f67cbcd1c395127c","$51d4c6038662af31$export$1c33355361fd1c67","drag","draggables","grabCanvas","isSquare","newCircleHandle","isCircle","event","target","closest","mouse","getMouse","extra","isTouch","nd","hitList","hitTest","distances2","iDraggableClosest","d1","iDragging","isDragging","offX","offY","dataset","cursor","couldBeClick","startClickDetect","preventDefault","stopPropagation","dragging","setXY","xDist","startPos","yDist","moveClickDetect","endClickDetect","passTouch","getBoundingClientRect","changedTouches","clientX","clientY","pass","$ddb4de2d334b0195$export$2e2bcd8739ae039","enter","exit","testVoteSim","trueR","circle","$8c57e2518d5c1e63$export$2e2bcd8739ae039","$c77c3a04379e6a05$export$2e2bcd8739ae039","$4a707d0bede71212$var$F2","$4a707d0bede71212$var$G2","$4a707d0bede71212$var$G3","$4a707d0bede71212$var$F4","$4a707d0bede71212$var$G4","$4a707d0bede71212$var$grad3","Float32Array","$4a707d0bede71212$var$grad4","$4a707d0bede71212$export$7cef8d54b4fb09be","randomOrSeed","$4a707d0bede71212$var$alea","$4a707d0bede71212$export$98cd52c6119fe283","perm","Uint8Array","permMod12","noise2D","n0","n1","n2","j","j1","ii","jj","t0","gi0","t1","gi1","gi2","noise3D","z","n3","z0","k1","j2","k2","i2","z1","z2","z3","kk","t3","gi3","noise4D","n4","l","w0","rankx","ranky","rankz","rankw","l1","l2","i3","j3","k3","l3","w1","w2","x4","y4","z4","w4","ll","w3","t4","gi4","nx","ny","sn","genNoise","noiseWidth","noiseHeight","xAmp","yAmp","simplexX","simplexY","$c913a56498196062$var$zeros","sumX","sumY","$c913a56498196062$var$range","ix","iy","noiseX","noiseY","meanX","meanY","$c913a56498196062$export$8cea35b328240292","$47bb62cfe9482204$export$7c04771a442b0848","polygon","$47bb62cfe9482204$export$31875faf3fe0de4d","$c198e5ea557823b0$var$splitter","$c198e5ea557823b0$var$sum","elen","flen","Q","Qnew","hh","bvirt","enow","fnow","eindex","findex","hindex","$c198e5ea557823b0$var$vec","Float64Array","$c198e5ea557823b0$var$B","$c198e5ea557823b0$var$C1","$c198e5ea557823b0$var$C2","$c198e5ea557823b0$var$D","$c198e5ea557823b0$var$u","$c198e5ea557823b0$var$orient2d","ax","ay","bx","by","detleft","detright","det","detsum","acxtail","acytail","bcxtail","bcytail","ahi","alo","bhi","blo","_j","_0","s1","s0","u3","acx","bcx","acy","bcy","$c198e5ea557823b0$var$estimate","errbound","C1len","C2len","Dlen","$c198e5ea557823b0$var$orient2dadapt","$c198e5ea557823b0$var$EPSILON","$c198e5ea557823b0$var$EDGE_STACK","Uint32Array","$c198e5ea557823b0$var$Delaunator","points","getX","$c198e5ea557823b0$var$defaultGetX","getY","$c198e5ea557823b0$var$defaultGetY","coords","maxTriangles","_triangles","_halfedges","Int32Array","_hashSize","ceil","_hullPrev","_hullNext","_hullTri","_hullHash","_ids","_dists","hullPrev","hullNext","hullTri","hullHash","minX","minY","maxX","maxY","i0","minDist","$c198e5ea557823b0$var$dist","i0x","i0y","i4","i1x","i1y","minRadius","i5","$c198e5ea557823b0$var$circumradius","i2x","i2y","$c198e5ea557823b0$var$quicksort","hull","i8","d0","subarray","triangles","halfedges","ex","ey","bl","cl","$c198e5ea557823b0$var$circumcenter","_cx","_cy","i6","_hullStart","hullSize","_hashKey","trianglesLen","_addTriangle","xp","yp","q","_legalize","i7","$c198e5ea557823b0$var$pseudoAngle","ar","a0","al","$c198e5ea557823b0$var$inCircle","pr","pl","hbl","_link","br","b0","px","py","bp","cp","ids","dists","temp","tempDist","$c198e5ea557823b0$var$swap","arr","$c198e5ea557823b0$var$epsilon$1","$c198e5ea557823b0$var$Path","_x0","_y0","_x1","_y1","_","$c198e5ea557823b0$export$20f0351992a349","constructor","delaunay","xmin","ymin","xmax","ymax","_circumcenters","vectors","_init","circumcenters","ab","i9","buffer","inedges","ti","tj","xi","yi","xj","yj","_renderSegment","h0","h1","i10","_project","_clip","i11","cell","cellPolygon","index","$c198e5ea557823b0$var$Polygon","renderCell","S","c0","_regioncode","c1","_clipSegment","_step","ci","neighbors","cj","loop","ai","li","aj","lj","_cell","e0","V","_clipInfinite","_clipFinite","P","e1","sx0","sy0","sx1","sy1","_edgecode","_edge","contains","vx0","vy0","vxn","vyn","from","unshift","i12","vx","vy","$c198e5ea557823b0$var$tau","$c198e5ea557823b0$var$pow","$c198e5ea557823b0$var$pointX","$c198e5ea557823b0$var$pointY","$c198e5ea557823b0$var$jitter","static","that","$c198e5ea557823b0$export$42fc3f3b24093a06","$c198e5ea557823b0$var$flatArray","$c198e5ea557823b0$var$flatIterable","_delaunator","$c198e5ea557823b0$var$collinear","collinear","bounds","hypot","i13","hullIndex","_hullIndex","dt","dc","renderHull","trianglePolygon","renderTriangle","tolFraction","voronoi","polygons","centroids","$b88c6a1775da370c$var$randomPoints","converged","tol","$b88c6a1775da370c$var$relax","every","point","$b88c6a1775da370c$var$distance2","subject0","closed","$1c9b910f94fe5a4d$var$polygonClosed","subject","input","$1c9b910f94fe5a4d$var$lineOrient","$1c9b910f94fe5a4d$var$lineIntersect","bax","bay","dcx","dcy","$fbefcda9c3d500d6$var$makeSquare","make","polygonAreas","totalArea","census","districtMaker","gx","gy","iDistrict","overlap","$1c9b910f94fe5a4d$export$2e2bcd8739ae039","$fbefcda9c3d500d6$export$2e2bcd8739ae039","renderVoronoi","geoMapWidth","geoMapHeight","renderVoronoiGeneral","renderAreaText","renderVoronoiColors","colors","textFunction","scaleX","scaleY","$48e6e04bfb61f2eb$export$2e2bcd8739ae039","$ea87173ebe7c496f$export$2e2bcd8739ae039","geoNoise","$c913a56498196062$export$2e2bcd8739ae039","voterSims","updateDistricts","updateFullSet","updateVotersByDistrict","updateVotersByTract","vb","rowNoise","cellNoise","xNoise","yNoise","flat","gf","sigma","amp","pa","gaussianPath","renderAt","newX","newY","renderCenterAt2","voterSimList","candidateDnSimList","sum","total","VoterRenderer","$99204f57f5b88613$export$2e2bcd8739ae039","$7c4285cda38df084$export$2e2bcd8739ae039","addResult","pointsChanged","newPoints","nk","kernel","kernelsize","updatePoints","norm","doPath","renderCans","$1f90feea12d27ba8$export$43caf9889c228507","step","$a65e147dfc6348df$var$e10","$a65e147dfc6348df$var$e5","$a65e147dfc6348df$var$e2","$a65e147dfc6348df$var$ticks","count","ticks","power","LN10","$a65e147dfc6348df$var$tickIncrement","isFinite","$a65e147dfc6348df$var$tickStep","step0","step1","$a65e147dfc6348df$var$thresholdSturges","values","valueof","$a65e147dfc6348df$var$count","LN2","$a65e147dfc6348df$var$slice","$a65e147dfc6348df$var$ascending","$a65e147dfc6348df$var$constant","$a65e147dfc6348df$var$contains","ring","hole","$a65e147dfc6348df$var$ringContains","pi","pj","$a65e147dfc6348df$var$segmentContains","$a65e147dfc6348df$var$collinear","$a65e147dfc6348df$var$noop","$a65e147dfc6348df$var$cases","$a65e147dfc6348df$export$aae0b63ac47b2dd9","threshold","smooth","smoothLinear","tz","$a65e147dfc6348df$var$extent","ts","contour","holes","fragmentByStart","fragmentByEnd","stitch","line","startIndex","endIndex","isorings","area","$a65e147dfc6348df$var$area","coordinates","xt","yt","_1","thresholds","$a65e147dfc6348df$var$blurX","source","sr","$a65e147dfc6348df$var$blurY","$a65e147dfc6348df$var$defaultX","$a65e147dfc6348df$var$defaultY","$a65e147dfc6348df$var$defaultWeight","$c32801bdab290c98$var$Adder","_partials","_n","hi","lo","valueOf","$c32801bdab290c98$var$merge","arrays","$c32801bdab290c98$var$flatten","$c32801bdab290c98$var$epsilon","$c32801bdab290c98$var$epsilon2","$c32801bdab290c98$var$pi","$c32801bdab290c98$var$halfPi","$c32801bdab290c98$var$quarterPi","$c32801bdab290c98$var$tau","$c32801bdab290c98$var$radians","$c32801bdab290c98$var$abs","$c32801bdab290c98$var$atan","atan","$c32801bdab290c98$var$atan2","atan2","$c32801bdab290c98$var$cos","$c32801bdab290c98$var$exp","$c32801bdab290c98$var$log","$c32801bdab290c98$var$sin","$c32801bdab290c98$var$sign","$c32801bdab290c98$var$sqrt","$c32801bdab290c98$var$tan","tan","$c32801bdab290c98$var$acos","$c32801bdab290c98$var$asin","asin","$c32801bdab290c98$var$noop","$c32801bdab290c98$var$streamGeometry","geometry","stream","$c32801bdab290c98$var$streamGeometryType","hasOwnProperty","$c32801bdab290c98$var$streamObjectType","Feature","FeatureCollection","features","Sphere","sphere","Point","MultiPoint","LineString","$c32801bdab290c98$var$streamLine","MultiLineString","Polygon","$c32801bdab290c98$var$streamPolygon","MultiPolygon","GeometryCollection","geometries","coordinate","lineStart","lineEnd","polygonStart","polygonEnd","$c32801bdab290c98$export$7feeb5ff0f185fde","$c32801bdab290c98$var$cartesian","spherical","lambda","phi","cosPhi","$c32801bdab290c98$var$cartesianCross","$c32801bdab290c98$var$cartesianNormalizeInPlace","$c32801bdab290c98$var$rotationIdentity","$c32801bdab290c98$var$clipBuffer","lines","rejoin","shift","result","$c32801bdab290c98$var$pointEqual","$c32801bdab290c98$var$Intersection","other","entry","$c32801bdab290c98$var$clipRejoin","segments","compareIntersection","startInside","$c32801bdab290c98$export$67a8c6c8f410b4ac","segment","$c32801bdab290c98$var$link","isSubject","$c32801bdab290c98$var$longitude","$c32801bdab290c98$var$polygonContains","sinPhi","normal","winding","point0","lambda0","phi0","sinPhi0","cosPhi0","lambda1","sinPhi1","cosPhi1","point1","phi1","delta","absDelta","antimeridian","intersection","phiArc","$c32801bdab290c98$var$clip","pointVisible","clipLine","sink","ringBuffer","ringSink","polygonStarted","pointRing","ringStart","ringEnd","$c32801bdab290c98$var$compareIntersection","pointLine","clean","ringSegments","$c32801bdab290c98$var$validSegment","invert","NaN","sign0","sign1","sinLambda0Lambda1","$c32801bdab290c98$var$clipAntimeridianIntersect","direction","$c32801bdab290c98$var$x00","$c32801bdab290c98$var$y00","$c32801bdab290c98$var$x0$1","$c32801bdab290c98$var$y0$1","$c32801bdab290c98$var$identity","$c32801bdab290c98$var$areaSum$1","$c32801bdab290c98$var$areaRingSum$1","$c32801bdab290c98$var$areaStream$1","$c32801bdab290c98$var$areaRingStart$1","$c32801bdab290c98$var$areaRingEnd$1","$c32801bdab290c98$export$a514eb22fe5f7d4","$c32801bdab290c98$var$areaPointFirst$1","$c32801bdab290c98$var$areaPoint$1","$c32801bdab290c98$var$x0$2","$c32801bdab290c98$var$y0$2","$c32801bdab290c98$var$x1","$c32801bdab290c98$var$y1","$c32801bdab290c98$var$boundsStream$1","$c32801bdab290c98$export$b6b1d97c43a180f2","$c32801bdab290c98$var$x00$1","$c32801bdab290c98$var$y00$1","$c32801bdab290c98$var$x0$3","$c32801bdab290c98$var$y0$3","$c32801bdab290c98$var$X0$1","$c32801bdab290c98$var$Y0$1","$c32801bdab290c98$var$Z0$1","$c32801bdab290c98$var$X1$1","$c32801bdab290c98$var$Y1$1","$c32801bdab290c98$var$Z1$1","$c32801bdab290c98$var$X2$1","$c32801bdab290c98$var$Y2$1","$c32801bdab290c98$var$Z2$1","$c32801bdab290c98$var$centroidStream$1","$c32801bdab290c98$var$centroidPoint$1","$c32801bdab290c98$var$centroidLineStart$1","$c32801bdab290c98$var$centroidLineEnd$1","$c32801bdab290c98$var$centroidRingStart$1","$c32801bdab290c98$var$centroidRingEnd$1","$c32801bdab290c98$export$8d3c34225495dcd8","$c32801bdab290c98$var$centroidPointFirstLine","$c32801bdab290c98$var$centroidPointLine","$c32801bdab290c98$var$centroidPointFirstRing","$c32801bdab290c98$var$centroidPointRing","$c32801bdab290c98$var$PathContext","_context","_radius","pointRadius","_line","_point","$c32801bdab290c98$var$lengthRing","$c32801bdab290c98$var$x00$2","$c32801bdab290c98$var$y00$2","$c32801bdab290c98$var$x0$4","$c32801bdab290c98$var$y0$4","$c32801bdab290c98$var$lengthSum$1","$c32801bdab290c98$var$lengthStream$1","$c32801bdab290c98$var$lengthPointFirst$1","$c32801bdab290c98$var$lengthPoint$1","$c32801bdab290c98$export$1dbe5ce141429a5b","$c32801bdab290c98$var$PathString","_string","$c32801bdab290c98$var$circle$1","$c32801bdab290c98$var$transformer","methods","$c32801bdab290c98$var$TransformStream","_circle","join","$c32801bdab290c98$var$azimuthalRaw","$c32801bdab290c98$var$azimuthalInvert","sc","cc","$c32801bdab290c98$export$364d0d7bd760d802","cxcy","$c32801bdab290c98$export$ec8e6eb8772c844","$c32801bdab290c98$export$51dae5ed5e75d309","$c32801bdab290c98$export$f44d0e55ba8677a1","$c32801bdab290c98$var$A1","$c32801bdab290c98$var$A2","$c32801bdab290c98$var$A3","$c32801bdab290c98$var$A4","$c32801bdab290c98$var$M","$c32801bdab290c98$export$b492edf3b6d8056d","l6","$c32801bdab290c98$export$15f3cee84045a369","$c32801bdab290c98$export$9b88f8647c8033d6","phi2","phi4","$c32801bdab290c98$export$c07a31bc7f707ea9","$c32801bdab290c98$export$a44e9e75d3f7792","$c32801bdab290c98$export$dc4af7f453fe05b7","densityData","btw","$a65e147dfc6348df$export$5aa4bfb60c19ebc9","data1","values0","values1","pow2k","wi","$a65e147dfc6348df$var$max","transformPolygon","transformRing","transformPoint","resize","cellSize","bandwidth","gg","$c32801bdab290c98$export$c54f1830b066eb48","projectionStream","contextStream","measure","centroid","projection","$c32801bdab290c98$export$822554f68c8725ee","co","menu","electionSample","electionSampleGeo","$da9ab18c28e2e6aa$export$2e2bcd8739ae039","$2ae91dc6708f284d$export$2e2bcd8739ae039","voterGeoList","$65ba3e089739ee2d$export$2e2bcd8739ae039","voterList","electionStrategy","vizSample","addSimCandidateDistribution","$6b03fe144d120a5a$export$2e2bcd8739ae039","addSimVoterCircle","$3ab88a43bf356d6f$export$2e2bcd8739ae039","superEnter","candidateDnAdd","canDnButton","show","geo","VizSampleDensity","$303c0d3493d113df$export$2e2bcd8739ae039","$f79a07861a420da3$export$2e2bcd8739ae039","enterStrategy","hide","entities","nextID","new","num","get","outsideClickListener","elem","offsetWidth","offsetHeight","getClientRects","removeClickListener","removeEventListener","box","position","border","padding","background","pinned","tbox","$8224c2fe391551b0$export$2e2bcd8739ae039","$b72a214e9bbfb6d2$var$Item","val","setE","div","setW1","densityProfile1","setDensityProfile1","setW2","setColor","setShowNonExistingEntities","onChange","defaultValue","choices","option","checked","for","voterRegistrar","doLoad","voterCommander","instantiate","shape2p","setForListSenders","shape1x","shape2w","shape1w","shape1densityProfile","loadCommands","doCommands","setAction","cur","getCurrentValue","newW","newDensityProfile1","click","$b72a214e9bbfb6d2$export$2e2bcd8739ae039","voterShapeAdd","makeSetForListSender","configKey","isChain","addSenderForList","setNumberVoters","props","setNumberVotersSender","setNumberVotersAction","isFirstAction","sims","addVoterButton","addVoterPressed","$3feb239f40f58b63$export$2e2bcd8739ae039","$93bf61687e0acd03$export$2e2bcd8739ae039","$5fb6d77d2d952ec4$export$2e2bcd8739ae039","addVoterCircle","$16caf0f33023bbc5$export$2e2bcd8739ae039","one","sample","$3c16a28e6169e80f$var$r","$3c16a28e6169e80f$export$8da5152a7cb9deca","rgba","toLowerCase","String","wHandle","hHandle","candidateRegistrar","candidateCommander","newColor","colorRGBA","prefix","setNumberCandidates","setNumberCandidatesSender","setNumberCandidatesAction","addCandidateButton","addCandidatePressed","canButton","$91bf2eeacf63b307$export$2e2bcd8739ae039","$7cad4102d954b952$export$2e2bcd8739ae039","addCandidate","candidate","$857f7aab49c32763$export$2e2bcd8739ae039","addSimCandidate","candidateDnRegistrar","candidateDnCommander","setNumberCandidateDns","setNumberCandidateDnsSender","setNumberCandidateDnsAction","addCandidateDistributionButton","addCandidateDistributionPressed","$7f43295cb5239d6b$export$2e2bcd8739ae039","$63963ec4d8ba9e59$export$2e2bcd8739ae039","addCandidateDistribution","$3cfb90248ef34c32$export$2e2bcd8739ae039","voteText","append","vote","colorSet","makeSpan","ranking","tallyFractions","sum2","sumF","$b34300039db3d925$export$e00a895b09ec9a57","removeTestPoint","voterTest","testVote","$2f7b5309260671ab$export$2e2bcd8739ae039","tooltip","candidateSimList","canList","getCandidates","can","colorSetRGBA","$b34300039db3d925$export$2e2bcd8739ae039","setPin","float","togglePin","button2","tooltipVoteText","$470d32c6243f3d76$export$2e2bcd8739ae039","$bbe0cc4489022f53$export$2e2bcd8739ae039","optionCast","usr","runElectionSim","oneVoters","voterShapes","runElection","testVoteES","testVoteE","startSim","addSim","seats","socialChoice","numSampleCandidates","electionResults","checkElectionType","winner","winPoint","allocation","jitterSize","numPoints","runElection2","votesByTract","voterGroupsByTract","row","voterGroups","castVotes","castVotesByTract","resultsStatewide","numCans","allVotes","votes","tf","totals","statewideTallyFractions","pairwiseTallyFractions","pwtf","pTotals","pNorm","statewidePairwiseTallyFractions","rankingTallyFractions","vrtf","rankingTallyFractionsAll","cansRankedAll","numRows","numCols","rNorm","cansRankedAll2","statewideRankingTallyFractions","combineVotes","countStatewideElection","resultsByTract","countTractElections","resultsByDistrict","votesByDistrict","cen","districtTallyFractions","districtPairwiseTallyFractions","gfSum","gfNorm","rankingTallyFractionsNorm","districtRankingTallyFractions","combineVotesByDistrict","countDistrictElections","numCandidates","iWinner","sumAllocations","canGeoms","c2","$0cc8dedd8b868f5c$export$25d0e82e15843c2f","$0cc8dedd8b868f5c$var$findLines","sumArea","voterGeom","lineSet","$0cc8dedd8b868f5c$var$sumCircle","diff2","half","high","low","A","intervals","iSorted","midpoints","lower","upper","$d558c853753cbd9b$var$findIntervals","$d558c853753cbd9b$export$db68fffe979e7793","$d558c853753cbd9b$export$a0550d067ba2c229","block","interval","lower2","upper2","lower3","upper3","lc","tally","df","$05244c126866791b$var$df1","$05244c126866791b$var$df2","dist","$51d4c6038662af31$export$6fb785c609d82593","frac","grid","spread","iWidth","ixGrid","iyGrid","gridXMargin","gridYMargin","gridLength","gridX","gridY","$33445d767d441145$var$findWeight","$33445d767d441145$var$makeGrid","voteSet","$05244c126866791b$export$2e2bcd8739ae039","isGauss","$8a61a98e22fa7c5f$var$makeGrid","$8a61a98e22fa7c5f$var$findWeight","plane","pos","neg","iPos","iNeg","aNeg","$e12512d49dd89e8d$var$calcNeg","bNeg","$e12512d49dd89e8d$var$lerp","$e12512d49dd89e8d$var$calcDist","positive","negative","da","db","voterPoly","$3920987237960f52$var$makeCircle","cells","bordaScore","cn","newCells","newBordaScore","newC","$e12512d49dd89e8d$export$2e2bcd8739ae039","$3920987237960f52$var$eqPlane","cansRanked","rik","$3920987237960f52$export$2e2bcd8739ae039","theArea","cellDatum","mn","uMidpoints","uMidpointPair","ck","midpoint","mSorted","midpointPair","rankings","ri","intervalBorders","$219e14d19e9c6d7b$export$2e2bcd8739ae039","ni","$670e83f4a6f73f0d$var$sumInterval","$e61ec6b437df561a$var$df1","$e61ec6b437df561a$var$df2","$584633b26087d337$var$df1","$584633b26087d337$var$df2","dist2","indexInOrder","bordaScores","pairwise","iSmaller","kx","$896f5b95ede01c46$var$sumInterval","$896f5b95ede01c46$var$calcVoterTotalArea","smallerArea","iArea","kArea","$71f2b7def5d3ba1f$var$calcVoterTotalArea","$71f2b7def5d3ba1f$var$calcArea","$71f2b7def5d3ba1f$var$calcDist","$71f2b7def5d3ba1f$var$eqPlane","$20abca847cbe0cd0$var$voteCasters","cast","voterGeoms","summer","$d558c853753cbd9b$export$2e2bcd8739ae039","$0cc8dedd8b868f5c$export$2e2bcd8739ae039","castTestVote","$8a61a98e22fa7c5f$export$2e2bcd8739ae039","$33445d767d441145$export$2e2bcd8739ae039","gridData","gridDataEntry","$670e83f4a6f73f0d$export$2e2bcd8739ae039","$9fcffe9136ae925c$export$2e2bcd8739ae039","areaAll","rankingAll","firstPreferences","totalAreaAll","cellData","cr0","$584633b26087d337$export$2e2bcd8739ae039","$896f5b95ede01c46$export$2e2bcd8739ae039","$71f2b7def5d3ba1f$export$2e2bcd8739ae039","tallyWins","ik","ki","electionMethodOptions","populations","positivePopulations","nPositiveParties","populationsSorted","minPopulation","divisorPattern","signposts","order","nr","quota","resolved","elected","stillIn","canInTally","activeRank","exhausted","canArs","siWinner","votesForWinner","iEliminate","reweight","moveForward","arf","canArfs","warn","minimax","losses","np","lossDegree","loser","iOverK","iLost","pSorted","iNext","socialChoiceResults","electionMethod","$ee120a7268fdcb91$export$2e2bcd8739ae039","electionMethodList","casterName","electionMethodListByFunctionName","setElectionMethod","electionType","$238e2616cd709671$export$2e2bcd8739ae039","setDimensions","mapVoters","vg","mapCans","$20abca847cbe0cd0$export$2e2bcd8739ae039","canGeom","fraction","setFraction","setWins","wins","$dbc57562c2a509ba$export$2e2bcd8739ae039","simCans","simCan","getSimCandidates","getCandidatesAll","setCandidateFractions","fractions","setCandidateWins","winsByCandidate","win","numSimCandidates","geoElectionResults","colorByTract","$591fd08badedf5e6$var$colorTracts","colorOfWinsByDistrict","$591fd08badedf5e6$var$colorDistrictWins","colorOfVoteByDistrict","$591fd08badedf5e6$var$colorDistrictVote","offCtx","imageData","createImageData","putImageData","renderWidth","renderHeight","imageSmoothingEnabled","noiseImage","$0531784a545936ff$export$2e2bcd8739ae039","gc","$591fd08badedf5e6$export$2e2bcd8739ae039","winnerColors","loadColors","renderPolicyNoise","renderTractVotes","renderDistrictWins","renderDistrictVotes","voterGroup","smallCircle","geoMaps","$51b27a8f2502acf4$export$2e2bcd8739ae039","flagNoRender","fillUndefined","Voronoi","$a46639894e63747d$export$2e2bcd8739ae039","$ec52817c6fba578b$export$2e2bcd8739ae039","$a676841134d36552$export$2e2bcd8739ae039","colorList","$1e9b323a516a0c07$var$renderInterval","$9b21b051fc2166f9$var$cellPath","first","coord","VoronoiRanking","$1e9b323a516a0c07$export$2e2bcd8739ae039","$9b21b051fc2166f9$export$2e2bcd8739ae039","shapePath","iCan","drawOutline","nCans","gl","xg","voteMult","gridData0","singleCanvas","canvases","nHeight","fillDataSeparate","fillDataBlend","ov","drawBlend","im","drawSeparate","Grid","$e9b32b3bcad2ef12$export$2e2bcd8739ae039","$4362eb6203983c70$export$2e2bcd8739ae039","electionOne","electionGeo","$7abf5c6aa34f05fd$export$2e2bcd8739ae039","vizOne","VizNoGeo","$420bc08cca8b1a3d$export$2e2bcd8739ae039","$556bab226caa96fa$export$2e2bcd8739ae039","$6a998174d97a7975$export$2e2bcd8739ae039","VizOne","$d26b4e8dca46fb28$export$2e2bcd8739ae039","$2112dbf0cba3cbca$export$2e2bcd8739ae039","candidateAdd","sampleCandidates","nDistricts","$1090428139f5fe20$export$2e2bcd8739ae039","$c7822207b3410824$export$2e2bcd8739ae039","$79ff5d573d845791$export$2e2bcd8739ae039","$027ff3d7a1d790c2$export$2e2bcd8739ae039","$5c6846f9e5f32b34$export$2e2bcd8739ae039","$fb1d46f883a07efa$export$2e2bcd8739ae039","$2a17d13d0aa17349$export$2e2bcd8739ae039","base","$55758a9e8aceb8b6$export$2e2bcd8739ae039","$2f640b767ee089ea$export$2e2bcd8739ae039","$df1e11ac7eec2625$export$2e2bcd8739ae039","$1da972e65817be71$export$2e2bcd8739ae039","viz","$f086f5d770a501ff$export$2e2bcd8739ae039","divsByName","extraDivs","makeComponent","actions","do","firstActions","makeUndo","loadConfigPriority","priority","isHigh","valueArray","execute","history","head","clearHistory","undoCommand","historyItem","undo","last","pair","chainTimer","redo","next","comMessenger","commandStore","$6130f44f768a268d$export$2e2bcd8739ae039","configKeeper","$6332fa552f960b2e$export$2e2bcd8739ae039","$28203dcb19e526a2$export$2e2bcd8739ae039","getConfig","loadConfig","obj","sandboxURL","getLink","string","encoded","search","URLSearchParams","toString","sp","location","sl","getFolder","link","navigator","clipboard","writeText","$5b0e6872a2899b94$export$2e2bcd8739ae039","$e0b757014bff90a3$export$2e2bcd8739ae039","$ab56d101b96b38ee$export$2e2bcd8739ae039","$391ef04f7f5158b8$export$2e2bcd8739ae039","undoButton","redoButton","$b18b7541dc28940b$export$2e2bcd8739ae039","$fe9b20ad1af12252$export$2e2bcd8739ae039","$1fe54c51b774a9e8$export$2e2bcd8739ae039","$8ddddc532219b614$export$2e2bcd8739ae039","$705ca8a2f34171f8$export$2e2bcd8739ae039","$cc1b5be8d2aed4c2$export$2e2bcd8739ae039","$24bbb315554fbe91$export$2e2bcd8739ae039","requestAnimationFrame","gameLoop","params","yes","has","decodeURIComponent","$d5ff4bfd7950f485$var$configFromParams","getElementsByClassName","targetConfig","cu","$d5ff4bfd7950f485$export$2e2bcd8739ae039","sandboxurl","$c79d11f6216552bb$export$2e2bcd8739ae039","$474f7ac0806c1369$export$2e2bcd8739ae039","divLink","div1","div2","$e5ac3f639b04e02f$export$2e2bcd8739ae039"],"version":3,"file":"addSandboxes.js.map"}