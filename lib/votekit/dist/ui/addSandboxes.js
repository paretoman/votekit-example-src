(()=>{class t{constructor(){this.linked=!0,this.commanders=[],this.protect=!1}setLinked(t){this.linked=t}addCommander(t){this.commanders.push(t)}broadcastDo(t,e){this.linked&&!1===this.protect?(this.protect=!0,this.commanders.forEach((e=>e.passDo(t))),this.protect=!1):e.passDo(t)}broadcastDoCommands(t,e){this.linked&&!1===this.protect?(this.protect=!0,this.commanders.forEach((e=>e.passDoCommands(t))),this.protect=!1):e.passDoCommands(t)}broadcastLoadConfig(t,e){this.linked&&!1===this.protect?(this.protect=!0,this.commanders.forEach((e=>e.passLoadConfig(t))),this.protect=!1):e.passLoadConfig(t)}broadCastLoadCommands(t,e){this.linked&&!1===this.protect?(this.protect=!0,this.commanders.forEach((e=>e.passLoadCommands(t))),this.protect=!1):e.passLoadCommands(t)}}function e(){const t=this,e=["init"];t.add=t=>{t.forEach((t=>e.push(t)))},t.check=t=>{let n=0;return t.forEach((t=>{n+=e.includes(t)?1:0})),n>0},t.checkNone=()=>0===e.length,t.clear=()=>{e.splice(0,e.length)}}function n(){const t=this;t.handlers={start:()=>{},move:()=>{},end:()=>{},touchmove:()=>{},touchstart:()=>{},touchend:()=>{}},t.set=e=>{Object.assign(t.handlers,e)}}function o(t,e,o){const i=this;i.width=t,i.height=e,i.canvas=document.createElement("canvas"),i.canvas.setAttribute("class","background"),i.ctx=i.canvas.getContext("2d"),i.tooltips=document.createElement("div"),i.tooltips.setAttribute("class","tooltips"),i.foreground=document.createElement("canvas"),i.foreground.setAttribute("class","foreground"),i.fctx=i.foreground.getContext("2d"),i.maps=document.createElement("canvas"),i.maps.setAttribute("class","maps"),i.mctx=i.maps.getContext("2d");const s=document.createElement("div");i.wrap=document.createElement("div"),i.wrap.setAttribute("class","screenWrap"),i.wrap.appendChild(s),i.wrap.appendChild(i.canvas),i.wrap.appendChild(i.tooltips),i.wrap.appendChild(i.foreground),o.newElement("screenWrap",i.wrap),o.newElement("maps",i.maps),i.noBuffers=!1,i.pixelRatio=function(t){const e=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/e}
/*!!
 *  Canvas 2 Svg v1.0.21
 *  A low level canvas to SVG converter. Uses a mock canvas context to build an SVG document.
 *
 *  Licensed under the MIT license:
 *  http://www.opensource.org/licenses/mit-license.php
 *
 *  Author:
 *  Kerry Liu
 *
 *  Copyright (c) 2014 Gliffy Inc.
 */(i.ctx),i.canvas.width=t*i.pixelRatio,i.canvas.height=e*i.pixelRatio,i.canvas.style.width=`${t}px`,i.canvas.style.height=`${e}px`,i.wrap.style.width=`${t}px`,i.wrap.style.height=`${e}px`,i.tooltips.style.width=`${t}px`,i.tooltips.style.height=`${e}px`,i.foreground.width=t*i.pixelRatio,i.foreground.height=e*i.pixelRatio,i.foreground.style.width=`${t}px`,i.foreground.style.height=`${e}px`,i.setMapsHeight=t=>{const e=Math.round(t);i.maps.heightBrowser=e,i.maps.height=e*i.pixelRatio,i.maps.style.height=`${e}px`,i.mctx.scale(i.pixelRatio,i.pixelRatio)},i.setMapsHeight(1/3*e),i.maps.width=t*i.pixelRatio,i.maps.style.width=`${t}px`,i.ctx.scale(i.pixelRatio,i.pixelRatio),i.fctx.scale(i.pixelRatio,i.pixelRatio),i.clear=function(){i.ctx.clearRect(0,0,i.canvas.width,i.canvas.height)},i.clearForeground=function(){i.fctx.clearRect(0,0,i.foreground.width,i.foreground.height)},i.clearMaps=function(){i.mctx.clearRect(0,0,i.maps.width,i.maps.height)},i.setCtx=function(t){i.ctx=t},i.setFCtx=function(t){i.fctx=t},i.setMCtx=function(t){i.mctx=t},i.setNoBuffers=function(t){i.noBuffers=t},i.showMaps=()=>{i.maps.style.display="block"},i.hideMaps=()=>{i.maps.style.display="none"},i.eventHandlers=new n;const{handlers:r}=i.eventHandlers;i.wrap.onmousedown=t=>r.start(t),i.wrap.onmousemove=t=>r.move(t),i.wrap.onmouseup=t=>r.end(t),i.wrap.addEventListener("touchmove",(t=>r.touchmove(t))),i.wrap.addEventListener("touchstart",(t=>r.touchstart(t))),i.wrap.addEventListener("touchend",(t=>r.touchend(t)));const a=document.onmouseup;document.onmouseup=t=>{a&&a(t),i.wrap.onmouseup(t)}}var i,s,r,a,c;function l(t,e){var n,o=Object.keys(e);for(n=0;n<o.length;n++)t=t.replace(new RegExp("\\{"+o[n]+"\\}","gi"),e[o[n]]);return t}function d(t){var e,n,o;if(!t)throw new Error("cannot create a random attribute name for an undefined object");e="ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",n="";do{for(n="",o=0;o<12;o++)n+=e[Math.floor(Math.random()*e.length)]}while(t[n]);return n}function h(t){var e={alphabetic:"alphabetic",hanging:"hanging",top:"text-before-edge",bottom:"text-after-edge",middle:"central"};return e[t]||e.alphabetic}c=function(t,e){var n,o,i,s={};for(t=t.split(","),e=e||10,n=0;n<t.length;n+=2)o="&"+t[n+1]+";",i=parseInt(t[n],e),s[o]="&#"+i+";";return s["\\xa0"]="&#160;",s}("50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro",32),i={strokeStyle:{svgAttr:"stroke",canvas:"#000000",svg:"none",apply:"stroke"},fillStyle:{svgAttr:"fill",canvas:"#000000",svg:null,apply:"fill"},lineCap:{svgAttr:"stroke-linecap",canvas:"butt",svg:"butt",apply:"stroke"},lineJoin:{svgAttr:"stroke-linejoin",canvas:"miter",svg:"miter",apply:"stroke"},miterLimit:{svgAttr:"stroke-miterlimit",canvas:10,svg:4,apply:"stroke"},lineWidth:{svgAttr:"stroke-width",canvas:1,svg:1,apply:"stroke"},globalAlpha:{svgAttr:"opacity",canvas:1,svg:1,apply:"fill stroke"},font:{canvas:"10px sans-serif"},shadowColor:{canvas:"#000000"},shadowOffsetX:{canvas:0},shadowOffsetY:{canvas:0},shadowBlur:{canvas:0},textAlign:{canvas:"start"},textBaseline:{canvas:"alphabetic"},lineDash:{svgAttr:"stroke-dasharray",canvas:[],svg:null,apply:"stroke"}},(r=function(t,e){this.__root=t,this.__ctx=e}).prototype.addColorStop=function(t,e){var n,o=this.__ctx.__createElement("stop");o.setAttribute("offset",t),-1!==e.indexOf("rgba")?(n=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi.exec(e),o.setAttribute("stop-color",l("rgb({r},{g},{b})",{r:n[1],g:n[2],b:n[3]})),o.setAttribute("stop-opacity",n[4])):o.setAttribute("stop-color",e),this.__root.appendChild(o)},a=function(t,e){this.__root=t,this.__ctx=e},(s=function(t){var e,n={width:500,height:500,enableMirroring:!1};if(arguments.length>1?((e=n).width=arguments[0],e.height=arguments[1]):e=t||n,!(this instanceof s))return new s(e);this.width=e.width||n.width,this.height=e.height||n.height,this.enableMirroring=void 0!==e.enableMirroring?e.enableMirroring:n.enableMirroring,this.canvas=this,this.__document=e.document||document,e.ctx?this.__ctx=e.ctx:(this.__canvas=this.__document.createElement("canvas"),this.__ctx=this.__canvas.getContext("2d")),this.__setDefaultStyles(),this.__stack=[this.__getStyleState()],this.__groupStack=[],this.__root=this.__document.createElementNS("http://www.w3.org/2000/svg","svg"),this.__root.setAttribute("version",1.1),this.__root.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.__root.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),this.__root.setAttribute("width",this.width),this.__root.setAttribute("height",this.height),this.__ids={},this.__defs=this.__document.createElementNS("http://www.w3.org/2000/svg","defs"),this.__root.appendChild(this.__defs),this.__currentElement=this.__document.createElementNS("http://www.w3.org/2000/svg","g"),this.__root.appendChild(this.__currentElement)}).prototype.__createElement=function(t,e,n){void 0===e&&(e={});var o,i,s=this.__document.createElementNS("http://www.w3.org/2000/svg",t),r=Object.keys(e);for(n&&(s.setAttribute("fill","none"),s.setAttribute("stroke","none")),o=0;o<r.length;o++)i=r[o],s.setAttribute(i,e[i]);return s},s.prototype.__setDefaultStyles=function(){var t,e,n=Object.keys(i);for(t=0;t<n.length;t++)this[e=n[t]]=i[e].canvas},s.prototype.__applyStyleState=function(t){var e,n,o=Object.keys(t);for(e=0;e<o.length;e++)this[n=o[e]]=t[n]},s.prototype.__getStyleState=function(){var t,e,n={},o=Object.keys(i);for(t=0;t<o.length;t++)n[e=o[t]]=this[e];return n},s.prototype.__applyStyleToCurrentElement=function(t){var e=this.__currentElement,n=this.__currentElementsToStyle;n&&(e.setAttribute(t,""),e=n.element,n.children.forEach((function(e){e.setAttribute(t,"")})));var o,s,c,d,h,u=Object.keys(i);for(o=0;o<u.length;o++)if(s=i[u[o]],c=this[u[o]],s.apply)if(c instanceof a){if(c.__ctx)for(;c.__ctx.__defs.childNodes.length;)d=c.__ctx.__defs.childNodes[0].getAttribute("id"),this.__ids[d]=d,this.__defs.appendChild(c.__ctx.__defs.childNodes[0]);e.setAttribute(s.apply,l("url(#{id})",{id:c.__root.getAttribute("id")}))}else if(c instanceof r)e.setAttribute(s.apply,l("url(#{id})",{id:c.__root.getAttribute("id")}));else if(-1!==s.apply.indexOf(t)&&s.svg!==c)if("stroke"!==s.svgAttr&&"fill"!==s.svgAttr||-1===c.indexOf("rgba")){var p=s.svgAttr;if("globalAlpha"===u[o]&&(p=t+"-"+s.svgAttr,e.getAttribute(p)))continue;e.setAttribute(p,c)}else{h=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi.exec(c),e.setAttribute(s.svgAttr,l("rgb({r},{g},{b})",{r:h[1],g:h[2],b:h[3]}));var f=h[4],m=this.globalAlpha;null!=m&&(f*=m),e.setAttribute(s.svgAttr+"-opacity",f)}},s.prototype.__closestGroupOrSvg=function(t){return"g"===(t=t||this.__currentElement).nodeName||"svg"===t.nodeName?t:this.__closestGroupOrSvg(t.parentNode)},s.prototype.getSerializedSvg=function(t){var e,n,o,i,s,r=(new XMLSerializer).serializeToString(this.__root);if(/xmlns="http:\/\/www\.w3\.org\/2000\/svg".+xmlns="http:\/\/www\.w3\.org\/2000\/svg/gi.test(r)&&(r=r.replace('xmlns="http://www.w3.org/2000/svg','xmlns:xlink="http://www.w3.org/1999/xlink')),t)for(e=Object.keys(c),n=0;n<e.length;n++)o=e[n],i=c[o],(s=new RegExp(o,"gi")).test(r)&&(r=r.replace(s,i));return r},s.prototype.getSvg=function(){return this.__root},s.prototype.save=function(){var t=this.__createElement("g"),e=this.__closestGroupOrSvg();this.__groupStack.push(e),e.appendChild(t),this.__currentElement=t,this.__stack.push(this.__getStyleState())},s.prototype.restore=function(){this.__currentElement=this.__groupStack.pop(),this.__currentElementsToStyle=null,this.__currentElement||(this.__currentElement=this.__root.childNodes[1]);var t=this.__stack.pop();this.__applyStyleState(t)},s.prototype.__addTransform=function(t){var e=this.__closestGroupOrSvg();if(e.childNodes.length>0){"path"===this.__currentElement.nodeName&&(this.__currentElementsToStyle||(this.__currentElementsToStyle={element:e,children:[]}),this.__currentElementsToStyle.children.push(this.__currentElement),this.__applyCurrentDefaultPath());var n=this.__createElement("g");e.appendChild(n),this.__currentElement=n}var o=this.__currentElement.getAttribute("transform");o?o+=" ":o="",o+=t,this.__currentElement.setAttribute("transform",o)},s.prototype.scale=function(t,e){void 0===e&&(e=t),this.__addTransform(l("scale({x},{y})",{x:t,y:e}))},s.prototype.rotate=function(t){var e=180*t/Math.PI;this.__addTransform(l("rotate({angle},{cx},{cy})",{angle:e,cx:0,cy:0}))},s.prototype.translate=function(t,e){this.__addTransform(l("translate({x},{y})",{x:t,y:e}))},s.prototype.transform=function(t,e,n,o,i,s){this.__addTransform(l("matrix({a},{b},{c},{d},{e},{f})",{a:t,b:e,c:n,d:o,e:i,f:s}))},s.prototype.beginPath=function(){var t;this.__currentDefaultPath="",this.__currentPosition={},t=this.__createElement("path",{},!0),this.__closestGroupOrSvg().appendChild(t),this.__currentElement=t},s.prototype.__applyCurrentDefaultPath=function(){var t=this.__currentElement;"path"===t.nodeName?t.setAttribute("d",this.__currentDefaultPath):console.error("Attempted to apply path command to node",t.nodeName)},s.prototype.__addPathCommand=function(t){this.__currentDefaultPath+=" ",this.__currentDefaultPath+=t},s.prototype.moveTo=function(t,e){"path"!==this.__currentElement.nodeName&&this.beginPath(),this.__currentPosition={x:t,y:e},this.__addPathCommand(l("M {x} {y}",{x:t,y:e}))},s.prototype.closePath=function(){this.__currentDefaultPath&&this.__addPathCommand("Z")},s.prototype.lineTo=function(t,e){this.__currentPosition={x:t,y:e},this.__currentDefaultPath.indexOf("M")>-1?this.__addPathCommand(l("L {x} {y}",{x:t,y:e})):this.__addPathCommand(l("M {x} {y}",{x:t,y:e}))},s.prototype.bezierCurveTo=function(t,e,n,o,i,s){this.__currentPosition={x:i,y:s},this.__addPathCommand(l("C {cp1x} {cp1y} {cp2x} {cp2y} {x} {y}",{cp1x:t,cp1y:e,cp2x:n,cp2y:o,x:i,y:s}))},s.prototype.quadraticCurveTo=function(t,e,n,o){this.__currentPosition={x:n,y:o},this.__addPathCommand(l("Q {cpx} {cpy} {x} {y}",{cpx:t,cpy:e,x:n,y:o}))};var u=function(t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]);return[t[0]/e,t[1]/e]};s.prototype.arcTo=function(t,e,n,o,i){var s=this.__currentPosition&&this.__currentPosition.x,r=this.__currentPosition&&this.__currentPosition.y;if(void 0!==s&&void 0!==r){if(i<0)throw new Error("IndexSizeError: The radius provided ("+i+") is negative.");if(s===t&&r===e||t===n&&e===o||0===i)this.lineTo(t,e);else{var a=u([s-t,r-e]),c=u([n-t,o-e]);if(a[0]*c[1]!=a[1]*c[0]){var l=a[0]*c[0]+a[1]*c[1],d=Math.acos(Math.abs(l)),h=u([a[0]+c[0],a[1]+c[1]]),p=i/Math.sin(d/2),f=t+p*h[0],m=e+p*h[1],g=[-a[1],a[0]],y=[c[1],-c[0]],_=function(t){var e=t[0];return t[1]>=0?Math.acos(e):-Math.acos(e)},x=_(g),w=_(y);this.lineTo(f+g[0]*i,m+g[1]*i),this.arc(f,m,i,x,w)}else this.lineTo(t,e)}}},s.prototype.stroke=function(){"path"===this.__currentElement.nodeName&&this.__currentElement.setAttribute("paint-order","fill stroke markers"),this.__applyCurrentDefaultPath(),this.__applyStyleToCurrentElement("stroke")},s.prototype.fill=function(){"path"===this.__currentElement.nodeName&&this.__currentElement.setAttribute("paint-order","stroke fill markers"),this.__applyCurrentDefaultPath(),this.__applyStyleToCurrentElement("fill")},s.prototype.rect=function(t,e,n,o){"path"!==this.__currentElement.nodeName&&this.beginPath(),this.moveTo(t,e),this.lineTo(t+n,e),this.lineTo(t+n,e+o),this.lineTo(t,e+o),this.lineTo(t,e),this.closePath()},s.prototype.fillRect=function(t,e,n,o){var i;i=this.__createElement("rect",{x:t,y:e,width:n,height:o},!0),this.__closestGroupOrSvg().appendChild(i),this.__currentElement=i,this.__applyStyleToCurrentElement("fill")},s.prototype.strokeRect=function(t,e,n,o){var i;i=this.__createElement("rect",{x:t,y:e,width:n,height:o},!0),this.__closestGroupOrSvg().appendChild(i),this.__currentElement=i,this.__applyStyleToCurrentElement("stroke")},s.prototype.__clearCanvas=function(){for(var t=this.__closestGroupOrSvg().getAttribute("transform"),e=this.__root.childNodes[1],n=e.childNodes,o=n.length-1;o>=0;o--)n[o]&&e.removeChild(n[o]);this.__currentElement=e,this.__groupStack=[],t&&this.__addTransform(t)},s.prototype.clearRect=function(t,e,n,o){if(0!==t||0!==e||n!==this.width||o!==this.height){var i,s=this.__closestGroupOrSvg();i=this.__createElement("rect",{x:t,y:e,width:n,height:o,fill:"#FFFFFF"},!0),s.appendChild(i)}else this.__clearCanvas()},s.prototype.createLinearGradient=function(t,e,n,o){var i=this.__createElement("linearGradient",{id:d(this.__ids),x1:t+"px",x2:n+"px",y1:e+"px",y2:o+"px",gradientUnits:"userSpaceOnUse"},!1);return this.__defs.appendChild(i),new r(i,this)},s.prototype.createRadialGradient=function(t,e,n,o,i,s){var a=this.__createElement("radialGradient",{id:d(this.__ids),cx:o+"px",cy:i+"px",r:s+"px",fx:t+"px",fy:e+"px",gradientUnits:"userSpaceOnUse"},!1);return this.__defs.appendChild(a),new r(a,this)},s.prototype.__parseFont=function(){var t=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-,\'\"\sa-z0-9]+?)\s*$/i.exec(this.font),e={style:t[1]||"normal",size:t[4]||"10px",family:t[6]||"sans-serif",weight:t[3]||"normal",decoration:t[2]||"normal",href:null};return"underline"===this.__fontUnderline&&(e.decoration="underline"),this.__fontHref&&(e.href=this.__fontHref),e},s.prototype.__wrapTextLink=function(t,e){if(t.href){var n=this.__createElement("a");return n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t.href),n.appendChild(e),n}return e},s.prototype.__applyText=function(t,e,n,o){var i,s,r=this.__parseFont(),a=this.__closestGroupOrSvg(),c=this.__createElement("text",{"font-family":r.family,"font-size":r.size,"font-style":r.style,"font-weight":r.weight,"text-decoration":r.decoration,x:e,y:n,"text-anchor":(i=this.textAlign,s={left:"start",right:"end",center:"middle",start:"start",end:"end"},s[i]||s.start),"dominant-baseline":h(this.textBaseline)},!0);c.appendChild(this.__document.createTextNode(t)),this.__currentElement=c,this.__applyStyleToCurrentElement(o),a.appendChild(this.__wrapTextLink(r,c))},s.prototype.fillText=function(t,e,n){this.__applyText(t,e,n,"fill")},s.prototype.strokeText=function(t,e,n){this.__applyText(t,e,n,"stroke")},s.prototype.measureText=function(t){return this.__ctx.font=this.font,this.__ctx.measureText(t)},s.prototype.arc=function(t,e,n,o,i,s){if(o!==i){(o%=2*Math.PI)===(i%=2*Math.PI)&&(i=(i+2*Math.PI-.001*(s?-1:1))%(2*Math.PI));var r=t+n*Math.cos(i),a=e+n*Math.sin(i),c=t+n*Math.cos(o),d=e+n*Math.sin(o),h=s?0:1,u=0,p=i-o;p<0&&(p+=2*Math.PI),u=s?p>Math.PI?0:1:p>Math.PI?1:0,this.lineTo(c,d),this.__addPathCommand(l("A {rx} {ry} {xAxisRotation} {largeArcFlag} {sweepFlag} {endX} {endY}",{rx:n,ry:n,xAxisRotation:0,largeArcFlag:u,sweepFlag:h,endX:r,endY:a})),this.__currentPosition={x:r,y:a}}},s.prototype.clip=function(){var t=this.__closestGroupOrSvg(),e=this.__createElement("clipPath"),n=d(this.__ids),o=this.__createElement("g");this.__applyCurrentDefaultPath(),t.removeChild(this.__currentElement),e.setAttribute("id",n),e.appendChild(this.__currentElement),this.__defs.appendChild(e),t.setAttribute("clip-path",l("url(#{id})",{id:n})),t.appendChild(o),this.__currentElement=o},s.prototype.drawImage=function(){var t,e,n,o,i,r,a,c,l,d,h,u,p,f,m=Array.prototype.slice.call(arguments),g=m[0],y=0,_=0;if(3===m.length)t=m[1],e=m[2],n=i=g.width,o=r=g.height;else if(5===m.length)t=m[1],e=m[2],n=m[3],o=m[4],i=g.width,r=g.height;else{if(9!==m.length)throw new Error("Inavlid number of arguments passed to drawImage: "+arguments.length);y=m[1],_=m[2],i=m[3],r=m[4],t=m[5],e=m[6],n=m[7],o=m[8]}a=this.__closestGroupOrSvg(),this.__currentElement;var x="translate("+t+", "+e+")";if(g instanceof s){if((c=g.getSvg().cloneNode(!0)).childNodes&&c.childNodes.length>1){for(l=c.childNodes[0];l.childNodes.length;)f=l.childNodes[0].getAttribute("id"),this.__ids[f]=f,this.__defs.appendChild(l.childNodes[0]);if(d=c.childNodes[1]){var w,v=d.getAttribute("transform");w=v?v+" "+x:x,d.setAttribute("transform",w),a.appendChild(d)}}}else"IMG"===g.nodeName?((h=this.__createElement("image")).setAttribute("width",n),h.setAttribute("height",o),h.setAttribute("preserveAspectRatio","none"),(y||_||i!==g.width||r!==g.height)&&((u=this.__document.createElement("canvas")).width=n,u.height=o,(p=u.getContext("2d")).drawImage(g,y,_,i,r,0,0,n,o),g=u),h.setAttribute("transform",x),h.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","CANVAS"===g.nodeName?g.toDataURL():g.getAttribute("src")),a.appendChild(h)):"CANVAS"===g.nodeName&&((h=this.__createElement("image")).setAttribute("width",n),h.setAttribute("height",o),h.setAttribute("preserveAspectRatio","none"),(u=this.__document.createElement("canvas")).width=n,u.height=o,(p=u.getContext("2d")).imageSmoothingEnabled=!1,p.mozImageSmoothingEnabled=!1,p.oImageSmoothingEnabled=!1,p.webkitImageSmoothingEnabled=!1,p.drawImage(g,y,_,i,r,0,0,n,o),g=u,h.setAttribute("transform",x),h.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",g.toDataURL()),a.appendChild(h))},s.prototype.drawImageSvg=function(){var t,e,n,o,i,s,r,a,c=Array.prototype.slice.call(arguments),l=c[0];if(3===c.length)t=c[1],e=c[2],n=l.width,o=l.height;else if(5===c.length)t=c[1],e=c[2],n=c[3],o=c[4],l.width,l.height;else{if(9!==c.length)throw new Error("Inavlid number of arguments passed to drawImage: "+arguments.length);c[1],c[2],c[3],c[4],t=c[5],e=c[6],n=c[7],o=c[8]}i=this.__closestGroupOrSvg(),this.__currentElement;var d="translate("+t+", "+e+")";if(l instanceof SVGSVGElement&&l.childNodes&&l.childNodes.length>1){var h=parseFloat(l.getAttribute("width")),u=parseFloat(l.getAttribute("height"));l.setAttribute("width",n),l.setAttribute("height",o);var p=n/h,f=o/u;for(s=l.childNodes[0];s.childNodes.length;)a=s.childNodes[0].getAttribute("id"),this.__ids[a]=a,this.__defs.appendChild(s.childNodes[0]);if(r=l.childNodes[1]){var m,g=r.getAttribute("transform");m=g?g+" "+d:d,r.setAttribute("transform",m+" scale("+p+", "+f+")"),i.appendChild(r)}}},s.prototype.createPattern=function(t,e){var n,o=this.__document.createElementNS("http://www.w3.org/2000/svg","pattern"),i=d(this.__ids);return o.setAttribute("id",i),o.setAttribute("width",t.width),o.setAttribute("height",t.height),"CANVAS"===t.nodeName||"IMG"===t.nodeName?((n=this.__document.createElementNS("http://www.w3.org/2000/svg","image")).setAttribute("width",t.width),n.setAttribute("height",t.height),n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","CANVAS"===t.nodeName?t.toDataURL():t.getAttribute("src")),o.appendChild(n),this.__defs.appendChild(o)):t instanceof s&&(o.appendChild(t.__root.childNodes[1]),this.__defs.appendChild(o)),new a(o,this)},s.prototype.setLineDash=function(t){t&&t.length>0?this.lineDash=t.join(","):this.lineDash=null},s.prototype.drawFocusRing=function(){},s.prototype.createImageData=function(){},s.prototype.getImageData=function(){},s.prototype.putImageData=function(){},s.prototype.globalCompositeOperation=function(){},s.prototype.setTransform=function(){};var p=s;function f(t,e,n){const o=t.width,i=t.height,s=document.createElement("div");n.newElement("svgUIDiv",s);const r=document.createElement("button");r.className="button2",r.innerText="Make SVG",r.onclick=function(){const n=t.ctx,o=t.fctx;t.setCtx(u),t.setFCtx(u),t.setNoBuffers(!0);const i=t.mctx;t.setMCtx(f);const{heightBrowser:s}=t.maps;r=s,h.style.height=`${Math.round(r)}px`,h.height=r,f.__root.setAttribute("height",r),e(),function(){l.hidden=!1;const t=u.getSerializedSvg(!0);d.innerHTML=t,d.hidden=!1,a.hidden=!1;const e=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(t)}`;a.href=e}(),function(){const t=f.getSerializedSvg(!0);h.innerHTML=t,h.hidden=!1,c.hidden=!1;const e=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(t)}`;c.href=e}(),t.setCtx(n),t.setFCtx(o),t.setNoBuffers(!1),t.setMCtx(i);var r},s.appendChild(r);const a=document.createElement("a");a.innerText="Download SVG",a.download="vote.svg",a.hidden=!0,a.style.margin="4px",s.appendChild(a);const c=document.createElement("a");c.innerText="Download Map SVG",c.download="vote_map.svg",c.hidden=!0,c.style.margin="4px",s.appendChild(c);const l=document.createElement("button");l.className="button2",l.innerText="Hide SVG",l.hidden=!0,l.onclick=function(){l.hidden=!0,d.hidden=!0,a.hidden=!0,h.hidden=!0,c.hidden=!0},s.appendChild(l);const d=document.createElement("div");d.setAttribute("class","svgDiv"),d.style.width=`${o}px`,d.style.height=`${i}px`,d.hidden=!0,s.appendChild(d);const h=document.createElement("div");h.setAttribute("class","mSvgDiv"),h.style.width=`${o}px`,h.style.height=`${Math.round(i/3)}px`,h.hidden=!0,s.appendChild(h);const u=new p(o,i),f=new p(o,Math.round(i/3))}function m(t,e){const n=this;n.config=t,n.name=t.name,n.nameIsHTML=t.nameIsHTML||!1,n.dom=document.createElement("div"),n.dom.setAttribute("class","button button2");let o=t.margin;o=o||0,o=Math.max(o,4),n.dom.style.marginRight=`${o}px`,n.draw=function(){n.nameIsHTML?n.dom.innerHTML=n.name:n.dom.innerText=n.name},n.draw(),n.dom.setAttribute("title",t.realname||""),n.onClick=function(){e(n,t)},n.dom.onclick=n.onClick,n.turnOff=function(){n.isOn=!1,n.config.isOn=!1,n.dom.setAttribute("on","no")},n.turnOn=function(){n.isOn=!0,n.config.isOn=!0,n.dom.setAttribute("on","yes")},n.turnOff()}function g(t){const e=this;e.config=t,void 0===t.data&&(t.data=[],void 0===t.makeData&&(t.makeData=()=>[]),e.makeData=t.makeData,e.buttonConfigs=e.makeData(),e.doMakeData=!0),e.buttonConfigs=t.data,e.labelName=t.label,e.labelIsHTML=t.labelIsHTML||!1,e.onChoose=t.onChoose,e.isCheckbox=t.isCheckbox||!1,e.isCheckboxBool=t.isCheckboxBool||!1,e.justButton=t.justButton||!1,e.buttonHidden=t.buttonHidden||{},e.dom=document.createElement("div"),e.dom.setAttribute("class","button-group"),e.buttonDOMByValue=[],e.init=function(){e.doMakeData&&(e.buttonConfigs=e.makeData()),e.dom.innerHTML="",e.buttons=[],e.buttonsByName={},e.labelDOM=document.createElement("div"),e.labelDOM.setAttribute("class","button-group-label"),e.draw(),e.dom.appendChild(e.labelDOM);for(let n=0;n<e.buttonConfigs.length;n++){const o=e.buttonConfigs[n],i=new m(o,e.onToggle);e.buttonsByName[o.name]=i,i.dom.style.width=`${t.width}px`,o.width&&(i.dom.style.width=`${o.width}px`),e.buttons.push(i),e.dom.appendChild(i.dom),e.buttonDOMByValue[o.value]=i.dom}for(let t=0;t<e.buttons.length;t++){const n=e.buttons[t];if(n.config.selected){n.turnOn();break}}e.draw()},e.updateNames=function(){const t=e.makeData();for(let n=0;n<e.buttonConfigs.length;n++)e.buttonConfigs[n].name=t[n].name,e.buttons[n].name=e.buttonConfigs[n].name},e.redraw=function(){e.updateNames(),e.draw()},e.draw=function(){e.labelIsHTML?e.labelDOM.innerHTML=e.labelName:e.labelDOM.innerText=e.labelName;for(const t of e.buttons)t.draw()},e.configureHidden=function(){for(const[t,n]of Object.entries(e.buttonHidden))e.buttonsByName[t].dom.hidden=n},e.onToggle=function(t,n){if(e.isCheckbox||e.isCheckboxBool)t.isOn?t.turnOff():t.turnOn();else{for(let t=0;t<e.buttons.length;t++)e.buttons[t].turnOff();t.turnOn(),e.justButton&&setTimeout((()=>t.turnOff()),800)}e.onChoose(n)},e.highlight=function(t,n){if(0!==e.buttons.length){for(let t=0;t<e.buttons.length;t++)e.buttons[t].turnOff();if(e.isCheckbox)for(const o in e.buttons){const i=e.buttons[o];n.includes(i.config[t])&&i.turnOn()}else if(e.isCheckboxBool)for(const o in e.buttons){const i=e.buttons[o],s=i.config[t];s in n&&n[s]&&i.turnOn()}else{const o=e.buttons.filter((e=>{const{config:o}=e;return o[t]===n}))[0];void 0!==o&&o.turnOn()}}},e.init()}function y(t,e,n,o,i,s,r,a){const c=this;c.list=i,c.onChoose=function(t){c.sender.go(t.value)},c.action=t=>{c.set(t),c.select()},c.sender=a.addSender({name:e,action:c.action,currentValue:t[e]}),c.set=function(t){n(t),c.configure(),r.add(s)},c.choose=new g({label:o,width:_(3),data:c.list,onChoose:c.onChoose}),c.configure=function(){},c.select=function(){c.choose.highlight("value",t[e])}}function _(t){return(302-18*(t-1)-10)/t}function x(t,e,n){const o=this;o.divMenu=document.createElement("div"),e.newElement("menu",o.divMenu),o.addMenuItem=function(e,i){const{prop:s,setProp:r,label:a,options:c,change:l}=i,d=new y(e,s,r,a,c,l,t,n);d.select(),o.divMenu.appendChild(d.choose.dom)}}function w(t,e){const n=this;n.candidate=t,e.newSquareHandle(t,t.square),n.renderForeground=()=>{n.candidate.renderForeground()}}function v(t){const e=this,n=[];e.newCandidate=function(t){n.push(t)},e.getSimCandidates=()=>n.filter((t=>t.candidate.exists)),e.getCandidates=()=>e.getSimCandidates().map((t=>t.candidate)),e.getCandidatesAll=()=>n.map((t=>t.candidate)),e.setCandidateFractions=t=>{e.getCandidates().forEach(((e,n)=>{const o=t[n];e.setFraction(o)}))},e.setCandidateWins=t=>{e.getCandidates().forEach(((e,n)=>{const o=t[n];e.setWins(o)}))},e.updateXY=()=>{n.forEach((t=>t.candidate.updateXY()))},e.renderForeground=()=>{t.showGhosts?e.renderForegroundAll():e.renderForegroundExisting()},e.renderForegroundExisting=()=>{e.getCandidates().forEach((t=>t.renderForeground()))},e.renderForegroundAll=()=>{e.getCandidatesAll().forEach((t=>t.renderForeground()))},e.numCandidates=()=>n.length}function b(t){const e=this,n=[];e.list=n,e.newVoterSim=function(t){n.push(t)},e.getVoterShapes=()=>n.filter((t=>t.voterShape.exists)).map((t=>t.voterShape)),e.getVoterSims=()=>n.filter((t=>t.voterShape.exists)),e.update=t=>{n.forEach((e=>{e.voterShape.exists&&e.update(t)}))},e.updateXY=()=>{n.forEach((t=>t.voterShape.updateXY()))},e.render=()=>{n.forEach((t=>{t.voterShape.exists&&t.render()}))},e.renderForeground=()=>{t.showGhosts?e.renderForegroundAll():e.renderForegroundExisting()},e.renderForegroundExisting=()=>{n.forEach((t=>{t.voterShape.exists&&t.renderForeground()}))},e.renderForegroundAll=()=>{n.forEach((t=>{t.renderForeground()}))}}function C(t){return[...Array(t).keys()]}function S(t){return"object"==typeof t?Array.isArray(t)?t.map(S):Object.keys(t).sort().reduce(((e,n)=>{const o=t[n];return e[n]=S(o),e}),{}):t}function A(t,e,n){return 1/(n*Math.sqrt(2*Math.PI))*Math.exp(-.5*((t-e)/n)**2)}function E(t,e,n){return t===1/0?1:t===-1/0?0:.5*function(t){const e=.147,n=t**2,o=1+e*n,i=-(4/Math.PI+e*n)/o*n,s=Math.exp(i),r=Math.sqrt(1-s);return r*Math.sign(t)}((t-e)/(n*Math.sqrt(2)))+.5}function M(t){const e=document.createElement("canvas"),n=e.getContext("2d");n.fillStyle=t;const o=n.fillStyle;return e.remove(),o}function k(t){let e=1/0,n=null;for(let o=0;o<t.length;o++){const i=t[o];i<e&&(e=i,n=o)}return n}function T(t,e,n){return t<e?e:t>n?n:t}function P(t,e,n){const o=this;let i={};const s=[],r=t.tooltips;o.newSquareHandle=function(t,e){s.push({o:t,g:e,p:{isSquare:!0}})},o.newCircleHandle=function(t,e){s.push({o:t,g:e,p:{isCircle:!0}})};const a=function(t){if(null!==t.target.closest(".tooltipBox"))return;const e=h(t),o=t.isTouch?10:0,a=s.length,c=[];for(let t=0;t<a;t++){const i=s[t];(i.o.exists||n.showGhosts)&&u(i,e,o)&&c.push(t)}if(c.length>0){const t=c.map((t=>{const n=s[t];return(n.o.x-e.x)**2+(n.o.y-e.y)**2})),n=c[k(t)],o=s[n];i.iDragging=n,i.isDragging=!0,i.offX=o.o.x-e.x,i.offY=o.o.y-e.y,o.g.pickUp(),r.dataset.cursor="grabbing"}!function(t){p=!0,f=structuredClone(t)}(e)},c=function(o){const a=h(o);if(i.isDragging){o.isTouch&&(o.preventDefault(),o.stopPropagation());const n=s[i.iDragging],r=t.width,c=t.height;n.o.setXY({x:T(a.x+i.offX,0,r),y:T(a.y+i.offY,0,c)}),e.add(["draggables"])}else{const t=s.length;for(let e=0;e<t;e++){const t=s[e];if((n.showGhosts||t.o.exists)&&u(t,a,0))return void(r.dataset.cursor="grab")}r.dataset.cursor=""}!function(t){if(p){const e=Math.abs(f.x-t.x),n=Math.abs(f.y-t.y);e>5&&(p=!1),n>5&&(p=!1)}}(a)},l=function(){if(function(){if(p)if(p=!1,i.isDragging){s[i.iDragging].o.click()}else t=f,n.voterTest.start(t);var t}(),void 0!==i.iDragging){s[i.iDragging].g.drop()}i={}};function d(t){return t.isTouch=!0,t}function h(e){const n=t.canvas.getBoundingClientRect(),o=e.isTouch?e.changedTouches[0]:e;return{x:o.clientX-n.left,y:o.clientY-n.top}}function u(t,e,n){const o=t.o.x-e.x,i=t.o.y-e.y;if(t.p.isCircle){const{r:e}=t.g;return o*o+i*i<(e+n)*(e+n)}if(t.p.isSquare){const{w:e,h:s}=t.g;return Math.abs(o)<.5*e+n&&Math.abs(i)<.5*s+n}return!1}let p,f;o.eventHandlers={start:a,move:c,end:l,touchmove:t=>{const e=d(t);c(e)},touchstart:t=>{const e=d(t);a(e)},touchend:t=>{const e=d(t);c(e),l(),t.preventDefault()}}}function F(t,e,n){const o=this;o.dragm=new P(t,e,n),o.enter=()=>{t.eventHandlers.set(o.dragm.eventHandlers)},o.exit=()=>{},o.update=()=>{},o.render=()=>{},o.renderForeground=()=>{},o.testVote=()=>{}}function D(t,e){const n=this;n.voterShape=t,e.newCircleHandle(t,t.circle),n.renderForeground=()=>{n.voterShape.renderForeground()}}const N=Math.round;function V(t){const e=t.length,n=Array(4).fill();if("rgb"===t.slice(0,3).toLowerCase()){const e=t.replace(" ","").split(",");n[0]=parseInt(e[0].slice("a"===e[3].toLowerCase()?5:4),10),n[1]=parseInt(e[1],10),n[2]=parseInt(e[2],10),n[3]=e[3]?parseFloat(e[3]):-1}else{let o;o=e<6?parseInt(String(t[1])+t[1]+t[2]+t[2]+t[3]+t[3]+(e>4?String(t[4])+t[4]:""),16):parseInt(t.slice(1),16),n[0]=o>>16&255,n[1]=o>>8&255,n[2]=255&o,n[3]=9===e||5===e?N((o>>24&255)/255*1e4)/1e4:-1}return n}function L(t,e,n=.5){const o=t.trim(),i=e.trim(),s=n<0?-1*n:n,r=V(o),a=V(i);return"r"===i[0]?`rgb${"a"===i[3]?"a(":"("}${N((a[0]-r[0])*s+r[0])},${N((a[1]-r[1])*s+r[1])},${N((a[2]-r[2])*s+r[2])}${r[3]<0&&a[3]<0?"":`,${r[3]>-1&&a[3]>-1?N(1e4*((a[3]-r[3])*s+r[3]))/1e4:a[3]<0?r[3]:a[3]}`})`:`#${(4294967296+16777216*(r[3]>-1&&a[3]>-1?N(255*((a[3]-r[3])*s+r[3])):a[3]>-1?N(255*a[3]):r[3]>-1?N(255*r[3]):255)+65536*N((a[0]-r[0])*s+r[0])+256*N((a[1]-r[1])*s+r[1])+N((a[2]-r[2])*s+r[2])).toString(16).slice(r[3]>-1||a[3]>-1?1:3)}`}function I(t,e){let n=t[0],o=e[0];for(let i=1;i<t.length;i++){const s=O(t[i],n);o=L(o,e[i],s),n+=t[i]}return o}function O(t,e){return t/(t+e)}function R(t,e,n){const o=e.getCandidates(),{grid:i,voteSet:s,voterGeom:r}=t,{x:a,y:c,w:l}=r,d=[];let h;const u=o.length,p=Math.floor((u-1)/3)+1;n.setMapsHeight(p*(1/3)*n.height);const f="gaussian"===r.densityProfile;!function(){const{nx:t,ny:e,weight:n}=i;for(let i=0;i<o.length;i++){const r=document.createElement("canvas");r.width=t,r.height=e;const a=r.getContext("2d"),c=a.createImageData(t,e),{data:l}=c,{color:h}=o[i],[u,p,m]=V(h);let g=0;for(let o=0;o<e;o++)for(let e=0;e<t;e++){const r=s[g].tallyFractions[i]*(f?n[g]:1)*255;l[4*(e+o*t)+0]=u,l[4*(e+o*t)+1]=p,l[4*(e+o*t)+2]=m,l[4*(e+o*t)+3]=r,g+=1}d.push(r),a.putImageData(c,0,0)}}(),function(){const{nx:t,ny:e,weight:n}=i,r=o.map((t=>t.color)),a=document.createElement("canvas");a.width=t,a.height=e;const c=a.getContext("2d"),l=c.createImageData(t,e),{data:d}=l;let u=0;for(let o=0;o<e;o++)for(let e=0;e<t;e++){const{tallyFractions:i}=s[u],a=I(i,r),[c,l,h]=V(a),p=255*(f?n[u]:1);d[4*(e+o*t)+0]=c,d[4*(e+o*t)+1]=l,d[4*(e+o*t)+2]=h,d[4*(e+o*t)+3]=p,u+=1}h=a,c.putImageData(l,0,0)}(),this.render=function(){const{ctx:t,mctx:e}=n;!function(){t.save(),t.beginPath(),t.arc(a,c,.5*l,0,2*Math.PI),t.clip();const e={w:1,h:1,x:0,y:0},n=h;t.imageSmoothingEnabled=!1;const o={x:a-.5*l+e.x,y:c-.5*l+e.y,w:l*e.w,h:l*e.h};t.drawImage(n,o.x,o.y,o.w,o.h),t.beginPath(),t.arc(a,c,.5*l,0,2*Math.PI),t.stroke(),t.restore()}(),function(){for(let t=0;t<u;t++){e.save();const n={w:1/3,h:1/3,x:t%3*100,y:100*Math.floor(t/3)},o={x:a*n.w+n.x,y:c*n.h+n.y,r:l*n.w*.5};e.beginPath(),e.arc(o.x,o.y,o.r,0,2*Math.PI),e.clip(),e.beginPath(),e.rect(n.x,n.y,100,100),e.clip();const i=d[t],s={x:a*n.w-l*n.w*.5+n.x,y:c*n.w-l*n.w*.5+n.y,w:l*n.w,h:l*n.h};e.drawImage(i,s.x,s.y,s.w,s.h),e.beginPath(),e.arc(o.x,o.y,o.r,0,2*Math.PI),e.stroke(),e.restore()}}()}}const B=134217729;function q(t,e,n,o,i){let s,r,a,c,l=e[0],d=o[0],h=0,u=0;d>l==d>-l?(s=l,l=e[++h]):(s=d,d=o[++u]);let p=0;if(h<t&&u<n)for(d>l==d>-l?(r=l+s,a=s-(r-l),l=e[++h]):(r=d+s,a=s-(r-d),d=o[++u]),s=r,0!==a&&(i[p++]=a);h<t&&u<n;)d>l==d>-l?(r=s+l,c=r-s,a=s-(r-c)+(l-c),l=e[++h]):(r=s+d,c=r-s,a=s-(r-c)+(d-c),d=o[++u]),s=r,0!==a&&(i[p++]=a);for(;h<t;)r=s+l,c=r-s,a=s-(r-c)+(l-c),l=e[++h],s=r,0!==a&&(i[p++]=a);for(;u<n;)r=s+d,c=r-s,a=s-(r-c)+(d-c),d=o[++u],s=r,0!==a&&(i[p++]=a);return 0===s&&0!==p||(i[p++]=s),p}function $(t){return new Float64Array(t)}const j=$(4),U=$(8),H=$(12),G=$(16),W=$(4);function X(t,e,n,o,i,s){const r=(e-s)*(n-i),a=(t-i)*(o-s),c=r-a;if(0===r||0===a||r>0!=a>0)return c;const l=Math.abs(r+a);return Math.abs(c)>=33306690738754716e-32*l?c:-function(t,e,n,o,i,s,r){let a,c,l,d,h,u,p,f,m,g,y,_,x,w,v,b,C,S;const A=t-i,E=n-i,M=e-s,k=o-s;w=A*k,u=B*A,p=u-(u-A),f=A-p,u=B*k,m=u-(u-k),g=k-m,v=f*g-(w-p*m-f*m-p*g),b=M*E,u=B*M,p=u-(u-M),f=M-p,u=B*E,m=u-(u-E),g=E-m,C=f*g-(b-p*m-f*m-p*g),y=v-C,h=v-y,j[0]=v-(y+h)+(h-C),_=w+y,h=_-w,x=w-(_-h)+(y-h),y=x-b,h=x-y,j[1]=x-(y+h)+(h-b),S=_+y,h=S-_,j[2]=_-(S-h)+(y-h),j[3]=S;let T=function(t,e){let n=e[0];for(let o=1;o<t;o++)n+=e[o];return n}(4,j),P=22204460492503146e-32*r;if(T>=P||-T>=P)return T;if(h=t-A,a=t-(A+h)+(h-i),h=n-E,l=n-(E+h)+(h-i),h=e-M,c=e-(M+h)+(h-s),h=o-k,d=o-(k+h)+(h-s),0===a&&0===c&&0===l&&0===d)return T;if(P=11093356479670487e-47*r+33306690738754706e-32*Math.abs(T),T+=A*d+k*a-(M*l+E*c),T>=P||-T>=P)return T;w=a*k,u=B*a,p=u-(u-a),f=a-p,u=B*k,m=u-(u-k),g=k-m,v=f*g-(w-p*m-f*m-p*g),b=c*E,u=B*c,p=u-(u-c),f=c-p,u=B*E,m=u-(u-E),g=E-m,C=f*g-(b-p*m-f*m-p*g),y=v-C,h=v-y,W[0]=v-(y+h)+(h-C),_=w+y,h=_-w,x=w-(_-h)+(y-h),y=x-b,h=x-y,W[1]=x-(y+h)+(h-b),S=_+y,h=S-_,W[2]=_-(S-h)+(y-h),W[3]=S;const F=q(4,j,4,W,U);w=A*d,u=B*A,p=u-(u-A),f=A-p,u=B*d,m=u-(u-d),g=d-m,v=f*g-(w-p*m-f*m-p*g),b=M*l,u=B*M,p=u-(u-M),f=M-p,u=B*l,m=u-(u-l),g=l-m,C=f*g-(b-p*m-f*m-p*g),y=v-C,h=v-y,W[0]=v-(y+h)+(h-C),_=w+y,h=_-w,x=w-(_-h)+(y-h),y=x-b,h=x-y,W[1]=x-(y+h)+(h-b),S=_+y,h=S-_,W[2]=_-(S-h)+(y-h),W[3]=S;const D=q(F,U,4,W,H);w=a*d,u=B*a,p=u-(u-a),f=a-p,u=B*d,m=u-(u-d),g=d-m,v=f*g-(w-p*m-f*m-p*g),b=c*l,u=B*c,p=u-(u-c),f=c-p,u=B*l,m=u-(u-l),g=l-m,C=f*g-(b-p*m-f*m-p*g),y=v-C,h=v-y,W[0]=v-(y+h)+(h-C),_=w+y,h=_-w,x=w-(_-h)+(y-h),y=x-b,h=x-y,W[1]=x-(y+h)+(h-b),S=_+y,h=S-_,W[2]=_-(S-h)+(y-h),W[3]=S;const N=q(D,H,4,W,G);return G[N-1]}(t,e,n,o,i,s,l)}const Y=Math.pow(2,-52),z=new Uint32Array(512);class J{static from(t,e=nt,n=ot){const o=t.length,i=new Float64Array(2*o);for(let s=0;s<o;s++){const o=t[s];i[2*s]=e(o),i[2*s+1]=n(o)}return new J(i)}constructor(t){const e=t.length>>1;if(e>0&&"number"!=typeof t[0])throw new Error("Expected coords to contain numbers.");this.coords=t;const n=Math.max(2*e-5,0);this._triangles=new Uint32Array(3*n),this._halfedges=new Int32Array(3*n),this._hashSize=Math.ceil(Math.sqrt(e)),this._hullPrev=new Uint32Array(e),this._hullNext=new Uint32Array(e),this._hullTri=new Uint32Array(e),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(e),this._dists=new Float64Array(e),this.update()}update(){const{coords:t,_hullPrev:e,_hullNext:n,_hullTri:o,_hullHash:i}=this,s=t.length>>1;let r=1/0,a=1/0,c=-1/0,l=-1/0;for(let e=0;e<s;e++){const n=t[2*e],o=t[2*e+1];n<r&&(r=n),o<a&&(a=o),n>c&&(c=n),o>l&&(l=o),this._ids[e]=e}const d=(r+c)/2,h=(a+l)/2;let u,p,f,m=1/0;for(let e=0;e<s;e++){const n=K(d,h,t[2*e],t[2*e+1]);n<m&&(u=e,m=n)}const g=t[2*u],y=t[2*u+1];m=1/0;for(let e=0;e<s;e++){if(e===u)continue;const n=K(g,y,t[2*e],t[2*e+1]);n<m&&n>0&&(p=e,m=n)}let _=t[2*p],x=t[2*p+1],w=1/0;for(let e=0;e<s;e++){if(e===u||e===p)continue;const n=Z(g,y,_,x,t[2*e],t[2*e+1]);n<w&&(f=e,w=n)}let v=t[2*f],b=t[2*f+1];if(w===1/0){for(let e=0;e<s;e++)this._dists[e]=t[2*e]-t[0]||t[2*e+1]-t[1];tt(this._ids,this._dists,0,s-1);const e=new Uint32Array(s);let n=0;for(let t=0,o=-1/0;t<s;t++){const i=this._ids[t];this._dists[i]>o&&(e[n++]=i,o=this._dists[i])}return this.hull=e.subarray(0,n),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(X(g,y,_,x,v,b)<0){const t=p,e=_,n=x;p=f,_=v,x=b,f=t,v=e,b=n}const C=function(t,e,n,o,i,s){const r=n-t,a=o-e,c=i-t,l=s-e,d=r*r+a*a,h=c*c+l*l,u=.5/(r*l-a*c);return{x:t+(l*d-a*h)*u,y:e+(r*h-c*d)*u}}(g,y,_,x,v,b);this._cx=C.x,this._cy=C.y;for(let e=0;e<s;e++)this._dists[e]=K(t[2*e],t[2*e+1],C.x,C.y);tt(this._ids,this._dists,0,s-1),this._hullStart=u;let S=3;n[u]=e[f]=p,n[p]=e[u]=f,n[f]=e[p]=u,o[u]=0,o[p]=1,o[f]=2,i.fill(-1),i[this._hashKey(g,y)]=u,i[this._hashKey(_,x)]=p,i[this._hashKey(v,b)]=f,this.trianglesLen=0,this._addTriangle(u,p,f,-1,-1,-1);for(let s,r,a=0;a<this._ids.length;a++){const c=this._ids[a],l=t[2*c],d=t[2*c+1];if(a>0&&Math.abs(l-s)<=Y&&Math.abs(d-r)<=Y)continue;if(s=l,r=d,c===u||c===p||c===f)continue;let h=0;for(let t=0,e=this._hashKey(l,d);t<this._hashSize&&(h=i[(e+t)%this._hashSize],-1===h||h===n[h]);t++);h=e[h];let m,g=h;for(;m=n[g],X(l,d,t[2*g],t[2*g+1],t[2*m],t[2*m+1])>=0;)if(g=m,g===h){g=-1;break}if(-1===g)continue;let y=this._addTriangle(g,c,n[g],-1,-1,o[g]);o[c]=this._legalize(y+2),o[g]=y,S++;let _=n[g];for(;m=n[_],X(l,d,t[2*_],t[2*_+1],t[2*m],t[2*m+1])<0;)y=this._addTriangle(_,c,m,o[c],-1,o[_]),o[c]=this._legalize(y+2),n[_]=_,S--,_=m;if(g===h)for(;m=e[g],X(l,d,t[2*m],t[2*m+1],t[2*g],t[2*g+1])<0;)y=this._addTriangle(m,c,g,-1,o[g],o[m]),this._legalize(y+2),o[m]=y,n[g]=g,S--,g=m;this._hullStart=e[c]=g,n[g]=e[_]=c,n[c]=_,i[this._hashKey(l,d)]=c,i[this._hashKey(t[2*g],t[2*g+1])]=g}this.hull=new Uint32Array(S);for(let t=0,e=this._hullStart;t<S;t++)this.hull[t]=e,e=n[e];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,e){return Math.floor(function(t,e){const n=t/(Math.abs(t)+Math.abs(e));return(e>0?3-n:1+n)/4}(t-this._cx,e-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:e,_halfedges:n,coords:o}=this;let i=0,s=0;for(;;){const r=n[t],a=t-t%3;if(s=a+(t+2)%3,-1===r){if(0===i)break;t=z[--i];continue}const c=r-r%3,l=a+(t+1)%3,d=c+(r+2)%3,h=e[s],u=e[t],p=e[l],f=e[d];if(Q(o[2*h],o[2*h+1],o[2*u],o[2*u+1],o[2*p],o[2*p+1],o[2*f],o[2*f+1])){e[t]=f,e[r]=h;const o=n[d];if(-1===o){let e=this._hullStart;do{if(this._hullTri[e]===d){this._hullTri[e]=t;break}e=this._hullPrev[e]}while(e!==this._hullStart)}this._link(t,o),this._link(r,n[s]),this._link(s,d);const a=c+(r+1)%3;i<z.length&&(z[i++]=a)}else{if(0===i)break;t=z[--i]}}return s}_link(t,e){this._halfedges[t]=e,-1!==e&&(this._halfedges[e]=t)}_addTriangle(t,e,n,o,i,s){const r=this.trianglesLen;return this._triangles[r]=t,this._triangles[r+1]=e,this._triangles[r+2]=n,this._link(r,o),this._link(r+1,i),this._link(r+2,s),this.trianglesLen+=3,r}}function K(t,e,n,o){const i=t-n,s=e-o;return i*i+s*s}function Q(t,e,n,o,i,s,r,a){const c=t-r,l=e-a,d=n-r,h=o-a,u=i-r,p=s-a,f=d*d+h*h,m=u*u+p*p;return c*(h*m-f*p)-l*(d*m-f*u)+(c*c+l*l)*(d*p-h*u)<0}function Z(t,e,n,o,i,s){const r=n-t,a=o-e,c=i-t,l=s-e,d=r*r+a*a,h=c*c+l*l,u=.5/(r*l-a*c),p=(l*d-a*h)*u,f=(r*h-c*d)*u;return p*p+f*f}function tt(t,e,n,o){if(o-n<=20)for(let i=n+1;i<=o;i++){const o=t[i],s=e[o];let r=i-1;for(;r>=n&&e[t[r]]>s;)t[r+1]=t[r--];t[r+1]=o}else{let i=n+1,s=o;et(t,n+o>>1,i),e[t[n]]>e[t[o]]&&et(t,n,o),e[t[i]]>e[t[o]]&&et(t,i,o),e[t[n]]>e[t[i]]&&et(t,n,i);const r=t[i],a=e[r];for(;;){do{i++}while(e[t[i]]<a);do{s--}while(e[t[s]]>a);if(s<i)break;et(t,i,s)}t[n+1]=t[s],t[s]=r,o-i+1>=s-n?(tt(t,e,i,o),tt(t,e,n,s-1)):(tt(t,e,n,s-1),tt(t,e,i,o))}}function et(t,e,n){const o=t[e];t[e]=t[n],t[n]=o}function nt(t){return t[0]}function ot(t){return t[1]}const it=1e-6;class st{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,e){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,e){this._+=`L${this._x1=+t},${this._y1=+e}`}arc(t,e,n){const o=(t=+t)+(n=+n),i=e=+e;if(n<0)throw new Error("negative radius");null===this._x1?this._+=`M${o},${i}`:(Math.abs(this._x1-o)>it||Math.abs(this._y1-i)>it)&&(this._+="L"+o+","+i),n&&(this._+=`A${n},${n},0,1,1,${t-n},${e}A${n},${n},0,1,1,${this._x1=o},${this._y1=i}`)}rect(t,e,n,o){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}h${+n}v${+o}h${-n}Z`}value(){return this._||null}}class rt{constructor(){this._=[]}moveTo(t,e){this._.push([t,e])}closePath(){this._.push(this._[0].slice())}lineTo(t,e){this._.push([t,e])}value(){return this._.length?this._:null}}class at{constructor(t,[e,n,o,i]=[0,0,960,500]){if(!((o=+o)>=(e=+e)&&(i=+i)>=(n=+n)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(2*t.points.length),this.vectors=new Float64Array(2*t.points.length),this.xmax=o,this.xmin=e,this.ymax=i,this.ymin=n,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:e,triangles:n},vectors:o}=this,i=this.circumcenters=this._circumcenters.subarray(0,n.length/3*2);for(let e,o,s=0,r=0,a=n.length;s<a;s+=3,r+=2){const a=2*n[s],c=2*n[s+1],l=2*n[s+2],d=t[a],h=t[a+1],u=t[c],p=t[c+1],f=t[l],m=t[l+1],g=u-d,y=p-h,_=f-d,x=m-h,w=2*(g*x-y*_);if(Math.abs(w)<1e-9){let i=1e9;const s=2*n[0];i*=Math.sign((t[s]-d)*x-(t[s+1]-h)*_),e=(d+f)/2-i*x,o=(h+m)/2+i*_}else{const t=1/w,n=g*g+y*y,i=_*_+x*x;e=d+(x*n-y*i)*t,o=h+(g*i-_*n)*t}i[r]=e,i[r+1]=o}let s,r,a,c=e[e.length-1],l=4*c,d=t[2*c],h=t[2*c+1];o.fill(0);for(let n=0;n<e.length;++n)c=e[n],s=l,r=d,a=h,l=4*c,d=t[2*c],h=t[2*c+1],o[s+2]=o[l]=a-h,o[s+3]=o[l+1]=d-r}render(t){const e=null==t?t=new st:void 0,{delaunay:{halfedges:n,inedges:o,hull:i},circumcenters:s,vectors:r}=this;if(i.length<=1)return null;for(let e=0,o=n.length;e<o;++e){const o=n[e];if(o<e)continue;const i=2*Math.floor(e/3),r=2*Math.floor(o/3),a=s[i],c=s[i+1],l=s[r],d=s[r+1];this._renderSegment(a,c,l,d,t)}let a,c=i[i.length-1];for(let e=0;e<i.length;++e){a=c,c=i[e];const n=2*Math.floor(o[c]/3),l=s[n],d=s[n+1],h=4*a,u=this._project(l,d,r[h+2],r[h+3]);u&&this._renderSegment(l,d,u[0],u[1],t)}return e&&e.value()}renderBounds(t){const e=null==t?t=new st:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),e&&e.value()}renderCell(t,e){const n=null==e?e=new st:void 0,o=this._clip(t);if(null===o||!o.length)return;e.moveTo(o[0],o[1]);let i=o.length;for(;o[0]===o[i-2]&&o[1]===o[i-1]&&i>1;)i-=2;for(let t=2;t<i;t+=2)o[t]===o[t-2]&&o[t+1]===o[t-1]||e.lineTo(o[t],o[t+1]);return e.closePath(),n&&n.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let e=0,n=t.length/2;e<n;++e){const t=this.cellPolygon(e);t&&(t.index=e,yield t)}}cellPolygon(t){const e=new rt;return this.renderCell(t,e),e.value()}_renderSegment(t,e,n,o,i){let s;const r=this._regioncode(t,e),a=this._regioncode(n,o);0===r&&0===a?(i.moveTo(t,e),i.lineTo(n,o)):(s=this._clipSegment(t,e,n,o,r,a))&&(i.moveTo(s[0],s[1]),i.lineTo(s[2],s[3]))}contains(t,e,n){return(e=+e)==e&&(n=+n)==n&&this.delaunay._step(t,e,n)===t}*neighbors(t){const e=this._clip(t);if(e)for(const n of this.delaunay.neighbors(t)){const t=this._clip(n);if(t)t:for(let o=0,i=e.length;o<i;o+=2)for(let s=0,r=t.length;s<r;s+=2)if(e[o]==t[s]&&e[o+1]==t[s+1]&&e[(o+2)%i]==t[(s+r-2)%r]&&e[(o+3)%i]==t[(s+r-1)%r]){yield n;break t}}}_cell(t){const{circumcenters:e,delaunay:{inedges:n,halfedges:o,triangles:i}}=this,s=n[t];if(-1===s)return null;const r=[];let a=s;do{const n=Math.floor(a/3);if(r.push(e[2*n],e[2*n+1]),a=a%3==2?a-2:a+1,i[a]!==t)break;a=o[a]}while(a!==s&&-1!==a);return r}_clip(t){if(0===t&&1===this.delaunay.hull.length)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const e=this._cell(t);if(null===e)return null;const{vectors:n}=this,o=4*t;return n[o]||n[o+1]?this._clipInfinite(t,e,n[o],n[o+1],n[o+2],n[o+3]):this._clipFinite(t,e)}_clipFinite(t,e){const n=e.length;let o,i,s,r,a=null,c=e[n-2],l=e[n-1],d=this._regioncode(c,l),h=0;for(let u=0;u<n;u+=2)if(o=c,i=l,c=e[u],l=e[u+1],s=d,d=this._regioncode(c,l),0===s&&0===d)r=h,h=0,a?a.push(c,l):a=[c,l];else{let e,n,u,p,f;if(0===s){if(null===(e=this._clipSegment(o,i,c,l,s,d)))continue;[n,u,p,f]=e}else{if(null===(e=this._clipSegment(c,l,o,i,d,s)))continue;[p,f,n,u]=e,r=h,h=this._edgecode(n,u),r&&h&&this._edge(t,r,h,a,a.length),a?a.push(n,u):a=[n,u]}r=h,h=this._edgecode(p,f),r&&h&&this._edge(t,r,h,a,a.length),a?a.push(p,f):a=[p,f]}if(a)r=h,h=this._edgecode(a[0],a[1]),r&&h&&this._edge(t,r,h,a,a.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return a}_clipSegment(t,e,n,o,i,s){for(;;){if(0===i&&0===s)return[t,e,n,o];if(i&s)return null;let r,a,c=i||s;8&c?(r=t+(n-t)*(this.ymax-e)/(o-e),a=this.ymax):4&c?(r=t+(n-t)*(this.ymin-e)/(o-e),a=this.ymin):2&c?(a=e+(o-e)*(this.xmax-t)/(n-t),r=this.xmax):(a=e+(o-e)*(this.xmin-t)/(n-t),r=this.xmin),i?(t=r,e=a,i=this._regioncode(t,e)):(n=r,o=a,s=this._regioncode(n,o))}}_clipInfinite(t,e,n,o,i,s){let r,a=Array.from(e);if((r=this._project(a[0],a[1],n,o))&&a.unshift(r[0],r[1]),(r=this._project(a[a.length-2],a[a.length-1],i,s))&&a.push(r[0],r[1]),a=this._clipFinite(t,a))for(let e,n=0,o=a.length,i=this._edgecode(a[o-2],a[o-1]);n<o;n+=2)e=i,i=this._edgecode(a[n],a[n+1]),e&&i&&(n=this._edge(t,e,i,a,n),o=a.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(a=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return a}_edge(t,e,n,o,i){for(;e!==n;){let n,s;switch(e){case 5:e=4;continue;case 4:e=6,n=this.xmax,s=this.ymin;break;case 6:e=2;continue;case 2:e=10,n=this.xmax,s=this.ymax;break;case 10:e=8;continue;case 8:e=9,n=this.xmin,s=this.ymax;break;case 9:e=1;continue;case 1:e=5,n=this.xmin,s=this.ymin}o[i]===n&&o[i+1]===s||!this.contains(t,n,s)||(o.splice(i,0,n,s),i+=2)}if(o.length>4)for(let t=0;t<o.length;t+=2){const e=(t+2)%o.length,n=(t+4)%o.length;(o[t]===o[e]&&o[e]===o[n]||o[t+1]===o[e+1]&&o[e+1]===o[n+1])&&(o.splice(e,2),t-=2)}return i}_project(t,e,n,o){let i,s,r,a=1/0;if(o<0){if(e<=this.ymin)return null;(i=(this.ymin-e)/o)<a&&(r=this.ymin,s=t+(a=i)*n)}else if(o>0){if(e>=this.ymax)return null;(i=(this.ymax-e)/o)<a&&(r=this.ymax,s=t+(a=i)*n)}if(n>0){if(t>=this.xmax)return null;(i=(this.xmax-t)/n)<a&&(s=this.xmax,r=e+(a=i)*o)}else if(n<0){if(t<=this.xmin)return null;(i=(this.xmin-t)/n)<a&&(s=this.xmin,r=e+(a=i)*o)}return[s,r]}_edgecode(t,e){return(t===this.xmin?1:t===this.xmax?2:0)|(e===this.ymin?4:e===this.ymax?8:0)}_regioncode(t,e){return(t<this.xmin?1:t>this.xmax?2:0)|(e<this.ymin?4:e>this.ymax?8:0)}}const ct=2*Math.PI,lt=Math.pow;function dt(t){return t[0]}function ht(t){return t[1]}function ut(t,e,n){return[t+Math.sin(t+e)*n,e+Math.cos(t-e)*n]}class pt{static from(t,e=dt,n=ht,o){return new pt("length"in t?function(t,e,n,o){const i=t.length,s=new Float64Array(2*i);for(let r=0;r<i;++r){const i=t[r];s[2*r]=e.call(o,i,r,t),s[2*r+1]=n.call(o,i,r,t)}return s}(t,e,n,o):Float64Array.from(function*(t,e,n,o){let i=0;for(const s of t)yield e.call(o,s,i,t),yield n.call(o,s,i,t),++i}(t,e,n,o)))}constructor(t){this._delaunator=new J(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,e=this.points;if(t.hull&&t.hull.length>2&&function(t){const{triangles:e,coords:n}=t;for(let t=0;t<e.length;t+=3){const o=2*e[t],i=2*e[t+1],s=2*e[t+2];if((n[s]-n[o])*(n[i+1]-n[o+1])-(n[i]-n[o])*(n[s+1]-n[o+1])>1e-10)return!1}return!0}(t)){this.collinear=Int32Array.from({length:e.length/2},((t,e)=>e)).sort(((t,n)=>e[2*t]-e[2*n]||e[2*t+1]-e[2*n+1]));const t=this.collinear[0],n=this.collinear[this.collinear.length-1],o=[e[2*t],e[2*t+1],e[2*n],e[2*n+1]],i=1e-8*Math.hypot(o[3]-o[1],o[2]-o[0]);for(let t=0,n=e.length/2;t<n;++t){const n=ut(e[2*t],e[2*t+1],i);e[2*t]=n[0],e[2*t+1]=n[1]}this._delaunator=new J(e)}else delete this.collinear;const n=this.halfedges=this._delaunator.halfedges,o=this.hull=this._delaunator.hull,i=this.triangles=this._delaunator.triangles,s=this.inedges.fill(-1),r=this._hullIndex.fill(-1);for(let t=0,e=n.length;t<e;++t){const e=i[t%3==2?t-2:t+1];-1!==n[t]&&-1!==s[e]||(s[e]=t)}for(let t=0,e=o.length;t<e;++t)r[o[t]]=t;o.length<=2&&o.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=o[0],s[o[0]]=1,2===o.length&&(s[o[1]]=0,this.triangles[1]=o[1],this.triangles[2]=o[1]))}voronoi(t){return new at(this,t)}*neighbors(t){const{inedges:e,hull:n,_hullIndex:o,halfedges:i,triangles:s,collinear:r}=this;if(r){const e=r.indexOf(t);return e>0&&(yield r[e-1]),void(e<r.length-1&&(yield r[e+1]))}const a=e[t];if(-1===a)return;let c=a,l=-1;do{if(yield l=s[c],c=c%3==2?c-2:c+1,s[c]!==t)return;if(c=i[c],-1===c){const e=n[(o[t]+1)%n.length];return void(e!==l&&(yield e))}}while(c!==a)}find(t,e,n=0){if((t=+t)!=t||(e=+e)!=e)return-1;const o=n;let i;for(;(i=this._step(n,t,e))>=0&&i!==n&&i!==o;)n=i;return i}_step(t,e,n){const{inedges:o,hull:i,_hullIndex:s,halfedges:r,triangles:a,points:c}=this;if(-1===o[t]||!c.length)return(t+1)%(c.length>>1);let l=t,d=lt(e-c[2*t],2)+lt(n-c[2*t+1],2);const h=o[t];let u=h;do{let o=a[u];const h=lt(e-c[2*o],2)+lt(n-c[2*o+1],2);if(h<d&&(d=h,l=o),u=u%3==2?u-2:u+1,a[u]!==t)break;if(u=r[u],-1===u){if(u=i[(s[t]+1)%i.length],u!==o&&lt(e-c[2*u],2)+lt(n-c[2*u+1],2)<d)return u;break}}while(u!==h);return l}render(t){const e=null==t?t=new st:void 0,{points:n,halfedges:o,triangles:i}=this;for(let e=0,s=o.length;e<s;++e){const s=o[e];if(s<e)continue;const r=2*i[e],a=2*i[s];t.moveTo(n[r],n[r+1]),t.lineTo(n[a],n[a+1])}return this.renderHull(t),e&&e.value()}renderPoints(t,e){void 0!==e||t&&"function"==typeof t.moveTo||(e=t,t=null),e=null==e?2:+e;const n=null==t?t=new st:void 0,{points:o}=this;for(let n=0,i=o.length;n<i;n+=2){const i=o[n],s=o[n+1];t.moveTo(i+e,s),t.arc(i,s,e,0,ct)}return n&&n.value()}renderHull(t){const e=null==t?t=new st:void 0,{hull:n,points:o}=this,i=2*n[0],s=n.length;t.moveTo(o[i],o[i+1]);for(let e=1;e<s;++e){const i=2*n[e];t.lineTo(o[i],o[i+1])}return t.closePath(),e&&e.value()}hullPolygon(){const t=new rt;return this.renderHull(t),t.value()}renderTriangle(t,e){const n=null==e?e=new st:void 0,{points:o,triangles:i}=this,s=2*i[t*=3],r=2*i[t+1],a=2*i[t+2];return e.moveTo(o[s],o[s+1]),e.lineTo(o[r],o[r+1]),e.lineTo(o[a],o[a+1]),e.closePath(),n&&n.value()}*trianglePolygons(){const{triangles:t}=this;for(let e=0,n=t.length/3;e<n;++e)yield this.trianglePolygon(e)}trianglePolygon(t){const e=new rt;return this.renderTriangle(t,e),e.value()}}function ft(t,e,n){const o=e.getCandidates(),i=o.map((t=>[t.x,t.y])),s=pt.from(i).voronoi([0,0,n.width,n.height]);this.render=function(){const{ctx:e}=n;e.save(),e.beginPath(),e.arc(t.x,t.y,.5*t.shape2.w,0,2*Math.PI),e.clip();const i=o.length;for(let t=0;t<i;t++)e.beginPath(),s.renderCell(t,e),e.fillStyle=o[t].color,e.fill(),e.stroke();e.beginPath(),e.arc(t.x,t.y,.5*t.shape2.w,0,2*Math.PI),e.stroke(),e.restore()}}function mt(t,e,n,o){let i=[],s=[];this.update=function(r){const a=t.getVoterShapes();if("castPlurality"===o.election.countVotes.caster)i=a.map((t=>new ft(t,e,n)));else{if(r.error)return;s=[];for(let t=0;t<r.gridData.length;t++){const o=new R(r.gridData[t],e,n);s.push(o)}}},this.render=function(){"castPlurality"===o.election.countVotes.caster?i.forEach((t=>t.render())):s.forEach((t=>t.render()))}}function gt(t,e,n,o,i){const s=this;F.call(s,t,n,i);const r=new b(i),a=new v(i);s.addSimCandidate=t=>{a.newCandidate(new w(t,s.dragm))},s.addSimVoterCircle=e=>{r.newVoterSim(new D(e,s.dragm,t))};const c=new mt(r,a,t,i),l=s.enter;s.enter=()=>{l(),i.candidateAdd.canButton.show(),i.election.setDimensions(2),r.updateXY(),a.updateXY(),i.voterTest.updateXY()},s.exit=()=>{t.hideMaps(),i.candidateAdd.canButton.hide(),i.voterTest.setE(0)},s.update=()=>{if(n.checkNone())return;n.check(["simType","electionMethod"])&&("castScore"===i.election.countVotes.caster?t.showMaps():t.hideMaps()),n.clear();const e=o.updateTallies(r,a);c.update(e),i.voterTest.update(),t.clear(),t.clearMaps(),s.render()},s.testVote=()=>o.testVote(i.voterTest,a),s.render=()=>{c.render()},s.renderForeground=()=>{r.renderForeground(),a.renderForeground(),i.voterTest.renderForeground()}}function yt(t){const e=function(t){const e=t.map((t=>t.shape2.w**2)),n=e.reduce(((t,e)=>t+e)),o=e.map((t=>t/n)),i=[];return o.reduce(((t,e,n)=>{const o=t+e;return i[n]=o,o}),0),i}(t);this.samplePoint=function(){return function(t,e){const n=function(t){const e=Math.random();return t.findIndex((t=>t>=e))}(e),o=t[n];return function(t,e,n){const o=n*Math.sqrt(Math.random()),i=2*Math.random()*Math.PI,s=t+o*Math.cos(i),r=e+o*Math.sin(i);return{x:s,y:r}}(o.shape2.x,o.shape2.y,.5*o.shape2.w)}(t,e)}}function _t(t){const e=this,n=[];e.newCandidate=function(t){n.push(t)},e.getSimCandidateDistributions=()=>n.filter((t=>t.canDn.exists)),e.getCandidateDistributions=()=>e.getSimCandidateDistributions().map((t=>t.canDn)),e.getCandidateDistributionsAll=()=>n.map((t=>t.canDn)),e.startSampler=()=>{const t=e.getCandidateDistributions();0!==t.length&&(e.sampler=new yt(t))},e.updateXY=()=>{n.forEach((t=>t.canDn.updateXY()))},e.render=()=>{e.getCandidateDistributions().forEach((t=>t.render()))},e.renderForeground=()=>{t.showGhosts?e.renderForegroundAll():e.renderForegroundExisting()},e.renderForegroundExisting=()=>{e.getCandidateDistributions().forEach((t=>t.renderForeground()))},e.renderForegroundAll=()=>{e.getCandidateDistributionsAll().forEach((t=>t.renderForeground()))}}function xt(t,e){const n=this;n.canDn=t,e.newSquareHandle(t,t.square),n.renderForeground=()=>{n.canDn.renderForeground()}}function wt(t,e){const n=this,o=document.createElement("canvas");o.width=e.canvas.width,o.height=e.canvas.height;const i=o.getContext("2d");function s(t,e){t.fillStyle="grey";const n=e.length;for(let o=0;o<n;o++){const n=e[o];t.beginPath(),t.arc(n.x,n.y,3,0,2*Math.PI),t.fill()}}n.start=function(){i.clearRect(0,0,o.width,o.height)},n.update=function(t,e){n.points=e,function(t){s(i,t)}(t)},n.render=()=>{n.renderCans(),n.renderVoters()},n.renderCans=function(){e.noBuffers?function(){const{ctx:t}=e;s(t,n.points)}():function(){const{ctx:t}=e;t.drawImage(o,0,0)}()},n.renderVoters=function(){const{ctx:n}=e;t.getVoterShapes().forEach((t=>{n.beginPath();const{x:e,y:o,shape2:i}=t;n.arc(e,o,.5*i.w,0,2*Math.PI),n.stroke()}))}}function vt(t,e,n,o,i){const s=this;F.call(s,t,n,i);const r=new _t(i);s.addSimCandidateDistribution=t=>{r.newCandidate(new xt(t,s.dragm))};const a=new b(i);s.addSimVoterCircle=e=>{a.newVoterSim(new D(e,s.dragm,t))};const c=new wt(a,t),l=s.enter;s.enter=()=>{l(),i.candidateDnAdd.canDnButton.show(),i.election.setDimensions(2),a.updateXY(),r.updateXY()},s.exit=()=>{i.candidateDnAdd.canDnButton.hide()},s.update=()=>{if(n.checkNone()){const e=o.addSim(a,r),{noChange:n,newPoints:i,points:l}=e;n||(c.update(i,l),t.clear(),s.render())}else n.clear(),r.startSampler(),c.start(),o.startSim(),t.clear(),s.render()},s.render=()=>{c.render(),r.render()},s.renderForeground=()=>{a.renderForeground(),r.renderForeground()}}function bt(t,e,n){const o=this;D.call(o,t,e),o.render=function(){const{ctx:t}=n,{x:e,y:i,shape2:s}=o.voterShape;t.beginPath(),t.arc(e,i,.5*s.w,0,2*Math.PI),t.stroke()},o.renderAt=function(t,e){const{ctx:i}=n,{w:s}=o.voterShape.shape2;i.beginPath(),i.arc(t,e,.5*s,0,2*Math.PI),i.stroke()},o.renderCenterAt=function(t,e){const{ctx:o}=n;o.beginPath(),o.fillStyle="#555",o.arc(t,e,1,0,2*Math.PI),o.fill()}}const Ct=.5*(Math.sqrt(3)-1),St=(3-Math.sqrt(3))/6,At=1/6,Et=(Math.sqrt(5)-1)/4,Mt=(5-Math.sqrt(5))/20,kt=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),Tt=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);class Pt{constructor(t=Math.random){const e="function"==typeof t?t:function(t){let e=0,n=0,o=0,i=1;const s=function(){let t=4022871197;return function(e){e=e.toString();for(let n=0;n<e.length;n++){t+=e.charCodeAt(n);let o=.02519603282416938*t;t=o>>>0,o-=t,o*=t,t=o>>>0,o-=t,t+=4294967296*o}return 2.3283064365386963e-10*(t>>>0)}}();e=s(" "),n=s(" "),o=s(" "),e-=s(t),e<0&&(e+=1);n-=s(t),n<0&&(n+=1);o-=s(t),o<0&&(o+=1);return function(){const t=2091639*e+2.3283064365386963e-10*i;return e=n,n=o,o=t-(i=0|t)}}(t);this.p=function(t){const e=new Uint8Array(256);for(let t=0;t<256;t++)e[t]=t;for(let n=0;n<255;n++){const o=n+~~(t()*(256-n)),i=e[n];e[n]=e[o],e[o]=i}return e}(e),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let t=0;t<512;t++)this.perm[t]=this.p[255&t],this.permMod12[t]=this.perm[t]%12}noise2D(t,e){const n=this.permMod12,o=this.perm;let i=0,s=0,r=0;const a=(t+e)*Ct,c=Math.floor(t+a),l=Math.floor(e+a),d=(c+l)*St,h=t-(c-d),u=e-(l-d);let p,f;h>u?(p=1,f=0):(p=0,f=1);const m=h-p+St,g=u-f+St,y=h-1+2*St,_=u-1+2*St,x=255&c,w=255&l;let v=.5-h*h-u*u;if(v>=0){const t=3*n[x+o[w]];v*=v,i=v*v*(kt[t]*h+kt[t+1]*u)}let b=.5-m*m-g*g;if(b>=0){const t=3*n[x+p+o[w+f]];b*=b,s=b*b*(kt[t]*m+kt[t+1]*g)}let C=.5-y*y-_*_;if(C>=0){const t=3*n[x+1+o[w+1]];C*=C,r=C*C*(kt[t]*y+kt[t+1]*_)}return 70*(i+s+r)}noise3D(t,e,n){const o=this.permMod12,i=this.perm;let s,r,a,c;const l=.3333333333333333*(t+e+n),d=Math.floor(t+l),h=Math.floor(e+l),u=Math.floor(n+l),p=(d+h+u)*At,f=t-(d-p),m=e-(h-p),g=n-(u-p);let y,_,x,w,v,b;f>=m?m>=g?(y=1,_=0,x=0,w=1,v=1,b=0):f>=g?(y=1,_=0,x=0,w=1,v=0,b=1):(y=0,_=0,x=1,w=1,v=0,b=1):m<g?(y=0,_=0,x=1,w=0,v=1,b=1):f<g?(y=0,_=1,x=0,w=0,v=1,b=1):(y=0,_=1,x=0,w=1,v=1,b=0);const C=f-y+At,S=m-_+At,A=g-x+At,E=f-w+.3333333333333333,M=m-v+.3333333333333333,k=g-b+.3333333333333333,T=f-1+.5,P=m-1+.5,F=g-1+.5,D=255&d,N=255&h,V=255&u;let L=.6-f*f-m*m-g*g;if(L<0)s=0;else{const t=3*o[D+i[N+i[V]]];L*=L,s=L*L*(kt[t]*f+kt[t+1]*m+kt[t+2]*g)}let I=.6-C*C-S*S-A*A;if(I<0)r=0;else{const t=3*o[D+y+i[N+_+i[V+x]]];I*=I,r=I*I*(kt[t]*C+kt[t+1]*S+kt[t+2]*A)}let O=.6-E*E-M*M-k*k;if(O<0)a=0;else{const t=3*o[D+w+i[N+v+i[V+b]]];O*=O,a=O*O*(kt[t]*E+kt[t+1]*M+kt[t+2]*k)}let R=.6-T*T-P*P-F*F;if(R<0)c=0;else{const t=3*o[D+1+i[N+1+i[V+1]]];R*=R,c=R*R*(kt[t]*T+kt[t+1]*P+kt[t+2]*F)}return 32*(s+r+a+c)}noise4D(t,e,n,o){const i=this.perm;let s,r,a,c,l;const d=(t+e+n+o)*Et,h=Math.floor(t+d),u=Math.floor(e+d),p=Math.floor(n+d),f=Math.floor(o+d),m=(h+u+p+f)*Mt,g=t-(h-m),y=e-(u-m),_=n-(p-m),x=o-(f-m);let w=0,v=0,b=0,C=0;g>y?w++:v++,g>_?w++:b++,g>x?w++:C++,y>_?v++:b++,y>x?v++:C++,_>x?b++:C++;const S=w>=3?1:0,A=v>=3?1:0,E=b>=3?1:0,M=C>=3?1:0,k=w>=2?1:0,T=v>=2?1:0,P=b>=2?1:0,F=C>=2?1:0,D=w>=1?1:0,N=v>=1?1:0,V=b>=1?1:0,L=C>=1?1:0,I=g-S+Mt,O=y-A+Mt,R=_-E+Mt,B=x-M+Mt,q=g-k+2*Mt,$=y-T+2*Mt,j=_-P+2*Mt,U=x-F+2*Mt,H=g-D+3*Mt,G=y-N+3*Mt,W=_-V+3*Mt,X=x-L+3*Mt,Y=g-1+4*Mt,z=y-1+4*Mt,J=_-1+4*Mt,K=x-1+4*Mt,Q=255&h,Z=255&u,tt=255&p,et=255&f;let nt=.6-g*g-y*y-_*_-x*x;if(nt<0)s=0;else{const t=i[Q+i[Z+i[tt+i[et]]]]%32*4;nt*=nt,s=nt*nt*(Tt[t]*g+Tt[t+1]*y+Tt[t+2]*_+Tt[t+3]*x)}let ot=.6-I*I-O*O-R*R-B*B;if(ot<0)r=0;else{const t=i[Q+S+i[Z+A+i[tt+E+i[et+M]]]]%32*4;ot*=ot,r=ot*ot*(Tt[t]*I+Tt[t+1]*O+Tt[t+2]*R+Tt[t+3]*B)}let it=.6-q*q-$*$-j*j-U*U;if(it<0)a=0;else{const t=i[Q+k+i[Z+T+i[tt+P+i[et+F]]]]%32*4;it*=it,a=it*it*(Tt[t]*q+Tt[t+1]*$+Tt[t+2]*j+Tt[t+3]*U)}let st=.6-H*H-G*G-W*W-X*X;if(st<0)c=0;else{const t=i[Q+D+i[Z+N+i[tt+V+i[et+L]]]]%32*4;st*=st,c=st*st*(Tt[t]*H+Tt[t+1]*G+Tt[t+2]*W+Tt[t+3]*X)}let rt=.6-Y*Y-z*z-J*J-K*K;if(rt<0)l=0;else{const t=i[Q+1+i[Z+1+i[tt+1+i[et+1]]]]%32*4;rt*=rt,l=rt*rt*(Tt[t]*Y+Tt[t+1]*z+Tt[t+2]*J+Tt[t+3]*K)}return 27*(s+r+a+c+l)}}function Ft(t,e){const n=this;n.sn=[];n.genNoise=()=>{n.sn=function(t,e,n,o,i,s){const r=new Pt("s"),a=new Pt("seed"),c=function(t,e){return Array(t).fill().map((()=>Array(e).fill().map((()=>Array(2).fill(0)))))}(t,e);let l=0,d=0;Dt(t).forEach((i=>{Dt(e).forEach((s=>{const h=i/t*(1/n),u=s/e*(1/o),p=r.noise2D(h,u),f=a.noise2D(h,u);c[i][s][0]=p-.5,c[i][s][1]=f-.5,l+=p,d+=f}))}));const h=l/(t*e)-.5,u=d/(t*e)-.5;return c.forEach((t=>{t.forEach((t=>{t[0]=(t[0]-h)*i,t[1]=(t[1]-u)*s}))})),c}(t,e,.5,.5,100,100)}}function Dt(t){return[...Array(t).keys()]}function Nt(t){for(var e,n=-1,o=t.length,i=t[o-1],s=0;++n<o;)e=i,i=t[n],s+=e[1]*i[0]-e[0]*i[1];return s/2}function Vt(t){for(var e,n,o=-1,i=t.length,s=0,r=0,a=t[i-1],c=0;++o<i;)e=a,a=t[o],c+=n=e[0]*a[1]-a[0]*e[1],s+=(e[0]+a[0])*n,r+=(e[1]+a[1])*n;return[s/(c*=3),r/c]}function Lt(t,e,n,o){let i,s,r=function(t,e,n){return Array(n).fill().map((()=>[Math.random()*t,Math.random()*e]))}(t,e,n),a=!1;const c=o*Math.min(t,e);for(let n=0;n<1e3;n++)if([r,a,i,s]=It(r,t,e,c),a)return r;return[r,i,s]}function It(t,e,n,o){const i=pt.from(t).voronoi([0,0,e,n]),s=(r=t.length,[...Array(r).keys()]).map((t=>i.cellPolygon(t)));var r;const a=s.map(Vt),c=t.every(((t,e)=>{return n=t,i=a[e],n**2+i**2<o;var n,i}));return[a,c,i,s]}function Ot(t,e,n,o,i,s,r,a,c){a.save(),a.globalAlpha=r,a.textAlign=c||"center",a.font=`${o}px Sans-serif`,a.lineWidth=i,a.fillStyle=s,a.fillText(t,e,n),a.restore()}function Rt(t,e){const n=$t(e),o=t.length-$t(t),i=e.slice();for(let e,s,r,a=0,c=t[o-1];a<o;++a){const o=i.slice(),l=o.length-n;i.length=0,e=t[a],s=o[l-1];for(let t=0;t<l;++t)r=o[t],Bt(r,c,e)?(Bt(s,c,e)||i.push(qt(s,r,c,e)),i.push(r)):Bt(s,c,e)&&i.push(qt(s,r,c,e)),s=r;n&&i.push(i[0]),c=e}return i.length?i:null}function Bt([t,e],[n,o],[i,s]){return(i-n)*(e-o)<(s-o)*(t-n)}function qt([t,e],[n,o],[i,s],[r,a]){const c=n-t,l=o-e,d=r-i,h=a-s,u=(c*(s-e)-l*(i-t))/(l*d-c*h);return[i+u*d,s+u*h]}function $t(t){const[e,n]=t[0],[o,i]=t[t.length-1];return e===o&&n===i}function jt(t,e){return[[t,e],[t,e+1],[t+1,e+1],[t+1,e]]}function Ut(t){const e=this;function n(n){const{mctx:o}=t,i=e.centroids[n];Ot(e.polygonAreas[n].toFixed(0),i[0],i[1]+.5-.2,1,.2,"#222",1,o)}e.make=(t,n,o)=>{[e.centroids,e.voronoi,e.polygons]=Lt(t,n,o,.01),e.nx=t,e.ny=n,e.nd=o,e.polygonAreas=e.polygons.map(Nt).map((t=>-t)),e.totalArea=t*n,e.census=function(t){const{nd:e,nx:n,ny:o,polygons:i}=t,s=Array(e).fill().map((()=>[]));for(let t=0;t<n;t++)for(let n=0;n<o;n++){const o=jt(t,n);C(e).forEach((e=>{var r;const a=Rt((r=i[e],JSON.parse(JSON.stringify(r))).reverse(),o);null!==a&&s[e].push([t,n,Nt(a)])}))}return s}(e)},e.renderVoronoi=(t,o)=>{e.renderVoronoiGeneral(0,0,t,o,null,n)},e.renderVoronoiColors=(t,n,o,i,s)=>{e.renderVoronoiGeneral(t,n,o,i,s,void 0)},e.renderVoronoiGeneral=(n,o,i,s,r,a)=>{const{mctx:c}=t,{voronoi:l,nx:d,ny:h,nd:u}=e;c.save();const p=i/d,f=s/h;c.translate(n,o),c.scale(p,f);for(let t=0;t<u;t++)c.beginPath(),c.strokeStyle="#333",c.lineWidth=1/p,l.renderCell(t,c),null!==r&&(c.fillStyle=r[t],c.fill()),c.stroke(),void 0!==a&&a(t);c.restore()}}function Ht(t,e,n){const o=this;b.call(o,n);o.nx=20,o.ny=20,o.districtMaker=new Ut(t),o.geoNoise=new Ft(o.nx,o.ny),o.geoNoise.genNoise();let i=[];o.updateDistricts=()=>{o.districtMaker.make(o.nx,o.ny,20)},o.updateVoters=()=>{i=o.getVoterSims(),o.updateFullSet(),o.updateVotersByDistrict(),o.updateVotersByTract()},o.updateFullSet=()=>{const{sn:t}=o.geoNoise;o.allVoterGroups=i.map((e=>t.map((t=>t.map((t=>{const[n,o]=t,i=structuredClone(e.voterShape.shape2);i.x+=n,i.y+=o;const{shape1:s}=e.voterShape;return{shape2:i,shape1:s}})).flat())).flat())).flat()},o.updateVotersByDistrict=()=>{const{census:t}=o.districtMaker,{sn:e}=o.geoNoise;o.voterGroupsByDistrict=C(20).map((n=>i.map((o=>t[n].map((t=>{const[n,i,s]=t,[r,a]=e[n][i],c=structuredClone(o.voterShape.shape2);c.x+=r,c.y+=a;const{shape1:l}=o.voterShape;return{shape2:c,shape1:l,weight:s}})).flat())).flat()))},o.updateVotersByTract=()=>{const{sn:t}=o.geoNoise;o.voterGroupsByTract=t.map((t=>t.map((t=>i.map((e=>{const[n,o]=t,i=structuredClone(e.voterShape.shape2);i.x+=n,i.y+=o;const{shape1:s}=e.voterShape;return{shape2:i,shape1:s}})).flat()))))}}function Gt(t,e,n){const o=this,i=document.createElement("canvas");i.width=t,i.height=e;const s=i.getContext("2d"),r=s.createImageData(t,e);o.load=n=>{const{data:o}=r;for(let i=0;i<t;i++)for(let s=0;s<e;s++){const e=n[i][s][0]+.5,r=n[i][s][1]+.5;o[4*(i+s*t)+0]=255*e,o[4*(i+s*t)+1]=200*(e+r),o[4*(i+s*t)+2]=200*r,o[4*(i+s*t)+3]=255}s.putImageData(r,0,0)},o.loadColors=n=>{const{data:o}=r;for(let i=0;i<e;i++)for(let e=0;e<t;e++){const s=n[e][i],[r,a,c]=s;o[4*(e+i*t)+0]=r,o[4*(e+i*t)+1]=a,o[4*(e+i*t)+2]=c,o[4*(e+i*t)+3]=255}s.putImageData(r,0,0)},o.render=(t,e)=>{const{mctx:o}=n;o.save(),o.imageSmoothingEnabled=!1,o.drawImage(i,0,0,t,e),o.restore()}}function Wt(t,e){const n=this;n.noiseImage=new Gt(t.nx,t.ny,e),n.update=t=>{const{colorByTract:e,colorOfVoteByDistrict:o,colorOfWinsByDistrict:i}=t;n.colorOfVoteByDistrict=o,n.winnerColors=i,n.noiseImage.loadColors(e)};const o=100,i=100;n.render=()=>{t.voterGroupsByTract.forEach((t=>{t.forEach((t=>{t.forEach((t=>{!function(t,n){const{ctx:o}=e;o.drawImage(s,t-5,n-5,10,10)}(t.shape2.x,t.shape2.y)}))}))})),n.renderTractVotes(),n.renderDistrictWins(),n.renderDistrictVotes(),n.renderVoterBasisSet()},n.renderTractVotes=()=>{n.noiseImage.render(o,i),t.districtMaker.renderVoronoi(o,i)},n.renderDistrictWins=()=>{const{renderVoronoiColors:e}=t.districtMaker;e(200,0,o,i,n.winnerColors)},n.renderDistrictVotes=()=>{const{renderVoronoiColors:e}=t.districtMaker;e(100,0,o,i,n.colorOfVoteByDistrict)},n.renderVoterBasisSet=()=>{t.getVoterSims().forEach((t=>t.render()))};const s=document.createElement("canvas"),r=s.getContext("2d");s.width=10,s.height=10,r.beginPath(),r.fillStyle="#555",r.arc(5,5,1,0,2*Math.PI),r.fill()}function Xt(t,e,n,o,i){const s=this;F.call(s,t,n,i);const r=new Ht(t,o,i),a=new v(i);s.addSimCandidate=t=>{a.newCandidate(new w(t,s.dragm))},s.addSimVoterCircle=e=>{r.newVoterSim(new bt(e,s.dragm,t))};const c=new Wt(r,t);n.add(["districts"]);const l=s.enter;s.enter=()=>{l(),t.showMaps(),i.candidateAdd.canButton.show(),i.election.setDimensions(2),r.updateXY(),a.updateXY(),i.voterTest.updateXY()},s.exit=()=>{t.hideMaps(),i.candidateAdd.canButton.hide();const e=Array(a.numCandidates()).fill(void 0);a.setCandidateWins(e),i.voterTest.setE(0)},s.update=()=>{if(n.checkNone())return;n.check(["districts","simType"])&&r.updateDistricts(),n.clear(),r.updateVoters();const e=o.updateVotes(r,a);c.update(e),i.voterTest.update(),t.clear(),s.render()},s.testVote=()=>o.testVote(i.voterTest,a),s.render=()=>{c.render()},s.renderForeground=()=>{a.renderForeground(),r.renderForeground(),i.voterTest.renderForeground()}}function Yt(){const t=this,e=[];let n=0;t.new=function(t){e.push(t);const o=n;return n+=1,o},t.num=()=>n,t.get=t=>e[t]}function zt(){throw new Error("setTimeout has not been defined")}function Jt(){throw new Error("clearTimeout has not been defined")}var Kt,Qt=zt,Zt=Jt;function te(t){if(Qt===setTimeout)return setTimeout(t,0);if((Qt===zt||!Qt)&&setTimeout)return Qt=setTimeout,setTimeout(t,0);try{return Qt(t,0)}catch(e){try{return Qt.call(null,t,0)}catch(e){return Qt.call(this,t,0)}}}"function"==typeof(Kt="undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).setTimeout&&(Qt=setTimeout),"function"==typeof Kt.clearTimeout&&(Zt=clearTimeout);var ee,ne=[],oe=!1,ie=-1;function se(){oe&&ee&&(oe=!1,ee.length?ne=ee.concat(ne):ie=-1,ne.length&&re())}function re(){if(!oe){var t=te(se);oe=!0;for(var e=ne.length;e;){for(ee=ne,ne=[];++ie<e;)ee&&ee[ie].run();ie=-1,e=ne.length}ee=null,oe=!1,function(t){if(Zt===clearTimeout)return clearTimeout(t);if((Zt===Jt||!Zt)&&clearTimeout)return Zt=clearTimeout,clearTimeout(t);try{Zt(t)}catch(e){try{return Zt.call(null,t)}catch(e){return Zt.call(this,t)}}}(t)}}function ae(t,e){this.fun=t,this.array=e}ae.prototype.run=function(){this.fun.apply(null,this.array)};function ce(){}var le=ce,de=ce,he=ce,ue=ce,pe=ce,fe=ce,me=ce;var ge=Kt.performance||{},ye=ge.now||ge.mozNow||ge.msNow||ge.oNow||ge.webkitNow||function(){return(new Date).getTime()};var _e=new Date;var xe,we={nextTick:function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];ne.push(new ae(t,e)),1!==ne.length||oe||te(re)},title:"browser",browser:!0,env:{NODE_ENV:"production"},argv:[],version:"",versions:{},on:le,addListener:de,once:he,off:ue,removeListener:pe,removeAllListeners:fe,emit:me,binding:function(t){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(t){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(t){var e=.001*ye.call(ge),n=Math.floor(e),o=Math.floor(e%1*1e9);return t&&(n-=t[0],(o-=t[1])<0&&(n--,o+=1e9)),[n,o]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-_e)/1e3}},ve={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-ve.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*ve.Bounce.In(2*t):.5*ve.Bounce.Out(2*t-1)+.5}}},be="undefined"==typeof self&&void 0!==we&&we.hrtime?function(){var t=we.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?self.performance.now.bind(self.performance):void 0!==Date.now?Date.now:function(){return(new Date).getTime()},Ce=function(){function t(){this._tweens={},this._tweensAddedDuringUpdate={}}return t.prototype.getAll=function(){var t=this;return Object.keys(this._tweens).map((function(e){return t._tweens[e]}))},t.prototype.removeAll=function(){this._tweens={}},t.prototype.add=function(t){this._tweens[t.getId()]=t,this._tweensAddedDuringUpdate[t.getId()]=t},t.prototype.remove=function(t){delete this._tweens[t.getId()],delete this._tweensAddedDuringUpdate[t.getId()]},t.prototype.update=function(t,e){void 0===t&&(t=be()),void 0===e&&(e=!1);var n=Object.keys(this._tweens);if(0===n.length)return!1;for(;n.length>0;){this._tweensAddedDuringUpdate={};for(var o=0;o<n.length;o++){var i=this._tweens[n[o]],s=!e;i&&!1===i.update(t,s)&&!e&&delete this._tweens[n[o]]}n=Object.keys(this._tweensAddedDuringUpdate)}return!0},t}(),Se={Linear:function(t,e){var n=t.length-1,o=n*e,i=Math.floor(o),s=Se.Utils.Linear;return e<0?s(t[0],t[1],o):e>1?s(t[n],t[n-1],n-o):s(t[i],t[i+1>n?n:i+1],o-i)},Bezier:function(t,e){for(var n=0,o=t.length-1,i=Math.pow,s=Se.Utils.Bernstein,r=0;r<=o;r++)n+=i(1-e,o-r)*i(e,r)*t[r]*s(o,r);return n},CatmullRom:function(t,e){var n=t.length-1,o=n*e,i=Math.floor(o),s=Se.Utils.CatmullRom;return t[0]===t[n]?(e<0&&(i=Math.floor(o=n*(1+e))),s(t[(i-1+n)%n],t[i],t[(i+1)%n],t[(i+2)%n],o-i)):e<0?t[0]-(s(t[0],t[0],t[1],t[1],-o)-t[0]):e>1?t[n]-(s(t[n],t[n],t[n-1],t[n-1],o-n)-t[n]):s(t[i?i-1:0],t[i],t[n<i+1?n:i+1],t[n<i+2?n:i+2],o-i)},Utils:{Linear:function(t,e,n){return(e-t)*n+t},Bernstein:function(t,e){var n=Se.Utils.Factorial;return n(t)/n(e)/n(t-e)},Factorial:(xe=[1],function(t){var e=1;if(xe[t])return xe[t];for(var n=t;n>1;n--)e*=n;return xe[t]=e,e}),CatmullRom:function(t,e,n,o,i){var s=.5*(n-t),r=.5*(o-e),a=i*i;return(2*e-2*n+s+r)*(i*a)+(-3*e+3*n-2*s-r)*a+s*i+e}}},Ae=function(){function t(){}return t.nextId=function(){return t._nextId++},t._nextId=0,t}(),Ee=new Ce,Me=function(){function t(t,e){void 0===e&&(e=Ee),this._object=t,this._group=e,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=ve.Linear.None,this._interpolationFunction=Se.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._id=Ae.nextId(),this._isChainStopped=!1,this._goToEnd=!1}return t.prototype.getId=function(){return this._id},t.prototype.isPlaying=function(){return this._isPlaying},t.prototype.isPaused=function(){return this._isPaused},t.prototype.to=function(t,e){return this._valuesEnd=Object.create(t),void 0!==e&&(this._duration=e),this},t.prototype.duration=function(t){return this._duration=t,this},t.prototype.start=function(t){if(this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed)for(var e in this._reversed=!1,this._valuesStartRepeat)this._swapEndStartRepeatValues(e),this._valuesStart[e]=this._valuesStartRepeat[e];return this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=void 0!==t?"string"==typeof t?be()+parseFloat(t):t:be(),this._startTime+=this._delayTime,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat),this},t.prototype._setupProperties=function(t,e,n,o){for(var i in n){var s=t[i],r=Array.isArray(s),a=r?"array":typeof s,c=!r&&Array.isArray(n[i]);if("undefined"!==a&&"function"!==a){if(c){var l=n[i];if(0===l.length)continue;l=l.map(this._handleRelativeValue.bind(this,s)),n[i]=[s].concat(l)}if("object"!==a&&!r||!s||c)void 0===e[i]&&(e[i]=s),r||(e[i]*=1),o[i]=c?n[i].slice().reverse():e[i]||0;else{for(var d in e[i]=r?[]:{},s)e[i][d]=s[d];o[i]=r?[]:{},this._setupProperties(s,e[i],n[i],o[i])}}}},t.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},t.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},t.prototype.pause=function(t){return void 0===t&&(t=be()),this._isPaused||!this._isPlaying||(this._isPaused=!0,this._pauseStart=t,this._group&&this._group.remove(this)),this},t.prototype.resume=function(t){return void 0===t&&(t=be()),this._isPaused&&this._isPlaying?(this._isPaused=!1,this._startTime+=t-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this):this},t.prototype.stopChainedTweens=function(){for(var t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].stop();return this},t.prototype.group=function(t){return this._group=t,this},t.prototype.delay=function(t){return this._delayTime=t,this},t.prototype.repeat=function(t){return this._initialRepeat=t,this._repeat=t,this},t.prototype.repeatDelay=function(t){return this._repeatDelayTime=t,this},t.prototype.yoyo=function(t){return this._yoyo=t,this},t.prototype.easing=function(t){return this._easingFunction=t,this},t.prototype.interpolation=function(t){return this._interpolationFunction=t,this},t.prototype.chain=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._chainedTweens=t,this},t.prototype.onStart=function(t){return this._onStartCallback=t,this},t.prototype.onUpdate=function(t){return this._onUpdateCallback=t,this},t.prototype.onRepeat=function(t){return this._onRepeatCallback=t,this},t.prototype.onComplete=function(t){return this._onCompleteCallback=t,this},t.prototype.onStop=function(t){return this._onStopCallback=t,this},t.prototype.update=function(t,e){if(void 0===t&&(t=be()),void 0===e&&(e=!0),this._isPaused)return!0;var n,o,i=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(t>i)return!1;e&&this.start(t)}if(this._goToEnd=!1,t<this._startTime)return!0;!1===this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),o=(t-this._startTime)/this._duration,o=0===this._duration||o>1?1:o;var s=this._easingFunction(o);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,s),this._onUpdateCallback&&this._onUpdateCallback(this._object,o),1===o){if(this._repeat>0){for(n in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat)this._yoyo||"string"!=typeof this._valuesEnd[n]||(this._valuesStartRepeat[n]=this._valuesStartRepeat[n]+parseFloat(this._valuesEnd[n])),this._yoyo&&this._swapEndStartRepeatValues(n),this._valuesStart[n]=this._valuesStartRepeat[n];return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=t+this._repeatDelayTime:this._startTime=t+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var r=0,a=this._chainedTweens.length;r<a;r++)this._chainedTweens[r].start(this._startTime+this._duration);return this._isPlaying=!1,!1}return!0},t.prototype._updateProperties=function(t,e,n,o){for(var i in n)if(void 0!==e[i]){var s=e[i]||0,r=n[i],a=Array.isArray(t[i]),c=Array.isArray(r);!a&&c?t[i]=this._interpolationFunction(r,o):"object"==typeof r&&r?this._updateProperties(t[i],s,r,o):"number"==typeof(r=this._handleRelativeValue(s,r))&&(t[i]=s+(r-s)*o)}},t.prototype._handleRelativeValue=function(t,e){return"string"!=typeof e?e:"+"===e.charAt(0)||"-"===e.charAt(0)?t+parseFloat(e):parseFloat(e)},t.prototype._swapEndStartRepeatValues=function(t){var e=this._valuesStartRepeat[t],n=this._valuesEnd[t];this._valuesStartRepeat[t]="string"==typeof n?this._valuesStartRepeat[t]+parseFloat(n):this._valuesEnd[t],this._valuesEnd[t]=e},t}(),ke=(Ae.nextId,Ee);ke.getAll.bind(ke),ke.removeAll.bind(ke),ke.add.bind(ke),ke.remove.bind(ke),ke.update.bind(ke);function Te(t,e,n){const o=this;o.r=e,o.trueR=e,o.pickUp=function(){o.tween=new Me(o),o.tween.to({r:2*o.trueR},100),o.tween.start()},o.drop=function(){o.tween=new Me(o),o.tween.to({r:o.trueR},100),o.tween.start()},o.render=function(){const{fctx:e}=n,{color:i}=t;e.save(),o.tween&&o.tween.update(),0===t.exists&&(e.globalAlpha=.2),e.beginPath(),e.fillStyle=i,e.arc(t.x,t.y,o.r,0,2*Math.PI),e.fill(),e.stroke(),e.restore()}}function Pe(t,e){const n=n=>{if(!t.contains(n.target)&&((i=t)&&(i.offsetWidth||i.offsetHeight||i.getClientRects().length))){e()&&o()}var i},o=()=>{document.removeEventListener("mousedown",n),document.removeEventListener("touchstart",n)};document.addEventListener("mousedown",n),document.addEventListener("touchstart",n)}function Fe(t,e){const n=document.createElement("div");function o(){t.x>.5*e.width?(n.style.right=e.width-t.x+"px",n.style.left="unset"):(n.style.left=`${t.x}px`,n.style.right="unset"),n.style.top=`${t.y}px`}n.className="tooltipBox",n.style.position="absolute",o(),n.style.border="1px solid black",n.style.padding="4px",n.style.background="white";let i=!1;return Pe(n,(()=>!i&&(n.remove(),!0))),{box:n,update:o,setPin:t=>{i=t}}}function De(t,e,n){const o=Fe(t,e),{box:i}=o;i.innerText="- Properties -";const s={};s.exists=new Ne("checkbox","Exists","Exists: ",(e=>t.setE(e?1:0)),1===t.exists),i.appendChild(s.exists.div),1===n.election.dimensions?(t.shape1.w&&(s.w1=new Ne("range","Width","Width: ",(e=>t.setW1(e)),t.shape1.w),i.appendChild(s.w1.div)),t.shape1.densityProfile&&(s.densityProfile1=new Ne("select","Density Profile","Density Profile: ",(e=>t.setDensityProfile1(e)),t.shape1.densityProfile,["step","gaussian"]),i.appendChild(s.densityProfile1.div))):t.shape2.w&&(s.w2=new Ne("range","Width","Width: ",(e=>t.setW2(e)),t.shape2.w),i.appendChild(s.w2.div)),void 0!==t.setColor&&(s.color=new Ne("color","Color","Color: ",(e=>t.setColor(e)),t.color),i.appendChild(s.color.div)),s.showGhosts=new Ne("checkbox","Show Ghosts","Show Ghosts: ",(t=>n.setShowNonExistingEntities(t)),n.showGhosts),i.appendChild(s.showGhosts.div),e.tooltips.appendChild(i)}function Ne(t,e,n,o,i,s){const r=this;if(r.div=document.createElement("div"),"select"===t){r.input=document.createElement("select");for(let t=0;t<s.length;t++){const e=document.createElement("option");e.value=s[t],e.innerText=s[t],r.input.appendChild(e)}r.input.value=i,r.input.addEventListener("input",(()=>o(r.input.value)))}else r.input=document.createElement("input"),r.input.type=t,r.input.id=e,r.input.name=e,"checkbox"===t?(i&&(r.input.checked=!0),r.input.addEventListener("change",(()=>o(r.input.checked)))):"range"===t?(r.input.min=1,r.input.max=300,r.input.value=i,r.input.step=1,r.input.addEventListener("input",(()=>o(r.input.value)))):"color"===t&&(r.input.value=i,r.input.addEventListener("input",(()=>o(r.input.value))));r.label=document.createElement("label"),r.label.for=e,r.label.innerText=n,r.label.style["margin-right"]="4px",r.div.appendChild(r.label),r.div.appendChild(r.input)}function Ve(t,e,n,o,i,s,r,a,c){const l=this;l.shape1={},l.shape2={};const d=o.new(l);l.instantiate=()=>{const n={x:t.x,y:t.y},o=[a.setForListSenders.exists.command(d,1,0),a.setForListSenders.shape2p.command(d,n,n),a.setForListSenders.shape1x.command(d,e.x,e.x),a.setForListSenders.shape2w.command(d,t.w,t.w),a.setForListSenders.shape1w.command(d,e.w,e.w),a.setForListSenders.shape1densityProfile.command(d,e.densityProfile,e.densityProfile)];r?i.loadCommands(o):i.doCommands(o)},l.setAction={},l.setAction.exists=t=>{l.exists=t,s.add(["draggables"])},l.setE=t=>{const e=a.setForListSenders.exists.getCurrentValue(d);a.setForListSenders.exists.go(d,t,e)},l.setAction.shape2p=t=>{l.shape2.x=t.x,l.shape2.y=t.y,2===c.election.dimensions&&(l.x=t.x,l.y=t.y),s.add(["draggables"])},l.setAction.shape1x=t=>{l.shape1.x=t,1===c.election.dimensions&&(l.x=t,l.y=250),s.add(["draggables"])},l.setXY=t=>{if(1===c.election.dimensions){const e=a.setForListSenders.shape1x.getCurrentValue(d);a.setForListSenders.shape1x.go(d,t.x,e)}else{const e=a.setForListSenders.shape2p.getCurrentValue(d);a.setForListSenders.shape2p.go(d,t,e)}},l.updateXY=()=>{1===c.election.dimensions?l.setAction.shape1x(l.shape1.x):l.setAction.shape2p({x:l.shape2.x,y:l.shape2.y})},l.setAction.shape2w=t=>{l.shape2.w=t,s.add(["width"])},l.setW2=t=>{const e=a.setForListSenders.shape2w.getCurrentValue(d);a.setForListSenders.shape2w.go(d,t,e)},l.setAction.shape1w=t=>{l.shape1.w=t,s.add(["width"])},l.setW1=t=>{const e=a.setForListSenders.shape1w.getCurrentValue(d);a.setForListSenders.shape1w.go(d,t,e)},l.setAction.shape1densityProfile=t=>{l.shape1.densityProfile=t,s.add(["densityProfile"])},l.setDensityProfile1=t=>{const e=a.setForListSenders.shape1densityProfile.getCurrentValue(d);a.setForListSenders.shape1densityProfile.go(d,t,e)},l.instantiate(),l.click=()=>{De(l,n,c)},l.color="#88888888";const h=new Te(l,13,n);l.circle=h,l.renderForeground=()=>{h.render()}}function Le(t,e,n){const o=this;function i(n,i,s){o.setForListSenders[n]=e.addSenderForList({action:(e,i)=>{o.setNumberVoters(e+1);t.get(e).setAction[n](i)},name:`voters-${i}`,props:{isChain:s}})}o.setForListSenders={},i("exists","exists",!1),i("shape2p","shape2D-point",!0),i("shape1x","shape1D-x",!0),i("shape2w","shape2D-width",!0),i("shape1w","shape1D-width",!0),i("shape1densityProfile","shape1D-densityProfile",!1),o.setNumberVotersSender=e.addSender({action:t=>n.setNumberVotersAction(t),currentValue:0,name:"voters-setNumberAtLeast",props:{isFirstAction:!0}}),o.setNumberVoters=t=>{e.loadCommands([o.setNumberVotersSender.command(t)])}}function Ie(t,e,n,o,i,s){const r=this;!function(t,e){const n=document.createElement("button");n.innerText="Add Voter",n.className="button2",n.onclick=()=>{e.addVoterPressed()},t.newElement("addVoter",n)}(e,r);const a=new Yt,c=new Le(a,o,r);r.addVoterPressed=()=>{const t=a.num()+1;c.setNumberVoters(t)},r.setNumberVotersAction=t=>{for(;a.num()<t;)r.addVoterCircle({x:50,y:50,w:200},{x:50,w:200,densityProfile:"gaussian"},!1)},r.addVoterCircle=(e,r,l)=>{const d=new Ve(e,r,t,a,o,n,l,c,s);i.one2D.addSimVoterCircle(d),i.one1D.addSimVoterCircle(d),i.geoOne.addSimVoterCircle(d),i.sample.addSimVoterCircle(d);const h=a.num();c.setNumberVoters(h)}}function Oe(t,e,n,o){const i=this;i.w=e,i.h=n,i.trueW=e,i.trueH=n,i.pickUp=function(){i.tweenSq=new Me(i),i.tweenSq.to({w:i.trueW+10,h:i.trueH+10},100),i.tweenSq.start()},i.drop=function(){i.tweenSq=new Me(i),i.tweenSq.to({w:i.trueW,h:i.trueH},100),i.tweenSq.start()},i.render=function(){const{fctx:e}=o;e.save(),i.tweenSq&&i.tweenSq.update(),0===t.exists&&(e.globalAlpha=.2),e.beginPath(),e.fillStyle=t.color,e.rect(t.x-.5*i.w-.5,t.y-.5*i.h-.5,i.w+1,i.h+1),e.fill(),e.stroke(),e.restore()}}function Re(t,e,n,o,i,s,r,a,c,l,d,h){const u=this;u.shape1={},u.shape2={};const p=r.new(u);u.instantiate=()=>{const n={x:t.x,y:t.y},o=[d.setForListSenders.exists.command(p,1,0),d.setForListSenders.shape2p.command(p,n,n),d.setForListSenders.shape1x.command(p,e.x,e.x),d.setForListSenders.color.command(p,i,i)];l?a.loadCommands(o):a.doCommands(o)},u.setAction={},u.setAction.exists=t=>{u.exists=t,c.add(["draggables"])},u.setE=t=>{const e=d.setForListSenders.exists.getCurrentValue(p);d.setForListSenders.exists.go(p,t,e)},u.setAction.shape2p=t=>{u.shape2.x=t.x,u.shape2.y=t.y,2===h.election.dimensions&&(u.x=t.x,u.y=t.y),c.add(["draggables"])},u.setAction.shape1x=t=>{u.shape1.x=t,1===h.election.dimensions&&(u.x=t,u.y=250),c.add(["draggables"])},u.setXY=t=>{if(1===h.election.dimensions){const e=d.setForListSenders.shape1x.getCurrentValue(p);d.setForListSenders.shape1x.go(p,t.x,e)}else{const e=d.setForListSenders.shape2p.getCurrentValue(p);d.setForListSenders.shape2p.go(p,t,e)}},u.updateXY=()=>{1===h.election.dimensions?u.setAction.shape1x(u.shape1.x):u.setAction.shape2p({x:u.shape2.x,y:u.shape2.y})},u.setAction.color=t=>{u.color=t,c.add(["color"])},u.setColor=t=>{const e=d.setForListSenders.color.getCurrentValue(p);d.setForListSenders.color.go(p,t,e)},u.instantiate(),u.click=()=>{De(u,s,h)};const f=new Oe(u,n,o,s);u.square=f,u.fraction=0,u.setFraction=function(t){u.fraction=t},u.setWins=t=>{u.wins=t},u.renderForeground=function(){(f.render(),0!==u.exists)&&(Ot((100*u.fraction).toFixed(0),u.x,u.y-.5*f.h-2,20,2,"#222",1,s.fctx),void 0!==u.wins&&Ot(u.wins,u.x,u.y+.5*f.h+20+2,20,2,"#222",1,s.fctx))}}function Be(t,e,n){const o=this,i="candidates";function s(n,s,r){o.setForListSenders[n]=e.addSenderForList({action:(e,i)=>{o.setNumberCandidates(e+1);t.get(e).setAction[n](i)},name:`${i}-${s}`,props:{isChain:r}})}o.setForListSenders={},s("exists","exists",!1),s("shape2p","shape2D-point",!0),s("shape1x","shape1D-x",!0),s("color","color",!1),o.setNumberCandidatesSender=e.addSender({action:t=>{n.setNumberCandidatesAction(t)},currentValue:0,name:`${i}-setNumberAtLeast`,props:{isFirstAction:!0}}),o.setNumberCandidates=t=>{e.loadCommands([o.setNumberCandidatesSender.command(t)])}}function qe(t,e){const n=document.createElement("button");n.className="button2",n.innerText="Add Candidate",n.onclick=()=>{e.addCandidatePressed()},t.newElement("addCandidate",n),this.show=()=>{n.hidden=!1},this.hide=()=>{n.hidden=!0}}function $e(t,e,n,o,i,s){const r=this;r.canButton=new qe(e,r);const a=new Yt,c=new Be(a,o,r);r.addCandidatePressed=()=>{const t=a.num()+1;c.setNumberCandidates(t)},r.setNumberCandidatesAction=t=>{for(;a.num()<t;){const t=M("yellow");r.addCandidate({x:50,y:50},{x:50},t,!1)}},r.addCandidate=(e,r,l,d)=>{const h=new Re(e,r,21,21,l,t,a,o,n,d,c,s);i.one2D.addSimCandidate(h),i.one1D.addSimCandidate(h),i.geoOne.addSimCandidate(h);const u=a.num();c.setNumberCandidates(u)}}function je(t,e,n,o,i,s,r,a,c){const l=this;l.shape2={},l.shape1={};const d=o.new(l);l.instantiate=()=>{const n={x:t.x,y:t.y},o=[a.setForListSenders.exists.command(d,1,0),a.setForListSenders.shape2p.command(d,n,n),a.setForListSenders.shape1x.command(d,e.x,e.x),a.setForListSenders.shape2w.command(d,t.w,t.w)];r?i.loadCommands(o):i.doCommands(o)},l.setAction={},l.setAction.exists=t=>{l.exists=t,s.add(["draggables"])},l.setE=t=>{const e=a.setForListSenders.exists.getCurrentValue(d);a.setForListSenders.exists.go(d,t,e)},l.setAction.shape2p=t=>{l.shape2.x=t.x,l.shape2.y=t.y,2===c.election.dimensions&&(l.x=t.x,l.y=t.y),s.add(["draggables"])},l.setAction.shape1x=t=>{l.shape1.x=t,1===c.election.dimensions&&(l.x=t,l.y=150),s.add(["draggables"])},l.setXY=t=>{if(1===c.election.dimensions){const e=a.setForListSenders.shape1x.getCurrentValue(d);a.setForListSenders.shape1x.go(d,t.x,e)}else{const e=a.setForListSenders.shape2p.getCurrentValue(d);a.setForListSenders.shape2p.go(d,t,e)}},l.updateXY=()=>{1===c.election.dimensions?l.setAction.shape1x(l.shape1.x):l.setAction.shape2p({x:l.shape2.x,y:l.shape2.y})},l.setAction.shape2w=t=>{l.shape2.w=t,s.add(["width"])},l.setW2=t=>{const e=a.setForListSenders.shape2w.getCurrentValue(d);a.setForListSenders.shape2w.go(d,t,e)},l.instantiate(),l.click=()=>{De(l,n,c)},l.color="#ccc";const h=new Oe(l,21,21,n);l.square=h,l.render=function(){const{ctx:t}=n;t.beginPath(),t.arc(l.x,l.y,.5*l.shape2.w,0,2*Math.PI),t.stroke()},l.renderForeground=()=>{h.render()}}function Ue(t,e,n){const o=this,i="candidateDns";function s(n,s,r){o.setForListSenders[n]=e.addSenderForList({action:(e,i)=>{o.setNumberCandidateDns(e+1);t.get(e).setAction[n](i)},name:`${i}-${s}`,props:{isChain:r}})}o.setForListSenders={},s("exists","exists",!1),s("shape2p","shape2D-point",!0),s("shape1x","shape1D-x",!0),s("shape2w","shape2D-width",!0),o.setNumberCandidateDnsSender=e.addSender({action:t=>{n.setNumberCandidateDnsAction(t)},currentValue:0,name:`${i}-setNumberAtLeast`,props:{isFirstAction:!0}}),o.setNumberCandidateDns=t=>{e.loadCommands([o.setNumberCandidateDnsSender.command(t)])}}function He(t,e){const n=document.createElement("button");n.className="button2",n.innerText="Add Candidate Distribution",n.onclick=()=>{e.addCandidateDistributionPressed()},t.newElement("addCandidateDistribution",n),this.show=()=>{n.hidden=!1},this.hide=()=>{n.hidden=!0}}function Ge(t,e,n,o,i,s){const r=this;r.canDnButton=new He(e,r);const a=new Yt,c=new Ue(a,o,r);r.addCandidateDistributionPressed=()=>{const t=a.num()+1;c.setNumberCandidateDns(t)},r.setNumberCandidateDnsAction=t=>{for(;a.num()<t;)r.addCandidateDistribution({x:50,y:50,w:200},{x:50},!1)},r.addCandidateDistribution=(e,r,l)=>{const d=new je(e,r,t,a,o,n,l,c,s);i.sample.addSimCandidateDistribution(d);const h=a.num();c.setNumberCandidateDns(h)}}function We(t,e,n){const o=e.getCandidates(),{grid:i,voteSet:s,voterGeom:r}=t,{x:a,w:c,densityProfile:l}=r;this.render=function(){const{ctx:t}=n;t.save(),t.globalAlpha=.7;const e=o.length;for(let n=0;n<e;n++)t.fillStyle=o[n].color,t.strokeStyle=I([.8,.2],[o[n].color,"#000000"]),t.beginPath(),r(n,!1),t.fill(),t.stroke(),t.strokeStyle="#dddddd",t.beginPath(),r(n,!0),t.stroke();function r(o,r){const d="gaussian"===l,h=i.x,u=c/Math.sqrt(2*Math.PI),p=200/e,f=200-o*p,m=Math.max(-1,h[0]);t.moveTo(m,f);const g=h.length;for(let e=0;e<g;e+=1){const i=h[e];if(i<-1)continue;if(i>n.width+1)continue;const c=r?1:s[e].tallyFractions[o],l=f-p*(d?Math.exp(-.5*((i-a)/u)**2):1)*c;t.lineTo(i,l)}const y=Math.min(n.width+1,h[g-1]);t.lineTo(y,f),t.lineTo(m,f)}t.restore()}}function Xe(t,e,n){const o=e.getCandidates(),i=o.map((t=>[t.x,t.y])),s=pt.from(i).voronoi([0,0,n.width,n.height]);this.render=function(){const{ctx:e}=n,{x:i,shape1:r}=t,{w:a,densityProfile:c}=r,l=100;e.save(),e.beginPath(),h(),e.clip();const d=o.length;for(let t=0;t<d;t++)e.beginPath(),s.renderCell(t,e),e.fillStyle=o[t].color,e.fill(),e.stroke();function h(){"gaussian"===c?function(){const t=a/Math.sqrt(2*Math.PI),o=l,s=200;e.moveTo(0,s);const r=[];for(let a=0;a<=n.width;a+=1){const n=.5*((a-i)/t)**2,c=s-o*Math.exp(-n);r.push(c),e.lineTo(a,c)}e.lineTo(n.width,s),e.lineTo(0,s)}():e.rect(i-.5*a,100,a,l)}e.beginPath(),h(),e.stroke(),e.restore()}}function Ye(t,e,n,o){let i=[],s=[];this.update=function(r){const a=t.getVoterShapes();if("castPlurality"===o.election.countVotes.caster)i=a.map((t=>new Xe(t,e,n)));else{s=[];for(let t=0;t<r.gridData.length;t++){const o=new We(r.gridData[t],e,n);s.push(o)}}},this.render=function(){"castPlurality"===o.election.countVotes.caster?i.forEach((t=>t.render())):s.forEach((t=>t.render()))}}function ze(t,e,n,o,i){const s=this;F.call(s,t,n,i);const r=new b(i),a=new v(i);s.addSimCandidate=t=>{a.newCandidate(new w(t,s.dragm))},s.addSimVoterCircle=e=>{r.newVoterSim(new D(e,s.dragm,t))};const c=new Ye(r,a,t,i),l=s.enter;s.enter=()=>{l(),i.candidateAdd.canButton.show(),i.election.setDimensions(1),r.updateXY(),a.updateXY(),i.voterTest.updateXY()},s.exit=()=>{i.candidateAdd.canButton.hide(),i.voterTest.setE(0)},s.update=()=>{if(n.checkNone())return;n.clear();const e=o.updateTallies(r,a);c.update(e),i.voterTest.update(),t.clear(),s.render()},s.testVote=()=>o.testVote(i.voterTest,a),s.render=()=>{c.render()},s.renderForeground=()=>{r.renderForeground(),a.renderForeground(),i.voterTest.renderForeground()}}function Je(t,e,n){const o=Fe(t,e),{box:i,setPin:s}=o;i.innerText="- Test Vote - ";const r=document.createElement("button");r.className="button2",r.innerText="Pin",r.onclick=()=>{a=!a,s(a),r.innerText=a?"Pinned":"Pin"},i.appendChild(r);let a=!1;const c=document.createElement("button");return c.className="button2",c.innerText="X",c.onclick=()=>{i.remove(),t.setE(0)},i.appendChild(c),i.style.backgroundColor=n.color,e.tooltips.appendChild(i),{box:i,update:function(t){i.style.backgroundColor=t.color,o.update()}}}function Ke(t,e,n){const o=this;function i(){n.voterTest.setE(0)}o.shape1={},o.shape2={},o.setAction={},o.setAction.exists=t=>{o.exists=t},o.setE=t=>{o.setAction.exists(t)},o.setAction.shape2p=t=>{o.shape2.x=t.x,o.shape2.y=t.y,2===n.election.dimensions&&(o.x=t.x,o.y=t.y)},o.setAction.shape1x=t=>{o.shape1.x=t,1===n.election.dimensions&&(o.x=t,o.y=250)},o.setXY=t=>{1===n.election.dimensions?o.setAction.shape1x(t.x):o.setAction.shape2p(t),o.update()},o.updateXY=()=>{1===n.election.dimensions?o.setAction.shape1x(o.shape1.x):o.setAction.shape2p({x:o.shape2.x,y:o.shape2.y})},o.setAction.shape1x(0),o.setAction.shape2p({x:0,y:0}),o.start=e=>{n.voterTest.setE(1),n.voterTest.setXY(e),Pe(t.wrap,i)},o.color="#999";const s=new Te(o,9,t);o.circle=s,e.one2D.dragm.newCircleHandle(o,o.circle),e.one1D.dragm.newCircleHandle(o,o.circle),e.geoOne.dragm.newCircleHandle(o,o.circle),e.sample.dragm.newCircleHandle(o,o.circle);let r={};o.update=()=>{const t=n.testVote();return void 0===t?null:(o.color=t.color,r.box&&r.update(t),t)},o.click=()=>{const e=o.update();r.box&&r.box.remove(),r=Je(o,t,e)},o.renderForeground=()=>{(o.exists||n.showGhosts)&&s.render()}}function Qe(t){const e={usr:4};this.updateTallies=function(n,o){if(0===n.getVoterShapes().length)return{error:"No Voters"};if(0===o.getCandidates().length)return{error:"No Candidates"};const i=t.castVotes(n,o,e);return o.setCandidateFractions(i.tallyFractions),i},this.testVote=(e,n)=>{const o=t.testVote(e,n),i=n.getCandidates().map((t=>t.color)),{tallyFractions:s}=o,r=I(s,i);return o.color=r,o}}function Ze(t){const e={usr:16};let n=[];this.startSim=function(){n=[]},this.addSim=function(o,i){if(0===o.getVoterShapes().length)return{noChange:1};if(0===i.getCandidateDistributions().length)return{noChange:1};if(n.length>5e3)return{noChange:1};const{seats:s}=t.countVotes,r=Array(20*s),a=o.getVoterShapes();for(let o=0;o<20;o++){let c;"singleWinner"===t.countVotes.checkElectionType()?c=5:"allocation"===t.countVotes.checkElectionType()&&(c=10);const l=[];for(let t=0;t<c;t++){const t=i.sampler.samplePoint();l.push({shape2:t})}const d=t.runElection(a,l,e);if("singleWinner"===t.countVotes.checkElectionType()){const{winner:t}=d,e=t.shape2;n.push(e),r[o]=e}else{const{allocation:t}=d,e=10;let i=0;for(let a=0;a<l.length;a++){const c=l[a],d=t[a];for(let t=0;t<d;t++){let a;a=0===t?c.shape2:{x:c.shape2.x+(Math.random()-.5)*e,y:c.shape2.y+(Math.random()-.5)*e},n.push(a),r[o*s+i]=a,i+=1}}}}return{noChange:0,newPoints:r,points:n}}}function tn(t){const e={usr:32};this.updateVotes=(n,o)=>{const i=o.getCandidates();if(0===n.getVoterSims().length)return{error:"no voters"};if(0===i.length)return{error:"no candidates"};const s=function(n,o){const{allVoterGroups:i}=n;return t.runElection(i,o,e)}(n,i),r=function(n,o){const{voterGroupsByTract:i}=n;return i.map((n=>n.map((n=>t.runElection(n,o,e)))))}(n,i),a=function(t,e){const n=e.map((t=>t.color));return t.map((t=>t.map((t=>{const{tallyFractions:e}=t.votes;return V(I(e,n))}))))}(r,i),c=function(n,o){const{voterGroupsByDistrict:i}=n;return i.map((n=>t.runElection(n,o,e)))}(n,i),l=function(e,n){let o;if("singleWinner"===t.countVotes.checkElectionType())o=e.map((t=>t.winner.color));else{const t=n.map((t=>t.color));o=e.map((e=>{const{allocation:n}=e,o=n.reduce(((t,e)=>t+e));return I(n.map((t=>t/o)),t)}))}return o}(c,i),d=function(t,e){return t.map((t=>{const{tallyFractions:n}=t.votes;return I(n,e.map((t=>t.color)))}))}(c,i),h=function(e,n){const o=n.length,i=Array(o).fill(0);if("singleWinner"===t.countVotes.checkElectionType()){e.map((t=>t.iWinner)).forEach((t=>{i[t]+=1}))}else e.forEach((t=>{const{allocation:e}=t;for(let t=0;t<o;t++)i[t]+=e[t]}));return i}(c,i);return o.setCandidateWins(h),o.setCandidateFractions(s.votes.tallyFractions),{resultsStatewide:s,resultsByTract:r,colorByTract:a,resultsByDistrict:c,colorOfVoteByDistrict:d,winsByDistrict:h,colorOfWinsByDistrict:l}},this.testVote=(e,n)=>{const o=t.testVote(e,n),i=o.tallyFractions.indexOf(1),s=n.getCandidates();return o.color=s[i].color,o}}function en(t){const e=function(t){const e=t.length,n=new Array(e);for(let o=0;o<e;o++){n[o]=[];for(let i=0;i<e;i++){if(o===i)continue;const e=t[o],s=t[i];n[o].push(nn(e,s))}}return n}(t);this.sumArea=function(t){const n=e.length,o=Array(n);for(let i=0;i<n;i++){const n=e[i];o[i]=on(t,n)}return o}}function nn(t,e){const n=e.x-t.x,o=e.y-t.y;return{A:{x:n,y:o},b:.5*(t.x+e.x)*n+.5*(t.y+e.y)*o}}function on(t,e){let n=0;const o=t.x,i=t.y,{w:s}=t,r=.5*s;for(let t=o-r;t<o+r;t+=2){const s=r**2-(t-o)**2;let a;a=s>0?Math.sqrt(s):0;let c=i+a,l=i-a;for(let n=0;n<e.length;n++){const o=e[n],i=o.A.y,s=o.A.x,{b:r}=o;if(0===i)s*t<r||(l=1/0);else{const e=(r-s*t)/i;i<0?l=Math.max(l,e):c=Math.min(c,e)}}const d=c-l;if(d>0){n+=2*d}}return n}function sn(t){const e=function(t){const e=t.length,n=C(e).sort(((e,n)=>t[e].x-t[n].x)),o=new Array(e-1);for(let i=0;i<e-1;i++)o[i]=.5*(t[n[i]].x+t[n[i+1]].x);const i=new Array(e);for(let t=0;t<e;t++){const s=0===t?-1/0:o[t-1],r=t===e-1?1/0:o[t];i[n[t]]={lower:s,upper:r}}return i}(t);this.sumArea=function(n){const o=t.length,i=Array(o);if("gaussian"===n.densityProfile)for(let t=0;t<o;t++)i[t]=an(n,e[t]);else for(let t=0;t<o;t++)i[t]=rn(n,e[t]);return i}}function rn(t,e){const{lower:n,upper:o}=e,{x:i,w:s}=t,r=.5*s,a=i-r,c=i+r,l=Math.max(n,a),d=Math.min(o,c);return Math.max(0,d-l)}function an(t,e){const{lower:n,upper:o}=e,{x:i,w:s}=t,r=i,a=s/Math.sqrt(2*Math.PI);return s*E(o,r,a)-s*E(n,r,a)}function cn(t,e){return(t.x-e.x)**2}function ln(t,e){return(t.x-e.x)**2+(t.y-e.y)**2}function dn(t,e,n){const o=t.length,i=new Array(o).fill(0),s=1===n?hn:un,r=t.map((t=>s(t,e))),[a,c]=function(t){let e=t[0],n=t[0];for(let o=0;o<t.length;o++){const i=t[o];i<e&&(e=i),i>n&&(n=i)}return[e,n]}(r);for(let t=0;t<o;t++){const e=r[t];if(e<=a)i[t]=1;else if(e>=c)i[t]=0;else{const n=(e-a)/(c-a);i[t]=0+1*(1-n)}}return i}function hn(t,e){return Math.abs(t.x-e.x)}function un(t,e){return Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2)}function pn(t,e){this.sumArea=function(n){const o=function(t,e){const n="gaussian"===t.densityProfile?3:1,{x:o,y:i,w:s}=t,r=s*n,{usr:a}=e,c=Math.round(r/a),l=C(c),d=C(c),h=l.map((t=>(t+.5)*a-.5*r+o)),u=d.map((t=>(t+.5)*a-.5*r+i)),p=l.length,f=d.length,m=p*f,g=Array(m),y=Array(m),_=Array(m);let x=0;for(let e=0;e<d.length;e++)for(let n=0;n<l.length;n++){const o=h[n],i=u[e];g[x]=o,y[x]=i,_[x]=fn(t,o,i),x+=1}return{x:g,y:y,weight:_,nx:p,ny:f}}(n,e),i=t.length,s=Array(i).fill(0);let r=0;const a=o.x.length,c=Array(a);for(let e=0;e<a;e++){const n=o.weight[e],a=o.x[e],l=o.y[e],d=dn(t,{x:a,y:l},2);c[e]={tallyFractions:d},r+=n;for(let t=0;t<i;t++)s[t]+=d[t]*n}return{grid:o,voteSet:c,area:s,totalArea:r}}}function fn(t,e,n){const o="gaussian"===t.densityProfile,{x:i,y:s,w:r}=t;if(!o){return(e-i)**2+(n-s)**2<(.5*r)**2?1:0}const a=r/Math.sqrt(2*Math.PI);return r*A(e,i,a)*A(n,s,a)}function mn(t){this.sumArea=function(e){const n=function(t){const e="gaussian"===t.densityProfile?3:1,{x:n,w:o}=t,i=Math.round(o*e),s=C(i).map((t=>t+.5-.5*i+n));return{x:s}}(e),o=t.length,i=Array(o).fill(0);let s=0;const r=n.x.length,a=Array(r);for(let c=0;c<r;c++){const r=n.x[c],l=dn(t,{x:r},1);a[c]={tallyFractions:l};const d=gn(e,r);s+=d;for(let t=0;t<o;t++)i[t]+=l[t]*d}return{grid:n,voteSet:a,area:i,totalArea:s}}}function gn(t,e){if(!("gaussian"===t.densityProfile))return 1;const{x:n,w:o}=t;return o*A(e,n,o/Math.sqrt(2*Math.PI))}var yn={castPlurality:function(t,e,n,o,i){if(i){const o=function(t,e,n){const o=1===n?cn:ln,i=k(t.map((t=>o(t,e)))),s=t.length,r=new Array(s).fill(0);return r[i]=1,r}(t,e[0],n);return{tallyFractions:o}}const s=1===n?new sn(t):new en(t),r=t.length;let a=new Array(r).fill(0);e.forEach((t=>{const e=s.sumArea(t),n=void 0===t.weight?1:t.weight;a=a.map(((t,o)=>t+e[o]*n))}));const c=a.reduce(((t,e)=>t+e));return{tallyFractions:a.map((t=>t/c))}},castScore:function(t,e,n,o,i){if(i){return{tallyFractions:dn(t,e[0],n)}}const s=1===n?new mn(t):new pn(t,o),r=t.length;let a=new Array(r).fill(0),c=0;const l=[];for(let t=0;t<e.length;t++){const n=e[t],{grid:o,voteSet:i,area:r,totalArea:d}=s.sumArea(n),h={grid:o,voteSet:i,voterGeom:n};l.push(h);const u=void 0===n.weight?1:n.weight;a=a.map(((t,e)=>t+r[e]*u)),c+=d}return{tallyFractions:a.map((t=>t/c)),gridData:l}}};const _n={plurality:function(t){const e=Math.max(...t.tallyFractions);return{iWinner:t.tallyFractions.indexOf(e)}},randomWinner:function(t){const e=t.tallyFractions.length;return{iWinner:Math.floor(Math.random()*e)}},huntingtonHill:function(t,e){const{seats:n,threshold:o}=e,i=t.tallyFractions.map((t=>t<o?0:t)),s=i.length;if(0===o&&s>n){const e=[...i].sort(((t,e)=>e-t)),o=e[n-1];return{allocation:t.tallyFractions.map((t=>t>=o))}}const r=Array(n).fill().map(((t,e)=>Math.sqrt(e*(e+1)))),a=i.map((t=>0===t?1/0:r.map((e=>e/t)))).flat().flat().sort(((t,e)=>t-e)),c=a[n-1];return{allocation:i.map((t=>0===t?0:.5*(1+Math.sqrt(1+4*(t*c)**2)))).map((t=>Math.floor(t)))}},score:function(t){const e=Math.max(...t.tallyFractions);return{iWinner:t.tallyFractions.indexOf(e)}}};var xn=_n;function wn(t){const e=this;e.seats=1,e.run=(t,n)=>{let o;if("allocation"===e.checkElectionType()){const i={seats:5,threshold:.2};e.seats=i.seats;const s=xn[e.electionMethod](n,i),{allocation:r}=s;o={allocation:r,candidates:t,votes:n}}else{e.seats=1;const i=xn[e.electionMethod](n),{iWinner:s}=i;o={iWinner:s,winner:t[s],votes:n}}return o},e.electionMethodList=[{name:"Huntington Hill",value:"huntingtonHill",type:"allocation",caster:"castPlurality"},{name:"Plurality",value:"plurality",type:"singleWinner",caster:"castPlurality"},{name:"Random Winner",value:"randomWinner",type:"singleWinner",caster:"castPlurality"},{name:"Score",value:"score",type:"singleWinner",caster:"castScore"}],e.checkElectionType=()=>e.electionMethodListByFunctionName[e.electionMethod].type,e.electionMethodListByFunctionName=[],e.electionMethodList.forEach((t=>{e.electionMethodListByFunctionName[t.value]=t})),e.setElectionMethod=t=>{e.electionMethod=t,e.caster=e.electionMethodListByFunctionName[t].caster},e.setElectionMethod("plurality"),t.addMenuItem(e,{label:"Election Method:",prop:"electionMethod",setProp:e.setElectionMethod,options:e.electionMethodList,change:["electionMethod"]})}function vn(t){const e=this;e.countVotes=new wn(t),e.dimensions=1,e.setDimensions=t=>{e.dimensions=t};const n=t=>1===e.dimensions?t.map((t=>t.shape1)):t.map((t=>t.shape2)),o=t=>1===e.dimensions?t.map((t=>t.shape1)):t.map((t=>t.shape2));e.runElection=function(t,i,s){const r=n(t),a=o(i),c=(0,yn[e.countVotes.caster])(a,r,e.dimensions,s);return e.countVotes.run(i,c)},e.castVotes=(t,i,s)=>{const r=t.getVoterShapes(),a=i.getCandidates(),c=n(r),l=o(a);return(0,yn[e.countVotes.caster])(l,c,e.dimensions,s)},e.testVote=(t,i,s)=>{const r=[t],a=i.getCandidates(),c=n(r),l=o(a);return(0,yn[e.countVotes.caster])(l,c,e.dimensions,s,!0)}}function bn(t,e,n,o,i){const s=this,r=new vn(e),a=new Qe(r),c=new Ze(r),l=new tn(r);s.election=r;const d={one2D:new gt(t,e,n,a,s),one1D:new ze(t,e,n,a,s),sample:new vt(t,e,n,c,s),geoOne:new Xt(t,e,n,l,s)};s.sims=d,s.voterShapeAdd=new Ie(t,i,n,o,d,s),s.candidateAdd=new $e(t,i,n,o,d,s),s.candidateDnAdd=new Ge(t,i,n,o,d,s),s.voterTest=new Ke(t,d,s),s.testVote=()=>d[s.state].testVote(),s.candidateAdd.addCandidate({x:50,y:100},{x:50},"#e05020",!0),s.candidateAdd.addCandidate({x:100,y:50},{x:100},"#50e020",!0),s.candidateAdd.addCandidate({x:200,y:250},{x:200},"#2050e0",!0),s.candidateDnAdd.addCandidateDistribution({x:150,y:150,w:200},{x:150},!0),s.voterShapeAdd.addVoterCircle({x:50,y:150,w:200},{x:50,w:200,densityProfile:"gaussian"},!0),s.voterShapeAdd.addVoterCircle({x:250,y:150,w:200},{x:250,w:200,densityProfile:"gaussian"},!0),s.state="one2D",n.add(["simType"]),s.update=()=>{n.check(["simType"])&&(Object.keys(d).forEach((t=>d[t].exit())),d[s.state].enter()),d[s.state].update()},s.renderForeground=()=>{d[s.state].renderForeground()},s.render=()=>{d[s.state].render()},s.setShowNonExistingEntities=t=>{s.showGhosts=t,n.add(["showGhosts"])},function(t){const e=document.createElement("div");e.setAttribute("class","button-group-label"),e.innerText="Sim Controls:",t.newElement("simControlsLabel",e)}(i),s.typeList=[{name:"One Election",value:"one2D",state:""},{name:"1D One Election",value:"one1D",state:""},{name:"Sample Elections",value:"sample",state:""},{name:"Geo Election",value:"geoOne",state:""}],e.addMenuItem(s,{label:"Simulation:",prop:"state",setProp:t=>{s.state=t},options:s.typeList,change:["simType"]})}function Cn(t){const e={},n=[];this.newElement=(o,i)=>{t.includes(o)?e[o]=i:n.push(i)},this.makeComponent=()=>{const o=document.createElement("div");return t.forEach((t=>{const n=e[t];void 0!==n&&o.appendChild(n)})),n.forEach((t=>{o.appendChild(t)})),o}}function Sn(t){const e=this,n=[];e.addSender=e=>{const{name:o,action:i,props:s}=e;n[o]=i;const r=t=>({name:o,value:t,props:s});return{command:r,go:e=>t.do(r(e))}},e.addSenderForList=e=>{const{name:o,action:i,props:s}=e;n[o]=i;const r=(t,e,n)=>({name:o,id:t,value:e,props:s,currentValue:n});return{command:r,go:(e,n,o)=>t.do(r(e,n,o))}},e.execute=t=>{const{name:e,id:o,value:i}=t,s=n[e];void 0!==o?s(o,i):s(i)}}function An(t){const e=this,n={},o=[];e.addSender=t=>{const{name:e,currentValue:i,props:s}=t;void 0!==s&&s.isFirstAction&&(o[e]=!0),n[e]=i},e.addSenderForList=t=>{const{name:e,props:i}=t;void 0!==i&&i.isFirstAction&&(o[e]=!0),n[e]=[];return t=>n[e][t]},e.execute=t=>{const{name:e,id:o,value:i}=t;void 0!==o?n[e][o]=i:n[e]=i},e.makeUndo=t=>{const{name:e,id:o,props:i}=t;let s;void 0===o?s=n[e]:(s=n[e][o],void 0===s&&(s=t.currentValue));return{name:e,id:o,value:s,props:i}},e.passLoadConfig=t=>{e.loadConfigPriority(t,"high"),e.loadConfigPriority(t,"low")},e.loadConfigPriority=(e,n)=>{Object.keys(e).forEach((i=>{const s=void 0!==o[i];if("low"===n&&s)return;if("high"===n&&!s)return;const r=e[i];if(r instanceof Array)r.forEach(((e,n)=>{const o={name:i,id:n,value:e};t.execute(o)}));else{const e={name:i,value:r};t.execute(e)}}))},e.passLoadCommands=e=>{e.forEach((e=>{t.execute(e)}))},e.getConfig=()=>structuredClone(n)}function En(t){const e=this,n=[];let o=-1;e.clearHistory=()=>{n.splice(0,n.length),o=-1},e.passDo=e=>{const i=t.makeUndo(e);n.splice(o+1,n.length-(o+1)),t.execute(e),n.push([{command:e,undoCommand:i}]),o+=1},e.passDoCommands=e=>{n.splice(o+1,n.length-(o+1));const i=[];e.forEach((e=>{const n=t.makeUndo(e);i.push({command:e,undoCommand:n}),t.execute(e)})),n.push(i),o+=1};let i=setTimeout((()=>null),30);e.undo=()=>{if(-1===o)return;const s=n[o];s.forEach((e=>{t.execute(e.undoCommand)})),o-=1;const{undoCommand:r}=s[0];if(void 0===r.props)return;if(!0!==r.props.isChain)return;if(-1===o)return;n[o][0].undoCommand.name===r.name&&(clearTimeout(i),i=setTimeout(e.undo,30))},e.redo=()=>{if(o===n.length-1)return;const s=n[o+1];s.forEach((e=>t.execute(e.command))),o+=1;const{command:r}=s[0];if(void 0===r.props)return;if(!0!==r.props.isChain)return;if(o===n.length-1)return;n[o+1][0].command.name===r.name&&(clearTimeout(i),i=setTimeout(e.redo,30))}}function Mn(t){const e=this,n=new Sn(e),o=new An(e),i=new En(e);t.addCommander(e),e.addSender=t=>{o.addSender(t);return n.addSender(t)},e.addSenderForList=t=>{const e=n.addSenderForList(t);return e.getCurrentValue=o.addSenderForList(t),e},e.execute=t=>{o.execute(t),n.execute(t)},e.makeUndo=o.makeUndo,e.passLoadConfig=o.passLoadConfig,e.passLoadCommands=o.passLoadCommands,e.getConfig=o.getConfig,e.loadConfig=n=>{t.broadcastLoadConfig(n,e)},e.loadCommands=n=>{t.broadCastLoadCommands(n,e)},e.do=n=>{t.broadcastDo(n,e)},e.doCommands=n=>{t.broadcastDoCommands(n,e)},e.passDo=i.passDo,e.passDoCommands=i.passDoCommands,e.undo=i.undo,e.redo=i.redo,e.clearHistory=i.clearHistory}function kn(t,e){const n=document.createElement("button");n.className="button2",n.innerText="Save Config To Text";const o=document.createElement("textarea");n.onclick=()=>{const t=e.getConfig();var n;o.value=(n=t,JSON.stringify(S(n),null,"\t"))};const i=document.createElement("div"),s=document.createElement("div");s.appendChild(n),s.appendChild(i),s.appendChild(o),t.newElement("saveConfigToText",s)}function Tn(t,e,n){const o=document.createElement("button");o.className="button2",o.innerText="Save Link";const i=document.createElement("button");i.className="button2",i.innerText="Copy Link to Clipboard";const s=document.createElement("textarea");function r(){const t=e.getConfig(),o=encodeURIComponent(JSON.stringify(t));return`${function(){const t=document.location.href.split("/"),e=t.slice(0,t.length-1);return e.join("/")}()}/${n}?a=${o}`}o.onclick=()=>{const t=r();s.value=t},i.onclick=()=>{const t=r();navigator.clipboard.writeText(t)};const a=document.createElement("div"),c=document.createElement("div");c.appendChild(o),c.appendChild(i),c.appendChild(a),c.appendChild(s),t.newElement("saveConfigToLink",c)}function Pn(t,n,i){const s=new e,r=new Cn(["menu","simControlsLabel","addVoter","addCandidate","addCandidateDistribution","undo","redo","screenWrap","maps","saveConfigToLink","saveConfigToText","loadConfigText","svgUIDiv"]),a=new Mn(n),c=new x(s,r,a);!function(t,e){const n=document.createElement("button"),o=document.createElement("button");n.className="button2",o.className="button2",n.innerText="Undo",o.innerText="Redo",n.onclick=e.undo,o.onclick=e.redo,t.newElement("undo",n),t.newElement("redo",o)}(r,a),Tn(r,a,i),kn(r,a),function(t,e){const n=document.createElement("button");n.className="button2",n.innerText="Load Config Text";const o=document.createElement("textarea");n.onclick=()=>{if(""===o.value)return;const t=JSON.parse(o.value);e.loadConfig(t)};const i=document.createElement("div"),s=document.createElement("div");s.appendChild(n),s.appendChild(i),s.appendChild(o),t.newElement("loadConfigText",s)}(r,a);const l=new o(300,300,r);f(l,(function(){l.clear(),l.clearMaps(),l.clearForeground(),d.render(),d.renderForeground()}),r);const d=new bn(l,c,s,a,r);a.loadConfig(t),a.clearHistory();const h=r.makeComponent();return window.requestAnimationFrame((function t(){d.update(),l.clearForeground(),d.renderForeground(),window.requestAnimationFrame(t)})),h}Array.from(document.getElementsByClassName("sandbox")).forEach((e=>{const n=void 0!==e.dataset.config?JSON.parse(e.dataset.config):{},o=function(){const t=new URLSearchParams(window.location.search),e=t.has("a");return{yes:e,config:e?JSON.parse(t.get("a")):{}}}(),i=o.yes?o.config:n,s=void 0!==e.dataset.sandboxurl?e.dataset.sandboxurl:"",r=Pn(i,new t,s);e.parentNode.appendChild(r)})),Array.from(document.getElementsByClassName("double_sandbox")).forEach((e=>{const n=function(e,n){const o=new t,i=document.createElement("button");i.className="button2",i.innerText="linked",i.style["vertical-align"]="middle",i.style["min-width"]="70px",i.style.margin="5px",i.onclick=()=>{"linked"===i.innerText?(i.innerText="unlinked",o.setLinked(!1)):(i.innerText="linked",o.setLinked(!0))};const s=Pn(e,o,n),r=Pn(e,o,n);s.style.display="inline-block",r.style.display="inline-block",s.style["vertical-align"]="top",r.style["vertical-align"]="top";const a=document.createElement("div");return a.appendChild(s),a.appendChild(i),a.appendChild(r),a}(void 0!==e.dataset.config?JSON.parse(e.dataset.config):{},void 0!==e.dataset.sandboxurl?e.dataset.sandboxurl:"");e.parentNode.appendChild(n)}))})();
//# sourceMappingURL=addSandboxes.js.map
