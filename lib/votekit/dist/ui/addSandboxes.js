(()=>{class t{constructor(){this.linked=!0,this.commanders=[],this.protect=!1}setLinked(t){this.linked=t}addCommander(t){this.commanders.push(t)}broadcastDo(t,e){this.linked&&!1===this.protect?(this.protect=!0,this.commanders.forEach((e=>e.passDo(t))),this.protect=!1):e.passDo(t)}broadcastDoCommands(t,e){this.linked&&!1===this.protect?(this.protect=!0,this.commanders.forEach((e=>e.passDoCommands(t))),this.protect=!1):e.passDoCommands(t)}broadcastLoadConfig(t,e){this.linked&&!1===this.protect?(this.protect=!0,this.commanders.forEach((e=>e.passLoadConfig(t))),this.protect=!1):e.passLoadConfig(t)}broadCastLoadCommands(t,e){this.linked&&!1===this.protect?(this.protect=!0,this.commanders.forEach((e=>e.passLoadCommands(t))),this.protect=!1):e.passLoadCommands(t)}}function e(){const t=this,e=["init"];t.add=t=>{t.forEach((t=>e.push(t)))},t.check=t=>{let n=0;return t.forEach((t=>{n+=e.includes(t)?1:0})),n>0},t.checkNone=()=>0===e.length,t.clear=()=>{e.splice(0,e.length)}}function n(){const t=this;t.handlers={start:()=>{},move:()=>{},end:()=>{},touchmove:()=>{},touchstart:()=>{},touchend:()=>{}},t.set=e=>{Object.assign(t.handlers,e)}}function i(t,e,i){const o=this;o.width=t,o.height=e,o.canvas=document.createElement("canvas"),o.canvas.setAttribute("class","background"),o.ctx=o.canvas.getContext("2d"),o.tooltips=document.createElement("div"),o.tooltips.setAttribute("class","tooltips"),o.foreground=document.createElement("canvas"),o.foreground.setAttribute("class","foreground"),o.fctx=o.foreground.getContext("2d"),o.maps=document.createElement("canvas"),o.maps.setAttribute("class","maps"),o.mctx=o.maps.getContext("2d");const r=document.createElement("div");o.wrap=document.createElement("div"),o.wrap.setAttribute("class","screenWrap"),o.wrap.appendChild(r),o.wrap.appendChild(o.canvas),o.wrap.appendChild(o.tooltips),o.wrap.appendChild(o.foreground),i.newElement("screenWrap",o.wrap),i.newElement("maps",o.maps),o.noBuffers=!1,o.pixelRatio=function(t){const e=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/e}
/*!!
 *  Canvas 2 Svg v1.0.21
 *  A low level canvas to SVG converter. Uses a mock canvas context to build an SVG document.
 *
 *  Licensed under the MIT license:
 *  http://www.opensource.org/licenses/mit-license.php
 *
 *  Author:
 *  Kerry Liu
 *
 *  Copyright (c) 2014 Gliffy Inc.
 */(o.ctx),o.canvas.width=t*o.pixelRatio,o.canvas.height=e*o.pixelRatio,o.canvas.style.width=`${t}px`,o.canvas.style.height=`${e}px`,o.wrap.style.width=`${t}px`,o.wrap.style.height=`${e}px`,o.tooltips.style.width=`${t}px`,o.tooltips.style.height=`${e}px`,o.foreground.width=t*o.pixelRatio,o.foreground.height=e*o.pixelRatio,o.foreground.style.width=`${t}px`,o.foreground.style.height=`${e}px`,o.maps.width=t*o.pixelRatio,o.maps.style.width=`${t}px`,o.setMapsHeight=t=>{const e=Math.round(t);o.maps.heightBrowser=e,o.maps.height=e*o.pixelRatio,o.maps.style.height=`${e}px`,o.mctx.scale(o.pixelRatio,o.pixelRatio)},o.setMapsHeight(1/3*e),o.ctx.scale(o.pixelRatio,o.pixelRatio),o.fctx.scale(o.pixelRatio,o.pixelRatio),o.clear=function(){o.ctx.clearRect(0,0,o.canvas.width,o.canvas.height)},o.clearForeground=function(){o.fctx.clearRect(0,0,o.foreground.width,o.foreground.height)},o.clearMaps=function(){o.mctx.clearRect(0,0,o.maps.width,o.maps.height)},o.setCtx=function(t){o.ctx=t},o.setFCtx=function(t){o.fctx=t},o.setMCtx=function(t){o.mctx=t},o.setNoBuffers=function(t){o.noBuffers=t},o.showMaps=()=>{o.maps.style.display="block"},o.hideMaps=()=>{o.maps.style.display="none"},o.hideMaps(),o.eventHandlers=new n;const{handlers:s}=o.eventHandlers;o.wrap.onmousedown=t=>s.start(t),o.wrap.onmousemove=t=>s.move(t),o.wrap.onmouseup=t=>s.end(t),o.wrap.addEventListener("touchmove",(t=>s.touchmove(t))),o.wrap.addEventListener("touchstart",(t=>s.touchstart(t))),o.wrap.addEventListener("touchend",(t=>s.touchend(t)));const a=document.onmouseup;document.onmouseup=t=>{a&&a(t),o.wrap.onmouseup(t)}}var o,r,s,a,l;function c(t,e){var n,i=Object.keys(e);for(n=0;n<i.length;n++)t=t.replace(new RegExp("\\{"+i[n]+"\\}","gi"),e[i[n]]);return t}function h(t){var e,n,i;if(!t)throw new Error("cannot create a random attribute name for an undefined object");e="ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",n="";do{for(n="",i=0;i<12;i++)n+=e[Math.floor(Math.random()*e.length)]}while(t[n]);return n}function u(t){var e={alphabetic:"alphabetic",hanging:"hanging",top:"text-before-edge",bottom:"text-after-edge",middle:"central"};return e[t]||e.alphabetic}l=function(t,e){var n,i,o,r={};for(t=t.split(","),e=e||10,n=0;n<t.length;n+=2)i="&"+t[n+1]+";",o=parseInt(t[n],e),r[i]="&#"+o+";";return r["\\xa0"]="&#160;",r}("50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro",32),o={strokeStyle:{svgAttr:"stroke",canvas:"#000000",svg:"none",apply:"stroke"},fillStyle:{svgAttr:"fill",canvas:"#000000",svg:null,apply:"fill"},lineCap:{svgAttr:"stroke-linecap",canvas:"butt",svg:"butt",apply:"stroke"},lineJoin:{svgAttr:"stroke-linejoin",canvas:"miter",svg:"miter",apply:"stroke"},miterLimit:{svgAttr:"stroke-miterlimit",canvas:10,svg:4,apply:"stroke"},lineWidth:{svgAttr:"stroke-width",canvas:1,svg:1,apply:"stroke"},globalAlpha:{svgAttr:"opacity",canvas:1,svg:1,apply:"fill stroke"},font:{canvas:"10px sans-serif"},shadowColor:{canvas:"#000000"},shadowOffsetX:{canvas:0},shadowOffsetY:{canvas:0},shadowBlur:{canvas:0},textAlign:{canvas:"start"},textBaseline:{canvas:"alphabetic"},lineDash:{svgAttr:"stroke-dasharray",canvas:[],svg:null,apply:"stroke"}},(s=function(t,e){this.__root=t,this.__ctx=e}).prototype.addColorStop=function(t,e){var n,i=this.__ctx.__createElement("stop");i.setAttribute("offset",t),-1!==e.indexOf("rgba")?(n=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi.exec(e),i.setAttribute("stop-color",c("rgb({r},{g},{b})",{r:n[1],g:n[2],b:n[3]})),i.setAttribute("stop-opacity",n[4])):i.setAttribute("stop-color",e),this.__root.appendChild(i)},a=function(t,e){this.__root=t,this.__ctx=e},(r=function(t){var e,n={width:500,height:500,enableMirroring:!1};if(arguments.length>1?((e=n).width=arguments[0],e.height=arguments[1]):e=t||n,!(this instanceof r))return new r(e);this.width=e.width||n.width,this.height=e.height||n.height,this.enableMirroring=void 0!==e.enableMirroring?e.enableMirroring:n.enableMirroring,this.canvas=this,this.__document=e.document||document,e.ctx?this.__ctx=e.ctx:(this.__canvas=this.__document.createElement("canvas"),this.__ctx=this.__canvas.getContext("2d")),this.__setDefaultStyles(),this.__stack=[this.__getStyleState()],this.__groupStack=[],this.__root=this.__document.createElementNS("http://www.w3.org/2000/svg","svg"),this.__root.setAttribute("version",1.1),this.__root.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.__root.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),this.__root.setAttribute("width",this.width),this.__root.setAttribute("height",this.height),this.__ids={},this.__defs=this.__document.createElementNS("http://www.w3.org/2000/svg","defs"),this.__root.appendChild(this.__defs),this.__currentElement=this.__document.createElementNS("http://www.w3.org/2000/svg","g"),this.__root.appendChild(this.__currentElement)}).prototype.__createElement=function(t,e,n){void 0===e&&(e={});var i,o,r=this.__document.createElementNS("http://www.w3.org/2000/svg",t),s=Object.keys(e);for(n&&(r.setAttribute("fill","none"),r.setAttribute("stroke","none")),i=0;i<s.length;i++)o=s[i],r.setAttribute(o,e[o]);return r},r.prototype.__setDefaultStyles=function(){var t,e,n=Object.keys(o);for(t=0;t<n.length;t++)this[e=n[t]]=o[e].canvas},r.prototype.__applyStyleState=function(t){var e,n,i=Object.keys(t);for(e=0;e<i.length;e++)this[n=i[e]]=t[n]},r.prototype.__getStyleState=function(){var t,e,n={},i=Object.keys(o);for(t=0;t<i.length;t++)n[e=i[t]]=this[e];return n},r.prototype.__applyStyleToCurrentElement=function(t){var e=this.__currentElement,n=this.__currentElementsToStyle;n&&(e.setAttribute(t,""),e=n.element,n.children.forEach((function(e){e.setAttribute(t,"")})));var i,r,l,h,u,d=Object.keys(o);for(i=0;i<d.length;i++)if(r=o[d[i]],l=this[d[i]],r.apply)if(l instanceof a){if(l.__ctx)for(;l.__ctx.__defs.childNodes.length;)h=l.__ctx.__defs.childNodes[0].getAttribute("id"),this.__ids[h]=h,this.__defs.appendChild(l.__ctx.__defs.childNodes[0]);e.setAttribute(r.apply,c("url(#{id})",{id:l.__root.getAttribute("id")}))}else if(l instanceof s)e.setAttribute(r.apply,c("url(#{id})",{id:l.__root.getAttribute("id")}));else if(-1!==r.apply.indexOf(t)&&r.svg!==l)if("stroke"!==r.svgAttr&&"fill"!==r.svgAttr||-1===l.indexOf("rgba")){var f=r.svgAttr;if("globalAlpha"===d[i]&&(f=t+"-"+r.svgAttr,e.getAttribute(f)))continue;e.setAttribute(f,l)}else{u=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi.exec(l),e.setAttribute(r.svgAttr,c("rgb({r},{g},{b})",{r:u[1],g:u[2],b:u[3]}));var p=u[4],g=this.globalAlpha;null!=g&&(p*=g),e.setAttribute(r.svgAttr+"-opacity",p)}},r.prototype.__closestGroupOrSvg=function(t){return"g"===(t=t||this.__currentElement).nodeName||"svg"===t.nodeName?t:this.__closestGroupOrSvg(t.parentNode)},r.prototype.getSerializedSvg=function(t){var e,n,i,o,r,s=(new XMLSerializer).serializeToString(this.__root);if(/xmlns="http:\/\/www\.w3\.org\/2000\/svg".+xmlns="http:\/\/www\.w3\.org\/2000\/svg/gi.test(s)&&(s=s.replace('xmlns="http://www.w3.org/2000/svg','xmlns:xlink="http://www.w3.org/1999/xlink')),t)for(e=Object.keys(l),n=0;n<e.length;n++)i=e[n],o=l[i],(r=new RegExp(i,"gi")).test(s)&&(s=s.replace(r,o));return s},r.prototype.getSvg=function(){return this.__root},r.prototype.save=function(){var t=this.__createElement("g"),e=this.__closestGroupOrSvg();this.__groupStack.push(e),e.appendChild(t),this.__currentElement=t,this.__stack.push(this.__getStyleState())},r.prototype.restore=function(){this.__currentElement=this.__groupStack.pop(),this.__currentElementsToStyle=null,this.__currentElement||(this.__currentElement=this.__root.childNodes[1]);var t=this.__stack.pop();this.__applyStyleState(t)},r.prototype.__addTransform=function(t){var e=this.__closestGroupOrSvg();if(e.childNodes.length>0){"path"===this.__currentElement.nodeName&&(this.__currentElementsToStyle||(this.__currentElementsToStyle={element:e,children:[]}),this.__currentElementsToStyle.children.push(this.__currentElement),this.__applyCurrentDefaultPath());var n=this.__createElement("g");e.appendChild(n),this.__currentElement=n}var i=this.__currentElement.getAttribute("transform");i?i+=" ":i="",i+=t,this.__currentElement.setAttribute("transform",i)},r.prototype.scale=function(t,e){void 0===e&&(e=t),this.__addTransform(c("scale({x},{y})",{x:t,y:e}))},r.prototype.rotate=function(t){var e=180*t/Math.PI;this.__addTransform(c("rotate({angle},{cx},{cy})",{angle:e,cx:0,cy:0}))},r.prototype.translate=function(t,e){this.__addTransform(c("translate({x},{y})",{x:t,y:e}))},r.prototype.transform=function(t,e,n,i,o,r){this.__addTransform(c("matrix({a},{b},{c},{d},{e},{f})",{a:t,b:e,c:n,d:i,e:o,f:r}))},r.prototype.beginPath=function(){var t;this.__currentDefaultPath="",this.__currentPosition={},t=this.__createElement("path",{},!0),this.__closestGroupOrSvg().appendChild(t),this.__currentElement=t},r.prototype.__applyCurrentDefaultPath=function(){var t=this.__currentElement;"path"===t.nodeName?t.setAttribute("d",this.__currentDefaultPath):console.error("Attempted to apply path command to node",t.nodeName)},r.prototype.__addPathCommand=function(t){this.__currentDefaultPath+=" ",this.__currentDefaultPath+=t},r.prototype.moveTo=function(t,e){"path"!==this.__currentElement.nodeName&&this.beginPath(),this.__currentPosition={x:t,y:e},this.__addPathCommand(c("M {x} {y}",{x:t,y:e}))},r.prototype.closePath=function(){this.__currentDefaultPath&&this.__addPathCommand("Z")},r.prototype.lineTo=function(t,e){this.__currentPosition={x:t,y:e},this.__currentDefaultPath.indexOf("M")>-1?this.__addPathCommand(c("L {x} {y}",{x:t,y:e})):this.__addPathCommand(c("M {x} {y}",{x:t,y:e}))},r.prototype.bezierCurveTo=function(t,e,n,i,o,r){this.__currentPosition={x:o,y:r},this.__addPathCommand(c("C {cp1x} {cp1y} {cp2x} {cp2y} {x} {y}",{cp1x:t,cp1y:e,cp2x:n,cp2y:i,x:o,y:r}))},r.prototype.quadraticCurveTo=function(t,e,n,i){this.__currentPosition={x:n,y:i},this.__addPathCommand(c("Q {cpx} {cpy} {x} {y}",{cpx:t,cpy:e,x:n,y:i}))};var d=function(t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]);return[t[0]/e,t[1]/e]};r.prototype.arcTo=function(t,e,n,i,o){var r=this.__currentPosition&&this.__currentPosition.x,s=this.__currentPosition&&this.__currentPosition.y;if(void 0!==r&&void 0!==s){if(o<0)throw new Error("IndexSizeError: The radius provided ("+o+") is negative.");if(r===t&&s===e||t===n&&e===i||0===o)this.lineTo(t,e);else{var a=d([r-t,s-e]),l=d([n-t,i-e]);if(a[0]*l[1]!=a[1]*l[0]){var c=a[0]*l[0]+a[1]*l[1],h=Math.acos(Math.abs(c)),u=d([a[0]+l[0],a[1]+l[1]]),f=o/Math.sin(h/2),p=t+f*u[0],g=e+f*u[1],m=[-a[1],a[0]],y=[l[1],-l[0]],_=function(t){var e=t[0];return t[1]>=0?Math.acos(e):-Math.acos(e)},x=_(m),w=_(y);this.lineTo(p+m[0]*o,g+m[1]*o),this.arc(p,g,o,x,w)}else this.lineTo(t,e)}}},r.prototype.stroke=function(){"path"===this.__currentElement.nodeName&&this.__currentElement.setAttribute("paint-order","fill stroke markers"),this.__applyCurrentDefaultPath(),this.__applyStyleToCurrentElement("stroke")},r.prototype.fill=function(){"path"===this.__currentElement.nodeName&&this.__currentElement.setAttribute("paint-order","stroke fill markers"),this.__applyCurrentDefaultPath(),this.__applyStyleToCurrentElement("fill")},r.prototype.rect=function(t,e,n,i){"path"!==this.__currentElement.nodeName&&this.beginPath(),this.moveTo(t,e),this.lineTo(t+n,e),this.lineTo(t+n,e+i),this.lineTo(t,e+i),this.lineTo(t,e),this.closePath()},r.prototype.fillRect=function(t,e,n,i){var o;o=this.__createElement("rect",{x:t,y:e,width:n,height:i},!0),this.__closestGroupOrSvg().appendChild(o),this.__currentElement=o,this.__applyStyleToCurrentElement("fill")},r.prototype.strokeRect=function(t,e,n,i){var o;o=this.__createElement("rect",{x:t,y:e,width:n,height:i},!0),this.__closestGroupOrSvg().appendChild(o),this.__currentElement=o,this.__applyStyleToCurrentElement("stroke")},r.prototype.__clearCanvas=function(){for(var t=this.__closestGroupOrSvg().getAttribute("transform"),e=this.__root.childNodes[1],n=e.childNodes,i=n.length-1;i>=0;i--)n[i]&&e.removeChild(n[i]);this.__currentElement=e,this.__groupStack=[],t&&this.__addTransform(t)},r.prototype.clearRect=function(t,e,n,i){if(0!==t||0!==e||n!==this.width||i!==this.height){var o,r=this.__closestGroupOrSvg();o=this.__createElement("rect",{x:t,y:e,width:n,height:i,fill:"#FFFFFF"},!0),r.appendChild(o)}else this.__clearCanvas()},r.prototype.createLinearGradient=function(t,e,n,i){var o=this.__createElement("linearGradient",{id:h(this.__ids),x1:t+"px",x2:n+"px",y1:e+"px",y2:i+"px",gradientUnits:"userSpaceOnUse"},!1);return this.__defs.appendChild(o),new s(o,this)},r.prototype.createRadialGradient=function(t,e,n,i,o,r){var a=this.__createElement("radialGradient",{id:h(this.__ids),cx:i+"px",cy:o+"px",r:r+"px",fx:t+"px",fy:e+"px",gradientUnits:"userSpaceOnUse"},!1);return this.__defs.appendChild(a),new s(a,this)},r.prototype.__parseFont=function(){var t=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-,\'\"\sa-z0-9]+?)\s*$/i.exec(this.font),e={style:t[1]||"normal",size:t[4]||"10px",family:t[6]||"sans-serif",weight:t[3]||"normal",decoration:t[2]||"normal",href:null};return"underline"===this.__fontUnderline&&(e.decoration="underline"),this.__fontHref&&(e.href=this.__fontHref),e},r.prototype.__wrapTextLink=function(t,e){if(t.href){var n=this.__createElement("a");return n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t.href),n.appendChild(e),n}return e},r.prototype.__applyText=function(t,e,n,i){var o,r,s=this.__parseFont(),a=this.__closestGroupOrSvg(),l=this.__createElement("text",{"font-family":s.family,"font-size":s.size,"font-style":s.style,"font-weight":s.weight,"text-decoration":s.decoration,x:e,y:n,"text-anchor":(o=this.textAlign,r={left:"start",right:"end",center:"middle",start:"start",end:"end"},r[o]||r.start),"dominant-baseline":u(this.textBaseline)},!0);l.appendChild(this.__document.createTextNode(t)),this.__currentElement=l,this.__applyStyleToCurrentElement(i),a.appendChild(this.__wrapTextLink(s,l))},r.prototype.fillText=function(t,e,n){this.__applyText(t,e,n,"fill")},r.prototype.strokeText=function(t,e,n){this.__applyText(t,e,n,"stroke")},r.prototype.measureText=function(t){return this.__ctx.font=this.font,this.__ctx.measureText(t)},r.prototype.arc=function(t,e,n,i,o,r){if(i!==o){(i%=2*Math.PI)===(o%=2*Math.PI)&&(o=(o+2*Math.PI-.001*(r?-1:1))%(2*Math.PI));var s=t+n*Math.cos(o),a=e+n*Math.sin(o),l=t+n*Math.cos(i),h=e+n*Math.sin(i),u=r?0:1,d=0,f=o-i;f<0&&(f+=2*Math.PI),d=r?f>Math.PI?0:1:f>Math.PI?1:0,this.lineTo(l,h),this.__addPathCommand(c("A {rx} {ry} {xAxisRotation} {largeArcFlag} {sweepFlag} {endX} {endY}",{rx:n,ry:n,xAxisRotation:0,largeArcFlag:d,sweepFlag:u,endX:s,endY:a})),this.__currentPosition={x:s,y:a}}},r.prototype.clip=function(){var t=this.__closestGroupOrSvg(),e=this.__createElement("clipPath"),n=h(this.__ids),i=this.__createElement("g");this.__applyCurrentDefaultPath(),t.removeChild(this.__currentElement),e.setAttribute("id",n),e.appendChild(this.__currentElement),this.__defs.appendChild(e),t.setAttribute("clip-path",c("url(#{id})",{id:n})),t.appendChild(i),this.__currentElement=i},r.prototype.drawImage=function(){var t,e,n,i,o,s,a,l,c,h,u,d,f,p,g=Array.prototype.slice.call(arguments),m=g[0],y=0,_=0;if(3===g.length)t=g[1],e=g[2],n=o=m.width,i=s=m.height;else if(5===g.length)t=g[1],e=g[2],n=g[3],i=g[4],o=m.width,s=m.height;else{if(9!==g.length)throw new Error("Inavlid number of arguments passed to drawImage: "+arguments.length);y=g[1],_=g[2],o=g[3],s=g[4],t=g[5],e=g[6],n=g[7],i=g[8]}a=this.__closestGroupOrSvg(),this.__currentElement;var x="translate("+t+", "+e+")";if(m instanceof r){if((l=m.getSvg().cloneNode(!0)).childNodes&&l.childNodes.length>1){for(c=l.childNodes[0];c.childNodes.length;)p=c.childNodes[0].getAttribute("id"),this.__ids[p]=p,this.__defs.appendChild(c.childNodes[0]);if(h=l.childNodes[1]){var w,v=h.getAttribute("transform");w=v?v+" "+x:x,h.setAttribute("transform",w),a.appendChild(h)}}}else"IMG"===m.nodeName?((u=this.__createElement("image")).setAttribute("width",n),u.setAttribute("height",i),u.setAttribute("preserveAspectRatio","none"),(y||_||o!==m.width||s!==m.height)&&((d=this.__document.createElement("canvas")).width=n,d.height=i,(f=d.getContext("2d")).drawImage(m,y,_,o,s,0,0,n,i),m=d),u.setAttribute("transform",x),u.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","CANVAS"===m.nodeName?m.toDataURL():m.getAttribute("src")),a.appendChild(u)):"CANVAS"===m.nodeName&&((u=this.__createElement("image")).setAttribute("width",n),u.setAttribute("height",i),u.setAttribute("preserveAspectRatio","none"),(d=this.__document.createElement("canvas")).width=n,d.height=i,(f=d.getContext("2d")).imageSmoothingEnabled=!1,f.mozImageSmoothingEnabled=!1,f.oImageSmoothingEnabled=!1,f.webkitImageSmoothingEnabled=!1,f.drawImage(m,y,_,o,s,0,0,n,i),m=d,u.setAttribute("transform",x),u.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",m.toDataURL()),a.appendChild(u))},r.prototype.drawImageSvg=function(){var t,e,n,i,o,r,s,a,l=Array.prototype.slice.call(arguments),c=l[0];if(3===l.length)t=l[1],e=l[2],n=c.width,i=c.height;else if(5===l.length)t=l[1],e=l[2],n=l[3],i=l[4],c.width,c.height;else{if(9!==l.length)throw new Error("Inavlid number of arguments passed to drawImage: "+arguments.length);l[1],l[2],l[3],l[4],t=l[5],e=l[6],n=l[7],i=l[8]}o=this.__closestGroupOrSvg(),this.__currentElement;var h="translate("+t+", "+e+")";if(c instanceof SVGSVGElement&&c.childNodes&&c.childNodes.length>1){var u=parseFloat(c.getAttribute("width")),d=parseFloat(c.getAttribute("height"));c.setAttribute("width",n),c.setAttribute("height",i);var f=n/u,p=i/d;for(r=c.childNodes[0];r.childNodes.length;)a=r.childNodes[0].getAttribute("id"),this.__ids[a]=a,this.__defs.appendChild(r.childNodes[0]);if(s=c.childNodes[1]){var g,m=s.getAttribute("transform");g=m?m+" "+h:h,s.setAttribute("transform",g+" scale("+f+", "+p+")"),o.appendChild(s)}}},r.prototype.createPattern=function(t,e){var n,i=this.__document.createElementNS("http://www.w3.org/2000/svg","pattern"),o=h(this.__ids);return i.setAttribute("id",o),i.setAttribute("width",t.width),i.setAttribute("height",t.height),"CANVAS"===t.nodeName||"IMG"===t.nodeName?((n=this.__document.createElementNS("http://www.w3.org/2000/svg","image")).setAttribute("width",t.width),n.setAttribute("height",t.height),n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","CANVAS"===t.nodeName?t.toDataURL():t.getAttribute("src")),i.appendChild(n),this.__defs.appendChild(i)):t instanceof r&&(i.appendChild(t.__root.childNodes[1]),this.__defs.appendChild(i)),new a(i,this)},r.prototype.setLineDash=function(t){t&&t.length>0?this.lineDash=t.join(","):this.lineDash=null},r.prototype.drawFocusRing=function(){},r.prototype.createImageData=function(){},r.prototype.getImageData=function(){},r.prototype.putImageData=function(){},r.prototype.globalCompositeOperation=function(){},r.prototype.setTransform=function(){};var f=r;function p(t,e,n){const i=t.width,o=t.height,r=document.createElement("div");n.newElement("svgUIDiv",r);const s=document.createElement("button");s.className="button2",s.innerText="Make SVG",s.onclick=function(){const n=t.ctx,i=t.fctx;t.setCtx(d),t.setFCtx(d),t.setNoBuffers(!0);const o=t.mctx;t.setMCtx(p);const{heightBrowser:r}=t.maps;s=r,u.style.height=`${Math.round(s)}px`,u.height=s,p.__root.setAttribute("height",s),e(),function(){c.hidden=!1;const t=d.getSerializedSvg(!0);h.innerHTML=t,h.hidden=!1,a.hidden=!1;const e=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(t)}`;a.href=e}(),function(){const t=p.getSerializedSvg(!0);u.innerHTML=t,u.hidden=!1,l.hidden=!1;const e=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(t)}`;l.href=e}(),t.setCtx(n),t.setFCtx(i),t.setNoBuffers(!1),t.setMCtx(o);var s},r.appendChild(s);const a=document.createElement("a");a.innerText="Download SVG",a.download="vote.svg",a.hidden=!0,a.style.margin="4px",r.appendChild(a);const l=document.createElement("a");l.innerText="Download Map SVG",l.download="vote_map.svg",l.hidden=!0,l.style.margin="4px",r.appendChild(l);const c=document.createElement("button");c.className="button2",c.innerText="Hide SVG",c.hidden=!0,c.onclick=function(){c.hidden=!0,h.hidden=!0,a.hidden=!0,u.hidden=!0,l.hidden=!0},r.appendChild(c);const h=document.createElement("div");h.setAttribute("class","svgDiv"),h.style.width=`${i}px`,h.style.height=`${o}px`,h.hidden=!0,r.appendChild(h);const u=document.createElement("div");u.setAttribute("class","mSvgDiv"),u.style.width=`${i}px`,u.style.height=`${Math.round(o/3)}px`,u.hidden=!0,r.appendChild(u);const d=new f(i,o),p=new f(i,Math.round(o/3))}function g(t,e){const n=this;n.config=t,n.name=t.name,n.nameIsHTML=t.nameIsHTML||!1,n.dom=document.createElement("div"),n.dom.setAttribute("class","button button2");let i=t.margin;i=i||0,i=Math.max(i,4),n.dom.style.marginRight=`${i}px`,n.draw=function(){n.nameIsHTML?n.dom.innerHTML=n.name:n.dom.innerText=n.name},n.draw(),n.dom.setAttribute("title",t.realname||""),n.onClick=function(){e(n,t)},n.dom.onclick=n.onClick,n.turnOff=function(){n.isOn=!1,n.config.isOn=!1,n.dom.setAttribute("on","no")},n.turnOn=function(){n.isOn=!0,n.config.isOn=!0,n.dom.setAttribute("on","yes")},n.turnOff()}function m(t){const e=this;e.config=t,void 0===t.data&&(t.data=[],void 0===t.makeData&&(t.makeData=()=>[]),e.makeData=t.makeData,e.buttonConfigs=e.makeData(),e.doMakeData=!0),e.buttonConfigs=t.data,e.labelName=t.label,e.labelIsHTML=t.labelIsHTML||!1,e.onChoose=t.onChoose,e.isCheckbox=t.isCheckbox||!1,e.isCheckboxBool=t.isCheckboxBool||!1,e.justButton=t.justButton||!1,e.buttonHidden=t.buttonHidden||{},e.dom=document.createElement("div"),e.dom.setAttribute("class","button-group"),e.buttonDOMByValue=[],e.init=function(){e.doMakeData&&(e.buttonConfigs=e.makeData()),e.dom.innerHTML="",e.buttons=[],e.buttonsByName={},e.labelDOM=document.createElement("div"),e.labelDOM.setAttribute("class","button-group-label"),e.draw(),e.labelDOM.classList.toggle("seeit"),e.labelDOM.onclick=()=>{e.labelDOM.classList.toggle("seeit")},e.dom.appendChild(e.labelDOM);for(let n=0;n<e.buttonConfigs.length;n++){const i=e.buttonConfigs[n],o=new g(i,e.onToggle);e.buttonsByName[i.name]=o,o.dom.style.width=`${t.width}px`,i.width&&(o.dom.style.width=`${i.width}px`),e.buttons.push(o),e.dom.appendChild(o.dom),e.buttonDOMByValue[i.value]=o.dom}for(let t=0;t<e.buttons.length;t++){const n=e.buttons[t];if(n.config.selected){n.turnOn();break}}e.draw()},e.updateNames=function(){const t=e.makeData();for(let n=0;n<e.buttonConfigs.length;n++)e.buttonConfigs[n].name=t[n].name,e.buttons[n].name=e.buttonConfigs[n].name},e.redraw=function(){e.updateNames(),e.draw()},e.draw=function(){e.labelIsHTML?e.labelDOM.innerHTML=e.labelName:e.labelDOM.innerText=e.labelName;for(const t of e.buttons)t.draw()},e.configureHidden=function(){for(const[t,n]of Object.entries(e.buttonHidden))e.buttonsByName[t].dom.hidden=n},e.onToggle=function(t,n){if(e.isCheckbox||e.isCheckboxBool)t.isOn?t.turnOff():t.turnOn();else{for(let t=0;t<e.buttons.length;t++)e.buttons[t].turnOff();t.turnOn(),e.justButton&&setTimeout((()=>t.turnOff()),800)}e.onChoose(n)},e.highlight=function(t,n){if(0!==e.buttons.length){for(let t=0;t<e.buttons.length;t++)e.buttons[t].turnOff();if(e.isCheckbox)for(const i in e.buttons){const o=e.buttons[i];n.includes(o.config[t])&&o.turnOn()}else if(e.isCheckboxBool)for(const i in e.buttons){const o=e.buttons[i],r=o.config[t];r in n&&n[r]&&o.turnOn()}else{const i=e.buttons.filter((e=>{const{config:i}=e;return i[t]===n}))[0];void 0!==i&&i.turnOn()}}},e.init()}function y(t,e,n,i,o,r,s,a){const l=this;l.list=o,l.onChoose=function(t){l.sender.go(t.value)},l.action=t=>{l.set(t),l.select()},l.sender=a.addSender({name:e,action:l.action,currentValue:t[e]}),l.set=function(t){n(t),l.configure(),s.add(r)},l.choose=new m({label:i,width:_(3),data:l.list,onChoose:l.onChoose}),l.configure=function(){},l.select=function(){l.choose.highlight("value",t[e])}}function _(t){return(302-18*(t-1)-10)/t}function x(t,e,n){const i=this;i.divMenu=document.createElement("div"),e.newElement("menu",i.divMenu),i.addMenuItem=function(e,o){const{prop:r,setProp:s,label:a,options:l,change:c}=o,h=new y(e,r,s,a,l,c,t,n);h.select(),i.divMenu.appendChild(h.choose.dom)}}function w(t){const e=function(t){const e=t.map((t=>t.shape1.w)),n=e.reduce(((t,e)=>t+e)),i=e.map((t=>t/n)),o=[];return i.reduce(((t,e,n)=>{const i=t+e;return o[n]=i,i}),0),o}(t);this.samplePoint=function(){return function(t,e){const n=function(t){const e=Math.random();return t.findIndex((t=>t>=e))}(e),i=t[n],o="gaussian"===i.shape1.densityProfile;return(o?b:v)(i.shape1.x,.5*i.shape1.w)}(t,e)}}function v(t,e){return{x:(2*Math.random()-1)*e+t}}function b(t,e){const n=Math.random(),i=Math.random();return{x:2*e/Math.sqrt(2*Math.PI)*Math.sqrt(-2*Math.log(n))*Math.cos(2*Math.PI*i)+t}}function C(t){const e=function(t){const e=t.map((t=>t.shape2.w**2)),n=e.reduce(((t,e)=>t+e)),i=e.map((t=>t/n)),o=[];return i.reduce(((t,e,n)=>{const i=t+e;return o[n]=i,i}),0),o}(t);this.samplePoint=function(){return function(t,e){const n=function(t){const e=Math.random();return t.findIndex((t=>t>=e))}(e),i=t[n];return function(t,e,n){const i=n*Math.sqrt(Math.random()),o=2*Math.random()*Math.PI,r=t+i*Math.cos(o),s=e+i*Math.sin(o);return{x:r,y:s}}(i.shape2.x,i.shape2.y,.5*i.shape2.w)}(t,e)}}function A(t,e){const n=this,i=[];n.rendererMaker=()=>({render:()=>{}}),n.newCandidate=function(t){i.push(t),t.graphic.setRenderer(n.rendererMaker)},n.getSimCandidateDistributions=()=>i.filter((t=>t.canDn.exists)),n.getCandidateDistributions=()=>n.getSimCandidateDistributions().map((t=>t.canDn)),n.getCandidateDistributionsAll=()=>i.map((t=>t.canDn)),n.update=()=>{e.checkNone()||n.startSampler()},n.startSampler=()=>{const e=n.getCandidateDistributions();if(0===e.length)return;const{dimensions:i}=t.election,o=1===i?w:C;n.sampler=new o(e)},n.updateXY=()=>{i.forEach((t=>t.canDn.updateXY()))},n.render=()=>{i.forEach((t=>{t.canDn.exists&&t.graphic.renderer.render()}))},n.setRenderer=t=>{n.rendererMaker=t,i.forEach((e=>e.graphic.setRenderer(t)))},n.renderForeground=()=>{t.showGhosts?n.renderForegroundAll():n.renderForegroundExisting()},n.renderForegroundExisting=()=>{i.forEach((t=>{t.canDn.exists&&t.graphic.renderForeground()}))},n.renderForegroundAll=()=>{i.forEach((t=>t.graphic.renderForeground()))}}function S(){throw new Error("setTimeout has not been defined")}function M(){throw new Error("clearTimeout has not been defined")}var E,k=S,T=M;function P(t){if(k===setTimeout)return setTimeout(t,0);if((k===S||!k)&&setTimeout)return k=setTimeout,setTimeout(t,0);try{return k(t,0)}catch(e){try{return k.call(null,t,0)}catch(e){return k.call(this,t,0)}}}"function"==typeof(E="undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).setTimeout&&(k=setTimeout),"function"==typeof E.clearTimeout&&(T=clearTimeout);var F,N=[],D=!1,L=-1;function I(){D&&F&&(D=!1,F.length?N=F.concat(N):L=-1,N.length&&R())}function R(){if(!D){var t=P(I);D=!0;for(var e=N.length;e;){for(F=N,N=[];++L<e;)F&&F[L].run();L=-1,e=N.length}F=null,D=!1,function(t){if(T===clearTimeout)return clearTimeout(t);if((T===M||!T)&&clearTimeout)return T=clearTimeout,clearTimeout(t);try{T(t)}catch(e){try{return T.call(null,t)}catch(e){return T.call(this,t)}}}(t)}}function V(t,e){this.fun=t,this.array=e}V.prototype.run=function(){this.fun.apply(null,this.array)};function O(){}var B=O,q=O,G=O,j=O,H=O,$=O,W=O;var U=E.performance||{},z=U.now||U.mozNow||U.msNow||U.oNow||U.webkitNow||function(){return(new Date).getTime()};var X=new Date;var Y,J={nextTick:function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];N.push(new V(t,e)),1!==N.length||D||P(R)},title:"browser",browser:!0,env:{NODE_ENV:"production"},argv:[],version:"",versions:{},on:B,addListener:q,once:G,off:j,removeListener:H,removeAllListeners:$,emit:W,binding:function(t){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(t){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(t){var e=.001*z.call(U),n=Math.floor(e),i=Math.floor(e%1*1e9);return t&&(n-=t[0],(i-=t[1])<0&&(n--,i+=1e9)),[n,i]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-X)/1e3}},K={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-K.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*K.Bounce.In(2*t):.5*K.Bounce.Out(2*t-1)+.5}}},Z="undefined"==typeof self&&void 0!==J&&J.hrtime?function(){var t=J.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?self.performance.now.bind(self.performance):void 0!==Date.now?Date.now:function(){return(new Date).getTime()},Q=function(){function t(){this._tweens={},this._tweensAddedDuringUpdate={}}return t.prototype.getAll=function(){var t=this;return Object.keys(this._tweens).map((function(e){return t._tweens[e]}))},t.prototype.removeAll=function(){this._tweens={}},t.prototype.add=function(t){this._tweens[t.getId()]=t,this._tweensAddedDuringUpdate[t.getId()]=t},t.prototype.remove=function(t){delete this._tweens[t.getId()],delete this._tweensAddedDuringUpdate[t.getId()]},t.prototype.update=function(t,e){void 0===t&&(t=Z()),void 0===e&&(e=!1);var n=Object.keys(this._tweens);if(0===n.length)return!1;for(;n.length>0;){this._tweensAddedDuringUpdate={};for(var i=0;i<n.length;i++){var o=this._tweens[n[i]],r=!e;o&&!1===o.update(t,r)&&!e&&delete this._tweens[n[i]]}n=Object.keys(this._tweensAddedDuringUpdate)}return!0},t}(),tt={Linear:function(t,e){var n=t.length-1,i=n*e,o=Math.floor(i),r=tt.Utils.Linear;return e<0?r(t[0],t[1],i):e>1?r(t[n],t[n-1],n-i):r(t[o],t[o+1>n?n:o+1],i-o)},Bezier:function(t,e){for(var n=0,i=t.length-1,o=Math.pow,r=tt.Utils.Bernstein,s=0;s<=i;s++)n+=o(1-e,i-s)*o(e,s)*t[s]*r(i,s);return n},CatmullRom:function(t,e){var n=t.length-1,i=n*e,o=Math.floor(i),r=tt.Utils.CatmullRom;return t[0]===t[n]?(e<0&&(o=Math.floor(i=n*(1+e))),r(t[(o-1+n)%n],t[o],t[(o+1)%n],t[(o+2)%n],i-o)):e<0?t[0]-(r(t[0],t[0],t[1],t[1],-i)-t[0]):e>1?t[n]-(r(t[n],t[n],t[n-1],t[n-1],i-n)-t[n]):r(t[o?o-1:0],t[o],t[n<o+1?n:o+1],t[n<o+2?n:o+2],i-o)},Utils:{Linear:function(t,e,n){return(e-t)*n+t},Bernstein:function(t,e){var n=tt.Utils.Factorial;return n(t)/n(e)/n(t-e)},Factorial:(Y=[1],function(t){var e=1;if(Y[t])return Y[t];for(var n=t;n>1;n--)e*=n;return Y[t]=e,e}),CatmullRom:function(t,e,n,i,o){var r=.5*(n-t),s=.5*(i-e),a=o*o;return(2*e-2*n+r+s)*(o*a)+(-3*e+3*n-2*r-s)*a+r*o+e}}},et=function(){function t(){}return t.nextId=function(){return t._nextId++},t._nextId=0,t}(),nt=new Q,it=function(){function t(t,e){void 0===e&&(e=nt),this._object=t,this._group=e,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=K.Linear.None,this._interpolationFunction=tt.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._id=et.nextId(),this._isChainStopped=!1,this._goToEnd=!1}return t.prototype.getId=function(){return this._id},t.prototype.isPlaying=function(){return this._isPlaying},t.prototype.isPaused=function(){return this._isPaused},t.prototype.to=function(t,e){return this._valuesEnd=Object.create(t),void 0!==e&&(this._duration=e),this},t.prototype.duration=function(t){return this._duration=t,this},t.prototype.start=function(t){if(this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed)for(var e in this._reversed=!1,this._valuesStartRepeat)this._swapEndStartRepeatValues(e),this._valuesStart[e]=this._valuesStartRepeat[e];return this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=void 0!==t?"string"==typeof t?Z()+parseFloat(t):t:Z(),this._startTime+=this._delayTime,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat),this},t.prototype._setupProperties=function(t,e,n,i){for(var o in n){var r=t[o],s=Array.isArray(r),a=s?"array":typeof r,l=!s&&Array.isArray(n[o]);if("undefined"!==a&&"function"!==a){if(l){var c=n[o];if(0===c.length)continue;c=c.map(this._handleRelativeValue.bind(this,r)),n[o]=[r].concat(c)}if("object"!==a&&!s||!r||l)void 0===e[o]&&(e[o]=r),s||(e[o]*=1),i[o]=l?n[o].slice().reverse():e[o]||0;else{for(var h in e[o]=s?[]:{},r)e[o][h]=r[h];i[o]=s?[]:{},this._setupProperties(r,e[o],n[o],i[o])}}}},t.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},t.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},t.prototype.pause=function(t){return void 0===t&&(t=Z()),this._isPaused||!this._isPlaying||(this._isPaused=!0,this._pauseStart=t,this._group&&this._group.remove(this)),this},t.prototype.resume=function(t){return void 0===t&&(t=Z()),this._isPaused&&this._isPlaying?(this._isPaused=!1,this._startTime+=t-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this):this},t.prototype.stopChainedTweens=function(){for(var t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].stop();return this},t.prototype.group=function(t){return this._group=t,this},t.prototype.delay=function(t){return this._delayTime=t,this},t.prototype.repeat=function(t){return this._initialRepeat=t,this._repeat=t,this},t.prototype.repeatDelay=function(t){return this._repeatDelayTime=t,this},t.prototype.yoyo=function(t){return this._yoyo=t,this},t.prototype.easing=function(t){return this._easingFunction=t,this},t.prototype.interpolation=function(t){return this._interpolationFunction=t,this},t.prototype.chain=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._chainedTweens=t,this},t.prototype.onStart=function(t){return this._onStartCallback=t,this},t.prototype.onUpdate=function(t){return this._onUpdateCallback=t,this},t.prototype.onRepeat=function(t){return this._onRepeatCallback=t,this},t.prototype.onComplete=function(t){return this._onCompleteCallback=t,this},t.prototype.onStop=function(t){return this._onStopCallback=t,this},t.prototype.update=function(t,e){if(void 0===t&&(t=Z()),void 0===e&&(e=!0),this._isPaused)return!0;var n,i,o=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(t>o)return!1;e&&this.start(t)}if(this._goToEnd=!1,t<this._startTime)return!0;!1===this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),i=(t-this._startTime)/this._duration,i=0===this._duration||i>1?1:i;var r=this._easingFunction(i);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,r),this._onUpdateCallback&&this._onUpdateCallback(this._object,i),1===i){if(this._repeat>0){for(n in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat)this._yoyo||"string"!=typeof this._valuesEnd[n]||(this._valuesStartRepeat[n]=this._valuesStartRepeat[n]+parseFloat(this._valuesEnd[n])),this._yoyo&&this._swapEndStartRepeatValues(n),this._valuesStart[n]=this._valuesStartRepeat[n];return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=t+this._repeatDelayTime:this._startTime=t+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var s=0,a=this._chainedTweens.length;s<a;s++)this._chainedTweens[s].start(this._startTime+this._duration);return this._isPlaying=!1,!1}return!0},t.prototype._updateProperties=function(t,e,n,i){for(var o in n)if(void 0!==e[o]){var r=e[o]||0,s=n[o],a=Array.isArray(t[o]),l=Array.isArray(s);!a&&l?t[o]=this._interpolationFunction(s,i):"object"==typeof s&&s?this._updateProperties(t[o],r,s,i):"number"==typeof(s=this._handleRelativeValue(r,s))&&(t[o]=r+(s-r)*i)}},t.prototype._handleRelativeValue=function(t,e){return"string"!=typeof e?e:"+"===e.charAt(0)||"-"===e.charAt(0)?t+parseFloat(e):parseFloat(e)},t.prototype._swapEndStartRepeatValues=function(t){var e=this._valuesStartRepeat[t],n=this._valuesEnd[t];this._valuesStartRepeat[t]="string"==typeof n?this._valuesStartRepeat[t]+parseFloat(n):this._valuesEnd[t],this._valuesEnd[t]=e},t}(),ot=(et.nextId,nt);ot.getAll.bind(ot),ot.removeAll.bind(ot),ot.add.bind(ot),ot.remove.bind(ot),ot.update.bind(ot);function rt(t,e,n,i){const o=this;o.w=e,o.h=n,o.trueW=e,o.trueH=n,o.pickUp=function(){o.tweenSq=new it(o),o.tweenSq.to({w:o.trueW+10,h:o.trueH+10},100),o.tweenSq.start()},o.drop=function(){o.tweenSq=new it(o),o.tweenSq.to({w:o.trueW,h:o.trueH},100),o.tweenSq.start()},o.render=function(){const{fctx:e}=i;e.save(),o.tweenSq&&o.tweenSq.update(),0===t.exists&&(e.globalAlpha=.2),e.beginPath(),e.fillStyle=t.color,e.rect(t.x-.5*o.w-.5,t.y-.5*o.h-.5,o.w+1,o.h+1),e.fill(),e.stroke(),e.restore()}}function st(t,e){const n=this,i=new rt(t,21,21,e);n.square=i,n.renderForeground=()=>{i.render()},n.setRenderer=e=>{n.renderer=e(t)}}function at(t,e,n){const i=this;i.canDn=t,i.graphic=new st(t,n),e.newSquareHandle(t,i.graphic.square)}function lt(t){const e=this,n=[];e.list=n,e.rendererMaker=()=>({render:()=>{}}),e.newVoterSim=function(t){n.push(t),t.graphic.setRenderer(e.rendererMaker)},e.getVoterShapes=()=>n.filter((t=>t.voterShape.exists)).map((t=>t.voterShape)),e.getVoterSims=()=>n.filter((t=>t.voterShape.exists)),e.update=()=>{},e.updateXY=()=>{n.forEach((t=>t.voterShape.updateXY()))},e.updateVoters=()=>{},e.render=()=>{n.forEach((t=>{t.voterShape.exists&&t.graphic.renderer.render()}))},e.setRenderer=t=>{e.rendererMaker=t,n.forEach((e=>e.graphic.setRenderer(t)))},e.updateGraphic=t=>{const n=e.getVoterSims();void 0===t?n.forEach((t=>t.graphic.renderer.update())):n.forEach(((e,n)=>e.graphic.renderer.update(t[n])))},e.renderForeground=()=>{t.showGhosts?e.renderForegroundAll():e.renderForegroundExisting()},e.renderForegroundExisting=()=>{n.forEach((t=>{t.voterShape.exists&&t.graphic.renderForeground()}))},e.renderForegroundAll=()=>{n.forEach((t=>{t.graphic.renderForeground()}))},e.renderBackground=()=>{n.forEach((t=>{t.voterShape.exists&&t.graphic.renderer.renderBackground()}))}}function ct(t,e,n,i,o,r,s,a,l){a.save(),a.globalAlpha=s,a.textAlign=l||"center",a.font=`${i}px Sans-serif`,a.lineWidth=o,a.fillStyle=r,a.fillText(t,e,n),a.restore()}function ht(t){return(100*t).toFixed(0)}function ut(t){return[...Array(t).keys()]}function dt(t){return JSON.parse(JSON.stringify(t))}function ft(t){return"object"==typeof t?Array.isArray(t)?t.map(ft):Object.keys(t).sort().reduce(((e,n)=>{const i=t[n];return e[n]=ft(i),e}),{}):t}function pt(t,e,n){return 1/(n*Math.sqrt(2*Math.PI))*Math.exp(-.5*((t-e)/n)**2)}function gt(t,e,n){return t===1/0?1:t===-1/0?0:.5*function(t){const e=.147,n=t**2,i=1+e*n,o=-(4/Math.PI+e*n)/i*n,r=Math.exp(o),s=Math.sqrt(1-r);return s*Math.sign(t)}((t-e)/(n*Math.sqrt(2)))+.5}function mt(t){const e=document.createElement("canvas"),n=e.getContext("2d");n.fillStyle=t;const i=n.fillStyle;return e.remove(),i}function yt(t){let e=1/0,n=null;for(let i=0;i<t.length;i++){const o=t[i];o<e&&(e=o,n=i)}return n}function _t(t){let e=-1/0,n=null;for(let i=0;i<t.length;i++){const o=t[i];o>e&&(e=o,n=i)}return n}function xt(t,e,n){return t<e?e:t>n?n:t}function wt(t){const e=t.length,n=Array(e);for(let i=0;i<e;i++)n[i]=t[i];return n}function vt(t){return{...t}}function bt(t,e,n){const i=this;let o={};const r=[],s=t.tooltips;i.newSquareHandle=function(t,e){r.push({o:t,g:e,p:{isSquare:!0}})},i.newCircleHandle=function(t,e){r.push({o:t,g:e,p:{isCircle:!0}})};const a=function(t){if(null!==t.target.closest(".tooltipBox"))return;const e=u(t),i=t.isTouch?10:0,a=r.length,l=[];for(let t=0;t<a;t++){const o=r[t];(o.o.exists||n.showGhosts)&&d(o,e,i)&&l.push(t)}if(l.length>0){const t=l.map((t=>{const n=r[t];return(n.o.x-e.x)**2+(n.o.y-e.y)**2})),n=l[yt(t)],i=r[n];o.iDragging=n,o.isDragging=!0,o.offX=i.o.x-e.x,o.offY=i.o.y-e.y,i.g.pickUp(),s.dataset.cursor="grabbing"}!function(t){f=!0,p=vt(t)}(e)},l=function(i){const a=u(i);if(o.isDragging){i.isTouch&&(i.preventDefault(),i.stopPropagation());const n=r[o.iDragging],s=t.width,l=t.height;n.o.setXY({x:xt(a.x+o.offX,0,s),y:xt(a.y+o.offY,0,l)}),e.add(["draggables"])}else{const t=r.length;for(let e=0;e<t;e++){const t=r[e];if((n.showGhosts||t.o.exists)&&d(t,a,0))return void(s.dataset.cursor="grab")}s.dataset.cursor=""}!function(t){if(f){const e=Math.abs(p.x-t.x),n=Math.abs(p.y-t.y);e>5&&(f=!1),n>5&&(f=!1)}}(a)},c=function(){if(function(){if(f)if(f=!1,o.isDragging){r[o.iDragging].o.click()}else t=p,n.voterTest.start(t);var t}(),void 0!==o.iDragging){r[o.iDragging].g.drop()}o={}};function h(t){return t.isTouch=!0,t}function u(e){const n=t.canvas.getBoundingClientRect(),i=e.isTouch?e.changedTouches[0]:e;return{x:i.clientX-n.left,y:i.clientY-n.top}}function d(t,e,n){const i=t.o.x-e.x,o=t.o.y-e.y;if(t.p.isCircle){const{r:e}=t.g;return i*i+o*o<(e+n)*(e+n)}if(t.p.isSquare){const{w:e,h:r}=t.g;return Math.abs(i)<.5*e+n&&Math.abs(o)<.5*r+n}return!1}let f,p;i.eventHandlers={start:a,move:l,end:c,touchmove:t=>{const e=h(t);l(e)},touchstart:t=>{const e=h(t);a(e)},touchend:t=>{const e=h(t);l(e),c(),null===t.target.closest(".tooltipBox")&&t.preventDefault()}}}function Ct(t,e,n){const i=this;i.dragm=new bt(t,e,n),i.enter=()=>{t.eventHandlers.set(i.dragm.eventHandlers)},i.exit=()=>{},i.update=()=>{if(e.checkNone())return;t.clear();const[n,i]=[150,150];ct("Not Yet Implemented",n,i,20,2,"#222",1,t.ctx)},i.render=()=>{},i.renderForeground=()=>{},i.testVoteSim=()=>{}}function At(t,e,n){const i=this;i.r=e,i.trueR=e,i.pickUp=function(){i.tween=new it(i),i.tween.to({r:2*i.trueR},100),i.tween.start()},i.drop=function(){i.tween=new it(i),i.tween.to({r:i.trueR},100),i.tween.start()},i.render=function(){const{fctx:e}=n,{color:o}=t;e.save(),i.tween&&i.tween.update(),0===t.exists&&(e.globalAlpha=.2),e.beginPath(),e.fillStyle=o,e.arc(t.x,t.y,i.r,0,2*Math.PI),e.fill(),e.stroke(),e.restore()}}function St(t,e){const n=this,i=new At(t,13,e);n.circle=i,n.renderForeground=()=>{i.render()},n.setRenderer=e=>{n.renderer=e(t)}}function Mt(t,e,n){const i=this;i.voterShape=t,i.graphic=new St(t,n),e.newCircleHandle(t,i.graphic.circle)}const Et=.5*(Math.sqrt(3)-1),kt=(3-Math.sqrt(3))/6,Tt=1/6,Pt=(Math.sqrt(5)-1)/4,Ft=(5-Math.sqrt(5))/20,Nt=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),Dt=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);class Lt{constructor(t=Math.random){const e="function"==typeof t?t:function(t){let e=0,n=0,i=0,o=1;const r=function(){let t=4022871197;return function(e){e=e.toString();for(let n=0;n<e.length;n++){t+=e.charCodeAt(n);let i=.02519603282416938*t;t=i>>>0,i-=t,i*=t,t=i>>>0,i-=t,t+=4294967296*i}return 2.3283064365386963e-10*(t>>>0)}}();e=r(" "),n=r(" "),i=r(" "),e-=r(t),e<0&&(e+=1);n-=r(t),n<0&&(n+=1);i-=r(t),i<0&&(i+=1);return function(){const t=2091639*e+2.3283064365386963e-10*o;return e=n,n=i,i=t-(o=0|t)}}(t);this.p=function(t){const e=new Uint8Array(256);for(let t=0;t<256;t++)e[t]=t;for(let n=0;n<255;n++){const i=n+~~(t()*(256-n)),o=e[n];e[n]=e[i],e[i]=o}return e}(e),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let t=0;t<512;t++)this.perm[t]=this.p[255&t],this.permMod12[t]=this.perm[t]%12}noise2D(t,e){const n=this.permMod12,i=this.perm;let o=0,r=0,s=0;const a=(t+e)*Et,l=Math.floor(t+a),c=Math.floor(e+a),h=(l+c)*kt,u=t-(l-h),d=e-(c-h);let f,p;u>d?(f=1,p=0):(f=0,p=1);const g=u-f+kt,m=d-p+kt,y=u-1+2*kt,_=d-1+2*kt,x=255&l,w=255&c;let v=.5-u*u-d*d;if(v>=0){const t=3*n[x+i[w]];v*=v,o=v*v*(Nt[t]*u+Nt[t+1]*d)}let b=.5-g*g-m*m;if(b>=0){const t=3*n[x+f+i[w+p]];b*=b,r=b*b*(Nt[t]*g+Nt[t+1]*m)}let C=.5-y*y-_*_;if(C>=0){const t=3*n[x+1+i[w+1]];C*=C,s=C*C*(Nt[t]*y+Nt[t+1]*_)}return 70*(o+r+s)}noise3D(t,e,n){const i=this.permMod12,o=this.perm;let r,s,a,l;const c=.3333333333333333*(t+e+n),h=Math.floor(t+c),u=Math.floor(e+c),d=Math.floor(n+c),f=(h+u+d)*Tt,p=t-(h-f),g=e-(u-f),m=n-(d-f);let y,_,x,w,v,b;p>=g?g>=m?(y=1,_=0,x=0,w=1,v=1,b=0):p>=m?(y=1,_=0,x=0,w=1,v=0,b=1):(y=0,_=0,x=1,w=1,v=0,b=1):g<m?(y=0,_=0,x=1,w=0,v=1,b=1):p<m?(y=0,_=1,x=0,w=0,v=1,b=1):(y=0,_=1,x=0,w=1,v=1,b=0);const C=p-y+Tt,A=g-_+Tt,S=m-x+Tt,M=p-w+.3333333333333333,E=g-v+.3333333333333333,k=m-b+.3333333333333333,T=p-1+.5,P=g-1+.5,F=m-1+.5,N=255&h,D=255&u,L=255&d;let I=.6-p*p-g*g-m*m;if(I<0)r=0;else{const t=3*i[N+o[D+o[L]]];I*=I,r=I*I*(Nt[t]*p+Nt[t+1]*g+Nt[t+2]*m)}let R=.6-C*C-A*A-S*S;if(R<0)s=0;else{const t=3*i[N+y+o[D+_+o[L+x]]];R*=R,s=R*R*(Nt[t]*C+Nt[t+1]*A+Nt[t+2]*S)}let V=.6-M*M-E*E-k*k;if(V<0)a=0;else{const t=3*i[N+w+o[D+v+o[L+b]]];V*=V,a=V*V*(Nt[t]*M+Nt[t+1]*E+Nt[t+2]*k)}let O=.6-T*T-P*P-F*F;if(O<0)l=0;else{const t=3*i[N+1+o[D+1+o[L+1]]];O*=O,l=O*O*(Nt[t]*T+Nt[t+1]*P+Nt[t+2]*F)}return 32*(r+s+a+l)}noise4D(t,e,n,i){const o=this.perm;let r,s,a,l,c;const h=(t+e+n+i)*Pt,u=Math.floor(t+h),d=Math.floor(e+h),f=Math.floor(n+h),p=Math.floor(i+h),g=(u+d+f+p)*Ft,m=t-(u-g),y=e-(d-g),_=n-(f-g),x=i-(p-g);let w=0,v=0,b=0,C=0;m>y?w++:v++,m>_?w++:b++,m>x?w++:C++,y>_?v++:b++,y>x?v++:C++,_>x?b++:C++;const A=w>=3?1:0,S=v>=3?1:0,M=b>=3?1:0,E=C>=3?1:0,k=w>=2?1:0,T=v>=2?1:0,P=b>=2?1:0,F=C>=2?1:0,N=w>=1?1:0,D=v>=1?1:0,L=b>=1?1:0,I=C>=1?1:0,R=m-A+Ft,V=y-S+Ft,O=_-M+Ft,B=x-E+Ft,q=m-k+2*Ft,G=y-T+2*Ft,j=_-P+2*Ft,H=x-F+2*Ft,$=m-N+3*Ft,W=y-D+3*Ft,U=_-L+3*Ft,z=x-I+3*Ft,X=m-1+4*Ft,Y=y-1+4*Ft,J=_-1+4*Ft,K=x-1+4*Ft,Z=255&u,Q=255&d,tt=255&f,et=255&p;let nt=.6-m*m-y*y-_*_-x*x;if(nt<0)r=0;else{const t=o[Z+o[Q+o[tt+o[et]]]]%32*4;nt*=nt,r=nt*nt*(Dt[t]*m+Dt[t+1]*y+Dt[t+2]*_+Dt[t+3]*x)}let it=.6-R*R-V*V-O*O-B*B;if(it<0)s=0;else{const t=o[Z+A+o[Q+S+o[tt+M+o[et+E]]]]%32*4;it*=it,s=it*it*(Dt[t]*R+Dt[t+1]*V+Dt[t+2]*O+Dt[t+3]*B)}let ot=.6-q*q-G*G-j*j-H*H;if(ot<0)a=0;else{const t=o[Z+k+o[Q+T+o[tt+P+o[et+F]]]]%32*4;ot*=ot,a=ot*ot*(Dt[t]*q+Dt[t+1]*G+Dt[t+2]*j+Dt[t+3]*H)}let rt=.6-$*$-W*W-U*U-z*z;if(rt<0)l=0;else{const t=o[Z+N+o[Q+D+o[tt+L+o[et+I]]]]%32*4;rt*=rt,l=rt*rt*(Dt[t]*$+Dt[t+1]*W+Dt[t+2]*U+Dt[t+3]*z)}let st=.6-X*X-Y*Y-J*J-K*K;if(st<0)c=0;else{const t=o[Z+1+o[Q+1+o[tt+1+o[et+1]]]]%32*4;st*=st,c=st*st*(Dt[t]*X+Dt[t+1]*Y+Dt[t+2]*J+Dt[t+3]*K)}return 27*(r+s+a+l+c)}}function It(t,e){const n=this;n.sn=[];n.genNoise=()=>{n.sn=function(t,e,n,i,o,r){const s=new Lt("s"),a=new Lt("seed"),l=function(t,e){return Array(t).fill().map((()=>Array(e).fill().map((()=>Array(2).fill(0)))))}(t,e);let c=0,h=0;Rt(t).forEach((o=>{Rt(e).forEach((r=>{const u=o/t*(1/n),d=r/e*(1/i),f=s.noise2D(u,d),p=a.noise2D(u,d);l[o][r][0]=f-.5,l[o][r][1]=p-.5,c+=f,h+=p}))}));const u=c/(t*e)-.5,d=h/(t*e)-.5;return l.forEach((t=>{t.forEach((t=>{t[0]=(t[0]-u)*o,t[1]=(t[1]-d)*r}))})),l}(t,e,.5,.5,100,100)}}function Rt(t){return[...Array(t).keys()]}function Vt(t){for(var e,n=-1,i=t.length,o=t[i-1],r=0;++n<i;)e=o,o=t[n],r+=e[1]*o[0]-e[0]*o[1];return r/2}function Ot(t){for(var e,n,i=-1,o=t.length,r=0,s=0,a=t[o-1],l=0;++i<o;)e=a,a=t[i],l+=n=e[0]*a[1]-a[0]*e[1],r+=(e[0]+a[0])*n,s+=(e[1]+a[1])*n;return[r/(l*=3),s/l]}const Bt=134217729;function qt(t,e,n,i,o){let r,s,a,l,c=e[0],h=i[0],u=0,d=0;h>c==h>-c?(r=c,c=e[++u]):(r=h,h=i[++d]);let f=0;if(u<t&&d<n)for(h>c==h>-c?(s=c+r,a=r-(s-c),c=e[++u]):(s=h+r,a=r-(s-h),h=i[++d]),r=s,0!==a&&(o[f++]=a);u<t&&d<n;)h>c==h>-c?(s=r+c,l=s-r,a=r-(s-l)+(c-l),c=e[++u]):(s=r+h,l=s-r,a=r-(s-l)+(h-l),h=i[++d]),r=s,0!==a&&(o[f++]=a);for(;u<t;)s=r+c,l=s-r,a=r-(s-l)+(c-l),c=e[++u],r=s,0!==a&&(o[f++]=a);for(;d<n;)s=r+h,l=s-r,a=r-(s-l)+(h-l),h=i[++d],r=s,0!==a&&(o[f++]=a);return 0===r&&0!==f||(o[f++]=r),f}function Gt(t){return new Float64Array(t)}const jt=Gt(4),Ht=Gt(8),$t=Gt(12),Wt=Gt(16),Ut=Gt(4);function zt(t,e,n,i,o,r){const s=(e-r)*(n-o),a=(t-o)*(i-r),l=s-a;if(0===s||0===a||s>0!=a>0)return l;const c=Math.abs(s+a);return Math.abs(l)>=33306690738754716e-32*c?l:-function(t,e,n,i,o,r,s){let a,l,c,h,u,d,f,p,g,m,y,_,x,w,v,b,C,A;const S=t-o,M=n-o,E=e-r,k=i-r;w=S*k,d=Bt*S,f=d-(d-S),p=S-f,d=Bt*k,g=d-(d-k),m=k-g,v=p*m-(w-f*g-p*g-f*m),b=E*M,d=Bt*E,f=d-(d-E),p=E-f,d=Bt*M,g=d-(d-M),m=M-g,C=p*m-(b-f*g-p*g-f*m),y=v-C,u=v-y,jt[0]=v-(y+u)+(u-C),_=w+y,u=_-w,x=w-(_-u)+(y-u),y=x-b,u=x-y,jt[1]=x-(y+u)+(u-b),A=_+y,u=A-_,jt[2]=_-(A-u)+(y-u),jt[3]=A;let T=function(t,e){let n=e[0];for(let i=1;i<t;i++)n+=e[i];return n}(4,jt),P=22204460492503146e-32*s;if(T>=P||-T>=P)return T;if(u=t-S,a=t-(S+u)+(u-o),u=n-M,c=n-(M+u)+(u-o),u=e-E,l=e-(E+u)+(u-r),u=i-k,h=i-(k+u)+(u-r),0===a&&0===l&&0===c&&0===h)return T;if(P=11093356479670487e-47*s+33306690738754706e-32*Math.abs(T),T+=S*h+k*a-(E*c+M*l),T>=P||-T>=P)return T;w=a*k,d=Bt*a,f=d-(d-a),p=a-f,d=Bt*k,g=d-(d-k),m=k-g,v=p*m-(w-f*g-p*g-f*m),b=l*M,d=Bt*l,f=d-(d-l),p=l-f,d=Bt*M,g=d-(d-M),m=M-g,C=p*m-(b-f*g-p*g-f*m),y=v-C,u=v-y,Ut[0]=v-(y+u)+(u-C),_=w+y,u=_-w,x=w-(_-u)+(y-u),y=x-b,u=x-y,Ut[1]=x-(y+u)+(u-b),A=_+y,u=A-_,Ut[2]=_-(A-u)+(y-u),Ut[3]=A;const F=qt(4,jt,4,Ut,Ht);w=S*h,d=Bt*S,f=d-(d-S),p=S-f,d=Bt*h,g=d-(d-h),m=h-g,v=p*m-(w-f*g-p*g-f*m),b=E*c,d=Bt*E,f=d-(d-E),p=E-f,d=Bt*c,g=d-(d-c),m=c-g,C=p*m-(b-f*g-p*g-f*m),y=v-C,u=v-y,Ut[0]=v-(y+u)+(u-C),_=w+y,u=_-w,x=w-(_-u)+(y-u),y=x-b,u=x-y,Ut[1]=x-(y+u)+(u-b),A=_+y,u=A-_,Ut[2]=_-(A-u)+(y-u),Ut[3]=A;const N=qt(F,Ht,4,Ut,$t);w=a*h,d=Bt*a,f=d-(d-a),p=a-f,d=Bt*h,g=d-(d-h),m=h-g,v=p*m-(w-f*g-p*g-f*m),b=l*c,d=Bt*l,f=d-(d-l),p=l-f,d=Bt*c,g=d-(d-c),m=c-g,C=p*m-(b-f*g-p*g-f*m),y=v-C,u=v-y,Ut[0]=v-(y+u)+(u-C),_=w+y,u=_-w,x=w-(_-u)+(y-u),y=x-b,u=x-y,Ut[1]=x-(y+u)+(u-b),A=_+y,u=A-_,Ut[2]=_-(A-u)+(y-u),Ut[3]=A;const D=qt(N,$t,4,Ut,Wt);return Wt[D-1]}(t,e,n,i,o,r,c)}const Xt=Math.pow(2,-52),Yt=new Uint32Array(512);class Jt{static from(t,e=ne,n=ie){const i=t.length,o=new Float64Array(2*i);for(let r=0;r<i;r++){const i=t[r];o[2*r]=e(i),o[2*r+1]=n(i)}return new Jt(o)}constructor(t){const e=t.length>>1;if(e>0&&"number"!=typeof t[0])throw new Error("Expected coords to contain numbers.");this.coords=t;const n=Math.max(2*e-5,0);this._triangles=new Uint32Array(3*n),this._halfedges=new Int32Array(3*n),this._hashSize=Math.ceil(Math.sqrt(e)),this._hullPrev=new Uint32Array(e),this._hullNext=new Uint32Array(e),this._hullTri=new Uint32Array(e),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(e),this._dists=new Float64Array(e),this.update()}update(){const{coords:t,_hullPrev:e,_hullNext:n,_hullTri:i,_hullHash:o}=this,r=t.length>>1;let s=1/0,a=1/0,l=-1/0,c=-1/0;for(let e=0;e<r;e++){const n=t[2*e],i=t[2*e+1];n<s&&(s=n),i<a&&(a=i),n>l&&(l=n),i>c&&(c=i),this._ids[e]=e}const h=(s+l)/2,u=(a+c)/2;let d,f,p,g=1/0;for(let e=0;e<r;e++){const n=Kt(h,u,t[2*e],t[2*e+1]);n<g&&(d=e,g=n)}const m=t[2*d],y=t[2*d+1];g=1/0;for(let e=0;e<r;e++){if(e===d)continue;const n=Kt(m,y,t[2*e],t[2*e+1]);n<g&&n>0&&(f=e,g=n)}let _=t[2*f],x=t[2*f+1],w=1/0;for(let e=0;e<r;e++){if(e===d||e===f)continue;const n=Qt(m,y,_,x,t[2*e],t[2*e+1]);n<w&&(p=e,w=n)}let v=t[2*p],b=t[2*p+1];if(w===1/0){for(let e=0;e<r;e++)this._dists[e]=t[2*e]-t[0]||t[2*e+1]-t[1];te(this._ids,this._dists,0,r-1);const e=new Uint32Array(r);let n=0;for(let t=0,i=-1/0;t<r;t++){const o=this._ids[t];this._dists[o]>i&&(e[n++]=o,i=this._dists[o])}return this.hull=e.subarray(0,n),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(zt(m,y,_,x,v,b)<0){const t=f,e=_,n=x;f=p,_=v,x=b,p=t,v=e,b=n}const C=function(t,e,n,i,o,r){const s=n-t,a=i-e,l=o-t,c=r-e,h=s*s+a*a,u=l*l+c*c,d=.5/(s*c-a*l);return{x:t+(c*h-a*u)*d,y:e+(s*u-l*h)*d}}(m,y,_,x,v,b);this._cx=C.x,this._cy=C.y;for(let e=0;e<r;e++)this._dists[e]=Kt(t[2*e],t[2*e+1],C.x,C.y);te(this._ids,this._dists,0,r-1),this._hullStart=d;let A=3;n[d]=e[p]=f,n[f]=e[d]=p,n[p]=e[f]=d,i[d]=0,i[f]=1,i[p]=2,o.fill(-1),o[this._hashKey(m,y)]=d,o[this._hashKey(_,x)]=f,o[this._hashKey(v,b)]=p,this.trianglesLen=0,this._addTriangle(d,f,p,-1,-1,-1);for(let r,s,a=0;a<this._ids.length;a++){const l=this._ids[a],c=t[2*l],h=t[2*l+1];if(a>0&&Math.abs(c-r)<=Xt&&Math.abs(h-s)<=Xt)continue;if(r=c,s=h,l===d||l===f||l===p)continue;let u=0;for(let t=0,e=this._hashKey(c,h);t<this._hashSize&&(u=o[(e+t)%this._hashSize],-1===u||u===n[u]);t++);u=e[u];let g,m=u;for(;g=n[m],zt(c,h,t[2*m],t[2*m+1],t[2*g],t[2*g+1])>=0;)if(m=g,m===u){m=-1;break}if(-1===m)continue;let y=this._addTriangle(m,l,n[m],-1,-1,i[m]);i[l]=this._legalize(y+2),i[m]=y,A++;let _=n[m];for(;g=n[_],zt(c,h,t[2*_],t[2*_+1],t[2*g],t[2*g+1])<0;)y=this._addTriangle(_,l,g,i[l],-1,i[_]),i[l]=this._legalize(y+2),n[_]=_,A--,_=g;if(m===u)for(;g=e[m],zt(c,h,t[2*g],t[2*g+1],t[2*m],t[2*m+1])<0;)y=this._addTriangle(g,l,m,-1,i[m],i[g]),this._legalize(y+2),i[g]=y,n[m]=m,A--,m=g;this._hullStart=e[l]=m,n[m]=e[_]=l,n[l]=_,o[this._hashKey(c,h)]=l,o[this._hashKey(t[2*m],t[2*m+1])]=m}this.hull=new Uint32Array(A);for(let t=0,e=this._hullStart;t<A;t++)this.hull[t]=e,e=n[e];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,e){return Math.floor(function(t,e){const n=t/(Math.abs(t)+Math.abs(e));return(e>0?3-n:1+n)/4}(t-this._cx,e-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:e,_halfedges:n,coords:i}=this;let o=0,r=0;for(;;){const s=n[t],a=t-t%3;if(r=a+(t+2)%3,-1===s){if(0===o)break;t=Yt[--o];continue}const l=s-s%3,c=a+(t+1)%3,h=l+(s+2)%3,u=e[r],d=e[t],f=e[c],p=e[h];if(Zt(i[2*u],i[2*u+1],i[2*d],i[2*d+1],i[2*f],i[2*f+1],i[2*p],i[2*p+1])){e[t]=p,e[s]=u;const i=n[h];if(-1===i){let e=this._hullStart;do{if(this._hullTri[e]===h){this._hullTri[e]=t;break}e=this._hullPrev[e]}while(e!==this._hullStart)}this._link(t,i),this._link(s,n[r]),this._link(r,h);const a=l+(s+1)%3;o<Yt.length&&(Yt[o++]=a)}else{if(0===o)break;t=Yt[--o]}}return r}_link(t,e){this._halfedges[t]=e,-1!==e&&(this._halfedges[e]=t)}_addTriangle(t,e,n,i,o,r){const s=this.trianglesLen;return this._triangles[s]=t,this._triangles[s+1]=e,this._triangles[s+2]=n,this._link(s,i),this._link(s+1,o),this._link(s+2,r),this.trianglesLen+=3,s}}function Kt(t,e,n,i){const o=t-n,r=e-i;return o*o+r*r}function Zt(t,e,n,i,o,r,s,a){const l=t-s,c=e-a,h=n-s,u=i-a,d=o-s,f=r-a,p=h*h+u*u,g=d*d+f*f;return l*(u*g-p*f)-c*(h*g-p*d)+(l*l+c*c)*(h*f-u*d)<0}function Qt(t,e,n,i,o,r){const s=n-t,a=i-e,l=o-t,c=r-e,h=s*s+a*a,u=l*l+c*c,d=.5/(s*c-a*l),f=(c*h-a*u)*d,p=(s*u-l*h)*d;return f*f+p*p}function te(t,e,n,i){if(i-n<=20)for(let o=n+1;o<=i;o++){const i=t[o],r=e[i];let s=o-1;for(;s>=n&&e[t[s]]>r;)t[s+1]=t[s--];t[s+1]=i}else{let o=n+1,r=i;ee(t,n+i>>1,o),e[t[n]]>e[t[i]]&&ee(t,n,i),e[t[o]]>e[t[i]]&&ee(t,o,i),e[t[n]]>e[t[o]]&&ee(t,n,o);const s=t[o],a=e[s];for(;;){do{o++}while(e[t[o]]<a);do{r--}while(e[t[r]]>a);if(r<o)break;ee(t,o,r)}t[n+1]=t[r],t[r]=s,i-o+1>=r-n?(te(t,e,o,i),te(t,e,n,r-1)):(te(t,e,n,r-1),te(t,e,o,i))}}function ee(t,e,n){const i=t[e];t[e]=t[n],t[n]=i}function ne(t){return t[0]}function ie(t){return t[1]}const oe=1e-6;class re{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,e){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,e){this._+=`L${this._x1=+t},${this._y1=+e}`}arc(t,e,n){const i=(t=+t)+(n=+n),o=e=+e;if(n<0)throw new Error("negative radius");null===this._x1?this._+=`M${i},${o}`:(Math.abs(this._x1-i)>oe||Math.abs(this._y1-o)>oe)&&(this._+="L"+i+","+o),n&&(this._+=`A${n},${n},0,1,1,${t-n},${e}A${n},${n},0,1,1,${this._x1=i},${this._y1=o}`)}rect(t,e,n,i){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}h${+n}v${+i}h${-n}Z`}value(){return this._||null}}class se{constructor(){this._=[]}moveTo(t,e){this._.push([t,e])}closePath(){this._.push(this._[0].slice())}lineTo(t,e){this._.push([t,e])}value(){return this._.length?this._:null}}class ae{constructor(t,[e,n,i,o]=[0,0,960,500]){if(!((i=+i)>=(e=+e)&&(o=+o)>=(n=+n)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(2*t.points.length),this.vectors=new Float64Array(2*t.points.length),this.xmax=i,this.xmin=e,this.ymax=o,this.ymin=n,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:e,triangles:n},vectors:i}=this,o=this.circumcenters=this._circumcenters.subarray(0,n.length/3*2);for(let e,i,r=0,s=0,a=n.length;r<a;r+=3,s+=2){const a=2*n[r],l=2*n[r+1],c=2*n[r+2],h=t[a],u=t[a+1],d=t[l],f=t[l+1],p=t[c],g=t[c+1],m=d-h,y=f-u,_=p-h,x=g-u,w=2*(m*x-y*_);if(Math.abs(w)<1e-9){let o=1e9;const r=2*n[0];o*=Math.sign((t[r]-h)*x-(t[r+1]-u)*_),e=(h+p)/2-o*x,i=(u+g)/2+o*_}else{const t=1/w,n=m*m+y*y,o=_*_+x*x;e=h+(x*n-y*o)*t,i=u+(m*o-_*n)*t}o[s]=e,o[s+1]=i}let r,s,a,l=e[e.length-1],c=4*l,h=t[2*l],u=t[2*l+1];i.fill(0);for(let n=0;n<e.length;++n)l=e[n],r=c,s=h,a=u,c=4*l,h=t[2*l],u=t[2*l+1],i[r+2]=i[c]=a-u,i[r+3]=i[c+1]=h-s}render(t){const e=null==t?t=new re:void 0,{delaunay:{halfedges:n,inedges:i,hull:o},circumcenters:r,vectors:s}=this;if(o.length<=1)return null;for(let e=0,i=n.length;e<i;++e){const i=n[e];if(i<e)continue;const o=2*Math.floor(e/3),s=2*Math.floor(i/3),a=r[o],l=r[o+1],c=r[s],h=r[s+1];this._renderSegment(a,l,c,h,t)}let a,l=o[o.length-1];for(let e=0;e<o.length;++e){a=l,l=o[e];const n=2*Math.floor(i[l]/3),c=r[n],h=r[n+1],u=4*a,d=this._project(c,h,s[u+2],s[u+3]);d&&this._renderSegment(c,h,d[0],d[1],t)}return e&&e.value()}renderBounds(t){const e=null==t?t=new re:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),e&&e.value()}renderCell(t,e){const n=null==e?e=new re:void 0,i=this._clip(t);if(null===i||!i.length)return;e.moveTo(i[0],i[1]);let o=i.length;for(;i[0]===i[o-2]&&i[1]===i[o-1]&&o>1;)o-=2;for(let t=2;t<o;t+=2)i[t]===i[t-2]&&i[t+1]===i[t-1]||e.lineTo(i[t],i[t+1]);return e.closePath(),n&&n.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let e=0,n=t.length/2;e<n;++e){const t=this.cellPolygon(e);t&&(t.index=e,yield t)}}cellPolygon(t){const e=new se;return this.renderCell(t,e),e.value()}_renderSegment(t,e,n,i,o){let r;const s=this._regioncode(t,e),a=this._regioncode(n,i);0===s&&0===a?(o.moveTo(t,e),o.lineTo(n,i)):(r=this._clipSegment(t,e,n,i,s,a))&&(o.moveTo(r[0],r[1]),o.lineTo(r[2],r[3]))}contains(t,e,n){return(e=+e)==e&&(n=+n)==n&&this.delaunay._step(t,e,n)===t}*neighbors(t){const e=this._clip(t);if(e)for(const n of this.delaunay.neighbors(t)){const t=this._clip(n);if(t)t:for(let i=0,o=e.length;i<o;i+=2)for(let r=0,s=t.length;r<s;r+=2)if(e[i]==t[r]&&e[i+1]==t[r+1]&&e[(i+2)%o]==t[(r+s-2)%s]&&e[(i+3)%o]==t[(r+s-1)%s]){yield n;break t}}}_cell(t){const{circumcenters:e,delaunay:{inedges:n,halfedges:i,triangles:o}}=this,r=n[t];if(-1===r)return null;const s=[];let a=r;do{const n=Math.floor(a/3);if(s.push(e[2*n],e[2*n+1]),a=a%3==2?a-2:a+1,o[a]!==t)break;a=i[a]}while(a!==r&&-1!==a);return s}_clip(t){if(0===t&&1===this.delaunay.hull.length)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const e=this._cell(t);if(null===e)return null;const{vectors:n}=this,i=4*t;return n[i]||n[i+1]?this._clipInfinite(t,e,n[i],n[i+1],n[i+2],n[i+3]):this._clipFinite(t,e)}_clipFinite(t,e){const n=e.length;let i,o,r,s,a=null,l=e[n-2],c=e[n-1],h=this._regioncode(l,c),u=0;for(let d=0;d<n;d+=2)if(i=l,o=c,l=e[d],c=e[d+1],r=h,h=this._regioncode(l,c),0===r&&0===h)s=u,u=0,a?a.push(l,c):a=[l,c];else{let e,n,d,f,p;if(0===r){if(null===(e=this._clipSegment(i,o,l,c,r,h)))continue;[n,d,f,p]=e}else{if(null===(e=this._clipSegment(l,c,i,o,h,r)))continue;[f,p,n,d]=e,s=u,u=this._edgecode(n,d),s&&u&&this._edge(t,s,u,a,a.length),a?a.push(n,d):a=[n,d]}s=u,u=this._edgecode(f,p),s&&u&&this._edge(t,s,u,a,a.length),a?a.push(f,p):a=[f,p]}if(a)s=u,u=this._edgecode(a[0],a[1]),s&&u&&this._edge(t,s,u,a,a.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return a}_clipSegment(t,e,n,i,o,r){for(;;){if(0===o&&0===r)return[t,e,n,i];if(o&r)return null;let s,a,l=o||r;8&l?(s=t+(n-t)*(this.ymax-e)/(i-e),a=this.ymax):4&l?(s=t+(n-t)*(this.ymin-e)/(i-e),a=this.ymin):2&l?(a=e+(i-e)*(this.xmax-t)/(n-t),s=this.xmax):(a=e+(i-e)*(this.xmin-t)/(n-t),s=this.xmin),o?(t=s,e=a,o=this._regioncode(t,e)):(n=s,i=a,r=this._regioncode(n,i))}}_clipInfinite(t,e,n,i,o,r){let s,a=Array.from(e);if((s=this._project(a[0],a[1],n,i))&&a.unshift(s[0],s[1]),(s=this._project(a[a.length-2],a[a.length-1],o,r))&&a.push(s[0],s[1]),a=this._clipFinite(t,a))for(let e,n=0,i=a.length,o=this._edgecode(a[i-2],a[i-1]);n<i;n+=2)e=o,o=this._edgecode(a[n],a[n+1]),e&&o&&(n=this._edge(t,e,o,a,n),i=a.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(a=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return a}_edge(t,e,n,i,o){for(;e!==n;){let n,r;switch(e){case 5:e=4;continue;case 4:e=6,n=this.xmax,r=this.ymin;break;case 6:e=2;continue;case 2:e=10,n=this.xmax,r=this.ymax;break;case 10:e=8;continue;case 8:e=9,n=this.xmin,r=this.ymax;break;case 9:e=1;continue;case 1:e=5,n=this.xmin,r=this.ymin}i[o]===n&&i[o+1]===r||!this.contains(t,n,r)||(i.splice(o,0,n,r),o+=2)}if(i.length>4)for(let t=0;t<i.length;t+=2){const e=(t+2)%i.length,n=(t+4)%i.length;(i[t]===i[e]&&i[e]===i[n]||i[t+1]===i[e+1]&&i[e+1]===i[n+1])&&(i.splice(e,2),t-=2)}return o}_project(t,e,n,i){let o,r,s,a=1/0;if(i<0){if(e<=this.ymin)return null;(o=(this.ymin-e)/i)<a&&(s=this.ymin,r=t+(a=o)*n)}else if(i>0){if(e>=this.ymax)return null;(o=(this.ymax-e)/i)<a&&(s=this.ymax,r=t+(a=o)*n)}if(n>0){if(t>=this.xmax)return null;(o=(this.xmax-t)/n)<a&&(r=this.xmax,s=e+(a=o)*i)}else if(n<0){if(t<=this.xmin)return null;(o=(this.xmin-t)/n)<a&&(r=this.xmin,s=e+(a=o)*i)}return[r,s]}_edgecode(t,e){return(t===this.xmin?1:t===this.xmax?2:0)|(e===this.ymin?4:e===this.ymax?8:0)}_regioncode(t,e){return(t<this.xmin?1:t>this.xmax?2:0)|(e<this.ymin?4:e>this.ymax?8:0)}}const le=2*Math.PI,ce=Math.pow;function he(t){return t[0]}function ue(t){return t[1]}function de(t,e,n){return[t+Math.sin(t+e)*n,e+Math.cos(t-e)*n]}class fe{static from(t,e=he,n=ue,i){return new fe("length"in t?function(t,e,n,i){const o=t.length,r=new Float64Array(2*o);for(let s=0;s<o;++s){const o=t[s];r[2*s]=e.call(i,o,s,t),r[2*s+1]=n.call(i,o,s,t)}return r}(t,e,n,i):Float64Array.from(function*(t,e,n,i){let o=0;for(const r of t)yield e.call(i,r,o,t),yield n.call(i,r,o,t),++o}(t,e,n,i)))}constructor(t){this._delaunator=new Jt(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,e=this.points;if(t.hull&&t.hull.length>2&&function(t){const{triangles:e,coords:n}=t;for(let t=0;t<e.length;t+=3){const i=2*e[t],o=2*e[t+1],r=2*e[t+2];if((n[r]-n[i])*(n[o+1]-n[i+1])-(n[o]-n[i])*(n[r+1]-n[i+1])>1e-10)return!1}return!0}(t)){this.collinear=Int32Array.from({length:e.length/2},((t,e)=>e)).sort(((t,n)=>e[2*t]-e[2*n]||e[2*t+1]-e[2*n+1]));const t=this.collinear[0],n=this.collinear[this.collinear.length-1],i=[e[2*t],e[2*t+1],e[2*n],e[2*n+1]],o=1e-8*Math.hypot(i[3]-i[1],i[2]-i[0]);for(let t=0,n=e.length/2;t<n;++t){const n=de(e[2*t],e[2*t+1],o);e[2*t]=n[0],e[2*t+1]=n[1]}this._delaunator=new Jt(e)}else delete this.collinear;const n=this.halfedges=this._delaunator.halfedges,i=this.hull=this._delaunator.hull,o=this.triangles=this._delaunator.triangles,r=this.inedges.fill(-1),s=this._hullIndex.fill(-1);for(let t=0,e=n.length;t<e;++t){const e=o[t%3==2?t-2:t+1];-1!==n[t]&&-1!==r[e]||(r[e]=t)}for(let t=0,e=i.length;t<e;++t)s[i[t]]=t;i.length<=2&&i.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=i[0],r[i[0]]=1,2===i.length&&(r[i[1]]=0,this.triangles[1]=i[1],this.triangles[2]=i[1]))}voronoi(t){return new ae(this,t)}*neighbors(t){const{inedges:e,hull:n,_hullIndex:i,halfedges:o,triangles:r,collinear:s}=this;if(s){const e=s.indexOf(t);return e>0&&(yield s[e-1]),void(e<s.length-1&&(yield s[e+1]))}const a=e[t];if(-1===a)return;let l=a,c=-1;do{if(yield c=r[l],l=l%3==2?l-2:l+1,r[l]!==t)return;if(l=o[l],-1===l){const e=n[(i[t]+1)%n.length];return void(e!==c&&(yield e))}}while(l!==a)}find(t,e,n=0){if((t=+t)!=t||(e=+e)!=e)return-1;const i=n;let o;for(;(o=this._step(n,t,e))>=0&&o!==n&&o!==i;)n=o;return o}_step(t,e,n){const{inedges:i,hull:o,_hullIndex:r,halfedges:s,triangles:a,points:l}=this;if(-1===i[t]||!l.length)return(t+1)%(l.length>>1);let c=t,h=ce(e-l[2*t],2)+ce(n-l[2*t+1],2);const u=i[t];let d=u;do{let i=a[d];const u=ce(e-l[2*i],2)+ce(n-l[2*i+1],2);if(u<h&&(h=u,c=i),d=d%3==2?d-2:d+1,a[d]!==t)break;if(d=s[d],-1===d){if(d=o[(r[t]+1)%o.length],d!==i&&ce(e-l[2*d],2)+ce(n-l[2*d+1],2)<h)return d;break}}while(d!==u);return c}render(t){const e=null==t?t=new re:void 0,{points:n,halfedges:i,triangles:o}=this;for(let e=0,r=i.length;e<r;++e){const r=i[e];if(r<e)continue;const s=2*o[e],a=2*o[r];t.moveTo(n[s],n[s+1]),t.lineTo(n[a],n[a+1])}return this.renderHull(t),e&&e.value()}renderPoints(t,e){void 0!==e||t&&"function"==typeof t.moveTo||(e=t,t=null),e=null==e?2:+e;const n=null==t?t=new re:void 0,{points:i}=this;for(let n=0,o=i.length;n<o;n+=2){const o=i[n],r=i[n+1];t.moveTo(o+e,r),t.arc(o,r,e,0,le)}return n&&n.value()}renderHull(t){const e=null==t?t=new re:void 0,{hull:n,points:i}=this,o=2*n[0],r=n.length;t.moveTo(i[o],i[o+1]);for(let e=1;e<r;++e){const o=2*n[e];t.lineTo(i[o],i[o+1])}return t.closePath(),e&&e.value()}hullPolygon(){const t=new se;return this.renderHull(t),t.value()}renderTriangle(t,e){const n=null==e?e=new re:void 0,{points:i,triangles:o}=this,r=2*o[t*=3],s=2*o[t+1],a=2*o[t+2];return e.moveTo(i[r],i[r+1]),e.lineTo(i[s],i[s+1]),e.lineTo(i[a],i[a+1]),e.closePath(),n&&n.value()}*trianglePolygons(){const{triangles:t}=this;for(let e=0,n=t.length/3;e<n;++e)yield this.trianglePolygon(e)}trianglePolygon(t){const e=new se;return this.renderTriangle(t,e),e.value()}}function pe(t,e,n,i){let o,r,s=function(t,e,n){return Array(n).fill().map((()=>[Math.random()*t,Math.random()*e]))}(t,e,n),a=!1;const l=i*Math.min(t,e);for(let n=0;n<1e3;n++)if([s,a,o,r]=ge(s,t,e,l),a)return s;return[s,o,r]}function ge(t,e,n,i){const o=fe.from(t).voronoi([0,0,e,n]),r=(s=t.length,[...Array(s).keys()]).map((t=>o.cellPolygon(t)));var s;const a=r.map(Ot),l=t.every(((t,e)=>{return n=t,o=a[e],n**2+o**2<i;var n,o}));return[a,l,o,r]}function me(t,e){const n=xe(e),i=t.length-xe(t),o=e.slice();for(let e,r,s,a=0,l=t[i-1];a<i;++a){const i=o.slice(),c=i.length-n;o.length=0,e=t[a],r=i[c-1];for(let t=0;t<c;++t)s=i[t],ye(s,l,e)?(ye(r,l,e)||o.push(_e(r,s,l,e)),o.push(s)):ye(r,l,e)&&o.push(_e(r,s,l,e)),r=s;n&&o.push(o[0]),l=e}return o.length?o:null}function ye([t,e],[n,i],[o,r]){return(o-n)*(e-i)<(r-i)*(t-n)}function _e([t,e],[n,i],[o,r],[s,a]){const l=n-t,c=i-e,h=s-o,u=a-r,d=(l*(r-e)-c*(o-t))/(c*h-l*u);return[o+d*h,r+d*u]}function xe(t){const[e,n]=t[0],[i,o]=t[t.length-1];return e===i&&n===o}function we(t,e){return[[t,e],[t,e+1],[t+1,e+1],[t+1,e]]}function ve(t){const e=this;function n(n){const{mctx:i}=t,o=e.centroids[n];ct(e.polygonAreas[n].toFixed(0),o[0],o[1]+.5-.2,1,.2,"#222",1,i)}e.make=(t,n,i)=>{[e.centroids,e.voronoi,e.polygons]=pe(t,n,i,.01),e.nx=t,e.ny=n,e.nd=i,e.polygonAreas=e.polygons.map(Vt).map((t=>-t)),e.totalArea=t*n,e.census=function(t){const{nd:e,nx:n,ny:i,polygons:o}=t,r=Array(e).fill().map((()=>[]));for(let t=0;t<n;t++)for(let n=0;n<i;n++){const i=we(t,n);ut(e).forEach((e=>{const s=me(dt(o[e]).reverse(),i);null!==s&&r[e].push([t,n,Vt(s)])}))}return r}(e)},e.renderVoronoi=(t,i)=>{e.renderVoronoiGeneral(0,0,t,i,null,n)},e.renderVoronoiColors=(t,n,i,o,r)=>{e.renderVoronoiGeneral(t,n,i,o,r,void 0)},e.renderVoronoiGeneral=(n,i,o,r,s,a)=>{const{mctx:l}=t,{voronoi:c,nx:h,ny:u,nd:d}=e;l.save();const f=o/h,p=r/u;l.translate(n,i),l.scale(f,p);for(let t=0;t<d;t++)l.beginPath(),l.strokeStyle="#333",l.lineWidth=1/f,c.renderCell(t,l),null!==s&&(l.fillStyle=s[t],l.fill()),l.stroke(),void 0!==a&&a(t);l.restore()}}function be(t,e,n){const i=this;lt.call(i,e),i.nd=20,i.nx=20,i.ny=20,i.districtMaker=new ve(t),i.geoNoise=new It(i.nx,i.ny),i.geoNoise.genNoise(),i.update=()=>{n.checkNone()||(n.check(["districts","geo","viz","dimensions"])&&i.updateDistricts(),i.updateVoters())};let o=[];i.updateDistricts=()=>{i.districtMaker.make(i.nx,i.ny,i.nd)},i.updateVoters=()=>{o=i.getVoterSims(),i.updateFullSet(),i.updateVotersByDistrict(),i.updateVotersByTract()},i.updateFullSet=()=>{const{sn:t}=i.geoNoise;i.allVoterGroups=o.map((e=>t.map((t=>t.map((t=>{const[n,i]=t,o=vt(e.voterShape.shape1),r=vt(e.voterShape.shape2);return o.x+=n,r.x+=n,r.y+=i,{shape2:r,shape1:o}})).flat())).flat())).flat()},i.updateVotersByDistrict=()=>{const{census:t}=i.districtMaker,{sn:e}=i.geoNoise;i.voterGroupsByDistrict=ut(i.nd).map((n=>o.map((i=>t[n].map((t=>{const[n,o,r]=t,[s,a]=e[n][o],l=vt(i.voterShape.shape1),c=vt(i.voterShape.shape2);return l.x+=s,c.x+=s,c.y+=a,{shape2:c,shape1:l,weight:r}})).flat())).flat()))},i.updateVotersByTract=()=>{const{sn:t}=i.geoNoise;i.voterGroupsByTract=t.map((t=>t.map((t=>o.map((e=>{const[n,i]=t,o=vt(e.voterShape.shape1),r=vt(e.voterShape.shape2);return o.x+=n,r.x+=n,r.y+=i,{shape2:r,shape1:o}})).flat()))))}}function Ce(t,e){const n=this;n.render=function(){const{ctx:n}=e,{x:i,shape1:o}=t,{w:r,densityProfile:s}=o,a=100;n.save(),n.beginPath(),"gaussian"===s?function(){const t=r/Math.sqrt(2*Math.PI),o=a,s=200;n.moveTo(0,s);const l=[];for(let r=0;r<=e.width;r+=1){const e=.5*((r-i)/t)**2,a=s-o*Math.exp(-e);l.push(a),n.lineTo(r,a)}n.lineTo(e.width,s),n.lineTo(0,s)}():n.rect(i-.5*r,100,r,a),n.stroke(),n.restore()},n.renderAt=()=>{n.render()}}function Ae(t,e){const n=this;n.render=function(){const{ctx:n}=e,{x:i,y:o,shape2:r}=t;n.beginPath(),n.arc(i,o,.5*r.w,0,2*Math.PI),n.stroke()},n.renderAt=function(n,i){const{ctx:o}=e,{w:r}=t.shape2;o.beginPath(),o.arc(n,i,.5*r,0,2*Math.PI),o.stroke()},n.renderCenterAt2=function(t,n){const{ctx:i}=e;i.beginPath(),i.fillStyle="#555",i.arc(t,n,1,0,2*Math.PI),i.fill()}}function Se(t,e,n,i,o){const{width:r}=n,s=Array(r).fill(0);let a=0;const{dimensions:l}=o.election,c=1===l?Ce:Ae;t.setRenderer((t=>new c(t,n))),e.setRenderer((t=>new c(t,n))),this.update=function(t){!1===i.checkNone()&&(s.fill(0),a=0);const{pointsChanged:e,newPoints:n}=t;e&&function(t){const e=t.length;for(let n=0;n<e;n++){const{x:e}=t[n];for(let t=0;t<r;t++)s[t]+=u(t-e);a+=h}}(n)};const h=4/3;function u(t){return t>20||t<-20?0:(1-(t/20)**2)/20}this.render=()=>{!function(){const{ctx:t}=n;t.save(),t.beginPath(),function(t){const e=1/a,i=1e4,o=200;t.moveTo(0,o);const l=[];for(let n=0;n<=r;n+=1){const r=o-i*s[n]*e;l.push(r),t.lineTo(n,r)}t.lineTo(n.width,o),t.lineTo(0,o)}(t),t.strokeStyle="#ccc",t.stroke(),t.fillStyle="#ccc",t.fill(),t.restore()}(),t.render(),e.render()}}function Me(t,e,n){t=+t,e=+e,n=(o=arguments.length)<2?(e=t,t=0,1):o<3?1:+n;for(var i=-1,o=0|Math.max(0,Math.ceil((e-t)/n)),r=new Array(o);++i<o;)r[i]=t+i*n;return r}var Ee=Math.sqrt(50),ke=Math.sqrt(10),Te=Math.sqrt(2);function Pe(t,e,n){var i,o,r,s,a=-1;if(n=+n,(t=+t)===(e=+e)&&n>0)return[t];if((i=e<t)&&(o=t,t=e,e=o),0===(s=function(t,e,n){var i=(e-t)/Math.max(0,n),o=Math.floor(Math.log(i)/Math.LN10),r=i/Math.pow(10,o);return o>=0?(r>=Ee?10:r>=ke?5:r>=Te?2:1)*Math.pow(10,o):-Math.pow(10,-o)/(r>=Ee?10:r>=ke?5:r>=Te?2:1)}(t,e,n))||!isFinite(s))return[];if(s>0){let n=Math.round(t/s),i=Math.round(e/s);for(n*s<t&&++n,i*s>e&&--i,r=new Array(o=i-n+1);++a<o;)r[a]=(n+a)*s}else{s=-s;let n=Math.round(t*s),i=Math.round(e*s);for(n/s<t&&++n,i/s>e&&--i,r=new Array(o=i-n+1);++a<o;)r[a]=(n+a)/s}return i&&r.reverse(),r}function Fe(t,e,n){var i=Math.abs(e-t)/Math.max(0,n),o=Math.pow(10,Math.floor(Math.log(i)/Math.LN10)),r=i/o;return r>=Ee?o*=10:r>=ke?o*=5:r>=Te&&(o*=2),e<t?-o:o}function Ne(t){return Math.ceil(Math.log(function(t,e){let n=0;if(void 0===e)for(let e of t)null!=e&&(e=+e)>=e&&++n;else{let i=-1;for(let o of t)null!=(o=e(o,++i,t))&&(o=+o)>=o&&++n}return n}(t))/Math.LN2)+1}var De=Array.prototype.slice;function Le(t,e){return t-e}var Ie=t=>()=>t;function Re(t,e){for(var n,i=-1,o=e.length;++i<o;)if(n=Ve(t,e[i]))return n;return 0}function Ve(t,e){for(var n=e[0],i=e[1],o=-1,r=0,s=t.length,a=s-1;r<s;a=r++){var l=t[r],c=l[0],h=l[1],u=t[a],d=u[0],f=u[1];if(Oe(l,u,e))return 0;h>i!=f>i&&n<(d-c)*(i-h)/(f-h)+c&&(o=-o)}return o}function Oe(t,e,n){var i,o,r,s;return function(t,e,n){return(e[0]-t[0])*(n[1]-t[1])==(n[0]-t[0])*(e[1]-t[1])}(t,e,n)&&(o=t[i=+(t[0]===e[0])],r=n[i],s=e[i],o<=r&&r<=s||s<=r&&r<=o)}function Be(){}var qe=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function Ge(){var t=1,e=1,n=Ne,i=a;function o(t){var e=n(t);if(Array.isArray(e))e=e.slice().sort(Le);else{const n=function(t,e){let n,i;if(void 0===e)for(const e of t)null!=e&&(void 0===n?e>=e&&(n=i=e):(n>e&&(n=e),i<e&&(i=e)));else{let o=-1;for(let r of t)null!=(r=e(r,++o,t))&&(void 0===n?r>=r&&(n=i=r):(n>r&&(n=r),i<r&&(i=r)))}return[n,i]}(t),i=Fe(n[0],n[1],e);e=Pe(Math.floor(n[0]/i)*i,Math.floor(n[1]/i-1)*i,e)}return e.map((e=>r(t,e)))}function r(n,o){var r=[],a=[];return function(n,i,o){var r,a,l,c,h,u,d=new Array,f=new Array;r=a=-1,c=n[0]>=i,qe[c<<1].forEach(p);for(;++r<t-1;)l=c,c=n[r+1]>=i,qe[l|c<<1].forEach(p);qe[c<<0].forEach(p);for(;++a<e-1;){for(r=-1,c=n[a*t+t]>=i,h=n[a*t]>=i,qe[c<<1|h<<2].forEach(p);++r<t-1;)l=c,c=n[a*t+t+r+1]>=i,u=h,h=n[a*t+r+1]>=i,qe[l|c<<1|h<<2|u<<3].forEach(p);qe[c|h<<3].forEach(p)}r=-1,h=n[a*t]>=i,qe[h<<2].forEach(p);for(;++r<t-1;)u=h,h=n[a*t+r+1]>=i,qe[h<<2|u<<3].forEach(p);function p(t){var e,n,i=[t[0][0]+r,t[0][1]+a],l=[t[1][0]+r,t[1][1]+a],c=s(i),h=s(l);(e=f[c])?(n=d[h])?(delete f[e.end],delete d[n.start],e===n?(e.ring.push(l),o(e.ring)):d[e.start]=f[n.end]={start:e.start,end:n.end,ring:e.ring.concat(n.ring)}):(delete f[e.end],e.ring.push(l),f[e.end=h]=e):(e=d[h])?(n=f[c])?(delete d[e.start],delete f[n.end],e===n?(e.ring.push(l),o(e.ring)):d[n.start]=f[e.end]={start:n.start,end:e.end,ring:n.ring.concat(e.ring)}):(delete d[e.start],e.ring.unshift(i),d[e.start=c]=e):d[c]=f[h]={start:c,end:h,ring:[i,l]}}qe[h<<3].forEach(p)}(n,o,(function(t){i(t,n,o),function(t){for(var e=0,n=t.length,i=t[n-1][1]*t[0][0]-t[n-1][0]*t[0][1];++e<n;)i+=t[e-1][1]*t[e][0]-t[e-1][0]*t[e][1];return i}(t)>0?r.push([t]):a.push(t)})),a.forEach((function(t){for(var e,n=0,i=r.length;n<i;++n)if(-1!==Re((e=r[n])[0],t))return void e.push(t)})),{type:"MultiPolygon",value:o,coordinates:r}}function s(e){return 2*e[0]+e[1]*(t+1)*4}function a(n,i,o){n.forEach((function(n){var r,s=n[0],a=n[1],l=0|s,c=0|a,h=i[c*t+l];s>0&&s<t&&l===s&&(r=i[c*t+l-1],n[0]=s+(o-r)/(h-r)-.5),a>0&&a<e&&c===a&&(r=i[(c-1)*t+l],n[1]=a+(o-r)/(h-r)-.5)}))}return o.contour=r,o.size=function(n){if(!arguments.length)return[t,e];var i=Math.floor(n[0]),r=Math.floor(n[1]);if(!(i>=0&&r>=0))throw new Error("invalid size");return t=i,e=r,o},o.thresholds=function(t){return arguments.length?(n="function"==typeof t?t:Array.isArray(t)?Ie(De.call(t)):Ie(t),o):n},o.smooth=function(t){return arguments.length?(i=t?a:Be,o):i===a},o}function je(t,e,n){for(var i=t.width,o=t.height,r=1+(n<<1),s=0;s<o;++s)for(var a=0,l=0;a<i+n;++a)a<i&&(l+=t.data[a+s*i]),a>=n&&(a>=r&&(l-=t.data[a-r+s*i]),e.data[a-n+s*i]=l/Math.min(a+1,i-1+r-a,r))}function He(t,e,n){for(var i=t.width,o=t.height,r=1+(n<<1),s=0;s<i;++s)for(var a=0,l=0;a<o+n;++a)a<o&&(l+=t.data[s+a*i]),a>=n&&(a>=r&&(l-=t.data[s+(a-r)*i]),e.data[s+(a-n)*i]=l/Math.min(a+1,o-1+r-a,r))}function $e(t){return t[0]}function We(t){return t[1]}function Ue(){return 1}class ze{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const e=this._partials;let n=0;for(let i=0;i<this._n&&i<32;i++){const o=e[i],r=t+o,s=Math.abs(t)<Math.abs(o)?t-(r-o):o-(r-t);s&&(e[n++]=s),t=r}return e[n]=t,this._n=n+1,this}valueOf(){const t=this._partials;let e,n,i,o=this._n,r=0;if(o>0){for(r=t[--o];o>0&&(e=r,n=t[--o],r=e+n,i=n-(r-e),!i););o>0&&(i<0&&t[o-1]<0||i>0&&t[o-1]>0)&&(n=2*i,e=r+n,n==e-r&&(r=e))}return r}}function Xe(t){return Array.from(function*(t){for(const e of t)yield*e}(t))}var Ye=1e-6,Je=1e-12,Ke=Math.PI,Ze=Ke/2,Qe=Ke/4,tn=2*Ke,en=Ke/180,nn=Math.abs,on=Math.atan,rn=Math.atan2,sn=Math.cos,an=(Math.ceil,Math.exp),ln=(Math.hypot,Math.log),cn=(Math.pow,Math.sin),hn=Math.sign||function(t){return t>0?1:t<0?-1:0},un=Math.sqrt,dn=Math.tan;function fn(t){return t>1?0:t<-1?Ke:Math.acos(t)}function pn(t){return t>1?Ze:t<-1?-Ze:Math.asin(t)}function gn(){}function mn(t,e){t&&_n.hasOwnProperty(t.type)&&_n[t.type](t,e)}var yn={Feature:function(t,e){mn(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,i=-1,o=n.length;++i<o;)mn(n[i].geometry,e)}},_n={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,i=-1,o=n.length;++i<o;)t=n[i],e.point(t[0],t[1],t[2])},LineString:function(t,e){xn(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,i=-1,o=n.length;++i<o;)xn(n[i],e,0)},Polygon:function(t,e){wn(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,i=-1,o=n.length;++i<o;)wn(n[i],e)},GeometryCollection:function(t,e){for(var n=t.geometries,i=-1,o=n.length;++i<o;)mn(n[i],e)}};function xn(t,e,n){var i,o=-1,r=t.length-n;for(e.lineStart();++o<r;)i=t[o],e.point(i[0],i[1],i[2]);e.lineEnd()}function wn(t,e){var n=-1,i=t.length;for(e.polygonStart();++n<i;)xn(t[n],e,1);e.polygonEnd()}function vn(t,e){t&&yn.hasOwnProperty(t.type)?yn[t.type](t,e):mn(t,e)}new ze,new ze;function bn(t){var e=t[0],n=t[1],i=sn(n);return[i*sn(e),i*cn(e),cn(n)]}function Cn(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function An(t){var e=un(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}function Sn(t,e){return[nn(t)>Ke?t+Math.round(-t/tn)*tn:t,e]}function Mn(){var t,e=[];return{point:function(e,n,i){t.push([e,n,i])},lineStart:function(){e.push(t=[])},lineEnd:gn,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function En(t,e){return nn(t[0]-e[0])<Ye&&nn(t[1]-e[1])<Ye}function kn(t,e,n,i){this.x=t,this.z=e,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function Tn(t,e,n,i,o){var r,s,a=[],l=[];if(t.forEach((function(t){if(!((e=t.length-1)<=0)){var e,n,i=t[0],s=t[e];if(En(i,s)){if(!i[2]&&!s[2]){for(o.lineStart(),r=0;r<e;++r)o.point((i=t[r])[0],i[1]);return void o.lineEnd()}s[0]+=2e-6}a.push(n=new kn(i,t,null,!0)),l.push(n.o=new kn(i,null,n,!1)),a.push(n=new kn(s,t,null,!1)),l.push(n.o=new kn(s,null,n,!0))}})),a.length){for(l.sort(e),Pn(a),Pn(l),r=0,s=l.length;r<s;++r)l[r].e=n=!n;for(var c,h,u=a[0];;){for(var d=u,f=!0;d.v;)if((d=d.n)===u)return;c=d.z,o.lineStart();do{if(d.v=d.o.v=!0,d.e){if(f)for(r=0,s=c.length;r<s;++r)o.point((h=c[r])[0],h[1]);else i(d.x,d.n.x,1,o);d=d.n}else{if(f)for(c=d.p.z,r=c.length-1;r>=0;--r)o.point((h=c[r])[0],h[1]);else i(d.x,d.p.x,-1,o);d=d.p}c=(d=d.o).z,f=!f}while(!d.v);o.lineEnd()}}}function Pn(t){if(e=t.length){for(var e,n,i=0,o=t[0];++i<e;)o.n=n=t[i],n.p=o,o=n;o.n=n=t[0],n.p=o}}function Fn(t){return nn(t[0])<=Ke?t[0]:hn(t[0])*((nn(t[0])+Ke)%tn-Ke)}function Nn(t,e){var n=Fn(e),i=e[1],o=cn(i),r=[cn(n),-sn(n),0],s=0,a=0,l=new ze;1===o?i=Ze+Ye:-1===o&&(i=-Ze-Ye);for(var c=0,h=t.length;c<h;++c)if(d=(u=t[c]).length)for(var u,d,f=u[d-1],p=Fn(f),g=f[1]/2+Qe,m=cn(g),y=sn(g),_=0;_<d;++_,p=w,m=b,y=C,f=x){var x=u[_],w=Fn(x),v=x[1]/2+Qe,b=cn(v),C=sn(v),A=w-p,S=A>=0?1:-1,M=S*A,E=M>Ke,k=m*b;if(l.add(rn(k*S*cn(M),y*C+k*sn(M))),s+=E?A+S*tn:A,E^p>=n^w>=n){var T=Cn(bn(f),bn(x));An(T);var P=Cn(r,T);An(P);var F=(E^A>=0?-1:1)*pn(P[2]);(i>F||i===F&&(T[0]||T[1]))&&(a+=E^A>=0?1:-1)}}return(s<-1e-6||s<Ye&&l<-1e-12)^1&a}function Dn(t,e,n,i){return function(o){var r,s,a,l=e(o),c=Mn(),h=e(c),u=!1,d={point:f,lineStart:g,lineEnd:m,polygonStart:function(){d.point=y,d.lineStart=_,d.lineEnd=x,s=[],r=[]},polygonEnd:function(){d.point=f,d.lineStart=g,d.lineEnd=m,s=Xe(s);var t=Nn(r,i);s.length?(u||(o.polygonStart(),u=!0),Tn(s,In,t,n,o)):t&&(u||(o.polygonStart(),u=!0),o.lineStart(),n(null,null,1,o),o.lineEnd()),u&&(o.polygonEnd(),u=!1),s=r=null},sphere:function(){o.polygonStart(),o.lineStart(),n(null,null,1,o),o.lineEnd(),o.polygonEnd()}};function f(e,n){t(e,n)&&o.point(e,n)}function p(t,e){l.point(t,e)}function g(){d.point=p,l.lineStart()}function m(){d.point=f,l.lineEnd()}function y(t,e){a.push([t,e]),h.point(t,e)}function _(){h.lineStart(),a=[]}function x(){y(a[0][0],a[0][1]),h.lineEnd();var t,e,n,i,l=h.clean(),d=c.result(),f=d.length;if(a.pop(),r.push(a),a=null,f)if(1&l){if((e=(n=d[0]).length-1)>0){for(u||(o.polygonStart(),u=!0),o.lineStart(),t=0;t<e;++t)o.point((i=n[t])[0],i[1]);o.lineEnd()}}else f>1&&2&l&&d.push(d.pop().concat(d.shift())),s.push(d.filter(Ln))}return d}}function Ln(t){return t.length>1}function In(t,e){return((t=t.x)[0]<0?t[1]-Ze-Ye:Ze-t[1])-((e=e.x)[0]<0?e[1]-Ze-Ye:Ze-e[1])}Sn.invert=Sn;Dn((function(){return!0}),(function(t){var e,n=NaN,i=NaN,o=NaN;return{lineStart:function(){t.lineStart(),e=1},point:function(r,s){var a=r>0?Ke:-Ke,l=nn(r-n);nn(l-Ke)<Ye?(t.point(n,i=(i+s)/2>0?Ze:-Ze),t.point(o,i),t.lineEnd(),t.lineStart(),t.point(a,i),t.point(r,i),e=0):o!==a&&l>=Ke&&(nn(n-o)<Ye&&(n-=o*Ye),nn(r-a)<Ye&&(r-=a*Ye),i=function(t,e,n,i){var o,r,s=cn(t-n);return nn(s)>Ye?on((cn(e)*(r=sn(i))*cn(n)-cn(i)*(o=sn(e))*cn(t))/(o*r*s)):(e+i)/2}(n,i,r,s),t.point(o,i),t.lineEnd(),t.lineStart(),t.point(a,i),e=0),t.point(n=r,i=s),o=a},lineEnd:function(){t.lineEnd(),n=i=NaN},clean:function(){return 2-e}}}),(function(t,e,n,i){var o;if(null==t)o=n*Ze,i.point(-Ke,o),i.point(0,o),i.point(Ke,o),i.point(Ke,0),i.point(Ke,-o),i.point(0,-o),i.point(-Ke,-o),i.point(-Ke,0),i.point(-Ke,o);else if(nn(t[0]-e[0])>Ye){var r=t[0]<e[0]?Ke:-Ke;o=n*r/2,i.point(-r,o),i.point(0,o),i.point(r,o)}else i.point(e[0],e[1])}),[-Ke,-Ze]);var Rn,Vn,On,Bn,qn=t=>t,Gn=new ze,jn=new ze,Hn={point:gn,lineStart:gn,lineEnd:gn,polygonStart:function(){Hn.lineStart=$n,Hn.lineEnd=zn},polygonEnd:function(){Hn.lineStart=Hn.lineEnd=Hn.point=gn,Gn.add(nn(jn)),jn=new ze},result:function(){var t=Gn/2;return Gn=new ze,t}};function $n(){Hn.point=Wn}function Wn(t,e){Hn.point=Un,Rn=On=t,Vn=Bn=e}function Un(t,e){jn.add(Bn*t-On*e),On=t,Bn=e}function zn(){Un(Rn,Vn)}var Xn=1/0,Yn=Xn,Jn=-Xn,Kn=Jn,Zn={point:function(t,e){t<Xn&&(Xn=t);t>Jn&&(Jn=t);e<Yn&&(Yn=e);e>Kn&&(Kn=e)},lineStart:gn,lineEnd:gn,polygonStart:gn,polygonEnd:gn,result:function(){var t=[[Xn,Yn],[Jn,Kn]];return Jn=Kn=-(Yn=Xn=1/0),t}};var Qn,ti,ei,ni,ii=0,oi=0,ri=0,si=0,ai=0,li=0,ci=0,hi=0,ui=0,di={point:fi,lineStart:pi,lineEnd:yi,polygonStart:function(){di.lineStart=_i,di.lineEnd=xi},polygonEnd:function(){di.point=fi,di.lineStart=pi,di.lineEnd=yi},result:function(){var t=ui?[ci/ui,hi/ui]:li?[si/li,ai/li]:ri?[ii/ri,oi/ri]:[NaN,NaN];return ii=oi=ri=si=ai=li=ci=hi=ui=0,t}};function fi(t,e){ii+=t,oi+=e,++ri}function pi(){di.point=gi}function gi(t,e){di.point=mi,fi(ei=t,ni=e)}function mi(t,e){var n=t-ei,i=e-ni,o=un(n*n+i*i);si+=o*(ei+t)/2,ai+=o*(ni+e)/2,li+=o,fi(ei=t,ni=e)}function yi(){di.point=fi}function _i(){di.point=wi}function xi(){vi(Qn,ti)}function wi(t,e){di.point=vi,fi(Qn=ei=t,ti=ni=e)}function vi(t,e){var n=t-ei,i=e-ni,o=un(n*n+i*i);si+=o*(ei+t)/2,ai+=o*(ni+e)/2,li+=o,ci+=(o=ni*t-ei*e)*(ei+t),hi+=o*(ni+e),ui+=3*o,fi(ei=t,ni=e)}function bi(t){this._context=t}bi.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(t,e){switch(this._point){case 0:this._context.moveTo(t,e),this._point=1;break;case 1:this._context.lineTo(t,e);break;default:this._context.moveTo(t+this._radius,e),this._context.arc(t,e,this._radius,0,tn)}},result:gn};var Ci,Ai,Si,Mi,Ei,ki=new ze,Ti={point:gn,lineStart:function(){Ti.point=Pi},lineEnd:function(){Ci&&Fi(Ai,Si),Ti.point=gn},polygonStart:function(){Ci=!0},polygonEnd:function(){Ci=null},result:function(){var t=+ki;return ki=new ze,t}};function Pi(t,e){Ti.point=Fi,Ai=Mi=t,Si=Ei=e}function Fi(t,e){Mi-=t,Ei-=e,ki.add(un(Mi*Mi+Ei*Ei)),Mi=t,Ei=e}function Ni(){this._string=[]}function Di(t){return"m0,"+t+"a"+t+","+t+" 0 1,1 0,"+-2*t+"a"+t+","+t+" 0 1,1 0,"+2*t+"z"}function Li(t){return function(e){var n=new Ii;for(var i in t)n[i]=t[i];return n.stream=e,n}}function Ii(){}Ni.prototype={_radius:4.5,_circle:Di(4.5),pointRadius:function(t){return(t=+t)!==this._radius&&(this._radius=t,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(t,e){switch(this._point){case 0:this._string.push("M",t,",",e),this._point=1;break;case 1:this._string.push("L",t,",",e);break;default:null==this._circle&&(this._circle=Di(this._radius)),this._string.push("M",t,",",e,this._circle)}},result:function(){if(this._string.length){var t=this._string.join("");return this._string=[],t}return null}},Ii.prototype={constructor:Ii,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};sn(30*en);Li({point:function(t,e){this.stream.point(t*en,e*en)}});function Ri(t){return function(e,n){var i=sn(e),o=sn(n),r=t(i*o);return r===1/0?[2,0]:[r*o*cn(e),r*cn(n)]}}function Vi(t){return function(e,n){var i=un(e*e+n*n),o=t(i),r=cn(o),s=sn(o);return[rn(e*r,i*s),pn(i&&n*r/i)]}}var Oi=Ri((function(t){return un(2/(1+t))}));Oi.invert=Vi((function(t){return 2*pn(t/2)}));var Bi=Ri((function(t){return(t=fn(t))&&t/cn(t)}));function qi(t,e){return[t,ln(dn((Ze+e)/2))]}function Gi(t,e){return[t,e]}Bi.invert=Vi((function(t){return t})),qi.invert=function(t,e){return[t,2*on(an(e))-Ze]},Gi.invert=Gi;var ji=1.340264,Hi=-.081106,$i=893e-6,Wi=.003796,Ui=un(3)/2;function zi(t,e){var n=pn(Ui*cn(e)),i=n*n,o=i*i*i;return[t*sn(n)/(Ui*(ji+-.24331799999999998*i+o*(.0062510000000000005+.034164*i))),n*(ji+Hi*i+o*($i+Wi*i))]}function Xi(t,e){var n=sn(e),i=sn(t)*n;return[n*cn(t)/i,cn(e)/i]}function Yi(t,e){var n=e*e,i=n*n;return[t*(.8707-.131979*n+i*(i*(.003971*n-.001529*i)-.013791)),e*(1.007226+n*(.015085+i*(.028874*n-.044475-.005916*i)))]}function Ji(t,e){return[sn(e)*cn(t),cn(e)]}function Ki(t,e){var n=sn(e),i=1+sn(t)*n;return[n*cn(t)/i,cn(e)/i]}function Zi(t,e){return[ln(dn((Ze+e)/2)),-t]}function Qi(t,e,n,i,o){const r=this,{dimensions:s}=o.election,a=1===s?Ce:Ae;t.setRenderer((t=>new a(t,n))),e.setRenderer((t=>new a(t,n))),r.update=function(t){const{pointsChanged:e,points:n}=t;e&&r.updatePoints(n)},r.render=()=>{r.renderCans(),t.render(),e.render()};let l;r.updatePoints=function(t){const e=t.length/1e4,n=ut(20).map((t=>t*e)),i=function(){var t=$e,e=We,n=Ue,i=960,o=500,r=20,s=2,a=3*r,l=i+2*a>>s,c=o+2*a>>s,h=Ie(20);function u(i){var o=new Float32Array(l*c),u=new Float32Array(l*c),f=Math.pow(2,-s);i.forEach((function(i,r,s){var h=(t(i,r,s)+a)*f,u=(e(i,r,s)+a)*f,d=+n(i,r,s);if(h>=0&&h<l&&u>=0&&u<c){var p=Math.floor(h),g=Math.floor(u),m=h-p-.5,y=u-g-.5;o[p+g*l]+=(1-m)*(1-y)*d,o[p+1+g*l]+=m*(1-y)*d,o[p+1+(g+1)*l]+=m*y*d,o[p+(g+1)*l]+=(1-m)*y*d}})),je({width:l,height:c,data:o},{width:l,height:c,data:u},r>>s),He({width:l,height:c,data:u},{width:l,height:c,data:o},r>>s),je({width:l,height:c,data:o},{width:l,height:c,data:u},r>>s),He({width:l,height:c,data:u},{width:l,height:c,data:o},r>>s),je({width:l,height:c,data:o},{width:l,height:c,data:u},r>>s),He({width:l,height:c,data:u},{width:l,height:c,data:o},r>>s);var p=h(o);if(!Array.isArray(p)){var g=function(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n<e||void 0===n&&e>=e)&&(n=e);else{let i=-1;for(let o of t)null!=(o=e(o,++i,t))&&(n<o||void 0===n&&o>=o)&&(n=o)}return n}(o);p=Fe(0,g,p),(p=Me(0,Math.floor(g/p)*p,p)).shift()}return Ge().thresholds(p).size([l,c])(o).map(d)}function d(t){return t.value*=Math.pow(2,-2*s),t.coordinates.forEach(f),t}function f(t){t.forEach(p)}function p(t){t.forEach(g)}function g(t){t[0]=t[0]*Math.pow(2,s)-a,t[1]=t[1]*Math.pow(2,s)-a}function m(){return l=i+2*(a=3*r)>>s,c=o+2*a>>s,u}return u.x=function(e){return arguments.length?(t="function"==typeof e?e:Ie(+e),u):t},u.y=function(t){return arguments.length?(e="function"==typeof t?t:Ie(+t),u):e},u.weight=function(t){return arguments.length?(n="function"==typeof t?t:Ie(+t),u):n},u.size=function(t){if(!arguments.length)return[i,o];var e=+t[0],n=+t[1];if(!(e>=0&&n>=0))throw new Error("invalid size");return i=e,o=n,m()},u.cellSize=function(t){if(!arguments.length)return 1<<s;if(!((t=+t)>=1))throw new Error("invalid cell size");return s=Math.floor(Math.log(t)/Math.LN2),m()},u.thresholds=function(t){return arguments.length?(h="function"==typeof t?t:Array.isArray(t)?Ie(De.call(t)):Ie(t),u):h},u.bandwidth=function(t){if(!arguments.length)return Math.sqrt(r*(r+1));if(!((t=+t)>=0))throw new Error("invalid bandwidth");return r=Math.round((Math.sqrt(4*t*t+1)-1)/2),m()},u}().x((t=>t.x)).y((t=>t.y)).bandwidth(10).thresholds(n);l=i(t)},r.renderCans=()=>{const{ctx:t}=n,e=function(t,e){var n,i,o=4.5;function r(t){return t&&("function"==typeof o&&i.pointRadius(+o.apply(this,arguments)),vn(t,n(i))),i.result()}return r.area=function(t){return vn(t,n(Hn)),Hn.result()},r.measure=function(t){return vn(t,n(Ti)),Ti.result()},r.bounds=function(t){return vn(t,n(Zn)),Zn.result()},r.centroid=function(t){return vn(t,n(di)),di.result()},r.projection=function(e){return arguments.length?(n=null==e?(t=null,qn):(t=e).stream,r):t},r.context=function(t){return arguments.length?(i=null==t?(e=null,new Ni):new bi(e=t),"function"!=typeof o&&i.pointRadius(o),r):e},r.pointRadius=function(t){return arguments.length?(o="function"==typeof t?t:(i.pointRadius(+t),+t),r):o},r.projection(t).context(e)}().context(t);t.save(),t.lineWidth=.5,t.strokeStyle="#aaa";const i=l.length;for(let n=0;n<i;n++){const i=255-10*n;t.fillStyle=`rgba(${i},${i},${i}, 1)`,t.beginPath(),e(l[n]),t.fill()}t.restore()}}function to(t,e,n,i,o,r){const s=this;Ct.call(s,t,n,r);const a=new A(r,n),l=new lt(r),c=new be(t,r,n);let h,u,d;s.addSimCandidateDistribution=e=>{a.newCandidate(new at(e,s.dragm,t))},s.addSimVoterCircle=e=>{c.newVoterSim(new Mt(e,s.dragm,t)),l.newVoterSim(new Mt(e,s.dragm,t))},n.add(["districts"]);const f=s.enter;s.enter=()=>{f(),r.candidateDnAdd.canDnButton.show(),function(){h=r.geo?c:l,u=r.geo?o:i;const e=1===r.election.dimensions?Se:Qi;d=new e(h,a,t,n,r)}(),h.updateXY(),a.updateXY()},s.exit=()=>{r.candidateDnAdd.canDnButton.hide()},s.update=()=>{h.update(),a.update();const{dimensions:e}=r.election,i=u.update(h,a,n,e);d.update(i),n.clear();const{pointsChanged:o}=i;o&&(t.clear(),s.render())},s.render=()=>{d.render()},s.renderForeground=()=>{h.renderForeground(),a.renderForeground()}}function eo(){const t=this,e=[];let n=0;t.new=function(t){e.push(t);const i=n;return n+=1,i},t.num=()=>n,t.get=t=>e[t]}function no(t,e){const n=n=>{if(!t.contains(n.target)&&((o=t)&&(o.offsetWidth||o.offsetHeight||o.getClientRects().length))){e()&&i()}var o},i=()=>{document.removeEventListener("mousedown",n),document.removeEventListener("touchstart",n)};document.addEventListener("mousedown",n),document.addEventListener("touchstart",n)}function io(t,e){const n=document.createElement("div");function i(){t.x>.5*e.width?(n.style.right=e.width-t.x+"px",n.style.left="unset"):(n.style.left=`${t.x}px`,n.style.right="unset"),n.style.top=`${t.y}px`}n.className="tooltipBox",n.style.position="absolute",i(),n.style.border="1px solid black",n.style.padding="8px",n.style.background="white";let o=!1;return no(n,(()=>!o&&(n.remove(),!0))),{box:n,update:i,setPin:t=>{o=t}}}function oo(t,e,n){const i=io(t,e),{box:o}=i;o.innerText="- Properties -";const r={};r.exists=new ro("checkbox","Exists","Exists: ",(e=>t.setE(e?1:0)),1===t.exists),o.appendChild(r.exists.div),1===n.election.dimensions?(t.shape1.w&&(r.w1=new ro("range","Width","Width: ",(e=>t.setW1(e)),t.shape1.w),o.appendChild(r.w1.div)),t.shape1.densityProfile&&(r.densityProfile1=new ro("select","Density Profile","Density Profile: ",(e=>t.setDensityProfile1(e)),t.shape1.densityProfile,["step","gaussian"]),o.appendChild(r.densityProfile1.div))):t.shape2.w&&(r.w2=new ro("range","Width","Width: ",(e=>t.setW2(e)),t.shape2.w),o.appendChild(r.w2.div)),void 0!==t.setColor&&(r.color=new ro("color","Color","Color: ",(e=>t.setColor(e)),t.color),o.appendChild(r.color.div)),r.showGhosts=new ro("checkbox","Show Ghosts","Show Ghosts: ",(t=>n.setShowNonExistingEntities(t)),n.showGhosts),o.appendChild(r.showGhosts.div),e.tooltips.appendChild(o)}function ro(t,e,n,i,o,r){const s=this;if(s.div=document.createElement("div"),"select"===t){s.input=document.createElement("select");for(let t=0;t<r.length;t++){const e=document.createElement("option");e.value=r[t],e.innerText=r[t],s.input.appendChild(e)}s.input.value=o,s.input.addEventListener("input",(()=>i(s.input.value)))}else s.input=document.createElement("input"),s.input.type=t,s.input.id=e,s.input.name=e,"checkbox"===t?(o&&(s.input.checked=!0),s.input.addEventListener("change",(()=>i(s.input.checked)))):"range"===t?(s.input.min=1,s.input.max=300,s.input.value=o,s.input.step=1,s.input.addEventListener("input",(()=>i(s.input.value)))):"color"===t&&(s.input.value=o,s.input.addEventListener("input",(()=>i(s.input.value))));s.label=document.createElement("label"),s.label.for=e,s.label.innerText=n,s.label.style["margin-right"]="4px",s.div.appendChild(s.label),s.div.appendChild(s.input)}function so(t,e,n,i,o,r,s,a,l){const c=this;c.shape1={},c.shape2={};const h=i.new(c);c.instantiate=()=>{const n={x:t.x,y:t.y},i=[a.setForListSenders.exists.command(h,1,0),a.setForListSenders.shape2p.command(h,n,n),a.setForListSenders.shape1x.command(h,e.x,e.x),a.setForListSenders.shape2w.command(h,t.w,t.w),a.setForListSenders.shape1w.command(h,e.w,e.w),a.setForListSenders.shape1densityProfile.command(h,e.densityProfile,e.densityProfile)];s?o.loadCommands(i):o.doCommands(i)},c.setAction={},c.setAction.exists=t=>{c.exists=t,r.add(["draggables"])},c.setE=t=>{const e=a.setForListSenders.exists.getCurrentValue(h);a.setForListSenders.exists.go(h,t,e)},c.setAction.shape2p=t=>{c.shape2.x=t.x,c.shape2.y=t.y,2===l.election.dimensions&&(c.x=t.x,c.y=t.y),r.add(["draggables"])},c.setAction.shape1x=t=>{c.shape1.x=t,1===l.election.dimensions&&(c.x=t,c.y=250),r.add(["draggables"])},c.setXY=t=>{if(1===l.election.dimensions){const e=a.setForListSenders.shape1x.getCurrentValue(h);a.setForListSenders.shape1x.go(h,t.x,e)}else{const e=a.setForListSenders.shape2p.getCurrentValue(h);a.setForListSenders.shape2p.go(h,t,e)}},c.updateXY=()=>{1===l.election.dimensions?c.setAction.shape1x(c.shape1.x):c.setAction.shape2p({x:c.shape2.x,y:c.shape2.y})},c.setAction.shape2w=t=>{c.shape2.w=t,r.add(["width"])},c.setW2=t=>{const e=a.setForListSenders.shape2w.getCurrentValue(h);a.setForListSenders.shape2w.go(h,t,e)},c.setAction.shape1w=t=>{c.shape1.w=t,r.add(["width"])},c.setW1=t=>{const e=a.setForListSenders.shape1w.getCurrentValue(h);a.setForListSenders.shape1w.go(h,t,e)},c.setAction.shape1densityProfile=t=>{c.shape1.densityProfile=t,r.add(["densityProfile"])},c.setDensityProfile1=t=>{const e=a.setForListSenders.shape1densityProfile.getCurrentValue(h);a.setForListSenders.shape1densityProfile.go(h,t,e)},c.instantiate(),c.click=()=>{oo(c,n,l)},c.color="#88888888"}function ao(t,e,n){const i=this;function o(n,o,r){i.setForListSenders[n]=e.addSenderForList({action:(e,o)=>{i.setNumberVoters(e+1);t.get(e).setAction[n](o)},name:`voters-${o}`,props:{isChain:r}})}i.setForListSenders={},o("exists","exists",!1),o("shape2p","shape2D-point",!0),o("shape1x","shape1D-x",!0),o("shape2w","shape2D-width",!0),o("shape1w","shape1D-width",!0),o("shape1densityProfile","shape1D-densityProfile",!1),i.setNumberVotersSender=e.addSender({action:t=>n.setNumberVotersAction(t),currentValue:0,name:"voters-setNumberAtLeast",props:{isFirstAction:!0}}),i.setNumberVoters=t=>{e.loadCommands([i.setNumberVotersSender.command(t)])}}function lo(t,e,n,i,o,r){const s=this;!function(t,e){const n=document.createElement("button");n.innerText="Add Voter",n.className="button2",n.onclick=()=>{e.addVoterPressed()},t.newElement("addVoter",n)}(e,s);const a=new eo,l=new ao(a,i,s);s.addVoterPressed=()=>{const t=a.num()+1;l.setNumberVoters(t)},s.setNumberVotersAction=t=>{for(;a.num()<t;)s.addVoterCircle({x:50,y:50,w:200},{x:50,w:200,densityProfile:"gaussian"},!1)},s.addVoterCircle=(e,s,c)=>{const h=new so(e,s,t,a,i,n,c,l,r);o.one.addSimVoterCircle(h),o.sample.addSimVoterCircle(h);const u=a.num();l.setNumberVoters(u)}}zi.invert=function(t,e){for(var n,i=e,o=i*i,r=o*o*o,s=0;s<12&&(r=(o=(i-=n=(i*(ji+Hi*o+r*($i+Wi*o))-e)/(ji+-.24331799999999998*o+r*(.0062510000000000005+.034164*o)))*i)*o*o,!(nn(n)<Je));++s);return[Ui*t*(ji+-.24331799999999998*o+r*(.0062510000000000005+.034164*o))/sn(i),pn(cn(i)/Ui)]},Xi.invert=Vi(on),Yi.invert=function(t,e){var n,i=e,o=25;do{var r=i*i,s=r*r;i-=n=(i*(1.007226+r*(.015085+s*(.028874*r-.044475-.005916*s)))-e)/(1.007226+r*(.045255+s*(.259866*r-.311325-.005916*11*s)))}while(nn(n)>Ye&&--o>0);return[t/(.8707+(r=i*i)*(r*(r*r*r*(.003971-.001529*r)-.013791)-.131979)),i]},Ji.invert=Vi(pn),Ki.invert=Vi((function(t){return 2*on(t)})),Zi.invert=function(t,e){return[-e,2*on(an(t))-Ze]};const co=Math.round;function ho(t){const e=t.length,n=Array(4).fill();if("rgb"===t.slice(0,3).toLowerCase()){const e=t.replace(" ","").split(",");n[0]=parseInt(e[0].slice("a"===e[3].toLowerCase()?5:4),10),n[1]=parseInt(e[1],10),n[2]=parseInt(e[2],10),n[3]=e[3]?parseFloat(e[3]):-1}else{let i;i=e<6?parseInt(String(t[1])+t[1]+t[2]+t[2]+t[3]+t[3]+(e>4?String(t[4])+t[4]:""),16):parseInt(t.slice(1),16),n[0]=i>>16&255,n[1]=i>>8&255,n[2]=255&i,n[3]=9===e||5===e?co((i>>24&255)/255*1e4)/1e4:-1}return n}function uo(t,e,n,i,o,r,s,a,l,c,h,u){const d=this;d.shape1={},d.shape2={};const f=s.new(d);d.instantiate=()=>{const n={x:t.x,y:t.y},i=[h.setForListSenders.exists.command(f,1,0),h.setForListSenders.shape2p.command(f,n,n),h.setForListSenders.shape1x.command(f,e.x,e.x),h.setForListSenders.color.command(f,o,o)];c?a.loadCommands(i):a.doCommands(i)},d.setAction={},d.setAction.exists=t=>{d.exists=t,l.add(["draggables"])},d.setE=t=>{const e=h.setForListSenders.exists.getCurrentValue(f);h.setForListSenders.exists.go(f,t,e)},d.setAction.shape2p=t=>{d.shape2.x=t.x,d.shape2.y=t.y,2===u.election.dimensions&&(d.x=t.x,d.y=t.y),l.add(["draggables"])},d.setAction.shape1x=t=>{d.shape1.x=t,1===u.election.dimensions&&(d.x=t,d.y=250),l.add(["draggables"])},d.setXY=t=>{if(1===u.election.dimensions){const e=h.setForListSenders.shape1x.getCurrentValue(f);h.setForListSenders.shape1x.go(f,t.x,e)}else{const e=h.setForListSenders.shape2p.getCurrentValue(f);h.setForListSenders.shape2p.go(f,t,e)}},d.updateXY=()=>{1===u.election.dimensions?d.setAction.shape1x(d.shape1.x):d.setAction.shape2p({x:d.shape2.x,y:d.shape2.y})},d.setAction.color=t=>{d.color=t,d.colorRGBA=ho(t),l.add(["color"])},d.setColor=t=>{const e=h.setForListSenders.color.getCurrentValue(f);h.setForListSenders.color.go(f,t,e)},d.instantiate(),d.click=()=>{oo(d,r,u)},d.wHandle=n,d.hHandle=i}function fo(t,e,n){const i=this,o="candidates";function r(n,r,s){i.setForListSenders[n]=e.addSenderForList({action:(e,o)=>{i.setNumberCandidates(e+1);t.get(e).setAction[n](o)},name:`${o}-${r}`,props:{isChain:s}})}i.setForListSenders={},r("exists","exists",!1),r("shape2p","shape2D-point",!0),r("shape1x","shape1D-x",!0),r("color","color",!1),i.setNumberCandidatesSender=e.addSender({action:t=>{n.setNumberCandidatesAction(t)},currentValue:0,name:`${o}-setNumberAtLeast`,props:{isFirstAction:!0}}),i.setNumberCandidates=t=>{e.loadCommands([i.setNumberCandidatesSender.command(t)])}}function po(t,e){const n=document.createElement("button");n.className="button2",n.innerText="Add Candidate",n.onclick=()=>{e.addCandidatePressed()},t.newElement("addCandidate",n),this.show=()=>{n.hidden=!1},this.hide=()=>{n.hidden=!0}}function go(t,e,n,i,o,r){const s=this;s.canButton=new po(e,s);const a=new eo,l=new fo(a,i,s);s.addCandidatePressed=()=>{const t=a.num()+1;l.setNumberCandidates(t)},s.setNumberCandidatesAction=t=>{for(;a.num()<t;){const t=mt("yellow");s.addCandidate({x:50,y:50},{x:50},t,!1)}},s.addCandidate=(e,s,c,h)=>{const u=new uo(e,s,21,21,c,t,a,i,n,h,l,r);o.one.addSimCandidate(u);const d=a.num();l.setNumberCandidates(d)}}function mo(t,e,n,i,o,r,s,a,l){const c=this;c.shape2={},c.shape1={};const h=i.new(c);c.instantiate=()=>{const n={x:t.x,y:t.y},i=[a.setForListSenders.exists.command(h,1,0),a.setForListSenders.shape2p.command(h,n,n),a.setForListSenders.shape1x.command(h,e.x,e.x),a.setForListSenders.shape2w.command(h,t.w,t.w),a.setForListSenders.shape1w.command(h,e.w,e.w),a.setForListSenders.shape1densityProfile.command(h,e.densityProfile,e.densityProfile)];s?o.loadCommands(i):o.doCommands(i)},c.setAction={},c.setAction.exists=t=>{c.exists=t,r.add(["draggables"])},c.setE=t=>{const e=a.setForListSenders.exists.getCurrentValue(h);a.setForListSenders.exists.go(h,t,e)},c.setAction.shape2p=t=>{c.shape2.x=t.x,c.shape2.y=t.y,2===l.election.dimensions&&(c.x=t.x,c.y=t.y),r.add(["draggables"])},c.setAction.shape1x=t=>{c.shape1.x=t,1===l.election.dimensions&&(c.x=t,c.y=250),r.add(["draggables"])},c.setXY=t=>{if(1===l.election.dimensions){const e=a.setForListSenders.shape1x.getCurrentValue(h);a.setForListSenders.shape1x.go(h,t.x,e)}else{const e=a.setForListSenders.shape2p.getCurrentValue(h);a.setForListSenders.shape2p.go(h,t,e)}},c.updateXY=()=>{1===l.election.dimensions?c.setAction.shape1x(c.shape1.x):c.setAction.shape2p({x:c.shape2.x,y:c.shape2.y})},c.setAction.shape2w=t=>{c.shape2.w=t,r.add(["width"])},c.setW2=t=>{const e=a.setForListSenders.shape2w.getCurrentValue(h);a.setForListSenders.shape2w.go(h,t,e)},c.setAction.shape1w=t=>{c.shape1.w=t,r.add(["width"])},c.setW1=t=>{const e=a.setForListSenders.shape1w.getCurrentValue(h);a.setForListSenders.shape1w.go(h,t,e)},c.setAction.shape1densityProfile=t=>{c.shape1.densityProfile=t,r.add(["densityProfile"])},c.setDensityProfile1=t=>{const e=a.setForListSenders.shape1densityProfile.getCurrentValue(h);a.setForListSenders.shape1densityProfile.go(h,t,e)},c.instantiate(),c.click=()=>{oo(c,n,l)},c.color="#ccc"}function yo(t,e,n){const i=this,o="candidateDns";function r(n,r,s){i.setForListSenders[n]=e.addSenderForList({action:(e,o)=>{i.setNumberCandidateDns(e+1);t.get(e).setAction[n](o)},name:`${o}-${r}`,props:{isChain:s}})}i.setForListSenders={},r("exists","exists",!1),r("shape2p","shape2D-point",!0),r("shape1x","shape1D-x",!0),r("shape2w","shape2D-width",!0),r("shape1w","shape1D-width",!0),r("shape1densityProfile","shape1D-densityProfile",!1),i.setNumberCandidateDnsSender=e.addSender({action:t=>{n.setNumberCandidateDnsAction(t)},currentValue:0,name:`${o}-setNumberAtLeast`,props:{isFirstAction:!0}}),i.setNumberCandidateDns=t=>{e.loadCommands([i.setNumberCandidateDnsSender.command(t)])}}function _o(t,e){const n=document.createElement("button");n.className="button2",n.innerText="Add Candidate Distribution",n.onclick=()=>{e.addCandidateDistributionPressed()},t.newElement("addCandidateDistribution",n),this.show=()=>{n.hidden=!1},this.hide=()=>{n.hidden=!0}}function xo(t,e,n,i,o,r){const s=this;s.canDnButton=new _o(e,s);const a=new eo,l=new yo(a,i,s);s.addCandidateDistributionPressed=()=>{const t=a.num()+1;l.setNumberCandidateDns(t)},s.setNumberCandidateDnsAction=t=>{for(;a.num()<t;)s.addCandidateDistribution({x:50,y:50,w:200},{x:50,w:200,densityProfile:"gaussian"},!1)},s.addCandidateDistribution=(e,s,c)=>{const h=new mo(e,s,t,a,i,n,c,l,r);o.sample.addSimCandidateDistribution(h);const u=a.num();l.setNumberCandidateDns(u)}}function wo(t){const e=document.createElement("div");t.append(e),this.update=(t,n,i)=>{const o=t=>`<span style="color:${t};">&#9632;</span>`;t.ranking?e.innerHTML=t.ranking.map(((t,e)=>o(i[e])+t)).join("<br />"):t.tallyFractions&&(e.innerHTML=t.tallyFractions.map(ht).map(((t,e)=>o(i[e])+t)).join("<br />"))}}function vo(t,e){const n=t.length,i=[0,0,0];let o=0;for(let r=0;r<n;r++){for(let n=0;n<3;n++)i[n]+=t[r]*e[r][n]**2;o+=t[r]}return i.map((t=>Math.round(Math.sqrt(t/o))))}function bo(t){return`rgb(${t[0]},${t[1]},${t[2]})`}function Co(t,e,n){const i=this;function o(){n.voterTest.setE(0)}i.shape1={},i.shape2={},i.setAction={},i.setAction.exists=t=>{i.exists=t},i.setE=t=>{i.setAction.exists(t)},i.setAction.shape2p=t=>{i.shape2.x=t.x,i.shape2.y=t.y,2===n.election.dimensions&&(i.x=t.x,i.y=t.y)},i.setAction.shape1x=t=>{i.shape1.x=t,1===n.election.dimensions&&(i.x=t,i.y=250)},i.setXY=t=>{1===n.election.dimensions?i.setAction.shape1x(t.x):i.setAction.shape2p(t),n.testVote()},i.updateXY=()=>{1===n.election.dimensions?i.setAction.shape1x(i.shape1.x):i.setAction.shape2p({x:i.shape2.x,y:i.shape2.y})},i.setAction.shape1x(0),i.setAction.shape2p({x:0,y:0}),i.start=e=>{n.voterTest.setE(1),n.voterTest.setXY(e),no(t.wrap,o)},i.color="#999";const r=new At(i,9,t);i.circle=r,e.one.dragm.newCircleHandle(i,i.circle),e.sample.dragm.newCircleHandle(i,i.circle);let s={};i.update=(t,e)=>{if(void 0===t)return null;const n=e.getCandidates(),o=n.map((t=>t.color)),r=n.map((t=>t.colorRGBA));i.colorSet=o;const{tallyFractions:a}=t;return i.color=bo(vo(a,r)),s.box&&s.update(t,i.color,i.colorSet),t},i.click=()=>{const e=n.testVote();null!==e&&(s.box&&s.box.remove(),s=function(t,e){const n=io(t,e),{box:i,setPin:o}=n;i.innerText="Vote",i.style["min-width"]="100px";const r=document.createElement("button");r.style["min-width"]="35px",r.style.float="right",r.style.clear="right",r.onclick=()=>{a()};let s=!0;function a(){s=!s,o(s),r.innerHTML=s?"&#x1F6AB;":"&#x1F4CC;"}a();const l=document.createElement("button");l.style.float="right",l.style["min-width"]="35px",l.style["font-size"]="10px",l.innerHTML="&#x2573;",l.onclick=()=>{i.remove(),t.setE(0)},i.appendChild(l),i.appendChild(r);const c=new wo(i);return e.tooltips.appendChild(i),{box:i,update:function(t,e,i){n.update(),c.update(t,e,i)}}}(i,t),s.update(e,i.color,i.colorSet))},i.renderForeground=()=>{(i.exists||n.showGhosts)&&r.render()}}function Ao(t){const e={usr:4};this.runElectionSim=function(n,i,o){if(o.checkNone())return{error:"No Changes"};const r=i.getCandidates(),s=n.getVoterShapes();if(0===s.length)return{error:"No Voters"};if(0===r.length)return{error:"No Candidates"};return t.runElection(s,r,e)},this.testVoteES=(e,n)=>t.testVoteE(e,n)}function So(t){const e=this,n={usr:16};let i=[];e.update=function(t,n,i,o){!1===i.checkNone()&&e.startSim();return e.addSim(t,n,o)},e.startSim=function(){i=[]},e.addSim=function(e,o,r){if(0===e.getVoterShapes().length)return{pointsChanged:!1};if(0===o.getCandidateDistributions().length)return{pointsChanged:!1};if(i.length>5e3)return{pointsChanged:!1};const{seats:s}=t.socialChoice,a=Array(20*s);let l=0;const c=e.getVoterShapes();for(let e=0;e<20;e++){const s=t.socialChoice.numSampleCandidates,h=[];for(let t=0;t<s;t++){const t=o.sampler.samplePoint();1===r?h.push({shape1:t}):h.push({shape2:t})}const u=t.runElection(c,h,n);if("singleWinner"===t.socialChoice.checkElectionType()){const{winner:t}=u,n=1===r?t.shape1:t.shape2;i.push(n),a[e]=n}else{const{allocation:t}=u,e=10;for(let n=0;n<h.length;n++){const o=h[n],s=t[n];for(let t=0;t<s;t++){let n;n=0===t?1===r?o.shape1:o.shape2:1===r?{x:o.shape1.x+(Math.random()-.5)*e}:{x:o.shape2.x+(Math.random()-.5)*e,y:o.shape2.y+(Math.random()-.5)*e},i.push(n),a[l]=n,l+=1}}}}return{pointsChanged:!0,newPoints:a,points:i}}}function Mo(t){const e=this,n={usr:32};e.runElectionSim=(t,n,i)=>{if(i.checkNone())return{error:"No Changes"};const o=n.getCandidates();return e.runElection2(t,o)},e.runElection2=(e,i)=>{if(0===e.getVoterSims().length)return{error:"no voters"};if(0===i.length)return{error:"no candidates"};const o=function(e,i){const{voterGroupsByTract:o}=e;return o.map((e=>e.map((e=>t.castVotes(e,i,n)))))}(e,i),r=function(e,n){const i=n.length,o=function(t,e){const n={};if(void 0!==t[0][0].tallyFractions){const i=function(t,e){const n=Array(e).fill(0);t.forEach((t=>t.forEach((t=>{const{tallyFractions:i}=t;for(let t=0;t<e;t++)n[t]+=i[t]}))));const i=1/n.reduce(((t,e)=>t+e));return n.map((t=>t*i))}(t,e);n.tallyFractions=i}if(void 0!==t[0][0].pairwiseTallyFractions){const i=function(t,e){const n=Array(e);for(let t=0;t<e;t++)n[t]=Array(e).fill(0);t.forEach((t=>t.forEach((t=>{const{pairwiseTallyFractions:i}=t;for(let t=0;t<e;t++)for(let o=0;o<e;o++)n[t][o]+=i[t][o]}))));const i=1/(n[0][1]+n[1][0]);return n.map((t=>t.map((t=>t*i))))}(t,e);n.pairwiseTallyFractions=i}if(void 0!==t[0][0].rankingTallyFractions){const e=function(t){let e=[],n=[];t.forEach((t=>t.forEach((t=>{const{rankingTallyFractions:i,cansRankedAll:o}=t;e=e.concat(i),n=n.concat(o)}))));const i=t.length,o=t[0].length,r=1/(i*o);return e=e.map((t=>t*r)),{rankingTallyFractions:e,cansRankedAll:n}}(t);n.rankingTallyFractions=e.rankingTallyFractions,n.cansRankedAll=e.cansRankedAll}return n}(e,i);return t.socialChoice.run(n,o)}(o,i),s=function(e,n){return e.map((e=>e.map((e=>t.socialChoice.run(n,e)))))}(o,i),a=function(e,n,i){const o=function(t,e,n){const{census:i}=n.districtMaker,{nd:o}=n,r=e.length;return ut(o).map((e=>{const n=i[e],o={};if(void 0!==t[0][0].tallyFractions){const e=function(t,e,n){const i=Array(n).fill(0);for(let o=0;o<e.length;o++){const[r,s,a]=e[o],{tallyFractions:l}=t[r][s];for(let t=0;t<n;t++)i[t]+=l[t]*a}const o=1/i.reduce(((t,e)=>t+e));return i.map((t=>t*o))}(t,n,r);o.tallyFractions=e}if(void 0!==t[0][0].pairwiseTallyFractions){const e=function(t,e,n){const i=Array(n);for(let t=0;t<n;t++)i[t]=Array(n).fill(0);for(let o=0;o<e.length;o++){const[r,s,a]=e[o],{pairwiseTallyFractions:l}=t[r][s];for(let t=0;t<n;t++)for(let e=0;e<n;e++)i[t][e]+=l[t][e]*a}const o=1/(i[0][1]+i[1][0]);return i.map((t=>t.map((t=>t*o))))}(t,n,r);o.pairwiseTallyFractions=e}if(void 0!==t[0][0].rankingTallyFractions){const e=function(t,e){let n=[],i=[],o=0;for(let t=0;t<e.length;t++){const[,,n]=e[t];o+=n}const r=1/o;for(let s=0;s<e.length;s++){const[a,l,c]=e[s];o+=c;const{rankingTallyFractions:h,cansRankedAll:u}=t[a][l],d=h.map((t=>t*c*r));n=n.concat(d),i=i.concat(u)}return{rankingTallyFractions:n,cansRankedAll:i}}(t,n);o.rankingTallyFractions=e.rankingTallyFractions,o.cansRankedAll=e.cansRankedAll}return o}))}(e,n,i);return o.map((e=>t.socialChoice.run(n,e)))}(o,i,e),l=function(e,n){const i=n.length,o=Array(i).fill(0);if("singleWinner"===t.socialChoice.checkElectionType()){e.map((t=>t.iWinner)).forEach((t=>{o[t]+=1}))}else e.forEach((t=>{for(let e=0;e<i;e++)o[e]+=t.allocation[e]}));return o}(a,i);return{resultsStatewide:r,resultsByTract:s,resultsByDistrict:a,allocation:l}},e.testVoteES=(e,n)=>t.testVoteE(e,n)}function Eo(t){const e=function(t){const e=t.length,n=new Array(e);for(let i=0;i<e;i++){n[i]=[];for(let o=0;o<e;o++){if(i===o)continue;const e=t[i],r=t[o];n[i].push(ko(e,r))}}return n}(t);this.sumArea=function(t){const n=e.length,i=Array(n);for(let o=0;o<n;o++){const n=e[o];i[o]=To(t,n)}return i}}function ko(t,e){const n=e.x-t.x,i=e.y-t.y;return{A:{x:n,y:i},b:.5*(t.x+e.x)*n+.5*(t.y+e.y)*i}}function To(t,e){let n=0;const i=t.x,o=t.y,{w:r}=t,s=.5*r;for(let t=i-s;t<i+s;t+=2){const r=s**2-(t-i)**2;let a;a=r>0?Math.sqrt(r):0;let l=o+a,c=o-a;for(let n=0;n<e.length;n++){const i=e[n],o=i.A.y,r=i.A.x,{b:s}=i;if(0===o)r*t<s||(c=1/0);else{const e=(s-r*t)/o;o<0?c=Math.max(c,e):l=Math.min(l,e)}}const h=l-c;if(h>0){n+=2*h}}return n}function Po(t){const e=function(t){const e=t.length,n=ut(e).sort(((e,n)=>t[e].x-t[n].x)),i=new Array(e-1);for(let o=0;o<e-1;o++)i[o]=.5*(t[n[o]].x+t[n[o+1]].x);const o=new Array(e);for(let t=0;t<e;t++){const r=0===t?-1/0:i[t-1],s=t===e-1?1/0:i[t];o[n[t]]={lower:r,upper:s}}return o}(t);this.sumArea=function(n){const i=t.length,o=Array(i);if("gaussian"===n.densityProfile)for(let t=0;t<i;t++)o[t]=No(n,e[t]);else for(let t=0;t<i;t++)o[t]=Fo(n,e[t]);return o}}function Fo(t,e){const{lower:n,upper:i}=e,{x:o,w:r}=t,s=.5*r,a=o-s,l=o+s,c=Math.max(n,a),h=Math.min(i,l);return Math.max(0,h-c)}function No(t,e){const{lower:n,upper:i}=e,{x:o,w:r}=t,s=o,a=r/Math.sqrt(2*Math.PI);return r*gt(i,s,a)-r*gt(n,s,a)}function Do(t,e,n){const i=t.length,o=new Array(i).fill(0),r=1===n?Lo:Io,s=t.map((t=>r(t,e))),[a,l]=function(t){let e=t[0],n=t[0];for(let i=0;i<t.length;i++){const o=t[i];o<e&&(e=o),o>n&&(n=o)}return[e,n]}(s);for(let t=0;t<i;t++){const e=s[t];if(e<=a)o[t]=1;else if(e>=l)o[t]=0;else{const n=(e-a)/(l-a);o[t]=0+1*(1-n)}}return{tallyFractions:o}}function Lo(t,e){return Math.abs(t.x-e.x)}function Io(t,e){return Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2)}function Ro(t,e){this.sumArea=function(n){const i=function(t,e){const n="gaussian"===t.densityProfile?3:1,{x:i,y:o,w:r}=t,s=r*n,{usr:a}=e,l=Math.round(s/a),c=ut(l),h=ut(l),u=c.map((t=>(t+.5)*a-.5*s+i)),d=h.map((t=>(t+.5)*a-.5*s+o)),f=c.length,p=h.length,g=f*p,m=Array(g),y=Array(g),_=Array(g);let x=0;for(let e=0;e<h.length;e++)for(let n=0;n<c.length;n++){const i=u[n],o=d[e];m[x]=i,y[x]=o,_[x]=Vo(t,i,o),x+=1}return{x:m,y:y,weight:_,nx:f,ny:p}}(n,e),o=t.length,r=Array(o).fill(0);let s=0;const a=i.x.length,l=Array(a);for(let e=0;e<a;e++){const n=i.weight[e],a=i.x[e],c=i.y[e],h=Do(t,{x:a,y:c},2);l[e]=h;const{tallyFractions:u}=h;s+=n;for(let t=0;t<o;t++)r[t]+=u[t]*n}return{grid:i,voteSet:l,area:r,totalArea:s}}}function Vo(t,e,n){const i="gaussian"===t.densityProfile,{x:o,y:r,w:s}=t;if(!i){return(e-o)**2+(n-r)**2<(.5*s)**2?1:0}const a=s/Math.sqrt(2*Math.PI);return s*pt(e,o,a)*pt(n,r,a)}function Oo(t){this.sumArea=function(e){const n=function(t){const e="gaussian"===t.densityProfile?3:1,{x:n,w:i}=t,o=Math.round(i*e),r=ut(o).map((t=>t+.5-.5*o+n));return{x:r}}(e),i=t.length,o=Array(i).fill(0);let r=0;const s=n.x.length,a=Array(s);for(let l=0;l<s;l++){const s=n.x[l],c=Do(t,{x:s},1);a[l]=c;const{tallyFractions:h}=c,u=Bo(e,s);r+=u;for(let t=0;t<i;t++)o[t]+=h[t]*u}return{grid:n,voteSet:a,area:o,totalArea:r}}}function Bo(t,e){if(!("gaussian"===t.densityProfile))return 1;const{x:n,w:i}=t;return i*pt(e,n,i/Math.sqrt(2*Math.PI))}function qo(t,e){const n=t.length,i=[],o=[];let r=0,s=0,a=t[n-1],l=jo(e,a);for(let c=0;c<n;c++){const n=t[c],h=jo(e,n);if(l&&!h||!l&&h){const t=Ho(a,n,Go(e,a),Go(e,n));i[r]=t,o[s]=t,r+=1,s+=1}h?(o[s]=n,s+=1):(i[r]=n,r+=1),a=n,l=h}return{positive:i,negative:o}}function Go(t,e){return(t[0]*e[0]+t[1]*e[1]+t[2])/Math.sqrt(t[0]**2+t[1]**2)}function jo(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]<0}function Ho(t,e,n,i){let o=-i/(n-i);o<0&&(o=0),o>1&&(o=1);return[o*t[0]+(1-o)*e[0],o*t[1]+(1-o)*e[1]]}function $o(t,e){const n=function(t){const e=t.w/2,{x:n}=t,{y:i}=t,o=100,r=Array(o);for(let t=0;t<o;t++){const s=t/(o-1),a=2*Math.PI*s,l=n+e*Math.cos(a),c=i+e*Math.sin(a);r[t]=[l,c]}return r}(t);let i=[n];const o=e.length;let r=[Array(o).fill(0)];for(let t=0;t<o-1;t++)for(let n=t+1;n<o;n++){const o=i.length,s=Array(2*o),a=Array(2*o);let l=0;for(let c=0;c<o;c++){const o=qo(i[c],Wo(e[t],e[n])),h=o.positive;void 0!==h&&h.length>2&&(s[l]=h,a[l]=wt(r[c]),a[l][n]+=1,l+=1);const u=o.negative;void 0!==u&&u.length>2&&(s[l]=u,a[l]=wt(r[c]),a[l][t]+=1,l+=1)}s.splice(l),a.splice(l),i=s,r=a}const s=i.length,a=Array(s),l=Array(s);for(let t=0;t<s;t++){a[t]=Array(o),l[t]=Array(o);for(let e=0;e<o;e++)l[t][e]=[];for(let e=0;e<o;e++){const n=o-r[t][e];a[t][e]=n,l[t][n-1].push(e)}}return{cells:i,ranking:a,cansRanked:l}}function Wo(t,e){const{A:n,b:i}=ko(t,e);return[n.x,n.y,-i]}function Uo(t){this.sumArea=function(e,n){let{cells:i,ranking:o,cansRanked:r}=$o(e,t);const s=i.length;let a=Array(s),l=0;for(let t=0;t<s;t++){const e=-Vt(i[t])*n;a[t]=e,l+=e}const c=1e-6;return o=o.filter(((t,e)=>Math.abs(a[e])>c)),r=r.filter(((t,e)=>Math.abs(a[e])>c)),i=i.filter(((t,e)=>Math.abs(a[e])>c)),a=a.filter((t=>Math.abs(t)>c)),{ranking:o,cansRanked:r,area:a,totalArea:l,cellDatum:{cells:i,ranking:o}}}}function zo(t){const e=t.length,n=ut(e).sort(((e,n)=>t[e].x-t[n].x)),i=.5*e*(e-1),o=Array(i),r=Array(i);let s=0;for(let i=0;i<e-1;i++)for(let c=i+1;c<e;c++){const e=n[i],h=n[c],u=(a=t[e],l=t[h],.5*(a.x+l.x));o[s]=u,r[s]=[e,h],s+=1}var a,l;const c=ut(i).sort(((t,e)=>o[t]-o[e])),h=c.map((t=>o[t])),u=c.map((t=>r[t])),d=Array(e);for(let t=0;t<e;t++)d[n[t]]=t+1;const f=Array(i+1);f[0]=wt(d);for(let t=0;t<i;t++){const[e,n]=u[t];d[e]+=1,d[n]-=1,f[t+1]=wt(d)}const p=Array(i+1);for(let t=0;t<i+1;t++){p[t]=Array(e);for(let n=0;n<e;n++)p[t][n]=[];const n=f[t];for(let i=0;i<e;i++){const e=n[i];p[t][e-1].push(i)}}const g=wt(h);return g.unshift(-1/0),g.push(1/0),{intervalBorders:g,ranking:f,cansRanked:p}}function Xo(t){const{intervalBorders:e,ranking:n,cansRanked:i}=zo(t);this.sumArea=function(t,o){const r=e.length-1,s=Array(r);let a=0;for(let n=0;n<r;n++){const i=Yo(e[n],e[n+1],t)*o;s[n]=i,a+=i}return{ranking:n,cansRanked:i,area:s,totalArea:a,cellDatum:{ranking:n,intervalBorders:e}}}}function Yo(t,e,n){return"gaussian"===n.densityProfile?No(n,{lower:t,upper:e}):Fo(n,{lower:t,upper:e})}function Jo(t,e){return(t.x-e.x)**2}function Ko(t,e){return(t.x-e.x)**2+(t.y-e.y)**2}function Zo(t,e,n){const i=1===n?Qo:tr,o=t.map((t=>i(t,e))),r=t.length,s=ut(r).sort(((t,e)=>o[t]-o[e])),a=new Array(r).fill(0),l=new Array(r).fill(0);for(let t=0;t<r;t++)a[s[t]]=t+1,l[s[t]]=r-t-1;const c=new Array(r);for(let t=0;t<r;t++){c[t]=new Array(r).fill(0);for(let e=0;e<r;e++)a[t]!==a[e]&&(c[t][e]=a[t]<a[e]?1:-1)}return{indexInOrder:s,ranking:a,bordaScores:l,pairwise:c,tallyFractions:l}}function Qo(t,e){return(t.x-e.x)**2}function tr(t,e){return(t.x-e.x)**2+(t.y-e.y)**2}function er(t){const e=t.length,n=Array(e-1),i=Array(e-1);for(let o=0;o<e-1;o++){n[o]=Array(e-o-1),i[o]=Array(e-o-1);for(let r=o+1;r<e;r++){const e=t[o].x,s=t[r].x,a=.5*(e+s);n[o][r]=a,i[o][r]=e<s}}this.sumArea=function(t,o){const r=function(t,e){const n=-1/0,i=1/0;return nr(n,i,t)*e}(t,o),s=Array(e).fill(0);for(let t=0;t<e;t++)s[t]=Array(e).fill(0);for(let a=0;a<e-1;a++)for(let l=a+1;l<e;l++){const e=nr(-1/0,n[a][l],t)*o,c=i[a][l]?e:r-e,h=r-c;s[a][l]=c,s[l][a]=h}return{area:s,totalArea:r}}}function nr(t,e,n){return"gaussian"===n.densityProfile?No(n,{lower:t,upper:e}):Fo(n,{lower:t,upper:e})}function ir(t){this.sumArea=function(e,n){const i=function(t,e){return e*Math.PI*(t.w/2)**2}(e,n),o=t.length,r=Array(o).fill(0);for(let t=0;t<o;t++)r[t]=Array(o).fill(0);for(let s=0;s<o-1;s++)for(let a=s+1;a<o;a++){const o=sr(rr(or(t[s],t[a]),e),e,n,i),l=i-o;r[s][a]=o,r[a][s]=l}return{area:r,totalArea:i}}}function or(t,e){const{A:n,b:i}=ko(t,e);return[n.x,n.y,-i]}function rr(t,e){return(t[0]*e.x+t[1]*e.y+t[2])/Math.sqrt(t[0]**2+t[1]**2)}function sr(t,e,n,i){const o=e.w/2;if(t>o)return 0;if(t<-o)return i;const r=t/o;return o**2*(Math.acos(r)-r*Math.sqrt(1-r**2))*n}const ar={plurality:{cast:function(t,e,n){const i=1===n?new Po(t):new Eo(t),o=t.length;let r=new Array(o).fill(0);e.forEach((t=>{const e=i.sumArea(t),n=void 0===t.weight?1:t.weight;r=r.map(((t,i)=>t+e[i]*n))}));const s=r.reduce(((t,e)=>t+e));return{tallyFractions:r.map((t=>t/s))}},castTestVote:function(t,e,n){const i=1===n?Jo:Ko,o=yt(t.map((t=>i(t,e)))),r=t.length,s=new Array(r).fill(0);return s[o]=1,{tallyFractions:s}}},score:{cast:function(t,e,n,i){const o=1===n?new Oo(t):new Ro(t,i),r=t.length;let s=new Array(r).fill(0),a=0;const l=[];for(let t=0;t<e.length;t++){const n=e[t],{grid:i,voteSet:r,area:c,totalArea:h}=o.sumArea(n),u={grid:i,voteSet:r,voterGeom:n};l.push(u);const d=void 0===n.weight?1:n.weight;s=s.map(((t,e)=>t+c[e]*d)),a+=h}return{tallyFractions:s.map((t=>t/a)),gridData:l}},castTestVote:Do},ranking:{cast:function(t,e,n){const i=1===n?new Xo(t):new Uo(t),o=t.length;let r=[],s=[],a=[];const l=Array(o).fill(0);let c=0;const h=[];e.forEach((t=>{const e=void 0===t.weight?1:t.weight,{ranking:n,cansRanked:o,area:u,totalArea:d,cellDatum:f}=i.sumArea(t,e);r=r.concat(u),s=s.concat(n),a=a.concat(o),c+=d,h.push(f);for(let t=0;t<o.length;t++){const e=o[t][0];for(let n=0;n<e.length;n++){const i=e[n];l[i]+=u[t]}}}));const u=r.map((t=>t/c)),d=l.map((t=>t/c));return{ranking:s,cansRankedAll:a,rankingTallyFractions:u,tallyFractions:d,cellData:h}},castTestVote:Zo},pairwise:{cast:function(t,e,n){const i=1===n?new er(t):new ir(t);let o=0;const r=t.length,s=Array(r).fill(0);for(let t=0;t<r;t++)s[t]=Array(r).fill(0);e.forEach((t=>{const e=void 0===t.weight?1:t.weight,{area:n,totalArea:a}=i.sumArea(t,e);for(let t=0;t<r;t++)for(let e=0;e<r;e++)s[t][e]+=n[t][e];o+=a}));const a=s.map((t=>t.map((t=>t/o)))),l=Array(r).fill(0);for(let t=0;t<r-1;t++)for(let e=t+1;e<r;e++){const n=a[t][e],i=a[e][t];n>i?l[t]+=1:n<i&&(l[e]+=1)}return{pairwiseTallyFractions:a,tallyFractions:l.map((t=>t/(r-1)))}},castTestVote:Zo}};var lr=ar;const cr={plurality:function(t){return{iWinner:_t(t.tallyFractions)}},randomWinner:function(t){const e=t.tallyFractions.length;return{iWinner:Math.floor(Math.random()*e)}},huntingtonHill:function(t,e){const{seats:n,threshold:i}=e;let o=t.tallyFractions.map((t=>t<i?0:t)),r=o.map((t=>0===t?0:1)),s=r.reduce(((t,e)=>t+e));if(0===s&&(o=wt(t.tallyFractions),r=o.map((t=>0===t?0:1)),s=r.reduce(((t,e)=>t+e))),s>n||0===s){const e=[...o].sort(((t,e)=>e-t)),i=e[n-1];return{allocation:t.tallyFractions.map((t=>t>=i?1:0))}}const a=Array(n).fill().map(((t,e)=>Math.sqrt(e*(e+1)))),l=o.map((t=>0===t?Array(n).fill(1/0):a.map((e=>e/t)))).flat(),c=o.map(((t,e)=>Array(n).fill(e))).flat(),h=ut(c.length).sort(((t,e)=>l[t]-l[e])),u=Array(o.length).fill(0);for(let t=0;t<n;t++){u[c[h[t]]]+=1}return{allocation:u}},score:function(t){const e=Math.max(...t.tallyFractions);return{iWinner:t.tallyFractions.indexOf(e)}},stv:function(t,e){const{tallyFractions:n,rankingTallyFractions:i,cansRankedAll:o}=t,{seats:r}=e,s=n.length,a=i.length;if(r>=s){return{allocation:Array(s).fill(1)}}const l=1/(r+1);let c=!1,h=0;const u=[];let d=wt(n);const f=Array(s).fill(!0);let p=ut(s);const g=Array(a).fill(0),m=Array(a).fill(1),y=Array(a).fill(!1);for(;!c&&h<s;){if(0!==h){d=Array(s).fill(0);for(let t=0;t<o.length;t++){if(y[t])continue;const e=g[t],n=o[t][e];for(let e=0;e<n.length;e++){d[n[e]]+=i[t]*m[t]}}d=d.filter(((t,e)=>f[e])),p=ut(s).filter((t=>f[t]))}const t=_t(d),e=p[t],n=d[t];let a,_=1;if(n>=l)a=e,_=1-l/n,u.push(e),c=u.length===r;else{a=p[yt(d)]}f[a]=!1;for(let t=0;t<o.length;t++){if(y[t])continue;const e=g[t];if(o[t][e].includes(a)){1!==_&&(m[t]*=_);let e=!y[t];for(;e;){g[t]+=1;const n=g[t];if(n===s){y[t]=!0;break}const i=o[t][n];for(let t=0;t<i.length;t++){const n=i[t];e=e&&!f[n]}}}}h+=1}c||console.warn("warning: STV ran over - eliminated all candidates.");const _=Array(s).fill(0);for(let t=0;t<u.length;t++){_[u[t]]+=1}return{allocation:_}},minimax:function(t){const{pairwiseTallyFractions:e}=t,n=e.length,i=Array(n).fill(0),o=.5*n*(n-1),r=Array(n),s=Array(o);let a=0;for(let t=0;t<n-1;t++)for(let o=t+1;o<n;o++){const n=e[t][o]-e[o][t];r[a]=Math.abs(n);const l=n<0;i[t]+=l?1:0,i[o]+=l?0:1,s[a]=l?t:o,a+=1}const l=ut(o).sort(((t,e)=>r[t]-r[e]));let c=i.findIndex((t=>0===t)),h=0;for(;-1===c;){i[s[l[h]]]-=1,c=i.findIndex((t=>0===t)),h+=1}return{iWinner:c}}};var hr=cr;function ur(t){const e=this;e.seats=1,e.run=(t,n)=>{if("allocation"===e.checkElectionType()||"multiWinner"===e.checkElectionType()){const i={seats:e.seats,threshold:.1},o=(0,hr[e.electionMethod])(n,i),{allocation:r}=o;return{allocation:r,canList:t,votes:n}}const i=hr[e.electionMethod](n),{iWinner:o}=i;return{iWinner:o,winner:t[o],votes:n}},e.electionMethodList=[{name:"Huntington Hill",value:"huntingtonHill",type:"allocation",casterName:"plurality"},{name:"Plurality",value:"plurality",type:"singleWinner",casterName:"plurality"},{name:"Random Winner",value:"randomWinner",type:"singleWinner",casterName:"plurality"},{name:"Score",value:"score",type:"singleWinner",casterName:"score"},{name:"STV",value:"stv",type:"multiWinner",casterName:"ranking"},{name:"Minimax",value:"minimax",type:"singleWinner",casterName:"pairwise"}],e.checkElectionType=()=>e.electionMethodListByFunctionName[e.electionMethod].type,e.electionMethodListByFunctionName=[],e.electionMethodList.forEach((t=>{e.electionMethodListByFunctionName[t.value]=t})),e.setElectionMethod=t=>{e.electionMethod=t,e.casterName=e.electionMethodListByFunctionName[t].casterName;const n=e.checkElectionType();"allocation"===n?(e.seats=5,e.numSampleCandidates=10):"multiWinner"===n?(e.seats=3,e.numSampleCandidates=10):(e.seats=1,e.numSampleCandidates=5)},e.setElectionMethod("plurality"),t.addMenuItem(e,{label:"Election Method:",prop:"electionMethod",setProp:e.setElectionMethod,options:e.electionMethodList,change:["electionMethod"]})}function dr(t){const e=this;e.socialChoice=new ur(t),e.dimensions=1,e.setDimensions=t=>{e.dimensions=t};const n=t=>1===e.dimensions?t.map((t=>t.shape1)):t.map((t=>t.shape2)),i=t=>1===e.dimensions?t.map((t=>t.shape1)):t.map((t=>t.shape2));e.runElection=function(t,n,i){const o=e.castVotes(t,n,i);return e.socialChoice.run(n,o)},e.castVotes=(t,o,r)=>{const s=n(t),a=i(o),{cast:l}=lr[e.socialChoice.casterName];return l(a,s,e.dimensions,r)},e.testVoteE=(t,o,r)=>{const s=[t],a=o.getCandidates(),l=n(s)[0],c=i(a),{castTestVote:h}=lr[e.socialChoice.casterName];return h(c,l,e.dimensions,r)}}function fr(t,e){const n=this,i=new rt(t,t.wHandle,t.hHandle,e);n.square=i,n.fraction=0,n.setFraction=function(t){n.fraction=t},n.setWins=t=>{n.wins=t},n.renderForeground=function(){i.render();const{x:o,y:r,exists:s}=t;0!==s&&(ct(ht(n.fraction),o,r-.5*i.h-2,20,2,"#222",1,e.fctx),void 0!==n.wins&&ct(n.wins,o,r+.5*i.h+20+2,20,2,"#222",1,e.fctx))}}function pr(t,e,n){const i=this;i.candidate=t,i.graphic=new fr(t,n),e.newSquareHandle(t,i.graphic.square)}function gr(t){const e=this,n=[];e.newCandidate=function(t){n.push(t)},e.getSimCandidates=()=>n.filter((t=>t.candidate.exists)),e.getCandidates=()=>e.getSimCandidates().map((t=>t.candidate)),e.getCandidatesAll=()=>n.map((t=>t.candidate)),e.setCandidateFractions=t=>{e.getSimCandidates().forEach(((e,n)=>{const i=t[n];e.graphic.setFraction(i)}))},e.setCandidateWins=t=>{e.getSimCandidates().forEach(((e,n)=>{const i=t[n];e.graphic.setWins(i)}))},e.updateXY=()=>{n.forEach((t=>t.candidate.updateXY()))},e.renderForeground=()=>{t.showGhosts?e.renderForegroundAll():e.renderForegroundExisting()},e.renderForegroundExisting=()=>{e.getSimCandidates().forEach((t=>t.graphic.renderForeground()))},e.renderForegroundAll=()=>{n.forEach((t=>t.graphic.renderForeground()))},e.numSimCandidates=()=>n.length}function mr(t,e,n){const{resultsByTract:i,resultsByDistrict:o}=t,r=e.getCandidates(),s=function(t,e){const n=e.map((t=>t.colorRGBA));return t.map((t=>t.map((t=>{const{tallyFractions:e}=t.votes;return vo(e,n)}))))}(i,r),a=function(t,e,n){let i;if("singleWinner"===n.election.socialChoice.checkElectionType())i=t.map((t=>t.winner.color));else{const n=e.map((t=>t.colorRGBA));i=t.map((t=>{const{allocation:e}=t,i=e.reduce(((t,e)=>t+e));return bo(vo(e.map((t=>t/i)),n))}))}return i}(o,r,n),l=function(t,e){return t.map((t=>{const{tallyFractions:n}=t.votes;return bo(vo(n,e.map((t=>t.colorRGBA))))}))}(o,r);return{colorByTract:s,colorOfVoteByDistrict:l,colorOfWinsByDistrict:a}}function yr(t,e,n){const i=this,o=document.createElement("canvas");o.width=t,o.height=e;const r=o.getContext("2d"),s=r.createImageData(t,e);i.load=n=>{const{data:i}=s;for(let o=0;o<t;o++)for(let r=0;r<e;r++){const e=n[o][r][0]+.5,s=n[o][r][1]+.5;i[4*(o+r*t)+0]=255*e,i[4*(o+r*t)+1]=200*(e+s),i[4*(o+r*t)+2]=200*s,i[4*(o+r*t)+3]=255}r.putImageData(s,0,0)},i.loadColors=n=>{const{data:i}=s;for(let o=0;o<e;o++)for(let e=0;e<t;e++){const r=n[e][o],[s,a,l]=r;i[4*(e+o*t)+0]=s,i[4*(e+o*t)+1]=a,i[4*(e+o*t)+2]=l,i[4*(e+o*t)+3]=255}r.putImageData(s,0,0)},i.render=(t,e)=>{const{mctx:i}=n;i.save(),i.imageSmoothingEnabled=!1,i.drawImage(o,0,0,t,e),i.restore()}}function _r(t,e,n,i){const o=this;o.noiseImage=new yr(t.nx,t.ny,n),o.update=t=>{const n=mr(t,e,i),{colorByTract:r,colorOfVoteByDistrict:s,colorOfWinsByDistrict:a}=n;o.colorOfVoteByDistrict=s,o.winnerColors=a,o.noiseImage.loadColors(r)};const r=100,s=100;o.render=()=>{o.renderPolicyNoise(),o.renderTractVotes(),o.renderDistrictWins(),o.renderDistrictVotes()},o.renderTractVotes=()=>{o.noiseImage.render(r,s),t.districtMaker.renderVoronoi(r,s)},o.renderDistrictWins=()=>{const{renderVoronoiColors:e}=t.districtMaker;e(200,0,r,s,o.winnerColors)},o.renderDistrictVotes=()=>{const{renderVoronoiColors:e}=t.districtMaker;e(100,0,r,s,o.colorOfVoteByDistrict)},o.renderPolicyNoise=()=>{t.voterGroupsByTract.forEach((t=>{t.forEach((t=>{t.forEach((t=>{if(1===i.election.dimensions){const{x:e}=t.shape1,{y:n}=t.shape2;c(e,n%100+0)}else{const{x:e,y:n}=t.shape2;c(e,n)}}))}))}))};const a=document.createElement("canvas"),l=a.getContext("2d");function c(t,e){const{ctx:i}=n;i.drawImage(a,t-5,e-5,10,10)}a.width=10,a.height=10,l.beginPath(),l.fillStyle="#555",l.arc(5,5,1,0,2*Math.PI),l.fill()}function xr(t,e,n,i){const o=this,r=new _r(t,e,n,i);let s=!1;const{dimensions:a}=i.election,l=1===a?Ce:Ae;t.setRenderer((t=>new l(t,n))),o.enter=()=>{n.showMaps()},o.exit=()=>{n.hideMaps();const t=Array(e.numSimCandidates()).fill(void 0);e.setCandidateWins(t)},o.update=function(t){const{error:n}=t;if(void 0!==n)return void(s=!0);s=!1,r.update(t);const{resultsStatewide:i,allocation:o}=t;e.setCandidateWins(o),e.setCandidateFractions(i.votes.tallyFractions)},o.render=function(){s||(r.render(),t.render())}}function wr(t){const{allocation:e}=t,{votes:n}=t,{tallyFractions:i}=n;if(void 0===e){const e=n.tallyFractions.length,o=Array(e).fill(0);return o[t.iWinner]=1,{tallyFractions:i,allocation:o}}return{tallyFractions:i,allocation:e}}function vr(t,e,n){let i,o;this.update=function(){o=e.getCandidates();const t=o.map((t=>[t.x,t.y])),r=fe.from(t);i=r.voronoi([0,0,n.width,n.height])},this.render=function(){const{ctx:e}=n,{x:r,shape1:s}=t,{w:a,densityProfile:l}=s,c=100;e.save(),e.beginPath(),u(),e.clip();const h=o.length;for(let t=0;t<h;t++)e.beginPath(),i.renderCell(t,e),e.fillStyle=o[t].color,e.fill(),e.stroke();function u(){"gaussian"===l?function(){const t=a/Math.sqrt(2*Math.PI),i=c,o=200;e.moveTo(0,o);const s=[];for(let a=0;a<=n.width;a+=1){const n=.5*((a-r)/t)**2,l=o-i*Math.exp(-n);s.push(l),e.lineTo(a,l)}e.lineTo(n.width,o),e.lineTo(0,o)}():e.rect(r-.5*a,100,a,c)}e.beginPath(),u(),e.stroke(),e.restore()}}function br(t,e,n){let i,o;this.update=function(){o=e.getCandidates();const t=o.map((t=>[t.x,t.y])),r=fe.from(t);i=r.voronoi([0,0,n.width,n.height])},this.render=function(){const{ctx:e}=n;e.save(),e.beginPath(),e.arc(t.x,t.y,.5*t.shape2.w,0,2*Math.PI),e.clip();const r=o.length;for(let t=0;t<r;t++)e.beginPath(),i.renderCell(t,e),e.fillStyle=o[t].color,e.fill(),e.stroke();e.beginPath(),e.arc(t.x,t.y,.5*t.shape2.w,0,2*Math.PI),e.stroke(),e.restore()}}function Cr(t,e,n,i){const o=this,{dimensions:r}=i.election,s=1===r?vr:br;t.setRenderer((t=>new s(t,e,n))),o.enter=()=>{},o.exit=()=>{const t=Array(e.numSimCandidates()).fill(void 0);e.setCandidateWins(t)},o.update=function(n){const{error:i}=n;if(void 0!==i)return;const{tallyFractions:o,allocation:r}=wr(n);e.setCandidateWins(r),e.setCandidateFractions(o),t.updateGraphic()},o.render=function(){t.render()}}function Ar(t,e,n){let i,o,r;this.update=function(t){let n,s;if(void 0===t){i=e.getCandidates();const t=zo(i.map((t=>t.shape1)));n=t.ranking,s=t.intervalBorders}else n=t.ranking,s=t.intervalBorders;i=e.getCandidates();const a=i.length,l=i.map((t=>t.colorRGBA)),c=s.length-1;r=Array(c),o=Array(c);for(let t=0;t<c;t++){r[t]=[s[t],s[t+1]];const e=n[t].map((t=>a-t));o[t]=bo(vo(e,l))}},this.render=function(){const{ctx:e}=n,{x:i,shape1:s}=t,{w:a,densityProfile:l}=s,c=100;e.save(),e.beginPath(),u(),e.clip();const h=r.length;for(let t=0;t<h;t++)Sr(r[t],o[t],e,n);function u(){"gaussian"===l?function(){const t=a/Math.sqrt(2*Math.PI),o=c,r=200;e.moveTo(0,r);const s=[];for(let a=0;a<=n.width;a+=1){const n=.5*((a-i)/t)**2,l=r-o*Math.exp(-n);s.push(l),e.lineTo(a,l)}e.lineTo(n.width,r),e.lineTo(0,r)}():e.rect(i-.5*a,100,a,c)}e.beginPath(),u(),e.stroke(),e.restore()}}function Sr(t,e,n,i){const o=Math.max(0,t[0]),r=Math.min(i.width,t[1])-o,s=i.height;n.beginPath(),n.rect(o,0,r,s),n.fillStyle=e,n.fill(),n.stroke()}function Mr(t,e,n){let i,o,r;this.update=function(n){let s;if(void 0===n){i=e.getCandidates();const n=i.map((t=>t.shape2)),o=$o(t.shape2,n);s=o.ranking,r=o.cells}else s=n.ranking,r=n.cells;i=e.getCandidates();const a=i.length,l=r.length;o=Array(l);const c=i.map((t=>t.colorRGBA));for(let t=0;t<l;t++){const e=s[t].map((t=>a-t));o[t]=bo(vo(e,c))}},this.render=function(){const{ctx:e}=n;e.save();const i=r.length;for(let t=0;t<i;t++)e.beginPath(),Er(e,r[t]),e.fillStyle=o[t],e.strokeStyle=o[t],e.fill(),e.stroke();e.strokeStyle="#222",e.beginPath(),e.arc(t.x,t.y,.5*t.shape2.w,0,2*Math.PI),e.stroke(),e.restore()}}function Er(t,e){const n=e.length,i=e[n-1];t.moveTo(i[0],i[1]);for(let i=0;i<n;i++){const n=e[i];t.lineTo(n[0],n[1])}}function kr(t,e,n,i){const o=this,{dimensions:r}=i.election,s=1===r?Ar:Mr;t.setRenderer((t=>new s(t,e,n))),o.enter=()=>{},o.exit=()=>{const t=Array(e.numSimCandidates()).fill(void 0);e.setCandidateWins(t)},o.update=function(n){const{error:i}=n;if(void 0!==i)return;const{tallyFractions:o,allocation:r}=wr(n);e.setCandidateWins(r),e.setCandidateFractions(o);const{cellData:s}=n.votes;t.updateGraphic(s)},o.render=function(){t.render()}}function Tr(t,e){const n=this;let i,o;function r(t,n,r){const{grid:s,voteSet:a,voterGeom:l}=i,{x:c,w:h,densityProfile:u}=l,d=o.length,f="gaussian"===u,p=s.x,g=h/Math.sqrt(2*Math.PI),m=200/d,y=200-n*m,_=Math.max(-1,p[0]);t.moveTo(_,y);const x=p.length;for(let i=0;i<x;i+=1){const o=p[i];if(o<-1)continue;if(o>e.width+1)continue;const s=r?1:a[i].tallyFractions[n],l=y-m*(f?Math.exp(-.5*((o-c)/g)**2):1)*s;t.lineTo(o,l)}const w=Math.min(e.width+1,p[x-1]);t.lineTo(w,y),t.lineTo(_,y)}n.update=e=>{i=e,o=t.getCandidates()},n.renderBackground=function(){const{ctx:t}=e;t.save(),t.globalAlpha=.7;const n=o.length;for(let e=0;e<n;e++)t.strokeStyle="#dddddd",t.beginPath(),r(t,e,!0),t.stroke();t.restore()},n.render=function(){const{ctx:t}=e;t.save(),t.globalAlpha=.7;const n=o.length;for(let e=0;e<n;e++)t.fillStyle=o[e].color,t.strokeStyle=bo(vo([.8,.2],[o[e].color,"#000000"])),t.beginPath(),r(t,e,!1),t.fill(),t.stroke();t.restore()}}function Pr(t,e){let n,i,o;const r=[];this.update=s=>{n=s,i=t.getCandidates();const{grid:a,voteSet:l,voterGeom:c}=n,h=i.length,u=Math.floor((h-1)/3)+1;e.setMapsHeight(u*(1/3)*e.height);const d="gaussian"===c.densityProfile;!function(){const{nx:t,ny:e,weight:n}=a;r.splice(0);for(let o=0;o<i.length;o++){const s=document.createElement("canvas");s.width=t,s.height=e;const a=s.getContext("2d"),c=a.createImageData(t,e),{data:h}=c,{colorRGBA:u}=i[o],[f,p,g]=u;let m=0;for(let i=0;i<e;i++)for(let e=0;e<t;e++){const r=l[m].tallyFractions[o]*(d?n[m]:1)*255;h[4*(e+i*t)+0]=f,h[4*(e+i*t)+1]=p,h[4*(e+i*t)+2]=g,h[4*(e+i*t)+3]=r,m+=1}r.push(s),a.putImageData(c,0,0)}}(),function(){const{nx:t,ny:e,weight:n}=a,r=i.map((t=>t.colorRGBA)),s=document.createElement("canvas");s.width=t,s.height=e;const c=s.getContext("2d"),h=c.createImageData(t,e),{data:u}=h;let f=0;for(let i=0;i<e;i++)for(let e=0;e<t;e++){const{tallyFractions:o}=l[f],[s,a,c]=vo(o,r),h=255*(d?n[f]:1);u[4*(e+i*t)+0]=s,u[4*(e+i*t)+1]=a,u[4*(e+i*t)+2]=c,u[4*(e+i*t)+3]=h,f+=1}o=s,c.putImageData(h,0,0)}()},this.render=function(){const{ctx:t,mctx:s}=e,{x:a,y:l,w:c}=n.voterGeom;!function(){t.save(),t.beginPath(),t.arc(a,l,.5*c,0,2*Math.PI),t.clip();const e={w:1,h:1,x:0,y:0},n=o;t.imageSmoothingEnabled=!1;const i={x:a-.5*c+e.x,y:l-.5*c+e.y,w:c*e.w,h:c*e.h};t.drawImage(n,i.x,i.y,i.w,i.h),t.beginPath(),t.arc(a,l,.5*c,0,2*Math.PI),t.stroke(),t.restore()}(),function(){const t=i.length;for(let e=0;e<t;e++){s.save();const t={w:1/3,h:1/3,x:e%3*100,y:100*Math.floor(e/3)},n={x:a*t.w+t.x,y:l*t.h+t.y,r:c*t.w*.5};s.beginPath(),s.arc(n.x,n.y,n.r,0,2*Math.PI),s.clip(),s.beginPath(),s.rect(t.x,t.y,100,100),s.clip();const i=r[e],o={x:a*t.w-c*t.w*.5+t.x,y:l*t.w-c*t.w*.5+t.y,w:c*t.w,h:c*t.h};s.drawImage(i,o.x,o.y,o.w,o.h),s.beginPath(),s.arc(n.x,n.y,n.r,0,2*Math.PI),s.stroke(),s.restore()}}()}}function Fr(t,e,n,i){const o=this,{dimensions:r}=i.election,s=1===r?Tr:Pr;t.setRenderer((()=>new s(e,n))),o.enter=function(){2===r&&n.showMaps()},o.exit=function(){n.hideMaps();const t=Array(e.numSimCandidates()).fill(void 0);e.setCandidateWins(t)},o.update=function(n){const{error:i}=n;if(void 0!==i)return;const{tallyFractions:o,allocation:r}=wr(n);e.setCandidateWins(r),e.setCandidateFractions(o);const{gridData:s}=n.votes;t.updateGraphic(s)},o.render=function(){1===i.election.dimensions&&t.renderBackground(),t.render()}}function Nr(t,e,n,i,o,r){const s=this;Ct.call(s,t,n,r);const a=new gr(r),l=new lt(r),c=new be(t,r,n);let h,u,d;function f(){h=r.geo?c:l,u=r.geo?o:i;const{casterName:e}=r.election.socialChoice,n="score"===e?Fr:"ranking"===e||"pairwise"===e?kr:Cr,s=!0===r.geo?xr:n;d=new s(h,a,t,r)}s.addSimCandidate=e=>{a.newCandidate(new pr(e,s.dragm,t))},s.addSimVoterCircle=e=>{c.newVoterSim(new Mt(e,s.dragm,t)),l.newVoterSim(new Mt(e,s.dragm,t))},n.add(["districts"]),f();const p=s.enter;s.enter=()=>{p(),f(),r.candidateAdd.canButton.show(),d.enter(),h.updateXY(),a.updateXY(),r.voterTest.updateXY()},s.exit=()=>{d.exit(),r.candidateAdd.canButton.hide(),r.voterTest.setE(0)},s.update=()=>{if(n.checkNone())return;h.update();const e=u.runElectionSim(h,a,n);d.update(e),s.testVoteSim(),n.clear(),t.clear(),t.clearMaps(),s.render()},s.testVoteSim=()=>{const t=u.testVoteES(r.voterTest,a);return r.voterTest.update(t,a),t},s.render=()=>{d.render()},s.renderForeground=()=>{h.renderForeground(),a.renderForeground(),r.voterTest.renderForeground()}}function Dr(t,e){const n=this;let i=[];n.update=function(t,e,i,o){!1===i.checkNone()&&n.startSim();return n.addSim(t,e,o)},n.startSim=function(){i=[]},n.addSim=function(n,o,r){if(0===n.getVoterShapes().length)return{pointsChanged:!1};if(0===o.getCandidateDistributions().length)return{pointsChanged:!1};if(i.length>5e3)return{pointsChanged:!1};const{seats:s}=t.socialChoice,{nd:a}=n,l=Array(1*s*a);let c=0;for(let s=0;s<1;s++){const s=t.socialChoice.numSampleCandidates,a=[];for(let t=0;t<s;t++){const t=o.sampler.samplePoint();1===r?a.push({shape1:t}):a.push({shape2:t})}const h=e.runElection2(n,a),{resultsByDistrict:u}=h,d=u.length,f=10;if("singleWinner"===t.socialChoice.checkElectionType()){let t=0;for(let e=0;e<d;e++){const{winner:n}=u[e];let o;o=0===t?1===r?n.shape1:n.shape2:1===r?{x:n.shape1.x+(Math.random()-.5)*f}:{x:n.shape2.x+(Math.random()-.5)*f,y:n.shape2.y+(Math.random()-.5)*f},i.push(o),l[c]=o,c+=1,t+=1}}else{let t=0;for(let e=0;e<d;e++){const{allocation:n}=u[e];for(let e=0;e<a.length;e++){const o=a[e],s=n[e];for(let e=0;e<s;e++){let e;e=0===t?1===r?o.shape1:o.shape2:1===r?{x:o.shape1.x+(Math.random()-.5)*f}:{x:o.shape2.x+(Math.random()-.5)*f,y:o.shape2.y+(Math.random()-.5)*f},i.push(e),l[c]=e,c+=1,t+=1}}}}}return{pointsChanged:!0,newPoints:l,points:i}}}function Lr(t,e,n,i,o){const r=this,s=new dr(e),a=new Ao(s),l=new So(s),c=new Mo(s),h=new Dr(s,c);r.election=s;const u={one:new Nr(t,e,n,a,c,r),sample:new to(t,e,n,l,h,r),base:new Ct(t,n,r)};r.sims=u,r.voterShapeAdd=new lo(t,o,n,i,u,r),r.candidateAdd=new go(t,o,n,i,u,r),r.candidateDnAdd=new xo(t,o,n,i,u,r),r.voterTest=new Co(t,u,r),r.testVote=()=>u[r.state].testVoteSim(),r.candidateAdd.addCandidate({x:50,y:100},{x:50},"#e05020",!0),r.candidateAdd.addCandidate({x:100,y:50},{x:100},"#50e020",!0),r.candidateAdd.addCandidate({x:200,y:250},{x:200},"#2050e0",!0),r.candidateDnAdd.addCandidateDistribution({x:150,y:150,w:200},{x:150,w:200,densityProfile:"gaussian"},!0),r.voterShapeAdd.addVoterCircle({x:50,y:150,w:200},{x:50,w:200,densityProfile:"gaussian"},!0),r.voterShapeAdd.addVoterCircle({x:250,y:150,w:200},{x:250,w:200,densityProfile:"gaussian"},!0),r.state="one",r.viz="one",r.geo=!1,r.election.setDimensions(2),n.add(["geo","dimensions","viz"]),r.update=()=>{n.check(["geo","dimensions","viz","electionMethod"])&&(Object.keys(u).forEach((t=>u[t].exit())),r.state="one"===r.viz?"one":"sample",u[r.state].enter()),u[r.state].update()},r.renderForeground=()=>{u[r.state].renderForeground()},r.render=()=>{u[r.state].render()},r.setShowNonExistingEntities=t=>{r.showGhosts=t,n.add(["showGhosts"])},function(t){const e=document.createElement("div");e.setAttribute("class","button-group-label2"),e.innerText="Sim Controls:",t.newElement("simControlsLabel",e)}(o);e.addMenuItem(r,{label:"Viz:",prop:"viz",setProp:t=>{r.viz=t},options:[{name:"One Election",value:"one"},{name:"Sample Elections",value:"sample"}],change:["viz"]});e.addMenuItem(r,{label:"Geo:",prop:"geo",setProp:t=>{r.geo=t},options:[{name:"On",value:!0},{name:"Off",value:!1}],change:["geo"]});e.addMenuItem(r.election,{label:"Dimensions:",prop:"dimensions",setProp:t=>{r.election.setDimensions(t)},options:[{name:"1D",value:1},{name:"2D",value:2}],change:["dimensions"]})}function Ir(t){const e={},n=[];this.newElement=(i,o)=>{t.includes(i)?e[i]=o:n.push(o)},this.makeComponent=()=>{const i=document.createElement("div");return t.forEach((t=>{const n=e[t];void 0!==n&&i.appendChild(n)})),n.forEach((t=>{i.appendChild(t)})),i}}function Rr(t){const e=this,n=[];e.addSender=e=>{const{name:i,action:o,props:r}=e;n[i]=o;const s=t=>({name:i,value:t,props:r});return{command:s,go:e=>t.do(s(e))}},e.addSenderForList=e=>{const{name:i,action:o,props:r}=e;n[i]=o;const s=(t,e,n)=>({name:i,id:t,value:e,props:r,currentValue:n});return{command:s,go:(e,n,i)=>t.do(s(e,n,i))}},e.execute=t=>{const{name:e,id:i,value:o}=t,r=n[e];void 0!==i?r(i,o):r(o)}}function Vr(t){const e=this,n={},i=[];e.addSender=t=>{const{name:e,currentValue:o,props:r}=t;void 0!==r&&r.isFirstAction&&(i[e]=!0),n[e]=o},e.addSenderForList=t=>{const{name:e,props:o}=t;void 0!==o&&o.isFirstAction&&(i[e]=!0),n[e]=[];return t=>n[e][t]},e.execute=t=>{const{name:e,id:i,value:o}=t;void 0!==i?n[e][i]=o:n[e]=o},e.makeUndo=t=>{const{name:e,id:i,props:o}=t;let r;void 0===i?r=n[e]:(r=n[e][i],void 0===r&&(r=t.currentValue));return{name:e,id:i,value:r,props:o}},e.passLoadConfig=t=>{e.loadConfigPriority(t,"high"),e.loadConfigPriority(t,"low")},e.loadConfigPriority=(e,n)=>{Object.keys(e).forEach((o=>{const r=void 0!==i[o];if("low"===n&&r)return;if("high"===n&&!r)return;const s=e[o];if(s instanceof Array)s.forEach(((e,n)=>{const i={name:o,id:n,value:e};t.execute(i)}));else{const e={name:o,value:s};t.execute(e)}}))},e.passLoadCommands=e=>{e.forEach((e=>{t.execute(e)}))},e.getConfig=()=>structuredClone(n)}function Or(t){const e=this,n=[];let i=-1;e.clearHistory=()=>{n.splice(0,n.length),i=-1},e.passDo=e=>{const o=t.makeUndo(e);n.splice(i+1,n.length-(i+1)),t.execute(e),n.push([{command:e,undoCommand:o}]),i+=1},e.passDoCommands=e=>{n.splice(i+1,n.length-(i+1));const o=[];e.forEach((e=>{const n=t.makeUndo(e);o.push({command:e,undoCommand:n}),t.execute(e)})),n.push(o),i+=1};let o=setTimeout((()=>null),30);e.undo=()=>{if(-1===i)return;const r=n[i];r.forEach((e=>{t.execute(e.undoCommand)})),i-=1;const{undoCommand:s}=r[0];if(void 0===s.props)return;if(!0!==s.props.isChain)return;if(-1===i)return;n[i][0].undoCommand.name===s.name&&(clearTimeout(o),o=setTimeout(e.undo,30))},e.redo=()=>{if(i===n.length-1)return;const r=n[i+1];r.forEach((e=>t.execute(e.command))),i+=1;const{command:s}=r[0];if(void 0===s.props)return;if(!0!==s.props.isChain)return;if(i===n.length-1)return;n[i+1][0].command.name===s.name&&(clearTimeout(o),o=setTimeout(e.redo,30))}}function Br(t){const e=this,n=new Rr(e),i=new Vr(e),o=new Or(e);t.addCommander(e),e.addSender=t=>{i.addSender(t);return n.addSender(t)},e.addSenderForList=t=>{const e=n.addSenderForList(t);return e.getCurrentValue=i.addSenderForList(t),e},e.execute=t=>{i.execute(t),n.execute(t)},e.makeUndo=i.makeUndo,e.passLoadConfig=i.passLoadConfig,e.passLoadCommands=i.passLoadCommands,e.getConfig=i.getConfig,e.loadConfig=n=>{t.broadcastLoadConfig(n,e)},e.loadCommands=n=>{t.broadCastLoadCommands(n,e)},e.do=n=>{t.broadcastDo(n,e)},e.doCommands=n=>{t.broadcastDoCommands(n,e)},e.passDo=o.passDo,e.passDoCommands=o.passDoCommands,e.undo=o.undo,e.redo=o.redo,e.clearHistory=o.clearHistory}function qr(t,e){const n=document.createElement("button");n.className="button2",n.innerText="Save Config To Text";const i=document.createElement("textarea");n.onclick=()=>{const t=e.getConfig();var n;i.value=(n=t,JSON.stringify(ft(n),null,"\t"))};const o=document.createElement("div"),r=document.createElement("div");r.appendChild(n),r.appendChild(o),r.appendChild(i),t.newElement("saveConfigToText",r)}function Gr(t,e,n){const i=document.createElement("button");i.className="button2",i.innerText="Save Link";const o=document.createElement("button");o.className="button2",o.innerText="Copy Link to Clipboard";const r=document.createElement("textarea");function s(){const t=e.getConfig(),i=JSON.stringify(t),o=encodeURIComponent(i),r=new URLSearchParams({a:o}).toString();return`${function(){const t=document.location.href.split("/"),e=t.slice(0,t.length-1);return e.join("/")}()}/${n}?${r}`}i.onclick=()=>{const t=s();r.value=t},o.onclick=()=>{const t=s();navigator.clipboard.writeText(t)};const a=document.createElement("div"),l=document.createElement("div");l.appendChild(i),l.appendChild(o),l.appendChild(a),l.appendChild(r),t.newElement("saveConfigToLink",l)}function jr(t,n,o){const r=new e,s=new Ir(["menu","simControlsLabel","undo","redo","addVoter","addCandidate","addCandidateDistribution","screenWrap","maps","saveConfigToLink","saveConfigToText","loadConfigText","svgUIDiv"]),a=new Br(n),l=new x(r,s,a);!function(t,e){const n=document.createElement("button"),i=document.createElement("button");n.className="button2",i.className="button2",n.innerText="Undo",i.innerText="Redo",n.onclick=e.undo,i.onclick=e.redo,t.newElement("undo",n),t.newElement("redo",i)}(s,a),Gr(s,a,o),qr(s,a),function(t,e){const n=document.createElement("button");n.className="button2",n.innerText="Load Config Text";const i=document.createElement("textarea");n.onclick=()=>{if(""===i.value)return;const t=JSON.parse(i.value);e.loadConfig(t)};const o=document.createElement("div"),r=document.createElement("div");r.appendChild(n),r.appendChild(o),r.appendChild(i),t.newElement("loadConfigText",r)}(s,a);const c=new i(300,300,s);p(c,(function(){c.clear(),c.clearMaps(),c.clearForeground(),h.render(),h.renderForeground()}),s);const h=new Lr(c,l,r,a,s);a.loadConfig(t),a.clearHistory();const u=s.makeComponent();return window.requestAnimationFrame((function t(){h.update(),c.clearForeground(),h.renderForeground(),window.requestAnimationFrame(t)})),u}function Hr(){const{search:t}=window.location,e=new URLSearchParams(t),n=e.has("a"),i=n?function(t){const e=t.get("a"),n=decodeURIComponent(e);return JSON.parse(n)}(e):{};return{yes:n,config:i}}Array.from(document.getElementsByClassName("sandbox")).forEach((e=>{const n=void 0!==e.dataset.config?JSON.parse(e.dataset.config):{},i=Hr(),o=i.yes?i.config:n,r=void 0!==e.dataset.sandboxurl?e.dataset.sandboxurl:"",s=jr(o,new t,r);e.parentNode.appendChild(s)})),Array.from(document.getElementsByClassName("double_sandbox")).forEach((e=>{const n=function(e,n){const i=new t,o=document.createElement("button");o.className="button2",o.innerText="linked",o.style["vertical-align"]="middle",o.style["min-width"]="70px",o.style.margin="5px",o.onclick=()=>{"linked"===o.innerText?(o.innerText="unlinked",i.setLinked(!1)):(o.innerText="linked",i.setLinked(!0))};const r=jr(e,i,n),s=jr(e,i,n);r.style.display="inline-block",s.style.display="inline-block",r.style["vertical-align"]="top",s.style["vertical-align"]="top";const a=document.createElement("div");return a.appendChild(r),a.appendChild(o),a.appendChild(s),a}(void 0!==e.dataset.config?JSON.parse(e.dataset.config):{},void 0!==e.dataset.sandboxurl?e.dataset.sandboxurl:"");e.parentNode.appendChild(n)}))})();
//# sourceMappingURL=addSandboxes.js.map
