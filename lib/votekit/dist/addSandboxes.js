(()=>{class t{constructor(){this.linked=!0,this.commanders=[],this.protect=!1}setLinked(t){this.linked=t}addCommander(t){this.commanders.push(t)}broadcastDo(t,e){this.linked&&!1===this.protect?(this.protect=!0,this.commanders.forEach((e=>e.passDo(t))),this.protect=!1):e.passDo(t)}broadcastDoCommands(t,e){this.linked&&!1===this.protect?(this.protect=!0,this.commanders.forEach((e=>e.passDoCommands(t))),this.protect=!1):e.passDoCommands(t)}broadcastLoadConfig(t,e){this.linked&&!1===this.protect?(this.protect=!0,this.commanders.forEach((e=>e.passLoadConfig(t))),this.protect=!1):e.passLoadConfig(t)}broadCastLoadCommands(t,e){this.linked&&!1===this.protect?(this.protect=!0,this.commanders.forEach((e=>e.passLoadCommands(t))),this.protect=!1):e.passLoadCommands(t)}}function e(){const t=this,e=["init"];t.add=t=>{t.forEach((t=>e.push(t)))},t.check=t=>{let n=0;return t.forEach((t=>{n+=e.includes(t)?1:0})),n>0},t.checkNone=()=>0===e.length,t.clear=()=>{e.splice(0,e.length)}}function n(){const t=this;t.handlers={start:()=>{},move:()=>{},end:()=>{},touchmove:()=>{},touchstart:()=>{},touchend:()=>{}},t.set=e=>{Object.assign(t.handlers,e)}}function i(t,e,i){const o=this;o.width=t,o.height=e,o.canvas=document.createElement("canvas"),o.canvas.setAttribute("class","background"),o.ctx=o.canvas.getContext("2d"),o.tooltips=document.createElement("div"),o.tooltips.setAttribute("class","tooltips"),o.foreground=document.createElement("canvas"),o.foreground.setAttribute("class","foreground"),o.fctx=o.foreground.getContext("2d"),o.geoMaps=document.createElement("canvas"),o.geoMaps.setAttribute("class","geoMaps"),o.gctx=o.geoMaps.getContext("2d");const r=document.createElement("div");i.newElement("clearDiv",r),i.newElement("screen",o.canvas),i.newElement("tooltips",o.tooltips),i.newElement("foreground",o.foreground),i.newElement("geoMaps",o.geoMaps),o.noBuffers=!1,o.pixelRatio=function(t){const e=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/e}(o.ctx),o.canvas.width=t*o.pixelRatio,o.canvas.height=e*o.pixelRatio,o.canvas.style.width=`${t}px`,o.canvas.style.height=`${e}px`,o.tooltips.style.width=`${t}px`,o.tooltips.style.height="0px",o.foreground.width=t*o.pixelRatio,o.foreground.height=e*o.pixelRatio,o.foreground.style.width=`${t}px`,o.foreground.style.height=`${e}px`;const s=Math.round(e/3);o.geoMaps.width=t*o.pixelRatio,o.geoMaps.height=s*o.pixelRatio,o.geoMaps.style.width=`${t}px`,o.geoMaps.style.height=`${s}px`,o.ctx.scale(o.pixelRatio,o.pixelRatio),o.fctx.scale(o.pixelRatio,o.pixelRatio),o.gctx.scale(o.pixelRatio,o.pixelRatio),o.clear=function(){o.ctx.clearRect(0,0,o.canvas.width,o.canvas.height)},o.clearForeground=function(){o.fctx.clearRect(0,0,o.canvas.width,o.canvas.height)},o.setCtx=function(t){o.ctx=t},o.setFCtx=function(t){o.fctx=t},o.setGCtx=function(t){o.gctx=t},o.setNoBuffers=function(t){o.noBuffers=t},o.showGeoMaps=()=>{o.geoMaps.style.display="block"},o.hideGeoMaps=()=>{o.geoMaps.style.display="none"},o.eventHandlers=new n;const{handlers:a}=o.eventHandlers;o.foreground.onmousedown=t=>a.start(t),o.foreground.onmousemove=t=>a.move(t),o.foreground.onmouseup=t=>a.end(t),o.foreground.addEventListener("touchmove",(t=>a.touchmove(t))),o.foreground.addEventListener("touchstart",(t=>a.touchstart(t))),o.foreground.addEventListener("touchend",(t=>a.touchend(t)));const c=document.onmouseup;document.onmouseup=t=>{c&&c(t),o.foreground.onmouseup(t)}}var o,r,s,a=(o=function(t){!function(){var e,n,i,o,r;function s(t,e){var n,i=Object.keys(e);for(n=0;n<i.length;n++)t=t.replace(new RegExp("\\{"+i[n]+"\\}","gi"),e[i[n]]);return t}function a(t){var e,n,i;if(!t)throw new Error("cannot create a random attribute name for an undefined object");e="ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",n="";do{for(n="",i=0;i<12;i++)n+=e[Math.floor(Math.random()*e.length)]}while(t[n]);return n}function c(t){var e={alphabetic:"alphabetic",hanging:"hanging",top:"text-before-edge",bottom:"text-after-edge",middle:"central"};return e[t]||e.alphabetic}r=function(t,e){var n,i,o,r={};for(t=t.split(","),e=e||10,n=0;n<t.length;n+=2)i="&"+t[n+1]+";",o=parseInt(t[n],e),r[i]="&#"+o+";";return r["\\xa0"]="&#160;",r}("50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro",32),e={strokeStyle:{svgAttr:"stroke",canvas:"#000000",svg:"none",apply:"stroke"},fillStyle:{svgAttr:"fill",canvas:"#000000",svg:null,apply:"fill"},lineCap:{svgAttr:"stroke-linecap",canvas:"butt",svg:"butt",apply:"stroke"},lineJoin:{svgAttr:"stroke-linejoin",canvas:"miter",svg:"miter",apply:"stroke"},miterLimit:{svgAttr:"stroke-miterlimit",canvas:10,svg:4,apply:"stroke"},lineWidth:{svgAttr:"stroke-width",canvas:1,svg:1,apply:"stroke"},globalAlpha:{svgAttr:"opacity",canvas:1,svg:1,apply:"fill stroke"},font:{canvas:"10px sans-serif"},shadowColor:{canvas:"#000000"},shadowOffsetX:{canvas:0},shadowOffsetY:{canvas:0},shadowBlur:{canvas:0},textAlign:{canvas:"start"},textBaseline:{canvas:"alphabetic"}},(i=function(t,e){this.__root=t,this.__ctx=e}).prototype.addColorStop=function(t,e){var n,i=this.__ctx.__createElement("stop");i.setAttribute("offset",t),-1!==e.indexOf("rgba")?(n=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi.exec(e),i.setAttribute("stop-color",s("rgb({r},{g},{b})",{r:n[1],g:n[2],b:n[3]})),i.setAttribute("stop-opacity",n[4])):i.setAttribute("stop-color",e),this.__root.appendChild(i)},o=function(t,e){this.__root=t,this.__ctx=e},n=function(t){var e,i={width:500,height:500,enableMirroring:!1};if(arguments.length>1?((e=i).width=arguments[0],e.height=arguments[1]):e=t||i,!(this instanceof n))return new n(e);this.width=e.width||i.width,this.height=e.height||i.height,this.enableMirroring=void 0!==e.enableMirroring?e.enableMirroring:i.enableMirroring,this.canvas=this,this.__document=e.document||document,this.__canvas=this.__document.createElement("canvas"),this.__ctx=this.__canvas.getContext("2d"),this.__setDefaultStyles(),this.__stack=[this.__getStyleState()],this.__groupStack=[],this.__root=this.__document.createElementNS("http://www.w3.org/2000/svg","svg"),this.__root.setAttribute("version",1.1),this.__root.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.__root.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),this.__root.setAttribute("width",this.width),this.__root.setAttribute("height",this.height),this.__ids={},this.__defs=this.__document.createElementNS("http://www.w3.org/2000/svg","defs"),this.__root.appendChild(this.__defs),this.__currentElement=this.__document.createElementNS("http://www.w3.org/2000/svg","g"),this.__root.appendChild(this.__currentElement)},n.prototype.__createElement=function(t,e,n){void 0===e&&(e={});var i,o,r=this.__document.createElementNS("http://www.w3.org/2000/svg",t),s=Object.keys(e);for(n&&(r.setAttribute("fill","none"),r.setAttribute("stroke","none")),i=0;i<s.length;i++)o=s[i],r.setAttribute(o,e[o]);return r},n.prototype.__setDefaultStyles=function(){var t,n,i=Object.keys(e);for(t=0;t<i.length;t++)this[n=i[t]]=e[n].canvas},n.prototype.__applyStyleState=function(t){var e,n,i=Object.keys(t);for(e=0;e<i.length;e++)this[n=i[e]]=t[n]},n.prototype.__getStyleState=function(){var t,n,i={},o=Object.keys(e);for(t=0;t<o.length;t++)i[n=o[t]]=this[n];return i},n.prototype.__applyStyleToCurrentElement=function(t){var n,r,a,c,l,d=Object.keys(e);for(n=0;n<d.length;n++)if(r=e[d[n]],a=this[d[n]],r.apply)if(-1!==r.apply.indexOf("fill")&&a instanceof o){if(a.__ctx)for(;a.__ctx.__defs.childNodes.length;)c=a.__ctx.__defs.childNodes[0].getAttribute("id"),this.__ids[c]=c,this.__defs.appendChild(a.__ctx.__defs.childNodes[0]);this.__currentElement.setAttribute("fill",s("url(#{id})",{id:a.__root.getAttribute("id")}))}else-1!==r.apply.indexOf("fill")&&a instanceof i?this.__currentElement.setAttribute("fill",s("url(#{id})",{id:a.__root.getAttribute("id")})):-1!==r.apply.indexOf(t)&&r.svg!==a&&("stroke"!==r.svgAttr&&"fill"!==r.svgAttr||-1===a.indexOf("rgba")?this.__currentElement.setAttribute(r.svgAttr,a):(l=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi.exec(a),this.__currentElement.setAttribute(r.svgAttr,s("rgb({r},{g},{b})",{r:l[1],g:l[2],b:l[3]})),this.__currentElement.setAttribute(r.svgAttr+"-opacity",l[4])))},n.prototype.__closestGroupOrSvg=function(t){return"g"===(t=t||this.__currentElement).nodeName||"svg"===t.nodeName?t:this.__closestGroupOrSvg(t.parentNode)},n.prototype.getSerializedSvg=function(t){var e,n,i,o,s,a=(new XMLSerializer).serializeToString(this.__root);if(/xmlns="http:\/\/www\.w3\.org\/2000\/svg".+xmlns="http:\/\/www\.w3\.org\/2000\/svg/gi.test(a)&&(a=a.replace('xmlns="http://www.w3.org/2000/svg','xmlns:xlink="http://www.w3.org/1999/xlink')),t)for(e=Object.keys(r),n=0;n<e.length;n++)i=e[n],o=r[i],(s=new RegExp(i,"gi")).test(a)&&(a=a.replace(s,o));return a},n.prototype.getSvg=function(){return this.__root},n.prototype.save=function(){var t=this.__createElement("g"),e=this.__closestGroupOrSvg();this.__groupStack.push(e),e.appendChild(t),this.__currentElement=t,this.__stack.push(this.__getStyleState())},n.prototype.restore=function(){this.__currentElement=this.__groupStack.pop();var t=this.__stack.pop();this.__applyStyleState(t)},n.prototype.__addTransform=function(t){var e=this.__closestGroupOrSvg();if(e.childNodes.length>0){var n=this.__createElement("g");e.appendChild(n),this.__currentElement=n}var i=this.__currentElement.getAttribute("transform");i?i+=" ":i="",i+=t,this.__currentElement.setAttribute("transform",i)},n.prototype.scale=function(t,e){void 0===e&&(e=t),this.__addTransform(s("scale({x},{y})",{x:t,y:e}))},n.prototype.rotate=function(t){var e=180*t/Math.PI;this.__addTransform(s("rotate({angle},{cx},{cy})",{angle:e,cx:0,cy:0}))},n.prototype.translate=function(t,e){this.__addTransform(s("translate({x},{y})",{x:t,y:e}))},n.prototype.transform=function(t,e,n,i,o,r){this.__addTransform(s("matrix({a},{b},{c},{d},{e},{f})",{a:t,b:e,c:n,d:i,e:o,f:r}))},n.prototype.beginPath=function(){var t;this.__currentDefaultPath="",this.__currentPosition={},t=this.__createElement("path",{},!0),this.__closestGroupOrSvg().appendChild(t),this.__currentElement=t},n.prototype.__applyCurrentDefaultPath=function(){if("path"!==this.__currentElement.nodeName)throw new Error("Attempted to apply path command to node "+this.__currentElement.nodeName);var t=this.__currentDefaultPath;this.__currentElement.setAttribute("d",t)},n.prototype.__addPathCommand=function(t){this.__currentDefaultPath+=" ",this.__currentDefaultPath+=t},n.prototype.moveTo=function(t,e){"path"!==this.__currentElement.nodeName&&this.beginPath(),this.__currentPosition={x:t,y:e},this.__addPathCommand(s("M {x} {y}",{x:t,y:e}))},n.prototype.closePath=function(){this.__addPathCommand("Z")},n.prototype.lineTo=function(t,e){this.__currentPosition={x:t,y:e},this.__currentDefaultPath.indexOf("M")>-1?this.__addPathCommand(s("L {x} {y}",{x:t,y:e})):this.__addPathCommand(s("M {x} {y}",{x:t,y:e}))},n.prototype.bezierCurveTo=function(t,e,n,i,o,r){this.__currentPosition={x:o,y:r},this.__addPathCommand(s("C {cp1x} {cp1y} {cp2x} {cp2y} {x} {y}",{cp1x:t,cp1y:e,cp2x:n,cp2y:i,x:o,y:r}))},n.prototype.quadraticCurveTo=function(t,e,n,i){this.__currentPosition={x:n,y:i},this.__addPathCommand(s("Q {cpx} {cpy} {x} {y}",{cpx:t,cpy:e,x:n,y:i}))};var l=function(t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]);return[t[0]/e,t[1]/e]};n.prototype.arcTo=function(t,e,n,i,o){var r=this.__currentPosition&&this.__currentPosition.x,s=this.__currentPosition&&this.__currentPosition.y;if(void 0!==r&&void 0!==s){if(o<0)throw new Error("IndexSizeError: The radius provided ("+o+") is negative.");if(r===t&&s===e||t===n&&e===i||0===o)this.lineTo(t,e);else{var a=l([r-t,s-e]),c=l([n-t,i-e]);if(a[0]*c[1]!=a[1]*c[0]){var d=a[0]*c[0]+a[1]*c[1],u=Math.acos(Math.abs(d)),h=l([a[0]+c[0],a[1]+c[1]]),p=o/Math.sin(u/2),f=t+p*h[0],m=e+p*h[1],g=[-a[1],a[0]],_=[c[1],-c[0]],y=function(t){var e=t[0];return t[1]>=0?Math.acos(e):-Math.acos(e)},w=y(g),x=y(_);this.lineTo(f+g[0]*o,m+g[1]*o),this.arc(f,m,o,w,x)}else this.lineTo(t,e)}}},n.prototype.stroke=function(){"path"===this.__currentElement.nodeName&&this.__currentElement.setAttribute("paint-order","fill stroke markers"),this.__applyCurrentDefaultPath(),this.__applyStyleToCurrentElement("stroke")},n.prototype.fill=function(){"path"===this.__currentElement.nodeName&&this.__currentElement.setAttribute("paint-order","stroke fill markers"),this.__applyCurrentDefaultPath(),this.__applyStyleToCurrentElement("fill")},n.prototype.rect=function(t,e,n,i){"path"!==this.__currentElement.nodeName&&this.beginPath(),this.moveTo(t,e),this.lineTo(t+n,e),this.lineTo(t+n,e+i),this.lineTo(t,e+i),this.lineTo(t,e),this.closePath()},n.prototype.fillRect=function(t,e,n,i){var o;o=this.__createElement("rect",{x:t,y:e,width:n,height:i},!0),this.__closestGroupOrSvg().appendChild(o),this.__currentElement=o,this.__applyStyleToCurrentElement("fill")},n.prototype.strokeRect=function(t,e,n,i){var o;o=this.__createElement("rect",{x:t,y:e,width:n,height:i},!0),this.__closestGroupOrSvg().appendChild(o),this.__currentElement=o,this.__applyStyleToCurrentElement("stroke")},n.prototype.clearRect=function(t,e,n,i){var o,r=this.__closestGroupOrSvg();o=this.__createElement("rect",{x:t,y:e,width:n,height:i,fill:"#FFFFFF"},!0),r.appendChild(o)},n.prototype.createLinearGradient=function(t,e,n,o){var r=this.__createElement("linearGradient",{id:a(this.__ids),x1:t+"px",x2:n+"px",y1:e+"px",y2:o+"px",gradientUnits:"userSpaceOnUse"},!1);return this.__defs.appendChild(r),new i(r,this)},n.prototype.createRadialGradient=function(t,e,n,o,r,s){var c=this.__createElement("radialGradient",{id:a(this.__ids),cx:o+"px",cy:r+"px",r:s+"px",fx:t+"px",fy:e+"px",gradientUnits:"userSpaceOnUse"},!1);return this.__defs.appendChild(c),new i(c,this)},n.prototype.__parseFont=function(){var t=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-,\"\sa-z]+?)\s*$/i.exec(this.font),e={style:t[1]||"normal",size:t[4]||"10px",family:t[6]||"sans-serif",weight:t[3]||"normal",decoration:t[2]||"normal",href:null};return"underline"===this.__fontUnderline&&(e.decoration="underline"),this.__fontHref&&(e.href=this.__fontHref),e},n.prototype.__wrapTextLink=function(t,e){if(t.href){var n=this.__createElement("a");return n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t.href),n.appendChild(e),n}return e},n.prototype.__applyText=function(t,e,n,i){var o,r,s=this.__parseFont(),a=this.__closestGroupOrSvg(),l=this.__createElement("text",{"font-family":s.family,"font-size":s.size,"font-style":s.style,"font-weight":s.weight,"text-decoration":s.decoration,x:e,y:n,"text-anchor":(o=this.textAlign,r={left:"start",right:"end",center:"middle",start:"start",end:"end"},r[o]||r.start),"dominant-baseline":c(this.textBaseline)},!0);l.appendChild(this.__document.createTextNode(t)),this.__currentElement=l,this.__applyStyleToCurrentElement(i),a.appendChild(this.__wrapTextLink(s,l))},n.prototype.fillText=function(t,e,n){this.__applyText(t,e,n,"fill")},n.prototype.strokeText=function(t,e,n){this.__applyText(t,e,n,"stroke")},n.prototype.measureText=function(t){return this.__ctx.font=this.font,this.__ctx.measureText(t)},n.prototype.arc=function(t,e,n,i,o,r){if(i!==o){(i%=2*Math.PI)==(o%=2*Math.PI)&&(o=(o+2*Math.PI-.001*(r?-1:1))%(2*Math.PI));var a=t+n*Math.cos(o),c=e+n*Math.sin(o),l=t+n*Math.cos(i),d=e+n*Math.sin(i),u=r?0:1,h=0,p=o-i;p<0&&(p+=2*Math.PI),h=r?p>Math.PI?0:1:p>Math.PI?1:0,this.lineTo(l,d),this.__addPathCommand(s("A {rx} {ry} {xAxisRotation} {largeArcFlag} {sweepFlag} {endX} {endY}",{rx:n,ry:n,xAxisRotation:0,largeArcFlag:h,sweepFlag:u,endX:a,endY:c})),this.__currentPosition={x:a,y:c}}},n.prototype.clip=function(){var t=this.__closestGroupOrSvg(),e=this.__createElement("clipPath"),n=a(this.__ids),i=this.__createElement("g");t.removeChild(this.__currentElement),e.setAttribute("id",n),e.appendChild(this.__currentElement),this.__defs.appendChild(e),t.setAttribute("clip-path",s("url(#{id})",{id:n})),t.appendChild(i),this.__currentElement=i},n.prototype.drawImage=function(){var t,e,i,o,r,s,a,c,l,d,u,h,p,f,m=Array.prototype.slice.call(arguments),g=m[0],_=0,y=0;if(3===m.length)t=m[1],e=m[2],i=r=g.width,o=s=g.height;else if(5===m.length)t=m[1],e=m[2],i=m[3],o=m[4],r=g.width,s=g.height;else{if(9!==m.length)throw new Error("Inavlid number of arguments passed to drawImage: "+arguments.length);_=m[1],y=m[2],r=m[3],s=m[4],t=m[5],e=m[6],i=m[7],o=m[8]}if(a=this.__closestGroupOrSvg(),u=this.__currentElement,g instanceof n){for(l=(c=g.getSvg()).childNodes[0];l.childNodes.length;)f=l.childNodes[0].getAttribute("id"),this.__ids[f]=f,this.__defs.appendChild(l.childNodes[0]);d=c.childNodes[1],a.appendChild(d),this.__currentElement=d,this.translate(t,e),this.__currentElement=u}else"CANVAS"!==g.nodeName&&"IMG"!==g.nodeName||((h=this.__createElement("image")).setAttribute("width",i),h.setAttribute("height",o),h.setAttribute("preserveAspectRatio","none"),(_||y||r!==g.width||s!==g.height)&&((p=this.__document.createElement("canvas")).width=i,p.height=o,p.getContext("2d").drawImage(g,_,y,r,s,0,0,i,o),g=p),h.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","CANVAS"===g.nodeName?g.toDataURL():g.getAttribute("src")),a.appendChild(h),this.__currentElement=h,this.translate(t,e),this.__currentElement=u)},n.prototype.createPattern=function(t,e){var i,r=this.__document.createElementNS("http://www.w3.org/2000/svg","pattern"),s=a(this.__ids);return r.setAttribute("id",s),r.setAttribute("width",t.width),r.setAttribute("height",t.height),"CANVAS"===t.nodeName||"IMG"===t.nodeName?((i=this.__document.createElementNS("http://www.w3.org/2000/svg","image")).setAttribute("width",t.width),i.setAttribute("height",t.height),i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","CANVAS"===t.nodeName?t.toDataURL():t.getAttribute("src")),r.appendChild(i),this.__defs.appendChild(r)):t instanceof n&&(r.appendChild(t.__root.childNodes[1]),this.__defs.appendChild(r)),new o(r,this)},n.prototype.drawFocusRing=function(){},n.prototype.createImageData=function(){},n.prototype.getImageData=function(){},n.prototype.putImageData=function(){},n.prototype.globalCompositeOperation=function(){},n.prototype.setTransform=function(){},"object"==typeof window&&(window.C2S=n),t.exports=n}()},o(s={path:r,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&s.path)}},s.exports),s.exports),c=a;function l(t,e,n){const i=t.width,o=t.height,r=document.createElement("div");n.newElement("svgUIDiv",r);const s=document.createElement("button");s.className="button2",s.innerText="Make SVG",s.onclick=function(){const n=t.ctx,i=t.fctx;t.setCtx(p),t.setFCtx(p),t.setNoBuffers(!0),e(),function(){d.hidden=!1;const t=p.getSerializedSvg(!0);u.innerHTML=t,u.hidden=!1,a.hidden=!1;const e=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(t)}`;a.href=e}(),t.setCtx(n),t.setFCtx(i),t.setNoBuffers(!1);const o=t.gctx;t.setGCtx(f),e(),function(){const t=f.getSerializedSvg(!0);h.innerHTML=t,h.hidden=!1,l.hidden=!1;const e=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(t)}`;l.href=e}(),t.setGCtx(o)},r.appendChild(s);const a=document.createElement("a");a.innerText="Download SVG",a.download="vote.svg",a.hidden=!0,a.style.margin="4px",r.appendChild(a);const l=document.createElement("a");l.innerText="Download geoMap SVG",l.download="vote_geoMap.svg",l.hidden=!0,l.style.margin="4px",r.appendChild(l);const d=document.createElement("button");d.className="button2",d.innerText="Hide SVG",d.hidden=!0,d.onclick=function(){d.hidden=!0,u.hidden=!0,a.hidden=!0,h.hidden=!0,l.hidden=!0},r.appendChild(d);const u=document.createElement("div");u.setAttribute("class","svgDiv"),u.style.width=`${i}px`,u.style.height=`${o}px`,u.hidden=!0,r.appendChild(u);const h=document.createElement("div");h.setAttribute("class","gSvgDiv"),h.style.width=`${i}px`,h.style.height=`${Math.round(o/3)}px`,h.hidden=!0,r.appendChild(h);const p=new c(i,o),f=new c(i,Math.round(o/3))}function d(t,e){const n=this;n.config=t,n.name=t.name,n.nameIsHTML=t.nameIsHTML||!1,n.dom=document.createElement("div"),n.dom.setAttribute("class","button button2");let i=t.margin;i=i||0,i=Math.max(i,4),n.dom.style.marginRight=`${i}px`,n.draw=function(){n.nameIsHTML?n.dom.innerHTML=n.name:n.dom.innerText=n.name},n.draw(),n.dom.setAttribute("title",t.realname||""),n.onClick=function(){e(n,t)},n.dom.onclick=n.onClick,n.turnOff=function(){n.isOn=!1,n.config.isOn=!1,n.dom.setAttribute("on","no")},n.turnOn=function(){n.isOn=!0,n.config.isOn=!0,n.dom.setAttribute("on","yes")},n.turnOff()}function u(t){const e=this;e.config=t,void 0===t.data&&(t.data=[],void 0===t.makeData&&(t.makeData=()=>[]),e.makeData=t.makeData,e.buttonConfigs=e.makeData(),e.doMakeData=!0),e.buttonConfigs=t.data,e.labelName=t.label,e.labelIsHTML=t.labelIsHTML||!1,e.onChoose=t.onChoose,e.isCheckbox=t.isCheckbox||!1,e.isCheckboxBool=t.isCheckboxBool||!1,e.justButton=t.justButton||!1,e.buttonHidden=t.buttonHidden||{},e.dom=document.createElement("div"),e.dom.setAttribute("class","button-group"),e.buttonDOMByValue=[],e.init=function(){e.doMakeData&&(e.buttonConfigs=e.makeData()),e.dom.innerHTML="",e.buttons=[],e.buttonsByName={},e.labelDOM=document.createElement("div"),e.labelDOM.setAttribute("class","button-group-label"),e.draw(),e.dom.appendChild(e.labelDOM);for(let n=0;n<e.buttonConfigs.length;n++){const i=e.buttonConfigs[n],o=new d(i,e.onToggle);e.buttonsByName[i.name]=o,o.dom.style.width=`${t.width}px`,i.width&&(o.dom.style.width=`${i.width}px`),e.buttons.push(o),e.dom.appendChild(o.dom),e.buttonDOMByValue[i.value]=o.dom}for(let t=0;t<e.buttons.length;t++){const n=e.buttons[t];if(n.config.selected){n.turnOn();break}}e.draw()},e.updateNames=function(){const t=e.makeData();for(let n=0;n<e.buttonConfigs.length;n++)e.buttonConfigs[n].name=t[n].name,e.buttons[n].name=e.buttonConfigs[n].name},e.redraw=function(){e.updateNames(),e.draw()},e.draw=function(){e.labelIsHTML?e.labelDOM.innerHTML=e.labelName:e.labelDOM.innerText=e.labelName;for(const t of e.buttons)t.draw()},e.configureHidden=function(){for(const[t,n]of Object.entries(e.buttonHidden))e.buttonsByName[t].dom.hidden=n},e.onToggle=function(t,n){if(e.isCheckbox||e.isCheckboxBool)t.isOn?t.turnOff():t.turnOn();else{for(let t=0;t<e.buttons.length;t++)e.buttons[t].turnOff();t.turnOn(),e.justButton&&setTimeout((()=>t.turnOff()),800)}e.onChoose(n)},e.highlight=function(t,n){if(0!==e.buttons.length){for(let t=0;t<e.buttons.length;t++)e.buttons[t].turnOff();if(e.isCheckbox)for(const i in e.buttons){const o=e.buttons[i];n.includes(o.config[t])&&o.turnOn()}else if(e.isCheckboxBool)for(const i in e.buttons){const o=e.buttons[i],r=o.config[t];r in n&&n[r]&&o.turnOn()}else{const i=e.buttons.filter((e=>{const{config:i}=e;return i[t]===n}))[0];void 0!==i&&i.turnOn()}}},e.init()}function h(t,e,n,i,o,r,s,a){const c=this;c.list=o,c.onChoose=function(t){c.sender.go(t.value)},c.action=t=>{c.set(t),c.select()},c.sender=a.addSender({name:e,action:c.action,currentValue:t[e]}),c.set=function(t){n(t),c.configure(),s.add(r)},c.choose=new u({label:i,width:p(3),data:c.list,onChoose:c.onChoose}),c.configure=function(){},c.select=function(){c.choose.highlight("value",t[e])}}function p(t){return(302-18*(t-1)-10)/t}function f(t,e,n){const i=this;i.divMenu=document.createElement("div"),e.newElement("menu",i.divMenu),i.addMenuItem=function(e,o){const{prop:r,setProp:s,label:a,options:c,change:l}=o,d=new h(e,r,s,a,c,l,t,n);d.select(),i.divMenu.appendChild(d.choose.dom)}}function m(t){const e=function(t){const e=t.length,n=new Array(e);for(let i=0;i<e;i++){n[i]=[];for(let o=0;o<e;o++){if(i===o)continue;const e=t[i],r=t[o];n[i].push(g(e,r))}}return n}(t);this.sumArea=function(t){const n=e.length,i=Array(n);for(let o=0;o<n;o++){const n=e[o];i[o]=_(t,n)}return i}}function g(t,e){const n=e.x-t.x,i=e.y-t.y;return{A:{x:n,y:i},b:.5*(t.x+e.x)*n+.5*(t.y+e.y)*i}}function _(t,e){let n=0;const i=t.x,o=t.y,{w:r}=t,s=.5*r;for(let t=i-s;t<i+s;t+=2){const r=s**2-(t-i)**2;let a;a=r>0?Math.sqrt(r):0;let c=o+a,l=o-a;e.forEach((e=>{const n=e.A.y,i=e.A.x,{b:o}=e;if(0===n)i*t<o||(l=1/0);else{const e=(o-i*t)/n;n<0?l=Math.max(l,e):c=Math.min(c,e)}}));const d=c-l;if(d>0){n+=2*d}}return n}function y(t){return[...Array(t).keys()]}function w(t){return"object"==typeof t?Array.isArray(t)?t.map(w):Object.keys(t).sort().reduce(((e,n)=>{const i=t[n];return e[n]=w(i),e}),{}):t}function x(t,e,n){return t===1/0?1:t===-1/0?0:.5*function(t){const e=.147,n=t**2,i=1+e*n,o=-(4/Math.PI+e*n)/i*n,r=Math.exp(o),s=Math.sqrt(1-r);return s*Math.sign(t)}((t-e)/(n*Math.sqrt(2)))+.5}function v(t){const e=document.createElement("canvas"),n=e.getContext("2d");n.fillStyle=t;const i=n.fillStyle;return e.remove(),i}function b(t){const e=function(t){const e=t.length,n=y(e).sort(((e,n)=>t[e]-t[n])),i=new Array(e-1);for(let o=0;o<e-1;o++)i[o]=.5*(t[n[o]]+t[n[o+1]]);const o=new Array(e);for(let t=0;t<e;t++){const r=0===t?-1/0:i[t-1],s=t===e-1?1/0:i[t];o[n[t]]={lower:r,upper:s}}return o}(t);this.sumArea=function(n){const i=t.length,o=Array(i);if("gaussian"===n.densityProfile1)for(let t=0;t<i;t++)o[t]=S(n,e[t]);else for(let t=0;t<i;t++)o[t]=C(n,e[t]);return o}}function C(t,e){const{lower:n,upper:i}=e,{x:o,w:r}=t,s=.5*r,a=o-s,c=o+s,l=Math.max(n,a),d=Math.min(i,c);return Math.max(0,d-l)}function S(t,e){const{lower:n,upper:i}=e,{x:o,w:r}=t,s=o,a=r/Math.sqrt(2*Math.PI);return r*x(i,s,a)-r*x(n,s,a)}var E={pluralityBallot:function(t,e,n){const i=1===n?new b(t):new m(t),o=t.length;let r=new Array(o).fill(0);e.forEach((t=>{const e=i.sumArea(t),n=void 0===t.weight?1:t.weight;r=r.map(((t,i)=>t+e[i]*n))}));const s=r.reduce(((t,e)=>t+e));return{tallyFractions:r.map((t=>t/s))}}};const A={plurality:function(t){const e=Math.max(...t.tallyFractions);return{iWinner:t.tallyFractions.indexOf(e)}},randomWinner:function(t){const e=t.tallyFractions.length;return{iWinner:Math.floor(Math.random()*e)}},huntingtonHill:function(t,e){const{seats:n,threshold:i}=e,o=t.tallyFractions.map((t=>t<i?0:t)),r=o.length;if(0===i&&r>n){const e=[...o].sort(((t,e)=>e-t))[n-1];return{allocation:t.tallyFractions.map((t=>t>=e))}}const s=Array(n).fill().map(((t,e)=>Math.sqrt(e*(e+1)))),a=o.map((t=>0===t?1/0:s.map((e=>e/t)))).flat().flat().sort(((t,e)=>t-e))[n-1];return{allocation:o.map((t=>0===t?0:.5*(1+Math.sqrt(1+4*(t*a)**2)))).map((t=>Math.floor(t)))}}};var k=A;function M(t){const e=this;e.run=(t,n)=>{let i;if("allocation"===e.checkElectionType()){const o={seats:5,threshold:.2},r=k[e.electionMethod](n,o),{allocation:s}=r;i={allocation:s,candidates:t}}else{const o=k[e.electionMethod](n),{iWinner:r}=o;i={iWinner:r,winner:t[r]}}return i},e.electionMethodList=[{name:"Huntington Hill",value:"huntingtonHill",type:"allocation"},{name:"Plurality",value:"plurality",type:"singleWinner"},{name:"Random Winner",value:"randomWinner",type:"singleWinner"}],e.checkElectionType=()=>e.electionMethodListByFunctionName[e.electionMethod].type,e.electionMethodListByFunctionName=[],e.electionMethodList.forEach((t=>{e.electionMethodListByFunctionName[t.value]=t})),e.electionMethod="plurality",e.setElectionMethod=t=>{e.electionMethod=t},t.addMenuItem(e,{label:"Election Method:",prop:"electionMethod",setProp:e.setElectionMethod,options:e.electionMethodList,change:["electionMethod"]})}function P(t){const e=this;e.method=new M(t),e.dimensions=1,e.setDimensions=t=>{e.dimensions=t};const n=t=>1===e.dimensions?t.map((t=>({x:t.p1,w:t.w1,densityProfile1:t.densityProfile1}))):t.map((t=>({x:t.p2.x,y:t.p2.y,w:t.w2,densityProfile1:t.densityProfile1}))),i=t=>1===e.dimensions?t.map((t=>t.p1)):t.map((t=>t.p2));e.runElection=function(t,o){const r=n(t),s=i(o),a=E.pluralityBallot(s,r,e.dimensions);return{...e.method.run(o,a),votes:a}},e.castVotes=(t,o)=>{const r=t.getVoterGroups(),s=o.getCandidates(),a=n(r),c=i(s);return E.pluralityBallot(c,a,e.dimensions)}}const T=134217729;function F(t,e,n,i,o){let r,s,a,c,l=e[0],d=i[0],u=0,h=0;d>l==d>-l?(r=l,l=e[++u]):(r=d,d=i[++h]);let p=0;if(u<t&&h<n)for(d>l==d>-l?(s=l+r,a=r-(s-l),l=e[++u]):(s=d+r,a=r-(s-d),d=i[++h]),r=s,0!==a&&(o[p++]=a);u<t&&h<n;)d>l==d>-l?(s=r+l,c=s-r,a=r-(s-c)+(l-c),l=e[++u]):(s=r+d,c=s-r,a=r-(s-c)+(d-c),d=i[++h]),r=s,0!==a&&(o[p++]=a);for(;u<t;)s=r+l,c=s-r,a=r-(s-c)+(l-c),l=e[++u],r=s,0!==a&&(o[p++]=a);for(;h<n;)s=r+d,c=s-r,a=r-(s-c)+(d-c),d=i[++h],r=s,0!==a&&(o[p++]=a);return 0===r&&0!==p||(o[p++]=r),p}function D(t){return new Float64Array(t)}const L=D(4),N=D(8),I=D(12),O=D(16),V=D(4);function R(t,e,n,i,o,r){const s=(e-r)*(n-o),a=(t-o)*(i-r),c=s-a;if(0===s||0===a||s>0!=a>0)return c;const l=Math.abs(s+a);return Math.abs(c)>=33306690738754716e-32*l?c:-function(t,e,n,i,o,r,s){let a,c,l,d,u,h,p,f,m,g,_,y,w,x,v,b,C,S;const E=t-o,A=n-o,k=e-r,M=i-r;x=E*M,h=T*E,p=h-(h-E),f=E-p,h=T*M,m=h-(h-M),g=M-m,v=f*g-(x-p*m-f*m-p*g),b=k*A,h=T*k,p=h-(h-k),f=k-p,h=T*A,m=h-(h-A),g=A-m,C=f*g-(b-p*m-f*m-p*g),_=v-C,u=v-_,L[0]=v-(_+u)+(u-C),y=x+_,u=y-x,w=x-(y-u)+(_-u),_=w-b,u=w-_,L[1]=w-(_+u)+(u-b),S=y+_,u=S-y,L[2]=y-(S-u)+(_-u),L[3]=S;let P=function(t,e){let n=e[0];for(let i=1;i<t;i++)n+=e[i];return n}(4,L),D=22204460492503146e-32*s;if(P>=D||-P>=D)return P;if(u=t-E,a=t-(E+u)+(u-o),u=n-A,l=n-(A+u)+(u-o),u=e-k,c=e-(k+u)+(u-r),u=i-M,d=i-(M+u)+(u-r),0===a&&0===c&&0===l&&0===d)return P;if(D=11093356479670487e-47*s+33306690738754706e-32*Math.abs(P),P+=E*d+M*a-(k*l+A*c),P>=D||-P>=D)return P;x=a*M,h=T*a,p=h-(h-a),f=a-p,h=T*M,m=h-(h-M),g=M-m,v=f*g-(x-p*m-f*m-p*g),b=c*A,h=T*c,p=h-(h-c),f=c-p,h=T*A,m=h-(h-A),g=A-m,C=f*g-(b-p*m-f*m-p*g),_=v-C,u=v-_,V[0]=v-(_+u)+(u-C),y=x+_,u=y-x,w=x-(y-u)+(_-u),_=w-b,u=w-_,V[1]=w-(_+u)+(u-b),S=y+_,u=S-y,V[2]=y-(S-u)+(_-u),V[3]=S;const R=F(4,L,4,V,N);x=E*d,h=T*E,p=h-(h-E),f=E-p,h=T*d,m=h-(h-d),g=d-m,v=f*g-(x-p*m-f*m-p*g),b=k*l,h=T*k,p=h-(h-k),f=k-p,h=T*l,m=h-(h-l),g=l-m,C=f*g-(b-p*m-f*m-p*g),_=v-C,u=v-_,V[0]=v-(_+u)+(u-C),y=x+_,u=y-x,w=x-(y-u)+(_-u),_=w-b,u=w-_,V[1]=w-(_+u)+(u-b),S=y+_,u=S-y,V[2]=y-(S-u)+(_-u),V[3]=S;const B=F(R,N,4,V,I);x=a*d,h=T*a,p=h-(h-a),f=a-p,h=T*d,m=h-(h-d),g=d-m,v=f*g-(x-p*m-f*m-p*g),b=c*l,h=T*c,p=h-(h-c),f=c-p,h=T*l,m=h-(h-l),g=l-m,C=f*g-(b-p*m-f*m-p*g),_=v-C,u=v-_,V[0]=v-(_+u)+(u-C),y=x+_,u=y-x,w=x-(y-u)+(_-u),_=w-b,u=w-_,V[1]=w-(_+u)+(u-b),S=y+_,u=S-y,V[2]=y-(S-u)+(_-u),V[3]=S;const G=F(B,I,4,V,O);return O[G-1]}(t,e,n,i,o,r,l)}const B=Math.pow(2,-52),G=new Uint32Array(512);class q{static from(t,e=z,n=X){const i=t.length,o=new Float64Array(2*i);for(let r=0;r<i;r++){const i=t[r];o[2*r]=e(i),o[2*r+1]=n(i)}return new q(o)}constructor(t){const e=t.length>>1;if(e>0&&"number"!=typeof t[0])throw new Error("Expected coords to contain numbers.");this.coords=t;const n=Math.max(2*e-5,0);this._triangles=new Uint32Array(3*n),this._halfedges=new Int32Array(3*n),this._hashSize=Math.ceil(Math.sqrt(e)),this._hullPrev=new Uint32Array(e),this._hullNext=new Uint32Array(e),this._hullTri=new Uint32Array(e),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(e),this._dists=new Float64Array(e),this.update()}update(){const{coords:t,_hullPrev:e,_hullNext:n,_hullTri:i,_hullHash:o}=this,r=t.length>>1;let s=1/0,a=1/0,c=-1/0,l=-1/0;for(let e=0;e<r;e++){const n=t[2*e],i=t[2*e+1];n<s&&(s=n),i<a&&(a=i),n>c&&(c=n),i>l&&(l=i),this._ids[e]=e}const d=(s+c)/2,u=(a+l)/2;let h,p,f,m=1/0;for(let e=0;e<r;e++){const n=W(d,u,t[2*e],t[2*e+1]);n<m&&(h=e,m=n)}const g=t[2*h],_=t[2*h+1];m=1/0;for(let e=0;e<r;e++){if(e===h)continue;const n=W(g,_,t[2*e],t[2*e+1]);n<m&&n>0&&(p=e,m=n)}let y=t[2*p],w=t[2*p+1],x=1/0;for(let e=0;e<r;e++){if(e===h||e===p)continue;const n=$(g,_,y,w,t[2*e],t[2*e+1]);n<x&&(f=e,x=n)}let v=t[2*f],b=t[2*f+1];if(x===1/0){for(let e=0;e<r;e++)this._dists[e]=t[2*e]-t[0]||t[2*e+1]-t[1];U(this._ids,this._dists,0,r-1);const e=new Uint32Array(r);let n=0;for(let t=0,i=-1/0;t<r;t++){const o=this._ids[t];this._dists[o]>i&&(e[n++]=o,i=this._dists[o])}return this.hull=e.subarray(0,n),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(R(g,_,y,w,v,b)<0){const t=p,e=y,n=w;p=f,y=v,w=b,f=t,v=e,b=n}const C=function(t,e,n,i,o,r){const s=n-t,a=i-e,c=o-t,l=r-e,d=s*s+a*a,u=c*c+l*l,h=.5/(s*l-a*c);return{x:t+(l*d-a*u)*h,y:e+(s*u-c*d)*h}}(g,_,y,w,v,b);this._cx=C.x,this._cy=C.y;for(let e=0;e<r;e++)this._dists[e]=W(t[2*e],t[2*e+1],C.x,C.y);U(this._ids,this._dists,0,r-1),this._hullStart=h;let S=3;n[h]=e[f]=p,n[p]=e[h]=f,n[f]=e[p]=h,i[h]=0,i[p]=1,i[f]=2,o.fill(-1),o[this._hashKey(g,_)]=h,o[this._hashKey(y,w)]=p,o[this._hashKey(v,b)]=f,this.trianglesLen=0,this._addTriangle(h,p,f,-1,-1,-1);for(let r,s,a=0;a<this._ids.length;a++){const c=this._ids[a],l=t[2*c],d=t[2*c+1];if(a>0&&Math.abs(l-r)<=B&&Math.abs(d-s)<=B)continue;if(r=l,s=d,c===h||c===p||c===f)continue;let u=0;for(let t=0,e=this._hashKey(l,d);t<this._hashSize&&(u=o[(e+t)%this._hashSize],-1===u||u===n[u]);t++);u=e[u];let m,g=u;for(;m=n[g],R(l,d,t[2*g],t[2*g+1],t[2*m],t[2*m+1])>=0;)if(g=m,g===u){g=-1;break}if(-1===g)continue;let _=this._addTriangle(g,c,n[g],-1,-1,i[g]);i[c]=this._legalize(_+2),i[g]=_,S++;let y=n[g];for(;m=n[y],R(l,d,t[2*y],t[2*y+1],t[2*m],t[2*m+1])<0;)_=this._addTriangle(y,c,m,i[c],-1,i[y]),i[c]=this._legalize(_+2),n[y]=y,S--,y=m;if(g===u)for(;m=e[g],R(l,d,t[2*m],t[2*m+1],t[2*g],t[2*g+1])<0;)_=this._addTriangle(m,c,g,-1,i[g],i[m]),this._legalize(_+2),i[m]=_,n[g]=g,S--,g=m;this._hullStart=e[c]=g,n[g]=e[y]=c,n[c]=y,o[this._hashKey(l,d)]=c,o[this._hashKey(t[2*g],t[2*g+1])]=g}this.hull=new Uint32Array(S);for(let t=0,e=this._hullStart;t<S;t++)this.hull[t]=e,e=n[e];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,e){return Math.floor(function(t,e){const n=t/(Math.abs(t)+Math.abs(e));return(e>0?3-n:1+n)/4}(t-this._cx,e-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:e,_halfedges:n,coords:i}=this;let o=0,r=0;for(;;){const s=n[t],a=t-t%3;if(r=a+(t+2)%3,-1===s){if(0===o)break;t=G[--o];continue}const c=s-s%3,l=a+(t+1)%3,d=c+(s+2)%3,u=e[r],h=e[t],p=e[l],f=e[d];if(j(i[2*u],i[2*u+1],i[2*h],i[2*h+1],i[2*p],i[2*p+1],i[2*f],i[2*f+1])){e[t]=f,e[s]=u;const i=n[d];if(-1===i){let e=this._hullStart;do{if(this._hullTri[e]===d){this._hullTri[e]=t;break}e=this._hullPrev[e]}while(e!==this._hullStart)}this._link(t,i),this._link(s,n[r]),this._link(r,d);const a=c+(s+1)%3;o<G.length&&(G[o++]=a)}else{if(0===o)break;t=G[--o]}}return r}_link(t,e){this._halfedges[t]=e,-1!==e&&(this._halfedges[e]=t)}_addTriangle(t,e,n,i,o,r){const s=this.trianglesLen;return this._triangles[s]=t,this._triangles[s+1]=e,this._triangles[s+2]=n,this._link(s,i),this._link(s+1,o),this._link(s+2,r),this.trianglesLen+=3,s}}function W(t,e,n,i){const o=t-n,r=e-i;return o*o+r*r}function j(t,e,n,i,o,r,s,a){const c=t-s,l=e-a,d=n-s,u=i-a,h=o-s,p=r-a,f=d*d+u*u,m=h*h+p*p;return c*(u*m-f*p)-l*(d*m-f*h)+(c*c+l*l)*(d*p-u*h)<0}function $(t,e,n,i,o,r){const s=n-t,a=i-e,c=o-t,l=r-e,d=s*s+a*a,u=c*c+l*l,h=.5/(s*l-a*c),p=(l*d-a*u)*h,f=(s*u-c*d)*h;return p*p+f*f}function U(t,e,n,i){if(i-n<=20)for(let o=n+1;o<=i;o++){const i=t[o],r=e[i];let s=o-1;for(;s>=n&&e[t[s]]>r;)t[s+1]=t[s--];t[s+1]=i}else{let o=n+1,r=i;H(t,n+i>>1,o),e[t[n]]>e[t[i]]&&H(t,n,i),e[t[o]]>e[t[i]]&&H(t,o,i),e[t[n]]>e[t[o]]&&H(t,n,o);const s=t[o],a=e[s];for(;;){do{o++}while(e[t[o]]<a);do{r--}while(e[t[r]]>a);if(r<o)break;H(t,o,r)}t[n+1]=t[r],t[r]=s,i-o+1>=r-n?(U(t,e,o,i),U(t,e,n,r-1)):(U(t,e,n,r-1),U(t,e,o,i))}}function H(t,e,n){const i=t[e];t[e]=t[n],t[n]=i}function z(t){return t[0]}function X(t){return t[1]}const Y=1e-6;class J{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,e){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,e){this._+=`L${this._x1=+t},${this._y1=+e}`}arc(t,e,n){const i=(t=+t)+(n=+n),o=e=+e;if(n<0)throw new Error("negative radius");null===this._x1?this._+=`M${i},${o}`:(Math.abs(this._x1-i)>Y||Math.abs(this._y1-o)>Y)&&(this._+="L"+i+","+o),n&&(this._+=`A${n},${n},0,1,1,${t-n},${e}A${n},${n},0,1,1,${this._x1=i},${this._y1=o}`)}rect(t,e,n,i){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}h${+n}v${+i}h${-n}Z`}value(){return this._||null}}class K{constructor(){this._=[]}moveTo(t,e){this._.push([t,e])}closePath(){this._.push(this._[0].slice())}lineTo(t,e){this._.push([t,e])}value(){return this._.length?this._:null}}class Q{constructor(t,[e,n,i,o]=[0,0,960,500]){if(!((i=+i)>=(e=+e)&&(o=+o)>=(n=+n)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(2*t.points.length),this.vectors=new Float64Array(2*t.points.length),this.xmax=i,this.xmin=e,this.ymax=o,this.ymin=n,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:e,triangles:n},vectors:i}=this,o=this.circumcenters=this._circumcenters.subarray(0,n.length/3*2);for(let e,i,r=0,s=0,a=n.length;r<a;r+=3,s+=2){const a=2*n[r],c=2*n[r+1],l=2*n[r+2],d=t[a],u=t[a+1],h=t[c],p=t[c+1],f=t[l],m=t[l+1],g=h-d,_=p-u,y=f-d,w=m-u,x=2*(g*w-_*y);if(Math.abs(x)<1e-9){let o=1e9;const r=2*n[0];o*=Math.sign((t[r]-d)*w-(t[r+1]-u)*y),e=(d+f)/2-o*w,i=(u+m)/2+o*y}else{const t=1/x,n=g*g+_*_,o=y*y+w*w;e=d+(w*n-_*o)*t,i=u+(g*o-y*n)*t}o[s]=e,o[s+1]=i}let r,s,a,c=e[e.length-1],l=4*c,d=t[2*c],u=t[2*c+1];i.fill(0);for(let n=0;n<e.length;++n)c=e[n],r=l,s=d,a=u,l=4*c,d=t[2*c],u=t[2*c+1],i[r+2]=i[l]=a-u,i[r+3]=i[l+1]=d-s}render(t){const e=null==t?t=new J:void 0,{delaunay:{halfedges:n,inedges:i,hull:o},circumcenters:r,vectors:s}=this;if(o.length<=1)return null;for(let e=0,i=n.length;e<i;++e){const i=n[e];if(i<e)continue;const o=2*Math.floor(e/3),s=2*Math.floor(i/3),a=r[o],c=r[o+1],l=r[s],d=r[s+1];this._renderSegment(a,c,l,d,t)}let a,c=o[o.length-1];for(let e=0;e<o.length;++e){a=c,c=o[e];const n=2*Math.floor(i[c]/3),l=r[n],d=r[n+1],u=4*a,h=this._project(l,d,s[u+2],s[u+3]);h&&this._renderSegment(l,d,h[0],h[1],t)}return e&&e.value()}renderBounds(t){const e=null==t?t=new J:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),e&&e.value()}renderCell(t,e){const n=null==e?e=new J:void 0,i=this._clip(t);if(null===i||!i.length)return;e.moveTo(i[0],i[1]);let o=i.length;for(;i[0]===i[o-2]&&i[1]===i[o-1]&&o>1;)o-=2;for(let t=2;t<o;t+=2)i[t]===i[t-2]&&i[t+1]===i[t-1]||e.lineTo(i[t],i[t+1]);return e.closePath(),n&&n.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let e=0,n=t.length/2;e<n;++e){const t=this.cellPolygon(e);t&&(t.index=e,yield t)}}cellPolygon(t){const e=new K;return this.renderCell(t,e),e.value()}_renderSegment(t,e,n,i,o){let r;const s=this._regioncode(t,e),a=this._regioncode(n,i);0===s&&0===a?(o.moveTo(t,e),o.lineTo(n,i)):(r=this._clipSegment(t,e,n,i,s,a))&&(o.moveTo(r[0],r[1]),o.lineTo(r[2],r[3]))}contains(t,e,n){return(e=+e)==e&&(n=+n)==n&&this.delaunay._step(t,e,n)===t}*neighbors(t){const e=this._clip(t);if(e)for(const n of this.delaunay.neighbors(t)){const t=this._clip(n);if(t)t:for(let i=0,o=e.length;i<o;i+=2)for(let r=0,s=t.length;r<s;r+=2)if(e[i]==t[r]&&e[i+1]==t[r+1]&&e[(i+2)%o]==t[(r+s-2)%s]&&e[(i+3)%o]==t[(r+s-1)%s]){yield n;break t}}}_cell(t){const{circumcenters:e,delaunay:{inedges:n,halfedges:i,triangles:o}}=this,r=n[t];if(-1===r)return null;const s=[];let a=r;do{const n=Math.floor(a/3);if(s.push(e[2*n],e[2*n+1]),a=a%3==2?a-2:a+1,o[a]!==t)break;a=i[a]}while(a!==r&&-1!==a);return s}_clip(t){if(0===t&&1===this.delaunay.hull.length)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const e=this._cell(t);if(null===e)return null;const{vectors:n}=this,i=4*t;return n[i]||n[i+1]?this._clipInfinite(t,e,n[i],n[i+1],n[i+2],n[i+3]):this._clipFinite(t,e)}_clipFinite(t,e){const n=e.length;let i,o,r,s,a=null,c=e[n-2],l=e[n-1],d=this._regioncode(c,l),u=0;for(let h=0;h<n;h+=2)if(i=c,o=l,c=e[h],l=e[h+1],r=d,d=this._regioncode(c,l),0===r&&0===d)s=u,u=0,a?a.push(c,l):a=[c,l];else{let e,n,h,p,f;if(0===r){if(null===(e=this._clipSegment(i,o,c,l,r,d)))continue;[n,h,p,f]=e}else{if(null===(e=this._clipSegment(c,l,i,o,d,r)))continue;[p,f,n,h]=e,s=u,u=this._edgecode(n,h),s&&u&&this._edge(t,s,u,a,a.length),a?a.push(n,h):a=[n,h]}s=u,u=this._edgecode(p,f),s&&u&&this._edge(t,s,u,a,a.length),a?a.push(p,f):a=[p,f]}if(a)s=u,u=this._edgecode(a[0],a[1]),s&&u&&this._edge(t,s,u,a,a.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return a}_clipSegment(t,e,n,i,o,r){for(;;){if(0===o&&0===r)return[t,e,n,i];if(o&r)return null;let s,a,c=o||r;8&c?(s=t+(n-t)*(this.ymax-e)/(i-e),a=this.ymax):4&c?(s=t+(n-t)*(this.ymin-e)/(i-e),a=this.ymin):2&c?(a=e+(i-e)*(this.xmax-t)/(n-t),s=this.xmax):(a=e+(i-e)*(this.xmin-t)/(n-t),s=this.xmin),o?(t=s,e=a,o=this._regioncode(t,e)):(n=s,i=a,r=this._regioncode(n,i))}}_clipInfinite(t,e,n,i,o,r){let s,a=Array.from(e);if((s=this._project(a[0],a[1],n,i))&&a.unshift(s[0],s[1]),(s=this._project(a[a.length-2],a[a.length-1],o,r))&&a.push(s[0],s[1]),a=this._clipFinite(t,a))for(let e,n=0,i=a.length,o=this._edgecode(a[i-2],a[i-1]);n<i;n+=2)e=o,o=this._edgecode(a[n],a[n+1]),e&&o&&(n=this._edge(t,e,o,a,n),i=a.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(a=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return a}_edge(t,e,n,i,o){for(;e!==n;){let n,r;switch(e){case 5:e=4;continue;case 4:e=6,n=this.xmax,r=this.ymin;break;case 6:e=2;continue;case 2:e=10,n=this.xmax,r=this.ymax;break;case 10:e=8;continue;case 8:e=9,n=this.xmin,r=this.ymax;break;case 9:e=1;continue;case 1:e=5,n=this.xmin,r=this.ymin}i[o]===n&&i[o+1]===r||!this.contains(t,n,r)||(i.splice(o,0,n,r),o+=2)}if(i.length>4)for(let t=0;t<i.length;t+=2){const e=(t+2)%i.length,n=(t+4)%i.length;(i[t]===i[e]&&i[e]===i[n]||i[t+1]===i[e+1]&&i[e+1]===i[n+1])&&(i.splice(e,2),t-=2)}return o}_project(t,e,n,i){let o,r,s,a=1/0;if(i<0){if(e<=this.ymin)return null;(o=(this.ymin-e)/i)<a&&(s=this.ymin,r=t+(a=o)*n)}else if(i>0){if(e>=this.ymax)return null;(o=(this.ymax-e)/i)<a&&(s=this.ymax,r=t+(a=o)*n)}if(n>0){if(t>=this.xmax)return null;(o=(this.xmax-t)/n)<a&&(r=this.xmax,s=e+(a=o)*i)}else if(n<0){if(t<=this.xmin)return null;(o=(this.xmin-t)/n)<a&&(r=this.xmin,s=e+(a=o)*i)}return[r,s]}_edgecode(t,e){return(t===this.xmin?1:t===this.xmax?2:0)|(e===this.ymin?4:e===this.ymax?8:0)}_regioncode(t,e){return(t<this.xmin?1:t>this.xmax?2:0)|(e<this.ymin?4:e>this.ymax?8:0)}}const Z=2*Math.PI,tt=Math.pow;function et(t){return t[0]}function nt(t){return t[1]}function it(t,e,n){return[t+Math.sin(t+e)*n,e+Math.cos(t-e)*n]}class ot{static from(t,e=et,n=nt,i){return new ot("length"in t?function(t,e,n,i){const o=t.length,r=new Float64Array(2*o);for(let s=0;s<o;++s){const o=t[s];r[2*s]=e.call(i,o,s,t),r[2*s+1]=n.call(i,o,s,t)}return r}(t,e,n,i):Float64Array.from(function*(t,e,n,i){let o=0;for(const r of t)yield e.call(i,r,o,t),yield n.call(i,r,o,t),++o}(t,e,n,i)))}constructor(t){this._delaunator=new q(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,e=this.points;if(t.hull&&t.hull.length>2&&function(t){const{triangles:e,coords:n}=t;for(let t=0;t<e.length;t+=3){const i=2*e[t],o=2*e[t+1],r=2*e[t+2];if((n[r]-n[i])*(n[o+1]-n[i+1])-(n[o]-n[i])*(n[r+1]-n[i+1])>1e-10)return!1}return!0}(t)){this.collinear=Int32Array.from({length:e.length/2},((t,e)=>e)).sort(((t,n)=>e[2*t]-e[2*n]||e[2*t+1]-e[2*n+1]));const t=this.collinear[0],n=this.collinear[this.collinear.length-1],i=[e[2*t],e[2*t+1],e[2*n],e[2*n+1]],o=1e-8*Math.hypot(i[3]-i[1],i[2]-i[0]);for(let t=0,n=e.length/2;t<n;++t){const n=it(e[2*t],e[2*t+1],o);e[2*t]=n[0],e[2*t+1]=n[1]}this._delaunator=new q(e)}else delete this.collinear;const n=this.halfedges=this._delaunator.halfedges,i=this.hull=this._delaunator.hull,o=this.triangles=this._delaunator.triangles,r=this.inedges.fill(-1),s=this._hullIndex.fill(-1);for(let t=0,e=n.length;t<e;++t){const e=o[t%3==2?t-2:t+1];-1!==n[t]&&-1!==r[e]||(r[e]=t)}for(let t=0,e=i.length;t<e;++t)s[i[t]]=t;i.length<=2&&i.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=i[0],r[i[0]]=1,2===i.length&&(r[i[1]]=0,this.triangles[1]=i[1],this.triangles[2]=i[1]))}voronoi(t){return new Q(this,t)}*neighbors(t){const{inedges:e,hull:n,_hullIndex:i,halfedges:o,triangles:r,collinear:s}=this;if(s){const e=s.indexOf(t);return e>0&&(yield s[e-1]),void(e<s.length-1&&(yield s[e+1]))}const a=e[t];if(-1===a)return;let c=a,l=-1;do{if(yield l=r[c],c=c%3==2?c-2:c+1,r[c]!==t)return;if(c=o[c],-1===c){const e=n[(i[t]+1)%n.length];return void(e!==l&&(yield e))}}while(c!==a)}find(t,e,n=0){if((t=+t)!=t||(e=+e)!=e)return-1;const i=n;let o;for(;(o=this._step(n,t,e))>=0&&o!==n&&o!==i;)n=o;return o}_step(t,e,n){const{inedges:i,hull:o,_hullIndex:r,halfedges:s,triangles:a,points:c}=this;if(-1===i[t]||!c.length)return(t+1)%(c.length>>1);let l=t,d=tt(e-c[2*t],2)+tt(n-c[2*t+1],2);const u=i[t];let h=u;do{let i=a[h];const u=tt(e-c[2*i],2)+tt(n-c[2*i+1],2);if(u<d&&(d=u,l=i),h=h%3==2?h-2:h+1,a[h]!==t)break;if(h=s[h],-1===h){if(h=o[(r[t]+1)%o.length],h!==i&&tt(e-c[2*h],2)+tt(n-c[2*h+1],2)<d)return h;break}}while(h!==u);return l}render(t){const e=null==t?t=new J:void 0,{points:n,halfedges:i,triangles:o}=this;for(let e=0,r=i.length;e<r;++e){const r=i[e];if(r<e)continue;const s=2*o[e],a=2*o[r];t.moveTo(n[s],n[s+1]),t.lineTo(n[a],n[a+1])}return this.renderHull(t),e&&e.value()}renderPoints(t,e){void 0!==e||t&&"function"==typeof t.moveTo||(e=t,t=null),e=null==e?2:+e;const n=null==t?t=new J:void 0,{points:i}=this;for(let n=0,o=i.length;n<o;n+=2){const o=i[n],r=i[n+1];t.moveTo(o+e,r),t.arc(o,r,e,0,Z)}return n&&n.value()}renderHull(t){const e=null==t?t=new J:void 0,{hull:n,points:i}=this,o=2*n[0],r=n.length;t.moveTo(i[o],i[o+1]);for(let e=1;e<r;++e){const o=2*n[e];t.lineTo(i[o],i[o+1])}return t.closePath(),e&&e.value()}hullPolygon(){const t=new K;return this.renderHull(t),t.value()}renderTriangle(t,e){const n=null==e?e=new J:void 0,{points:i,triangles:o}=this,r=2*o[t*=3],s=2*o[t+1],a=2*o[t+2];return e.moveTo(i[r],i[r+1]),e.lineTo(i[s],i[s+1]),e.lineTo(i[a],i[a+1]),e.closePath(),n&&n.value()}*trianglePolygons(){const{triangles:t}=this;for(let e=0,n=t.length/3;e<n;++e)yield this.trianglePolygon(e)}trianglePolygon(t){const e=new K;return this.renderTriangle(t,e),e.value()}}function rt(t,e){let n,i;this.update=function(t){n=t.getCandidates();const o=n.map((t=>[t.x,t.y])),r=ot.from(o);i=r.voronoi([0,0,e.width,e.height])},this.render=function(){const{ctx:o}=e;o.save(),o.beginPath(),o.arc(t.x,t.y,.5*t.w2,0,2*Math.PI),o.clip();const r=n.length;for(let t=0;t<r;t++)o.beginPath(),i.renderCell(t,o),o.fillStyle=n[t].color,o.fill(),o.stroke();o.beginPath(),o.arc(t.x,t.y,.5*t.w2,0,2*Math.PI),o.stroke(),o.restore()}}function st(t,e){const n=this;n.voter=t,e.newCircleHandle(t,t.circle),n.renderForeground=()=>{n.voter.renderForeground()}}function at(t,e,n){const i=this;st.call(i,t,e);const o=new rt(t,n);i.update=function(t){o.update(t)},i.render=function(){o.render()}}function ct(t,e){const n=this;n.candidate=t,e.newSquareHandle(t,t.square),n.renderForeground=()=>{n.candidate.renderForeground()}}function lt(t){const e=this,n=[];e.newCandidate=function(t){n.push(t)},e.getSimCandidates=()=>n.filter((t=>t.candidate.exists)),e.getCandidates=()=>e.getSimCandidates().map((t=>t.candidate)),e.getCandidatesAll=()=>n.map((t=>t.candidate)),e.setCandidateFractions=t=>{e.getCandidates().forEach(((e,n)=>{const i=t[n];e.setFraction(i)}))},e.setCandidateWins=t=>{e.getCandidates().forEach(((e,n)=>{const i=t[n];e.setWins(i)}))},e.updateXY=()=>{n.forEach((t=>t.candidate.updateXY()))},e.renderForeground=()=>{t.showGhosts?e.renderForegroundAll():e.renderForegroundExisting()},e.renderForegroundExisting=()=>{e.getCandidates().forEach((t=>t.renderForeground()))},e.renderForegroundAll=()=>{e.getCandidatesAll().forEach((t=>t.renderForeground()))},e.numCandidates=()=>n.length}function dt(t){const e=this,n=[];e.simVoters=n,e.newVoterGroup=function(t){n.push(t)},e.getVoterGroups=()=>n.filter((t=>t.voter.exists)).map((t=>t.voter)),e.getSimVoterGroups=()=>n.filter((t=>t.voter.exists)),e.update=t=>{n.forEach((e=>{e.voter.exists&&e.update(t)}))},e.updateXY=()=>{n.forEach((t=>t.voter.updateXY()))},e.render=()=>{n.forEach((t=>{t.voter.exists&&t.render()}))},e.renderForeground=()=>{t.showGhosts?e.renderForegroundAll():e.renderForegroundExisting()},e.renderForegroundExisting=()=>{n.forEach((t=>{t.voter.exists&&t.renderForeground()}))},e.renderForegroundAll=()=>{n.forEach((t=>{t.renderForeground()}))}}function ut(t,e,n){const i=this;let o={};const r=[],s=t.foreground;i.newSquareHandle=function(t,e){r.push({o:t,g:e,p:{isSquare:!0}})},i.newCircleHandle=function(t,e){r.push({o:t,g:e,p:{isCircle:!0}})};const a=function(t){const e={};e.x=t.offsetX,e.y=t.offsetY;const i=t.isTouch?10:0,a=r.length,c=[];for(let t=0;t<a;t++){const o=r[t];(o.o.exists||n.showGhosts)&&u(o,e,i)&&c.push(t)}if(c.length>0){const t=c.map((t=>{const n=r[t];return(n.o.x-e.x)**2+(n.o.y-e.y)**2})),n=c[function(t){let e=1/0,n=null;for(let i=0;i<t.length;i++){const o=t[i];o<e&&(e=o,n=i)}return n}(t)],i=r[n];o.iDragging=n,o.isDragging=!0,o.offX=i.o.x-e.x,o.offY=i.o.y-e.y,i.g.pickUp(),s.dataset.cursor="grabbing"}!function(t){h=!0,p=structuredClone(t)}(e)},c=function(t){const i={};if(i.x=t.offsetX,i.y=t.offsetY,o.isDragging){t.isTouch&&(t.preventDefault(),t.stopPropagation());r[o.iDragging].o.setXY({x:i.x+o.offX,y:i.y+o.offY}),e.add(["draggables"])}else{const t=r.length;for(let e=0;e<t;e++){const t=r[e];if((n.showGhosts||t.o.exists)&&u(t,i,0))return void(s.dataset.cursor="grab")}s.dataset.cursor=""}!function(t){if(h){const e=Math.abs(p.x-t.x),n=Math.abs(p.y-t.y);e>5&&(h=!1),n>5&&(h=!1)}}(i)},l=function(t){if(c(t),function(){if(h&&(h=!1,o.isDragging)){r[o.iDragging].o.click()}}(),void 0!==o.iDragging){r[o.iDragging].g.drop()}o={}};function d(t){const e=t.target.getBoundingClientRect(),n=t.target.clientWidth,i=t.target.clientHeight;let o=t.changedTouches[0].clientX-e.left,r=t.changedTouches[0].clientY-e.top;o<0&&(o=0),r<0&&(r=0),o>n&&(o=n),r>i&&(r=i);const s={offsetX:o,offsetY:r,isTouch:!0};return Object.assign(t,s),t}function u(t,e,n){const i=t.o.x-e.x,o=t.o.y-e.y;if(t.p.isCircle){const{r:e}=t.g;return i*i+o*o<(e+n)*(e+n)}if(t.p.isSquare){const{w:e,h:r}=t.g;return Math.abs(i)<.5*e+n&&Math.abs(o)<.5*r+n}return!1}let h,p;i.eventHandlers={start:a,move:c,end:l,touchmove:t=>{const e=d(t);c(e)},touchstart:t=>{const e=d(t);a(e)},touchend:t=>{const e=d(t);l(e)}}}function ht(t,e,n){const i=this;i.dragm=new ut(t,e,n),i.enter=()=>{t.eventHandlers.set(i.dragm.eventHandlers)},i.exit=()=>{},i.update=()=>{},i.render=()=>{},i.renderForeground=()=>{}}function pt(t,e,n,i,o){const r=this;ht.call(r,t,n,o);const s=new dt(o),a=new lt(o);r.addSimCandidate=t=>{a.newCandidate(new ct(t,r.dragm))},r.addSimVoterCircle=e=>{s.newVoterGroup(new at(e,r.dragm,t))};const c=r.enter;r.enter=()=>{c(),o.simAddCandidates.canButton.show(),o.election.setDimensions(2),s.updateXY(),a.updateXY()},r.exit=()=>{o.simAddCandidates.canButton.hide()},r.update=()=>{n.checkNone()||(n.clear(),i.updateTallies(s,a),s.update(a),t.clear(),r.render())},r.render=()=>{s.render()},r.renderForeground=()=>{s.renderForeground(),a.renderForeground()}}function ft(t){const e=function(t){const e=t.map((t=>t.w2**2)),n=e.reduce(((t,e)=>t+e)),i=e.map((t=>t/n)),o=[];return i.reduce(((t,e,n)=>{const i=t+e;return o[n]=i,i}),0),o}(t);this.samplePoint=function(){return function(t,e){const n=function(t){const e=Math.random();return t.findIndex((t=>t>=e))}(e),i=t[n];return function(t,e,n){const i=n*Math.sqrt(Math.random()),o=2*Math.random()*Math.PI,r=t+i*Math.cos(o),s=e+i*Math.sin(o);return{x:r,y:s}}(i.x,i.y,.5*i.w2)}(t,e)}}function mt(t){const e=this,n=[];e.newCandidate=function(t){n.push(t)},e.getSimCandidateDistributions=()=>n.filter((t=>t.canDn.exists)),e.getCandidateDistributions=()=>e.getSimCandidateDistributions().map((t=>t.canDn)),e.getCandidateDistributionsAll=()=>n.map((t=>t.canDn)),e.startSampler=()=>{const t=e.getCandidateDistributions();0!==t.length&&(e.sampler=new ft(t))},e.updateXY=()=>{n.forEach((t=>t.canDn.updateXY()))},e.render=()=>{e.getCandidateDistributions().forEach((t=>t.render()))},e.renderForeground=()=>{t.showGhosts?e.renderForegroundAll():e.renderForegroundExisting()},e.renderForegroundExisting=()=>{e.getCandidateDistributions().forEach((t=>t.renderForeground()))},e.renderForegroundAll=()=>{e.getCandidateDistributionsAll().forEach((t=>t.renderForeground()))}}function gt(t,e){const n=this;n.canDn=t,e.newSquareHandle(t,t.square),n.renderForeground=()=>{n.canDn.renderForeground()}}function _t(t,e,n){const i=this;st.call(i,t,e),i.render=function(){const{ctx:t}=n;t.beginPath();const{x:e,y:o,w2:r}=i.voter;t.arc(e,o,.5*r,0,2*Math.PI),t.stroke()}}function yt(t,e,n,i,o){const r=this;ht.call(r,t,n,o);const s=new mt(o);r.addSimCandidateDistribution=t=>{s.newCandidate(new gt(t,r.dragm))};const a=new dt(o);r.addSimVoterCircle=e=>{a.newVoterGroup(new _t(e,r.dragm,t))};const c=r.enter;r.enter=()=>{c(),o.simAddCandidateDns.canDnButton.show(),o.election.setDimensions(2),a.updateXY(),s.updateXY()},r.exit=()=>{o.simAddCandidateDns.canDnButton.hide()},r.update=()=>{if(n.checkNone()){i.addSim(a,s)||(n.clear(),t.clear(),r.render())}else n.clear(),s.startSampler(),i.startSim(),t.clear(),r.render()},r.render=()=>{i.render(),a.render(),s.render()},r.renderForeground=()=>{a.renderForeground(),s.renderForeground()}}function wt(t,e,n){const i=this;st.call(i,t,e),i.render=function(){const{ctx:t}=n;t.beginPath(),t.arc(i.voter.x,i.voter.y,.5*i.voter.w2,0,2*Math.PI),t.stroke()},i.renderAt=function(t,e){const{ctx:o}=n;o.beginPath(),o.arc(t,e,.5*i.voter.w2,0,2*Math.PI),o.stroke()},i.renderCenterAt=function(t,e){const{ctx:i}=n;i.beginPath(),i.fillStyle="#555",i.arc(t,e,1,0,2*Math.PI),i.fill()}}const xt=.5*(Math.sqrt(3)-1),vt=(3-Math.sqrt(3))/6,bt=1/6,Ct=(Math.sqrt(5)-1)/4,St=(5-Math.sqrt(5))/20,Et=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),At=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);class kt{constructor(t=Math.random){const e="function"==typeof t?t:function(t){let e=0,n=0,i=0,o=1;const r=function(){let t=4022871197;return function(e){e=e.toString();for(let n=0;n<e.length;n++){t+=e.charCodeAt(n);let i=.02519603282416938*t;t=i>>>0,i-=t,i*=t,t=i>>>0,i-=t,t+=4294967296*i}return 2.3283064365386963e-10*(t>>>0)}}();e=r(" "),n=r(" "),i=r(" "),e-=r(t),e<0&&(e+=1);n-=r(t),n<0&&(n+=1);i-=r(t),i<0&&(i+=1);return function(){const t=2091639*e+2.3283064365386963e-10*o;return e=n,n=i,i=t-(o=0|t)}}(t);this.p=function(t){const e=new Uint8Array(256);for(let t=0;t<256;t++)e[t]=t;for(let n=0;n<255;n++){const i=n+~~(t()*(256-n)),o=e[n];e[n]=e[i],e[i]=o}return e}(e),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let t=0;t<512;t++)this.perm[t]=this.p[255&t],this.permMod12[t]=this.perm[t]%12}noise2D(t,e){const n=this.permMod12,i=this.perm;let o=0,r=0,s=0;const a=(t+e)*xt,c=Math.floor(t+a),l=Math.floor(e+a),d=(c+l)*vt,u=t-(c-d),h=e-(l-d);let p,f;u>h?(p=1,f=0):(p=0,f=1);const m=u-p+vt,g=h-f+vt,_=u-1+2*vt,y=h-1+2*vt,w=255&c,x=255&l;let v=.5-u*u-h*h;if(v>=0){const t=3*n[w+i[x]];v*=v,o=v*v*(Et[t]*u+Et[t+1]*h)}let b=.5-m*m-g*g;if(b>=0){const t=3*n[w+p+i[x+f]];b*=b,r=b*b*(Et[t]*m+Et[t+1]*g)}let C=.5-_*_-y*y;if(C>=0){const t=3*n[w+1+i[x+1]];C*=C,s=C*C*(Et[t]*_+Et[t+1]*y)}return 70*(o+r+s)}noise3D(t,e,n){const i=this.permMod12,o=this.perm;let r,s,a,c;const l=.3333333333333333*(t+e+n),d=Math.floor(t+l),u=Math.floor(e+l),h=Math.floor(n+l),p=(d+u+h)*bt,f=t-(d-p),m=e-(u-p),g=n-(h-p);let _,y,w,x,v,b;f>=m?m>=g?(_=1,y=0,w=0,x=1,v=1,b=0):f>=g?(_=1,y=0,w=0,x=1,v=0,b=1):(_=0,y=0,w=1,x=1,v=0,b=1):m<g?(_=0,y=0,w=1,x=0,v=1,b=1):f<g?(_=0,y=1,w=0,x=0,v=1,b=1):(_=0,y=1,w=0,x=1,v=1,b=0);const C=f-_+bt,S=m-y+bt,E=g-w+bt,A=f-x+.3333333333333333,k=m-v+.3333333333333333,M=g-b+.3333333333333333,P=f-1+.5,T=m-1+.5,F=g-1+.5,D=255&d,L=255&u,N=255&h;let I=.6-f*f-m*m-g*g;if(I<0)r=0;else{const t=3*i[D+o[L+o[N]]];I*=I,r=I*I*(Et[t]*f+Et[t+1]*m+Et[t+2]*g)}let O=.6-C*C-S*S-E*E;if(O<0)s=0;else{const t=3*i[D+_+o[L+y+o[N+w]]];O*=O,s=O*O*(Et[t]*C+Et[t+1]*S+Et[t+2]*E)}let V=.6-A*A-k*k-M*M;if(V<0)a=0;else{const t=3*i[D+x+o[L+v+o[N+b]]];V*=V,a=V*V*(Et[t]*A+Et[t+1]*k+Et[t+2]*M)}let R=.6-P*P-T*T-F*F;if(R<0)c=0;else{const t=3*i[D+1+o[L+1+o[N+1]]];R*=R,c=R*R*(Et[t]*P+Et[t+1]*T+Et[t+2]*F)}return 32*(r+s+a+c)}noise4D(t,e,n,i){const o=this.perm;let r,s,a,c,l;const d=(t+e+n+i)*Ct,u=Math.floor(t+d),h=Math.floor(e+d),p=Math.floor(n+d),f=Math.floor(i+d),m=(u+h+p+f)*St,g=t-(u-m),_=e-(h-m),y=n-(p-m),w=i-(f-m);let x=0,v=0,b=0,C=0;g>_?x++:v++,g>y?x++:b++,g>w?x++:C++,_>y?v++:b++,_>w?v++:C++,y>w?b++:C++;const S=x>=3?1:0,E=v>=3?1:0,A=b>=3?1:0,k=C>=3?1:0,M=x>=2?1:0,P=v>=2?1:0,T=b>=2?1:0,F=C>=2?1:0,D=x>=1?1:0,L=v>=1?1:0,N=b>=1?1:0,I=C>=1?1:0,O=g-S+St,V=_-E+St,R=y-A+St,B=w-k+St,G=g-M+2*St,q=_-P+2*St,W=y-T+2*St,j=w-F+2*St,$=g-D+3*St,U=_-L+3*St,H=y-N+3*St,z=w-I+3*St,X=g-1+4*St,Y=_-1+4*St,J=y-1+4*St,K=w-1+4*St,Q=255&u,Z=255&h,tt=255&p,et=255&f;let nt=.6-g*g-_*_-y*y-w*w;if(nt<0)r=0;else{const t=o[Q+o[Z+o[tt+o[et]]]]%32*4;nt*=nt,r=nt*nt*(At[t]*g+At[t+1]*_+At[t+2]*y+At[t+3]*w)}let it=.6-O*O-V*V-R*R-B*B;if(it<0)s=0;else{const t=o[Q+S+o[Z+E+o[tt+A+o[et+k]]]]%32*4;it*=it,s=it*it*(At[t]*O+At[t+1]*V+At[t+2]*R+At[t+3]*B)}let ot=.6-G*G-q*q-W*W-j*j;if(ot<0)a=0;else{const t=o[Q+M+o[Z+P+o[tt+T+o[et+F]]]]%32*4;ot*=ot,a=ot*ot*(At[t]*G+At[t+1]*q+At[t+2]*W+At[t+3]*j)}let rt=.6-$*$-U*U-H*H-z*z;if(rt<0)c=0;else{const t=o[Q+D+o[Z+L+o[tt+N+o[et+I]]]]%32*4;rt*=rt,c=rt*rt*(At[t]*$+At[t+1]*U+At[t+2]*H+At[t+3]*z)}let st=.6-X*X-Y*Y-J*J-K*K;if(st<0)l=0;else{const t=o[Q+1+o[Z+1+o[tt+1+o[et+1]]]]%32*4;st*=st,l=st*st*(At[t]*X+At[t+1]*Y+At[t+2]*J+At[t+3]*K)}return 27*(r+s+a+c+l)}}function Mt(t,e){const n=this;n.sn=[];n.genNoise=()=>{n.sn=function(t,e,n,i,o,r){const s=new kt("s"),a=new kt("seed"),c=function(t,e){return Array(t).fill().map((()=>Array(e).fill().map((()=>Array(2).fill(0)))))}(t,e);let l=0,d=0;Pt(t).forEach((o=>{Pt(e).forEach((r=>{const u=o/t*(1/n),h=r/e*(1/i),p=s.noise2D(u,h),f=a.noise2D(u,h);c[o][r][0]=p-.5,c[o][r][1]=f-.5,l+=p,d+=f}))}));const u=l/(t*e)-.5,h=d/(t*e)-.5;return c.forEach((t=>{t.forEach((t=>{t[0]=(t[0]-u)*o,t[1]=(t[1]-h)*r}))})),c}(t,e,.5,.5,100,100)}}function Pt(t){return[...Array(t).keys()]}function Tt(t,e,n){const i=this,o=document.createElement("canvas");o.width=t,o.height=e;const r=o.getContext("2d"),s=r.createImageData(t,e);i.load=n=>{const{data:i}=s;for(let o=0;o<t;o++)for(let r=0;r<e;r++){const e=n[o][r][0]+.5,s=n[o][r][1]+.5;i[4*(o+r*t)+0]=255*e,i[4*(o+r*t)+1]=200*(e+s),i[4*(o+r*t)+2]=200*s,i[4*(o+r*t)+3]=255}r.putImageData(s,0,0)},i.loadColors=n=>{const{data:i}=s;for(let o=0;o<t;o++)for(let r=0;r<e;r++){const e=n[o][r],[s,a,c]=e;i[4*(o+r*t)+0]=s,i[4*(o+r*t)+1]=a,i[4*(o+r*t)+2]=c,i[4*(o+r*t)+3]=255}r.putImageData(s,0,0)},i.render=(t,e)=>{const{gctx:i}=n;i.save(),i.imageSmoothingEnabled=!1,i.drawImage(o,0,0,t,e),i.restore()}}function Ft(t){for(var e,n=-1,i=t.length,o=t[i-1],r=0;++n<i;)e=o,o=t[n],r+=e[1]*o[0]-e[0]*o[1];return r/2}function Dt(t){for(var e,n,i=-1,o=t.length,r=0,s=0,a=t[o-1],c=0;++i<o;)e=a,a=t[i],c+=n=e[0]*a[1]-a[0]*e[1],r+=(e[0]+a[0])*n,s+=(e[1]+a[1])*n;return[r/(c*=3),s/c]}function Lt(t,e,n,i){let o,r,s=function(t,e,n){return Array(n).fill().map((()=>[Math.random()*t,Math.random()*e]))}(t,e,n),a=!1;const c=i*Math.min(t,e);for(let n=0;n<1e3;n++)if([s,a,o,r]=Nt(s,t,e,c),a)return s;return[s,o,r]}function Nt(t,e,n,i){const o=ot.from(t).voronoi([0,0,e,n]),r=(s=t.length,[...Array(s).keys()]).map((t=>o.cellPolygon(t)));var s;const a=r.map(Dt),c=t.every(((t,e)=>{return n=t,o=a[e],n**2+o**2<i;var n,o}));return[a,c,o,r]}function It(t,e,n,i,o,r,s,a,c){a.save(),a.globalAlpha=s,a.textAlign=c||"center",a.font=`${i}px Sans-serif`,a.lineWidth=o,a.fillStyle=r,a.fillText(t,e,n),a.restore()}function Ot(t,e){const n=Bt(e),i=t.length-Bt(t),o=e.slice();for(let e,r,s,a=0,c=t[i-1];a<i;++a){const i=o.slice(),l=i.length-n;o.length=0,e=t[a],r=i[l-1];for(let t=0;t<l;++t)s=i[t],Vt(s,c,e)?(Vt(r,c,e)||o.push(Rt(r,s,c,e)),o.push(s)):Vt(r,c,e)&&o.push(Rt(r,s,c,e)),r=s;n&&o.push(o[0]),c=e}return o.length?o:null}function Vt([t,e],[n,i],[o,r]){return(o-n)*(e-i)<(r-i)*(t-n)}function Rt([t,e],[n,i],[o,r],[s,a]){const c=n-t,l=i-e,d=s-o,u=a-r,h=(c*(r-e)-l*(o-t))/(l*d-c*u);return[o+h*d,r+h*u]}function Bt(t){const[e,n]=t[0],[i,o]=t[t.length-1];return e===i&&n===o}function Gt(t,e){return[[t,e],[t,e+1],[t+1,e+1],[t+1,e]]}function qt(t){const e=this;function n(n){const{gctx:i}=t,o=e.centroids[n];It(e.polygonAreas[n].toFixed(0),o[0],o[1]+.5-.2,1,.2,"#222",1,i)}e.make=(t,n,i)=>{[e.centroids,e.voronoi,e.polygons]=Lt(t,n,i,.01),e.nx=t,e.ny=n,e.nd=i,e.polygonAreas=e.polygons.map(Ft).map((t=>-t)),e.totalArea=t*n,e.census=function(t){const{nd:e,nx:n,ny:i,polygons:o}=t,r=Array(e).fill().map((()=>[]));for(let t=0;t<n;t++)for(let n=0;n<i;n++){const i=Gt(t,n);y(e).forEach((e=>{var s;const a=Ot((s=o[e],JSON.parse(JSON.stringify(s))).reverse(),i);null!==a&&r[e].push([t,n,Ft(a)])}))}return r}(e)},e.renderVoronoi=(t,i)=>{e.renderVoronoiGeneral(0,0,t,i,null,n)},e.renderVoronoiColors=(t,n,i,o,r)=>{e.renderVoronoiGeneral(t,n,i,o,r,void 0)},e.renderVoronoiGeneral=(n,i,o,r,s,a)=>{const{gctx:c}=t,{voronoi:l,nx:d,ny:u,nd:h}=e;c.save();const p=o/d,f=r/u;c.translate(n,i),c.scale(p,f);for(let t=0;t<h;t++)c.beginPath(),c.strokeStyle="#333",c.lineWidth=1/p,l.renderCell(t,c),null!==s&&(c.fillStyle=s[t],c.fill()),c.stroke(),void 0!==a&&a(t);c.restore()}}function Wt(t,e,n){const i=this;dt.call(i,n);i.districtMaker=new qt(t),i.geoNoise=new Mt(20,20),i.geoNoise.genNoise(),i.noiseImage=new Tt(20,20,t);let o=[];i.updateDistricts=()=>{i.districtMaker.make(20,20,20)},i.updateVoters=()=>{o=i.getSimVoterGroups(),i.updateFullSet(),i.updateVotersByDistrict(),i.updateVotersByTract()},i.updateFullSet=()=>{const{sn:t}=i.geoNoise;i.allVoterGroups=o.map((e=>t.map((t=>t.map((t=>{const[n,i]=t,{w2:o,densityProfile1:r}=e.voter,{x:s,y:a}=e.voter.p2;return{p2:{x:s+n,y:a+i},w2:o,densityProfile1:r}})).flat())).flat())).flat()},i.updateVotersByDistrict=()=>{const{census:t}=i.districtMaker,{sn:e}=i.geoNoise;i.voterGroupsByDistrict=y(20).map((n=>o.map((i=>t[n].map((t=>{const[n,o,r]=t,[s,a]=e[n][o],{w2:c,densityProfile1:l}=i.voter,{x:d,y:u}=i.voter.p2;return{p2:{x:d+s,y:u+a},w2:c,densityProfile1:l,weight:r}})).flat())).flat()))},i.updateVotersByTract=()=>{const{sn:t}=i.geoNoise;i.voterGroupsByTract=t.map((t=>t.map((t=>o.map((e=>{const[n,i]=t,{w2:o,densityProfile1:r}=e.voter,{x:s,y:a}=e.voter.p2;return{p2:{x:s+n,y:a+i},w2:o,densityProfile1:r}})).flat()))))};const r=100,s=100;i.render=()=>{i.voterGroupsByTract.forEach((e=>{e.forEach((e=>{e.forEach((e=>{!function(e,n){const{ctx:i}=t;i.beginPath(),i.fillStyle="#555",i.arc(e,n,1,0,2*Math.PI),i.fill()}(e.p2.x,e.p2.y)}))}))})),i.renderTractVotes(),i.renderDistrictWins(),i.renderDistrictVotes(),i.renderVoterBasisSet()},i.renderTractVotes=()=>{i.noiseImage.render(r,s),i.districtMaker.renderVoronoi(r,s)},i.renderDistrictWins=()=>{const{renderVoronoiColors:t}=i.districtMaker;t(200,0,r,s,e.winnerColors)},i.renderDistrictVotes=()=>{const{renderVoronoiColors:t}=i.districtMaker;t(100,0,r,s,e.blendColors)},i.renderVoterBasisSet=()=>{o.forEach((t=>t.render()))}}function jt(t,e,n,i,o){const r=this;ht.call(r,t,n,o);const s=new Wt(t,i,o),a=new lt(o);r.addSimCandidate=t=>{a.newCandidate(new ct(t,r.dragm))},r.addSimVoterCircle=e=>{s.newVoterGroup(new wt(e,r.dragm,t))},n.add(["districts"]);const c=r.enter;r.enter=()=>{c(),t.showGeoMaps(),o.simAddCandidates.canButton.show(),o.election.setDimensions(2),s.updateXY(),a.updateXY()},r.exit=()=>{t.hideGeoMaps(),o.simAddCandidates.canButton.hide();const e=Array(a.numCandidates()).fill(void 0);a.setCandidateWins(e)},r.update=()=>{n.checkNone()||(n.check(["districts","simType"])&&s.updateDistricts(),n.clear(),s.updateVoters(),i.updateVotes(s,a,o.dimensions),t.clear(),r.render())},r.render=()=>{s.render()},r.renderForeground=()=>{a.renderForeground(),s.renderForeground()}}function $t(){const t=this,e=[];let n=0;t.new=function(t){e.push(t);const i=n;return n+=1,i},t.num=()=>n,t.get=t=>e[t]}function Ut(){throw new Error("setTimeout has not been defined")}function Ht(){throw new Error("clearTimeout has not been defined")}var zt,Xt=Ut,Yt=Ht;function Jt(t){if(Xt===setTimeout)return setTimeout(t,0);if((Xt===Ut||!Xt)&&setTimeout)return Xt=setTimeout,setTimeout(t,0);try{return Xt(t,0)}catch(e){try{return Xt.call(null,t,0)}catch(e){return Xt.call(this,t,0)}}}"function"==typeof(zt="undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).setTimeout&&(Xt=setTimeout),"function"==typeof zt.clearTimeout&&(Yt=clearTimeout);var Kt,Qt=[],Zt=!1,te=-1;function ee(){Zt&&Kt&&(Zt=!1,Kt.length?Qt=Kt.concat(Qt):te=-1,Qt.length&&ne())}function ne(){if(!Zt){var t=Jt(ee);Zt=!0;for(var e=Qt.length;e;){for(Kt=Qt,Qt=[];++te<e;)Kt&&Kt[te].run();te=-1,e=Qt.length}Kt=null,Zt=!1,function(t){if(Yt===clearTimeout)return clearTimeout(t);if((Yt===Ht||!Yt)&&clearTimeout)return Yt=clearTimeout,clearTimeout(t);try{Yt(t)}catch(e){try{return Yt.call(null,t)}catch(e){return Yt.call(this,t)}}}(t)}}function ie(t,e){this.fun=t,this.array=e}ie.prototype.run=function(){this.fun.apply(null,this.array)};function oe(){}var re=oe,se=oe,ae=oe,ce=oe,le=oe,de=oe,ue=oe;var he=zt.performance||{},pe=he.now||he.mozNow||he.msNow||he.oNow||he.webkitNow||function(){return(new Date).getTime()};var fe=new Date;var me,ge={nextTick:function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];Qt.push(new ie(t,e)),1!==Qt.length||Zt||Jt(ne)},title:"browser",browser:!0,env:{NODE_ENV:"production"},argv:[],version:"",versions:{},on:re,addListener:se,once:ae,off:ce,removeListener:le,removeAllListeners:de,emit:ue,binding:function(t){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(t){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(t){var e=.001*pe.call(he),n=Math.floor(e),i=Math.floor(e%1*1e9);return t&&(n-=t[0],(i-=t[1])<0&&(n--,i+=1e9)),[n,i]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-fe)/1e3}},_e={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-_e.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*_e.Bounce.In(2*t):.5*_e.Bounce.Out(2*t-1)+.5}}},ye="undefined"==typeof self&&void 0!==ge&&ge.hrtime?function(){var t=ge.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?self.performance.now.bind(self.performance):void 0!==Date.now?Date.now:function(){return(new Date).getTime()},we=function(){function t(){this._tweens={},this._tweensAddedDuringUpdate={}}return t.prototype.getAll=function(){var t=this;return Object.keys(this._tweens).map((function(e){return t._tweens[e]}))},t.prototype.removeAll=function(){this._tweens={}},t.prototype.add=function(t){this._tweens[t.getId()]=t,this._tweensAddedDuringUpdate[t.getId()]=t},t.prototype.remove=function(t){delete this._tweens[t.getId()],delete this._tweensAddedDuringUpdate[t.getId()]},t.prototype.update=function(t,e){void 0===t&&(t=ye()),void 0===e&&(e=!1);var n=Object.keys(this._tweens);if(0===n.length)return!1;for(;n.length>0;){this._tweensAddedDuringUpdate={};for(var i=0;i<n.length;i++){var o=this._tweens[n[i]],r=!e;o&&!1===o.update(t,r)&&!e&&delete this._tweens[n[i]]}n=Object.keys(this._tweensAddedDuringUpdate)}return!0},t}(),xe={Linear:function(t,e){var n=t.length-1,i=n*e,o=Math.floor(i),r=xe.Utils.Linear;return e<0?r(t[0],t[1],i):e>1?r(t[n],t[n-1],n-i):r(t[o],t[o+1>n?n:o+1],i-o)},Bezier:function(t,e){for(var n=0,i=t.length-1,o=Math.pow,r=xe.Utils.Bernstein,s=0;s<=i;s++)n+=o(1-e,i-s)*o(e,s)*t[s]*r(i,s);return n},CatmullRom:function(t,e){var n=t.length-1,i=n*e,o=Math.floor(i),r=xe.Utils.CatmullRom;return t[0]===t[n]?(e<0&&(o=Math.floor(i=n*(1+e))),r(t[(o-1+n)%n],t[o],t[(o+1)%n],t[(o+2)%n],i-o)):e<0?t[0]-(r(t[0],t[0],t[1],t[1],-i)-t[0]):e>1?t[n]-(r(t[n],t[n],t[n-1],t[n-1],i-n)-t[n]):r(t[o?o-1:0],t[o],t[n<o+1?n:o+1],t[n<o+2?n:o+2],i-o)},Utils:{Linear:function(t,e,n){return(e-t)*n+t},Bernstein:function(t,e){var n=xe.Utils.Factorial;return n(t)/n(e)/n(t-e)},Factorial:(me=[1],function(t){var e=1;if(me[t])return me[t];for(var n=t;n>1;n--)e*=n;return me[t]=e,e}),CatmullRom:function(t,e,n,i,o){var r=.5*(n-t),s=.5*(i-e),a=o*o;return(2*e-2*n+r+s)*(o*a)+(-3*e+3*n-2*r-s)*a+r*o+e}}},ve=function(){function t(){}return t.nextId=function(){return t._nextId++},t._nextId=0,t}(),be=new we,Ce=function(){function t(t,e){void 0===e&&(e=be),this._object=t,this._group=e,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=_e.Linear.None,this._interpolationFunction=xe.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._id=ve.nextId(),this._isChainStopped=!1,this._goToEnd=!1}return t.prototype.getId=function(){return this._id},t.prototype.isPlaying=function(){return this._isPlaying},t.prototype.isPaused=function(){return this._isPaused},t.prototype.to=function(t,e){return this._valuesEnd=Object.create(t),void 0!==e&&(this._duration=e),this},t.prototype.duration=function(t){return this._duration=t,this},t.prototype.start=function(t){if(this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed)for(var e in this._reversed=!1,this._valuesStartRepeat)this._swapEndStartRepeatValues(e),this._valuesStart[e]=this._valuesStartRepeat[e];return this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=void 0!==t?"string"==typeof t?ye()+parseFloat(t):t:ye(),this._startTime+=this._delayTime,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat),this},t.prototype._setupProperties=function(t,e,n,i){for(var o in n){var r=t[o],s=Array.isArray(r),a=s?"array":typeof r,c=!s&&Array.isArray(n[o]);if("undefined"!==a&&"function"!==a){if(c){var l=n[o];if(0===l.length)continue;l=l.map(this._handleRelativeValue.bind(this,r)),n[o]=[r].concat(l)}if("object"!==a&&!s||!r||c)void 0===e[o]&&(e[o]=r),s||(e[o]*=1),i[o]=c?n[o].slice().reverse():e[o]||0;else{for(var d in e[o]=s?[]:{},r)e[o][d]=r[d];i[o]=s?[]:{},this._setupProperties(r,e[o],n[o],i[o])}}}},t.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},t.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},t.prototype.pause=function(t){return void 0===t&&(t=ye()),this._isPaused||!this._isPlaying||(this._isPaused=!0,this._pauseStart=t,this._group&&this._group.remove(this)),this},t.prototype.resume=function(t){return void 0===t&&(t=ye()),this._isPaused&&this._isPlaying?(this._isPaused=!1,this._startTime+=t-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this):this},t.prototype.stopChainedTweens=function(){for(var t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].stop();return this},t.prototype.group=function(t){return this._group=t,this},t.prototype.delay=function(t){return this._delayTime=t,this},t.prototype.repeat=function(t){return this._initialRepeat=t,this._repeat=t,this},t.prototype.repeatDelay=function(t){return this._repeatDelayTime=t,this},t.prototype.yoyo=function(t){return this._yoyo=t,this},t.prototype.easing=function(t){return this._easingFunction=t,this},t.prototype.interpolation=function(t){return this._interpolationFunction=t,this},t.prototype.chain=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._chainedTweens=t,this},t.prototype.onStart=function(t){return this._onStartCallback=t,this},t.prototype.onUpdate=function(t){return this._onUpdateCallback=t,this},t.prototype.onRepeat=function(t){return this._onRepeatCallback=t,this},t.prototype.onComplete=function(t){return this._onCompleteCallback=t,this},t.prototype.onStop=function(t){return this._onStopCallback=t,this},t.prototype.update=function(t,e){if(void 0===t&&(t=ye()),void 0===e&&(e=!0),this._isPaused)return!0;var n,i,o=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(t>o)return!1;e&&this.start(t)}if(this._goToEnd=!1,t<this._startTime)return!0;!1===this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),i=(t-this._startTime)/this._duration,i=0===this._duration||i>1?1:i;var r=this._easingFunction(i);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,r),this._onUpdateCallback&&this._onUpdateCallback(this._object,i),1===i){if(this._repeat>0){for(n in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat)this._yoyo||"string"!=typeof this._valuesEnd[n]||(this._valuesStartRepeat[n]=this._valuesStartRepeat[n]+parseFloat(this._valuesEnd[n])),this._yoyo&&this._swapEndStartRepeatValues(n),this._valuesStart[n]=this._valuesStartRepeat[n];return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=t+this._repeatDelayTime:this._startTime=t+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var s=0,a=this._chainedTweens.length;s<a;s++)this._chainedTweens[s].start(this._startTime+this._duration);return this._isPlaying=!1,!1}return!0},t.prototype._updateProperties=function(t,e,n,i){for(var o in n)if(void 0!==e[o]){var r=e[o]||0,s=n[o],a=Array.isArray(t[o]),c=Array.isArray(s);!a&&c?t[o]=this._interpolationFunction(s,i):"object"==typeof s&&s?this._updateProperties(t[o],r,s,i):"number"==typeof(s=this._handleRelativeValue(r,s))&&(t[o]=r+(s-r)*i)}},t.prototype._handleRelativeValue=function(t,e){return"string"!=typeof e?e:"+"===e.charAt(0)||"-"===e.charAt(0)?t+parseFloat(e):parseFloat(e)},t.prototype._swapEndStartRepeatValues=function(t){var e=this._valuesStartRepeat[t],n=this._valuesEnd[t];this._valuesStartRepeat[t]="string"==typeof n?this._valuesStartRepeat[t]+parseFloat(n):this._valuesEnd[t],this._valuesEnd[t]=e},t}(),Se=(ve.nextId,be);Se.getAll.bind(Se),Se.removeAll.bind(Se),Se.add.bind(Se),Se.remove.bind(Se),Se.update.bind(Se);function Ee(t,e,n,i){const o=this;o.r=e,o.trueR=e,o.pickUp=function(){o.tween=new Ce(o),o.tween.to({r:2*o.trueR},100),o.tween.start()},o.drop=function(){o.tween=new Ce(o),o.tween.to({r:o.trueR},100),o.tween.start()},o.render=function(){const{fctx:e}=i;e.save(),o.tween&&o.tween.update(),0===t.exists&&(e.globalAlpha=.2),e.beginPath(),e.fillStyle=n,e.arc(t.x,t.y,o.r,0,2*Math.PI),e.fill(),e.stroke(),e.restore()}}function Ae(t,e,n){const i=document.createElement("div");i.style.position="absolute",t.x>.5*e.width?i.style.right=e.width-(t.x+5)+"px":i.style.left=`${t.x+5}px`,i.style.top=`${t.y+5}px`,i.innerText="- Properties -",i.style.border="1px solid black",i.style.padding="4px",i.style.background="white",e.tooltips.appendChild(i);!function(t,e){const n=n=>{var o;!t.contains(n.target)&&(o=t)&&(o.offsetWidth||o.offsetHeight||o.getClientRects().length)&&(e(),i())},i=()=>{document.removeEventListener("mousedown",n),document.removeEventListener("touchstart",n)};document.addEventListener("mousedown",n),document.addEventListener("touchstart",n)}(i,(()=>{i.remove()}));const o={};o.exists=new ke("checkbox","Exists","Exists: ",(e=>t.setE(e?1:0)),1===t.exists),i.appendChild(o.exists.div),1===n.election.dimensions?(t.w1&&(o.w1=new ke("range","Width","Width: ",(e=>t.setW1(e)),t.w1),i.appendChild(o.w1.div)),t.densityProfile1&&(o.densityProfile1=new ke("select","Density Profile","Density Profile: ",(e=>t.setDensityProfile1(e)),t.densityProfile1,["step","gaussian"]),i.appendChild(o.densityProfile1.div))):t.w2&&(o.w2=new ke("range","Width","Width: ",(e=>t.setW2(e)),t.w2),i.appendChild(o.w2.div)),t.color&&(o.color=new ke("color","Color","Color: ",(e=>t.setColor(e)),t.color),i.appendChild(o.color.div)),o.showGhosts=new ke("checkbox","Show Ghosts","Show Ghosts: ",(t=>n.setShowNonExistingEntities(t)),n.showGhosts),i.appendChild(o.showGhosts.div)}function ke(t,e,n,i,o,r){const s=this;if(s.div=document.createElement("div"),"select"===t){s.input=document.createElement("select");for(let t=0;t<r.length;t++){const e=document.createElement("option");e.value=r[t],e.innerText=r[t],s.input.appendChild(e)}s.input.value=o,s.input.addEventListener("input",(()=>i(s.input.value)))}else s.input=document.createElement("input"),s.input.type=t,s.input.id=e,s.input.name=e,"checkbox"===t?(o&&(s.input.checked=!0),s.input.addEventListener("change",(()=>i(s.input.checked)))):"range"===t?(s.input.min=1,s.input.max=300,s.input.value=o,s.input.step=1,s.input.addEventListener("input",(()=>i(s.input.value)))):"color"===t&&(s.input.value=o,s.input.addEventListener("input",(()=>i(s.input.value))));s.label=document.createElement("label"),s.label.for=e,s.label.innerText=n,s.label.style["margin-right"]="4px",s.div.appendChild(s.label),s.div.appendChild(s.input)}function Me(t,e,n,i,o,r,s,a,c,l,d,u){const h=this,p=s.new(h);h.instantiate=()=>{const r=[d.setESenderForList.command(p,1,0),d.setP2SenderForList.command(p,t,t),d.setP1SenderForList.command(p,e,e),d.setW2SenderForList.command(p,n,n),d.setW1SenderForList.command(p,i,i),d.setDensityProfile1SenderForList.command(p,o,o)];l?a.loadCommands(r):a.doCommands(r)},h.setEAction=t=>{h.exists=t,c.add(["draggables"])},h.setE=t=>{const e=d.setESenderForList.getCurrentValue(p);d.setESenderForList.go(p,t,e)},h.setP2Action=t=>{h.p2=structuredClone(t),2===u.election.dimensions&&(h.x=t.x,h.y=t.y),c.add(["draggables"])},h.setP1Action=t=>{h.p1=t,1===u.election.dimensions&&(h.x=t,h.y=250),c.add(["draggables"])},h.setXY=t=>{if(1===u.election.dimensions){const e=d.setP1SenderForList.getCurrentValue(p);d.setP1SenderForList.go(p,t.x,e)}else{const e=d.setP2SenderForList.getCurrentValue(p);d.setP2SenderForList.go(p,t,e)}},h.updateXY=()=>{1===u.election.dimensions?h.setP1Action(h.p1):h.setP2Action(h.p2)},h.setW2Action=t=>{h.w2=t,c.add(["width"])},h.setW2=t=>{const e=d.setW2SenderForList.getCurrentValue(p);d.setW2SenderForList.go(p,t,e)},h.setW1Action=t=>{h.w1=t,c.add(["width"])},h.setW1=t=>{const e=d.setW1SenderForList.getCurrentValue(p);d.setW1SenderForList.go(p,t,e)},h.setDensityProfile1Action=t=>{h.densityProfile1=t,c.add(["densityProfile"])},h.setDensityProfile1=t=>{const e=d.setDensityProfile1SenderForList.getCurrentValue(p);d.setDensityProfile1SenderForList.go(p,t,e)},h.instantiate(),h.click=()=>{Ae(h,r,u)};const f=new Ee(h,13,"#999",r);h.circle=f,h.renderForeground=()=>{f.render()}}function Pe(t,e,n){const i=this;i.setESenderForList=e.addSenderForList({action:(e,n)=>{i.setNumberVoters(e+1);t.get(e).setEAction(n)},name:"voters-exists"}),i.setP2SenderForList=e.addSenderForList({action:(e,n)=>{i.setNumberVoters(e+1);t.get(e).setP2Action(n)},name:"voters-shape2D-point",props:{isChain:!0}}),i.setP1SenderForList=e.addSenderForList({action:(e,n)=>{i.setNumberVoters(e+1);t.get(e).setP1Action(n)},name:"voters-shape1D-x",props:{isChain:!0}}),i.setW2SenderForList=e.addSenderForList({action:(e,n)=>{i.setNumberVoters(e+1);t.get(e).setW2Action(n)},name:"voters-shape2D-width",props:{isChain:!0}}),i.setW1SenderForList=e.addSenderForList({action:(e,n)=>{i.setNumberVoters(e+1);t.get(e).setW1Action(n)},name:"voters-shape1D-width",props:{isChain:!0}}),i.setDensityProfile1SenderForList=e.addSenderForList({action:(e,n)=>{i.setNumberVoters(e+1);t.get(e).setDensityProfile1Action(n)},name:"voters-shape1D-densityProfile"}),i.setNumberVotersSender=e.addSender({action:t=>n.setNumberVotersAction(t),currentValue:0,name:"voters-setNumberAtLeast",props:{isFirstAction:!0}}),i.setNumberVoters=t=>{e.loadCommands([i.setNumberVotersSender.command(t)])}}function Te(t,e,n,i,o,r){const s=this;!function(t,e){const n=document.createElement("button");n.innerText="Add Voter",n.className="button2",n.onclick=()=>{e.addVoterPressed()},t.newElement("addVoter",n)}(e,s);const a=new $t,c=new Pe(a,i,s);s.addVoterPressed=()=>{const t=a.num()+1;c.setNumberVoters(t)},s.setNumberVotersAction=t=>{for(;a.num()<t;)s.addVoterCircle(50,50,50,200,200,"gaussian",!1)},s.addVoterCircle=(e,s,l,d,u,h,p)=>{const f=new Me({x:e,y:s},l,d,u,h,t,a,i,n,p,c,r);o.one.addSimVoterCircle(f),o.oneDOne.addSimVoterCircle(f),o.geoOne.addSimVoterCircle(f),o.sample.addSimVoterCircle(f);const m=a.num();c.setNumberVoters(m)}}function Fe(t,e,n,i){const o=this;o.w=e,o.h=n,o.trueW=e,o.trueH=n,o.pickUp=function(){o.tweenSq=new Ce(o),o.tweenSq.to({w:o.trueW+10,h:o.trueH+10},100),o.tweenSq.start()},o.drop=function(){o.tweenSq=new Ce(o),o.tweenSq.to({w:o.trueW,h:o.trueH},100),o.tweenSq.start()},o.render=function(){const{fctx:e}=i;e.save(),o.tweenSq&&o.tweenSq.update(),0===t.exists&&(e.globalAlpha=.2),e.beginPath(),e.fillStyle=t.color,e.rect(t.x-.5*o.w-.5,t.y-.5*o.h-.5,o.w+1,o.h+1),e.fill(),e.stroke(),e.restore()}}function De(t,e,n,i,o,r,s,a,c,l,d,u){const h=this,p=s.new(h);h.instantiate=()=>{const n=[d.setESenderForList.command(p,1,0),d.setP2SenderForList.command(p,t,t),d.setP1SenderForList.command(p,e,e),d.setColorSenderForList.command(p,o,o)];l?a.loadCommands(n):a.doCommands(n)},h.setEAction=t=>{h.exists=t,c.add(["draggables"])},h.setE=t=>{const e=d.setESenderForList.getCurrentValue(p);d.setESenderForList.go(p,t,e)},h.setP2Action=t=>{h.p2=structuredClone(t),2===u.election.dimensions&&(h.x=t.x,h.y=t.y),c.add(["draggables"])},h.setP1Action=t=>{h.p1=t,1===u.election.dimensions&&(h.x=t,h.y=250),c.add(["draggables"])},h.setXY=t=>{if(1===u.election.dimensions){const e=d.setP1SenderForList.getCurrentValue(p);d.setP1SenderForList.go(p,t.x,e)}else{const e=d.setP2SenderForList.getCurrentValue(p);d.setP2SenderForList.go(p,t,e)}},h.updateXY=()=>{1===u.election.dimensions?h.setP1Action(h.p1):h.setP2Action(h.p2)},h.setColorAction=t=>{h.color=t,c.add(["color"])},h.setColor=t=>{const e=d.setColorSenderForList.getCurrentValue(p);d.setColorSenderForList.go(p,t,e)},h.instantiate(),h.click=()=>{Ae(h,r,u)};const f=new Fe(h,n,i,r);h.square=f,h.fraction=0,h.setFraction=function(t){h.fraction=t},h.setWins=t=>{h.wins=t},h.renderForeground=function(){(f.render(),0!==h.exists)&&(It((100*h.fraction).toFixed(0),h.x,h.y-.5*f.h-2,20,2,"#222",1,r.fctx),void 0!==h.wins&&It(h.wins,h.x,h.y+.5*f.h+20+2,20,2,"#222",1,r.fctx))}}function Le(t,e,n){const i=this,o="candidates";i.setESenderForList=e.addSenderForList({action:(e,n)=>{i.setNumberCandidates(e+1);t.get(e).setEAction(n)},name:`${o}-exists`}),i.setP2SenderForList=e.addSenderForList({action:(e,n)=>{i.setNumberCandidates(e+1);t.get(e).setP2Action(n)},name:`${o}-shape2D-point`,props:{isChain:!0}}),i.setP1SenderForList=e.addSenderForList({action:(e,n)=>{i.setNumberCandidates(e+1);t.get(e).setP1Action(n)},name:`${o}-shape1D-x`,props:{isChain:!0}}),i.setColorSenderForList=e.addSenderForList({action:(e,n)=>{i.setNumberCandidates(e+1);t.get(e).setColorAction(n)},name:`${o}-color`}),i.setNumberCandidatesSender=e.addSender({action:t=>{n.setNumberCandidatesAction(t)},currentValue:0,name:`${o}-setNumberAtLeast`,props:{isFirstAction:!0}}),i.setNumberCandidates=t=>{e.loadCommands([i.setNumberCandidatesSender.command(t)])}}function Ne(t,e){const n=document.createElement("button");n.className="button2",n.innerText="Add Candidate",n.onclick=()=>{e.addCandidatePressed()},t.newElement("addCandidate",n),this.show=()=>{n.hidden=!1},this.hide=()=>{n.hidden=!0}}function Ie(t,e,n,i,o,r){const s=this;s.canButton=new Ne(e,s);const a=new $t,c=new Le(a,i,s);s.addCandidatePressed=()=>{const t=a.num()+1;c.setNumberCandidates(t)},s.setNumberCandidatesAction=t=>{for(;a.num()<t;){const t=v("yellow");s.addCandidate(50,50,50,t,!1)}},s.addCandidate=(e,s,l,d,u)=>{const h=new De({x:e,y:s},l,21,21,d,t,a,i,n,u,c,r);o.one.addSimCandidate(h),o.oneDOne.addSimCandidate(h),o.geoOne.addSimCandidate(h);const p=a.num();c.setNumberCandidates(p)}}function Oe(t,e,n,i,o,r,s,a,c,l){const d=this,u=o.new(d);d.instantiate=()=>{const i=[c.setESenderForList.command(u,1,0),c.setP2SenderForList.command(u,t,t),c.setP1SenderForList.command(u,e,e),c.setW2SenderForList.command(u,n,n)];a?r.loadCommands(i):r.doCommands(i)},d.setEAction=t=>{d.exists=t,s.add(["draggables"])},d.setE=t=>{const e=c.setESenderForList.getCurrentValue(u);c.setESenderForList.go(u,t,e)},d.setP2Action=t=>{d.p2=structuredClone(t),2===l.election.dimensions&&(d.x=t.x,d.y=t.y),s.add(["draggables"])},d.setP1Action=t=>{d.p1=t,1===l.election.dimensions&&(d.x=t,d.y=150),s.add(["draggables"])},d.setXY=t=>{if(1===l.election.dimensions){const e=c.setP1SenderForList.getCurrentValue(u);c.setP1SenderForList.go(u,t.x,e)}else{const e=c.setP2SenderForList.getCurrentValue(u);c.setP2SenderForList.go(u,t,e)}},d.updateXY=()=>{1===l.election.dimensions?d.setP1Action(d.p1):d.setP2Action(d.p2)},d.setW2Action=t=>{d.w2=t,s.add(["width"])},d.setW2=t=>{const e=c.setW2SenderForList.getCurrentValue(u);c.setW2SenderForList.go(u,t,e)},d.instantiate(),d.click=()=>{Ae(d,i,l)},d.color="#ccc";const h=new Fe(d,21,21,i);d.square=h,d.render=function(){const{ctx:t}=i;t.beginPath(),t.arc(d.x,d.y,.5*d.w2,0,2*Math.PI),t.stroke()},d.renderForeground=()=>{h.render()}}function Ve(t,e,n){const i=this,o="candidateDns";i.setESenderForList=e.addSenderForList({action:(e,n)=>{i.setNumberCandidateDns(e+1);t.get(e).setEAction(n)},name:`${o}-exists`}),i.setP2SenderForList=e.addSenderForList({action:(e,n)=>{i.setNumberCandidateDns(e+1);t.get(e).setP2Action(n)},name:`${o}-shape2D-point`,props:{isChain:!0}}),i.setP1SenderForList=e.addSenderForList({action:(e,n)=>{i.setNumberCandidateDns(e+1);t.get(e).setP1Action(n)},name:`${o}-shape1D-x`,props:{isChain:!0}}),i.setW2SenderForList=e.addSenderForList({action:(e,n)=>{i.setNumberCandidateDns(e+1);t.get(e).setW2Action(n)},name:`${o}-shape2D-width`,props:{isChain:!0}}),i.setNumberCandidateDnsSender=e.addSender({action:t=>{n.setNumberCandidateDnsAction(t)},currentValue:0,name:`${o}-setNumberAtLeast`,props:{isFirstAction:!0}}),i.setNumberCandidateDns=t=>{e.loadCommands([i.setNumberCandidateDnsSender.command(t)])}}function Re(t,e){const n=document.createElement("button");n.className="button2",n.innerText="Add Candidate Distribution",n.onclick=()=>{e.addCandidateDistributionPressed()},t.newElement("addCandidateDistribution",n),this.show=()=>{n.hidden=!1},this.hide=()=>{n.hidden=!0}}function Be(t,e,n,i,o,r){const s=this;s.canDnButton=new Re(e,s);const a=new $t,c=new Ve(a,i,s);s.addCandidateDistributionPressed=()=>{const t=a.num()+1;c.setNumberCandidateDns(t)},s.setNumberCandidateDnsAction=t=>{for(;a.num()<t;)s.addCandidateDistribution(50,50,50,200,!1)},s.addCandidateDistribution=(e,s,l,d,u)=>{const h=new Oe({x:e,y:s},l,d,t,a,i,n,u,c,r);o.sample.addSimCandidateDistribution(h);const p=a.num();c.setNumberCandidateDns(p)}}function Ge(t,e){let n,i;this.update=function(t){n=t.getCandidates();const o=n.map((t=>[t.x,t.y])),r=ot.from(o);i=r.voronoi([0,0,e.width,e.height])},this.render=function(){const{ctx:o}=e,{x:r,w1:s,densityProfile1:a}=t,c=100;o.save(),o.beginPath(),d(),o.clip();const l=n.length;for(let t=0;t<l;t++)o.beginPath(),i.renderCell(t,o),o.fillStyle=n[t].color,o.fill(),o.stroke();function d(){"gaussian"===a?function(){const t=s/Math.sqrt(2*Math.PI),n=c,i=200;o.moveTo(0,i);const a=[];for(let s=0;s<=e.width;s+=1){const e=.5*((s-r)/t)**2,c=i-n*Math.exp(-e);a.push(c),o.lineTo(s,c)}o.lineTo(e.width,i),o.lineTo(0,i)}():o.rect(r-.5*s,100,s,c)}o.beginPath(),d(),o.stroke(),o.restore()}}function qe(t,e,n){const i=this;st.call(i,t,e);const o=new Ge(t,n);i.update=function(t){o.update(t)},i.render=function(){o.render()}}function We(t,e,n,i,o){const r=this;ht.call(r,t,n,o);const s=new dt(o),a=new lt(o);r.addSimCandidate=t=>{a.newCandidate(new ct(t,r.dragm))},r.addSimVoterCircle=e=>{s.newVoterGroup(new qe(e,r.dragm,t))};const c=r.enter;r.enter=()=>{c(),o.simAddCandidates.canButton.show(),o.election.setDimensions(1),s.updateXY(),a.updateXY()},r.exit=()=>{o.simAddCandidates.canButton.hide()},r.update=()=>{n.checkNone()||(n.clear(),i.updateTallies(s,a),s.update(a),t.clear(),r.render())},r.render=()=>{s.render()},r.renderForeground=()=>{s.renderForeground(),a.renderForeground()}}function je(t,e,n,i,o,r,s,a,c){const l=this;l.election=i;const d={one:new pt(t,e,n,o,l),oneDOne:new We(t,e,n,o,l),sample:new yt(t,e,n,r,l),geoOne:new jt(t,e,n,s,l)};l.simAddVoters=new Te(t,c,n,a,d,l),l.simAddCandidates=new Ie(t,c,n,a,d,l),l.simAddCandidateDns=new Be(t,c,n,a,d,l),l.simAddCandidates.addCandidate(50,100,50,"#e05020",!0),l.simAddCandidates.addCandidate(100,50,100,"#50e020",!0),l.simAddCandidates.addCandidate(200,250,200,"#2050e0",!0),l.simAddCandidateDns.addCandidateDistribution(150,150,150,200,!0),l.simAddVoters.addVoterCircle(50,150,50,200,200,"gaussian",!0),l.simAddVoters.addVoterCircle(250,150,250,200,200,"gaussian",!0),l.state="one",n.add(["simType"]),l.update=()=>{n.check(["simType"])&&(Object.keys(d).forEach((t=>d[t].exit())),d[l.state].enter()),d[l.state].update()},l.renderForeground=()=>{d[l.state].renderForeground()},l.render=()=>{d[l.state].render()},l.setShowNonExistingEntities=t=>{l.showGhosts=t,n.add(["showGhosts"])},function(t){const e=document.createElement("div");e.setAttribute("class","button-group-label"),e.innerText="Sim Controls:",t.newElement("simControlsLabel",e)}(c),l.typeList=[{name:"One Election",value:"one",state:""},{name:"1D One Election",value:"oneDOne",state:""},{name:"Sample Elections",value:"sample",state:""},{name:"Geo Election",value:"geoOne",state:""}],e.addMenuItem(l,{label:"Simulation:",prop:"state",setProp:t=>{l.state=t},options:l.typeList,change:["simType"]})}function $e(t,e,n){const i=this;i.points=[],i.newPoints=[],i.startSim=function(){i.points=[],r.clearRect(0,0,o.width,o.height)},i.addSim=function(t,e){if(0===t.getVoterGroups().length)return 1;if(0===e.getCandidateDistributions().length)return 1;if(i.points.length>5e3)return 1;const o=t.getVoterGroups();for(let t=0;t<20;t++){let t;"singleWinner"===n.method.checkElectionType()?t=5:"allocation"===n.method.checkElectionType()&&(t=10);const r=[];for(let n=0;n<t;n++){const t=e.sampler.samplePoint();r.push({p2:t})}const s=n.runElection(o,r);if("singleWinner"===n.method.checkElectionType()){const{winner:t}=s,e=t.p2;i.points.push(e),i.newPoints.push(e)}else{const{allocation:t}=s,e=10;r.forEach(((n,o)=>{const r=t[o];for(let t=0;t<r;t++){let o;o=0===t?n.p2:{x:n.p2.x+(Math.random()-.5)*e,y:n.p2.y+(Math.random()-.5)*e},i.points.push(o),i.newPoints.push(o)}}))}}return s(r,i.newPoints),i.newPoints=[],0};const o=document.createElement("canvas");o.width=t.canvas.width,o.height=t.canvas.height;const r=o.getContext("2d");function s(t,e){t.fillStyle="grey";const n=e.length;for(let i=0;i<n;i++){const n=e[i];t.beginPath(),t.arc(n.x,n.y,3,0,2*Math.PI),t.fill()}}i.render=function(){t.noBuffers?i.noBufferRender():i.bufferRender()},i.bufferRender=function(){const{ctx:e}=t;e.drawImage(o,0,0)},i.noBufferRender=function(){const{ctx:e}=t;s(e,i.points)}}const Ue=Math.round;function He(t){const e=t.length,n=Array(4).fill();if("rgb"===t.slice(0,3).toLowerCase()){const e=t.replace(" ","").split(",");n[0]=parseInt(e[0].slice("a"===e[3].toLowerCase()?5:4),10),n[1]=parseInt(e[1],10),n[2]=parseInt(e[2],10),n[3]=e[3]?parseFloat(e[3]):-1}else{let i;i=e<6?parseInt(String(t[1])+t[1]+t[2]+t[2]+t[3]+t[3]+(e>4?String(t[4])+t[4]:""),16):parseInt(t.slice(1),16),n[0]=i>>16&255,n[1]=i>>8&255,n[2]=255&i,n[3]=9===e||5===e?Ue((i>>24&255)/255*1e4)/1e4:-1}return n}function ze(t,e,n=.5){const i=t.trim(),o=e.trim(),r=n<0?-1*n:n,s=He(i),a=He(o);return"r"===o[0]?`rgb${"a"===o[3]?"a(":"("}${Ue((a[0]-s[0])*r+s[0])},${Ue((a[1]-s[1])*r+s[1])},${Ue((a[2]-s[2])*r+s[2])}${s[3]<0&&a[3]<0?"":`,${s[3]>-1&&a[3]>-1?Ue(1e4*((a[3]-s[3])*r+s[3]))/1e4:a[3]<0?s[3]:a[3]}`})`:`#${(4294967296+16777216*(s[3]>-1&&a[3]>-1?Ue(255*((a[3]-s[3])*r+s[3])):a[3]>-1?Ue(255*a[3]):s[3]>-1?Ue(255*s[3]):255)+65536*Ue((a[0]-s[0])*r+s[0])+256*Ue((a[1]-s[1])*r+s[1])+Ue((a[2]-s[2])*r+s[2])).toString(16).slice(s[3]>-1||a[3]>-1?1:3)}`}function Xe(t,e){let n=t[0],i=e[0];for(let o=1;o<t.length;o++){const r=Ye(t[o],n);i=ze(i,e[o],r),n+=t[o]}return i}function Ye(t,e){return t/(t+e)}function Je(t,e,n){const i=this;i.updateVotes=(t,e)=>{0!==t.getSimVoterGroups().length&&0!==e.getCandidates().length&&(i.updateStatewideTallies(t,e),i.updateNoiseImage(t,e),i.runDistrictElections(t,e),i.updateWinColors(e),i.updateColorBlendGeoMap(e),i.updateWins(e))},i.updateStatewideTallies=function(t,e){const i=e.getCandidates(),{allVoterGroups:o}=t,r=n.runElection(o,i),{tallyFractions:s}=r.votes;e.setCandidateFractions(s)},i.updateNoiseImage=function(t,e){const i=e.getCandidates(),{voterGroupsByTract:o}=t,r=o.map((t=>t.map((t=>n.runElection(t,i))))),s=i.map((t=>t.color)),a=r.map((t=>t.map((t=>{const{tallyFractions:e}=t.votes;return He(Xe(e,s))}))));t.noiseImage.loadColors(a)},i.runDistrictElections=(t,e)=>{const o=e.getCandidates(),{voterGroupsByDistrict:r}=t;i.resultsByDistrict=r.map((t=>n.runElection(t,o)))},i.updateWinColors=t=>{if("singleWinner"===n.method.checkElectionType())i.winnerColors=i.resultsByDistrict.map((t=>t.winner.color));else{const e=t.getCandidates().map((t=>t.color));i.winnerColors=i.resultsByDistrict.map((t=>{const{allocation:n}=t,i=n.reduce(((t,e)=>t+e));return Xe(n.map((t=>t/i)),e)}))}},i.updateWins=function(t){const e=t.getCandidates().length,o=Array(e).fill(0);if("singleWinner"===n.method.checkElectionType()){i.resultsByDistrict.map((t=>t.iWinner)).forEach((t=>{o[t]+=1}))}else i.resultsByDistrict.forEach((t=>{const{allocation:n}=t;for(let t=0;t<e;t++)o[t]+=n[t]}));t.setCandidateWins(o)},i.updateColorBlendGeoMap=t=>{i.blendColors=i.resultsByDistrict.map((e=>{const{tallyFractions:n}=e.votes;return Xe(n,t.getCandidates().map((t=>t.color)))}))}}function Ke(t){const e={},n=[];this.newElement=(i,o)=>{t.includes(i)?e[i]=o:n.push(o)},this.makeComponent=()=>{const i=document.createElement("div");return t.forEach((t=>{const n=e[t];void 0!==n&&i.appendChild(n)})),n.forEach((t=>{i.appendChild(t)})),i}}function Qe(t,e,n){this.updateTallies=function(t,e){if(0===t.getVoterGroups().length)return;if(0===e.getCandidates().length)return;const i=n.castVotes(t,e);e.setCandidateFractions(i.tallyFractions)}}function Ze(t){const e=this,n=[];e.addSender=e=>{const{name:i,action:o,props:r}=e;n[i]=o;const s=t=>({name:i,value:t,props:r});return{command:s,go:e=>t.do(s(e))}},e.addSenderForList=e=>{const{name:i,action:o,props:r}=e;n[i]=o;const s=(t,e,n)=>({name:i,id:t,value:e,props:r,currentValue:n});return{command:s,go:(e,n,i)=>t.do(s(e,n,i))}},e.execute=t=>{const{name:e,id:i,value:o}=t,r=n[e];void 0!==i?r(i,o):r(o)}}function tn(t){const e=this,n={},i=[];e.addSender=t=>{const{name:e,currentValue:o,props:r}=t;void 0!==r&&r.isFirstAction&&(i[e]=!0),n[e]=o},e.addSenderForList=t=>{const{name:e,props:o}=t;void 0!==o&&o.isFirstAction&&(i[e]=!0),n[e]=[];return t=>n[e][t]},e.execute=t=>{const{name:e,id:i,value:o}=t;void 0!==i?n[e][i]=o:n[e]=o},e.makeUndo=t=>{const{name:e,id:i,props:o}=t;let r;void 0===i?r=n[e]:(r=n[e][i],void 0===r&&(r=t.currentValue));return{name:e,id:i,value:r,props:o}},e.passLoadConfig=t=>{e.loadConfigPriority(t,"high"),e.loadConfigPriority(t,"low")},e.loadConfigPriority=(e,n)=>{Object.keys(e).forEach((o=>{const r=void 0!==i[o];if("low"===n&&r)return;if("high"===n&&!r)return;const s=e[o];if(s instanceof Array)s.forEach(((e,n)=>{const i={name:o,id:n,value:e};t.execute(i)}));else{const e={name:o,value:s};t.execute(e)}}))},e.passLoadCommands=e=>{e.forEach((e=>{t.execute(e)}))},e.getConfig=()=>structuredClone(n)}function en(t){const e=this,n=[];let i=-1;e.clearHistory=()=>{n.splice(0,n.length),i=-1},e.passDo=e=>{const o=t.makeUndo(e);n.splice(i+1,n.length-(i+1)),t.execute(e),n.push([{command:e,undoCommand:o}]),i+=1},e.passDoCommands=e=>{n.splice(i+1,n.length-(i+1));const o=[];e.forEach((e=>{const n=t.makeUndo(e);o.push({command:e,undoCommand:n}),t.execute(e)})),n.push(o),i+=1};let o=setTimeout((()=>null),30);e.undo=()=>{if(-1===i)return;const r=n[i];r.forEach((e=>{t.execute(e.undoCommand)})),i-=1;const{undoCommand:s}=r[0];if(void 0===s.props)return;if(!0!==s.props.isChain)return;if(-1===i)return;n[i][0].undoCommand.name===s.name&&(clearTimeout(o),o=setTimeout(e.undo,30))},e.redo=()=>{if(i===n.length-1)return;const r=n[i+1];r.forEach((e=>t.execute(e.command))),i+=1;const{command:s}=r[0];if(void 0===s.props)return;if(!0!==s.props.isChain)return;if(i===n.length-1)return;n[i+1][0].command.name===s.name&&(clearTimeout(o),o=setTimeout(e.redo,30))}}function nn(t){const e=this,n=new Ze(e),i=new tn(e),o=new en(e);t.addCommander(e),e.addSender=t=>{i.addSender(t);return n.addSender(t)},e.addSenderForList=t=>{const e=n.addSenderForList(t);return e.getCurrentValue=i.addSenderForList(t),e},e.execute=t=>{i.execute(t),n.execute(t)},e.makeUndo=i.makeUndo,e.passLoadConfig=i.passLoadConfig,e.passLoadCommands=i.passLoadCommands,e.getConfig=i.getConfig,e.loadConfig=n=>{t.broadcastLoadConfig(n,e)},e.loadCommands=n=>{t.broadCastLoadCommands(n,e)},e.do=n=>{t.broadcastDo(n,e)},e.doCommands=n=>{t.broadcastDoCommands(n,e)},e.passDo=o.passDo,e.passDoCommands=o.passDoCommands,e.undo=o.undo,e.redo=o.redo,e.clearHistory=o.clearHistory}function on(t,e){const n=document.createElement("button");n.className="button2",n.innerText="Save Config To Text";const i=document.createElement("textarea");n.onclick=()=>{const t=e.getConfig();var n;i.value=(n=t,JSON.stringify(w(n),null,"\t"))};const o=document.createElement("div"),r=document.createElement("div");r.appendChild(n),r.appendChild(o),r.appendChild(i),t.newElement("saveConfigToText",r)}function rn(t,e,n){const i=document.createElement("button");i.className="button2",i.innerText="Save Link";const o=document.createElement("button");o.className="button2",o.innerText="Copy Link to Clipboard";const r=document.createElement("textarea");function s(){const t=e.getConfig(),i=encodeURIComponent(JSON.stringify(t));return`${function(){const t=document.location.href.split("/"),e=t.slice(0,t.length-1);return e.join("/")}()}/${n}?a=${i}`}i.onclick=()=>{const t=s();r.value=t},o.onclick=()=>{const t=s();navigator.clipboard.writeText(t)};const a=document.createElement("div"),c=document.createElement("div");c.appendChild(i),c.appendChild(o),c.appendChild(a),c.appendChild(r),t.newElement("saveConfigToLink",c)}function sn(t,n,o){const r=new e,s=new Ke(["menu","simControlsLabel","addVoter","addCandidate","addCandidateDistribution","undo","redo","clearDiv","screen","tooltips","foreground","geoMaps","saveConfigToLink","saveConfigToText","loadConfigText","svgUIDiv"]),a=new nn(n),c=new f(r,s,a);!function(t,e){const n=document.createElement("button"),i=document.createElement("button");n.className="button2",i.className="button2",n.innerText="Undo",i.innerText="Redo",n.onclick=e.undo,i.onclick=e.redo,t.newElement("undo",n),t.newElement("redo",i)}(s,a),rn(s,a,o),on(s,a),function(t,e){const n=document.createElement("button");n.className="button2",n.innerText="Load Config Text";const i=document.createElement("textarea");n.onclick=()=>{if(""===i.value)return;const t=JSON.parse(i.value);e.loadConfig(t)};const o=document.createElement("div"),r=document.createElement("div");r.appendChild(n),r.appendChild(o),r.appendChild(i),t.newElement("loadConfigText",r)}(s,a);const d=new i(300,300,s);l(d,(function(){d.clear(),g.render(),g.renderForeground()}),s);const u=new P(c),h=new Qe(d,c,u),p=new $e(d,c,u),m=new Je(d,c,u),g=new je(d,c,r,u,h,p,m,a,s);a.loadConfig(t),a.clearHistory();const _=s.makeComponent();return window.requestAnimationFrame((function t(){g.update(),d.clearForeground(),g.renderForeground(),window.requestAnimationFrame(t)})),_}Array.from(document.getElementsByClassName("sandbox")).forEach((e=>{const n=void 0!==e.dataset.config?JSON.parse(e.dataset.config):{},i=function(){const t=new URLSearchParams(window.location.search),e=t.has("a");return{yes:e,config:e?JSON.parse(t.get("a")):{}}}(),o=i.yes?i.config:n,r=void 0!==e.dataset.sandboxurl?e.dataset.sandboxurl:"",s=sn(o,new t,r);e.parentNode.appendChild(s)})),Array.from(document.getElementsByClassName("double_sandbox")).forEach((e=>{const n=function(e,n){const i=new t,o=document.createElement("button");o.className="button2",o.innerText="linked",o.style["vertical-align"]="middle",o.style["min-width"]="70px",o.style.margin="5px",o.onclick=()=>{"linked"===o.innerText?(o.innerText="unlinked",i.setLinked(!1)):(o.innerText="linked",i.setLinked(!0))};const r=sn(e,i,n),s=sn(e,i,n);r.style.display="inline-block",s.style.display="inline-block",r.style["vertical-align"]="top",s.style["vertical-align"]="top";const a=document.createElement("div");return a.appendChild(r),a.appendChild(o),a.appendChild(s),a}(void 0!==e.dataset.config?JSON.parse(e.dataset.config):{},void 0!==e.dataset.sandboxurl?e.dataset.sandboxurl:"");e.parentNode.appendChild(n)}))})();
//# sourceMappingURL=addSandboxes.js.map
